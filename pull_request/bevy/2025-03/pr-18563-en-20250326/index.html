<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18563 don't wait during publishing
        
    </title><meta content="#18563 don't wait during publishing" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-26</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18563-zh-cn-20250326>中文</a></div></div><div class=pr-content><h1 id=18563-don-t-wait-during-publishing>#18563 don’t wait during publishing</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: don’t wait during publishing<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18563<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: <code>D-Trivial</code>, <code>A-Meta</code>, <code>S-Ready-For-Final-Review</code>, <code>X-Contentious</code><li><strong>Created</strong>: 2025-03-26T21:10:25Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Publishing takes a long time<li>There’s a 20 second wait between crates to not hit the rate limit on crates.io</ul><h2 id=solution>Solution</h2><ul><li>Our rate limit has been increased by the crates.io team, don’t wait anymore!</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The Bevy engine’s crate publishing process faced a significant time bottleneck due to rate limiting constraints on crates.io. The original publishing script implemented a conservative 20-second delay between publishing individual crates to avoid hitting the platform’s rate limits. While effective for preventing API errors, this approach substantially increased total publishing time for the multi-crate project.<p>After coordination with the crates.io maintainers, the Bevy team secured an increased rate limit allocation. This infrastructure change enabled the removal of artificial delays without risking failed publish attempts. The technical implementation required modifying the publishing script’s crate iteration logic to eliminate the waiting period.<p>The core modification occurs in <code>tools/publish.sh</code>, where the script previously contained timing logic between crate publications. The updated implementation streamlines the publishing loop to execute <code>cargo publish</code> commands consecutively. This change reduces total publishing time by approximately 20 seconds per crate, with the exact savings depending on the number of crates in the workspace.<pre class=language-bash data-lang=bash style=color:#61676c;background-color:#fafafa><code class=language-bash data-lang=bash><span style=color:#abb0b6;font-style:italic># Original implementation (conceptual, before PR)
</span><span style=color:#fa6e32>for</span><span> crate </span><span style=color:#fa6e32>in </span><span>$crates</span><span style=color:#ed9366>; </span><span style=color:#fa6e32>do
</span><span>  </span><span style=color:#f29718>cargo</span><span> publish
</span><span>  </span><span style=color:#f29718>sleep</span><span> 20
</span><span style=color:#fa6e32>done
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Updated implementation
</span><span style=color:#fa6e32>for</span><span> crate </span><span style=color:#fa6e32>in </span><span>$crates</span><span style=color:#ed9366>; </span><span style=color:#fa6e32>do
</span><span>  </span><span style=color:#f29718>cargo</span><span> publish
</span><span style=color:#fa6e32>done
</span></code></pre><p>The technical decision to remove the sleep command directly responds to the updated rate limit conditions. This demonstrates an important principle in CI/CD pipelines: infrastructure-specific constraints should be explicitly encoded rather than hardcoded when possible. The change also highlights the value of maintaining positive relationships with ecosystem partners like the crates.io team to optimize development workflows.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Original Publishing Script] -->|Contains| B[20s Delay]
</span><span>    C[Updated Rate Limits] -->|Enables| D[Modified Script]
</span><span>    D -->|Removes| B
</span><span>    D -->|Results In| E[Faster Publishing]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=file-tools-publish-sh>File: <code>tools/publish.sh</code></h3><p><strong>Change</strong>: Removed artificial delay between crate publications<p>Before (conceptual reconstruction):<pre class=language-bash data-lang=bash style=color:#61676c;background-color:#fafafa><code class=language-bash data-lang=bash><span style=color:#fa6e32>for</span><span> crate </span><span style=color:#fa6e32>in </span><span>$crates</span><span style=color:#ed9366>; </span><span style=color:#fa6e32>do
</span><span>  </span><span style=color:#f29718>cargo</span><span> publish
</span><span>  </span><span style=color:#f29718>sleep</span><span> 20
</span><span style=color:#fa6e32>done
</span></code></pre><p>After (actual implementation):<pre class=language-bash data-lang=bash style=color:#61676c;background-color:#fafafa><code class=language-bash data-lang=bash><span style=color:#fa6e32>for</span><span> crate </span><span style=color:#fa6e32>in </span><span>$crates</span><span style=color:#ed9366>; </span><span style=color:#fa6e32>do
</span><span>  </span><span style=color:#f29718>cargo</span><span> publish
</span><span style=color:#fa6e32>done
</span></code></pre><p>This modification directly implements the solution by removing the mandatory wait period between crate publications. The change affects the core publishing workflow, reducing total execution time while maintaining reliability under the updated rate limits.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/publishing.html target=_blank>crates.io API Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/commands/cargo-publish.html target=_blank>cargo publish Reference</a><li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/rest/guides/best-practices-for-integrators#dealing-with-rate-limits target=_blank>Rate Limiting in CI/CD Pipelines (Best Practices)</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18563.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>