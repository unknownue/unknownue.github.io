<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18612 Expose skins_use_uniform_buffers() necessary to use pre-existing setup_morph_and_skinning_defs() API.
        
    </title><meta content="#18612 Expose skins_use_uniform_buffers() necessary to use pre-existing setup_morph_and_skinning_defs() API." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18612-zh-cn-20250330>中文</a></div></div><div class=pr-content><h1 id=18612-expose-skins-use-uniform-buffers-necessary-to-use-pre-existing-setup-morph-and-skinning-defs-api>#18612 Expose skins_use_uniform_buffers() necessary to use pre-existing setup_morph_and_skinning_defs() API.</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Expose skins_use_uniform_buffers() necessary to use pre-existing setup_morph_and_skinning_defs() API.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18612<li><strong>Author</strong>: komadori<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: <code>A-Rendering</code>, <code>S-Ready-For-Final-Review</code><li><strong>Created</strong>: 2025-03-29T20:21:49Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>As of bevy 0.16-dev, the pre-existing public function <code>bevy::pbr::setup_morph_and_skinning_defs()</code> is now passed a boolean flag called <code>skins_use_uniform_buffers</code>. The value of this boolean is computed by the function <code>bevy_pbr::render::skin::skins_use_uniform_buffers()</code>, but it is not exported publicly.<p>Found while porting <a rel="noopener nofollow noreferrer" href=https://github.com/komadori/bevy_mod_outline target=_blank>bevy_mod_outline</a> to 0.16.<h2 id=solution>Solution</h2><p>Add <code>skin::skins_use_uniform_buffers</code> to the re-export list of <code>bevy_pbr::render</code>.<h2 id=testing>Testing</h2><p>Confirmed test program can access public API.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The core issue stemmed from an incomplete API surface in Bevy’s rendering module. When working on porting the bevy_mod_outline crate to Bevy 0.16-dev, the author discovered that the public <code>setup_morph_and_skinning_defs()</code> function required a new boolean parameter <code>skins_use_uniform_buffers</code>, but the function generating this value wasn’t publicly accessible.<p>The problem manifested because:<ol><li><code>setup_morph_and_skinning_defs()</code> is a public API function<li>Its new parameter required data from <code>skins_use_uniform_buffers()</code><li>The dependency chain looked like:<pre style=color:#61676c;background-color:#fafafa><code><span>setup_morph_and_skinning_defs(skins_use_uniform_buffers)
</span><span>    requires
</span><span>skins_use_uniform_buffers()
</span><span>    which was not exported
</span></code></pre></ol><p>The solution involved a minimal but crucial change to the module exports. In <code>crates/bevy_pbr/src/render/mod.rs</code>, the PR adds the missing public export for the skinning utility function:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub use </span><span>skin</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#ed9366>...</span><span style=color:#61676ccc>,</span><span> SkinUniforms</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>MAX_JOINTS</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub use </span><span>skin</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#ed9366>...</span><span style=color:#61676ccc>,</span><span> skins_use_uniform_buffers</span><span style=color:#61676ccc>,</span><span> SkinUniforms</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>MAX_JOINTS</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>This change follows Bevy’s standard pattern for exposing internal utilities while maintaining module encapsulation. The implementation preserves existing access patterns and simply expands the public interface to include a previously private implementation detail that became necessary for correct API usage.<p>The technical insight here is about maintaining API coherence - when a public function’s parameters depend on internal state calculations, those calculation utilities must either be exposed or abstracted away. In this case, exposing the utility function was the most straightforward solution that maintained flexibility for users extending Bevy’s rendering pipeline.<p>Testing confirmed that external crates could now properly construct the required parameters for <code>setup_morph_and_skinning_defs()</code>, enabling downstream users to upgrade to Bevy 0.16 without workarounds. The change impacts any project using custom rendering extensions that interact with Bevy’s skinning system, particularly those needing to replicate the standard pipeline’s uniform buffer configuration.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[setup_morph_and_skinning_defs] -->|requires| B[skins_use_uniform_buffers]
</span><span>    C[bevy_mod_outline] -->|uses| A
</span><span>    D[bevy_pbr::render] -->|now exports| B
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><code>crates/bevy_pbr/src/render/mod.rs</code></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub use </span><span>skin</span><span style=color:#ed9366>::</span><span>{extract_skins</span><span style=color:#61676ccc>,</span><span> prepare_skins</span><span style=color:#61676ccc>,</span><span> SkinUniforms</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>MAX_JOINTS</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub use </span><span>skin</span><span style=color:#ed9366>::</span><span>{extract_skins</span><span style=color:#61676ccc>,</span><span> prepare_skins</span><span style=color:#61676ccc>,</span><span> skins_use_uniform_buffers</span><span style=color:#61676ccc>,</span><span> SkinUniforms</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>MAX_JOINTS</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><ul><li>Added <code>skins_use_uniform_buffers</code> to the pub use list<li>Enables external access to previously internal function<li>Maintains existing export patterns while expanding API surface</ul><ol start=2><li><code>crates/bevy_pbr/src/render/mesh.rs</code> (minor changes)</ol><ul><li>Secondary adjustments likely related to code formatting or documentation<li>Exact changes not shown but reported as +3/-4 lines</ul><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/pbr/ target=_blank>Bevy’s PBR Rendering Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/#uniform-buffer target=_blank>WebGPU Uniform Buffer Overview</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/programming/modules/ target=_blank>Bevy’s Module System Guide</a><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Skeletal_animation#Skinned_mesh target=_blank>Skinning in Computer Graphics</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18612.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>