<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18475 enable x11 by default in bevy_winit
        
    </title><meta content="#18475 enable x11 by default in bevy_winit" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18475-zh-cn-20250324-1>中文</a></div></div><div class=pr-content><h1 id=18475-enable-x11-by-default-in-bevy-winit>#18475 enable x11 by default in bevy_winit</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: enable x11 by default in bevy_winit<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18475<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: <code>A-Windowing</code>, <code>O-Linux</code>, <code>S-Ready-For-Final-Review</code><li><strong>Created</strong>: 2025-03-22T08:57:06Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>building bevy_winit on linux fails with</ul><pre style=color:#61676c;background-color:#fafafa><code><span>error: The platform you're compiling for is not supported by winit
</span><span>  --> /home/runner/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/winit-0.30.9/src/platform_impl/mod.rs:78:1
</span><span>   |
</span><span>78 | compile_error!("The platform you're compiling for is not supported by winit");
</span><span>   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</span></code></pre><ul><li>this blocks publishing Bevy from linux during the verification step</ul><h2 id=solution>Solution</h2><ul><li>Enable <code>x11</code> by default when building bevy_winit, and disable default features of bevy_winit in bevy_internal<li>This doesn’t change anything when depending on Bevy</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem emerged during Linux-based build verification for Bevy publication. When attempting to build <code>bevy_winit</code> on Linux, the compilation would fail due to winit’s platform requirements not being met. The root cause was that <code>bevy_winit</code> wasn’t configuring its windowing backend features appropriately for Linux environments.<p>Winit requires explicit selection of either X11 or Wayland backend on Linux. The error occurred because neither backend was enabled by default, resulting in a platform support compile error. This became a critical blocker for Linux-based CI/CD pipelines handling Bevy publication.<p>The solution involved two coordinated changes to Cargo.toml manifests. First, <code>bevy_winit</code> was modified to include X11 support by default through its feature flags. This ensures that standalone builds of <code>bevy_winit</code> (like those during publication verification) would automatically include necessary Linux windowing support. However, to prevent unintended feature propagation in the main Bevy engine, the parent <code>bevy_internal</code> crate was updated to explicitly disable <code>bevy_winit</code>’s default features while maintaining existing functionality.<p>Key implementation details:<ol><li><strong>bevy_winit Feature Defaults</strong></ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>default </span><span>= []
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>default </span><span>= [</span><span style=color:#86b300>"x11"</span><span>]
</span></code></pre><p>This change ensures X11 support activates automatically when using <code>bevy_winit</code> directly.<ol start=2><li><strong>bevy_internal Dependency Adjustment</strong></ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>bevy_winit </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_winit"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.16.0-dev" </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>bevy_winit </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_winit"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.16.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span></code></pre><p>This prevents default feature inheritance in the main engine while allowing downstream users to get sensible defaults.<p>The technical rationale balances two requirements:<ul><li>Publication workflows needing valid standalone <code>bevy_winit</code> builds<li>Main Bevy users expecting controlled feature activation through <code>bevy_internal</code></ul><p>By decoupling the default features between the crate and its usage in the engine, the solution maintains backward compatibility while fixing the build pipeline. X11 was chosen as the default Linux backend due to its broader compatibility compared to Wayland, though users can still opt into Wayland explicitly if needed.<p>The impact is immediate and localized:<ul><li>Linux build verification now succeeds<li>Existing Bevy users see no behavior changes<li>Crate consumers get sensible Linux defaults without extra configuration</ul><p>This demonstrates effective use of Cargo’s feature management system to solve platform-specific build issues while maintaining ecosystem compatibility. The pattern of adjusting default features at different dependency levels could serve as a reference for similar cross-crate configuration challenges.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_internal] -->|depends on| B[bevy_winit]
</span><span>    B -->|default features| C[x11]
</span><span>    A -.->|disables default features| B
</span><span>    C --> D[Linux Build Success]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><strong>crates/bevy_winit/Cargo.toml</strong></ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>default </span><span>= []
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>default </span><span>= [</span><span style=color:#86b300>"x11"</span><span>]
</span></code></pre><p>This change ensures X11 backend activation by default for standalone builds.<ol start=2><li><strong>crates/bevy_internal/Cargo.toml</strong></ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Dependency line before:
</span><span style=color:#399ee6>bevy_winit </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_winit"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.16.0-dev" </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Dependency line after:
</span><span style=color:#399ee6>bevy_winit </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_winit"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.16.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span></code></pre><p>This prevents default feature inheritance in the main Bevy engine while allowing manual feature selection.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Cargo Features Documentation</a> - Official guide to Rust’s feature system<li><a rel="noopener nofollow noreferrer" href=https://github.com/rust-windowing/winit#platform-specific-notes target=_blank>Winit Platform Requirements</a> - Details on windowing backend requirements<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/features/ target=_blank>Bevy Feature Management Guide</a> - How Bevy handles feature flags<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html target=_blank>Rust Dependency Specification</a> - Understanding dependency declarations in Cargo.toml</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18475.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>