<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18191 Split example file docblock and code when generating web examples markdown
        
    </title><meta content="#18191 Split example file docblock and code when generating web examples markdown" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-19</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18191-zh-cn-20250319>中文</a></div></div><div class=pr-content><h1 id=18191-split-example-file-docblock-and-code-when-generating-web-examples-markdown>#18191 Split example file docblock and code when generating web examples markdown</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Split example file docblock and code when generating web examples markdown<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18191<li><strong>Author</strong>: doup<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-03-07T11:30:12Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Separate example explanation (file docblock) and the code so they can be layout differently in the website and we can give a higher importance to the explanation on the <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy-website/pull/1935 target=_blank>website search tool</a>. This would also allow us to improve the examples so they become even more like a cookbook.<h2 id=solution>Solution</h2><p>Update the <code>example-showcase</code> tool to extract the example file docblock and write it as the example markdown content. This allows us to access the explanation via <code>page.content</code> in Zola.<h2 id=testing>Testing</h2><p>I’ve checked that the output is correct after running the tool and it doesn’t throw any error. I’ve also validated that the approach will work on the website.<h2 id=showcase>Showcase</h2><p>This is a quick and dirty example of what we could do in the web examples after the change. When we implement the real thing we can put the explanation on a sidebar or explore other layout options.</p><img alt=image src=https://github.com/user-attachments/assets/6738542e-31c3-41cd-972a-7fa2e942e85d width=1362><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The Bevy engine’s example system faced a presentation challenge where example documentation and implementation code were intertwined in generated website content. This made it difficult to apply different styling treatments and prioritize explanatory text in search results. The existing implementation wrote entire example files directly into markdown, blending documentation comments (docblocks) with executable code.<p>The core solution modifies the example-showcase tool to parse and separate documentation from code before generating website content. This separation enables:<ol><li>Independent styling of documentation and code sections<li>Direct access to clean documentation text for search indexing<li>Flexible content layouts in future website updates</ol><p>The implementation introduces a two-phase parsing process in <code>tools/example-showcase/src/main.rs</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>parse_example_doc_and_code</span><span>(</span><span style=color:#ff8f40>example_path</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Path) </span><span style=color:#61676ccc>-> </span><span>(String, String) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> content </span><span style=color:#ed9366>= </span><span>fs</span><span style=color:#ed9366>::</span><span>read_to_string(example_path)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> re </span><span style=color:#ed9366>= </span><span>Regex</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>r</span><span style=color:#86b300>"(?s)^/\*!(.*?)\*/[\s\n]*(.*)"</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(caps) </span><span style=color:#ed9366>=</span><span> re</span><span style=color:#ed9366>.</span><span style=color:#f07171>captures</span><span>(</span><span style=color:#ed9366>&</span><span>content) {
</span><span>        </span><span style=color:#fa6e32>let</span><span> doc </span><span style=color:#ed9366>=</span><span> caps[</span><span style=color:#ff8f40>1</span><span>]</span><span style=color:#ed9366>.</span><span style=color:#f07171>trim</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> code </span><span style=color:#ed9366>=</span><span> caps[</span><span style=color:#ff8f40>2</span><span>]</span><span style=color:#ed9366>.</span><span style=color:#f07171>trim</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>()</span><span style=color:#61676ccc>;
</span><span>        (doc</span><span style=color:#61676ccc>,</span><span> code)
</span><span>    } </span><span style=color:#fa6e32>else </span><span>{
</span><span>        (</span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>,</span><span> content)
</span><span>    }
</span><span>}
</span></code></pre><p>This regex-based parser splits files into documentation blocks (using <code>/*! ... */</code> syntax) and remaining code. The website generation then uses these separated components:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>write_web_example_markdown</span><span>(
</span><span>    </span><span style=color:#ff8f40>content_folder</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Path,
</span><span>    </span><span style=color:#ff8f40>example_name</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>,
</span><span>    </span><span style=color:#ff8f40>doc</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>,
</span><span>    </span><span style=color:#ff8f40>code</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>,
</span><span>    </span><span style=color:#ff8f40>api</span><span style=color:#61676ccc>:</span><span> WebApi,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> content </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>    content</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_str</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"# </span><span style=color:#ff8f40>{}</span><span style=color:#4cbf99>\n\n</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> example_name))</span><span style=color:#61676ccc>;
</span><span>    content</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_str</span><span>(doc)</span><span style=color:#61676ccc>;
</span><span>    content</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_str</span><span>(</span><span style=color:#86b300>"</span><span style=color:#4cbf99>\n\n</span><span style=color:#86b300>```rust</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>"</span><span>)</span><span style=color:#61676ccc>;
</span><span>    content</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_str</span><span>(code)</span><span style=color:#61676ccc>;
</span><span>    content</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_str</span><span>(</span><span style=color:#86b300>"</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>```</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>"</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Write to file...
</span><span>}
</span></code></pre><p>Key technical decisions include:<ul><li>Using a non-greedy regex pattern (<code>?s</code> modifier) to handle multi-line comments<li>Preserving original code formatting through direct inclusion in markdown code blocks<li>Falling back to full file content when documentation blocks are missing<li>Maintaining existing CI workflows through command-line argument compatibility</ul><p>The changes impact Bevy’s website generation pipeline by enabling structural improvements to example presentations. Future enhancements could build on this foundation to implement side-by-side documentation/code layouts or interactive code examples.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[Example File] --> B[Docblock Parser]
</span><span>    B --> C[Documentation Content]
</span><span>    B --> D[Example Code]
</span><span>    C --> E[Website Markdown]
</span><span>    D --> E
</span><span>    E --> F[Zola Website Generator]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=file-tools-example-showcase-src-main-rs-25-2>File: <code>tools/example-showcase/src/main.rs</code> (+25/-2)</h3><ol><li><strong>Modification</strong>: Added docblock parsing logic and separated content generation<li><strong>Key Code Addition</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New parsing function
</span><span style=color:#fa6e32>let </span><span>(doc</span><span style=color:#61676ccc>,</span><span> code) </span><span style=color:#ed9366>= </span><span style=color:#f07171>parse_example_doc_and_code</span><span>(</span><span style=color:#ed9366>&</span><span>example_path)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Modified markdown generation
</span><span style=color:#f07171>write_web_example_markdown</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span>content_folder</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>&</span><span>example_name</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>&</span><span>doc</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>&</span><span>code</span><span style=color:#61676ccc>,
</span><span>    api</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Relationship to PR</strong>: Enables structural separation of documentation and code in generated website content</ol><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustdoc/how-to-write-documentation.html target=_blank>Rust Documentation Comments</a><li><a rel="noopener nofollow noreferrer" href=https://www.getzola.org/documentation/content/templates/ target=_blank>Zola Content Templates</a><li><a rel="noopener nofollow noreferrer" href=https://cheatography.com/davechild/cheat-sheets/regular-expressions/ target=_blank>Regular Expressions for Code Parsing</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18191.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>