<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18413 reexport entity set collections in entity module
        
    </title><meta content="#18413 reexport entity set collections in entity module" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18413-zh-cn-20250330>中文</a></div></div><div class=pr-content><h1 id=18413-reexport-entity-set-collections-in-entity-module>#18413 reexport entity set collections in entity module</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: reexport entity set collections in entity module<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18413<li><strong>Author</strong>: Victoronz<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: <code>D-Trivial</code>, <code>A-ECS</code>, <code>C-Code-Quality</code>, <code>S-Ready-For-Final-Review</code></ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Unlike for their helper typers, the import paths for <code>unique_array::UniqueEntityArray</code>, <code>unique_slice::UniqueEntitySlice</code>, <code>unique_vec::UniqueEntityVec</code>, <code>hash_set::EntityHashSet</code>, <code>hash_map::EntityHashMap</code>, <code>index_set::EntityIndexSet</code>, <code>index_map::EntityIndexMap</code> are quite redundant.<p>When looking at the structure of <code>hashbrown</code>, we can also see that while both <code>HashSet</code> and <code>HashMap</code> have their own modules, the main types themselves are re-exported to the crate level.<h2 id=solution>Solution</h2><p>Re-export the types in their shared <code>entity</code> parent module, and simplify the imports where they’re used.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a code organization issue in Bevy’s ECS module where entity collection types had unnecessarily verbose import paths. While these collections were logically grouped in submodules, developers needed to reference deep module paths like <code>bevy_ecs::entity::hash_set::EntityHashSet</code> instead of accessing them directly from the parent entity module.<p>The solution takes inspiration from Rust’s common practice of re-exporting key types at higher module levels, similar to how hashbrown exports its main collections at the crate root. By adding <code>pub use</code> statements in <code>entity/mod.rs</code>, the PR flattens the import structure:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before in consumer code
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>hash_set</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span></code></pre><p>This change required updating import statements across multiple files that used these collections. For example, in <code>entity_hash.rs</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>hash_set</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span></code></pre><p>The implementation follows these key steps:<ol><li><strong>Centralized exports</strong>: Added re-exports in <code>entity/mod.rs</code> for 8 collection types<li><strong>Import cleanup</strong>: Updated 25+ import statements across the codebase<li><strong>API consistency</strong>: Aligned with existing patterns for type accessibility</ol><p>Notably, the PR preserves all existing type implementations while making them more discoverable. The technical trade-off here is slightly increased coupling in the module structure vs improved ergonomics for consumers.<p>The changes particularly benefit developers working with multiple entity collection types, reducing cognitive overhead from long import paths. This aligns with Rust’s philosophy of making common types easily accessible while keeping implementation details modularized.<h2 id=key-files-changed>Key Files Changed</h2><h3 id=file-crates-bevy-ecs-src-entity-mod-rs>File: <code>crates/bevy_ecs/src/entity/mod.rs</code></h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added re-exports
</span><span style=color:#fa6e32>pub use </span><span>unique_array</span><span style=color:#ed9366>::</span><span>UniqueEntityArray</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>unique_slice</span><span style=color:#ed9366>::</span><span>UniqueEntitySlice</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>unique_vec</span><span style=color:#ed9366>::</span><span>UniqueEntityVec</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>hash_set</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>hash_map</span><span style=color:#ed9366>::</span><span>EntityHashMap</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>index_set</span><span style=color:#ed9366>::</span><span>EntityIndexSet</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>index_map</span><span style=color:#ed9366>::</span><span>EntityIndexMap</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=file-benches-benches-bevy-ecs-world-entity-hash-rs>File: <code>benches/benches/bevy_ecs/world/entity_hash.rs</code></h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>hash_set</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=file-crates-bevy-core-pipeline-src-oit-resolve-mod-rs>File: <code>crates/bevy_core_pipeline/src/oit/resolve/mod.rs</code></h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>hash_map</span><span style=color:#ed9366>::</span><span>EntityHashMap</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>hash_set</span><span style=color:#ed9366>::</span><span>EntityHashSet</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>{EntityHashMap</span><span style=color:#61676ccc>,</span><span> EntityHashSet}</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    entity_module[entity/mod.rs] -->|reexports| EntityHashSet
</span><span>    entity_module -->|reexports| EntityHashMap
</span><span>    entity_module -->|reexports| UniqueEntityVec
</span><span>    EntityHashSet -.-> hash_set_module[hash_set.rs]
</span><span>    EntityHashMap -.-> hash_map_module[hash_map.rs]
</span><span>    UniqueEntityVec -.-> unique_vec_module[unique_vec.rs]
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li>Rust Module System: https://doc.rust-lang.org/book/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html<li>Bevy ECS Design: https://bevyengine.org/learn/book/plugins/ecs/<li>Rust API Guidelines on Re-exports: https://rust-lang.github.io/api-guidelines/necessities.html#crate-reexports-important</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18413.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>