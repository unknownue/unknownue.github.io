<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18282 Update gamepad_viewer to use children macro
        
    </title><meta content="#18282 Update gamepad_viewer to use children macro" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-13</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18282-zh-cn-20250313>中文</a></div></div><div class=pr-content><h1 id=18282-update-gamepad-viewer-to-use-children-macro>#18282 Update gamepad_viewer to use children macro</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update gamepad_viewer to use children macro<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18282<li><strong>Author</strong>: krunchington<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-03-12T21:25:04Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Contributes to #18238 Updates the <code>gamepad_viewer</code>, example to use the <code>children!</code> macro.<h2 id=solution>Solution</h2><p>Updates examples to use the Improved Spawning API merged in https://github.com/bevyengine/bevy/pull/17521<h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? <ul><li>Opened the examples before and after and verified the same behavior was observed. I did this on Ubuntu 24.04.2 LTS using <code>--features wayland</code>.</ul><li>Are there any parts that need more testing? <ul><li>Other OS’s and features can’t hurt, but this is such a small change it shouldn’t be a problem.</ul><li>How can other people (reviewers) test your changes? Is there anything specific they need to know? <ul><li>Run the examples yourself with and without these changes.</ul><li>If relevant, what platforms did you test these changes on, and are there any important ones you can’t test? <ul><li>see above</ul></ul><hr><h2 id=showcase>Showcase</h2><p>n/a<h2 id=migration-guide>Migration Guide</h2><p>n/a<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses technical debt in Bevy’s example code by modernizing entity spawning patterns. The gamepad_viewer example, which demonstrates controller input visualization, previously used legacy methods for constructing UI hierarchies. With the recent introduction of Bevy’s Improved Spawning API in PR #17521, an opportunity existed to simplify the example’s code structure.<p>The core issue stemmed from verbose child entity management. Previous implementations required nested closures and explicit parent commands:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(NodeBundle {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>})</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_children</span><span>(|</span><span style=color:#ff8f40>parent</span><span>| {
</span><span>    parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(TextBundle {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// More nested children
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><p>This approach created pyramid-shaped code structures that became harder to read as UI complexity increased. The new children! macro enables a flatter, more declarative syntax:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    NodeBundle {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f07171>children!</span><span>[
</span><span>        TextBundle {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Additional children
</span><span>    ]
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><p>The migration involved restructuring UI element creation to leverage the macro’s capabilities. Key changes included:<ol><li>Eliminating nested with_children calls<li>Converting individual spawn commands into children! entries<li>Combining component bundles with the children macro in single spawn calls</ol><p>By adopting the new macro, the example gained several advantages:<ul><li>Reduced line count (-17 net lines)<li>Improved readability through hierarchical visualization<li>Stronger type checking during compilation<li>Better alignment with modern Bevy patterns</ul><p>Testing focused on visual verification of the gamepad viewer’s functionality across different input states. The author confirmed identical rendering behavior before and after changes using Ubuntu’s Wayland implementation, while suggesting cross-platform validation as optional due to the change’s localized impact.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[gamepad_viewer Example] --> B[UI Hierarchy]
</span><span>    B --> C[Root Node]
</span><span>    C --> D[Children Macro]
</span><span>    D --> E[Axis Display]
</span><span>    D --> F[Button Grid]
</span><span>    F --> G[Individual Buttons]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ul><li><code>examples/tools/gamepad_viewer.rs</code> (+98/-115)</ul><p><strong>Key Changes:</strong><ol><li>UI construction migrated from nested closures to children! macro<li>Entity spawning consolidated into single commands.spawn calls<li>Improved component organization through tuple grouping</ol><p>Example transformation:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(NodeBundle {
</span><span>    style</span><span style=color:#61676ccc>:</span><span> Style {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>})</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_children</span><span>(|</span><span style=color:#ff8f40>parent</span><span>| {
</span><span>    parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(TextBundle {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    NodeBundle {
</span><span>        style</span><span style=color:#61676ccc>:</span><span> Style {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f07171>children!</span><span>[
</span><span>        TextBundle {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        }
</span><span>    ]
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/17521 target=_blank>Bevy Improved Spawning API PR #17521</a><li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/ui/ui.html target=_blank>Bevy UI Tutorial: Basic Concepts</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch19-06-macros.html target=_blank>Rust Macro Documentation</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18282.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>