<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18248 make various entity wrapper type modules public
        
    </title><meta content="#18248 make various entity wrapper type modules public" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-11</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18248-zh-cn-20250311>中文</a></div></div><div class=pr-content><h1 id=18248-make-various-entity-wrapper-type-modules-public>#18248 make various entity wrapper type modules public</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: make various entity wrapper type modules public<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18248<li><strong>Author</strong>: Victoronz<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-03-11T02:58:10Z<li><strong>Merged</strong>: 2025-03-11T05:12:34Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Part of the #16547 series.<p>The entity wrapper types often have some associated types an aliases with them that cannot be re-exported into an outer module together. Some helper types are best used with part of their path: <code>bevy::ecs::entity::index_set::Slice</code> as <code>index_set::Slice</code>. This has already been done for <code>entity::hash_set</code> and <code>entity::hash_map</code>.<h2 id=solution>Solution</h2><p>Publicize the <code>index_set</code>, <code>index_map</code>, <code>unique_vec</code>, <code>unique_slice</code>, and <code>unique_array</code> modules.<h2 id=migration-guide>Migration Guide</h2><p>Any mention or import of types in the affected modules have to add the respective module name to the import path. F.e.: <code>bevy::ecs::entity::EntityIndexSet</code> -> <code>bevy::ecs::entity::index_set::EntityIndexSet</code><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a structural challenge in Bevy’s ECS module organization where entity wrapper types and their associated utilities couldn’t be properly exposed through standard re-exports. Prior to this change, developers faced ergonomic issues when trying to access helper types like <code>Slice</code> from <code>index_set</code>, which were buried in non-public modules.<p>The core problem stemmed from Rust’s module visibility rules and type aliasing limitations. While some modules like <code>hash_set</code> and <code>hash_map</code> had already been properly exposed, similar treatment was needed for five other utility modules containing specialized collection types used in entity management. These modules contained implementation details that couldn’t be cleanly re-exported at the parent module level.<p>The solution adopted straightforward module visibility adjustments. By changing the module declarations from private to public in <code>entity/mod.rs</code>, developers gained direct access to these implementation details while maintaining logical grouping. For example:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Non-public module
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>index_set</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Public module
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>index_set</span><span style=color:#61676ccc>;
</span></code></pre><p>This change required updating import paths throughout the codebase, as seen in the migration guide. The approach follows Rust best practices for module design, where implementation details are exposed through their natural module hierarchy rather than artificial re-exports.<p>The implementation required careful consideration of API surface exposure. By making these modules public rather than re-exporting their contents, the PR:<ol><li>Maintains clear boundaries between different collection types<li>Avoids namespace pollution at the parent module level<li>Preserves internal type relationships through natural module paths</ol><p>Key technical trade-offs included accepting slightly longer import paths in exchange for clearer module organization and better encapsulation of implementation details. This aligns with Bevy’s evolving API design philosophy observed in prior similar changes to <code>hash_set</code> and <code>hash_map</code>.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    entity[entity module] --> index_set
</span><span>    entity --> index_map
</span><span>    entity --> unique_vec
</span><span>    entity --> unique_slice
</span><span>    entity --> unique_array
</span><span>    
</span><span>    index_set --> EntityIndexSet
</span><span>    index_map --> EntityIndexMap
</span><span>    unique_vec --> EntityUniqueVec
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><strong>crates/bevy_ecs/src/entity/mod.rs</strong> (+5/-16)</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>index_set</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>index_map</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>unique_vec</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>unique_slice</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>unique_array</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>index_set</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>index_map</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>unique_vec</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>unique_slice</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>unique_array</span><span style=color:#61676ccc>;
</span></code></pre><p>Removed redundant re-exports and exposed implementation modules directly. This change cascaded through dependent modules that needed updated imports.<ol start=2><li><strong>crates/bevy_ecs/src/entity/unique_array.rs</strong> (+9/-1)</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added public visibility to module items
</span><span style=color:#ed9366>+ </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#ed9366>+ </span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>EntityUniqueArray</span><span><</span><span style=color:#fa6e32>const</span><span> N</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>> {
</span></code></pre><p>Adjusted visibility modifiers to match new public module exposure requirements.<ol start=3><li><strong>crates/bevy_ecs/src/entity/index_map.rs</strong> (+4/-0)</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#ed9366>+ </span><span style=color:#abb0b6;font-style:italic>/// New documentation exposing public API
</span><span style=color:#ed9366>+ </span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>EntityIndexMap </span><span>{
</span><span style=color:#ed9366>+     </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{ </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}
</span><span style=color:#ed9366>+ </span><span>}
</span></code></pre><p>Added missing documentation required for newly public API surface.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch07-02-defining-modules-to-control-scope-and-privacy.html target=_blank>Rust Module System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/plugins/ecs/ target=_blank>Bevy ECS Architecture Guide</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/ target=_blank>API Design Guidelines for Module Structure</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18248.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>