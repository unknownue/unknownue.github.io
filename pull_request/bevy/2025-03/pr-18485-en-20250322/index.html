<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18485 Fix `clippy::unnecessary-literal-unwrap` in `bevy_time`
        
    </title><meta content="#18485 Fix `clippy::unnecessary-literal-unwrap` in `bevy_time`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18485-zh-cn-20250322>中文</a></div></div><div class=pr-content><h1 id=18485-fix-clippy-unnecessary-literal-unwrap-in-bevy-time>#18485 Fix <code>clippy::unnecessary-literal-unwrap</code> in <code>bevy_time</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix <code>clippy::unnecessary-literal-unwrap</code> in <code>bevy_time</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18485<li><strong>Author</strong>: villor<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-03-22T13:05:46Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Compiling <code>bevy_time</code> without the <code>std</code>-feature results in a <code>clippy::unnecessary-literal-unwrap</code>.</ul><h2 id=solution>Solution</h2><ul><li>Fix lint error</ul><h2 id=testing>Testing</h2><ul><li>CI</ul><hr><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The core issue stemmed from a Clippy lint warning (<code>unnecessary-literal-unwrap</code>) that appeared when compiling Bevy’s time module without the standard library feature. This warning indicated a potentially dangerous pattern where code was explicitly unwrapping a Result/Option containing a literal value, which could be simplified or made safer.<p>In the original implementation, the time system contained this problematic pattern:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>time</span><span style=color:#ed9366>.</span><span>accumulated </span><span style=color:#ed9366>= </span><span>Duration</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#ed9366>.</span><span style=color:#f07171>checked_sub</span><span>(delta)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><p>Here, <code>Duration::ZERO.checked_sub(delta)</code> attempts to subtract a duration from zero duration. When <code>delta</code> is non-zero, this operation would normally return <code>None</code>, but the code path in question only executed when <code>delta == Duration::ZERO</code>. This made the <code>.unwrap()</code> technically safe but triggered Clippy’s warning about unnecessary unwrapping of literal values.<p>The solution required two key realizations:<ol><li>The <code>checked_sub</code> operation was redundant in this specific context since <code>delta</code> was guaranteed to be zero<li>The <code>unwrap</code> added no value while introducing a potential maintenance hazard</ol><p>The fix simplified the code to:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>time</span><span style=color:#ed9366>.</span><span>accumulated </span><span style=color:#ed9366>=</span><span> delta</span><span style=color:#61676ccc>;
</span></code></pre><p>This change eliminated the unnecessary operation while maintaining identical behavior. By directly assigning <code>delta</code> (which equals <code>Duration::ZERO</code> in this code path), the implementation became more efficient and Clippy-compliant.<p>The impact of this change is primarily seen in non-standard environments (e.g., embedded systems or WASM targets) where Bevy might be compiled without the standard library. These environments benefit from stricter lint enforcement to catch genuine errors early. The fix demonstrates the importance of regularly auditing code for linter warnings, even when they appear harmless in isolation.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[TimePlugin] --> B[TimeSystem]
</span><span>    B --> C[time_system]
</span><span>    C --> D[Duration Handling]
</span><span>    D --> E[Fixed: unnecessary-literal-unwrap]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=file-crates-bevy-time-src-lib-rs>File: <code>crates/bevy_time/src/lib.rs</code></h3><p><strong>Changes</strong>: Fixed a Clippy warning in time accumulation logic<p>Before:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>time</span><span style=color:#ed9366>.</span><span>accumulated </span><span style=color:#ed9366>= </span><span>Duration</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#ed9366>.</span><span style=color:#f07171>checked_sub</span><span>(delta)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>time</span><span style=color:#ed9366>.</span><span>accumulated </span><span style=color:#ed9366>=</span><span> delta</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Relationship to PR</strong>: This was the central change addressing the Clippy warning. The modification simplified duration handling while maintaining identical behavior in the specific code path where <code>delta</code> equals zero duration.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/stable/clippy/lints/unnecessary-literal-unwrap.html target=_blank>Clippy Documentation: <code>unnecessary-literal-unwrap</code></a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/time/ target=_blank>Bevy Engine Time Management</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/option/#method.unwrap target=_blank>Rust Option/Result Best Practices</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18485.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>