<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18292 Update custom_transitions and sub_states examples to use children macro
        
    </title><meta content="#18292 Update custom_transitions and sub_states examples to use children macro" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-13</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18292-zh-cn-20250313>中文</a></div></div><div class=pr-content><h1 id=18292-update-custom-transitions-and-sub-states-examples-to-use-children-macro>#18292 Update custom_transitions and sub_states examples to use children macro</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update custom_transitions and sub_states examples to use children macro<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18292<li><strong>Author</strong>: krunchington<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-03-13T02:52:59Z<li><strong>Merged</strong>: 2025-03-14T09:15:23Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Contributes to #18238<br> Updates the <code>custom_transitions</code> and <code>sub_states</code> examples to use the <code>children!</code> macro.<h2 id=solution>Solution</h2><p>Updates examples to use the Improved Spawning API merged in https://github.com/bevyengine/bevy/pull/17521<h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? <ul><li>Opened the examples before and after and verified the same behavior was observed. I did this on Ubuntu 24.04.2 LTS using <code>--features wayland</code>.</ul><li>Are there any parts that need more testing? <ul><li>Other OS’s and features can’t hurt, but this is such a small change it shouldn’t be a problem.</ul><li>How can other people (reviewers) test your changes? Is there anything specific they need to know? <ul><li>Run the examples yourself with and without these changes.</ul><li>If relevant, what platforms did you test these changes on, and are there any important ones you can’t test? <ul><li>see above</ul></ul><hr><h2 id=showcase>Showcase</h2><p>n/a<h2 id=migration-guide>Migration Guide</h2><p>n/a<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses technical debt in Bevy’s example code by modernizing entity spawning patterns. The core issue stemmed from examples using outdated APIs for creating entity hierarchies, following the merge of a new spawning system in Bevy 0.13 (#17521). The <code>children!</code> macro introduced in that PR provided a more ergonomic way to create parent-child entity relationships, but existing examples hadn’t been updated to demonstrate this preferred approach.<p>The changes focus on two state management examples that involve UI hierarchy construction. Previously, these examples used manual child entity management through explicit <code>add_child</code> calls. The updated implementation leverages the <code>children!</code> macro to declare child relationships directly during parent entity creation, resulting in more concise and readable code.<p>In <code>sub_states.rs</code>, the menu construction was refactored from:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> menu </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(NodeBundle { </span><span style=color:#ed9366>... </span><span>})</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> resume_button </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((ButtonBundle { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>,</span><span> ResumeButton))</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>;
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(menu)</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_child</span><span>(resume_button)</span><span style=color:#61676ccc>;
</span></code></pre><p>To the more declarative:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    NodeBundle { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f07171>children!</span><span>[
</span><span>        (ButtonBundle { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>,</span><span> ResumeButton)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Other child elements
</span><span>    ]
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><p>This pattern eliminates intermediate entity IDs and makes the parent-child relationships immediately visible. Similar transformations were applied to <code>custom_transitions.rs</code>, where nested UI elements benefited from the hierarchical macro syntax.<p>The primary technical consideration was maintaining identical runtime behavior while improving code quality. By using the macro’s compile-time checks, the changes reduce potential for entity parenting errors. The PR follows Bevy’s established patterns for API migrations, ensuring examples demonstrate current best practices to users.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[State Examples] --> B[sub_states.rs]
</span><span>    A --> C[custom_transitions.rs]
</span><span>    B --> D[children! Macro]
</span><span>    C --> D
</span><span>    D --> E[Improved Spawning API]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><code>examples/state/sub_states.rs</code> (+57/-66)</ol><ul><li>Updated menu construction to use hierarchical spawning<li>Removed manual child entity management<li>Simplified UI element relationships through macro</ul><ol start=2><li><code>examples/state/custom_transitions.rs</code> (+29/-32)</ol><ul><li>Refactored pause menu creation<li>Replaced push_children with children! macro<li>Streamlined transition system setup</ul><p>Example diff:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> parent </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(NodeBundle { </span><span style=color:#ed9366>... </span><span>})</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> child </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(TextBundle { </span><span style=color:#ed9366>... </span><span>})</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>;
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(parent)</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_child</span><span>(child)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    NodeBundle { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f07171>children!</span><span>[(TextBundle { </span><span style=color:#ed9366>... </span><span>})]
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/17521 target=_blank>Bevy’s Improved Spawning API PR (#17521)</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/ecs/system/struct.EntityCommands.html target=_blank>Entity Commands Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/ui/hierarchy.html target=_blank>Bevy UI Hierarchy Guide</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18292.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>