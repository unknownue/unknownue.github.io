<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18240 Add more to the 2d testbed for text
        
    </title><meta content="#18240 Add more to the 2d testbed for text" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18240-zh-cn-20250310>中文</a></div></div><div class=pr-content><h1 id=18240-add-more-to-the-2d-testbed-for-text>#18240 Add more to the 2d testbed for text</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add more to the 2d testbed for text<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18240<li><strong>Author</strong>: rparrett<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-03-10T20:13:36Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p><code>Text2d</code> testing hasn’t been as thorough as text in the UI, and it suffered a bunch of bugs / perf issues in recent cycles.<h2 id=solution>Solution</h2><p>Add some more <code>Text2d</code> scenarios to the 2d testbed to catch bugs, testing bounded and unbounded text with various justification.<h2 id=testing>Testing</h2><p><code>cargo run --example testbed_2d</code> (press space a few times)</p><img alt="Screenshot 2025-03-10 at 1 02 03 PM" src=https://github.com/user-attachments/assets/1e4ee39c-809b-4cc6-81bd-68e67b9625b5 width=1280><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a gap in Bevy’s testing infrastructure for 2D text rendering. While UI text had robust test coverage, the Text2d component used in spatial rendering lacked equivalent validation. This discrepancy became apparent when several performance issues and rendering bugs surfaced in recent development cycles related to bounded text and text justification.<p>The core implementation strategy focuses on expanding Bevy’s existing 2D testbed example to include multiple text rendering scenarios. The developer added three distinct test cases:<ol><li>Unbounded text with different horizontal justifications<li>Bounded text with constrained dimensions<li>Complex combinations of justification and wrapping</ol><p>These scenarios were designed to validate:<ul><li>Proper text alignment implementation<li>Correct bounding box calculations<li>Word wrapping behavior<li>Performance characteristics under constrained conditions</ul><p>The testbed was modified to cycle through these scenarios using the spacebar, allowing visual inspection of rendering correctness. Each test case spawns multiple text entities with varying properties to stress different aspects of the text rendering system.<p>Key technical decisions included:<ul><li>Positioning text entities at different vertical levels for clear visual separation<li>Using multiple justification types (Left, Center, Right) in a single view<li>Implementing constrained bounding boxes with explicit width/height values<li>Maintaining backward compatibility with existing testbed controls</ul><p>This approach provides immediate visual feedback for developers working on text rendering features, while creating automated testing opportunities through screenshot comparison in future CI pipelines.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    Testbed[2D Testbed] --> Scenario1[Unbounded Justification]
</span><span>    Testbed --> Scenario2[Bounded Text]
</span><span>    Testbed --> Scenario3[Complex Combinations]
</span><span>    Scenario1 --> Left[Left Justify]
</span><span>    Scenario1 --> Center[Center Justify]
</span><span>    Scenario1 --> Right[Right Justify]
</span><span>    Scenario2 --> Wrapping[Text Wrapping]
</span><span>    Scenario2 --> Constrained[Constrained Bounds]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-testbed-2d-rs-102-9><code>examples/testbed/2d.rs</code> (+102/-9)</h3><p>This file contains the main testbed implementation. The changes introduce new text rendering scenarios and enhance the existing test structure.<p>Key additions:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example of bounded text setup
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Text2dBundle {
</span><span>    text</span><span style=color:#61676ccc>: </span><span>Text</span><span style=color:#ed9366>::</span><span>from_section(
</span><span>        </span><span style=color:#86b300>"Bounded text</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>line two</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>line three"</span><span style=color:#61676ccc>,
</span><span>        TextStyle { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_alignment</span><span>(TextAlignment</span><span style=color:#ed9366>::</span><span>Center)</span><span style=color:#61676ccc>,
</span><span>    text_bound</span><span style=color:#61676ccc>: </span><span>TextBounding</span><span style=color:#ed9366>::</span><span>new(
</span><span>        BoundedMeasurements {
</span><span>            width</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>300.0</span><span style=color:#61676ccc>,
</span><span>            height</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>100.0</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    )</span><span style=color:#61676ccc>,
</span><span>    transform</span><span style=color:#61676ccc>: </span><span>Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>100.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>50.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Justification comparison setup
</span><span style=color:#fa6e32>for </span><span>(i</span><span style=color:#61676ccc>,</span><span> alignment) </span><span style=color:#ed9366>in </span><span>[Left</span><span style=color:#61676ccc>,</span><span> Center</span><span style=color:#61676ccc>,</span><span> Right]</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>enumerate</span><span>() {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Text2dBundle {
</span><span>        text</span><span style=color:#61676ccc>: </span><span>Text</span><span style=color:#ed9366>::</span><span>from_section(
</span><span>            </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{alignment:?}</span><span style=color:#86b300> justified text"</span><span>)</span><span style=color:#61676ccc>,
</span><span>            TextStyle { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>,
</span><span>        )</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_alignment</span><span>(</span><span style=color:#ed9366>*</span><span>alignment)</span><span style=color:#61676ccc>,
</span><span>        transform</span><span style=color:#61676ccc>: </span><span>Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span style=color:#ff8f40>50.0 </span><span style=color:#ed9366>*</span><span> i </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>These changes enable simultaneous testing of multiple text configurations, making it easier to compare rendering outcomes and identify alignment issues.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/text/ target=_blank>Bevy Text Rendering Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://www.w3.org/TR/css-text-3/#line-breaking target=_blank>Text Wrapping Algorithms</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/examples#examples target=_blank>Bevy Testbed Architecture</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18240.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>