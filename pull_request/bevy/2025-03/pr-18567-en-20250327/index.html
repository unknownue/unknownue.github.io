<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18567 Revert PR #15481 to resolve a regression.
        
    </title><meta content="#18567 Revert PR #15481 to resolve a regression." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-27</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18567-zh-cn-20250327>中文</a></div></div><div class=pr-content><h1 id=18567-revert-pr-15481-to-resolve-a-regression>#18567 Revert PR #15481 to resolve a regression.</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Revert PR #15481 to resolve a regression.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18567<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: <code>A-Assets</code>, <code>D-Straightforward</code>, <code>S-Needs-Review</code><li><strong>Created</strong>: 2025-03-27T00:22:10Z<li><strong>Merged</strong>: 2025-03-27T05:12:34Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #18010.</ul><h2 id=solution>Solution</h2><ul><li>Revert the offending PRs! These are #15481 and #18013. We now no longer get an error if there are duplicate subassets.<li>In theory we could untangle #18013 from #15481, but that may be tricky, and may still introduce regressions. To avoid this worry (since we’re already in RC mode), I am just reverting both.</ul><h2 id=testing>Testing</h2><ul><li>This is just a revert.</ul><hr><h2 id=migration-guide>Migration Guide</h2><p>&LTRemove the migration guides for #15481 and #18013><p>I will make a PR to the bevy_website repo after this is merged.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a regression introduced by two previous changes (#15481 and #18013) that caused errors when assets contained duplicate subasset names. The core issue manifested as runtime errors when loading assets with identically named subassets, breaking existing workflows that previously worked without validation.<p>The regression occurred because #15481 introduced stricter asset path validation, while #18013 added additional asset processing infrastructure. Together these changes enforced unique naming constraints that weren’t present before. While preventing duplicate subassets might seem desirable, it broke backward compatibility and existing asset pipelines that relied on this flexibility.<p>The solution implements a straightforward revert of both PRs. This approach was chosen over partial fixes because:<ol><li>The project was in Release Candidate (RC) phase, prioritizing stability<li>The changes were tightly coupled, making isolation difficult<li>Quick resolution was needed to unblock users</ol><p>Key technical aspects of the revert include:<ol><li>Removal of duplicate subasset validation checks<li>Restoring previous asset loading behavior<li>Eliminating new error conditions around asset naming</ol><p>The implementation required careful rollback of changes across multiple subsystems:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example from crates/bevy_asset/src/loader.rs (simplified)
</span><span style=color:#abb0b6;font-style:italic>// Before revert:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>load_labeled_asset</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>label</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span>&LTHandle&LTA>, AssetLoadError> {
</span><span>    </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>labeled_assets</span><span style=color:#ed9366>.</span><span style=color:#f07171>contains_key</span><span>(label) {
</span><span>        </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(AssetLoadError</span><span style=color:#ed9366>::</span><span>DuplicateSubAsset { label</span><span style=color:#61676ccc>:</span><span> label</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>() })</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... loading logic ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After revert:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>load_labeled_asset</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>label</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>) </span><span style=color:#61676ccc>-> </span><span>Handle&LTA> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// No duplicate checking
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... loading logic ...
</span><span>}
</span></code></pre><p>This change removes the error condition while preserving the core asset loading functionality. The trade-off allows duplicate subassets but restores previous working behavior for users.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Asset Loading System] --> B[Subasset Validation]
</span><span>    B --> C[Error on Duplicates]
</span><span>    D[PR #18567] --> E[Remove Validation]
</span><span>    E --> F[Restore Previous Behavior]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-gltf-src-loader-mod-rs-219-241><code>crates/bevy_gltf/src/loader/mod.rs</code> (+219/-241)</h3><ul><li>Reverted GLTF loader changes from original PRs<li>Removed duplicate subasset name checking<li>Restored previous mesh and material handling</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let mut</span><span> named_materials </span><span style=color:#ed9366>= </span><span>HashMap</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>for</span><span> material </span><span style=color:#ed9366>in</span><span> materials {
</span><span>    </span><span style=color:#fa6e32>if</span><span> named_materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>contains_key</span><span>(</span><span style=color:#ed9366>&</span><span>name) {
</span><span>        </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(GltfError</span><span style=color:#ed9366>::</span><span>DuplicateAssetName(name))</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    named_materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(name</span><span style=color:#61676ccc>,</span><span> handle)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: 
</span><span style=color:#fa6e32>let mut</span><span> named_materials </span><span style=color:#ed9366>= </span><span>HashMap</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>for</span><span> material </span><span style=color:#ed9366>in</span><span> materials {
</span><span>    named_materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(name</span><span style=color:#61676ccc>,</span><span> handle)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// No duplicate check
</span><span>}
</span></code></pre><h3 id=crates-bevy-asset-src-loader-rs-56-145><code>crates/bevy_asset/src/loader.rs</code> (+56/-145)</h3><ul><li>Removed asset validation infrastructure<li>Simplified loader interfaces</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load_labeled_asset</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>label</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span>&LTHandle&LTA>, AssetLoadError> { </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load_labeled_asset</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>label</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span>Handle&LTA> { </span><span style=color:#ed9366>... </span><span>}
</span></code></pre><h3 id=crates-bevy-asset-src-transformer-rs-110-9><code>crates/bevy_asset/src/transformer.rs</code> (+110/-9)</h3><ul><li>Restored previous transformation logic<li>Removed metadata checks</ul><h3 id=crates-bevy-asset-src-lib-rs-3-48><code>crates/bevy_asset/src/lib.rs</code> (+3/-48)</h3><ul><li>Updated documentation to reflect removed validation<li>Removed references to duplicate checking</ul><h3 id=crates-bevy-asset-src-saver-rs-13-9><code>crates/bevy_asset/src/saver.rs</code> (+13/-9)</h3><ul><li>Simplified asset saving paths<li>Removed associated error conditions</ul><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/18010 target=_blank>Original Issue #18010</a> - Details the regression symptoms<li><a rel="noopener nofollow noreferrer" href=https://www.martinfowler.com/articles/revertNotRewrite.html target=_blank>Revert Best Practices</a> - Martin Fowler on strategic reverting<li><a rel="noopener nofollow noreferrer" href=https://semver.org/ target=_blank>Semantic Versioning</a> - Context on RC phase constraints<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/assets/ target=_blank>Asset System Documentation</a> - Bevy’s asset handling fundamentals</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18567.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>