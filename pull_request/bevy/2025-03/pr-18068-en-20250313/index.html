<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18068 RPC Discover endpoint with basic informations
        
    </title><meta content="#18068 RPC Discover endpoint with basic informations" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-13</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18068-zh-cn-20250313>中文</a></div></div><div class=pr-content><h1 id=18068-rpc-discover-endpoint-with-basic-informations>#18068 RPC Discover endpoint with basic informations</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: RPC Discover endpoint with basic informations<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18068<li><strong>Author</strong>: Leinnan<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-02-27T10:07:10Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>It does not resolves issue for full support for OpenRPC for <code>bevy_remote</code>, but it is a first step in that direction. Connected to the #16744 issue.<h2 id=solution>Solution</h2><ul><li>Adds <code>rpc.discover</code> endpoint to the bevy_remote which follows https://spec.open-rpc.org/#openrpc-document For now in methods array only the name, which is the endpoint address is populated.<li>Moves json_schema structs into new module inside <code>bevy_remote</code>.</ul><h2 id=testing>Testing</h2><p>Tested the commands by running the BRP sample( cargo run –example server –features=“bevy_remote”) and with these curl command:<pre class=language-sh data-lang=sh style=color:#61676c;background-color:#fafafa><code class=language-sh data-lang=sh><span style=color:#f29718>curl</span><span style=color:#ff8f40> -X</span><span> POST</span><span style=color:#ff8f40> -d </span><span style=color:#86b300>'{ "jsonrpc": "2.0", "id": 1, "method": "rpc.discover"}'</span><span> 127.0.0.1:15702 </span><span style=color:#ed9366>| </span><span style=color:#f29718>jq</span><span> .
</span></code></pre><p>The output is:<pre class=language-json data-lang=json style=color:#61676c;background-color:#fafafa><code class=language-json data-lang=json><span>{
</span><span>  </span><span style=color:#86b300>"jsonrpc"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"2.0"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"id"</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"result"</span><span style=color:#61676ccc>: </span><span>{
</span><span>    </span><span style=color:#86b300>"info"</span><span style=color:#61676ccc>: </span><span>{
</span><span>      </span><span style=color:#86b300>"title"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"Bevy Remote Protocol"</span><span style=color:#61676ccc>,
</span><span>      </span><span style=color:#86b300>"version"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"0.16.0-dev"
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"methods"</span><span style=color:#61676ccc>: </span><span>[
</span><span>      {
</span><span>        </span><span style=color:#86b300>"name"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"bevy/mutate_component"</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#86b300>"params"</span><span style=color:#61676ccc>: </span><span>[]
</span><span>      }</span><span style=color:#61676ccc>,
</span><span>      </span><span style=color:#abb0b6;font-style:italic>// ... (multiple method entries omitted for brevity)
</span><span>      {
</span><span>        </span><span style=color:#86b300>"name"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"rpc.discover"</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#86b300>"params"</span><span style=color:#61676ccc>: </span><span>[]
</span><span>      }
</span><span>    ]</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"openrpc"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"1.3.2"</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"servers"</span><span style=color:#61676ccc>: </span><span>[
</span><span>      {
</span><span>        </span><span style=color:#86b300>"name"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"Server"</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#86b300>"url"</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"127.0.0.1:15702"
</span><span>      }
</span><span>    ]
</span><span>  }
</span><span>}
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a foundational need in Bevy’s remote protocol implementation by introducing service discovery capabilities. Prior to this change, clients interacting with Bevy’s RPC system had no standardized way to discover available endpoints, requiring hardcoded knowledge of method names and parameters.<p>The core implementation follows OpenRPC specifications, starting with basic compliance by exposing method names through a new <code>rpc.discover</code> endpoint. The solution demonstrates several key engineering decisions:<ol><li><p><strong>Structural Organization</strong>: Existing JSON schema definitions were extracted from <code>builtin_methods.rs</code> into dedicated modules (<code>schemas/json_schema.rs</code> and <code>schemas/open_rpc.rs</code>), reducing file size by 90% (from 531 to 47 lines) in the original location while improving code maintainability.</p><li><p><strong>Discovery Endpoint Implementation</strong>: The new endpoint handler constructs an OpenRPC-compliant response containing:</p> <ul><li>Protocol version information<li>Server connection details<li>List of all available RPC methods</ul><li><p><strong>Incremental Approach</strong>: While currently only populating method names, the structure allows future expansion to include parameter schemas, return types, and error definitions as specified by OpenRPC.</p></ol><p>The technical implementation leverages Rust’s type system through several key structs:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In schemas/open_rpc.rs
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>OpenRpcDocument </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>openrpc</span><span style=color:#61676ccc>:</span><span> String,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>info</span><span style=color:#61676ccc>:</span><span> InfoObject,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>servers</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTServerObject>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>methods</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTMethodObject>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In schemas/json_schema.rs
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SchemaObject </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>schema</span><span style=color:#61676ccc>:</span><span> String,
</span><span>    </span><span style=color:#fa6e32>pub</span><span> r#ref</span><span style=color:#61676ccc>:</span><span> String,
</span><span>}
</span></code></pre><p>Testing was performed through direct HTTP requests using curl, verifying that the endpoint returns the expected structure with all existing Bevy RPC methods plus the new discovery endpoint itself.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[RPC Client] -->|Discovery Request| B[rpc.discover]
</span><span>    B --> C[OpenRpcDocument]
</span><span>    C --> D[MethodObject List]
</span><span>    D --> E[Existing Bevy Methods]
</span><span>    C --> F[ServerObject]
</span><span>    C --> G[InfoObject]
</span><span>    E --> H[Future Schema Expansion]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><strong>crates/bevy_remote/src/builtin_methods.rs</strong> (-531/+47) <ul><li>Removed JSON schema definitions<li>Added discovery endpoint registration<li>Key change:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: 500+ lines of schema definitions
</span><span style=color:#abb0b6;font-style:italic>// After: Clean method registration
</span><span>builtin_methods</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(</span><span style=color:#86b300>"rpc.discover"</span><span style=color:#61676ccc>,</span><span> discover)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><p><strong>crates/bevy_remote/src/schemas/json_schema.rs</strong> (+543)</p> <ul><li>New home for JSON schema types<li>Contains structs like <code>SchemaObject</code> and <code>SchemaType</code></ul><li><p><strong>crates/bevy_remote/src/schemas/open_rpc.rs</strong> (+118)</p> <ul><li>Implements OpenRPC specification structures<li>Core discovery response type <code>OpenRpcDocument</code></ul><li><p><strong>Module Integrations</strong> (lib.rs/mod.rs)</p> <ul><li>Added module hierarchy for schema organization</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In lib.rs
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>schemas</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In schemas/mod.rs
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>json_schema</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>open_rpc</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://spec.open-rpc.org/ target=_blank>OpenRPC Specification</a><li><a rel="noopener nofollow noreferrer" href=https://json-schema.org/ target=_blank>JSON Schema Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/16744 target=_blank>Bevy Remote Protocol Discussion</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18068.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>