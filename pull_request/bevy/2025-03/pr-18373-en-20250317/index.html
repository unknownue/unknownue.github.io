<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18373 Fixes for WESL on Windows
        
    </title><meta content="#18373 Fixes for WESL on Windows" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-03/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-03-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-03/pr-18373-zh-cn-20250317>中文</a></div></div><div class=pr-content><h1 id=18373-fixes-for-wesl-on-windows>#18373 Fixes for WESL on Windows</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fixes for WESL on Windows<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18373<li><strong>Author</strong>: tychedelia<li><strong>Status</strong>: MERGED<li><strong>Created</strong>: 2025-03-17T22:07:06Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>WESL was broken on windows.<h2 id=solution>Solution</h2><ul><li>Upgrade to <code>wesl_rs</code> 1.2.<li>Fix path handling on windows.<li>Improve example for khronos demo this week.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses critical breakages in Windows support for WESL (WebGPU Shading Language) processing within Bevy’s rendering system. Three primary issues were identified and resolved through coordinated changes across multiple subsystems.<p><strong>The Core Problem</strong><br> Windows systems exhibited broken shader compilation due to two key factors:<ol><li>An outdated version of <code>wesl_rs</code> (WebGPU Shading Language Rust bindings) lacked Windows-compatible path handling<li>Incorrect path normalization when loading shader assets on Windows platforms</ol><p><strong>Strategic Upgrades</strong><br> The first corrective action upgraded <code>wesl_rs</code> to v1.2 through a targeted Cargo.toml change:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># crates/bevy_render/Cargo.toml
</span><span style=color:#399ee6>wesl_rs </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1.2"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"wgsl"</span><span>] }
</span></code></pre><p>This brought in Windows-specific fixes from the updated dependency while maintaining WGSL (WebGPU Shading Language) support.<p><strong>Path Normalization Fix</strong><br> The render resource system required Windows-aware path handling. Key modifications in <code>shader.rs</code> introduced platform-specific path conversion:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_render/src/render_resource/shader.rs
</span><span style=color:#fa6e32>let</span><span> path </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#f07171>cfg!</span><span>(windows) {
</span><span>    path</span><span style=color:#ed9366>.</span><span style=color:#f07171>replace</span><span>(</span><span style=color:#86b300>'/'</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"</span><span style=color:#4cbf99>\\</span><span style=color:#86b300>"</span><span>)
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    path</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>This conditional logic ensures proper slash direction for file paths regardless of OS, crucial for consistent shader loading behavior.<p><strong>Demo Preparation</strong><br> The Khronos demo example received structural improvements to better showcase WESL capabilities. The <code>shader_material_wesl.rs</code> example was enhanced with:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// examples/shader/shader_material_wesl.rs
</span><span>Material</span><span style=color:#ed9366>::</span><span>&LTCustomMaterial> {
</span><span>    base_color</span><span style=color:#61676ccc>: </span><span>Color</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>BLUE</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>}
</span></code></pre><p>This change provided clearer visual feedback for material properties in the demonstration scenario.<p><strong>Technical Trade-offs</strong><br> The path normalization approach maintains cross-platform compatibility without introducing complex abstraction layers. By handling the conversion at the point of shader loading, the solution:<ul><li>Avoids invasive filesystem changes<li>Keeps platform-specific logic contained<li>Maintains forward compatibility with other OS implementations</ul><p><strong>Impact</strong><br> These changes restored Windows functionality while improving cross-platform reliability. Developers can now:<ul><li>Use WESL shaders consistently across all supported platforms<li>Leverage updated <code>wesl_rs</code> features and bug fixes<li>Demonstrate WESL capabilities more effectively through improved examples</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[wesl_rs 1.2 Upgrade] --> B[Windows Path Handling]
</span><span>    B --> C[Shader Loading Fixes]
</span><span>    A --> D[Khronos Demo Example]
</span><span>    C --> E[Working WESL on Windows]
</span><span>    D --> E
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><strong>crates/bevy_render/Cargo.toml</strong></ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>wesl_rs </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1.1"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"wgsl"</span><span>] }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>wesl_rs </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1.2"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"wgsl"</span><span>] }
</span></code></pre><p>Enables Windows fixes from updated dependency<ol start=2><li><strong>crates/bevy_render/src/render_resource/shader.rs</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Modified path handling:
</span><span style=color:#fa6e32>let</span><span> path </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#f07171>cfg!</span><span>(windows) {
</span><span>    path</span><span style=color:#ed9366>.</span><span style=color:#f07171>replace</span><span>(</span><span style=color:#86b300>'/'</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"</span><span style=color:#4cbf99>\\</span><span style=color:#86b300>"</span><span>)
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    path</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>Ensures correct path separators on Windows<ol start=3><li><strong>examples/shader/shader_material_wesl.rs</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Enhanced material configuration:
</span><span>Material</span><span style=color:#ed9366>::</span><span>&LTCustomMaterial> {
</span><span>    base_color</span><span style=color:#61676ccc>: </span><span>Color</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>BLUE</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Clear visual indicator
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>}
</span></code></pre><p>Improves demo visibility and understanding<h2 id=further-reading>Further Reading</h2><ul><li>WGSL Specification: https://www.w3.org/TR/WGSL/<li>Windows Path Semantics: https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file<li>wesl_rs Changelog: https://github.com/bevyengine/wesl-rs/releases/tag/v1.2.0</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-03/pr_18373.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>