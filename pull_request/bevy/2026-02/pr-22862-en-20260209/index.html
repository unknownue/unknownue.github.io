<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22862 Adding `take` Method to ReflectComponent for Consistent Reflection API
        
    </title><meta content="#22862 Adding `take` Method to ReflectComponent for Consistent Reflection API" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22862-zh-cn-20260209>中文</a></div></div><div class=pr-content><h1 id=title-adding-take-method-to-reflectcomponent-for-consistent-reflection-api>Title: Adding <code>take</code> Method to ReflectComponent for Consistent Reflection API</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Feat: adds <code>take</code> method to ReflectComponent<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22862<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, A-Reflection, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2026-02-08T04:30:28Z<li><strong>Merged</strong>: 2026-02-09T02:56:24Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Closes #22726</ul><h2 id=solution>Solution</h2><ul><li>Adds a <code>take</code> method to <code>ReflectComponent</code> that utilizes <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_ecs/src/world/entity_access/world_mut.rs#L1212 target=_blank><code>EntityWorldMut::take</code></a>. This is implemented basically in the same way as what <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_ecs/src/reflect/bundle.rs#L227-L230 target=_blank><code>ReflectBundle</code></a> does.<li>Adds <code>take_reflect</code> methods to <code>EntityWorldMut</code>, following a similar pattern to other methods in the module.</ul><h2 id=testing>Testing</h2><ul><li>I did not test this. There are no unit tests to be added to. However, it’s a simple enough change that follows a previously walked path.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The issue #22726 identified a gap in the reflection API: while <code>ReflectBundle</code> already had a <code>take</code> method that could remove and return a bundle’s components from an entity, <code>ReflectComponent</code> was missing this capability. This inconsistency meant developers working with reflected components couldn’t use the same patterns available for bundles when they needed to retrieve and remove components simultaneously.<p>The problem was straightforward: the <code>take</code> operation is useful when you need to both remove a component from an entity and work with its value afterwards. Without a <code>take</code> method on <code>ReflectComponent</code>, developers had to implement workarounds, first retrieving the component value through reflection and then removing it separately.<p>The solution approach was to mirror the existing pattern already established by <code>ReflectBundle</code>. Since <code>ReflectBundle</code> had successfully implemented a <code>take</code> method, the same approach could be applied to <code>ReflectComponent</code> for consistency. This follow-the-existing-pattern approach reduces cognitive load for developers and maintains API consistency across the reflection system.<p>Looking at the implementation, we can see the changes follow a clear pattern. In <code>component.rs</code>, the <code>ReflectComponentFns</code> struct was extended with a new function pointer field:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// Function pointer implementing [`ReflectComponent::take()`].
</span><span style=color:#fa6e32>pub</span><span> take</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityWorldMut) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>></span><span style=color:#61676ccc>,
</span></code></pre><p>This function pointer follows the same signature pattern as the existing <code>remove</code> method but returns an <code>Option&LTBox&LTdyn Reflect>></code> to capture the removed component’s value. The <code>ReflectComponent</code> struct then exposes this through a public method:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// Removes this [`Component`] from the entity and returns its previous value.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>take</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>entity</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityWorldMut) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>> {
</span><span>    (</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span>take)(entity)
</span><span>}
</span></code></pre><p>The actual implementation for concrete component types is provided in the <code>FromType&LTC></code> implementation. Here’s the key addition:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>take</span><span style=color:#61676ccc>: </span><span>|</span><span style=color:#ff8f40>entity</span><span>| {
</span><span>    entity
</span><span>        </span><span style=color:#ed9366>.</span><span>take</span><span style=color:#ed9366>::</span><span>&LTC>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>component</span><span>| </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(component)</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_reflect</span><span>())
</span><span>}</span><span style=color:#61676ccc>,
</span></code></pre><p>This closure calls the existing typed <code>EntityWorldMut::take</code> method, which already handles the actual removal and value return. The result is then converted to a boxed <code>dyn Reflect</code> using <code>into_reflect()</code>. This implementation is efficient because it leverages the existing typed infrastructure while adding the reflection layer on top.<p>In <code>entity_commands.rs</code>, the changes extend the reflection API at the <code>EntityWorldMut</code> level. Two new methods were added:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>take_reflect</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>component_type_path</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>assert_not_despawned</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>resource_scope</span><span>(|</span><span style=color:#ff8f40>entity</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>registry</span><span style=color:#61676ccc>: </span><span>Mut&LTAppTypeRegistry>| {
</span><span>        </span><span style=color:#fa6e32>let</span><span> type_registry </span><span style=color:#ed9366>= &</span><span>registry</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>read</span><span>()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#f07171>take_reflect_with_registry_ref</span><span>(entity</span><span style=color:#61676ccc>,</span><span> type_registry</span><span style=color:#61676ccc>,</span><span> component_type_path)
</span><span>    })
</span><span>}
</span></code></pre><p>This method follows the established pattern of other reflection methods like <code>remove_reflect</code>. It first checks that the entity hasn’t been despawned, then scopes into the type registry resource to look up the reflection data. The actual work is delegated to a helper function:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>take_reflect_with_registry_ref</span><span>(
</span><span>    </span><span style=color:#ff8f40>entity</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityWorldMut,
</span><span>    </span><span style=color:#ff8f40>type_registry</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>TypeRegistry,
</span><span>    </span><span style=color:#ff8f40>component_type_path</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>> {
</span><span>    </span><span style=color:#fa6e32>let</span><span> type_registration </span><span style=color:#ed9366>=</span><span> type_registry</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_with_type_path</span><span>(</span><span style=color:#ed9366>&</span><span>component_type_path)</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(reflect_component) </span><span style=color:#ed9366>=</span><span> type_registration</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>::</span><span>&LTReflectComponent>() {
</span><span>        reflect_component</span><span style=color:#ed9366>.</span><span style=color:#f07171>take</span><span>(entity)
</span><span>    } </span><span style=color:#fa6e32>else if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(reflect_bundle) </span><span style=color:#ed9366>=</span><span> type_registration</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>::</span><span>&LTReflectBundle>() {
</span><span>        reflect_bundle</span><span style=color:#ed9366>.</span><span style=color:#f07171>take</span><span>(entity)
</span><span>    } </span><span style=color:#fa6e32>else </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>None
</span><span>    }
</span><span>}
</span></code></pre><p>This helper function demonstrates good code reuse - it checks for both <code>ReflectComponent</code> and <code>ReflectBundle</code> data, allowing a single code path to handle both component and bundle reflection. This pattern is consistent with how <code>remove_reflect_with_registry_ref</code> works.<p>A technical insight here is the use of <code>Box&LTdyn Reflect></code> as the return type. This follows Rust’s trait object pattern for type-erased values, which is appropriate for a reflection system that needs to handle arbitrary types. The boxing is necessary because we don’t know the concrete type at compile time, and we need to return ownership of the value.<p>The implementation also includes a second method <code>take_reflect_with_registry</code> that accepts a custom type registry resource, following the same pattern as other reflection methods in the module. This provides flexibility for use cases where the type registry isn’t stored in the default <code>AppTypeRegistry</code> resource.<p>One important note in the documentation is the performance warning: “Prefer to use the typed [<code>EntityWorldMut::take</code>] if possible. Taking a reflected component is much slower.” This is expected because reflection involves runtime type lookups and dynamic dispatch, whereas the typed version can be optimized at compile time.<p>The impact of this change is primarily API completeness and consistency. Developers can now use the same patterns for both components and bundles when working with reflection. This reduces mental overhead and makes the API more predictable. The changes are minimal and focused, adding only the necessary infrastructure without modifying existing behavior.<p>From an architectural perspective, this PR demonstrates good practice in extending an existing system by following established patterns. Each change builds on existing infrastructure: the function pointer pattern in <code>ReflectComponentFns</code>, the resource scoping pattern in <code>EntityWorldMut</code>, and the helper function pattern for shared logic. This approach minimizes risk and makes the code easier to understand for developers familiar with the existing codebase.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[EntityWorldMut.take_reflect] --> B[take_reflect_with_registry_ref]
</span><span>    B --> C{Lookup TypeRegistration}
</span><span>    C --> D[Found ReflectComponent?]
</span><span>    C --> E[Found ReflectBundle?]
</span><span>    D --> F[Call ReflectComponent.take]
</span><span>    E --> G[Call ReflectBundle.take]
</span><span>    F --> H[Return Option&LTBox&LTdyn Reflect>>]
</span><span>    G --> H
</span><span>    
</span><span>    I[ReflectComponent.take] --> J[Call stored function pointer]
</span><span>    J --> K[EntityWorldMut.take&LTC>]
</span><span>    K --> L[Map to Box&LTdyn Reflect>]
</span><span>    L --> H
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-reflect-component-rs-13-0><code>crates/bevy_ecs/src/reflect/component.rs</code> (+13/-0)</h3><p>This file contains the core implementation of the <code>take</code> method for <code>ReflectComponent</code>. The changes are minimal but essential for adding the new capability.<p>Key modifications:<ol><li>Added a <code>take</code> field to the <code>ReflectComponentFns</code> struct to store the function pointer<li>Added a public <code>take</code> method to <code>ReflectComponent</code> that calls the stored function pointer<li>Implemented the <code>take</code> function in the <code>FromType&LTC></code> implementation</ol><p>Code snippets:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added field to ReflectComponentFns
</span><span style=color:#fa6e32>pub</span><span> take</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityWorldMut) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>></span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added method to ReflectComponent
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>take</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>entity</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityWorldMut) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>> {
</span><span>    (</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span>take)(entity)
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added implementation in FromType&LTC> for ReflectComponent
</span><span>take</span><span style=color:#61676ccc>: </span><span>|</span><span style=color:#ff8f40>entity</span><span>| {
</span><span>    entity
</span><span>        </span><span style=color:#ed9366>.</span><span>take</span><span style=color:#ed9366>::</span><span>&LTC>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>component</span><span>| </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(component)</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_reflect</span><span>())
</span><span>}</span><span style=color:#61676ccc>,
</span></code></pre><h3 id=crates-bevy-ecs-src-reflect-entity-commands-rs-66-2><code>crates/bevy_ecs/src/reflect/entity_commands.rs</code> (+66/-2)</h3><p>This file adds the public API methods to <code>EntityWorldMut</code> and the helper function that implements the logic.<p>Key modifications:<ol><li>Added <code>take_reflect</code> and <code>take_reflect_with_registry</code> methods to <code>EntityWorldMut</code><li>Added the <code>take_reflect_with_registry_ref</code> helper function<li>Updated documentation comments</ol><p>Code snippets:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New method on EntityWorldMut
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>take_reflect</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>component_type_path</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>assert_not_despawned</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>resource_scope</span><span>(|</span><span style=color:#ff8f40>entity</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>registry</span><span style=color:#61676ccc>: </span><span>Mut&LTAppTypeRegistry>| {
</span><span>        </span><span style=color:#fa6e32>let</span><span> type_registry </span><span style=color:#ed9366>= &</span><span>registry</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>read</span><span>()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#f07171>take_reflect_with_registry_ref</span><span>(entity</span><span style=color:#61676ccc>,</span><span> type_registry</span><span style=color:#61676ccc>,</span><span> component_type_path)
</span><span>    })
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// New helper function
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>take_reflect_with_registry_ref</span><span>(
</span><span>    </span><span style=color:#ff8f40>entity</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityWorldMut,
</span><span>    </span><span style=color:#ff8f40>type_registry</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>TypeRegistry,
</span><span>    </span><span style=color:#ff8f40>component_type_path</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reflect>> {
</span><span>    </span><span style=color:#fa6e32>let</span><span> type_registration </span><span style=color:#ed9366>=</span><span> type_registry</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_with_type_path</span><span>(</span><span style=color:#ed9366>&</span><span>component_type_path)</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(reflect_component) </span><span style=color:#ed9366>=</span><span> type_registration</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>::</span><span>&LTReflectComponent>() {
</span><span>        reflect_component</span><span style=color:#ed9366>.</span><span style=color:#f07171>take</span><span>(entity)
</span><span>    } </span><span style=color:#fa6e32>else if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(reflect_bundle) </span><span style=color:#ed9366>=</span><span> type_registration</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>::</span><span>&LTReflectBundle>() {
</span><span>        reflect_bundle</span><span style=color:#ed9366>.</span><span style=color:#f07171>take</span><span>(entity)
</span><span>    } </span><span style=color:#fa6e32>else </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>None
</span><span>    }
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_reflect/latest/bevy_reflect/ target=_blank>Bevy Reflection Documentation</a> - Understanding the reflection system in Bevy<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch17-02-trait-objects.html target=_blank>Rust Trait Objects</a> - How <code>Box&LTdyn Trait></code> works in Rust<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Entity_component_system target=_blank>Entity Component System Pattern</a> - Background on ECS architecture<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/22726 target=_blank>Previous PR #22726</a> - The issue that prompted this change</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22862.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>