<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20934 Store Resources as components on singleton entities
        
    </title><meta content="#20934 Store Resources as components on singleton entities" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-20934-zh-cn-20260210>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Store Resources as components on singleton entities<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20934<li><strong>Author</strong>: Trashtalk217<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-ECS, S-Ready-For-Final-Review, S-Needs-SME<li><strong>Created</strong>: 2025-09-08T19:20:03Z<li><strong>Merged</strong>: 2026-02-10T19:28:27Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>This is part of #19731.<h1 id=resources-as-components>Resources as Components</h1><h2 id=motivation>Motivation</h2><p>More things should be entities. This simplifies the API, the lower-level implementation and the tools we have for entities and components can be used for other things in the engine. In particular, for resources, it is really handy to have observers, which we currently don’t have. See #20821 under 1A, for a more specific use.<h2 id=current-work>Current Work</h2><p>This removes the <code>resources</code> field from the world storage and instead store the resources on singleton entities. For easy lookup, we add a <code>HashMap&LTComponentId, Entity></code> to <code>World</code>, in order to quickly find the singleton entity where the resource is stored.<p>Because we store resources on entities, we derive <code>Component</code> alongside <code>Resource</code>, this means that<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Foo</span><span style=color:#61676ccc>;
</span></code></pre><p>turns into<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Component)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Foo</span><span style=color:#61676ccc>;
</span></code></pre><p>This was also done for reflections, meaning that<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>refect</span><span>(Resource)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Bar</span><span style=color:#61676ccc>;
</span></code></pre><p>becomes<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Component</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>refect</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Component)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Bar</span><span style=color:#61676ccc>;
</span></code></pre><p>In order to distinguish resource entities, they are tagged with the <code>IsResource</code> component. Additionally, to ensure that they aren’t queried by accident, they are also tagged as being internal entities, which means that they don’t show up in queries by default.<h2 id=drawbacks>Drawbacks</h2><ul><li>Currently you can’t have a struct that is both a <code>Resource</code> and a <code>Component</code>, because <code>Resource</code> expands to also implement <code>Component</code>, this means that this throws a compiler error as it’s implemented twice.<li>Because every reflected Resource must also implement <code>ReflectComponent</code> you need to import <code>bevy_ecs::reflect::ReflectComponent</code> every time you use <code>#[reflect(Resource)]</code>. This is kind of unintuitive.</ul><h2 id=future-work>Future Work</h2><ul><li>Simplify <code>Access</code> in the ECS, to only deal with components (and not components <em>and</em> resources).<li>Newtype <code>Res&LTResource></code> to <code>Single&LTRef&LTResource>></code> (or something similair).<li>Eliminate <code>ReflectResource</code>.<li>Take stabs at simplifying the public facing API.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>In Bevy’s ECS, resources and components have historically been separate concepts with distinct storage mechanisms. Resources were stored in dedicated <code>Resources</code> and <code>NonSendResources</code> storages, while components were stored in tables and sparse sets on entities. This separation created several issues:<ol><li><strong>API Complexity</strong>: The ECS had to maintain parallel systems for handling resources and components, leading to code duplication and complex access patterns.<li><strong>Missing Features</strong>: Resources couldn’t benefit from component features like lifecycle hooks, observers, and relations.<li><strong>Implementation Overhead</strong>: The storage layer needed separate logic for resources, making the codebase harder to maintain and extend.</ol><p>The primary motivation for this change was to unify the storage model, allowing resources to leverage the existing component infrastructure. This would enable features like resource observers (#20821) and simplify the overall architecture.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution was to store resources as components on singleton entities. Each resource type gets its own dedicated entity that contains the resource as a component. To maintain the singleton property and enable fast lookups, the implementation adds:<ol><li>A <code>ResourceEntities</code> cache mapping <code>ComponentId</code> to <code>Entity</code> for quick resource entity lookup.<li>An <code>IsResource</code> marker component to identify resource entities and manage uniqueness.<li>Automatic derivation of <code>Component</code> alongside <code>Resource</code> through the <code>#[derive(Resource)]</code> macro.</ol><p>This approach transforms resources into a special case of components while preserving their singleton semantics through the <code>IsResource</code> component’s hooks.<h3 id=the-implementation>The Implementation</h3><p>The implementation required changes across multiple layers of the ECS:<p><strong>1. World Storage Restructuring</strong> The <code>World</code> struct’s <code>storages</code> field was simplified by removing the dedicated <code>Resources&LTtrue></code> storage for send resources. Non-send data continues to use the renamed <code>NonSends</code> storage (formerly <code>Resources&LTfalse></code>). Instead, resources are now stored as components on entities.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Separate resource storage
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Storages </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>resources</span><span style=color:#61676ccc>: </span><span>Resources&LTtrue>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>non_send_resources</span><span style=color:#61676ccc>: </span><span>Resources&LTfalse>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Resources are components on entities
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Storages </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>non_sends</span><span style=color:#61676ccc>:</span><span> NonSends,  </span><span style=color:#abb0b6;font-style:italic>// Only for non-send data
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... (resources now stored in tables/sparse sets)
</span><span>}
</span></code></pre><p><strong>2. Resource Entity Cache</strong> A new <code>ResourceEntities</code> type was added to <code>World</code> to map resource component IDs to their singleton entities:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) resource_entities</span><span style=color:#61676ccc>:</span><span> ResourceEntities,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ResourceEntities</span><span>(SyncUnsafeCell&LTSparseSet&LTComponentId, Entity>>)</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>3. IsResource Component and Hooks</strong> The <code>IsResource</code> component enforces singleton semantics and manages the resource entity cache:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>IsResource</span><span>(ComponentId)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>IsResource </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_insert</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>:</span><span> DeferredWorld, </span><span style=color:#ff8f40>context</span><span style=color:#61676ccc>:</span><span> HookContext) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Prevent duplicate resources by removing component if another exists
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Update resource_entities cache
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_replace</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>:</span><span> DeferredWorld, </span><span style=color:#ff8f40>context</span><span style=color:#61676ccc>:</span><span> HookContext) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Clean up cache when IsResource is replaced
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_despawn</span><span>(</span><span style=color:#ff8f40>_world</span><span style=color:#61676ccc>:</span><span> DeferredWorld, </span><span style=color:#ff8f40>_context</span><span style=color:#61676ccc>:</span><span> HookContext) {
</span><span>        </span><span style=color:#f07171>warn!</span><span>(</span><span style=color:#86b300>"Resource entities are not supposed to be despawned."</span><span>)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p><strong>4. Resource Trait Changes</strong> The <code>Resource</code> trait now extends <code>Component</code>, and the <code>#[derive(Resource)]</code> macro automatically implements both traits:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Resource was standalone
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>Resource</span><span>: Send + Sync + 'static {}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Resource extends Component
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>Resource</span><span>: Component&LTMutability = Mutable> {}
</span></code></pre><p><strong>5. System Parameter Access</strong> <code>Res</code> and <code>ResMut</code> system parameters were updated to access resources through the component system, requiring both component access and the <code>IsResource</code> filter:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>unsafe impl</span><span><</span><span style=color:#fa6e32>'a</span><span>, T</span><span style=color:#61676ccc>:</span><span> Resource> SystemParam </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ResMut</span><span><</span><span style=color:#fa6e32>'a</span><span>, T> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_access</span><span>(
</span><span>        </span><span style=color:#ff8f40>component_id</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>State,
</span><span>        </span><span style=color:#ff8f40>system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> SystemMeta,
</span><span>        </span><span style=color:#ff8f40>component_access_set</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>FilteredAccessSet&LTComponentId>,
</span><span>    ) {
</span><span>        </span><span style=color:#fa6e32>let mut</span><span> filter </span><span style=color:#ed9366>= </span><span>FilteredAccess</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>;
</span><span>        filter</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_component_write</span><span>(component_id)</span><span style=color:#61676ccc>;
</span><span>        filter</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_resource_write</span><span>(component_id)</span><span style=color:#61676ccc>;
</span><span>        filter</span><span style=color:#ed9366>.</span><span style=color:#f07171>and_with</span><span>(</span><span style=color:#ff8f40>IS_RESOURCE</span><span>)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Filter to resource entities
</span><span>        
</span><span>        component_access_set</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(filter)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p><strong>6. Reflection Updates</strong> <code>ReflectResource</code> was simplified to a marker type, and resource reflection now uses <code>ReflectComponent</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: ReflectResource had full functionality
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ReflectResource</span><span>(ReflectResourceFns)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: ReflectResource is a zero-sized marker
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ReflectResource</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p><strong>Singleton Enforcement</strong>: The <code>IsResource</code> component’s hooks ensure that only one entity can have a particular resource component. If code attempts to insert a resource on a second entity, the component is automatically removed with a warning.<p><strong>Performance Considerations</strong>: Resource access now involves an extra indirection through the <code>resource_entities</code> cache. However, this is a hash map lookup followed by a component access, which should be negligible for most use cases. The benefits of unified storage outweigh this minor overhead.<p><strong>Backward Compatibility</strong>: The public API for resources remains largely unchanged. Methods like <code>world.resource::&LTT>()</code> and <code>world.insert_resource()</code> work as before, hiding the underlying entity storage from users.<p><strong>Non-Send Data</strong>: The implementation distinguishes between send resources (stored as components) and non-send data (stored in the <code>NonSends</code> storage). This maintains thread safety guarantees while unifying the send resource storage model.<h3 id=the-impact>The Impact</h3><p><strong>Positive Impacts</strong>:<ol><li><strong>Feature Parity</strong>: Resources can now use observers, lifecycle hooks, and other component features.<li><strong>Code Simplification</strong>: Removes duplicate code for resource storage and access.<li><strong>Architectural Consistency</strong>: Resources and components now use the same underlying infrastructure.<li><strong>Future Extensibility</strong>: Enables future features like resource relationships and more sophisticated query patterns.</ol><p><strong>Migration Requirements</strong>:<ol><li>Structs can no longer derive both <code>Component</code> and <code>Resource</code> (compile error due to duplicate implementation).<li>Reflected resources must import and use <code>ReflectComponent</code> instead of <code>ReflectResource</code>.<li>Queries that should exclude resources need to add <code>Without&LTIsResource></code>.<li>Non-send resource APIs were renamed (e.g., <code>insert_non_send_resource</code> → <code>insert_non_send</code>).</ol><p><strong>Performance Implications</strong>: Initial benchmarks show negligible performance differences for resource access. The entity-based storage may have slightly higher memory overhead due to entity metadata, but this is offset by storage unification benefits.<p>The change represents a significant step toward a more unified and extensible ECS architecture, paving the way for further simplifications like eliminating <code>ReflectResource</code> and unifying access patterns.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TB
</span><span>    subgraph "Before PR"
</span><span>        A[World] --> B[Resources Storage]
</span><span>        A --> C[Components Storage]
</span><span>        B --> D[Resource A]
</span><span>        B --> E[Resource B]
</span><span>        C --> F[Entity 1 Components]
</span><span>        C --> G[Entity 2 Components]
</span><span>    end
</span><span>    
</span><span>    subgraph "After PR"
</span><span>        H[World] --> I[Resource Entities Cache]
</span><span>        H --> J[Components Storage]
</span><span>        I --> K[Entity A: Resource A + IsResource]
</span><span>        I --> L[Entity B: Resource B + IsResource]
</span><span>        J --> K
</span><span>        J --> L
</span><span>        J --> M[Entity 1 Components]
</span><span>        J --> N[Entity 2 Components]
</span><span>    end
</span><span>    
</span><span>    style K fill:#e1f5e1
</span><span>    style L fill:#e1f5e1
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-world-mod-rs-364-305><code>crates/bevy_ecs/src/world/mod.rs</code> (+364/-305)</h3><p><strong>What changed</strong>: The world storage was restructured to remove dedicated resource storage and add resource entity tracking.<p><strong>Key modifications</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added resource entity cache
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) resource_entities</span><span style=color:#61676ccc>:</span><span> ResourceEntities,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Removed: resources field from storages
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Resource insertion now uses entities
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>insert_resource_if_not_exists_with_caller</span><span>&LTR</span><span style=color:#61676ccc>:</span><span> Resource>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>func</span><span style=color:#61676ccc>:</span><span> impl FnOnce(&</span><span style=color:#ff8f40>mut World</span><span>) -> R,
</span><span>    </span><span style=color:#ff8f40>caller</span><span style=color:#61676ccc>:</span><span> MaybeLocation,
</span><span>) </span><span style=color:#61676ccc>-> </span><span>(ComponentId, EntityWorldMut<'</span><span style=color:#ed9366>_</span><span>>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Look up or create resource entity
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Insert resource as component on that entity
</span><span>}
</span></code></pre><p><strong>Why it matters</strong>: This is the core change that enables resources to be stored as components while maintaining singleton semantics.<h3 id=crates-bevy-ecs-src-resource-rs-238-1><code>crates/bevy_ecs/src/resource.rs</code> (+238/-1)</h3><p><strong>What changed</strong>: Added the <code>ResourceEntities</code> cache and <code>IsResource</code> component with lifecycle hooks.<p><strong>Key modifications</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New cache for resource entity lookup
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ResourceEntities</span><span>(SyncUnsafeCell&LTSparseSet&LTComponentId, Entity>>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Marker component for resource entities
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>component</span><span>(on_insert</span><span style=color:#61676ccc>,</span><span> on_replace</span><span style=color:#61676ccc>,</span><span> on_despawn)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>IsResource</span><span>(ComponentId)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Resource trait now extends Component
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>Resource</span><span>: Component&LTMutability = Mutable> {}
</span></code></pre><p><strong>Why it matters</strong>: Provides the infrastructure for tracking resource entities and enforcing singleton behavior.<h3 id=crates-bevy-ecs-src-reflect-resource-rs-22-237><code>crates/bevy_ecs/src/reflect/resource.rs</code> (+22/-237)</h3><p><strong>What changed</strong>: <code>ReflectResource</code> was simplified to a marker type since resource reflection now uses <code>ReflectComponent</code>.<p><strong>Key modifications</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Complex type with function pointers
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ReflectResource</span><span>(ReflectResourceFns)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Zero-sized marker
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ReflectResource</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTR</span><span style=color:#61676ccc>:</span><span> Resource </span><span style=color:#ed9366>+</span><span> FromReflect </span><span style=color:#ed9366>+</span><span> TypePath> FromType&LTR> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ReflectResource </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_type</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        ReflectResource
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>insert_dependencies</span><span>(</span><span style=color:#ff8f40>type_registration</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> TypeRegistration) {
</span><span>        type_registration</span><span style=color:#ed9366>.</span><span>register_type_data</span><span style=color:#ed9366>::</span><span>&LTReflectComponent, R>()</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p><strong>Why it matters</strong>: Simplifies the reflection system by eliminating duplicate functionality between <code>ReflectResource</code> and <code>ReflectComponent</code>.<h3 id=crates-bevy-ecs-src-storage-non-send-rs-57-137><code>crates/bevy_ecs/src/storage/non_send.rs</code> (+57/-137)</h3><p><strong>What changed</strong>: Renamed and refactored non-send storage to clarify its purpose distinct from send resources.<p><strong>Key modifications</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Generic Resources&LTSEND> for both send and non-send
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Resources</span><span><</span><span style=color:#fa6e32>const</span><span> SEND</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>></span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Dedicated NonSends for non-send data only
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>NonSends </span><span>{
</span><span>    non_sends</span><span style=color:#61676ccc>: </span><span>SparseSet&LTComponentId, NonSendData>,
</span><span>}
</span></code></pre><p><strong>Why it matters</strong>: Clarifies that non-send data uses different storage from send resources (which are now components).<h3 id=crates-bevy-ecs-src-component-info-rs-and-register-rs><code>crates/bevy_ecs/src/component/info.rs</code> and <code>register.rs</code></h3><p><strong>What changed</strong>: Removed separate resource registration paths and unified component/resource registration.<p><strong>Key modifications</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Separate resource registration
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register_resource</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Resource>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Unified component registration
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register_component</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// Resources use register_component since Resource: Component
</span></code></pre><p><strong>Why it matters</strong>: Eliminates code duplication and simplifies the registration system.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy ECS Architecture</strong>: <a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/ target=_blank>Bevy ECS Documentation</a><li><strong>Component Lifecycle Hooks</strong>: <a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/component/struct.ComponentHooks.html target=_blank>Component Hooks Documentation</a><li><strong>Observers Pattern</strong>: <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/20821 target=_blank>RFC #20821</a><li><strong>Entity-Component-System Pattern</strong>: <a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Entity_component_system target=_blank>Wikipedia ECS</a><li><strong>Rust Trait System</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch10-02-traits.html target=_blank>The Rust Programming Language - Traits</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_20934.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>