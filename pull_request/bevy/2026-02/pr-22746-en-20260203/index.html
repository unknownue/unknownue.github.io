<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22746 Consolidate `node.rs` logic into `mod.rs`
        
    </title><meta content="#22746 Consolidate `node.rs` logic into `mod.rs`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22746-zh-cn-20260203>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Consolidate <code>node.rs</code> logic into <code>mod.rs</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22746<li><strong>Author</strong>: Breakdown-Dog<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-01-30T17:34:00Z<li><strong>Merged</strong>: 2026-02-02T23:50:41Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Since <code>RenderGraph</code> and <code>ViewNode</code> have been removed in favor of systems, the dedicated <code>node.rs</code> file is no longer needed.</ul><h2 id=solution>Solution</h2><ul><li>This PR moves the relevant functions into <code>mod.rs</code> and deletes <code>node.rs</code> to simplify the module structure.</ul><h2 id=testing>Testing</h2><ul><li>Examples work properly.<li>CI</ul><hr><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR represents a straightforward but important code organization change in the Bevy engine. The context is that Bevy’s rendering architecture has been transitioning from a graph-based approach using <code>RenderGraph</code> and <code>ViewNode</code> to a more conventional ECS system-based approach. This architectural shift left behind some organizational artifacts - specifically, modules that were structured around the old graph paradigm.<p>The problem was simple: with the removal of <code>RenderGraph</code> and <code>ViewNode</code>, the dedicated <code>node.rs</code> files in several post-processing modules no longer served a meaningful organizational purpose. These files contained rendering systems that were previously implemented as graph nodes but had been converted to regular ECS systems. Keeping them in separate files created unnecessary module complexity without providing architectural benefits.<p>The solution approach was direct: move the system functions from the <code>node.rs</code> files into their parent <code>mod.rs</code> files and delete the now-empty <code>node.rs</code> files. This consolidation reduces file count, simplifies import paths, and makes the codebase more navigable. The engineering decision here was straightforward - when architectural patterns change, the code organization should evolve to reflect the new patterns rather than preserving legacy structures.<p>The implementation involved three main changes. First, the import in the TAA (Temporal Anti-Aliasing) module was updated to reflect the new location of the motion blur system. Second, both auto-exposure and motion blur modules had their system functions moved from <code>node.rs</code> to <code>mod.rs</code>. Third, the now-empty <code>node.rs</code> files were deleted entirely.<p>Let’s examine the auto-exposure module as a representative example. Before this change, the module structure had a separate <code>node.rs</code> file containing the <code>auto_exposure</code> system function. After the change, this function was moved directly into <code>mod.rs</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_post_process/src/auto_exposure/mod.rs
</span><span style=color:#abb0b6;font-style:italic>// Before (in node.rs):
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>auto_exposure</span><span>(
</span><span>    </span><span style=color:#ff8f40>view</span><span style=color:#61676ccc>: </span><span>ViewQuery<</span><span style=color:#f51818>.</span><span>..>,
</span><span>    </span><span style=color:#ff8f40>pipeline_cache</span><span style=color:#61676ccc>: </span><span>Res&LTPipelineCache>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other parameters
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (in mod.rs):
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>auto_exposure</span><span>(
</span><span>    </span><span style=color:#ff8f40>view</span><span style=color:#61676ccc>: </span><span>ViewQuery<</span><span style=color:#f51818>.</span><span>..>,
</span><span>    </span><span style=color:#ff8f40>pipeline_cache</span><span style=color:#61676ccc>: </span><span>Res&LTPipelineCache>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other parameters
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Same implementation moved here
</span><span>}
</span></code></pre><p>The implementation itself remained identical - only its location changed. The same pattern applied to the motion blur module, where the <code>motion_blur</code> system function was relocated from <code>node.rs</code> to <code>mod.rs</code>.<p>One important technical detail is that this change also required updating import statements in other modules that depended on these systems. For example, the TAA module needed to update its import from <code>bevy_post_process::motion_blur::node::motion_blur</code> to <code>bevy_post_process::motion_blur::motion_blur</code>.<p>The impact of this change is primarily organizational. It reduces file count by two, simplifies the module hierarchy, and makes the codebase more consistent with Bevy’s current architectural patterns. There are no functional changes, performance impacts, or API modifications - this is purely a code quality improvement.<p>From an engineering perspective, this PR demonstrates an important principle: when architectural patterns evolve, the code organization should evolve with them. Keeping legacy organizational structures around after their conceptual foundation has been removed creates cognitive overhead for developers and makes the codebase harder to understand and navigate.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_anti_alias/taa/mod.rs] --> B[Import Update]
</span><span>    B --> C[bevy_post_process/motion_blur::motion_blur]
</span><span>    
</span><span>    D[auto_exposure/node.rs] --> E[Move auto_exposure system]
</span><span>    E --> F[auto_exposure/mod.rs]
</span><span>    G[Delete node.rs] --> H[Simplified Structure]
</span><span>    
</span><span>    I[motion_blur/node.rs] --> J[Move motion_blur system]
</span><span>    J --> K[motion_blur/mod.rs]
</span><span>    L[Delete node.rs] --> M[Simplified Structure]
</span><span>    
</span><span>    F --> N[Consolidated Module]
</span><span>    K --> N
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-post-process-src-auto-exposure-mod-rs-102-5><code>crates/bevy_post_process/src/auto_exposure/mod.rs</code> (+102/-5)</h3><p>This file gained the <code>auto_exposure</code> system function that was previously in <code>node.rs</code>. The function handles auto-exposure computation using compute shaders, analyzing luminance histograms and calculating appropriate exposure values.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// The auto_exposure system moved from node.rs to here
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>auto_exposure</span><span>(
</span><span>    </span><span style=color:#ff8f40>view</span><span style=color:#61676ccc>: </span><span>ViewQuery<(
</span><span>        </span><span style=color:#ed9366>&</span><span>ViewUniformOffset,
</span><span>        </span><span style=color:#ed9366>&</span><span>ViewTarget,
</span><span>        </span><span style=color:#ed9366>&</span><span>ViewAutoExposurePipeline,
</span><span>        </span><span style=color:#ed9366>&</span><span>ExtractedView,
</span><span>    )>,
</span><span>    </span><span style=color:#ff8f40>pipeline_cache</span><span style=color:#61676ccc>: </span><span>Res&LTPipelineCache>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other parameters remain unchanged
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation unchanged
</span><span>}
</span></code></pre><h3 id=crates-bevy-post-process-src-auto-exposure-node-rs-0-109><code>crates/bevy_post_process/src/auto_exposure/node.rs</code> (+0/-109)</h3><p>This file was deleted entirely since its content was moved to <code>mod.rs</code>.<h3 id=crates-bevy-post-process-src-motion-blur-mod-rs-101-9><code>crates/bevy_post_process/src/motion_blur/mod.rs</code> (+101/-9)</h3><p>This file gained the <code>motion_blur</code> system function that was previously in <code>node.rs</code>. The function implements motion blur post-processing using motion vectors and depth information from prepass textures.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// The motion_blur system moved from node.rs to here
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>motion_blur</span><span>(
</span><span>    </span><span style=color:#ff8f40>view</span><span style=color:#61676ccc>: </span><span>ViewQuery<(
</span><span>        </span><span style=color:#ed9366>&</span><span>ViewTarget,
</span><span>        </span><span style=color:#ed9366>&</span><span>MotionBlurPipelineId,
</span><span>        </span><span style=color:#ed9366>&</span><span>ViewPrepassTextures,
</span><span>        </span><span style=color:#ed9366>&</span><span>MotionBlurUniform,
</span><span>        </span><span style=color:#ed9366>&</span><span>Msaa,
</span><span>    )>,
</span><span>    </span><span style=color:#ff8f40>motion_blur_pipeline</span><span style=color:#61676ccc>: </span><span>Res&LTMotionBlurPipeline>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other parameters remain unchanged
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation unchanged
</span><span>}
</span></code></pre><h3 id=crates-bevy-post-process-src-motion-blur-node-rs-0-101><code>crates/bevy_post_process/src/motion_blur/node.rs</code> (+0/-101)</h3><p>This file was deleted entirely since its content was moved to <code>mod.rs</code>.<h3 id=crates-bevy-anti-alias-src-taa-mod-rs-1-1><code>crates/bevy_anti_alias/src/taa/mod.rs</code> (+1/-1)</h3><p>This file required a simple import path update since it uses the motion blur system.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_post_process</span><span style=color:#ed9366>::</span><span>{bloom</span><span style=color:#ed9366>::</span><span>bloom</span><span style=color:#61676ccc>, </span><span>motion_blur</span><span style=color:#ed9366>::</span><span>node</span><span style=color:#ed9366>::</span><span>motion_blur}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_post_process</span><span style=color:#ed9366>::</span><span>{bloom</span><span style=color:#ed9366>::</span><span>bloom</span><span style=color:#61676ccc>, </span><span>motion_blur</span><span style=color:#ed9366>::</span><span>motion_blur}</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><p>For developers interested in understanding the architectural context of this change:<ul><li>Bevy’s Render Graph documentation (archived, for historical context)<li>Bevy’s ECS system scheduling documentation<li>The original PRs that transitioned from RenderGraph to systems-based rendering<li>Bevy’s module organization best practices</ul><p>This change is part of Bevy’s ongoing evolution toward simpler, more consistent architectural patterns that leverage its ECS foundation more effectively.</div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22746.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>