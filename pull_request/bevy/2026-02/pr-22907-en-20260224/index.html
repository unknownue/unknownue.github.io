<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22907 Add GltfExtensionHandler interface for draco
        
    </title><meta content="#22907 Add GltfExtensionHandler interface for draco" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22907-zh-cn-20260224>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Add GltfExtensionHandler interface for draco<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add GltfExtensionHandler interface for draco<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22907<li><strong>Author</strong>: jiangheng90<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, D-Modest, A-glTF<li><strong>Created</strong>: 2026-02-11T13:57:17Z<li><strong>Merged</strong>: 2026-02-24T05:04:48Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>add a extension interface for draco decoder</ul><h2 id=solution>Solution</h2><ul><li>add a function in <code>GltfExtensionHandler</code> before get geometry data from primitive buffer.</ul><h2 id=showcase>Showcase</h2><p>I have finish a extention plugin for draco decode in native. since <code>GltfExtensionHandler</code> do not support async function so wasm part can not be support yet.<p>the plugin will be something like<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>GltfDracoDecoderExtensionHandler</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>GltfExtensionHandler </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>GltfDracoDecoderExtensionHandler </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>dyn_clone</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn GltfExtensionHandler> {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new((</span><span style=color:#ed9366>*</span><span style=color:#55b4d4;font-style:italic>self</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_gltf_primitive</span><span>(
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>        </span><span style=color:#ff8f40>load_context</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>LoadContext<'</span><span style=color:#ed9366>_</span><span>>,
</span><span>        </span><span style=color:#ff8f40>gltf_json</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>JsonGltf,
</span><span>        </span><span style=color:#ff8f40>gltf_primitive</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Primitive,
</span><span>        </span><span style=color:#ff8f40>buffer_data</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#fa6e32>u8</span><span>>>,
</span><span>        </span><span style=color:#ff8f40>out_doc</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTDocument>,
</span><span>        </span><span style=color:#ff8f40>out_data</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#fa6e32>u8</span><span>>>>,
</span><span>    ) {
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(draco_ext) </span><span style=color:#ed9366>=
</span><span>            DracoExtension</span><span style=color:#ed9366>::</span><span>parse(load_context</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>gltf_json</span><span style=color:#61676ccc>,</span><span> gltf_primitive)</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_mut</span><span>()
</span><span>        {
</span><span>            </span><span style=color:#ed9366>*</span><span>out_data </span><span style=color:#ed9366>=</span><span> draco_ext</span><span style=color:#ed9366>.</span><span style=color:#f07171>decode_mesh</span><span>(gltf_json</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>buffer_data)</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#ed9366>*</span><span>out_doc </span><span style=color:#ed9366>=</span><span> draco_ext</span><span style=color:#ed9366>.</span><span style=color:#f07171>build_document</span><span>(</span><span style=color:#ed9366>&</span><span>gltf_primitive)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>GltfDracoDecoderPlugin</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>GltfDracoDecoderPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(target_family </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm"</span><span>))]
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTGltfExtensionHandlers>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>write_blocking</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(GltfDracoDecoderExtensionHandler))</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>I’m not sure about the direction Bevy is taking regarding Draco decoding support, nor am I certain whether this API design is appropriate. I’ve already fully implemented Draco decoding for both Wasm and Native, but the implementation is based on asynchronous APIs and cxx FFI bindings. However, the existing GltfExtensionHandler only provides a synchronous interface, which makes it impossible to execute the Wasm part synchronously on the main thread.<p>For now, I’m just writing down this idea as a discussion point: under the current API framework, Draco is capable of synchronous decoding on the Native side.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR adds a new extension point to Bevy’s glTF loader to support Draco mesh compression decoding through the existing <code>GltfExtensionHandler</code> system. The core issue was that while Draco compression is a widely used glTF extension (KHR_draco_mesh_compression), Bevy’s glTF loader didn’t have an appropriate hook to intercept primitive processing and decode compressed mesh data before it was converted to Bevy’s mesh format.<p>The existing <code>GltfExtensionHandler</code> trait already provided several extension points for processing different aspects of glTF files, but it lacked a specific hook for individual primitives - the building blocks that become Bevy meshes. Without this hook, extensions like Draco decoders couldn’t intercept the primitive data before the loader attempted to read vertex attributes and indices from the raw buffer data.<p>The solution was straightforward: add a new <code>on_gltf_primitive</code> method to the <code>GltfExtensionHandler</code> trait that gets called for each primitive during mesh loading. This method provides extensions with access to the raw buffer data and allows them to return modified buffer data or even a replacement glTF document structure. The implementation follows the same pattern as other extension methods in the trait, using <code>out_doc</code> and <code>out_data</code> parameters that extensions can optionally populate to override the loader’s default behavior.<p>One important design consideration was that the interface had to be synchronous, which aligns with the existing extension system but creates limitations for WebAssembly targets where Draco decoding might require asynchronous APIs. The PR author noted this constraint and mentioned they have a complete Draco implementation that works natively but can’t be adapted to WebAssembly without async support in the extension handler.<p>The implementation adds the extension point at the right moment in the loading pipeline - just before the loader reads vertex attributes from the buffer data. When extensions are registered, the loader iterates through them and calls <code>on_gltf_primitive</code> for each primitive. Extensions can modify the primitive being processed by returning a new glTF document with replacement primitive data, or they can modify the buffer data directly. The loader then uses whichever data the extensions provide, falling back to the original if no modifications were made.<p>A secondary but related change was adding a <code>validate</code> flag to <code>GltfLoaderSettings</code> that allows skipping glTF validation. This is useful for files with unsupported extensions that would otherwise fail validation. While not directly related to the Draco extension interface, this change complements it by making the loader more tolerant of non-standard glTF files that extensions might handle.<p>The PR demonstrates good API design by extending an existing pattern rather than creating a new one. The <code>on_gltf_primitive</code> method follows the same parameter structure as other methods in <code>GltfExtensionHandler</code>, maintaining consistency across the codebase. The implementation also includes appropriate error handling and warnings when extensions return unexpected document structures (like multiple meshes or primitives when exactly one is expected).<p>From a technical perspective, this change enables several use cases beyond Draco decoding. Any glTF extension that modifies primitive data or uses custom compression schemes can now be implemented through this interface. The ability to return both modified document structures and buffer data provides flexibility for different types of extensions - some might only need to decompress buffer data while preserving the original glTF structure, while others might need to completely reconstruct the primitive with different attributes or topology.<p>The main limitation, as noted by the author, is the synchronous nature of the interface. For WebAssembly targets where Draco decoding libraries often expose async APIs, this presents a challenge. However, for native targets where synchronous Draco decoding is feasible, this interface provides a clean way to integrate compression support without requiring major architectural changes to Bevy’s asset loading system.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[GltfLoader.load_primitive] --> B[Call on_gltf_primitive&LTbr/>for each extension]
</span><span>    B --> C{Extension modified data?}
</span><span>    C -->|Yes| D[Use extension's&LTbr/>primitive and buffer data]
</span><span>    C -->|No| E[Use original&LTbr/>primitive and buffer data]
</span><span>    D --> F[Convert attributes to Bevy Mesh]
</span><span>    E --> F
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-gltf-src-loader-extensions-mod-rs-31-0><code>crates/bevy_gltf/src/loader/extensions/mod.rs</code> (+31/-0)</h3><p>Added the <code>on_gltf_primitive</code> method to the <code>GltfExtensionHandler</code> trait. This method provides extensions with access to the glTF document, primitive data, and raw buffer data, allowing them to return modified document structures or buffer data.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_gltf_primitive</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>load_context</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>LoadContext<'</span><span style=color:#ed9366>_</span><span>>,
</span><span>    </span><span style=color:#ff8f40>gltf_document</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>gltf</span><span style=color:#ed9366>::</span><span>Gltf,
</span><span>    </span><span style=color:#ff8f40>gltf_primitive</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>gltf</span><span style=color:#ed9366>::</span><span>Primitive,
</span><span>    </span><span style=color:#ff8f40>buffer_data</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#fa6e32>u8</span><span>>],
</span><span>    </span><span style=color:#ff8f40>out_doc</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTgltf</span><span style=color:#ed9366>::</span><span>Document>,
</span><span>    </span><span style=color:#ff8f40>out_data</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#fa6e32>u8</span><span>>>>,
</span><span>) {
</span><span>}
</span></code></pre><h3 id=crates-bevy-gltf-src-loader-mod-rs-55-2><code>crates/bevy_gltf/src/loader/mod.rs</code> (+55/-2)</h3><ol><li>Added <code>validate</code> field to <code>GltfLoaderSettings</code> to allow skipping glTF validation for files with unsupported extensions:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GltfLoaderSettings </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// If false, the loader will load gltf json without validation, for unsupported extension it will ignore validation check.
</span><span>    </span><span style=color:#fa6e32>pub </span><span>validate</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span></code></pre><ol start=2><li>Modified the <code>load</code> method to conditionally skip validation based on the <code>validate</code> setting:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> gltf </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> settings</span><span style=color:#ed9366>.</span><span>validate {
</span><span>    gltf</span><span style=color:#ed9366>::</span><span>Gltf</span><span style=color:#ed9366>::</span><span>from_slice(bytes)</span><span style=color:#ed9366>?
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    gltf</span><span style=color:#ed9366>::</span><span>Gltf</span><span style=color:#ed9366>::</span><span>from_slice_without_validation(bytes)</span><span style=color:#ed9366>?
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li>Added the extension hook in the primitive loading logic. The loader now calls <code>on_gltf_primitive</code> for each extension before processing vertex attributes, and uses the extension’s output if provided:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let mut</span><span> out_doc</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTgltf</span><span style=color:#ed9366>::</span><span>Document> </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> out_data</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#fa6e32>u8</span><span>>>> </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>for</span><span> extension </span><span style=color:#ed9366>in</span><span> extensions</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter_mut</span><span>() {
</span><span>    extension</span><span style=color:#ed9366>.</span><span style=color:#f07171>on_gltf_primitive</span><span>(
</span><span>        load_context</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>&</span><span>gltf</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>&</span><span>primitive</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>&</span><span>buffer_data</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> out_doc</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> out_data</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Use extension-provided data if available, otherwise use original data
</span><span style=color:#fa6e32>let</span><span> primitive </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(doc) </span><span style=color:#ed9366>= &</span><span>out_doc {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Logic to extract primitive from extension's document
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    primitive
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let</span><span> buffer_data </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(data) </span><span style=color:#ed9366>= &</span><span>out_data {
</span><span>    data
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#ed9366>&</span><span>buffer_data
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-gltf-src-lib-rs-1-1><code>crates/bevy_gltf/src/lib.rs</code> (+1/-1)</h3><p>Re-exported <code>Document</code> from the gltf crate to make it available in the public API:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub use </span><span>gltf</span><span style=color:#ed9366>::</span><span>{Animation</span><span style=color:#61676ccc>,</span><span> Document</span><span style=color:#61676ccc>,</span><span> Gltf</span><span style=color:#61676ccc>,</span><span> Material</span><span style=color:#61676ccc>,</span><span> Mesh</span><span style=color:#61676ccc>,</span><span> Primitive</span><span style=color:#61676ccc>,</span><span> Scene</span><span style=color:#61676ccc>,</span><span> Texture}</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/KhronosGroup/glTF/tree/main/specification/2.0 target=_blank>glTF 2.0 Specification</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_draco_mesh_compression/README.md target=_blank>KHR_draco_mesh_compression Extension</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/bevy-cheatbook/features/assets/index.html target=_blank>Bevy’s Asset System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_gltf target=_blank>Bevy glTF Loader Source Code</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22907.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>