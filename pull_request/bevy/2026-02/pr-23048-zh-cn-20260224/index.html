<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23048 Enable `debug` feature when `trace_tracy` is enabled
        
    </title><meta content="#23048 Enable `debug` feature when `trace_tracy` is enabled" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-24</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-02/pr-23048-en-20260224>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>标题</strong>: Enable <code>debug</code> feature when <code>trace_tracy</code> is enabled<li><strong>PR链接</strong>: https://github.com/bevyengine/bevy/pull/23048<li><strong>作者</strong>: IceSentry<li><strong>状态</strong>: 已合并<li><strong>标签</strong>: D-Trivial, C-Usability, S-Ready-For-Final-Review, A-Dev-Tools<li><strong>创建时间</strong>: 2026-02-19T01:28:01Z<li><strong>合并时间</strong>: 2026-02-24T00:57:53Z<li><strong>合并者</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h3 id=mu-biao-objective>目标 (Objective)</h3><ul><li>当运行 tracy 时，你通常希望能够看到事物的完整名称。</ul><h3 id=jie-jue-fang-an-solution>解决方案 (Solution)</h3><ul><li>当启用 <code>trace_tracy</code> 特性时，同时启用 <code>debug</code> 特性。</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这个故事从一个非常具体且常见的开发者痛点开始：当你使用像 Tracy 这样的强大性能分析工具时，你期望看到清晰、完整的函数和类型名称来理解性能瓶颈。然而，在 Bevy 中，仅仅启用 <code>trace_tracy</code> 特性（用于集成 Tracy 追踪功能）并不足以确保编译出的二进制文件包含这些易于阅读的调试符号（debug symbols）。<p>问题的根源在于 Rust 的编译优化和 Cargo 的特性系统。为了获得最佳运行时性能，Rust 编译器默认会进行各种优化，包括函数名重整和符号剥离。要保留人类可读的符号信息，需要启用 <code>debug</code> 特性（通常意味着在 <code>Cargo.toml</code> 的 <code>[profile]</code> 部分设置 <code>debug = true</code> 或使用 <code>--debug</code> 标志）。但在 Bevy 这样的框架中，特性被组织成更高级别的功能开关（例如 <code>trace_chrome</code>, <code>trace_tracy</code>），用户可能不知道或忘记需要同时启用底层 <code>debug</code> 特性才能获得理想的性能分析体验。<p>开发者 IceSentry 识别到这个用户体验上的缺口。这是一个典型的“开发者工具”范畴的问题：工具本身（Tracy）功能强大，但使用前的配置步骤可能导致其无法发挥全部效用。解决方案直接而优雅：既然 <code>trace_tracy</code> 和 <code>trace_chrome</code> 这两个特性的唯一目的就是用于性能分析和调试，那么它们就应该默认提供最有用的输出。因此，最合理的做法是修改这两个特性的定义，让它们在激活时自动带入 <code>debug</code> 特性。<p>从技术实现上看，这个改动极其简单，只涉及 <code>Cargo.toml</code> 中两个特性的依赖列表。它利用了 Cargo 特性的一种标准用法：特性可以依赖其他特性。在 <code>Cargo.toml</code> 的 <code>[features]</code> 部分，像 <code>trace_tracy = ["trace", "bevy_internal/trace_tracy", "debug"]</code> 这样的定义意味着，当用户启用 <code>trace_tracy</code> 特性时，Cargo 会自动启用其右侧列表中的所有特性。这里，<code>"debug"</code> 就是新添加的依赖项。这里的 <code>debug</code> 很可能是指 Bevy 工作空间或内部 crate 中定义的一个特性，用于控制是否生成调试信息。<p>这一改动的工程决策考量是清晰且合理的：<ol><li><strong>用户友好性</strong>：消除了一个“陷阱”（pitfall），开发者无需查阅文档或经历一次失败的追踪尝试来发现需要额外启用 <code>debug</code>。<li><strong>一致性</strong>：<code>trace_chrome</code>（生成 Chrome Tracing 格式文件）和 <code>trace_tracy</code> 同属追踪工具，因此对两者的处理应该一致。PR 中也一并修改了 <code>trace_chrome</code>。<li><strong>最小影响</strong>：该改动不会对不使用这些追踪特性的用户产生任何影响。它只是在启用特定开发工具时，调整了构建配置以获得更优的调试体验。<li><strong>符合惯例</strong>：这是一个配置上的“便利性”增强，类似于许多框架中“development”或“dev”特性会自动启用日志和调试工具的模式。</ol><p>这个 PR 的 impact 虽小但明确：它提升了 Bevy 开发者在进行性能剖析（profiling）时的开箱即用体验。从代码库管理的角度看，它是一个典型的“trivial but useful”的贡献——改动量小，风险极低，但能切实改善日常工作流。它提醒我们，良好的框架设计不仅要提供强大的功能，还要通过合理的默认配置来降低这些功能的使用门槛。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    User[开发者/用户] -->|启用| Feature_Tracy[trace_tracy 特性]
</span><span>    User -->|启用| Feature_Chrome[trace_chrome 特性]
</span><span>
</span><span>    Feature_Tracy -->|自动启用| Internal_Tracy[bevy_internal/trace_tracy]
</span><span>    Feature_Tracy -->|自动启用| Trace_Crate[trace]
</span><span>    Feature_Tracy -->|PR修改：自动启用| Debug_Info[debug 特性]
</span><span>
</span><span>    Feature_Chrome -->|自动启用| Internal_Chrome[bevy_internal/trace_chrome]
</span><span>    Feature_Chrome -->|自动启用| Trace_Crate
</span><span>    Feature_Chrome -->|PR修改：自动启用| Debug_Info
</span><span>
</span><span>    Debug_Info -->|影响构建| Output[输出包含调试符号的可执行文件]
</span><span>    Internal_Tracy -->|功能| Profiling[Tracy 性能分析]
</span><span>    Internal_Chrome -->|功能| Tracing[Chrome Tracing 文件]
</span><span>
</span><span>    Output -->|使能| ReadableSymbols[分析工具中显示可读的名称]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-cargo-toml>1. <code>Cargo.toml</code></h3><p><strong>修改描述与原因</strong>：修改了 <code>trace_chrome</code> 和 <code>trace_tracy</code> 两个 Cargo 特性的定义，为它们添加了对 <code>debug</code> 特性的依赖。这样，当用户启用任一追踪特性时，构建过程会自动包含调试信息，从而确保性能分析工具能显示完整的函数和类型名称。<p><strong>关键代码修改</strong>：<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># File: Cargo.toml
</span><span style=color:#abb0b6;font-style:italic># 修改前：
</span><span style=color:#399ee6>trace_chrome </span><span>= [</span><span style=color:#86b300>"trace"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_internal/trace_chrome"</span><span>]
</span><span style=color:#399ee6>trace_tracy </span><span>= [</span><span style=color:#86b300>"trace"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_internal/trace_tracy"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># 修改后：
</span><span style=color:#399ee6>trace_chrome </span><span>= [</span><span style=color:#86b300>"trace"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_internal/trace_chrome"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"debug"</span><span>]
</span><span style=color:#399ee6>trace_tracy </span><span>= [</span><span style=color:#86b300>"trace"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_internal/trace_tracy"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"debug"</span><span>]
</span></code></pre><p><strong>与 PR 目标的关联</strong>：这是实现 PR 目标的唯一且直接的修改。通过调整特性间的依赖关系，解决了用户需要手动同时启用两个特性才能获得有效追踪输出的问题。<h2 id=further-reading>Further Reading</h2><ol><li><strong>Cargo 文档 - 特性 (Features)</strong>: 了解 Cargo 特性的定义、依赖和条件编译是如何工作的。 <ul><li>https://doc.rust-lang.org/cargo/reference/features.html</ul><li><strong>Tracy 性能分析器</strong>: 了解这个强大的实时性能分析工具。 <ul><li>https://github.com/wolfpld/tracy</ul><li><strong>Chrome Tracing 格式</strong>: 了解 Chrome 开发者工具使用的追踪文件格式。 <ul><li>https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview</ul><li><strong>Rust 调试信息 (Debuginfo)</strong>: 了解 Rust 中如何生成和控制调试符号。 <ul><li>https://doc.rust-lang.org/rustc/codegen-options/index.html#debuginfo</ul></ol><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/Cargo.toml b/Cargo.toml index 036057fa254cf..3fb7d3923262a 100644 — a/Cargo.toml +++ b/Cargo.toml @@ -426,10 +426,10 @@ raw_vulkan_init = [“bevy_internal/raw_vulkan_init”] type_label_buffers = [“bevy_internal/type_label_buffers”]<h1 id=tracing-support-saving-a-file-in-chrome-tracing-format>Tracing support, saving a file in Chrome Tracing format</h1><p>-trace_chrome = [“trace”, “bevy_internal/trace_chrome”] +trace_chrome = [“trace”, “bevy_internal/trace_chrome”, “debug”]<h1 id=tracing-support-exposing-a-port-for-tracy>Tracing support, exposing a port for Tracy</h1><p>-trace_tracy = [“trace”, “bevy_internal/trace_tracy”] +trace_tracy = [“trace”, “bevy_internal/trace_tracy”, “debug”]<h1 id=tracing-support-with-memory-profiling-exposing-a-port-for-tracy>Tracing support, with memory profiling, exposing a port for Tracy</h1><p>trace_tracy_memory = [“bevy_internal/trace_tracy_memory”]</div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23048.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>