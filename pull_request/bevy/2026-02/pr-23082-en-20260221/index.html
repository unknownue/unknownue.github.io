<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23082 building bevy with only feature bevy_input_focus fails
        
    </title><meta content="#23082 building bevy with only feature bevy_input_focus fails" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-21</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-23082-zh-cn-20260221>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: building bevy with only feature bevy_input_focus fails<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/23082<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, A-UI, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-02-20T21:12:00Z<li><strong>Merged</strong>: 2026-02-21T01:03:16Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><h1 id=objective>Objective</h1><ul><li><code>cargo build --features bevy_input_focus --no-default-features</code> fails</ul><pre style=color:#61676c;background-color:#fafafa><code><span>error[E0599]: no method named `sqrt` found for type `f32` in the current scope
</span><span>   --> crates/bevy_input_focus/src/navigator.rs:112:40
</span><span>    |
</span><span>112 |     let distance = (dx * dx + dy * dy).sqrt();
</span><span>    |                                        ^^^^ method not found in `f32`
</span></code></pre><h2 id=solution>Solution</h2><ul><li>use <code>sqrt</code> from bevy_math</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward compilation issue in the Bevy engine. When building Bevy with only the <code>bevy_input_focus</code> feature enabled and without default features, the build fails due to a missing dependency on the standard library’s mathematical functions.<p>The problem occurs because when building without the standard library (a <code>no_std</code> context), certain mathematical methods like <code>f32::sqrt()</code> are not available. The <code>bevy_input_focus</code> crate contains a navigation system that calculates distances between UI elements, which requires computing square roots. The original code used the standard library’s <code>sqrt</code> method, which isn’t available when building without <code>std</code>.<p>The solution is pragmatic: instead of relying on the standard library’s mathematical functions, use Bevy’s own mathematical utilities. The <code>bevy_math</code> crate provides a <code>sqrt</code> function that works in both <code>std</code> and <code>no_std</code> contexts. This approach aligns with Bevy’s architecture, where the engine provides its own mathematical abstractions that work consistently across different compilation contexts.<p>The fix is minimal and focused - a single line change that replaces the method call <code>(dx * dx + dy * dy).sqrt()</code> with the function call <code>bevy_math::ops::sqrt(dx * dx + dy * dy)</code>. This change ensures that the navigation system works correctly regardless of whether the standard library is available, making the <code>bevy_input_focus</code> feature more robust and compatible with different build configurations.<p>This issue highlights an important consideration when developing features for Bevy: mathematical operations should use Bevy’s own math utilities rather than standard library methods when building features that need to work in <code>no_std</code> contexts. The <code>bevy_math</code> crate serves as an abstraction layer that provides consistent mathematical operations across different compilation targets and feature configurations.<p>The fix demonstrates good dependency management practice. By using <code>bevy_math::ops::sqrt</code>, the code explicitly declares its dependency on Bevy’s math utilities, making the build requirements clearer and ensuring compatibility with the engine’s architecture. This approach also future-proofs the code against changes in how mathematical operations are implemented in different compilation contexts.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_input_focus feature] --> B[build without default features]
</span><span>    B --> C{std available?}
</span><span>    C -->|No| D[Error: sqrt method not found]
</span><span>    C -->|Yes| E[Build succeeds]
</span><span>    F[Solution: use bevy_math::ops::sqrt] --> G[Works with or without std]
</span><span>    G --> H[Build succeeds in both contexts]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-input-focus-src-navigator-rs-1-1><code>crates/bevy_input_focus/src/navigator.rs</code> (+1/-1)</h3><p>This file contains the navigation logic for UI focus management. The change replaces a standard library method call with Bevy’s math utility function to ensure compatibility with <code>no_std</code> builds.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> distance </span><span style=color:#ed9366>= </span><span>(dx </span><span style=color:#ed9366>*</span><span> dx </span><span style=color:#ed9366>+</span><span> dy </span><span style=color:#ed9366>*</span><span> dy)</span><span style=color:#ed9366>.</span><span style=color:#f07171>sqrt</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> distance </span><span style=color:#ed9366>= </span><span>bevy_math</span><span style=color:#ed9366>::</span><span>ops</span><span style=color:#ed9366>::</span><span>sqrt(dx </span><span style=color:#ed9366>*</span><span> dx </span><span style=color:#ed9366>+</span><span> dy </span><span style=color:#ed9366>*</span><span> dy)</span><span style=color:#61676ccc>;
</span></code></pre><p>The change is in the <code>score_candidate</code> function, which calculates a distance score for UI navigation candidates. The function computes the Euclidean distance between UI elements using the Pythagorean theorem, which requires calculating the square root of the sum of squared differences. The switch to <code>bevy_math::ops::sqrt</code> ensures this calculation works correctly when building without the standard library.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_math/latest/bevy_math/ target=_blank>Bevy Math Documentation</a> - Documentation for Bevy’s mathematical utilities<li><a rel="noopener nofollow noreferrer" href=https://docs.rust-embedded.org/book/intro/no-std.html target=_blank>Rust no_std Programming</a> - Guide to writing Rust code without the standard library<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/features/ target=_blank>Bevy Features and Cargo</a> - How to work with Bevy’s feature system<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Rust Conditional Compilation</a> - Using features and conditional compilation in Rust</ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_input_focus/src/navigator.rs b/crates/bevy_input_focus/src/navigator.rs
</span><span>index 2e984b0088beb..d5504652b1432 100644
</span><span style=color:#c594c5>--- a/crates/bevy_input_focus/src/navigator.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_input_focus/src/navigator.rs
</span><span style=color:#c594c5>@@ -109,7 +109,7 @@ </span><span style=color:#399ee6>fn score_candidate(
</span><span>     let dy = (candidate_rect.min.y - origin_rect.max.y)
</span><span>         .max(origin_rect.min.y - candidate_rect.max.y)
</span><span>         .max(0.0);
</span><span style=color:#f07171>-    let distance = (dx * dx + dy * dy).sqrt();
</span><span style=color:#86b300>+    let distance = bevy_math::ops::sqrt(dx * dx + dy * dy);
</span><span> 
</span><span>     // Check max distance
</span><span>     if let Some(max_dist) = config.max_search_distance {
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23082.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>