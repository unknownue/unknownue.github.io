<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22757 Add example for triggering and recovering from rendering errors
        
    </title><meta content="#22757 Add example for triggering and recovering from rendering errors" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-03</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-02/pr-22757-en-20260203>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=add-example-for-triggering-and-recovering-from-rendering-errors>Add example for triggering and recovering from rendering errors</h1><h2 id=ji-ben-xin-xi>基本信息</h2><ul><li><strong>标题</strong>: Add example for triggering and recovering from rendering errors<li><strong>PR链接</strong>: https://github.com/bevyengine/bevy/pull/22757<li><strong>作者</strong>: atlv24<li><strong>状态</strong>: 已合并<li><strong>标签</strong>: A-Rendering, C-Examples, S-Ready-For-Final-Review, D-Modest<li><strong>创建时间</strong>: 2026-01-31T21:36:19Z<li><strong>合并时间</strong>: 2026-02-02T23:54:29Z<li><strong>合并者</strong>: alice-i-cecile</ul><h2 id=miao-shu-fan-yi>描述翻译</h2><h1 id=mu-biao>目标</h1><ul><li>用于渲染恢复的测试套件/演示</ul><h2 id=jie-jue-fang-an>解决方案</h2><ul><li>添加一个能够触发各种渲染错误的示例</ul><h2 id=ce-shi>测试</h2><ul><li>运行它</ul><p>注意：我单独提交这个PR，以便可以将bevy主分支的行为与即将到来的渲染恢复PR进行比较。它不一定需要先合并。<h2 id=zhe-ge-prde-ji-shu-gu-shi>这个PR的技术故事</h2><p>这个PR的核心目标很简单：创建一个用于测试和演示渲染错误恢复能力的示例应用。在现代图形API（如Vulkan、Metal、DirectX 12）和WebGPU中，渲染错误处理变得至关重要，因为这些API会暴露更多的底层细节，使得应用程序更容易遇到内存不足、验证错误或设备丢失等问题。<p>从技术角度看，这个示例有几个关键设计点：<p>首先，它建立了一个标准的三维场景（圆形基座、立方体、光源和旋转的摄像机），这为渲染提供了一个可见的基准状态。当渲染错误被触发时，开发者可以直观地看到渲染是否恢复正常。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 创建基本3D场景
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>setup</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>meshes</span><span style=color:#61676ccc>: </span><span>ResMut&LTAssets&LTMesh>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>materials</span><span style=color:#61676ccc>: </span><span>ResMut&LTAssets&LTStandardMaterial>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 圆形基座
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Mesh3d(meshes</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(Circle</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>4.0</span><span>)))</span><span style=color:#61676ccc>,
</span><span>        MeshMaterial3d(materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(Color</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>WHITE</span><span>))</span><span style=color:#61676ccc>,
</span><span>        Transform</span><span style=color:#ed9366>::</span><span>from_rotation(Quat</span><span style=color:#ed9366>::</span><span>from_rotation_x(</span><span style=color:#ed9366>-</span><span>std</span><span style=color:#ed9366>::</span><span>f32</span><span style=color:#ed9366>::</span><span>consts</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FRAC_PI_2</span><span>))</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 立方体
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Mesh3d(meshes</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(Cuboid</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>2.0</span><span>)))</span><span style=color:#61676ccc>,
</span><span>        MeshMaterial3d(materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(Color</span><span style=color:#ed9366>::</span><span>srgb_u8(</span><span style=color:#ff8f40>124</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>144</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>255</span><span>)))</span><span style=color:#61676ccc>,
</span><span>        Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 光源
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        PointLight {
</span><span>            shadow_maps_enabled</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>        Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ff8f40>4.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>8.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>4.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 摄像机
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Camera3d</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>        Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>2.5</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>4.5</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>9.0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>looking_at</span><span>(Vec3</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#61676ccc>, </span><span>Vec3</span><span style=color:#ed9366>::</span><span>Y)</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>第二，这个示例实现了四种不同类型的渲染错误，每种都模拟了真实场景中可能遇到的问题：<ol><li><strong>内存不足错误（OutOfMemory）</strong>：通过循环创建64个8192×8192的RGBA16Float纹理来耗尽GPU内存。<li><strong>验证错误（Validation）</strong>：尝试创建一个大小为2^63的缓冲区，这超出了有效范围。<li><strong>设备丢失错误（DeviceLost）</strong>：主动销毁渲染设备，模拟硬件故障或驱动程序崩溃。<li><strong>无限循环错误（Loop）</strong>：创建一个包含无限循环的计算着色器，导致GPU挂起。</ol><p>这些错误是通过一个枚举类型<code>RenderError</code>和对应的输入系统来控制的：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> ExtractResource</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>enum </span><span style=color:#399ee6>RenderError </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>default</span><span>]
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>,
</span><span>    OutOfMemory</span><span style=color:#61676ccc>,
</span><span>    Validation</span><span style=color:#61676ccc>,
</span><span>    DeviceLost</span><span style=color:#61676ccc>,
</span><span>    Loop</span><span style=color:#61676ccc>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>input</span><span>(</span><span style=color:#ff8f40>input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKey>>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>error</span><span style=color:#61676ccc>: </span><span>ResMut&LTRenderError>) {
</span><span>    </span><span style=color:#ed9366>*</span><span>error </span><span style=color:#ed9366>= </span><span>RenderError</span><span style=color:#ed9366>::</span><span>None</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(Key</span><span style=color:#ed9366>::</span><span>Character(</span><span style=color:#86b300>"o"</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())) {
</span><span>        </span><span style=color:#ed9366>*</span><span>error </span><span style=color:#ed9366>= </span><span>RenderError</span><span style=color:#ed9366>::</span><span>OutOfMemory</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#fa6e32>if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(Key</span><span style=color:#ed9366>::</span><span>Character(</span><span style=color:#86b300>"v"</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())) {
</span><span>        </span><span style=color:#ed9366>*</span><span>error </span><span style=color:#ed9366>= </span><span>RenderError</span><span style=color:#ed9366>::</span><span>Validation</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#fa6e32>if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(Key</span><span style=color:#ed9366>::</span><span>Character(</span><span style=color:#86b300>"d"</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())) {
</span><span>        </span><span style=color:#ed9366>*</span><span>error </span><span style=color:#ed9366>= </span><span>RenderError</span><span style=color:#ed9366>::</span><span>DeviceLost</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#fa6e32>if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(Key</span><span style=color:#ed9366>::</span><span>Character(</span><span style=color:#86b300>"l"</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())) {
</span><span>        </span><span style=color:#ed9366>*</span><span>error </span><span style=color:#ed9366>= </span><span>RenderError</span><span style=color:#ed9366>::</span><span>Loop</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>第三，错误触发逻辑运行在渲染子应用（RenderApp）中，这是Bevy的渲染系统架构的一部分。通过使用<code>ExtractResourcePlugin</code>，<code>RenderError</code>资源可以从主应用提取到渲染应用中：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> app </span><span style=color:#ed9366>= </span><span>App</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>((
</span><span>        DefaultPlugins</span><span style=color:#61676ccc>,
</span><span>        ExtractResourcePlugin</span><span style=color:#ed9366>::</span><span>&LTRenderError></span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>    ))
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Startup</span><span style=color:#61676ccc>,</span><span> setup)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>, </span><span>(update_camera</span><span style=color:#61676ccc>,</span><span> input))
</span><span>    </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTRenderError>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>sub_app_mut</span><span>(RenderApp)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Render</span><span style=color:#61676ccc>,</span><span> cause_error)</span><span style=color:#61676ccc>;
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>这种架构设计确保了错误触发逻辑只在渲染线程中执行，这是必要的，因为渲染资源（如<code>RenderDevice</code>和<code>RenderQueue</code>）只能在渲染上下文中访问。<p>技术实现上，<code>cause_error</code>函数使用<code>If&LTRes&LTRenderError>></code>条件系统来避免在没有错误时执行开销大的操作：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>cause_error</span><span>(</span><span style=color:#ff8f40>error</span><span style=color:#61676ccc>: </span><span>If&LTRes&LTRenderError>>, </span><span style=color:#ff8f40>device</span><span style=color:#61676ccc>: </span><span>Res&LTRenderDevice>, </span><span style=color:#ff8f40>queue</span><span style=color:#61676ccc>: </span><span>Res&LTRenderQueue>) {
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#ed9366>**</span><span>error {
</span><span>        RenderError</span><span style=color:#ed9366>::</span><span>None </span><span style=color:#ed9366>=> </span><span>{}
</span><span>        RenderError</span><span style=color:#ed9366>::</span><span>OutOfMemory </span><span style=color:#ed9366>=> </span><span>{
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// 创建大量大纹理以耗尽内存
</span><span>            </span><span style=color:#fa6e32>let mut</span><span> textures </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Vec</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>for </span><span style=color:#ed9366>_ in </span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>64 </span><span>{
</span><span>                textures</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(device</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_texture</span><span>(</span><span style=color:#ed9366>&</span><span>TextureDescriptor {
</span><span>                    label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>,
</span><span>                    size</span><span style=color:#61676ccc>:</span><span> Extent3d {
</span><span>                        width</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>8192</span><span style=color:#61676ccc>,
</span><span>                        height</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>8192</span><span style=color:#61676ccc>,
</span><span>                        depth_or_array_layers</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>,
</span><span>                    }</span><span style=color:#61676ccc>,
</span><span>                    </span><span style=color:#abb0b6;font-style:italic>// ... 省略其他字段
</span><span>                }))</span><span style=color:#61676ccc>;
</span><span>            }
</span><span>        }
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... 其他错误类型
</span><span>    }
</span><span>}
</span></code></pre><p>这个PR的一个重要背景是作者在描述中提到的：它是为了配合一个即将到来的“渲染恢复PR“而创建的。这意味着这个示例不仅仅是一个演示，而是一个测试工具，用于验证Bevy渲染系统在遇到各种错误时能否正确恢复。<p>从工程角度看，这个示例展示了几个有用的模式：<ol><li>如何在Bevy中安全地触发和管理渲染错误<li>如何使用<code>ExtractResource</code>在应用和渲染应用之间传递状态<li>如何编写条件系统以避免不必要的计算开销<li>如何构建一个交互式示例，让开发者可以按需测试不同的错误场景</ol><h2 id=ke-shi-hua-biao-shi>可视化表示</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[主应用 Main App] -->|ExtractResource| B[渲染应用 Render App]
</span><span>    B --> C[渲染设备 RenderDevice]
</span><span>    B --> D[渲染队列 RenderQueue]
</span><span>    E[用户输入] -->|设置RenderError| A
</span><span>    A -->|传递RenderError| B
</span><span>    B -->|根据RenderError触发| F[特定渲染错误]
</span><span>    
</span><span>    F --> G[内存不足 OutOfMemory]
</span><span>    F --> H[验证错误 Validation]
</span><span>    F --> I[设备丢失 DeviceLost]
</span><span>    F --> J[无限循环 Loop]
</span><span>    
</span><span>    G -->|大量纹理分配| C
</span><span>    H -->|无效缓冲区创建| C
</span><span>    I -->|destroy()调用| C
</span><span>    J -->|无限循环着色器| D
</span></code></pre><h2 id=guan-jian-wen-jian-bian-geng>关键文件变更</h2><h3 id=examples-app-render-recovery-rs-182-0><code>examples/app/render_recovery.rs</code> (+182/-0)</h3><p>这是一个全新的示例文件，实现了渲染错误触发和恢复的演示应用。<p><strong>主要实现内容：</strong><ol><li>创建基本的3D场景用于视觉验证<li>定义<code>RenderError</code>枚举作为可提取的资源<li>实现输入系统来切换不同的错误类型<li>在渲染系统中实现具体错误触发逻辑</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 关键代码片段：无限循环错误实现
</span><span>RenderError</span><span style=color:#ed9366>::</span><span>Loop </span><span style=color:#ed9366>=> </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> sm </span><span style=color:#ed9366>=</span><span> device</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_and_validate_shader_module</span><span>(ShaderModuleDescriptor {
</span><span>        label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#86b300>"shader"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        source</span><span style=color:#61676ccc>: </span><span>ShaderSource</span><span style=color:#ed9366>::</span><span>Wgsl(
</span><span>            </span><span style=color:#86b300>"@compute @workgroup_size(1, 1, 1) fn main() { loop { workgroupBarrier(); } }"
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>,
</span><span>        )</span><span style=color:#61676ccc>,
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 创建计算管线并调度
</span><span>    </span><span style=color:#fa6e32>let</span><span> pipeline </span><span style=color:#ed9366>=</span><span> device</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_compute_pipeline</span><span>(</span><span style=color:#ed9366>&</span><span>RawComputePipelineDescriptor {
</span><span>        label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#86b300>"pipeline"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... 省略其他参数
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> encoder </span><span style=color:#ed9366>=</span><span> device</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_command_encoder</span><span>(</span><span style=color:#ed9366>&</span><span>CommandEncoderDescriptor</span><span style=color:#ed9366>::</span><span>default())</span><span style=color:#61676ccc>;
</span><span>    {
</span><span>        </span><span style=color:#fa6e32>let mut</span><span> cpass </span><span style=color:#ed9366>=</span><span> encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_compute_pass</span><span>(</span><span style=color:#ed9366>&</span><span>ComputePassDescriptor</span><span style=color:#ed9366>::</span><span>default())</span><span style=color:#61676ccc>;
</span><span>        cpass</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_pipeline</span><span>(</span><span style=color:#ed9366>&</span><span>pipeline)</span><span style=color:#61676ccc>;
</span><span>        cpass</span><span style=color:#ed9366>.</span><span style=color:#f07171>dispatch_workgroups</span><span>(</span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1</span><span>)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    device</span><span style=color:#ed9366>.</span><span style=color:#f07171>poll</span><span>(PollType</span><span style=color:#ed9366>::</span><span>wait_indefinitely())</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    queue</span><span style=color:#ed9366>.</span><span style=color:#f07171>submit</span><span>([encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>finish</span><span>()])</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=cargo-toml-11-0><code>Cargo.toml</code> (+11/-0)</h3><p>添加了新的示例配置到Bevy的示例列表中。<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># 添加的配置
</span><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"render_recovery"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/app/render_recovery.rs"
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>true
</span><span>
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>example</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>render_recovery</span><span>]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"Render Recovery"
</span><span style=color:#399ee6>description </span><span>= </span><span style=color:#86b300>"Demonstrates how bevy can recover from rendering failures."
</span><span style=color:#399ee6>category </span><span>= </span><span style=color:#86b300>"Application"
</span><span style=color:#399ee6>wasm </span><span>= </span><span style=color:#ff8f40>false
</span></code></pre><h3 id=examples-readme-md-1-0><code>examples/README.md</code> (+1/-0)</h3><p>在示例文档中添加了新示例的条目。<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#fa6e32;font-weight:700># </span><span style=color:#399ee6;font-weight:700>添加的行
</span><span>[Render Recovery](</span><span style=color:#4cbf99;font-style:italic;text-decoration:underline>../examples/app/render_recovery.rs</span><span>) | Demonstrates how bevy can recover from rendering failures.
</span></code></pre><h2 id=jin-yi-bu-yue-du>进一步阅读</h2><ol><li><strong>WebGPU错误处理规范</strong>: https://www.w3.org/TR/webgpu/#errors-and-debugging<li><strong>Bevy渲染架构文档</strong>: https://bevyengine.org/learn/book/getting-started/architecture/<li><strong>Vulkan错误处理最佳实践</strong>: https://vulkan-tutorial.com/Drawing_a_triangle/Drawing/Frame_buffers<li><strong>Bevy提取系统（Extract System）</strong>: 了解<code>ExtractResourcePlugin</code>如何工作以及如何在主应用和渲染应用之间传递数据<li><strong>GPU驱动错误恢复机制</strong>: 不同GPU厂商（NVIDIA、AMD、Intel）如何处理设备丢失和恢复</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22757.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>