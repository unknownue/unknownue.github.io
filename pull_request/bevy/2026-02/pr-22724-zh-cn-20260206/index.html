<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22724 Add padding for color_plane widget for wasm/webgl compat
        
    </title><meta content="#22724 Add padding for color_plane widget for wasm/webgl compat" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-06</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-02/pr-22724-en-20260206>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=ji-ben-zi-liao>基本资料</h2><ul><li><strong>标题</strong>: Add padding for color_plane widget for wasm/webgl compat<li><strong>PR 链接</strong>: https://github.com/bevyengine/bevy/pull/22724<li><strong>作者</strong>: mitchty<li><strong>状态</strong>: 已合并<li><strong>标签</strong>: C-Bug, A-Rendering, A-UI, S-Ready-For-Final-Review, D-Straightforward<li><strong>创建时间</strong>: 2026-01-27T14:51:05Z<li><strong>合并时间</strong>: 2026-02-06T20:08:32Z<li><strong>合并者</strong>: alice-i-cecile</ul><h2 id=miao-shu-fan-yi>描述翻译</h2><h1 id=mu-biao>目标</h1><ul><li>描述此PR旨在解决的目标或问题。<li>如果你正在修复一个特定问题，请说“修复 #X”。</ul><p>新的 bevy feathers 颜色平面控件（color plane widget）在使用的 f32 上引发了 wgpu 对齐问题。为了让 wasm 构建能够使用这个控件，添加类似于现有着色器/材质的填充（padding）。<p>注意，这是我的第一次贡献，我对名字之类的都很随意，所以如果我起的名字很糟糕，我可以更改，我并不过分执着于这些名字。<h2 id=jie-jue-fang-an>解决方案</h2><ul><li>描述用于实现上述目标的解决方案。</ul><p>在 uniform 和材质结构中添加一个 Vec3 填充，以便在 wasm 构建上填充到 16 字节。<h2 id=ce-shi>测试</h2><ul><li>你测试了这些更改吗？如果是，是如何测试的？</ul><p>是的，在 Linux（Wayland，但如果需要我也可以测试 X）、macOS 和 Windows 上构建了修改前和修改后的版本。这些都像之前一样继续正常工作。并在 Safari/Firefox/Chrome（大多是这些浏览器的最新版本）的 wasm 上进行了测试，这3个浏览器在通过 cargo patch 应用此修复后，都无法渲染着色器控件，现在都正常了，并且工作方式与本机构建相同。<ul><li><p>是否有任何部分需要更多测试？ 也许？我不确定我是否足够了解，可以对此发表权威意见。我从未为 web 编程，这对我来说只是 wasm 上一个有趣的项目，老实说，我不知道我做的这些是否正确。真正的 web 程序员应该对这些内容表示赞成/反对，我只是个游客。</p><li><p>其他人（审阅者）如何测试你的更改？他们需要了解什么特别的信息吗？ 只需在 wasm 上使用颜色控件进行测试/构建。我所做的就是使用 cargo patch 指向修复后的版本，如下所示：</p></ul><p>针对 0.18.1 发布分支的相同补丁：<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>bevy </span><span>= { </span><span style=color:#399ee6>git </span><span>= </span><span style=color:#86b300>"https://github.com/mitchty/bevy"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>branch </span><span>= </span><span style=color:#86b300>"colorplane-wasm" </span><span>}
</span></code></pre><p>此分支：<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>bevy </span><span>= { </span><span style=color:#399ee6>git </span><span>= </span><span style=color:#86b300>"https://github.com/mitchty/bevy"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>branch </span><span>= </span><span style=color:#86b300>"colorplane-wasm-fix" </span><span>}
</span></code></pre><ul><li>如果相关，你在哪些平台上测试了这些更改，有哪些重要的平台你无法测试？ 我尝试在我设置交叉编译的所有系统上进行测试，我想/希望这包括了大部分系统。</ul><h2 id=ben-ci-prde-lai-long-qu-mai>本次PR的来龙去脉</h2><p>这个PR源于一个典型的跨平台渲染兼容性问题。Bevy的feathers UI库引入了一个新的<code>color_plane</code>控件，它允许用户通过二维平面选择颜色。在本地平台（Windows、macOS、Linux）上，这个控件工作正常，但在通过WebAssembly（WASM）在浏览器中运行时，特别是在WebGL后端下，这个控件无法渲染，并且控制台会报告着色器相关的wgpu对齐错误。<p>问题的核心在于内存布局和对齐要求。在WGSL（WebGPU Shading Language）中，标量类型<code>f32</code>的字节对齐要求通常是其大小（4字节）。然而，当结构体用作uniform缓冲区时，某些平台和API（尤其是WebGL 2）对uniform块内的成员有更严格的对齐限制。通常，为了性能和兼容性，uniform缓冲区成员需要对齐到16字节边界。如果不满足这个要求，WebGL驱动可能会拒绝编译着色器或在运行时产生未定义行为。<p>具体到这个<code>color_plane</code>控件，它的着色器最初定义了一个单独的<code>fixed_channel: f32</code> uniform变量。在CPU端的Rust代码中，对应的材质结构体<code>ColorPlaneMaterial</code>也只包含一个<code>fixed_channel: f32</code>字段。这个结构体的大小是4字节。当这个数据被上传到GPU作为uniform缓冲区时，在WebGL环境下，它可能没有满足16字节对齐的要求，从而导致了错误。<p>开发者<code>mitchty</code>采取的解决方案是标准的“填充（padding）”技术。这个方案不是首创，在Bevy代码库的其他部分（如其他着色器和材质）已经有先例。解决思路很直接：通过在数据结构中添加一个无用的填充字段，强制将整个结构体的大小和对齐扩展到目标平台（这里是16字节）的要求。<p>实现分为两个部分，需要在CPU（Rust）和GPU（WGSL）两边保持同步。<p>首先，在WGSL着色器文件（<code>color_plane.wgsl</code>）中，开发者将单独的<code>fixed_channel</code> uniform变量包装进一个名为<code>ColorPlaneUniform</code>的结构体中。然后，他们使用预处理器指令<code>#ifdef SIXTEEN_BYTE_ALIGNMENT</code>来条件性地添加一个<code>vec3&LTf32></code>类型的填充字段<code>_webgl2_padding_12b</code>。一个<code>vec3&LTf32></code>占用12字节（3个f32）。加上原有的4字节<code>fixed_channel</code>，总大小正好是16字节，满足了对齐要求。着色器代码中所有使用<code>fixed_channel</code>的地方都改为通过结构体访问<code>uniform_data.fixed_channel</code>。这个<code>SIXTEEN_BYTE_ALIGNMENT</code>标志预计由Bevy的着色器预处理系统在针对WebGL构建时自动定义。<p>其次，在Rust端的材质结构体<code>ColorPlaneMaterial</code>中，也需要添加相应的填充字段。这里使用了Rust的条件编译属性（<code>#[cfg(...)]</code>）来精确控制字段的存在。该字段仅在同时满足三个条件时添加：<ol><li>启用了<code>"webgl"</code>特性（<code>feature = "webgl"</code>）。<li>目标架构是<code>wasm32</code>（<code>target_arch = "wasm32"</code>）。<li><strong>没有</strong>启用<code>"webgpu"</code>特性（<code>not(feature = "webgpu")</code>）。</ol><p>这个逻辑非常关键。它确保了填充只会在以WebAssembly为目标、并且使用WebGL后端（而不是更新的WebGPU后端）时添加。在原生平台或使用WebGPU时，则不需要这个填充，避免了不必要的内存开销。填充字段被命名为<code>_webgl2_padding_12b</code>（下划线开头表示有意未使用），类型为<code>Vec3</code>。在创建材质实例的<code>update_plane_color</code>系统函数中，也相应地使用<code>#[cfg(...)]</code>来初始化这个字段为默认值（<code>Default::default()</code>）。<p>除了核心的代码修改，这个PR还做了两项必要的配套更改：<ol><li>在<code>bevy_feathers</code>的<code>Cargo.toml</code>中声明了<code>webgl</code>和<code>webgpu</code>这两个特性。这两个特性最初可能是空的，但它们的声明使得其他crate（如<code>bevy_internal</code>）可以条件性地依赖它们。<li>在<code>bevy_internal</code>的<code>Cargo.toml</code>中，将<code>bevy_feathers</code>的可选依赖（<code>bevy_feathers?</code>）添加到了<code>webgl</code>和<code>webgpu</code>特性列表中。这使得当用户启用Bevy的<code>webgl</code>或<code>webgpu</code>特性时，会自动启用<code>bevy_feathers</code> crate的相应特性，从而触发条件编译代码路径。</ol><p>这个解决方案的影响是立竿见影且积极的。它修复了<code>color_plane</code>控件在浏览器中的渲染问题，使其行为与本地平台一致。从工程角度看，这个PR展示了几个重要的实践：<ul><li><strong>平台特定的兼容性处理</strong>：通过条件编译，优雅地处理了不同图形后端（WebGL vs WebGPU vs 原生）的不同内存对齐要求。<li><strong>保持代码清晰</strong>：填充字段的命名清晰地表明了其目的和适用环境（<code>_webgl2_padding_12b</code>）。<li><strong>最小化变更</strong>：只添加了必要的填充，没有改动控件的核心逻辑或着色器算法。<li><strong>遵循现有模式</strong>：解决方案借鉴了代码库中已有的处理方式，保持了一致性。</ul><p>值得一提的是，作者<code>mitchty</code>在描述中谦称自己是“web编程的游客”，但其实现非常精准和专业，直接命中了WebGL uniform缓冲区对齐这个经典问题，并给出了正确的解决方案。<h2 id=shi-jue-tu-shi>视觉图示</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph “构建配置层”
</span><span>        BEVY_INTERNAL_Cargo[bevy_internal/Cargo.toml]
</span><span>        BFEATURES_Cargo[bevy_feathers/Cargo.toml]
</span><span>    end
</span><span>
</span><span>    subgraph “运行时/着色器层”
</span><span>        BFEATURES_RS[bevy_feathers/src/controls/color_plane.rs]
</span><span>        BFEATURES_WGSL[bevy_feathers/src/assets/shaders/color_plane.wgsl]
</span><span>    end
</span><span>
</span><span>    BFEATURES_Cargo -- “声明 webgl/webgpu features” --> BFEATURES_RS
</span><span>    BFEATURES_Cargo -- “声明 webgl/webgpu features” --> BFEATURES_WGSL
</span><span>    BEVY_INTERNAL_Cargo -- “传递 features” --> BFEATURES_Cargo
</span><span>    BFEATURES_RS -- “CPU端结构体定义与填充” --> BFEATURES_WGSL
</span><span>    BFEATURES_WGSL -- “GPU端Uniform结构体定义与填充” --> BFEATURES_RS
</span></code></pre><h2 id=guan-jian-wen-jian-bian-geng>关键文件变更</h2><ol><li><p><strong><code>crates/bevy_feathers/src/assets/shaders/color_plane.wgsl</code></strong></p> <ul><li><strong>变更描述</strong>: 修改了WGSL着色器代码，将独立的uniform变量包装进一个结构体，并条件性地添加一个<code>vec3&LTf32></code>填充字段以满足16字节对齐。这是修复WebGL兼容性的核心。<li><strong>关键代码片段</strong>:<pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// 修改后：
</span><span>struct ColorPlaneUniform {
</span><span>  fixed_channel : f32,
</span><span>#ifdef SIXTEEN_BYTE_ALIGNMENT
</span><span>  _webgl2_padding_12b : vec3&LTf32>,
</span><span>#endif
</span><span>}
</span><span>
</span><span>@group(1) @binding(0) var&LTuniform> uniform_data : ColorPlaneUniform;
</span></code></pre><li><strong>与PR目的的关系</strong>: 确保在GPU端，uniform缓冲区的数据布局符合WebGL的严格对齐要求。</ul><li><p><strong><code>crates/bevy_feathers/src/controls/color_plane.rs</code></strong></p> <ul><li><strong>变更描述</strong>: 在Rust的材质结构体<code>ColorPlaneMaterial</code>中条件性地添加了一个<code>Vec3</code>填充字段，并在材质创建时初始化它。这确保了从CPU上传到GPU的数据结构与着色器的期望布局完全匹配。<li><strong>关键代码片段</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 在 ColorPlaneMaterial 结构体内添加：
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"webgl"</span><span style=color:#61676ccc>,</span><span> target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"webgpu"</span><span>)))]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>uniform</span><span>(0)]
</span><span>_webgl2_padding_12b</span><span style=color:#61676ccc>:</span><span> Vec3</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 在创建材质时初始化：
</span><span style=color:#fa6e32>let</span><span> material </span><span style=color:#ed9366>=</span><span> r_materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(ColorPlaneMaterial {
</span><span>    plane</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>*</span><span>plane</span><span style=color:#61676ccc>,
</span><span>    fixed_channel</span><span style=color:#61676ccc>:</span><span> plane_value</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span>z</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"webgl"</span><span style=color:#61676ccc>,</span><span> target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"webgpu"</span><span>)))]
</span><span>    _webgl2_padding_12b</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><li><strong>与PR目的的关系</strong>: 在CPU端提供与WGSL着色器对应的填充数据，并精确控制其只在需要的平台（WASM+WebGL）上存在。</ul><li><p><strong><code>crates/bevy_feathers/Cargo.toml</code> 和 <code>crates/bevy_internal/Cargo.toml</code></strong></p> <ul><li><strong>变更描述</strong>: 这两个文件添加了特性声明和传递。<code>bevy_feathers</code>声明了<code>webgl</code>和<code>webgpu</code>特性，<code>bevy_internal</code>则将这些特性链接到主crate的特性集上。<li><strong>关键代码片段</strong>:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># bevy_feathers/Cargo.toml
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>webgl </span><span>= []
</span><span style=color:#399ee6>webgpu </span><span>= []
</span><span>
</span><span style=color:#abb0b6;font-style:italic># bevy_internal/Cargo.toml
</span><span style=color:#399ee6>webgl </span><span>= [
</span><span>  </span><span style=color:#f51818>...</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_feathers?/webgl"</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic># 新增
</span><span>]
</span><span style=color:#399ee6>webgpu </span><span>= [
</span><span>  </span><span style=color:#f51818>...</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_feathers?/webgpu"</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic># 新增
</span><span>]
</span></code></pre><li><strong>与PR目的的关系</strong>: 建立起条件编译的通道。当用户使用<code>cargo build --features bevy/webgl</code>时，会最终启用<code>bevy_feathers/webgl</code>特性，从而激活上述Rust代码中的条件编译块。</ul></ol><h2 id=yan-shen-yue-du>延伸阅读</h2><ul><li><strong><a rel="noopener nofollow noreferrer" href=https://www.w3.org/TR/WGSL/#memory-layout target=_blank>WGSL Specification - Memory Layout</a></strong>: 官方WGSL规范中关于内存布局、结构体成员对齐和尺寸的详细说明。<li><strong><a rel="noopener nofollow noreferrer" href=https://www.khronos.org/registry/webgl/specs/latest/2.0/#5.23 target=_blank>WebGL 2.0 Specification - Uniform Buffer Layout</a></strong>: 关于WebGL 2.0中Uniform Buffer Object（UBO）布局和std140布局规则的官方文档。<li><strong>Bevy 官方文档 - 着色器</strong>: 了解Bevy如何处理和预处理着色器，以及如何定义材质和uniform。<li><strong>文章：<a rel="noopener nofollow noreferrer" href=https://webgl2fundamentals.org/webgl/lessons/webgl2-uniform-blocks.html target=_blank>《WebGL 2 Uniform Buffer Objects》</a></strong>: 关于WebGL 2中Uniform Buffer Objects的实用教程，涵盖了std140布局规则。</ul><h1 id=full-code-diff>Full Code Diff</h1><p>（此处按用户要求，完整附上了PR的diff内容）<pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_feathers/Cargo.toml b/crates/bevy_feathers/Cargo.toml
</span><span>index 5d2ee7860aeda..0247e9690fc9e 100644
</span><span>--- a/crates/bevy_feathers/Cargo.toml
</span><span>+++ b/crates/bevy_feathers/Cargo.toml
</span><span>@@ -40,6 +40,8 @@ accesskit = "0.23"
</span><span> [features]
</span><span> default = []
</span><span> custom_cursor = ["bevy_window/custom_cursor"]
</span><span>+webgl = []
</span><span>+webgpu = []
</span><span> 
</span><span> [lints]
</span><span> workspace = true
</span><span>diff --git a/crates/bevy_feathers/src/assets/shaders/color_plane.wgsl b/crates/bevy_feathers/src/assets/shaders/color_plane.wgsl
</span><span>index 738c74937c29e..9a808be46b6ad 100644
</span><span>--- a/crates/bevy_feathers/src/assets/shaders/color_plane.wgsl
</span><span>+++ b/crates/bevy_feathers/src/assets/shaders/color_plane.wgsl
</span><span>@@ -5,21 +5,28 @@
</span><span>     hsl_to_linear_rgb,
</span><span> }
</span><span> 
</span><span>-@group(1) @binding(0) var&LTuniform> fixed_channel: f32;
</span><span>+struct ColorPlaneUniform {
</span><span>+  fixed_channel : f32,
</span><span>+#ifdef SIXTEEN_BYTE_ALIGNMENT
</span><span>+  _webgl2_padding_12b : vec3&LTf32>,
</span><span>+#endif
</span><span>+}
</span><span>+
</span><span>+@group(1) @binding(0) var&LTuniform> uniform_data : ColorPlaneUniform;
</span><span> 
</span><span> @fragment
</span><span> fn fragment(in: UiVertexOutput) -> @location(0) vec4&LTf32> {
</span><span>     let uv = in.uv;
</span><span> #ifdef PLANE_RG
</span><span>-    return vec4(srgb_to_linear_rgb(vec3(uv.x, uv.y, fixed_channel)), 1.0);
</span><span>+    return vec4(srgb_to_linear_rgb(vec3(uv.x, uv.y, uniform_data.fixed_channel)), 1.0);
</span><span> #else ifdef PLANE_RB
</span><span>-    return vec4(srgb_to_linear_rgb(vec3(uv.x, fixed_channel, uv.y)), 1.0);
</span><span>+    return vec4(srgb_to_linear_rgb(vec3(uv.x, uniform_data.fixed_channel, uv.y)), 1.0);
</span><span> #else ifdef PLANE_GB
</span><span>-    return vec4(srgb_to_linear_rgb(vec3(fixed_channel, uv.x, uv.y)), 1.0);
</span><span>+    return vec4(srgb_to_linear_rgb(vec3(uniform_data.fixed_channel, uv.x, uv.y)), 1.0);
</span><span> #else ifdef PLANE_HS
</span><span>-    return vec4(hsl_to_linear_rgb(vec3(uv.x, 1.0 - uv.y, fixed_channel)), 1.0);
</span><span>+    return vec4(hsl_to_linear_rgb(vec3(uv.x, 1.0 - uv.y, uniform_data.fixed_channel)), 1.0);
</span><span> #else ifdef PLANE_HL
</span><span>-    return vec4(hsl_to_linear_rgb(vec3(uv.x, fixed_channel, 1.0 - uv.y)), 1.0);
</span><span>+    return vec4(hsl_to_linear_rgb(vec3(uv.x, uniform_data.fixed_channel, 1.0 - uv.y)), 1.0);
</span><span> #else
</span><span>     // Error color
</span><span>     return vec4(1.0, 0.0, 1.0, 1.0);
</span><span>diff --git a/crates/bevy_feathers/src/controls/color_plane.rs b/crates/bevy_feathers/src/controls/color_plane.rs
</span><span>index c0398fe8b47cb..8051a74748124 100644
</span><span>--- a/crates/bevy_feathers/src/controls/color_plane.rs
</span><span>+++ b/crates/bevy_feathers/src/controls/color_plane.rs
</span><span>@@ -84,6 +84,10 @@ struct ColorPlaneMaterial {
</span><span> 
</span><span>     #[uniform(0)]
</span><span>     fixed_channel: f32,
</span><span>+
</span><span>+    #[cfg(all(feature = "webgl", target_arch = "wasm32", not(feature = "webgpu")))]
</span><span>+    #[uniform(0)]
</span><span>+    _webgl2_padding_12b: Vec3,
</span><span> }
</span><span> 
</span><span> impl From<&ColorPlaneMaterial> for ColorPlaneMaterialKey {
</span><span>@@ -207,6 +211,8 @@ fn update_plane_color(
</span><span>             let material = r_materials.add(ColorPlaneMaterial {
</span><span>                 plane: *plane,
</span><span>                 fixed_channel: plane_value.0.z,
</span><span>+                #[cfg(all(feature = "webgl", target_arch = "wasm32", not(feature = "webgpu")))]
</span><span>+                _webgl2_padding_12b: Default::default(),
</span><span>             });
</span><span>             commands.entity(*inner_ent).insert(MaterialNode(material));
</span><span>         }
</span><span>diff --git a/crates/bevy_internal/Cargo.toml b/crates/bevy_internal/Cargo.toml
</span><span>index 25fe37c361b53..49271579c6c85 100644
</span><span>--- a/crates/bevy_internal/Cargo.toml
</span><span>+++ b/crates/bevy_internal/Cargo.toml
</span><span>@@ -191,6 +191,7 @@ webgl = [
</span><span>   "bevy_gizmos_render?/webgl",
</span><span>   "bevy_sprite_render?/webgl",
</span><span>   "bevy_dev_tools?/webgl",
</span><span>+  "bevy_feathers?/webgl",
</span><span> ]
</span><span> 
</span><span> webgpu = [
</span><span>@@ -201,6 +202,7 @@ webgpu = [
</span><span>   "bevy_gizmos_render?/webgpu",
</span><span>   "bevy_sprite_render?/webgpu",
</span><span>   "bevy_dev_tools?/webgpu",
</span><span>+  "bevy_feathers?/webgpu",
</span><span> ]
</span><span> 
</span><span> # Enable systems that allow for automated testing on CI
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22724.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>