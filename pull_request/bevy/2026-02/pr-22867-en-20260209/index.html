<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22867 Add marker for Extract Resource
        
    </title><meta content="#22867 Add marker for Extract Resource" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22867-zh-cn-20260209>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Add marker for ExtractResource<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add marker for Extract Resource<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22867<li><strong>Author</strong>: Zeophlite<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Usability, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2026-02-08T08:37:07Z<li><strong>Merged</strong>: 2026-02-09T23:06:33Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Followup to https://github.com/bevyengine/bevy/pull/22766<li>Step towards https://github.com/bevyengine/bevy/pull/22852</ul><h2 id=solution>Solution</h2><ul><li>Add marker to <code>ExtractResouce</code><li>Pass marker to <code>SyncComponent</code></ul><h2 id=testing>Testing</h2><ul><li><code>cargo run --example animated_mesh</code></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR is part of an ongoing effort to improve the extensibility of Bevy’s rendering system by addressing Rust’s orphan rules. The orphan rule in Rust prevents implementing a trait for a type unless either the trait or the type is defined in the current crate. This limitation becomes problematic when developers want to implement Bevy’s extraction traits for types from external crates.<p>The problem manifests in two key rendering systems: component extraction and resource extraction. Component extraction had already received a marker type solution in a previous PR (#22766), allowing developers to work around orphan rules by using a local type as a marker parameter. However, resource extraction remained limited by the same constraints.<p>The approach taken here follows the established pattern from the component extraction system. The developer added a generic marker type parameter <code>F</code> to the <code>ExtractResource</code> trait and propagated this marker through the related systems. This creates a consistent pattern across both extraction systems, making the API more predictable and easier to understand.<p>The implementation required changes to three main areas of the codebase. First, the <code>ExtractResource</code> trait itself now accepts a marker type parameter with a default of <code>()</code>. This maintains backward compatibility while allowing custom markers. Second, the <code>ExtractResourcePlugin</code> needed to be updated to handle this marker type and pass it through to the extraction system. Third, the related <code>SyncComponent</code> system was updated to accept the marker type from <code>ExtractComponent</code>, ensuring consistency across the extraction pipeline.<p>The technical pattern used here is straightforward but effective. By adding a phantom type parameter that implements <code>Send + Sync</code>, developers can now create local wrapper types that act as markers, allowing them to implement extraction traits for foreign types. This is a common Rust pattern for working around orphan rules without requiring complex workarounds or unsafe code.<p>From an architectural perspective, this change aligns the resource extraction system with the component extraction system, creating a more consistent API. Both systems now support marker types, making the rendering pipeline more extensible. The changes are minimal and focused, affecting only the type signatures and trait bounds without modifying the core extraction logic.<p>The impact of this PR is that developers can now implement <code>ExtractResource</code> for resource types from external dependencies, increasing the flexibility of Bevy’s rendering system. This is particularly useful for game developers who want to extract custom resources from external libraries or crates without having to wrap them in local types for every use.<p>The implementation maintains backward compatibility through default type parameters. Existing code that doesn’t specify a marker type will continue to work with <code>()</code>, while new code can provide custom markers when needed. This approach balances extensibility with stability.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[ExtractResource trait] -->|now has marker type F| B[ExtractResourcePlugin]
</span><span>    B --> C[extract_resource system]
</span><span>    D[SyncComponent trait] -->|receives marker from ExtractComponent| E[SyncComponentPlugin]
</span><span>    E --> F[SyncWorldPlugin]
</span><span>    
</span><span>    style A fill:#e1f5e1
</span><span>    style D fill:#e1f5e1
</span><span>    style B fill:#f0f8ff
</span><span>    style E fill:#f0f8ff
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-src-extract-resource-rs-14-6><code>crates/bevy_render/src/extract_resource.rs</code> (+14/-6)</h3><p>This file contains the core changes to the resource extraction system. The <code>ExtractResource</code> trait now accepts a marker type parameter, and all related types and functions have been updated to handle this parameter.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>ExtractResource</span><span>: Resource {
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Source</span><span style=color:#61676ccc>:</span><span> Resource</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>extract_resource</span><span>(</span><span style=color:#ff8f40>source</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Source) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>ExtractResource</span><span>&LTF = ()>: Resource {
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Source</span><span style=color:#61676ccc>:</span><span> Resource</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>extract_resource</span><span>(</span><span style=color:#ff8f40>source</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Source) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The <code>ExtractResourcePlugin</code> was updated to be generic over both the resource type and the marker type:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ExtractResourcePlugin</span><span>&LTR</span><span style=color:#61676ccc>:</span><span> ExtractResource>(PhantomData&LTR>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ExtractResourcePlugin</span><span>&LTR</span><span style=color:#61676ccc>: </span><span>ExtractResource&LTF>, F = ()>(PhantomData<(R, F)</span><span style=color:#ed9366>></span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>The extraction function signature was also updated to include the marker type:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>extract_resource</span><span>&LTR</span><span style=color:#61676ccc>:</span><span> ExtractResource>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>main_resource</span><span style=color:#61676ccc>: </span><span>Extract<</span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTRes<</span><span style=color:#fa6e32>R</span><span style=color:#ed9366>::</span><span>Source>>>,
</span><span>    </span><span style=color:#ff8f40>target_resource</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTResMut&LTR>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// implementation
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>extract_resource</span><span>&LTR</span><span style=color:#61676ccc>: </span><span>ExtractResource&LTF>, F>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>main_resource</span><span style=color:#61676ccc>: </span><span>Extract<</span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTRes<</span><span style=color:#fa6e32>R</span><span style=color:#ed9366>::</span><span>Source>>>,
</span><span>    </span><span style=color:#ff8f40>target_resource</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTResMut&LTR>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// implementation
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-sync-component-rs-9-7><code>crates/bevy_render/src/sync_component.rs</code> (+9/-7)</h3><p>This file was updated to ensure consistency between the component and resource extraction systems. The <code>SyncComponent</code> trait and related types now properly handle marker types passed from <code>ExtractComponent</code>.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>SyncComponent</span><span>&LTMarker = ()>: Component {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// trait methods
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>SyncComponent</span><span>&LTF = ()>: Component {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// trait methods
</span><span>}
</span></code></pre><p>The plugin implementation was updated to handle the marker type consistently:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl</span><span>&LTC</span><span style=color:#61676ccc>: </span><span>SyncComponent&LTMarker>, Marker</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Sync </span><span style=color:#ed9366>+ </span><span style=color:#fa6e32>'static</span><span>> </span><span style=color:#399ee6>Plugin
</span><span>    </span><span style=color:#399ee6>for SyncComponentPlugin</span><span>&LTC, Marker>
</span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// implementation
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl</span><span>&LTC</span><span style=color:#61676ccc>: </span><span>SyncComponent&LTF>, F</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Sync </span><span style=color:#ed9366>+ </span><span style=color:#fa6e32>'static</span><span>> Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SyncComponentPlugin</span><span>&LTC, F> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// implementation
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-extract-component-rs-12-8><code>crates/bevy_render/src/extract_component.rs</code> (+12/-8)</h3><p>This file received minor updates to improve documentation consistency and ensure proper marker type propagation. The parameter name was changed from <code>Marker</code> to <code>F</code> for consistency with the updated resource extraction system.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>ExtractComponent</span><span>&LTMarker = ()>: SyncComponent {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// trait methods
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>ExtractComponent</span><span>&LTF = ()>: SyncComponent&LTF> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// trait methods
</span><span>}
</span></code></pre><p>The documentation was updated to clarify the purpose of the marker type parameter:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Updated documentation:
</span><span style=color:#abb0b6;font-style:italic>/// The marker type `F` is only used as a way to bypass the orphan rules. To
</span><span style=color:#abb0b6;font-style:italic>/// implement the trait for a foreign type you can use a local type as the
</span><span style=color:#abb0b6;font-style:italic>/// marker, e.g. the type of the plugin that calls [`ExtractResourcePlugin`].
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/items/implementations.html#orphan-rules target=_blank>Rust Orphan Rules</a> - Official documentation on Rust’s orphan rules<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/marker/struct.PhantomData.html target=_blank>PhantomData in Rust</a> - Using phantom types for type system patterns<li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/ecs-intro.html target=_blank>Bevy’s ECS System</a> - Understanding Bevy’s Entity Component System<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22766 target=_blank>Previous PR #22766</a> - The component extraction marker implementation that preceded this PR<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22852 target=_blank>Target PR #22852</a> - The larger goal this PR is working towards</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22867.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>