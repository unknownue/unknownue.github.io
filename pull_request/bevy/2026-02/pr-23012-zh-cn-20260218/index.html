<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23012 `FontAtlas` improvements
        
    </title><meta content="#23012 `FontAtlas` improvements" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-18</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-02/pr-23012-en-20260218>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=fontatlas-improvements>FontAtlas improvements</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: <code>FontAtlas</code> improvements<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/23012<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-Rendering, C-Performance, C-Code-Quality, S-Ready-For-Final-Review, M-Migration-Guide, A-Text, D-Straightforward<li><strong>Created</strong>: 2026-02-17T20:54:24Z<li><strong>Merged</strong>: 2026-02-18T03:09:53Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>目标</strong><p>改进 <code>FontAtlas</code> 的实现。这有助于简化 assets as entities (#22939) 的文本更改，并缓解由于 parley 迁移 (#22879) 带来的一些性能回归。<ul><li><code>FontAtlas</code> 持有一个 <code>TextureAtlasLayout</code> 资产的句柄（handle），但如果它直接持有布局本身会更简单高效。<li><code>PositionedGlyph</code> 的 <code>size</code> 字段没有被使用。尺寸可以从图集矩形（atlas rect）中获取。文档注释也是错误的：它是物理像素，不是逻辑像素。<li><code>GlyphAtlasInfo</code> 可以直接存储图集矩形，替代图集布局句柄和索引。<li>偏移量（offset）和矩形值应该使用 f32 而不是 i32，因为它们只在转换后被使用。<li><code>GlyphAtlasInfo::offset</code> 应该以正确的方向存储，而不是每次都对其 y 轴取负。</ul><p><strong>解决方案</strong><ul><li>字体图集布局现在直接存储在 <code>FontAtlas</code> 中，而不是作为资产。<li>移除了 <code>PositionedGlyph</code> 的 <code>size</code> 字段。<li><code>GlyphAtlasInfo</code> 的 <code>texture_atlas</code> 和 <code>location</code> 字段被移除，替换为 <code>rect</code> 和 <code>offset</code> 字段。<li><code>get_outlined_glyph_texture</code> 返回一个 <code>Vec2</code> 而不是 <code>IVec2</code>，并且 y 值不再被取负。</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这个PR的核心目标是优化Bevy引擎中字体图集（<code>FontAtlas</code>）的数据结构和相关流程，以提升性能并简化代码。其背景是为了支持即将到来的“assets as entities”重构，并为解决parley文本布局迁移引入的性能问题做准备。<p><strong>问题根源：不必要的间接引用与冗余数据</strong><p>原有的设计中，<code>FontAtlas</code> 通过一个句柄（<code>Handle&LTTextureAtlasLayout></code>）引用一个独立的 <code>TextureAtlasLayout</code> 资产。这意味着每次需要访问图集布局信息（例如，获取一个字形在纹理中的位置）时，都需要通过资产系统进行查找。这种间接引用带来了额外的开销，尤其是在文本渲染这种高频操作中。<p>同时，<code>GlyphAtlasInfo</code> 结构体存储了 <code>texture_atlas</code>（资产ID）和 <code>location</code>（包含<code>glyph_index</code>和<code>IVec2 offset</code>）。要获取一个字形在纹理中的实际矩形区域（<code>Rect</code>），需要先通过 <code>texture_atlas</code> 找到 <code>TextureAtlasLayout</code> 资产，再用 <code>glyph_index</code> 去索引。这个过程在渲染管线的多个阶段（如 <code>extract</code> 阶段）重复进行，造成了浪费。<p>此外，<code>PositionedGlyph</code> 结构体包含一个 <code>size: Vec2</code> 字段，但该字段的值可以从图集矩形中推导出来，实际上是冗余的。其文档注释也错误地声称它是逻辑像素，而实际是物理像素。<p><strong>解决方案：数据扁平化与直接存储</strong><p>PR采取了直接而有效的策略：将 <code>TextureAtlasLayout</code> 数据内联（inline）到 <code>FontAtlas</code> 结构体中，并让 <code>GlyphAtlasInfo</code> 直接存储计算好的 <code>rect: Rect</code> 和正确方向的 <code>offset: Vec2</code>。<ol><li><strong>移除资产句柄</strong>：<code>FontAtlas::texture_atlas</code> 字段的类型从 <code>Handle&LTTextureAtlasLayout></code> 改为 <code>TextureAtlasLayout</code>。这使得 <code>FontAtlas</code> 成为一个自包含的单元，无需外部资产查找。<li><strong>简化 <code>GlyphAtlasInfo</code></strong>：它不再存储需要二次查找的 <code>texture_atlas</code> 和 <code>location</code>，而是直接存储最终结果：字形在纹理中的边界 <code>rect</code> 和放置时的偏移量 <code>offset</code>。这消除了渲染时的大量间接寻址。<li><strong>删除冗余字段</strong>：<code>PositionedGlyph::size</code> 被移除。任何需要字形尺寸的地方，现在都通过 <code>atlas_info.rect.size()</code> 获取。这使数据来源单一，避免了不一致的风险。<li><strong>类型与方向修正</strong>：偏移量从 <code>IVec2</code> 改为 <code>Vec2</code>，因为其值最终用于浮点计算。同时，在 <code>get_outlined_glyph_texture</code> 函数中，返回的 <code>offset</code> 的 <code>y</code> 分量现在直接存储为负值（<code>-top as f32</code>），而不是在每次使用时再取负。这符合图形坐标系（Y轴向下为正）的约定，并使后续计算更直观。</ol><p><strong>实现细节与影响</strong><p>更改波及整个文本渲染管线。<code>FontAtlas::new</code> 和 <code>FontAtlas::add_glyph</code> 不再需要 <code>&mut Assets&LTTextureAtlasLayout></code> 参数。负责将字形添加到图集的 <code>add_glyph_to_atlas</code> 函数以及文本布局管道 <code>TextPipeline::update_text_layout_info</code> 也因此移除了对纹理图集资产存储的依赖。<p>在渲染提取（extract）阶段（如 <code>extract_text2d_sprite</code> 和 <code>extract_text_sections</code>），代码不再需要通过 <code>texture_atlases: Res&LTAssets&LTTextureAtlasLayout>></code> 来查询字形矩形，而是直接使用 <code>atlas_info.rect</code>。这减少了运行时的资产查找开销，并简化了提取逻辑。<p><strong>性能与代码质量收益</strong><p>这项重构带来了多重好处：<ul><li><strong>性能提升</strong>：最直接的收益是减少了CPU端的资产查找和间接调用。在文本密集的场景中，这能减轻由parley迁移带来的部分性能压力。<li><strong>内存与数据局部性</strong>：数据结构更紧凑，减少了间接指针，可能提升缓存效率。<li><strong>代码简化</strong>：移除了复杂的资产依赖关系，使得 <code>FontAtlas</code> 的逻辑更清晰，也更容易测试和理解。这为后续的“assets as entities”重构扫清了一个障碍，因为资产关系的减少意味着更少的迁移工作。<li><strong>正确性</strong>：修正了偏移量的方向和 <code>size</code> 字段的误导性文档，提高了代码的可维护性。</ul><p>总的来说，这是一个典型的数据导向设计优化案例。通过分析数据流和使用模式，将高频访问的派生数据提前计算并直接存储，同时消除不必要的抽象层，从而在保持功能不变的前提下，提升性能并简化架构。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph "Before PR #23012"
</span><span>        A[FontAtlas] --> B[Handle&LTTextureAtlasLayout>]
</span><span>        B --> C[Assets&LTTextureAtlasLayout>]
</span><span>        C --> D[TextureAtlasLayout]
</span><span>        E[GlyphAtlasInfo] --> F[texture_atlas: AssetId]
</span><span>        E --> G[location: GlyphAtlasLocation]
</span><span>        G --> H[glyph_index: usize]
</span><span>        G --> I[offset: IVec2]
</span><span>        H --> D
</span><span>        J[PositionedGlyph] --> K[size: Vec2]
</span><span>        J --> E
</span><span>    end
</span><span>
</span><span>    subgraph "After PR #23012"
</span><span>        L[FontAtlas] --> M[texture_atlas: TextureAtlasLayout]
</span><span>        N[GlyphAtlasInfo] --> O[rect: Rect]
</span><span>        N --> P[offset: Vec2]
</span><span>        Q[PositionedGlyph] --> N
</span><span>        M --> O
</span><span>    end
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-font-atlas-rs-13-37><code>crates/bevy_text/src/font_atlas.rs</code> (+13/-37)</h3><p>这是重构的核心文件，<code>FontAtlas</code> 结构体的定义和关键方法被修改。<p><strong>关键更改：</strong><ol><li><code>FontAtlas</code> 的 <code>texture_atlas</code> 字段类型从 <code>Handle&LTTextureAtlasLayout></code> 变为 <code>TextureAtlasLayout</code>。<li><code>FontAtlas::new</code> 和 <code>FontAtlas::add_glyph</code> 方法不再接收 <code>&mut Assets&LTTextureAtlasLayout></code> 参数。<li><code>get_outlined_glyph_texture</code> 返回的偏移量类型从 <code>IVec2</code> 改为 <code>Vec2</code>，并且Y值在返回时已正确处理为负值。</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>FontAtlas </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture_atlas</span><span style=color:#61676ccc>: </span><span>Handle&LTTextureAtlasLayout>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>(
</span><span>    </span><span style=color:#ff8f40>textures</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>Assets&LTImage>,
</span><span>    </span><span style=color:#ff8f40>texture_atlases_layout</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>Assets&LTTextureAtlasLayout>, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 参数
</span><span>    </span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> UVec2,
</span><span>    </span><span style=color:#ff8f40>font_smoothing</span><span style=color:#61676ccc>:</span><span> FontSmoothing,
</span><span>) </span><span style=color:#61676ccc>-></span><span> FontAtlas { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>FontAtlas </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture_atlas</span><span style=color:#61676ccc>:</span><span> TextureAtlasLayout, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 直接存储
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>(
</span><span>    </span><span style=color:#ff8f40>textures</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>Assets&LTImage>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// texture_atlases_layout 参数被移除
</span><span>    </span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> UVec2,
</span><span>    </span><span style=color:#ff8f40>font_smoothing</span><span style=color:#61676ccc>:</span><span> FontSmoothing,
</span><span>) </span><span style=color:#61676ccc>-></span><span> FontAtlas { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}
</span></code></pre><h3 id=crates-bevy-text-src-glyph-rs-6-11><code>crates/bevy_text/src/glyph.rs</code> (+6/-11)</h3><p>定义了字形相关数据结构，进行了大幅简化。<p><strong>关键更改：</strong><ol><li>移除 <code>PositionedGlyph::size</code> 字段。<li><code>GlyphAtlasInfo</code> 移除 <code>texture_atlas</code> 和 <code>location</code> 字段，新增 <code>rect</code> 和 <code>offset</code> 字段。<li><code>GlyphAtlasLocation::offset</code> 类型从 <code>IVec2</code> 改为 <code>Vec2</code>。</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>PositionedGlyph </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>position</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>size</span><span style=color:#61676ccc>:</span><span> Vec2, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 被移除的字段
</span><span>    </span><span style=color:#fa6e32>pub </span><span>atlas_info</span><span style=color:#61676ccc>:</span><span> GlyphAtlasInfo,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GlyphAtlasInfo </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture</span><span style=color:#61676ccc>: </span><span>AssetId&LTImage>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture_atlas</span><span style=color:#61676ccc>: </span><span>AssetId&LTTextureAtlasLayout>, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 被移除
</span><span>    </span><span style=color:#fa6e32>pub </span><span>location</span><span style=color:#61676ccc>:</span><span> GlyphAtlasLocation, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 被移除
</span><span>}
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GlyphAtlasLocation </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>glyph_index</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>offset</span><span style=color:#61676ccc>:</span><span> IVec2,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>PositionedGlyph </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>position</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// size 字段消失
</span><span>    </span><span style=color:#fa6e32>pub </span><span>atlas_info</span><span style=color:#61676ccc>:</span><span> GlyphAtlasInfo,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GlyphAtlasInfo </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture</span><span style=color:#61676ccc>: </span><span>AssetId&LTImage>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>rect</span><span style=color:#61676ccc>:</span><span> Rect,   </span><span style=color:#abb0b6;font-style:italic>// &LT-- 新增
</span><span>    </span><span style=color:#fa6e32>pub </span><span>offset</span><span style=color:#61676ccc>:</span><span> Vec2, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 新增
</span><span>}
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GlyphAtlasLocation </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>glyph_index</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>offset</span><span style=color:#61676ccc>:</span><span> Vec2, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 类型更改
</span><span>}
</span></code></pre><h3 id=crates-bevy-sprite-render-src-text2d-mod-rs-6-18-yu-crates-bevy-ui-render-src-lib-rs-2-14><code>crates/bevy_sprite_render/src/text2d/mod.rs</code> (+6/-18) 与 <code>crates/bevy_ui_render/src/lib.rs</code> (+2/-14)</h3><p>这两个文件包含2D精灵和UI的文本渲染提取逻辑。更改模式一致：移除对 <code>texture_atlases: Res&LTAssets&LTTextureAtlasLayout>></code> 的依赖，并直接使用 <code>atlas_info.rect</code>。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (extract_text2d_sprite):
</span><span style=color:#fa6e32>let</span><span> rect </span><span style=color:#ed9366>=</span><span> texture_atlases
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(atlas_info</span><span style=color:#ed9366>.</span><span>texture_atlas)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span>textures[atlas_info</span><span style=color:#ed9366>.</span><span>location</span><span style=color:#ed9366>.</span><span>glyph_index]
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>as_rect</span><span>()</span><span style=color:#61676ccc>;
</span><span>extracted_slices</span><span style=color:#ed9366>.</span><span>slices</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(ExtractedSlice {
</span><span>    offset</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>*</span><span>position</span><span style=color:#61676ccc>,
</span><span>    rect</span><span style=color:#61676ccc>,
</span><span>    size</span><span style=color:#61676ccc>:</span><span> rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#61676ccc>,
</span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>extracted_slices</span><span style=color:#ed9366>.</span><span>slices</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(ExtractedSlice {
</span><span>    offset</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>*</span><span>position</span><span style=color:#61676ccc>,
</span><span>    rect</span><span style=color:#61676ccc>:</span><span> atlas_info</span><span style=color:#ed9366>.</span><span>rect</span><span style=color:#61676ccc>,      </span><span style=color:#abb0b6;font-style:italic>// &LT-- 直接使用
</span><span>    size</span><span style=color:#61676ccc>:</span><span> atlas_info</span><span style=color:#ed9366>.</span><span>rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 直接使用
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-text-src-pipeline-rs-6-11><code>crates/bevy_text/src/pipeline.rs</code> (+6/-11)</h3><p>文本管道更新函数签名更改，移除了 <code>texture_atlases</code> 参数。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_text_layout_info</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>layout_info</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> TextLayoutInfo,
</span><span>    </span><span style=color:#ff8f40>font_atlas_set</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> FontAtlasSet,
</span><span>    </span><span style=color:#ff8f40>texture_atlases</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>Assets&LTTextureAtlasLayout>, </span><span style=color:#abb0b6;font-style:italic>// &LT-- 被移除的参数
</span><span>    </span><span style=color:#ff8f40>textures</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>Assets&LTImage>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_text_layout_info</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>layout_info</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> TextLayoutInfo,
</span><span>    </span><span style=color:#ff8f40>font_atlas_set</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> FontAtlasSet,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// texture_atlases 参数消失
</span><span>    </span><span style=color:#ff8f40>textures</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>Assets&LTImage>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>)
</span></code></pre><h3 id=release-content-migration-guides-fontatlas-texture-atlas-layout-md-16-0><code>release-content/migration-guides/FontAtlas-texture-atlas-layout.md</code> (+16/-0)</h3><p>新增的迁移指南，清晰地总结了所有破坏性变更，帮助用户升级代码。<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ui/text/ target=_blank>Bevy 官方文档 - 文本</a><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Data-oriented_design target=_blank>数据导向设计（Data-Oriented Design）相关理念</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22879 target=_blank>原PR #22879: Parley 文本布局迁移</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22939 target=_blank>原PR #22939: Assets as Entities</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23012.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>