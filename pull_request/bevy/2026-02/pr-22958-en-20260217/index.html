<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22958 Introduce RenderGraphSystems
        
    </title><meta content="#22958 Introduce RenderGraphSystems" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22958-zh-cn-20260217>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Introduce RenderGraphSystems<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Introduce RenderGraphSystems<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22958<li><strong>Author</strong>: IceSentry<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Code-Quality, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-02-14T18:59:05Z<li><strong>Merged</strong>: 2026-02-17T01:26:14Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>It’s sometimes useful to order things relative to the <code>RenderGraph</code></ul><h2 id=solution>Solution</h2><ul><li>Introduce <code>RenderGraphSytems</code> that contains all the important phases of the <code>RenderGraph</code> execution</ul><h2 id=testing>Testing</h2><ul><li>I tested the 3d_scene and it worked</ul><h2 id=note>Note</h2><p>This is needed to fix diagnostic recording of gpu timestamps.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a scheduling problem in Bevy’s rendering system. The <code>RenderGraph</code> schedule, which orchestrates the rendering pipeline, previously lacked clearly defined execution phases. This made it difficult for developers to schedule systems relative to specific rendering stages, particularly when needing to run systems before or after the main render pass or command buffer submission.<p>The core issue was that systems like <code>camera_driver</code> handled multiple responsibilities in a single function: executing camera render graphs, submitting command buffers, and handling uncovered swap chains. This monolithic approach provided no clear hooks for systems that needed to run between these phases.<p>The solution introduces a <code>RenderGraphSystems</code> enum with four distinct phases: <code>Begin</code>, <code>Render</code>, <code>Submit</code>, and <code>Finish</code>. These phases are arranged in a chain, establishing clear ordering constraints. The <code>Begin</code> phase runs before rendering for per-frame setup, <code>Render</code> handles the main rendering work, <code>Submit</code> handles command buffer submission, and <code>Finish</code> runs after everything for per-frame finalization.<p>This change enables proper ordering for systems like GPU timestamp diagnostics, which need to record timestamps at specific points in the render pipeline. By providing these explicit phases, developers can now schedule systems with precise timing relative to the render graph execution.<p>The implementation restructures the rendering pipeline by:<ol><li>Defining <code>RenderGraphSystems</code> as a <code>SystemSet</code> with the four phases<li>Configuring these sets in the <code>RenderGraph::base_schedule()</code> method<li>Splitting the monolithic <code>camera_driver</code> system into logical components<li>Moving command buffer submission and swap chain handling to the <code>Submit</code> phase</ol><p>This architectural change doesn’t just solve the immediate problem but provides a foundation for future rendering extensions. The explicit phases make the rendering pipeline more modular and maintainable, allowing new features to be added at appropriate points without disrupting the core flow.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[RenderGraph Schedule] --> B[RenderGraphSystems::Begin]
</span><span>    B --> C[RenderGraphSystems::Render]
</span><span>    C --> D[RenderGraphSystems::Submit]
</span><span>    D --> E[RenderGraphSystems::Finish]
</span><span>    
</span><span>    F[camera_driver] --> C
</span><span>    G[submit_pending_command_buffers] --> D
</span><span>    H[handle_uncovered_swap_chains] --> D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-src-renderer-mod-rs-24-1><code>crates/bevy_render/src/renderer/mod.rs</code> (+24/-1)</h3><p>This file defines the new <code>RenderGraphSystems</code> enum and updates the <code>RenderGraph::base_schedule()</code> method to configure the system sets.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added: Definition of RenderGraphSystems
</span><span style=color:#abb0b6;font-style:italic>/// System sets for the root [`RenderGraph`] schedule.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(SystemSet</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> Hash)]
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>RenderGraphSystems </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Runs before rendering. Used for per-frame setup.
</span><span>    Begin</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// The main rendering phase.
</span><span>    Render</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Submits pending command buffers generated during [`RenderGraphSystems::Render`]
</span><span>    Submit</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Runs after rendering and submit. Used for per-frame finalization.
</span><span>    Finish</span><span style=color:#61676ccc>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Updated: RenderGraph::base_schedule() now configures the system sets
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>RenderGraph </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>base_schedule</span><span>() </span><span style=color:#61676ccc>-></span><span> Schedule {
</span><span>        </span><span style=color:#fa6e32>let mut</span><span> schedule </span><span style=color:#ed9366>= </span><span>Schedule</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span>)</span><span style=color:#61676ccc>;
</span><span>        schedule</span><span style=color:#ed9366>.</span><span style=color:#f07171>configure_sets</span><span>(
</span><span>            (
</span><span>                RenderGraphSystems</span><span style=color:#ed9366>::</span><span>Begin</span><span style=color:#61676ccc>,
</span><span>                RenderGraphSystems</span><span style=color:#ed9366>::</span><span>Render</span><span style=color:#61676ccc>,
</span><span>                RenderGraphSystems</span><span style=color:#ed9366>::</span><span>Submit</span><span style=color:#61676ccc>,
</span><span>                RenderGraphSystems</span><span style=color:#ed9366>::</span><span>Finish</span><span style=color:#61676ccc>,
</span><span>            )
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>chain</span><span>()</span><span style=color:#61676ccc>,
</span><span>        )</span><span style=color:#61676ccc>;
</span><span>        schedule
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-core-pipeline-src-lib-rs-14-5><code>crates/bevy_core_pipeline/src/lib.rs</code> (+14/-5)</h3><p>This file updates the <code>CorePipelinePlugin</code> to schedule systems using the new <code>RenderGraphSystems</code> sets.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>render_app
</span><span>    </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTFullscreenShader>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderGraph</span><span style=color:#61676ccc>,</span><span> camera_driver)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>render_app</span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTFullscreenShader>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>    RenderGraph</span><span style=color:#61676ccc>,
</span><span>    (
</span><span>        camera_driver</span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(RenderGraphSystems</span><span style=color:#ed9366>::</span><span>Render)</span><span style=color:#61676ccc>,
</span><span>        (submit_pending_command_buffers</span><span style=color:#61676ccc>,</span><span> handle_uncovered_swap_chains)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>chain</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(RenderGraphSystems</span><span style=color:#ed9366>::</span><span>Submit)</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-core-pipeline-src-schedule-rs-12-7><code>crates/bevy_core_pipeline/src/schedule.rs</code> (+12/-7)</h3><p>This file refactors the <code>camera_driver</code> system and makes helper functions public for use in the new scheduling structure.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added: CameraWindows resource to pass data between phases
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>CameraWindows</span><span>(HashSet&LTEntity>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Modified: camera_driver now stores results in CameraWindows instead of processing them
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>camera_driver</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... camera rendering logic ...
</span><span>    world</span><span style=color:#ed9366>.</span><span>remove_resource</span><span style=color:#ed9366>::</span><span>&LTCurrentView>()</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    world</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(CameraWindows(camera_windows))</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Store for later use
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Made public for use in RenderGraphSystems::Submit
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>submit_pending_command_buffers</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... command buffer submission logic ...
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>handle_uncovered_swap_chains</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Now retrieves CameraWindows from resources instead of as a parameter
</span><span>    </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(camera_windows) </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>remove_resource</span><span style=color:#ed9366>::</span><span>&LTCameraWindows>() </span><span style=color:#fa6e32>else </span><span>{
</span><span>        </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>;
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... swap chain handling logic using camera_windows.0 ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-lib-rs-3-1><code>crates/bevy_render/src/lib.rs</code> (+3/-1)</h3><p>This file ensures the <code>RenderGraph</code> schedule is added to the render app.<p><strong>Key change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added: Ensure RenderGraph schedule is available
</span><span>render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_schedule</span><span>(RenderGraph</span><span style=color:#ed9366>::</span><span>base_schedule())</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/next/programming/schedules/ target=_blank>Bevy’s Scheduling System Documentation</a> - Understanding Bevy’s ECS scheduling model<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/next/programming/schedules/#system-sets target=_blank>System Sets in Bevy</a> - How to group and order systems<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_render/src/render_graph/mod.rs target=_blank>Render Graph Architecture</a> - Bevy’s render graph implementation<li><a rel="noopener nofollow noreferrer" href=https://vulkan-tutorial.com/Drawing_a_triangle/Drawing/Command_buffers target=_blank>Command Buffers in Graphics Programming</a> - Background on command buffer submission patterns</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22958.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>