<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22899 get game_menu running again
        
    </title><meta content="#22899 get game_menu running again" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-11</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22899-zh-cn-20260211>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: get game_menu running again<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22899<li><strong>Author</strong>: ChristopherBiscardi<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, A-UI, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-02-11T02:52:59Z<li><strong>Merged</strong>: 2026-02-11T05:03:50Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><h1 id=objective>Objective</h1><p>fixes #22897<h2 id=solution>Solution</h2><p>Introduces a new generic <code>Setting</code> component to differentiate between the Resource and the Component. This example was using one type as both uses.<h2 id=testing>Testing</h2><pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example game_menu
</span></code></pre><p>https://github.com/user-attachments/assets/409f60c5-92cf-4201-a09f-820475194f86<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The issue was straightforward: the <code>game_menu</code> example was broken because it was using the same Rust type as both a Resource and a Component in the Bevy ECS. In Bevy, a type can be registered as a Resource or as a Component, but not both simultaneously for the same type. The example was trying to use the <code>Volume</code> and <code>DisplayQuality</code> types in both capacities, which caused a conflict.<p>The problem manifested when running the example, and the issue (#22897) documented this breakage. The root cause was a recent change in Bevy’s ECS that enforced stricter type registration rules, preventing the same type from being used as both a Resource and a Component.<p>The solution took a direct approach: create a wrapper component type that can hold the same data as the Resource types. This wrapper, called <code>Setting&LTT></code>, is a generic component that stores a value of type <code>T</code>. By using <code>Setting&LTVolume></code> and <code>Setting&LTDisplayQuality></code> as components, we differentiate them from the <code>Volume</code> and <code>DisplayQuality</code> Resources, resolving the type registration conflict.<p>From an implementation perspective, the changes were minimal but precise. First, the <code>Setting&LTT></code> struct was defined and marked as a Component:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Setting</span><span>&LTT>(T)</span><span style=color:#61676ccc>;
</span></code></pre><p>Then, the <code>setting_button</code> system’s query was updated to look for <code>Setting&LTT></code> instead of <code>T</code> directly:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>setting_button</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Resource </span><span style=color:#ed9366>+</span><span> Component </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>PartialEq </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Copy</span><span>>(
</span><span>    </span><span style=color:#ff8f40>interaction_query</span><span style=color:#61676ccc>: </span><span>Query<
</span><span>        (</span><span style=color:#ed9366>&</span><span>Interaction, </span><span style=color:#ed9366>&</span><span>Setting&LTT>, Entity),
</span><span>        (Changed&LTInteraction>, With&LTButton>),
</span><span>    >,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... rest of parameters
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... system logic
</span><span>}
</span></code></pre><p>Inside the system, when comparing and assigning the setting value, we now access the inner value via <code>.0</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if </span><span style=color:#ed9366>*</span><span>interaction </span><span style=color:#ed9366>== </span><span>Interaction</span><span style=color:#ed9366>::</span><span>Pressed </span><span style=color:#ed9366>&& *</span><span>setting </span><span style=color:#ed9366>!=</span><span> button_setting</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... update selected button
</span><span>    </span><span style=color:#ed9366>*</span><span>setting </span><span style=color:#ed9366>=</span><span> button_setting</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>Finally, when creating the UI buttons, the setting values were wrapped in the <code>Setting</code> component:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// For DisplayQuality:
</span><span>Setting(quality_setting)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// For Volume:
</span><span>Setting(Volume(volume_setting))
</span></code></pre><p>This approach maintains the separation of concerns while preserving the example’s functionality. The <code>Setting&LTT></code> component acts as a marker that holds configuration values for UI elements, while the Resource stores the actual application state. The system reads from the component when a button is pressed and updates the Resource accordingly.<p>The fix is a good example of how to handle cases where the same data needs to exist in different contexts within the ECS. By creating a distinct component type, we adhere to Bevy’s type registration requirements while maintaining clean data flow. This pattern could be useful in other scenarios where UI elements need to reference configuration values that are also stored as Resources.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph "Before Fix"
</span><span>        A[Volume Resource] --> B[Volume Component]
</span><span>        C[DisplayQuality Resource] --> D[DisplayQuality Component]
</span><span>    end
</span><span>    
</span><span>    subgraph "After Fix"
</span><span>        E[Volume Resource] --> F[Setting&LTVolume> Component]
</span><span>        G[DisplayQuality Resource] --> H[Setting&LTDisplayQuality> Component]
</span><span>    end
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong><code>examples/games/game_menu.rs</code> (+12/-6)</strong><p>This is the only file modified in the PR. The changes fix the type conflict by introducing a wrapper component for settings.<p>Key modifications:<ol><li><strong>Added the <code>Setting&LTT></code> component wrapper:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Setting</span><span>&LTT>(T)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><strong>Updated the <code>setting_button</code> system signature and logic:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>setting_button</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Resource </span><span style=color:#ed9366>+</span><span> Component </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>PartialEq </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Copy</span><span>>(
</span><span>    </span><span style=color:#ff8f40>interaction_query</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span>Interaction, </span><span style=color:#ed9366>&</span><span>T, Entity), (Changed&LTInteraction>, With&LTButton>)>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>fn setting_button&LTT</span><span style=color:#61676ccc>:</span><span> Resource </span><span style=color:#ed9366>+</span><span> Component </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>PartialEq </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Copy</span><span>>(
</span><span>    </span><span style=color:#ff8f40>interaction_query</span><span>: </span><span style=color:#ff8f40>Query</span><span><
</span><span>        (&</span><span style=color:#ff8f40>Interaction</span><span style=color:#61676ccc>,</span><span> &</span><span style=color:#ff8f40>Setting</span><span><</span><span style=color:#ff8f40>T</span><span>></span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>Entity</span><span>),
</span><span>        (</span><span style=color:#ff8f40>Changed</span><span><</span><span style=color:#ff8f40>Interaction</span><span>></span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>With</span><span><</span><span style=color:#ff8f40>Button</span><span>>),
</span><span>    >,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span></code></pre><ol start=3><li><strong>Updated value access in the system logic:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>if </span><span style=color:#ed9366>*</span><span>interaction </span><span style=color:#ed9366>== </span><span>Interaction</span><span style=color:#ed9366>::</span><span>Pressed </span><span style=color:#ed9366>&& *</span><span>setting </span><span style=color:#ed9366>!= *</span><span>button_setting {
</span><span>    </span><span style=color:#ed9366>*</span><span>setting </span><span style=color:#ed9366>= *</span><span>button_setting</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if </span><span style=color:#ed9366>*</span><span>interaction </span><span style=color:#ed9366>== </span><span>Interaction</span><span style=color:#ed9366>::</span><span>Pressed </span><span style=color:#ed9366>&& *</span><span>setting </span><span style=color:#ed9366>!=</span><span> button_setting</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>{
</span><span>    </span><span style=color:#ed9366>*</span><span>setting </span><span style=color:#ed9366>=</span><span> button_setting</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=4><li><strong>Updated UI button creation to use the wrapper component:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// For DisplayQuality buttons - Before:
</span><span>quality_setting</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// For DisplayQuality buttons - After:
</span><span>Setting(quality_setting)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// For Volume buttons - Before:
</span><span>Volume(volume_setting)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// For Volume buttons - After:
</span><span>Setting(Volume(volume_setting))</span><span style=color:#61676ccc>,
</span></code></pre><p>These changes ensure that the Resource types (<code>Volume</code> and <code>DisplayQuality</code>) are only used as Resources, while their component counterparts are wrapped in <code>Setting&LTT></code>, resolving the type registration conflict.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ecs/#components target=_blank>Bevy ECS Components Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ecs/#resources target=_blank>Bevy Resources Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/examples/games/game_menu.rs target=_blank>Bevy UI Example - Game Menu</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch10-01-syntax.html target=_blank>Rust Generics Documentation</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22899.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>