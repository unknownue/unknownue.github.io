<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22898 fix error message when resmut conflict with query
        
    </title><meta content="#22898 fix error message when resmut conflict with query" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-11</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22898-zh-cn-20260211>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>fix error message when resmut conflict with query<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fix error message when resmut conflict with query<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22898<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-02-11T02:40:16Z<li><strong>Merged</strong>: 2026-02-11T05:03:50Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The PR description is already in English, so it is included as-is:<p><strong>Objective</strong><ul><li>since #20934 res/resmut can conflict with queries<li>the resmut error message mention res</ul><p><strong>Solution</strong><ul><li>fix it</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a minor but important usability issue in Bevy’s error messaging system. The problem was straightforward: when a <code>ResMut</code> parameter in a system conflicts with a query, the generated error message incorrectly referenced <code>Res</code> instead of <code>ResMut</code>. This discrepancy could cause confusion for developers debugging system conflicts.<p>The issue originated from PR #20934, which introduced the possibility for resource access (both <code>Res</code> and <code>ResMut</code>) to conflict with queries. This was a change in the behavior of the Entity Component System (ECS), as previously resources and queries operated in separate access spaces. With that change, the error messages needed to accurately reflect the type of resource involved in the conflict.<p>Looking at the implementation, the <code>SystemParam</code> trait for <code>ResMut</code> includes an assertion that checks for conflicts with existing queries. The assertion failure message was using a hardcoded string that said “Res<{}>”, which was a copy-paste error from the <code>Res</code> implementation. This meant developers using <code>ResMut</code> would see an error message that didn’t match the code they wrote.<p>The fix is a one-line change that replaces “Res<{}>” with “ResMut<{}>” in the error message format string. This ensures that when a <code>ResMut</code> conflicts with a query, the error message correctly identifies the parameter type. The change is minimal but improves the debugging experience by providing accurate information.<p>The error message format is part of Bevy’s error code system (error B0002), which includes a link to documentation. By fixing the type name, developers can more easily correlate the error with their code and follow the provided documentation link for further guidance on resolving the conflict.<p>This change demonstrates the importance of accurate error messages in developer tools. Even small inaccuracies can lead to confusion and increased debugging time. The fix is low-risk because it only changes the text of an error message without altering any system behavior or logic.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[System Parameter: ResMut&LTT>] --> B[Conflict Check]
</span><span>    B --> C{Conflict Detected?}
</span><span>    C -->|Yes| D[Error Message: ResMut&LTT>]
</span><span>    C -->|No| E[System Execution]
</span><span>    F[Previous Implementation] --> G[Error Message: Res&LTT>]
</span><span>    H[PR #22898] --> I[Fixed Error Message]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File:</strong> <code>crates/bevy_ecs/src/system/system_param.rs</code><p>This file contains the implementation of system parameters in Bevy’s ECS. The change is in the <code>SystemParam</code> implementation for <code>ResMut</code>.<p><strong>Change Description:</strong> The error message in the assertion for <code>ResMut</code> was incorrectly referencing <code>Res</code> instead of <code>ResMut</code>. This was fixed by updating the format string.<p><strong>Code Diff:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>assert!</span><span>(component_access_set
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>get_conflicts_single</span><span>(</span><span style=color:#ed9366>&</span><span>filter)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>is_empty</span><span>()</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"error[B0002]: Res<{}> in system {} conflicts with a previous query. Consider removing the duplicate access. See: https://bevy.org/learn/errors/b0002"</span><span style=color:#61676ccc>,
</span><span>    DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>    system_meta</span><span style=color:#ed9366>.</span><span>name
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>assert!</span><span>(component_access_set
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>get_conflicts_single</span><span>(</span><span style=color:#ed9366>&</span><span>filter)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>is_empty</span><span>()</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"error[B0002]: ResMut<{}> in system {} conflicts with a previous query. Consider removing the duplicate access. See: https://bevy.org/learn/errors/b0002"</span><span style=color:#61676ccc>,
</span><span>    DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>    system_meta</span><span style=color:#ed9366>.</span><span>name
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Why This Change Matters:</strong><ul><li><strong>Accuracy:</strong> The error message now correctly identifies the parameter type as <code>ResMut</code> instead of <code>Res</code>.<li><strong>Debugging:</strong> Developers can quickly identify which system parameter is causing the conflict.<li><strong>Consistency:</strong> The error message for <code>ResMut</code> now matches the pattern used for <code>Res</code> (which has its own correct error message).</ul><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Error B0002 Documentation:</strong> https://bevy.org/learn/errors/b0002<li><strong>PR #20934:</strong> The change that allowed resources to conflict with queries.<li><strong>Bevy ECS System Parameters:</strong> Official documentation on system parameters in Bevy.<li><strong>Rust Assert Macros:</strong> Understanding how <code>assert!</code> works for runtime checks in Rust.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22898.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>