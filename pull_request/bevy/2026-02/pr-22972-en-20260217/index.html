<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22972 `FontSmoothing::None` pixel alignment fix
        
    </title><meta content="#22972 `FontSmoothing::None` pixel alignment fix" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22972-zh-cn-20260217>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p><code>FontSmoothing::None</code> pixel alignment fix<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: <code>FontSmoothing::None</code> pixel alignment fix<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22972<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Rendering, S-Ready-For-Final-Review, P-Regression, A-Text, D-Straightforward, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2026-02-16T00:48:05Z<li><strong>Merged</strong>: 2026-02-17T01:47:20Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>With <code>FontSmoothing::None</code> <code>update_text_layout_info</code> rounds the final object-centered position of each glyph. This breaks pixel alignment if the glyph has an odd size.<p>Fixes #22975<h2 id=solution>Solution</h2><p>Floor the corner-based glyph position from the Parley layout first, before we convert to object-centered coords.<h4 id=concrete-example>Concrete example</h4><ol><li>Parley returns a top-left corner-based glyph rect: <code>left = 100, top = 50, width = 15, height = 18</code><li>The UI renderer expects glyphs coords to be object centered, so we add the half size to get the object centered position of the glyph. So the glyphs horizontal center will be at: <code>x = left + width / 2 = 100 + 7.5 = 107.5</code><li>Which is pixel aligned because if we subtract the half size again we get the <code>left</code> edge position back.<li>But if we floor the object centered position <code>x' = floor(x) = 107</code>. This moves the glyph sprite’s left edge to a subpixel position: <code>left' = x' - width / 2 = 107 - 7.5 = 99.5</code><li>There’s no subpixel issues on the y-axis as the height divides exactly by 2.</ol><h2 id=testing>Testing</h2><p>If you compare the outputs closely from <code>test_bed_ui</code>’s <code>text</code> scene, the improvement is quite clear:<h4 id=main>main</h4><img alt=smooth-broke src=https://github.com/user-attachments/assets/f3d352ab-db9d-4db1-9f4e-2cad06e0563f width=548><h4 id=this-pr>this PR</h4><img alt=smooth-fix src=https://github.com/user-attachments/assets/ef5700eb-fef3-4af5-ba21-19ed85335e19 width=528><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a pixel alignment bug in Bevy’s text rendering system. When <code>FontSmoothing::None</code> is used, glyphs with odd dimensions could appear blurry or misaligned due to subpixel positioning errors. The issue was tracked in GitHub issue #22975.<p>The problem originated in how the text pipeline handled coordinate conversion. Bevy’s text rendering uses Parley for layout, which returns glyph positions as top-left corner coordinates. However, Bevy’s UI renderer expects glyph positions to be object-centered. The conversion between these coordinate systems requires adding half the glyph size to the corner position.<p>The bug occurred when <code>FontSmoothing::None</code> was enabled. In this mode, the code was rounding the final object-centered position to achieve pixel alignment. However, for glyphs with odd widths or heights, this rounding created a problem. When you round an object-centered coordinate and then subtract half the glyph size to get back to the corner position, you can end up with a subpixel corner position if the glyph has odd dimensions.<p>The developer identified that the correct approach was to apply the pixel alignment operation (flooring, not rounding) to the corner-based position from Parley first, then convert to object-centered coordinates. This ensures that both the corner position and the object-centered position remain properly aligned to pixel boundaries.<p>The implementation change is relatively small but demonstrates an important principle in graphics programming: the order of operations matters when working with pixel alignment. By fixing the position before the coordinate system conversion, the solution maintains both the pixel alignment requirement and the correct coordinate system for the renderer.<p>The fix required changing 11 lines in the text pipeline, modifying how glyph positions are calculated when <code>FontSmoothing::None</code> is active. The new approach computes the glyph position by taking the Parley-provided corner position, applying flooring if smoothing is disabled, then adding half the glyph size and the offset to get the final object-centered position.<p>This change is a regression fix, indicated by the “P-Regression” label. The straightforward nature of the fix (labeled “D-Straightforward”) and its deliberate impact on rendering (“M-Deliberate-Rendering-Change”) suggest this was a targeted fix for a specific rendering issue that likely appeared in a recent change to the text rendering system.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Parley Layout] --> B[Corner-based Glyph Position]
</span><span>    B --> C{Is FontSmoothing::None?}
</span><span>    C -->|Yes| D[Floor Corner Position]
</span><span>    C -->|No| E[Use Original Position]
</span><span>    D --> F[Convert to Object-centered Coordinates]
</span><span>    E --> F
</span><span>    F --> G[Render Glyph at Pixel-aligned Position]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-pipeline-rs-11-11><code>crates/bevy_text/src/pipeline.rs</code> (+11/-11)</h3><p>This is the only file modified in this PR. The changes are in the <code>TextPipeline::update_text_layout_info</code> method, specifically in how glyph positions are calculated when font smoothing is disabled.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> glyph_rect </span><span style=color:#ed9366>=</span><span> texture_atlas</span><span style=color:#ed9366>.</span><span>textures[location</span><span style=color:#ed9366>.</span><span>glyph_index]</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> glyph_size </span><span style=color:#ed9366>= </span><span>UVec2</span><span style=color:#ed9366>::</span><span>new(glyph_rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>width</span><span>()</span><span style=color:#61676ccc>,</span><span> glyph_rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>height</span><span>())</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let mut</span><span> x </span><span style=color:#ed9366>=</span><span> glyph_size</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0 </span><span style=color:#ed9366>+</span><span> glyph</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>+</span><span> location</span><span style=color:#ed9366>.</span><span>offset</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> y </span><span style=color:#ed9366>=</span><span> glyph_size</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0 </span><span style=color:#ed9366>+</span><span> glyph</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>-</span><span> location</span><span style=color:#ed9366>.</span><span>offset</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>if</span><span> font_smoothing </span><span style=color:#ed9366>== </span><span>FontSmoothing</span><span style=color:#ed9366>::</span><span>None {
</span><span>    x </span><span style=color:#ed9366>=</span><span> x</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>;
</span><span>    y </span><span style=color:#ed9366>=</span><span> y</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span>layout_info</span><span style=color:#ed9366>.</span><span>glyphs</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(PositionedGlyph {
</span><span>    position</span><span style=color:#61676ccc>: </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(x</span><span style=color:#61676ccc>,</span><span> y)</span><span style=color:#61676ccc>,
</span><span>    size</span><span style=color:#61676ccc>:</span><span> glyph_size</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_vec2</span><span>()</span><span style=color:#61676ccc>,
</span><span>    atlas_info</span><span style=color:#61676ccc>,
</span><span>    span_index</span><span style=color:#61676ccc>,
</span><span>    byte_index</span><span style=color:#61676ccc>:</span><span> text_range</span><span style=color:#ed9366>.</span><span>start</span><span style=color:#61676ccc>,
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> glyph_rect </span><span style=color:#ed9366>=</span><span> texture_atlas</span><span style=color:#ed9366>.</span><span>textures[location</span><span style=color:#ed9366>.</span><span>glyph_index]</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> glyph_size </span><span style=color:#ed9366>= </span><span>UVec2</span><span style=color:#ed9366>::</span><span>new(glyph_rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>width</span><span>()</span><span style=color:#61676ccc>,</span><span> glyph_rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>height</span><span>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_vec2</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> glyph_pos </span><span style=color:#ed9366>= </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(glyph</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>,</span><span> glyph</span><span style=color:#ed9366>.</span><span>y)</span><span style=color:#61676ccc>;
</span><span>
</span><span>layout_info</span><span style=color:#ed9366>.</span><span>glyphs</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(PositionedGlyph {
</span><span>    position</span><span style=color:#61676ccc>:</span><span> glyph_size </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.
</span><span>        </span><span style=color:#ed9366>+ </span><span style=color:#fa6e32>if</span><span> font_smoothing </span><span style=color:#ed9366>== </span><span>FontSmoothing</span><span style=color:#ed9366>::</span><span>None {
</span><span>            glyph_pos</span><span style=color:#ed9366>.</span><span style=color:#f07171>floor</span><span>()
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            glyph_pos
</span><span>        }
</span><span>        </span><span style=color:#ed9366>+</span><span> location</span><span style=color:#ed9366>.</span><span>offset</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_vec2</span><span>() </span><span style=color:#ed9366>* </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>1.</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1.</span><span>)</span><span style=color:#61676ccc>,
</span><span>    size</span><span style=color:#61676ccc>:</span><span> glyph_size</span><span style=color:#61676ccc>,
</span><span>    atlas_info</span><span style=color:#61676ccc>,
</span><span>    span_index</span><span style=color:#61676ccc>,
</span><span>    byte_index</span><span style=color:#61676ccc>:</span><span> text_range</span><span style=color:#ed9366>.</span><span>start</span><span style=color:#61676ccc>,
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><p>Key changes:<ol><li><code>glyph_size</code> is now converted to <code>Vec2</code> immediately using <code>.as_vec2()</code> instead of keeping it as <code>UVec2</code><li>The glyph position from Parley (<code>glyph.x</code>, <code>glyph.y</code>) is stored in a <code>Vec2</code> variable<li>Instead of rounding the final object-centered position, the code now floors the corner position when <code>FontSmoothing::None</code> is enabled<li>The position calculation is consolidated into a single expression that adds: half the glyph size, the (possibly floored) corner position, and the offset with Y inversion</ol><p>These changes ensure that when font smoothing is disabled, the corner position is aligned to pixel boundaries before being converted to object-centered coordinates, preventing subpixel positioning issues.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_text/latest/bevy_text/ target=_blank>Bevy Text Documentation</a> - Official documentation for Bevy’s text rendering system<li><a rel="noopener nofollow noreferrer" href=https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-25-rendering-vector-art-gpu target=_blank>Pixel-Perfect Text Rendering</a> - NVIDIA’s guide to vector art and text rendering on GPU<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Subpixel_rendering target=_blank>Subpixel Rendering Techniques</a> - Wikipedia article on subpixel rendering<li><a rel="noopener nofollow noreferrer" href=https://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/geometry/coordinate-systems target=_blank>Coordinate Systems in Computer Graphics</a> - Explanation of different coordinate systems used in graphics programming</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22972.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>