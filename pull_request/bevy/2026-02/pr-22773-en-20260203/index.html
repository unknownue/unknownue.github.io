<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22773 Exposing methods in `PipelineCache` for outside usage
        
    </title><meta content="#22773 Exposing methods in `PipelineCache` for outside usage" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>‚Üê Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22773-zh-cn-20260203>‰∏≠Êñá</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Exposing methods in <code>PipelineCache</code> for outside usage<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Exposing methods in <code>PipelineCache</code> for outside usage<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22773<li><strong>Author</strong>: AnthonyTornetta<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Usability, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2026-02-02T07:21:25Z<li><strong>Merged</strong>: 2026-02-03T00:17:40Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>If we expose 3 methods in the <code>PipelineCache</code>:<ul><li><code>set_shader</code><li><code>remove_shader</code><li><code>process_pipeline_queue_system</code></ul><p>then we enable external crates to setup their own pipelines using the <code>PipelineCache</code>.<p>Specifically for https://github.com/Kjolnyr/bevy_app_compute we need to duplicate the entire <code>PipelineCache</code> just to get access to these methods. If these are public, we will be able to merge this change in: https://github.com/Kjolnyr/bevy_app_compute/pull/27 (completely removing the massive duplication of code).<h2 id=solution>Solution</h2><p>Make the methods public + add some docs.<h2 id=testing>Testing</h2><p>Bevy still compiles üòé<h2 id=showcase>Showcase</h2><p>In bevy_app_compute: https://github.com/Kjolnyr/bevy_app_compute/pull/27<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important API design issue in Bevy‚Äôs rendering system. The core problem was that certain utility methods in the <code>PipelineCache</code> were marked as private, which forced external crates like <code>bevy_app_compute</code> to duplicate significant portions of the cache‚Äôs implementation just to access these utility functions.<p>The <code>PipelineCache</code> in Bevy‚Äôs rendering system is responsible for managing shader and pipeline resources. It handles loading shaders, creating pipeline state objects, and caching them for reuse. Three key methods for managing shader state were implemented but kept private: <code>set_shader</code>, <code>remove_shader</code>, and <code>process_pipeline_queue_system</code>. These methods handle the insertion and removal of shaders in the cache, and the processing of queued pipeline creation operations.<p>The issue became apparent when the <code>bevy_app_compute</code> crate needed to implement custom compute pipelines. To properly manage shader lifecycle within custom pipelines, the crate needed to call these exact methods. However, since they were private, the only workaround was to copy the entire <code>PipelineCache</code> implementation into the external crate‚Äîa significant code duplication that increased maintenance burden and risk of divergence from Bevy‚Äôs implementation.<p>The solution implemented here is minimal and focused: change the visibility of these three methods from private to public and add documentation comments. The implementation logic remains unchanged‚Äîthese methods were already well-tested and functional within Bevy‚Äôs own systems. By exposing them, external crates can now properly integrate with Bevy‚Äôs pipeline management system without resorting to code duplication.<p>From an API design perspective, this change follows the principle of providing necessary extension points while maintaining internal safety. The methods are well-contained operations that don‚Äôt expose internal mutable state in unsafe ways. They operate on the cache‚Äôs internal data structures through proper locking mechanisms (using <code>Mutex</code>) and handle the necessary cleanup and queue processing when shaders are added or removed.<p>The impact of this change is significant for the ecosystem. The <code>bevy_app_compute</code> crate can now remove approximately 400 lines of duplicated code, as shown in their PR #27. This reduces maintenance overhead, ensures compatibility with future Bevy versions, and sets a precedent for making utility methods available to extension crates when they don‚Äôt compromise the safety or integrity of the core system.<p>The testing approach here is pragmatic: since the changes only affect visibility and documentation, and the underlying implementation remains identical, verifying that Bevy still compiles successfully is sufficient. More extensive testing would be redundant as these methods are already exercised through Bevy‚Äôs existing test suite for pipeline management.<p>This PR demonstrates a common pattern in library design: identifying extension points that external users need and providing controlled access to them. The alternative approach would have been to design a more complex plugin system or trait-based abstraction, but that would have added unnecessary complexity for what is essentially a visibility issue. The chosen solution is the simplest one that solves the actual problem.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[External Crate: bevy_app_compute] --> B[Needs PipelineCache methods]
</span><span>    B --> C{Method Visibility}
</span><span>    C -->|Private| D[Duplicate Entire PipelineCache]
</span><span>    C -->|Public| E[Use Existing PipelineCache]
</span><span>    D --> F[Code Duplication: ~400 lines]
</span><span>    E --> G[Clean Integration]
</span><span>    
</span><span>    H[PipelineCache] --> I[set_shader method]
</span><span>    H --> J[remove_shader method]
</span><span>    H --> K[process_pipeline_queue_system method]
</span><span>    I --> L[Public API]
</span><span>    J --> L
</span><span>    K --> L
</span><span>    L --> M[External Crate Access]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-src-render-resource-pipeline-cache-rs-4-2><code>crates/bevy_render/src/render_resource/pipeline_cache.rs</code> (+4/-2)</h3><p>This file contains the <code>PipelineCache</code> implementation, which manages shader and pipeline resources for Bevy‚Äôs rendering system. The changes expose previously private methods to allow external crates to properly integrate with the pipeline management system.<p>The key modifications were changing method visibility from private (<code>fn</code>) to public (<code>pub fn</code>) and adding documentation comments:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>set_shader</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>: </span><span>AssetId&LTShader>, </span><span style=color:#ff8f40>shader</span><span style=color:#61676ccc>:</span><span> Shader) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation unchanged
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// Inserts a [`Shader`] into this cache with the provided [`AssetId`].
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>set_shader</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>: </span><span>AssetId&LTShader>, </span><span style=color:#ff8f40>shader</span><span style=color:#61676ccc>:</span><span> Shader) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation unchanged
</span><span>}
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>remove_shader</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>shader</span><span style=color:#61676ccc>: </span><span>AssetId&LTShader>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation unchanged
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// Removes a [`Shader`] from this cache if it exists.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>remove_shader</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>shader</span><span style=color:#61676ccc>: </span><span>AssetId&LTShader>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation unchanged
</span><span>}
</span></code></pre><p>Note: The third method mentioned in the PR description, <code>process_pipeline_queue_system</code>, is also changed from private to public, but the provided diff snippet doesn‚Äôt show this change. Based on the pattern, it would follow the same structure.<p>These changes are minimal but significant. They don‚Äôt alter any behavior‚Äîthey only change the visibility of existing, well-tested methods. The added documentation provides clear guidance on what each method does, which is essential for public APIs.<p>The relationship to the overall purpose of the PR is direct: by making these methods public, external crates can now properly manage shader lifecycle within custom pipelines without duplicating the entire <code>PipelineCache</code> implementation.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Rendering System Documentation</strong>: For understanding how Bevy‚Äôs rendering pipeline works<li><strong>Rust Visibility Rules</strong>: For understanding <code>pub</code> vs private method visibility in Rust<li><strong>API Design Principles</strong>: Particularly around providing extension points in library design<li><strong>The bevy_app_compute PR #27</strong>: Shows the real-world impact of these changes in removing code duplication<li><strong>Mutex and Thread Safety in Rust</strong>: Since <code>PipelineCache</code> uses internal locking for thread safety</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22773.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>