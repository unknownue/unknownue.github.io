<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23085 bevy_pbr format in wasm
        
    </title><meta content="#23085 bevy_pbr format in wasm" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-21</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-23085-zh-cn-20260221>中文</a></div></div><div class=pr-content><h1 id=title-bevy-pbr-format-in-wasm>Title: bevy_pbr format in wasm</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: bevy_pbr format in wasm<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/23085<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-02-20T22:46:54Z<li><strong>Merged</strong>: 2026-02-21T01:24:49Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><pre style=color:#61676c;background-color:#fafafa><code><span>error: consider adding a `;` to the last statement for consistent formatting
</span><span>  --> crates/bevy_pbr/src/gltf.rs:16:9
</span><span>   |
</span><span>16 | /         app.world_mut()
</span><span>17 | |             .resource_mut::&LTGltfExtensionHandlers>()
</span><span>18 | |             .0
</span><span>19 | |             .write()
</span><span>20 | |             .await
</span><span>21 | |             .push(Box::new(GltfExtensionHandlerPbr))
</span><span>   | |____________________________________________________^
</span><span>   |
</span><span>   = help: for further information visit https://rust-lang.github.io/rust-clippy/beta/index.html#semicolon_if_nothing_returned
</span><span>   = note: `-D clippy::semicolon-if-nothing-returned` implied by `-D warnings`
</span><span>   = help: to override `-D warnings` add `#[allow(clippy::semicolon_if_nothing_returned)]`
</span><span>help: add a `;` here
</span><span>   |
</span><span>16 |         app.world_mut()
</span><span>...
</span><span>20 |             .await
</span><span>21 ~             .push(Box::new(GltfExtensionHandlerPbr));
</span></code></pre><p>do it<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward Clippy lint warning in Bevy’s Physically Based Rendering (PBR) module. The issue involves a missing semicolon in a conditional compilation block for WebAssembly targets, which violates Rust’s consistent formatting guidelines.<p>The problem originated from a subtle inconsistency in the codebase. Within the <code>add_gltf</code> function in the <code>gltf.rs</code> module, two conditional compilation blocks handle different execution environments. The WebAssembly (<code>wasm</code>) version lacked a terminating semicolon on the final statement, while the non-WebAssembly version correctly included one. This inconsistency triggered Clippy’s <code>semicolon-if-nothing-returned</code> warning when the code was compiled with strict warnings enabled.<p>The solution approach is minimal and focused: add the missing semicolon to match Rust’s idiomatic style and resolve the lint warning. No architectural changes were needed since the functional behavior of the code remains identical with or without the semicolon. This is a pure formatting fix that improves code consistency across the codebase.<p>Looking at the implementation details, the <code>add_gltf</code> function registers a GLTF extension handler for PBR materials. The function uses conditional compilation to handle asynchronous execution differently between WebAssembly and native targets due to WebAssembly’s different concurrency model. Both code paths perform the same operation—pushing a <code>GltfExtensionHandlerPbr</code> box into a resource’s collection—but the WebAssembly version uses async/await syntax.<p>The technical insight here is about Rust’s expression-oriented nature and statement termination. In Rust, expressions return values, while statements end with semicolons and discard their return values. The Clippy warning emphasizes consistent style: when the last expression in a block isn’t being used for its return value (as in this case where it’s being called for its side effect), it should be terminated with a semicolon to make it a statement. This clarity helps readers understand that the return value (<code>()</code> in this case) isn’t being used.<p>The impact of this change is minimal from a functional perspective but contributes to code quality maintenance. Consistent formatting reduces cognitive load for developers reading the code and ensures that lint checks pass without warnings. For teams enforcing strict linting policies, such fixes prevent build failures and maintain a clean codebase. The change also demonstrates Bevy’s commitment to code quality standards, even for minor formatting issues.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[add_gltf function] --> B{Wasm target?}
</span><span>    B -->|Yes| C[Async execution path]
</span><span>    B -->|No| D[Synchronous execution path]
</span><span>    C --> E[Push handler with await]
</span><span>    D --> F[Push handler without await]
</span><span>    E --> G[Missing semicolon - Fixed]
</span><span>    F --> H[Has semicolon - Already correct]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-pbr-src-gltf-rs-1-1><code>crates/bevy_pbr/src/gltf.rs</code> (+1/-1)</h3><p>This file contains the GLTF extension handling logic for Bevy’s PBR module. The change fixes a missing semicolon in the WebAssembly-specific conditional compilation block to match Rust’s formatting conventions and resolve a Clippy warning.<p><strong>Key modifications:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_pbr/src/gltf.rs
</span><span style=color:#abb0b6;font-style:italic>// Before (lines 13-21):
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_family </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm"</span><span>)]
</span><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTGltfExtensionHandlers>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>write</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span>await
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(GltfExtensionHandlerPbr))
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (lines 13-21):
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_family </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm"</span><span>)]
</span><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTGltfExtensionHandlers>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>write</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span>await
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(GltfExtensionHandlerPbr))</span><span style=color:#61676ccc>;
</span></code></pre><p>The change adds a semicolon at the end of the statement in the WebAssembly conditional block, making it consistent with the non-WebAssembly block below it and resolving the Clippy warning about consistent formatting.<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rust Clippy Documentation</strong>: <a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/rust-clippy/master/index.html#semicolon_if_nothing_returned target=_blank>semicolon-if-nothing-returned</a> - Official documentation for the specific Clippy lint addressed in this PR.</p><li><p><strong>Rust Style Guide</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch03-03-how-functions-work.html#statements-and-expressions target=_blank>Statements and Expressions</a> - Understanding the difference between expressions and statements in Rust, which is fundamental to this fix.</p><li><p><strong>Bevy Conditional Compilation</strong>: <a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/advanced-topics/conditional-compilation/ target=_blank>Conditional Compilation in Bevy</a> - How Bevy uses conditional compilation for platform-specific code, particularly for WebAssembly targets.</p><li><p><strong>Rust WebAssembly Guide</strong>: <a rel="noopener nofollow noreferrer" href=https://rustwasm.github.io/docs/wasm-bindgen/whirlwind-tour/async-await.html target=_blank>Async/Await in WebAssembly</a> - Understanding the async/await patterns in WebAssembly Rust code, which explains why the WebAssembly path uses async syntax.</p><li><p><strong>GLTF Extension System</strong>: <a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/gltf/struct.GltfExtensionHandlers.html target=_blank>Bevy GLTF Documentation</a> - Documentation for Bevy’s GLTF extension handler system that this code modifies.</p></ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_pbr/src/gltf.rs b/crates/bevy_pbr/src/gltf.rs
</span><span>index 9923a8d74a079..ef9e67bcacc57 100644
</span><span>--- a/crates/bevy_pbr/src/gltf.rs
</span><span>+++ b/crates/bevy_pbr/src/gltf.rs
</span><span>@@ -18,7 +18,7 @@ pub(crate) fn add_gltf(app: &mut App) {
</span><span>             .0
</span><span>             .write()
</span><span>             .await
</span><span>-            .push(Box::new(GltfExtensionHandlerPbr))
</span><span>+            .push(Box::new(GltfExtensionHandlerPbr));
</span><span>     });
</span><span> 
</span><span>     #[cfg(not(target_family = "wasm"))]
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23085.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>