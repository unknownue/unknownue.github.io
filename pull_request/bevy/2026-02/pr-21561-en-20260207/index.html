<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21561 Feature/glam cross constants
        
    </title><meta content="#21561 Feature/glam cross constants" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-21561-zh-cn-20260207>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Feature/glam cross constants<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21561<li><strong>Author</strong>: pine-free<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, A-Math, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-10-16T11:53:29Z<li><strong>Merged</strong>: 2026-02-07T00:35:02Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #21333<h2 id=solution>Solution</h2><p>This PR introduces several new constants for Dir2 and Dir3, providing convenient shorthands for popular directions on a grid, such as:<ul><li>All the cardinal directions<li>All diagonals<li>All neighboring directions (cardinals + diagonals)</ul><h2 id=testing>Testing</h2><p>Changes were not tested via autotests, but I did check my math to make sure I didn’t mess up.<p>You can look at the changed files and make sure that the constants contain the directions they are supposed to<h2 id=showcase>Showcase</h2><p>For example. if you have a grid and wish to get all neighboring cells on it, you don’t have to define the directions yourself and can do the following<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> valid_positions </span><span style=color:#ed9366>= </span><span>Dir2</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ALL_NEIGHBORS</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>filter_map</span><span>(|</span><span style=color:#ff8f40>offset</span><span>| {
</span><span>    grid</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(current_position </span><span style=color:#ed9366>+</span><span> offset)
</span><span>}</span><span style=color:#ed9366>.</span><span style=color:#f07171>collect</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The Bevy math library provides <code>Dir2</code> and <code>Dir3</code> types for representing normalized 2D and 3D directions. Before this PR, developers working with grid-based systems had to manually define arrays of neighboring directions each time they needed to perform operations like finding adjacent cells. This was repetitive and error-prone.<p>The core problem was straightforward: the library provided individual direction constants but didn’t offer convenient groupings for common use cases. Issue #21333 highlighted this gap, noting that developers were reinventing the wheel for basic grid operations.<p>The solution approach was pragmatic. The developer identified the most useful groupings for 2D and 3D grid operations and added them as compile-time constants. For <code>Dir2</code>, this included the four cardinal directions, four diagonal directions, and all eight neighbors in a 3x3 neighborhood. For <code>Dir3</code>, the implementation was more complex due to the additional dimension, requiring groupings for cardinal directions (6), edge directions (12), vertex directions (8), and all 26 neighbors in a 3x3x3 neighborhood.<p>The implementation details reveal careful attention to mathematical precision. In the <code>Dir3</code> implementation, the developer added a <code>FRAC_1_SQRT_3</code> constant with a precise f32 value (0.577350269189625764509148780501957456) to maintain consistency with the existing <code>FRAC_1_SQRT_2</code> constant. This ensures that all direction vectors remain properly normalized.<p>From an engineering perspective, these changes follow established patterns in the codebase. The new constants are placed logically within their respective <code>impl</code> blocks, following similar patterns for <code>AXES</code> arrays. The use of <code>const</code> arrays ensures zero runtime overhead - these directions are computed at compile time and baked into the binary.<p>The impact is practical: developers no longer need to manually define these common direction groupings. This reduces boilerplate code and eliminates potential errors from mistyping coordinates. The example in the PR description demonstrates the improvement clearly - what previously required manually defining eight <code>Dir2</code> values can now be accessed via <code>Dir2::ALL_NEIGHBORS</code>.<p>One technical consideration worth noting is the naming convention. The constants use clear, descriptive names that align with geometric terminology: <code>CARDINALS</code>, <code>DIAGONALS</code>, <code>ALL_NEIGHBORS</code> for 2D, and <code>CARDINALS</code>, <code>ALL_EDGES</code>, <code>ALL_VERTICES</code>, <code>ALL_NEIGHBORS</code> for 3D. This consistency makes the API intuitive to use.<p>The PR follows the principle of providing “batteries included” convenience while maintaining the low-level flexibility of the existing API. Developers can still create custom direction arrays when needed, but for common cases, they now have reliable, tested constants available.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Dir2 Constants] --> B[2D Grid Operations]
</span><span>    C[Dir3 Constants] --> D[3D Grid Operations]
</span><span>    
</span><span>    A --> A1[CARDINALS: 4 directions]
</span><span>    A --> A2[DIAGONALS: 4 directions]
</span><span>    A --> A3[ALL_NEIGHBORS: 8 directions]
</span><span>    
</span><span>    C --> C1[CARDINALS: 6 directions]
</span><span>    C --> C2[ALL_EDGES: 12 directions]
</span><span>    C --> C3[ALL_VERTICES: 8 directions]
</span><span>    C --> C4[ALL_NEIGHBORS: 26 directions]
</span><span>    
</span><span>    B --> E[Grid-based Games]
</span><span>    B --> F[2D Simulation]
</span><span>    D --> G[Voxel Games]
</span><span>    D --> H[3D Simulation]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-math-src-direction-rs-154-0><code>crates/bevy_math/src/direction.rs</code> (+154/-0)</h3><p>This file contains the core implementation changes for both <code>Dir2</code> and <code>Dir3</code> types. The modifications add new constant arrays that group common directions for grid-based operations.<p><strong>Key changes for Dir2:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// The cardinal directions.
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>CARDINALS</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>4</span><span>] </span><span style=color:#ed9366>= </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>X</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_X</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Y</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_Y</span><span>]</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// The diagonals between the cardinal directions.
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>DIAGONALS</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>4</span><span>] </span><span style=color:#ed9366>= </span><span>[
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NORTH_EAST</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NORTH_WEST</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>SOUTH_EAST</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>SOUTH_WEST</span><span style=color:#61676ccc>,
</span><span>]</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// All neighbors of a tile on a square grid in a 3x3 neighborhood.
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>ALL_NEIGHBORS</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>8</span><span>] </span><span style=color:#ed9366>= </span><span>[
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>X</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_X</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Y</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_Y</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NORTH_EAST</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NORTH_WEST</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>SOUTH_EAST</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>SOUTH_WEST</span><span style=color:#61676ccc>,
</span><span>]</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Key changes for Dir3:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// The cardinal directions.
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>CARDINALS</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>6</span><span>] </span><span style=color:#ed9366>= </span><span>[
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>X</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_X</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Y</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_Y</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Z</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_Z</span><span style=color:#61676ccc>,
</span><span>]</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Precision constant for 3D diagonals
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>FRAC_1_SQRT_3</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0.577350269189625764509148780501957456_</span><span style=color:#fa6e32>f32</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// The directions pointing towards the vertices of a cube centered at the origin.
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>ALL_VERTICES</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>8</span><span>] </span><span style=color:#ed9366>= </span><span>[
</span><span>    </span><span style=color:#fa6e32>Self</span><span>(Vec3</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FRAC_1_SQRT_3</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FRAC_1_SQRT_3</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FRAC_1_SQRT_3</span><span>))</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... 7 more vertices
</span><span>]</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// The directions towards centers of each edge of a cube
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>ALL_EDGES</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>12</span><span>] </span><span style=color:#ed9366>= </span><span>[
</span><span>    </span><span style=color:#fa6e32>Self</span><span>(Vec3</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>FRAC_1_SQRT_2</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>FRAC_1_SQRT_2</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.</span><span>))</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... 11 more edges
</span><span>]</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// All neighbors of a tile on a cube grid a 3x3x3 neighborhood.
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>ALL_NEIGHBORS</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>26</span><span>] </span><span style=color:#ed9366>= </span><span>[
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>X</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_X</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Y</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_Y</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Z</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>NEG_Z</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... plus all edges and vertices
</span><span>]</span><span style=color:#61676ccc>;
</span></code></pre><p>These changes provide convenient groupings of directions that are commonly needed in grid-based algorithms, pathfinding, neighbor detection, and procedural generation systems.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Math Documentation</strong>: The official Bevy documentation for mathematical types and operations<li><strong>Grid-Based Algorithms</strong>: Common patterns in game development for grid navigation and neighbor detection<li><strong>Normalized Vectors</strong>: Mathematical background on unit vectors and their applications in game physics<li><strong>Compile-Time Computation in Rust</strong>: How Rust’s const evaluation allows for zero-cost abstractions like these direction constants</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_21561.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>