<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22941 Adding change_tick to deferred_world
        
    </title><meta content="#22941 Adding change_tick to deferred_world" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22941-zh-cn-20260217>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Adding change_tick to deferred_world<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Adding change_tick to deferred_world<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22941<li><strong>Author</strong>: andristarr<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, S-Ready-For-Final-Review, C-Refinement<li><strong>Created</strong>: 2026-02-13T11:21:01Z<li><strong>Merged</strong>: 2026-02-17T00:36:52Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #22788<h2 id=solution>Solution</h2><ul><li>Adding change_tick to deferred_world</ul><h2 id=testing>Testing</h2><ul><li>Passes</ul><hr><h2 id=showcase>Showcase</h2><ul><li>You can access change_tick to get <code>Tick</code> from deferred_world</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a specific API gap in Bevy’s ECS (Entity Component System) by adding missing functionality to the <code>DeferredWorld</code> type. The issue was straightforward: users working with <code>DeferredWorld</code> needed access to the change tick for change detection purposes, but the API was incomplete.<p>The problem originated from a user report in issue #22788. When working with <code>DeferredWorld</code>, developers couldn’t access the current change tick, which is essential for tracking when components have been modified. This limitation prevented certain patterns of change detection that were available when working directly with <code>World</code> or <code>UnsafeWorldCell</code>.<p>The solution implements a simple delegation pattern. The <code>DeferredWorld</code> struct already contains a reference to the underlying world as an <code>UnsafeWorldCell</code>. Since <code>UnsafeWorldCell</code> already has a <code>change_tick()</code> method, the implementation simply exposes this through <code>DeferredWorld</code>’s public API. This approach maintains consistency with the existing API design where <code>DeferredWorld</code> provides safe access to functionality available in the underlying unsafe world cell.<p>The implementation adds a single method to <code>DeferredWorld</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// Gets the current change tick of [`DeferredWorld`].
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>change_tick</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Tick {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>world</span><span style=color:#ed9366>.</span><span style=color:#f07171>change_tick</span><span>()
</span><span>}
</span></code></pre><p>This method is marked with <code>#[inline]</code>, which is a common optimization in Bevy’s ECS codebase for small, frequently called methods that should avoid function call overhead. The method signature takes <code>&mut self</code> because accessing the change tick requires mutable access to the world, consistent with how change detection works in Bevy’s ECS.<p>The change is minimal but important because it completes the API surface. Without this method, users working with <code>DeferredWorld</code> would need to work around the limitation by converting back to the underlying world or unsafe cell, which defeats the purpose of the deferred world abstraction.<p>From an architectural perspective, this change demonstrates Bevy’s commitment to providing consistent APIs across different world types. The <code>DeferredWorld</code> serves as a safe wrapper for deferred operations that can be batched and executed later, and having parity with other world types ensures developers can use the same patterns regardless of whether they’re working in immediate or deferred contexts.<p>The testing approach is straightforward - the method delegates to existing tested functionality in <code>UnsafeWorldCell</code>, so no complex new tests were needed. The existing test suite continues to pass, confirming the change doesn’t break existing behavior.<p>This PR represents a typical refinement in a mature codebase: identifying and filling small API gaps that affect developer ergonomics. While the change is technically simple, it improves the consistency and usability of the ECS system.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[World] -->|provides| B[change_tick()]
</span><span>    C[UnsafeWorldCell] -->|provides| D[change_tick()]
</span><span>    E[DeferredWorld] -->|wraps| C
</span><span>    E -->|now provides| F[change_tick() method]
</span><span>    F -->|delegates to| D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-world-deferred-world-rs><code>crates/bevy_ecs/src/world/deferred_world.rs</code></h3><p>This file contains the <code>DeferredWorld</code> struct and its implementation. The change adds a single method to expose the change tick functionality that was already available in the underlying <code>UnsafeWorldCell</code>.<p><strong>Key modifications:</strong><ol><li>Added import for <code>Tick</code> type from the <code>change_detection</code> module<li>Added the <code>change_tick()</code> method to <code>DeferredWorld</code>’s implementation</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_ecs/src/world/deferred_world.rs
</span><span style=color:#abb0b6;font-style:italic>// Before (relevant excerpt):
</span><span style=color:#fa6e32>use crate</span><span style=color:#61676ccc>::</span><span>{
</span><span>    archetype</span><span style=color:#ed9366>::</span><span>Archetype</span><span style=color:#61676ccc>,
</span><span>    change_detection</span><span style=color:#ed9366>::</span><span>{MaybeLocation</span><span style=color:#61676ccc>,</span><span> MutUntyped}</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other imports
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In the impl<'w> DeferredWorld<'w> block:
</span><span style=color:#abb0b6;font-style:italic>// No change_tick method existed
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use crate</span><span style=color:#61676ccc>::</span><span>{
</span><span>    archetype</span><span style=color:#ed9366>::</span><span>Archetype</span><span style=color:#61676ccc>,
</span><span>    change_detection</span><span style=color:#ed9366>::</span><span>{MaybeLocation</span><span style=color:#61676ccc>,</span><span> MutUntyped</span><span style=color:#61676ccc>,</span><span> Tick}</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// Added Tick import
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other imports
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In the impl<'w> DeferredWorld<'w> block, at the end:
</span><span style=color:#abb0b6;font-style:italic>/// Gets the current change tick of [`DeferredWorld`].
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>change_tick</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Tick {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>world</span><span style=color:#ed9366>.</span><span style=color:#f07171>change_tick</span><span>()
</span><span>}
</span></code></pre><p>The change is minimal but important for API completeness. The method provides the same functionality as <code>World::change_tick()</code> and <code>UnsafeWorldCell::change_tick()</code>, maintaining consistency across the different world access patterns in Bevy’s ECS.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy ECS Change Detection Documentation</strong>: Understanding how change ticks work in Bevy’s ECS system<li><strong>Rust Inline Attribute</strong>: Documentation on when and why to use <code>#[inline]</code> for performance optimization<li><strong>Entity Component System Patterns</strong>: General patterns for ECS architectures and how deferred operations fit into game engine design<li><strong>Bevy’s UnsafeWorldCell Documentation</strong>: Understanding the safety guarantees and patterns for unsafe world access in Bevy</ol><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/crates/bevy_ecs/src/world/deferred_world.rs b/crates/bevy_ecs/src/world/deferred_world.rs index e6fd07d0fad93..54ab26e6057d6 100644 — a/crates/bevy_ecs/src/world/deferred_world.rs +++ b/crates/bevy_ecs/src/world/deferred_world.rs @@ -4,7 +4,7 @@ use bevy_utils::prelude::DebugName;<p>use crate::{ archetype::Archetype,<ul><li>change_detection::{MaybeLocation, MutUntyped},</ul><ul><li>change_detection::{MaybeLocation, MutUntyped, Tick}, component::{ComponentId, Mutable}, entity::Entity, event::{EntityComponentsTrigger, Event, EventKey, Trigger}, @@ -823,4 +823,10 @@ impl<’w> DeferredWorld<‘w> { pub fn as_unsafe_world_cell(&mut self) -> UnsafeWorldCell<’_> { self.world }<li><li>/// Gets the current change tick of [<code>DeferredWorld</code>].<li>#[inline]<li>pub fn change_tick(&mut self) -> Tick {<li><pre style=color:#61676c;background-color:#fafafa><code><span>   self.world.change_tick()
</span></code></pre><li>} }</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22941.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>