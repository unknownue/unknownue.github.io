<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22208 Make `write_default_meta_file_for_path` write the short type path instead of the long type path
        
    </title><meta content="#22208 Make `write_default_meta_file_for_path` write the short type path instead of the long type path" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22208-zh-cn-20260222>中文</a></div></div><div class=pr-content><h1 id=title-make-write-default-meta-file-for-path-write-the-short-type-path-instead-of-the-long-type-path>Title: Make <code>write_default_meta_file_for_path</code> write the short type path instead of the long type path</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Make <code>write_default_meta_file_for_path</code> write the short type path instead of the long type path.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22208<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Assets, S-Ready-For-Final-Review, D-Straightforward, C-Refinement<li><strong>Created</strong>: 2025-12-20T08:24:02Z<li><strong>Merged</strong>: 2026-02-22T19:33:00Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The PR description is already in English, so it will be included as-is:<h1 id=objective>Objective</h1><ul><li>Context: In #17216, we stopped automatically generating meta files for assets, but provided explicit functions for generating meta files.<li>In #21339, we allowed asset processors to be specified by their short type path in meta files.<li>However, the meta file generating functions still produced fully-qualified type paths for processors. So even though we supported much more readable processor meta files, we didn’t take advantage of that when generating meta files.<li>Fulfilling my obligations to cart: https://github.com/bevyengine/bevy/pull/21339#discussion_r2621397150</ul><h2 id=solution>Solution</h2><ul><li>Make <code>ErasedProcessor</code> have a method for returning its <code>short_type_path</code>, and make its <code>default_meta</code> method take an enum to choose between using the short or long type path.<li>When generating the default meta, first lookup the processor using its short type name. If it’s ambiguous, use the long type path.<li>Add tests to show the short/long selection. As part of this, I forced all meta files to be serialized with <code>\n</code> as the new line character.<li>Bonus: add more tests for <code>write_default_meta_file_for_path</code> and <code>write_default_loader_meta_file_for_path</code> which were omitted in #17216 due to missing appropriate testing utilities (specifically a memory asset writer).</ul><h2 id=testing>Testing</h2><ul><li>Added tests!</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses an inconsistency in Bevy’s asset system. The core issue is that while Bevy already supported using short type paths for asset processors in meta files (implemented in PR #21339), the functions that generate default meta files were still using fully-qualified type paths. This meant developers couldn’t benefit from cleaner, more readable meta files when using automated meta generation.<p>The implementation approach is straightforward but requires careful consideration of edge cases. The developer needed to add a <code>short_type_path</code> method to the <code>ErasedProcessor</code> trait and modify the <code>default_meta</code> method to accept a parameter specifying which type path to use. This introduces a new enum <code>MetaTypePathKind</code> with two variants: <code>Short</code> and <code>Long</code>.<p>The key technical challenge is handling ambiguity. When multiple processors share the same short type name, the system must fall back to using the fully-qualified path to avoid confusion. The implementation handles this by first attempting to look up the processor using its short type name. If this lookup succeeds (meaning there’s exactly one processor with that short name), it uses the short path; otherwise, it falls back to the long path.<p>This change affects the asset processing workflow at a specific point: when <code>write_default_meta_file_for_path</code> is called. The method now intelligently decides which type path format to use based on whether the short name is ambiguous in the current processor registry.<p>The tests demonstrate both cases: one where the short type path is unique and used, and another where an ambiguous short type path forces the use of the fully-qualified path. The test infrastructure also needed updates to ensure consistent serialization with <code>\n</code> as the newline character.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[write_default_meta_file_for_path] --> B[Get processor short_type_path]
</span><span>    B --> C{Lookup processor by short_type_path}
</span><span>    C -->|Unique match| D[Use MetaTypePathKind::Short]
</span><span>    C -->|Ambiguous/no match| E[Use MetaTypePathKind::Long]
</span><span>    D --> F[Generate meta with short path]
</span><span>    E --> G[Generate meta with long path]
</span><span>    F --> H[Write meta file]
</span><span>    G --> H
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-asset-src-processor-mod-rs>1. <code>crates/bevy_asset/src/processor/mod.rs</code></h3><p>This file contains the main <code>AssetProcessor</code> implementation. The changes enable intelligent selection between short and long type paths when generating default meta files.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Key change in write_default_meta_file_for_path:
</span><span style=color:#fa6e32>let</span><span> short_type_path </span><span style=color:#ed9366>=</span><span> processor</span><span style=color:#ed9366>.</span><span style=color:#f07171>short_type_path</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// Try to get the processor using the short type - if it fails, that must mean that the
</span><span style=color:#abb0b6;font-style:italic>// short type path is insufficient, so we'll have to fall back to the long path.
</span><span style=color:#fa6e32>let</span><span> processor_path_kind </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_processor</span><span>(short_type_path)</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ok</span><span>() {
</span><span>    MetaTypePathKind</span><span style=color:#ed9366>::</span><span>Short
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    MetaTypePathKind</span><span style=color:#ed9366>::</span><span>Long
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let</span><span> meta </span><span style=color:#ed9366>=</span><span> processor</span><span style=color:#ed9366>.</span><span style=color:#f07171>default_meta</span><span>(processor_path_kind)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=2-crates-bevy-asset-src-processor-process-rs>2. <code>crates/bevy_asset/src/processor/process.rs</code></h3><p>This file defines the <code>ErasedProcessor</code> trait and its implementation. The changes add support for short type paths and make the <code>default_meta</code> method configurable.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added enum:
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>MetaTypePathKind </span><span>{
</span><span>    Short</span><span style=color:#61676ccc>,
</span><span>    Long</span><span style=color:#61676ccc>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added method to trait:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>short_type_path</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Modified default_meta implementation:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>default_meta</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>processor_path_kind</span><span style=color:#61676ccc>:</span><span> MetaTypePathKind) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn AssetMetaDyn> {
</span><span>    </span><span style=color:#fa6e32>let</span><span> type_path </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>match</span><span> processor_path_kind {
</span><span>        MetaTypePathKind</span><span style=color:#ed9366>::</span><span>Short </span><span style=color:#ed9366>=> </span><span>P</span><span style=color:#ed9366>::</span><span>short_type_path()</span><span style=color:#61676ccc>,
</span><span>        MetaTypePathKind</span><span style=color:#ed9366>::</span><span>Long </span><span style=color:#ed9366>=> </span><span>P</span><span style=color:#ed9366>::</span><span>type_path()</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(AssetMeta</span><span style=color:#ed9366>::</span><span><(), P></span><span style=color:#ed9366>::</span><span>new(AssetAction</span><span style=color:#ed9366>::</span><span>Process {
</span><span>        processor</span><span style=color:#61676ccc>:</span><span> type_path</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>()</span><span style=color:#61676ccc>,
</span><span>        settings</span><span style=color:#61676ccc>: </span><span>P</span><span style=color:#ed9366>::</span><span>Settings</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>    }))
</span><span>}
</span></code></pre><h3 id=3-crates-bevy-asset-src-processor-tests-rs>3. <code>crates/bevy_asset/src/processor/tests.rs</code></h3><p>This file contains tests that verify the new behavior. The tests demonstrate both the normal case (using short paths) and the ambiguous case (falling back to long paths).<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Test renamed and updated to check for short type path:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>writes_short_default_meta_for_processor</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... test setup ...
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Expected output now uses short type path:
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// processor: "LoadTransformAndSave&LTCoolTextLoader, RootAssetTransformer&LTAddText, CoolText>, CoolTextSaver>",
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// New test for ambiguous case:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>writes_long_default_meta_for_ambiguous_processor</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Creates two processors with same short type path
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Verifies that long type path is used in generated meta
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/17216 target=_blank>PR #17216</a> - Stopped automatic meta file generation and provided explicit functions<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/21339 target=_blank>PR #21339</a> - Allowed asset processors to be specified by short type paths<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_asset/latest/bevy_asset/ target=_blank>Bevy Assets Documentation</a> - Official documentation for Bevy’s asset system</ul><h1 id=full-code-diff>Full Code Diff</h1><p><em>(The full diff was provided in the original request and is preserved below exactly as provided)</em><p>diff –git a/crates/bevy_asset/src/processor/mod.rs b/crates/bevy_asset/src/processor/mod.rs index d5476f0e736b1..b8df9be2211d1 100644 — a/crates/bevy_asset/src/processor/mod.rs +++ b/crates/bevy_asset/src/processor/mod.rs @@ -444,7 +444,16 @@ impl AssetProcessor { .await; };<ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   let meta = processor.default_meta();
</span></code></pre></ul><ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   let short_type_path = processor.short_type_path();
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   // Try to get the processor using the short type - if it fails, that must mean that the
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   // short type path is insufficient, so we'll have to fall back to the long path.
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   let processor_path_kind = if self.get_processor(short_type_path).is_ok() {
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       MetaTypePathKind::Short
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   } else {
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       MetaTypePathKind::Long
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   };
</span></code></pre><li><li><pre style=color:#61676c;background-color:#fafafa><code><span>   let meta = processor.default_meta(processor_path_kind);
</span><span>   let serialized_meta = meta.serialize();
</span><span>
</span><span>   let source = self.get_source(path.source())?;
</span></code></pre></ul><p>@@ -1066,7 +1075,10 @@ impl AssetProcessor { .get_full_extension() .and_then(|ext| self.get_default_processor(&ext)) {<ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>               let meta = processor.default_meta();
</span></code></pre></ul><ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>               // Note: It doesn't matter whether we use the Long or Short kind, since we're
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               // returning the processor here anyway, and we're only using this meta to pass
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               // along the processor settings.
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               let meta = processor.default_meta(MetaTypePathKind::Long);
</span><span>               (meta, Some(processor))
</span><span>           } else {
</span><span>               match server.get_path_asset_loader(asset_path.clone()).await {
</span></code></pre></ul><p>diff –git a/crates/bevy_asset/src/processor/process.rs b/crates/bevy_asset/src/processor/process.rs index 44f50155b3c0e..151b330f356aa 100644 — a/crates/bevy_asset/src/processor/process.rs +++ b/crates/bevy_asset/src/processor/process.rs @@ -225,8 +225,18 @@ pub trait ErasedProcessor: Send + Sync { fn deserialize_meta(&self, meta: &[u8]) -> Result&LTBox<dyn assetmetadyn>, DeserializeMetaError>; /// Returns the type-path of the original [<code>Process</code>]. fn type_path(&self) -> &’static str; <ul><li>/// Returns the short type path of this processor.<li>fn short_type_path(&self) -> &’static str; /// Returns the default type-erased [<code>AssetMeta</code>] for the underlying [<code>Process</code>] impl.</ul> <ul><li>fn default_meta(&self) -> Box<dyn assetmetadyn>; <ul><li>fn default_meta(&self, processor_path_kind: MetaTypePathKind) -> Box<dyn assetmetadyn>; +} <li></li> <p>+/// Specifies which kind of path to use to specify a type. +pub enum MetaTypePathKind {</p> <ul><li>/// Use the short type path.<li>Short,<li>/// Use the fully-qualified type path.<li>Long, }</ul> <p>impl&LTP: Process> ErasedProcessor for P { @@ -257,9 +267,17 @@ impl&LTP: Process> ErasedProcessor for P { P::type_path() }</p> <ul><li>fn default_meta(&self) -> Box<dyn assetmetadyn> { <ul><li>fn short_type_path(&self) -> &’static str {<li><pre style=color:#61676c;background-color:#fafafa><code><span>   P::short_type_path()
</span></code></pre><li>}<li><li>fn default_meta(&self, processor_path_kind: MetaTypePathKind) -> Box<dyn assetmetadyn> { <li><pre style=color:#61676c;background-color:#fafafa><code><span>   let type_path = match processor_path_kind {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       MetaTypePathKind::Short => P::short_type_path(),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       MetaTypePathKind::Long => P::type_path(),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   };
</span><span>   Box::new(AssetMeta::<(), P>::new(AssetAction::Process {
</span></code></pre></li> <ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>       processor: P::type_path().to_string(),
</span></code></pre></ul> <ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>       processor: type_path.to_string(),
</span><span>       settings: P::Settings::default(),
</span><span>   }))
</span></code></pre> } diff –git a/crates/bevy_asset/src/processor/tests.rs b/crates/bevy_asset/src/processor/tests.rs index b0f59209b83a8..e48e4683b09bd 100644 — a/crates/bevy_asset/src/processor/tests.rs +++ b/crates/bevy_asset/src/processor/tests.rs @@ -1694,7 +1694,7 @@ fn only_reprocesses_wrong_hash_on_startup() { }</ul> <p>#[test] -fn writes_default_meta_for_processor() { +fn writes_short_default_meta_for_processor() { let AppWithProcessor { mut app, default_source_dirs: ProcessingDirs { source, .. }, @@ -1719,6 +1719,76 @@ fn writes_default_meta_for_processor() { let processor = app.world().resource::<assetprocessor>().clone(); bevy_tasks::block_on(processor.write_default_meta_file_for_path(ASSET_PATH)).unwrap(); <ul><li>assert_eq!(<li><pre style=color:#61676c;background-color:#fafafa><code><span>   read_meta_as_string(&source, Path::new(ASSET_PATH)),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   r#"(
</span></code></pre><li>meta_format_version: “1.0”,<li>asset: Process(<li><pre style=color:#61676c;background-color:#fafafa><code><span>   processor: "LoadTransformAndSave&LTCoolTextLoader, RootAssetTransformer&LTAddText, CoolText>, CoolTextSaver>",
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   settings: (
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       loader_settings: (),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       transformer_settings: (),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       saver_settings: (),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   ),
</span></code></pre><li>), +)“#<li>); +}<li></ul> <p>+mod ambiguous {</p> <ul><li>use super::{CoolText, MutateAsset, TypePath};<li><li>/// This is ambiguous with [<code>super::AddText</code>] for short-type paths.<li>#[derive(TypePath)]<li>pub(crate) struct AddText;<li><li>// Add a dummy MutateAsset impl so we can use it as a processor.<li>impl MutateAsset<cooltext> for AddText { <li><pre style=color:#61676c;background-color:#fafafa><code><span>   fn mutate(&self, _: &mut CoolText) {}
</span></code></pre></li> <li>} +}</li> <li></li> <p>+#[test] +fn writes_long_default_meta_for_ambiguous_processor() {</p> <ul><li>let AppWithProcessor {<li><pre style=color:#61676c;background-color:#fafafa><code><span>   mut app,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   default_source_dirs: ProcessingDirs { source, .. },
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   ..
</span></code></pre><li>} = create_app_with_asset_processor(&[]);<li><li>type CoolTextProcessor1 = LoadTransformAndSave<<li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextLoader,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   RootAssetTransformer&LTAddText, CoolText>,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextSaver,
</span></code></pre><li><blockquote><p>;</blockquote><li>type CoolTextProcessor2 = LoadTransformAndSave<<li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextLoader,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   RootAssetTransformer&LTambiguous::AddText, CoolText>,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextSaver,
</span></code></pre><li><blockquote><p>;</blockquote><li>// Verify that these two processors actually have the same short_type_path.<li>assert_eq!(<li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextProcessor1::short_type_path(),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextProcessor2::short_type_path()
</span></code></pre><li>);<li><li>app.register_asset_processor(CoolTextProcessor1::new(<li><pre style=color:#61676c;background-color:#fafafa><code><span>   RootAssetTransformer::new(AddText("blah".to_string())),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextSaver,
</span></code></pre><li>))<li>.set_default_asset_processor::<cooltextprocessor1>(“cool.ron”) <li>// Add another processor with the same short type path to make the short type name ambiguous.</li> <li>.register_asset_processor(CoolTextProcessor2::new(</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   RootAssetTransformer::new(ambiguous::AddText),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   CoolTextSaver,
</span></code></pre></li> <li>));</li> <li></li> <li>const ASSET_PATH: &str = “abc.cool.ron”;</li> <li>source.insert_asset_text(Path::new(ASSET_PATH), &serialize_as_cool_text(“blah”));</li> <li></li> <li>let processor = app.world().resource::<assetprocessor>().clone(); <li>bevy_tasks::block_on(processor.write_default_meta_file_for_path(ASSET_PATH)).unwrap();</li> <li>assert_eq!( read_meta_as_string(&source, Path::new(ASSET_PATH)), r#“(</li>    <div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22208.patch id=patch-info style=display:none></div>  <div class=bottom-spacer></div> 