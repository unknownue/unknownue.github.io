<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22460 Add tools to avoid unnecessary `AssetEvent::Modified` events that lead to rendering performance costs (#16751)
        
    </title><meta content="#22460 Add tools to avoid unnecessary `AssetEvent::Modified` events that lead to rendering performance costs (#16751)" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22460-zh-cn-20260210>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add tools to avoid unnecessary <code>AssetEvent::Modified</code> events that lead to rendering performance costs (#16751)<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22460<li><strong>Author</strong>: MatrixDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Assets, C-Performance, S-Ready-For-Final-Review, M-Migration-Guide, D-Modest<li><strong>Created</strong>: 2026-01-09T17:39:56Z<li><strong>Merged</strong>: 2026-02-10T19:08:38Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #16751</ul><h2 id=solution>Solution</h2><ul><li><code>Assets::get_mut</code> now returns a wrapper <code>AssetMut</code> type instead of <code>&mut impl Asset</code>.<li><code>AssetMut</code> implements <code>Deref</code> and <code>DerefMut</code>.<li><code>DerefMut</code> marks assets as changed.<li>when dropped <code>AssetMut</code> will add <code>AssetEvent::Modified</code> event to a queue only in case asset was marked as changed.</ul><h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? <ul><li>No unit tests were added, change is pretty straightforward.<li>Test project: https://github.com/MatrixDev/bevy-feature-16751-test. <ul><li>With change: ~100 fps.<li>Without change: ~15 fps.</ul></ul><li>Are there any parts that need more testing? <ul><li>I don’t really see how this can break anything or add a measurable overhead.<li><code>AssetEvent::Modified</code> will now be sent after the asset was modified instead of before. It should not affect anything but still worth noting.</ul><li>How can other people (reviewers) test your changes? Is there anything specific they need to know? <ul><li>Have a big amount of entities that constantly update their materials.<li>Properties of those materials should be animated in a stepped maned (like changing color every 0.1 seconds).<li>Update material only if value has actually changed:</ul></ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if</span><span> material</span><span style=color:#ed9366>.</span><span>base_color </span><span style=color:#ed9366>!=</span><span> new_color {
</span><span>    material</span><span style=color:#ed9366>.</span><span>base_color </span><span style=color:#ed9366>=</span><span> new_color</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ul><li>If relevant, what platforms did you test these changes on, and are there any important ones you can’t test? <ul><li>tested on macos (Mackbook M1)<li>not a platform-specific issue</ul></ul><p>PS: This is my first PR, so please don’t judge.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a performance problem in Bevy’s asset system where unnecessary <code>AssetEvent::Modified</code> events were being generated even when assets weren’t actually modified. This issue (#16751) manifested as significant rendering performance degradation in applications that frequently checked assets for updates.<p>The root cause was straightforward: the <code>Assets::get_mut</code> method would immediately queue a <code>Modified</code> event whenever called, regardless of whether the returned mutable reference was actually used to modify the asset. This design worked correctly for ensuring changes were detected, but was inefficient for common patterns where developers check if an asset needs updating before modifying it.<p>For example, consider a common pattern in game development:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// This pattern was problematic before the PR
</span><span style=color:#fa6e32>let mut</span><span> material </span><span style=color:#ed9366>=</span><span> materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(material_handle)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>if</span><span> material</span><span style=color:#ed9366>.</span><span>base_color </span><span style=color:#ed9366>!=</span><span> new_color {
</span><span>    material</span><span style=color:#ed9366>.</span><span>base_color </span><span style=color:#ed9366>=</span><span> new_color</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>Even when <code>material.base_color == new_color</code> and no actual modification occurred, the original implementation would still trigger a <code>Modified</code> event. In rendering pipelines, these events often trigger expensive operations like material extraction and GPU resource updates, leading to the performance issues reported in the original issue.<p>The solution implements a change detection mechanism similar to Bevy’s ECS <code>Mut&LTT></code> wrapper. The key insight is to defer the <code>Modified</code> event emission until we know whether the asset was actually mutated. This is achieved through a new <code>AssetMut</code> wrapper type that tracks whether dereferencing operations modify the underlying asset.<p>The implementation has three main components:<ol><li><p><strong><code>AssetMut</code> wrapper type</strong>: This replaces the direct <code>&mut A</code> return type from <code>Assets::get_mut</code>. It contains both a reference to the asset and a change notification guard.</p><li><p><strong>Change tracking through <code>DerefMut</code></strong>: The <code>AssetMut</code> type implements <code>Deref</code> for read-only access and <code>DerefMut</code> for mutable access. Crucially, <code>DerefMut::deref_mut</code> marks the asset as changed when called.</p><li><p><strong>Conditional event emission on drop</strong>: The change notification guard (<code>AssetMutChangeNotifier</code>) tracks whether the asset was marked as changed. When the <code>AssetMut</code> is dropped, it only emits a <code>Modified</code> event if the asset was actually modified.</p></ol><p>This approach provides several benefits:<ul><li><strong>Performance improvement</strong>: Eliminates unnecessary rendering work when assets are checked but not modified<li><strong>Backwards compatibility</strong>: The <code>Deref</code>/<code>DerefMut</code> implementation means most existing code continues to work with minimal changes<li><strong>Explicit control</strong>: Developers can use <code>into_inner_untracked()</code> or <code>bypass_change_detection()</code> for advanced use cases</ul><p>One important technical detail is the timing of event emission. Previously, <code>Modified</code> events were queued immediately when <code>get_mut</code> was called. Now, events are queued when the <code>AssetMut</code> is dropped, which happens after any modifications. This change in timing shouldn’t affect most systems but is worth noting for edge cases.<p>The implementation required updates throughout the codebase because <code>Assets::get_mut</code> now returns <code>Option&LTAssetMut<'_, A>></code> instead of <code>Option<&mut A></code>. Most updates were straightforward - adding <code>mut</code> to pattern bindings to accommodate the <code>DerefMut</code> implementation:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> material </span><span style=color:#ed9366>=</span><span> materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(material_handle)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let mut</span><span> material </span><span style=color:#ed9366>=</span><span> materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(material_handle)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><p>This change enables more efficient asset update patterns. Developers can now write code that checks if an asset needs updating without paying the performance penalty of unnecessary re-extraction:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Now efficient with the PR changes
</span><span style=color:#fa6e32>let mut</span><span> material </span><span style=color:#ed9366>=</span><span> materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(material_handle)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>if</span><span> material</span><span style=color:#ed9366>.</span><span>base_color </span><span style=color:#ed9366>!=</span><span> new_color {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Only triggers Modified event if this line executes
</span><span>    material</span><span style=color:#ed9366>.</span><span>base_color </span><span style=color:#ed9366>=</span><span> new_color</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The performance impact is significant. The author’s test project showed frame rates improving from ~15 FPS to ~100 FPS in a scenario with many entities checking and conditionally updating materials. This demonstrates how small, targeted changes to core systems can have substantial performance benefits.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Assets::get_mut] --> B[Returns AssetMut]
</span><span>    B --> C[Deref for read access]
</span><span>    B --> D[DerefMut for write access]
</span><span>    D --> E[Marks asset as changed]
</span><span>    B --> F[Drops AssetMut]
</span><span>    F --> G{Asset changed?}
</span><span>    G -->|Yes| H[Queue Modified event]
</span><span>    G -->|No| I[No event]
</span><span>    
</span><span>    style D fill:#e1f5e1
</span><span>    style E fill:#e1f5e1
</span><span>    style H fill:#e1f5e1
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-asset-src-assets-rs-142-7><code>crates/bevy_asset/src/assets.rs</code> (+142/-7)</h3><p>This is the core implementation file where the <code>AssetMut</code> type and related change detection logic are added.<p><strong>Key changes:</strong><ol><li>Modified <code>get_mut</code> to return <code>AssetMut<'_, A></code> instead of <code>Option<&mut A></code><li>Added <code>AssetMut</code> struct with <code>Deref</code> and <code>DerefMut</code> implementations<li>Added <code>AssetMutChangeNotifier</code> to track changes and conditionally emit events</ol><p><strong>Code snippets:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> impl </span><span style=color:#55b4d4;font-style:italic>Into</span><span>&LTAssetId&LTA>>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> A> {
</span><span>    </span><span style=color:#fa6e32>let</span><span> id</span><span style=color:#61676ccc>: </span><span>AssetId&LTA> </span><span style=color:#ed9366>=</span><span> id</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> result </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>match</span><span> id {
</span><span>        AssetId</span><span style=color:#ed9366>::</span><span>Index { index</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>.. </span><span>} </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>dense_storage</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(index)</span><span style=color:#61676ccc>,
</span><span>        AssetId</span><span style=color:#ed9366>::</span><span>Uuid { uuid } </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>hash_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span>uuid)</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>if</span><span> result</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_some</span><span>() {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>queued_events</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(AssetEvent</span><span style=color:#ed9366>::</span><span>Modified { id })</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    result
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> impl </span><span style=color:#55b4d4;font-style:italic>Into</span><span>&LTAssetId&LTA>>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTAssetMut<'</span><span style=color:#ed9366>_</span><span>, A>> {
</span><span>    </span><span style=color:#fa6e32>let</span><span> id</span><span style=color:#61676ccc>: </span><span>AssetId&LTA> </span><span style=color:#ed9366>=</span><span> id</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> result </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>match</span><span> id {
</span><span>        AssetId</span><span style=color:#ed9366>::</span><span>Index { index</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>.. </span><span>} </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>dense_storage</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(index)</span><span style=color:#61676ccc>,
</span><span>        AssetId</span><span style=color:#ed9366>::</span><span>Uuid { uuid } </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>hash_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span>uuid)</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(AssetMut {
</span><span>        asset</span><span style=color:#61676ccc>:</span><span> result</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>,
</span><span>        guard</span><span style=color:#61676ccc>:</span><span> AssetMutChangeNotifier {
</span><span>            changed</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>            asset_id</span><span style=color:#61676ccc>:</span><span> id</span><span style=color:#61676ccc>,
</span><span>            queued_events</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>queued_events</span><span style=color:#61676ccc>,
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>    })
</span><span>}
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New AssetMut type implementation:
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>'a</span><span>, A</span><span style=color:#61676ccc>:</span><span> Asset> DerefMut </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>AssetMut</span><span><</span><span style=color:#fa6e32>'a</span><span>, A> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>deref_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut Self</span><span style=color:#ed9366>::</span><span>Target {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>guard</span><span style=color:#ed9366>.</span><span>changed </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Mark as changed when mutable access occurs
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>asset
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Change notifier that conditionally emits events on drop:
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>'a</span><span>, A</span><span style=color:#61676ccc>:</span><span> Asset> Drop </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>AssetMutChangeNotifier</span><span><</span><span style=color:#fa6e32>'a</span><span>, A> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>drop</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) {
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>changed {
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>queued_events
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(AssetEvent</span><span style=color:#ed9366>::</span><span>Modified { id</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>asset_id })</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=release-content-migration-guides-asset-mut-change-detection-md-34-0><code>release-content/migration-guides/asset-mut-change-detection.md</code> (+34/-0)</h3><p>A new migration guide explaining the change and how to update code to take advantage of the new behavior.<p><strong>Content:</strong><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#ed9366;background-color:#61676c10>`Assets::get_mut`</span><span> will now return </span><span style=color:#ed9366;background-color:#61676c10>`AssetMut&LTA: Asset>`</span><span> instead of </span><span style=color:#ed9366;background-color:#61676c10>`&mut Asset`</span><span>.
</span><span>Similar to </span><span style=color:#ed9366;background-color:#61676c10>`Mut`</span><span>/</span><span style=color:#ed9366;background-color:#61676c10>`ResMut`</span><span>, new implementation will trigger </span><span style=color:#ed9366;background-color:#61676c10>`AssetEvent::Modified`</span><span>
</span><span>event only when the asset is actually mutated.
</span><span>
</span><span>In some cases (like materials), triggering </span><span style=color:#ed9366;background-color:#61676c10>`AssetEvent::Modified`</span><span> event might lead to
</span><span>measurable performance costs. To avoid this, it is now possible to check if the </span><span style=color:#ed9366;background-color:#61676c10>`Asset`</span><span>
</span><span>will change before mutating it:
</span></code></pre><h3 id=crates-bevy-text-src-font-atlas-rs-7-6><code>crates/bevy_text/src/font_atlas.rs</code> (+7/-6)</h3><p>Updated to work with the new <code>AssetMut</code> API, demonstrating the pattern for handling multiple mutable asset references.<p><strong>Code snippet:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> atlas_layout </span><span style=color:#ed9366>=</span><span> atlas_layouts</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>texture_atlas)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> atlas_texture </span><span style=color:#ed9366>=</span><span> textures</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>texture)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let mut</span><span> atlas_layout </span><span style=color:#ed9366>=</span><span> atlas_layouts</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>texture_atlas)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> atlas_texture </span><span style=color:#ed9366>=</span><span> textures</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>texture)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=examples-3d-solari-rs-5-5><code>examples/3d/solari.rs</code> (+5/-5)</h3><p>A representative example showing the minimal code changes required throughout the codebase.<p><strong>Code snippet:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> material </span><span style=color:#ed9366>=</span><span> materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(material_handle)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let mut</span><span> material </span><span style=color:#ed9366>=</span><span> materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(material_handle)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=examples-large-scenes-mipmap-generator-src-lib-rs-3-3><code>examples/large_scenes/mipmap_generator/src/lib.rs</code> (+3/-3)</h3><p>Shows how to handle cases where you need to pass the inner asset reference to functions.<p><strong>Code snippet:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>if </span><span style=color:#f07171>check_image_compatible</span><span>(image)</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ok</span><span>()
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if </span><span style=color:#f07171>check_image_compatible</span><span>(</span><span style=color:#ed9366>&</span><span>image)</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ok</span><span>()
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Bevy Change Detection</strong>: The pattern used here is similar to Bevy’s ECS change detection with <code>Mut&LTT></code> and <code>ResMut&LTT></code> types. Understanding how Bevy handles change detection in general will help contextualize this change.</p><li><p><strong>Rust’s Deref and DerefMut traits</strong>: This implementation relies heavily on Rust’s <code>Deref</code> and <code>DerefMut</code> traits for ergonomic access to wrapped types. The Rust documentation on these traits provides important background.</p><li><p><strong>RAII (Resource Acquisition Is Initialization) Pattern</strong>: The use of <code>Drop</code> implementation to conditionally emit events is an example of the RAII pattern, common in Rust for managing resources and side effects.</p><li><p><strong>Performance Optimization in Game Engines</strong>: This PR demonstrates a common optimization pattern in game engines - avoiding unnecessary work by carefully tracking what actually changed rather than assuming everything accessed might have changed.</p></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22460.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>