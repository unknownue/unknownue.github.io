<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22764 Serialize `ImageLoaderSettings::texture_format`
        
    </title><meta content="#22764 Serialize `ImageLoaderSettings::texture_format`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-04</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22764-zh-cn-20260204>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Serialize <code>ImageLoaderSettings::texture_format</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22764<li><strong>Author</strong>: beicause<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-02-01T08:36:05Z<li><strong>Merged</strong>: 2026-02-04T01:14:37Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p><code>ImageLoaderSettings::texture_format</code> should be serialized.<h2 id=solution>Solution</h2><p>Enable <code>wgpu-types/serde</code> to serialize it and use <code>#[serde(default)]</code> for backward compatibility.<h2 id=testing>Testing</h2><p>ci<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem was straightforward but had implications for scene serialization workflows in Bevy. The <code>ImageLoaderSettings</code> struct includes a <code>texture_format</code> field that allows developers to explicitly specify a texture format when loading images, overriding automatic format detection. This is particularly useful for cases where image data needs to be interpreted differently than what the file extension suggests—for example, when loading 16-bit unsigned integer data that needs to be sampled as signed normalized floats.<p>However, before this PR, the <code>texture_format</code> field was marked with <code>#[serde(skip)]</code>, meaning it wasn’t being serialized when scenes were saved. This created a workflow issue: if a developer configured an image with a specific <code>texture_format</code> in their application, saved the scene, and then loaded it back, the custom format setting would be lost. The image would revert to using whatever format the loader determined automatically, which could lead to incorrect rendering or runtime errors.<p>The solution involved two coordinated changes. First, the <code>wgpu-types</code> dependency needed the <code>serde</code> feature enabled to make the <code>TextureFormat</code> enum serializable. This was necessary because <code>TextureFormat</code> comes from an external crate (<code>wgpu-types</code>), and by default, its serialization support is gated behind a feature flag. Second, the field annotation needed to change from <code>#[serde(skip)]</code> to <code>#[serde(default)]</code> to enable serialization while maintaining backward compatibility.<p>The <code>#[serde(default)]</code> attribute is important for handling cases where serialized data doesn’t contain the <code>texture_format</code> field—either from scenes saved before this change, or from users who don’t explicitly set this field. When deserializing, if the field is missing, Serde will use the default value for <code>Option&LTTextureFormat></code>, which is <code>None</code>. This ensures that existing scenes continue to work correctly.<p>The implementation is minimal but effective. By enabling the <code>serde</code> feature on <code>wgpu-types</code>, we gain the ability to serialize the <code>TextureFormat</code> enum without modifying the external crate. The change to <code>#[serde(default)]</code> is the standard pattern for optional fields in serializable structs in Rust.<p>This fix improves the usability of Bevy’s scene system by ensuring that image configuration persists across save/load cycles. It’s particularly important for applications that rely on non-standard texture formats for specialized rendering techniques or data processing pipelines.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[ImageLoaderSettings Struct] --> B[texture_format Field]
</span><span>    B --> C[Serialization Issue]
</span><span>    C --> D[Enable wgpu-types/serde Feature]
</span><span>    C --> E[Change #[serde(skip)] to #[serde(default)]]
</span><span>    D --> F[TextureFormat becomes Serializable]
</span><span>    E --> G[Backward Compatibility Maintained]
</span><span>    F --> H[Complete Solution]
</span><span>    G --> H
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-image-cargo-toml-1-1><code>crates/bevy_image/Cargo.toml</code> (+1/-1)</h3><p><strong>What changed and why</strong>: Added the <code>serde</code> feature to the <code>wgpu-types</code> dependency. This enables serialization support for the <code>TextureFormat</code> enum, which is required for the <code>texture_format</code> field to be serializable.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>wgpu-types </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"28"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>wgpu-types </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"28"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"serde"</span><span>] }
</span></code></pre><h3 id=crates-bevy-image-src-image-loader-rs-1-1><code>crates/bevy_image/src/image_loader.rs</code> (+1/-1)</h3><p><strong>What changed and why</strong>: Changed the Serde attribute on the <code>texture_format</code> field from <code>#[serde(skip)]</code> to <code>#[serde(default)]</code>. This enables the field to be included in serialization while maintaining backward compatibility by using <code>None</code> as the default value when the field is missing from serialized data.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>serde</span><span>(skip)]
</span><span style=color:#fa6e32>pub</span><span> texture_format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTwgpu_types</span><span style=color:#ed9366>::</span><span>TextureFormat></span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>serde</span><span>(default)]
</span><span style=color:#fa6e32>pub</span><span> texture_format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTwgpu_types</span><span style=color:#ed9366>::</span><span>TextureFormat></span><span style=color:#61676ccc>,
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Serde Attributes Documentation</strong>: The official Serde guide to field attributes provides details on <code>#[serde(default)]</code> and other serialization options: https://serde.rs/field-attrs.html<li><strong>Bevy Scene System</strong>: Understanding how Bevy handles scene serialization and asset loading: https://bevyengine.org/learn/book/features/scenes/<li><strong>wgpu-types Crate</strong>: Documentation for the external crate that provides texture format definitions: https://docs.rs/wgpu-types<li><strong>Texture Formats in Graphics</strong>: A general overview of texture formats and their uses in graphics programming: https://learnopengl.com/Getting-started/Textures</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_image/Cargo.toml b/crates/bevy_image/Cargo.toml
</span><span>index 1cfe1bc66997f..8590a35278eef 100644
</span><span>--- a/crates/bevy_image/Cargo.toml
</span><span>+++ b/crates/bevy_image/Cargo.toml
</span><span>@@ -70,7 +70,7 @@ image = { version = "0.25.2", default-features = false }
</span><span> # misc
</span><span> bitflags = { version = "2.3", features = ["serde"] }
</span><span> bytemuck = { version = "1.5" }
</span><span>-wgpu-types = { version = "28", default-features = false }
</span><span>+wgpu-types = { version = "28", default-features = false, features = ["serde"] }
</span><span> serde = { version = "1", features = ["derive"] }
</span><span> thiserror = { version = "2", default-features = false }
</span><span> futures-lite = "2.0.1"
</span><span>diff --git a/crates/bevy_image/src/image_loader.rs b/crates/bevy_image/src/image_loader.rs
</span><span>index 522581e510c06..9e7d6367719fa 100644
</span><span>--- a/crates/bevy_image/src/image_loader.rs
</span><span>+++ b/crates/bevy_image/src/image_loader.rs
</span><span>@@ -119,7 +119,7 @@ pub struct ImageLoaderSettings {
</span><span>     /// in a shader.
</span><span>     /// Ex: data that would be `R16Uint` that needs to
</span><span>     /// be sampled as a float using `R16Snorm`.
</span><span>-    #[serde(skip)]
</span><span>+    #[serde(default)]
</span><span>     pub texture_format: Option&LTwgpu_types::TextureFormat>,
</span><span>     /// Specifies whether image data is linear
</span><span>     /// or in sRGB space when this is not determined by
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22764.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>