<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22908 Fix Image pixel access error propagation for compressed formats
        
    </title><meta content="#22908 Fix Image pixel access error propagation for compressed formats" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-12</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22908-zh-cn-20260212>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix Image pixel access error propagation for compressed formats<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22908<li><strong>Author</strong>: mirsella<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Rendering, S-Ready-For-Final-Review, M-Migration-Guide<li><strong>Created</strong>: 2026-02-11T14:07:34Z<li><strong>Merged</strong>: 2026-02-12T18:50:21Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>follow up to #22414<p>in my comment <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22414#issuecomment-2645849258 target=_blank>https://github.com/bevyengine/bevy/pull/22414#issuecomment-2645849258</a> i realized the warn added in #22414 would never actually trigger because <code>pixel_bytes</code> and <code>pixel_bytes_mut</code> were returning <code>Option</code> instead of <code>Result</code>, which caused the <code>UnsupportedTextureFormat</code> error to be lost and converted to <code>OutOfBounds</code>.<p>this changes:<ul><li><code>pixel_data_offset</code> now returns <code>Result</code> instead of <code>Option</code><li><code>pixel_bytes</code> and <code>pixel_bytes_mut</code> now return <code>Result</code> instead of <code>Option</code><li>errors are properly propagated so the warn in sprite picking actually triggers for compressed textures<li>added a regression test <code>compressed_texture_format_is_reported_correctly</code><li>updated <code>examples/2d/cpu_draw.rs</code> for the new signature</ul><p>should i remove the regression test if it’s useless ?<p>thanks<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses an error propagation issue in Bevy’s image handling system, specifically related to how compressed texture formats report errors when accessed through pixel-level operations. The problem originated from a previous PR (#22414) that attempted to add warnings for unsupported texture formats but had a fundamental flaw in its implementation.<p>The core issue was in the <code>Image</code> struct’s pixel access methods: <code>pixel_data_offset</code>, <code>pixel_bytes</code>, and <code>pixel_bytes_mut</code>. These methods were returning <code>Option<...></code> instead of <code>Result<..., TextureAccessError></code>, which meant that different types of errors were being collapsed into a single <code>None</code> value. Specifically, when trying to access pixels in compressed texture formats (like BC1, BC2, BC3, ETC2, etc.), the <code>UnsupportedTextureFormat</code> error was being lost and incorrectly reported as an <code>OutOfBounds</code> error.<p>This bug was particularly problematic because it prevented the warning system added in PR #22414 from working correctly. The warning was supposed to alert users when sprite picking operations encountered compressed textures (which don’t support direct pixel access), but since the error type was being converted, the warning never triggered.<p>The developer’s solution was straightforward but important: change the return types from <code>Option</code> to <code>Result<..., TextureAccessError></code> and ensure proper error propagation throughout the call chain. This involved updating three key methods:<ol><li><code>pixel_data_offset</code> - Changed from returning <code>None</code> for out-of-bounds access to returning <code>Err(TextureAccessError::OutOfBounds{...})</code><li><code>pixel_bytes</code> and <code>pixel_bytes_mut</code> - Now properly propagate errors from both <code>pixel_data_offset</code> and the format’s <code>pixel_size()</code> method, and also handle the case where image data is not initialized</ol><p>The implementation shows good attention to error handling patterns. Instead of using <code>.ok()</code> to convert <code>Result</code> to <code>Option</code> (which discards error information), the code now uses the <code>?</code> operator to propagate errors while preserving their type. This allows callers to distinguish between different failure modes: out-of-bounds access, unsupported texture formats, and uninitialized image data.<p>An important addition was the new <code>TextureAccessError::Uninitialized</code> variant, which handles the case where <code>self.data</code> is <code>None</code>. Previously, this would return <code>None</code> from the <code>Option</code>, making it indistinguishable from other errors.<p>The changes also required updating the internal methods <code>get_color_at_internal</code> and <code>set_color_at_internal</code> to handle the new <code>Result</code> types. These methods now simply propagate errors using the <code>?</code> operator, which simplifies their logic and ensures consistent error reporting.<p>From an architectural perspective, this fix improves the API’s clarity and correctness. By using <code>Result</code> instead of <code>Option</code>, the methods now explicitly communicate what can go wrong, allowing callers to handle different error cases appropriately. This is particularly important for a game engine like Bevy where texture handling is a common operation and developers need clear feedback when something goes wrong.<p>The PR includes a regression test <code>compressed_texture_format_is_reported_correctly</code> that verifies compressed textures correctly report <code>UnsupportedTextureFormat</code> errors. This test creates an image with the BC1RgbaUnorm format (a compressed format) and attempts to access pixels, ensuring the proper error is returned. The test also covers both read (<code>get_color_at</code>) and write (<code>set_color_at</code>) operations.<p>The migration guide added with this PR provides clear instructions for users who need to update their code. It explains the rationale for the change and shows before/after examples of how to handle the new <code>Result</code> return type.<p>This fix has minimal performance impact since it mainly changes error handling logic rather than adding new computations. The use of <code>#[inline(always)]</code> on these small methods helps ensure the error handling doesn’t introduce significant overhead.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Caller: get_color_at/set_color_at] --> B[pixel_bytes/pixel_bytes_mut]
</span><span>    B --> C[pixel_data_offset]
</span><span>    C --> D{Check bounds}
</span><span>    D -->|Out of bounds| E[Error::OutOfBounds]
</span><span>    D -->|In bounds| F[Compute offset]
</span><span>    B --> G[format.pixel_size()]
</span><span>    G -->|Unsupported format| H[Error::UnsupportedTextureFormat]
</span><span>    G -->|Supported format| I[Get pixel size]
</span><span>    B --> J{data initialized?}
</span><span>    J -->|No data| K[Error::Uninitialized]
</span><span>    J -->|Has data| L[Return slice]
</span><span>    
</span><span>    style E fill:#f96
</span><span>    style H fill:#f96
</span><span>    style K fill:#f96
</span><span>    style L fill:#6c6
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-image-src-image-rs-63-32><code>crates/bevy_image/src/image.rs</code> (+63/-32)</h3><p>This file contains the core implementation changes for the <code>Image</code> struct’s pixel access methods. The key modifications include:<ol><li><strong>Return type changes from <code>Option</code> to <code>Result</code></strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>pixel_data_offset</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>coords</span><span style=color:#61676ccc>:</span><span> UVec3) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#fa6e32>usize</span><span>> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>if</span><span> coords</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>>=</span><span> width </span><span style=color:#ed9366>||</span><span> coords</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>>=</span><span> height </span><span style=color:#ed9366>||</span><span> coords</span><span style=color:#ed9366>.</span><span>z </span><span style=color:#ed9366>>=</span><span> depth {
</span><span>        </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// No error details
</span><span>    }
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>pixel_data_offset</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>coords</span><span style=color:#61676ccc>:</span><span> UVec3) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>usize</span><span>, TextureAccessError> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>if</span><span> coords</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>>=</span><span> width </span><span style=color:#ed9366>||</span><span> coords</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>>=</span><span> height </span><span style=color:#ed9366>||</span><span> coords</span><span style=color:#ed9366>.</span><span>z </span><span style=color:#ed9366>>=</span><span> depth {
</span><span>        </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(TextureAccessError</span><span style=color:#ed9366>::</span><span>OutOfBounds {
</span><span>            x</span><span style=color:#61676ccc>:</span><span> coords</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>,
</span><span>            y</span><span style=color:#61676ccc>:</span><span> coords</span><span style=color:#ed9366>.</span><span>y</span><span style=color:#61676ccc>,
</span><span>            z</span><span style=color:#61676ccc>:</span><span> coords</span><span style=color:#ed9366>.</span><span>z</span><span style=color:#61676ccc>,
</span><span>        })</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Detailed error
</span><span>    }
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><ol start=2><li><strong>Proper error propagation in pixel access methods</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>pixel_bytes</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>coords</span><span style=color:#61676ccc>:</span><span> UVec3) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>[</span><span style=color:#fa6e32>u8</span><span>]> {
</span><span>    </span><span style=color:#fa6e32>let</span><span> len </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>texture_descriptor</span><span style=color:#ed9366>.</span><span>format</span><span style=color:#ed9366>.</span><span style=color:#f07171>pixel_size</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>ok</span><span>()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Error lost
</span><span>    </span><span style=color:#fa6e32>let</span><span> data </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Error lost
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>pixel_data_offset</span><span>(coords)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>start</span><span>| </span><span style=color:#ed9366>&</span><span>data[start</span><span style=color:#ed9366>..</span><span>(start </span><span style=color:#ed9366>+</span><span> len)])
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>pixel_bytes</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>coords</span><span style=color:#61676ccc>:</span><span> UVec3) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#ed9366>&</span><span>[</span><span style=color:#fa6e32>u8</span><span>], TextureAccessError> {
</span><span>    </span><span style=color:#fa6e32>let</span><span> len </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>texture_descriptor</span><span style=color:#ed9366>.</span><span>format</span><span style=color:#ed9366>.</span><span style=color:#f07171>pixel_size</span><span>()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Error preserved
</span><span>    </span><span style=color:#fa6e32>let</span><span> start </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>pixel_data_offset</span><span>(coords)</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Error preserved
</span><span>    </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(data) </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>() </span><span style=color:#fa6e32>else </span><span>{
</span><span>        </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(TextureAccessError</span><span style=color:#ed9366>::</span><span>Uninitialized)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Explicit error
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(</span><span style=color:#ed9366>&</span><span>data[start</span><span style=color:#ed9366>..</span><span>(start </span><span style=color:#ed9366>+</span><span> len)])
</span><span>}
</span></code></pre><ol start=3><li><strong>New error variant for uninitialized data</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>TextureAccessError </span><span>{
</span><span>    OutOfBounds { x</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span style=color:#61676ccc>,</span><span> y</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span style=color:#61676ccc>,</span><span> z</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32 </span><span>}</span><span style=color:#61676ccc>,
</span><span>    UnsupportedTextureFormat(TextureFormat)</span><span style=color:#61676ccc>,
</span><span>    Uninitialized</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// New variant
</span><span>    WrongDimension</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><ol start=4><li><strong>Regression test for compressed texture error reporting</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>compressed_texture_format_is_reported_correctly</span><span>() {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> image </span><span style=color:#ed9366>= </span><span>Image</span><span style=color:#ed9366>::</span><span>new_uninit(
</span><span>        Extent3d { width</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>4</span><span style=color:#61676ccc>,</span><span> height</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>4</span><span style=color:#61676ccc>,</span><span> depth_or_array_layers</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>1 </span><span>}</span><span style=color:#61676ccc>,
</span><span>        TextureDimension</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>D2</span><span style=color:#61676ccc>,
</span><span>        TextureFormat</span><span style=color:#ed9366>::</span><span>Bc1RgbaUnorm</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Compressed format
</span><span>        RenderAssetUsages</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MAIN_WORLD</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Verify both read and write operations fail with correct error
</span><span>    </span><span style=color:#f07171>assert!</span><span>(</span><span style=color:#f07171>matches!</span><span>(
</span><span>        image</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_color_at</span><span>(</span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(TextureAccessError</span><span style=color:#ed9366>::</span><span>UnsupportedTextureFormat(
</span><span>            TextureFormat</span><span style=color:#ed9366>::</span><span>Bc1RgbaUnorm
</span><span>        ))
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=release-content-migration-guides-image-pixel-bytes-result-md-48-0><code>release-content/migration-guides/image_pixel_bytes_result.md</code> (+48/-0)</h3><p>This new file provides a migration guide for users updating their code to handle the new <code>Result</code> return types:<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#abb0b6;background-color:#61676c10;font-weight:700>---
</span><span>title: "</span><span style=color:#ed9366;background-color:#61676c10>`Image::pixel_bytes`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`Image::pixel_data_offset`</span><span> now return </span><span style=color:#ed9366;background-color:#61676c10>`Result`</span><span>"
</span><span>pull_requests: [22908]
</span><span style=color:#fa6e32;font-weight:700>---
</span><span>
</span><span style=color:#ed9366;background-color:#61676c10>`Image::pixel_bytes`</span><span>, </span><span style=color:#ed9366;background-color:#61676c10>`Image::pixel_bytes_mut`</span><span>, and
</span><span style=color:#ed9366;background-color:#61676c10>`Image::pixel_data_offset`</span><span> now return </span><span style=color:#ed9366;background-color:#61676c10>`Result<..., TextureAccessError>`</span><span>.
</span><span>
</span><span>Previously, these methods returned </span><span style=color:#ed9366;background-color:#61676c10>`Option`</span><span> and would silently fail for
</span><span>both out-of-bounds access and unsupported texture formats (such as
</span><span>compressed textures). This caused error information to be lost, making it
</span><span>impossible for callers to distinguish between these different failure
</span><span>cases.
</span><span>
</span><span>Now, these methods properly propagate </span><span style=color:#ed9366;background-color:#61676c10>`TextureAccessError`</span><span>:
</span><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`TextureAccessError::OutOfBounds`</span><span> for coordinates outside the image bounds
</span><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`TextureAccessError::UnsupportedTextureFormat`</span><span> for compressed or unsupported texture formats
</span><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`TextureAccessError::Uninitialized`</span><span> if the image data is not initialized
</span><span>
</span><span style=color:#fa6e32;font-weight:700>## </span><span style=color:#399ee6;font-weight:700>Migration
</span><span>
</span><span>Update any code using these methods to handle the </span><span style=color:#ed9366;background-color:#61676c10>`Result`</span><span> return type:
</span><span>```</span><span style=color:#ff8f40>rust
</span><span style=color:#abb0b6;background-color:#61676c07;font-style:italic>// Before
</span><span style=color:#fa6e32;background-color:#61676c07>if let </span><span style=color:#55b4d4;background-color:#61676c07;font-style:italic>Some</span><span style=color:#61676c;background-color:#61676c07>(bytes) </span><span style=color:#ed9366;background-color:#61676c07>=</span><span style=color:#61676c;background-color:#61676c07> image</span><span style=color:#ed9366;background-color:#61676c07>.</span><span style=color:#f07171;background-color:#61676c07>pixel_bytes</span><span style=color:#61676c;background-color:#61676c07>(coords) {
</span><span style=color:#61676c;background-color:#61676c07>    </span><span style=color:#abb0b6;background-color:#61676c07;font-style:italic>// use bytes
</span><span style=color:#61676c;background-color:#61676c07>}
</span><span style=color:#61676c;background-color:#61676c07>
</span><span style=color:#abb0b6;background-color:#61676c07;font-style:italic>// After
</span><span style=color:#fa6e32;background-color:#61676c07>match</span><span style=color:#61676c;background-color:#61676c07> image</span><span style=color:#ed9366;background-color:#61676c07>.</span><span style=color:#f07171;background-color:#61676c07>pixel_bytes</span><span style=color:#61676c;background-color:#61676c07>(coords) {
</span><span style=color:#61676c;background-color:#61676c07>    </span><span style=color:#55b4d4;background-color:#61676c07;font-style:italic>Ok</span><span style=color:#61676c;background-color:#61676c07>(bytes) </span><span style=color:#ed9366;background-color:#61676c07>=> </span><span style=color:#61676c;background-color:#61676c07>{
</span><span style=color:#61676c;background-color:#61676c07>        </span><span style=color:#abb0b6;background-color:#61676c07;font-style:italic>// use bytes
</span><span style=color:#61676c;background-color:#61676c07>    }
</span><span style=color:#61676c;background-color:#61676c07>    </span><span style=color:#55b4d4;background-color:#61676c07;font-style:italic>Err</span><span style=color:#61676c;background-color:#61676c07>(TextureAccessError</span><span style=color:#ed9366;background-color:#61676c07>::</span><span style=color:#61676c;background-color:#61676c07>Uninitialized) </span><span style=color:#ed9366;background-color:#61676c07>=> </span><span style=color:#61676c;background-color:#61676c07>{
</span><span style=color:#61676c;background-color:#61676c07>        </span><span style=color:#abb0b6;background-color:#61676c07;font-style:italic>// handle missing image data
</span><span style=color:#61676c;background-color:#61676c07>    }
</span><span style=color:#61676c;background-color:#61676c07>    </span><span style=color:#55b4d4;background-color:#61676c07;font-style:italic>Err</span><span style=color:#61676c;background-color:#61676c07>(TextureAccessError</span><span style=color:#ed9366;background-color:#61676c07>::</span><span style=color:#61676c;background-color:#61676c07>OutOfBounds { </span><span style=color:#ed9366;background-color:#61676c07>.. </span><span style=color:#61676c;background-color:#61676c07>}) </span><span style=color:#ed9366;background-color:#61676c07>=> </span><span style=color:#61676c;background-color:#61676c07>{
</span><span style=color:#61676c;background-color:#61676c07>        </span><span style=color:#abb0b6;background-color:#61676c07;font-style:italic>// handle out of bounds
</span><span style=color:#61676c;background-color:#61676c07>    }
</span><span style=color:#61676c;background-color:#61676c07>    </span><span style=color:#55b4d4;background-color:#61676c07;font-style:italic>Err</span><span style=color:#61676c;background-color:#61676c07>(TextureAccessError</span><span style=color:#ed9366;background-color:#61676c07>::</span><span style=color:#61676c;background-color:#61676c07>UnsupportedTextureFormat(format)) </span><span style=color:#ed9366;background-color:#61676c07>=> </span><span style=color:#61676c;background-color:#61676c07>{
</span><span style=color:#61676c;background-color:#61676c07>        </span><span style=color:#abb0b6;background-color:#61676c07;font-style:italic>// handle compressed/unsupported format
</span><span style=color:#61676c;background-color:#61676c07>    }
</span><span style=color:#61676c;background-color:#61676c07>}
</span></code></pre><pre style=color:#61676c;background-color:#fafafa><code><span>
</span><span>## Further Reading
</span><span>
</span><span>- [Rust Error Handling](https://doc.rust-lang.org/book/ch09-00-error-handling.html) - Official Rust documentation on `Result` and error handling patterns
</span><span>- [Bevy Texture Formats](https://docs.rs/bevy_render/latest/bevy_render/texture/enum.TextureFormat.html) - Documentation on Bevy's texture format support
</span><span>- [Texture Compression](https://www.khronos.org/opengl/wiki/Texture_Compression) - Background on texture compression formats and their limitations
</span><span>- [PR #22414](https://github.com/bevyengine/bevy/pull/22414) - The original PR that attempted to add warnings for compressed textures
</span><span>- [Error Propagation in Rust](https://doc.rust-lang.org/rust-by-example/error/result/result_map.html) - Techniques for proper error propagation in Rust</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22908.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>