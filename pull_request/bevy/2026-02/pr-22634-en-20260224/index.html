<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22634 Overrides for no-path in autonavigation for `bevy_input_focus`
        
    </title><meta content="#22634 Overrides for no-path in autonavigation for `bevy_input_focus`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22634-zh-cn-20260224>中文</a></div></div><div class=pr-content><h1 id=title-overrides-for-no-path-in-autonavigation-for-bevy-input-focus>Title: Overrides for no-path in autonavigation for <code>bevy_input_focus</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Overrides for no-path in autonavigation for <code>bevy_input_focus</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22634<li><strong>Author</strong>: kumaryash6352<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-UI, S-Ready-For-Final-Review, D-Modest<li><strong>Created</strong>: 2026-01-21T20:43:59Z<li><strong>Merged</strong>: 2026-02-24T03:08:28Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #22378.</ul><h2 id=solution>Solution</h2><p>Turn <code>NavNeighbors</code> from storing an array of <code>Option&LTEntity></code> to an array of <code>NavNeighbor</code>, an enum with 3 values: <code>Unset</code> (no explicitly set thing in this direction), <code>Blocked</code> (assume there is nothing in this direction to path to), and <code>Neighbor(Entity)</code>.<h2 id=testing>Testing</h2><p>Changes tested using a new test, <code>test_respects_set_blocks</code>, and manually using the <code>directional_navigation_override</code> example. Each button on second page is restricted to left/right movement, as up/down are blocked.<h2 id=showcase>Showcase</h2><p>I’m not quite sure how to showcase this, as it’s a very input-oriented feature and the feature working means that nothing happens.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a specific limitation in Bevy’s directional navigation system. Previously, when working with the <code>bevy_input_focus</code> crate, developers could either explicitly set navigation neighbors or rely on automatic navigation calculation. However, there was no way to explicitly block navigation in a particular direction - you could only leave it unset, which would then allow automatic navigation to fill in the gap.<p>The problem was raised in issue #22378, where users needed finer control over navigation flow, particularly in UI scenarios where certain directional movements should be prohibited. For example, in a grid layout, you might want to restrict vertical navigation within a row but still allow horizontal movement between rows through edge navigation.<p>The solution involves changing the core data structure from a simple <code>Option&LTEntity></code> to a more expressive enum called <code>NavNeighbor</code>. This enum has three variants: <code>Auto</code> (default, no explicit setting), <code>Blocked</code> (explicitly prevent navigation), and <code>Set(Entity)</code> (explicit neighbor). This change preserves backward compatibility while adding the new blocking capability.<p>The implementation starts in <code>directional_navigation.rs</code> with the new enum definition:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>NavNeighbor </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>default</span><span>]
</span><span>    Auto</span><span style=color:#61676ccc>,
</span><span>    Blocked</span><span style=color:#61676ccc>,
</span><span>    Set(Entity)</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>The <code>NavNeighbors</code> struct is updated to store an array of <code>[NavNeighbor; 8]</code> instead of <code>[Option&LTEntity>; 8]</code>. New methods are added: <code>block()</code> for explicitly blocking a direction, and helper methods like <code>get()</code> to extract the entity from a <code>Set</code> variant. The existing <code>set()</code> method now creates a <code>Set(Entity)</code> variant instead of <code>Some(entity)</code>.<p>The <code>DirectionalNavigationMap</code> gains new methods <code>block_edge()</code> and <code>block_symmetrical_edge()</code> to programmatically block navigation edges. When the navigation system attempts to navigate in a blocked direction, it now returns a new error variant <code>DirectionalNavigationError::BlockedNavigation</code> instead of trying to auto-calculate a neighbor.<p>A key design consideration was ensuring that automatic navigation generation respects these blocks. The <code>auto_generate_navigation_edges()</code> function now checks for both <code>Blocked</code> and <code>Set</code> variants when determining if a direction should be skipped:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if</span><span> nav_map
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>get_neighbors</span><span>(origin</span><span style=color:#ed9366>.</span><span>entity)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>filter</span><span>(|</span><span style=color:#ff8f40>neighbors</span><span>| {
</span><span>        </span><span style=color:#f07171>matches!</span><span>(
</span><span>            neighbors</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(octant)</span><span style=color:#61676ccc>,
</span><span>            NavNeighbor</span><span style=color:#ed9366>::</span><span>Blocked </span><span style=color:#ed9366>| </span><span>NavNeighbor</span><span style=color:#ed9366>::</span><span>Set(</span><span style=color:#ed9366>_</span><span>)
</span><span>        )
</span><span>    })
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>is_some</span><span>()
</span><span>{
</span><span>    </span><span style=color:#fa6e32>continue</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Respect manual override
</span><span>}
</span></code></pre><p>The UI integration in <code>auto_directional_navigation.rs</code> needed adjustments to handle the new error types properly. The <code>AutoDirectionalNavigator</code> now distinguishes between “no neighbor” errors (which trigger auto-calculation) and “blocked” errors (which don’t attempt auto-calculation).<p>To demonstrate the feature, the example <code>directional_navigation_overrides.rs</code> is updated with a practical use case. In the first page of buttons, vertical navigation (North/South) is explicitly blocked for each button, while horizontal navigation remains enabled. This creates a UI where you can move left/right within a row but cannot move up/down directly - you must navigate off the edge of the row instead.<p>This change provides UI designers with more precise control over navigation flow while maintaining the automatic navigation system’s convenience for unconfigured directions. The implementation is minimal and focused, adding only the necessary functionality without overcomplicating the API.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Navigation State] --> B[Auto: Calculate automatically]
</span><span>    A --> C[Blocked: Explicitly blocked]
</span><span>    A --> D[Set: Explicitly set entity]
</span><span>    
</span><span>    E[Previous System] --> F[Option&LTEntity>: Some/None]
</span><span>    F --> G[Could not express "blocked"]
</span><span>    
</span><span>    H[New System] --> I[NavNeighbor enum]
</span><span>    I --> J[Three distinct states]
</span><span>    
</span><span>    K[Navigation Flow] --> L{Check direction}
</span><span>    L --> M[Blocked?]
</span><span>    M -->|Yes| N[Return BlockedNavigation error]
</span><span>    M -->|No| O[Set?]
</span><span>    O -->|Yes| P[Navigate to entity]
</span><span>    O -->|No| Q[Auto-calculate]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-input-focus-src-directional-navigation-rs-236-57><code>crates/bevy_input_focus/src/directional_navigation.rs</code> (+236/-57)</h3><p>This file contains the core implementation changes. The main modifications are:<ol><li><strong>New <code>NavNeighbor</code> enum</strong> - replaces <code>Option&LTEntity></code> with three explicit states<li><strong>Updated <code>NavNeighbors</code> struct</strong> - now stores <code>[NavNeighbor; 8]</code> with new methods<li><strong>New blocking methods</strong> - <code>block_edge()</code> and <code>block_symmetrical_edge()</code> for <code>DirectionalNavigationMap</code><li><strong>Error handling</strong> - new <code>BlockedNavigation</code> error variant<li><strong>Test updates</strong> - existing tests updated and new test <code>test_respects_set_blocks</code> added</ol><p>Key code change showing the enum definition:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: neighbors: [Option&LTEntity>; 8]
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>NavNeighbor </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>default</span><span>]
</span><span>    Auto</span><span style=color:#61676ccc>,
</span><span>    Blocked</span><span style=color:#61676ccc>,
</span><span>    Set(Entity)</span><span style=color:#61676ccc>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>NavNeighbors </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>neighbors</span><span style=color:#61676ccc>:</span><span> [NavNeighbor; 8],
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-src-auto-directional-navigation-rs-25-19><code>crates/bevy_ui/src/auto_directional_navigation.rs</code> (+25/-19)</h3><p>This file updates the UI navigation system to handle the new error types properly. The key change is in the <code>navigate</code> method:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Simple check for manual navigation success
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(new_focus) </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>manual_directional_navigation</span><span style=color:#ed9366>.</span><span style=color:#f07171>navigate</span><span>(direction) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Set focus
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Try auto-calculation
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Pattern matching on error types
</span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>manual_directional_navigation</span><span style=color:#ed9366>.</span><span style=color:#f07171>navigate</span><span>(direction) {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(new_focus) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Set focus
</span><span>    }
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(DirectionalNavigationError</span><span style=color:#ed9366>::</span><span>NoNeighborInDirection { </span><span style=color:#ed9366>.. </span><span>}) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Try auto-calculation (only for "no neighbor", not "blocked")
</span><span>    }
</span><span>    err </span><span style=color:#ed9366>=></span><span> err</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// Propagate other errors including BlockedNavigation
</span><span>}
</span></code></pre><h3 id=examples-ui-navigation-directional-navigation-overrides-rs-35-24><code>examples/ui/navigation/directional_navigation_overrides.rs</code> (+35/-24)</h3><p>This example is updated to demonstrate the blocking functionality. The key addition blocks vertical navigation on the first page:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Add one-way blocking within the first grid page (Page 1) for down nav.
</span><span style=color:#fa6e32>for</span><span> btn </span><span style=color:#ed9366>in &</span><span>pages_entities[</span><span style=color:#ff8f40>0</span><span>] {
</span><span>    manual_directional_nav_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>block_edge</span><span>(</span><span style=color:#ed9366>*</span><span>btn</span><span style=color:#61676ccc>, </span><span>CompassOctant</span><span style=color:#ed9366>::</span><span>South)</span><span style=color:#61676ccc>;
</span><span>    manual_directional_nav_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>block_edge</span><span>(</span><span style=color:#ed9366>*</span><span>btn</span><span style=color:#61676ccc>, </span><span>CompassOctant</span><span style=color:#ed9366>::</span><span>North)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The example also updates the text display to explain the different navigation behaviors on each page, including the new blocking feature on page 1.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ui/latest/bevy_ui/focus/index.html target=_blank>Bevy UI Navigation System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch06-00-enums.html target=_blank>Enum Pattern in Rust</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ecs/ target=_blank>Entity Component System Architecture</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22634.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>