<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23147 Fix wireframe and examples with mesh pipeline set
        
    </title><meta content="#23147 Fix wireframe and examples with mesh pipeline set" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-25</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-23147-zh-cn-20260225>中文</a></div></div><div class=pr-content><h1 id=title-fix-wireframe-and-examples-with-mesh-pipeline-set>Title: Fix wireframe and examples with mesh pipeline set</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix wireframe and examples with mesh pipeline set<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/23147<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Rendering, S-Ready-For-Final-Review, P-Regression<li><strong>Created</strong>: 2026-02-25T11:17:43Z<li><strong>Merged</strong>: 2026-02-25T19:39:09Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>#22443 broke wireframe and some examples</ul><h2 id=solution>Solution</h2><ul><li>Fix them by having the systems run after <code>MeshPipelineSet</code><li>Also add a migration guide</ul><h2 id=testing>Testing</h2><ul><li>run the examples modified or anything using wireframe</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a regression introduced by PR #22443, which broke wireframe rendering and several advanced shader examples. The root cause was a scheduling issue where systems that depend on certain mesh pipeline resources were running before those resources had been initialized.<p>PR #22443 introduced the <code>MeshPipelineSet</code> system set and moved the creation of several critical rendering resources (<code>MeshPipelineViewLayouts</code>, <code>MeshPipeline</code>, and <code>RenderDebugOverlayPipeline</code>) into systems that run within this set during the <code>RenderStartup</code> schedule. This change was part of a broader refactoring to improve the organization and initialization order of rendering systems.<p>The problem occurred because several systems that depend on these mesh pipeline resources were still scheduled to run in <code>RenderStartup</code> without explicit ordering constraints. These systems would execute before the <code>MeshPipelineSet</code> systems, leading to panics when they tried to access uninitialized resources.<p>The solution was straightforward: add explicit ordering constraints using <code>.after(MeshPipelineSet)</code> to ensure these dependent systems run only after the mesh pipeline resources have been created. This approach maintains the architectural improvements from PR #22443 while fixing the initialization order issue.<p>The fix was applied to four key areas:<ol><li>The wireframe rendering system in <code>bevy_pbr</code><li>Three advanced shader examples that implement custom rendering pipelines</ol><p>Additionally, a migration guide was created to document this change for users who have custom rendering systems that might be affected by the same issue. The guide explains that any systems using <code>MeshPipelineViewLayouts</code>, <code>MeshPipeline</code>, or <code>RenderDebugOverlayPipeline</code> resources in the <code>RenderStartup</code> schedule now need to run after the <code>MeshPipelineSet</code> system set.<p>This fix demonstrates the importance of proper system ordering in Bevy’s ECS architecture, especially for resource initialization. When resources are created by systems, any systems that depend on them must be explicitly ordered to run afterward. The regression occurred because the dependency wasn’t made explicit when the resource creation was moved to a different system set.<p>The implementation approach is minimal and focused: only the scheduling constraints were modified, not the actual system logic. This minimizes the risk of introducing new bugs while ensuring the systems work correctly with the new resource initialization order.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[RenderStartup Schedule] --> B[MeshPipelineSet]
</span><span>    B --> C[init_mesh_pipeline_resources]
</span><span>    C --> D[MeshPipeline resource]
</span><span>    C --> E[MeshPipelineViewLayouts resource]
</span><span>    C --> F[RenderDebugOverlayPipeline resource]
</span><span>    D --> G[init_wireframe_3d_pipeline]
</span><span>    E --> G
</span><span>    F --> G
</span><span>    D --> H[init_stencil_pipeline]
</span><span>    E --> H
</span><span>    F --> H
</span><span>    D --> I[init_custom_pipeline]
</span><span>    E --> I
</span><span>    F --> I
</span><span>    D --> J[init_custom_mesh_pipeline]
</span><span>    E --> J
</span><span>    F --> J
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-pbr-src-wireframe-rs-7-4><code>crates/bevy_pbr/src/wireframe.rs</code> (+7/-4)</h3><p>This file contains the wireframe rendering plugin. The change ensures the wireframe pipeline initialization system runs after the mesh pipeline resources are created.<p><strong>Key change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_wireframe_3d_pipeline)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>    RenderStartup</span><span style=color:#61676ccc>,
</span><span>    init_wireframe_3d_pipeline</span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(MeshPipelineSet)</span><span style=color:#61676ccc>,
</span><span>)
</span></code></pre><h3 id=examples-shader-advanced-specialized-mesh-pipeline-rs-7-3><code>examples/shader_advanced/specialized_mesh_pipeline.rs</code> (+7/-3)</h3><p>This example demonstrates a specialized mesh pipeline. The fix ensures the custom pipeline initialization runs after mesh pipeline resources are available.<p><strong>Key change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_custom_mesh_pipeline)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>    RenderStartup</span><span style=color:#61676ccc>,
</span><span>    init_custom_mesh_pipeline</span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(MeshPipelineSet)</span><span style=color:#61676ccc>,
</span><span>)
</span></code></pre><h3 id=release-content-migration-guides-meshpipelineset-renderstartup-systems-md-6-0><code>release-content/migration-guides/meshpipelineset-renderstartup-systems.md</code> (+6/-0)</h3><p>A new migration guide was added to document the change and help users update their own code.<p><strong>Content:</strong><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#abb0b6;background-color:#61676c10;font-weight:700>---
</span><span>title: Resources </span><span style=color:#ed9366;background-color:#61676c10>`MeshPipelineViewLayouts`</span><span>, </span><span style=color:#ed9366;background-color:#61676c10>`MeshPipeline`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`RenderDebugOverlayPipeline`</span><span> are now created in </span><span style=color:#ed9366;background-color:#61676c10>`RenderStartup`</span><span> systems
</span><span>pull_requests: [22443]
</span><span style=color:#fa6e32;font-weight:700>---
</span><span>
</span><span>Systems using the </span><span style=color:#ed9366;background-color:#61676c10>`MeshPipelineViewLayouts`</span><span>, </span><span style=color:#ed9366;background-color:#61676c10>`MeshPipeline`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`RenderDebugOverlayPipeline`</span><span> resources in the </span><span style=color:#ed9366;background-color:#61676c10>`RenderStartup`</span><span> schedule now need to be run after the </span><span style=color:#ed9366;background-color:#61676c10>`MeshPipelineSet`</span><span> system set.
</span></code></pre><h3 id=examples-shader-advanced-custom-render-phase-rs-2-2><code>examples/shader_advanced/custom_render_phase.rs</code> (+2/-2)</h3><p>This example shows how to create a custom render phase. The fix ensures proper initialization ordering.<p><strong>Key change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_stencil_pipeline)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_stencil_pipeline</span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(MeshPipelineSet))
</span></code></pre><h3 id=examples-shader-advanced-custom-shader-instancing-rs-2-2><code>examples/shader_advanced/custom_shader_instancing.rs</code> (+2/-2)</h3><p>This example demonstrates custom shader instancing. The fix ensures the custom pipeline initializes after mesh pipeline resources.<p><strong>Key change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_custom_pipeline)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_custom_pipeline</span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(MeshPipelineSet))
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy ECS System Ordering</strong>: Understanding system scheduling and ordering is crucial for working with Bevy’s ECS. The official Bevy Book covers this in detail.<li><strong>Render Pipeline Architecture</strong>: The Bevy rendering architecture documentation explains how render pipelines are structured and initialized.<li><strong>Migration Guides</strong>: The Bevy migration guides provide valuable context for breaking changes and how to adapt code.<li><strong>System Sets in Bevy</strong>: System sets provide a way to organize and order groups of systems, which is essential for complex initialization sequences.<li><strong>PR #22443</strong>: Reviewing the original PR that introduced the <code>MeshPipelineSet</code> provides context for why these changes were necessary.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23147.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>