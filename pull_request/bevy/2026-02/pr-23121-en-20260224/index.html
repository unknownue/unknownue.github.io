<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23121 Update atmosphere example fix reflection
        
    </title><meta content="#23121 Update atmosphere example fix reflection" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-23121-zh-cn-20260224>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Update atmosphere example fix reflection<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update atmosphere example fix reflection<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/23121<li><strong>Author</strong>: mate-h<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, C-Examples, S-Ready-For-Final-Review, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2026-02-23T18:42:30Z<li><strong>Merged</strong>: 2026-02-24T03:08:28Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>The atmosphere example had no reflections since PR #22379 , I wanted to fix this<li>Got feedback from pcwalton@ that the spheres need to be removed. These are no longer needed to test generated environment map lighting since that also shows up in the water.<li>Placed the camera lower such that the volumetric lighting renders correctly and you can see more of the reflection.</ul><h2 id=solution>Solution</h2><ul><li>Updated atmosphere example.</ul><h2 id=testing>Testing</h2><ul><li>Ran atmosphere example with the proper feature flags (bluenoise_texture)</ul><hr><h2 id=showcase>Showcase</h2><p>Before: no reflection, spheres, no “orange glow” in the volumetric fog towards the top face of the fog volume cuboid. This is likely a bug in the fog volume rendering depending on the camera angle. <img alt="Screenshot 2026-02-23 at 10 29 34 AM" height=721 src=https://github.com/user-attachments/assets/4322e38a-7957-48ad-84fd-852ba8c712a8 width=1280><p>After <img alt="Screenshot 2026-02-23 at 10 29 58 AM" height=723 src=https://github.com/user-attachments/assets/f6777459-b555-4714-a1d0-2df4297fb8f1 width=1281><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a regression in the atmosphere example that occurred after PR #22379. The main issue was that screen-space reflections were no longer visible, making the example less effective at demonstrating the rendering system’s capabilities.<p>The developer identified that the default <code>ScreenSpaceReflections</code> configuration was preventing reflections from appearing. Specifically, the <code>min_perceptual_roughness</code> setting was filtering out reflections on surfaces with low roughness values. The water material in this example has a very low roughness to create realistic water reflections, but the default minimum perceptual roughness of 0.089 prevented these reflections from rendering.<p>The solution involved two key changes. First, the developer modified the <code>ScreenSpaceReflections</code> component to set <code>min_perceptual_roughness: 0.0..0.0</code>, ensuring that even perfectly smooth surfaces would show reflections. This restored the visual feedback that demonstrates how environment map lighting interacts with reflective surfaces.<p>Second, the developer removed two demonstration spheres that were previously used to test generated environment map lighting. After receiving feedback that these spheres were redundant (since the water surface already demonstrates environment map lighting), they were removed to simplify the example. This cleanup also involved removing the <code>CascadeShadowConfigBuilder</code> import and related configuration since cascade shadow maps weren’t critical for demonstrating the atmosphere system.<p>The camera positioning was also adjusted from <code>(-2.4, 0.04, 0.0)</code> to <code>(-2.8, 0.045, 0.0)</code> and changed to look at <code>Vec3::ZERO</code> instead of <code>Vec3::Y * 0.1</code>. This positioning change addresses two issues: it improves the volumetric fog rendering (fixing a bug where the orange glow was missing from certain camera angles) and provides a better view of the water reflections.<p>The changes demonstrate practical understanding of Bevy’s rendering system, specifically how screen-space reflections interact with material properties. The fix is minimal and targeted, addressing the specific regression without introducing unnecessary complexity. By removing the redundant spheres, the example becomes more focused on demonstrating the atmosphere and volumetric lighting systems rather than serving multiple demonstration purposes.<h2 id=technical-insights>Technical Insights</h2><p>The key technical insight here relates to how Bevy’s screen-space reflections system works with material roughness. Screen-space reflections use a roughness threshold to determine which surfaces should receive reflections - this optimization prevents computing reflections for surfaces that are too rough to show clear reflections. However, when this threshold is set too high (like the default 0.089), it can filter out legitimate reflections on smooth surfaces.<p>The water material in this example uses an extension material with a low perceptual roughness, which was being filtered out by the default SSR settings. By explicitly setting <code>min_perceptual_roughness: 0.0..0.0</code>, the developer ensures that all surfaces, regardless of roughness, are considered for screen-space reflections.<p>This change also highlights an important consideration for example code: examples should demonstrate features effectively, even if that means using non-default configurations. The default SSR settings might be appropriate for most games, but for a technical demonstration of atmospheric rendering with reflective water, the stricter reflection criteria are necessary.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Atmosphere Example] --> B[Camera System]
</span><span>    A --> C[Lighting System]
</span><span>    A --> D[Rendering System]
</span><span>    
</span><span>    B --> E[Camera Position Fix]
</span><span>    B --> F[Look-at Target Adjustment]
</span><span>    
</span><span>    C --> G[Directional Light]
</span><span>    C --> H[Volumetric Fog]
</span><span>    
</span><span>    D --> I[Screen Space Reflections]
</span><span>    D --> J[Water Material]
</span><span>    
</span><span>    E --> K[Better Fog Rendering]
</span><span>    F --> L[Better Reflection View]
</span><span>    
</span><span>    I --> M[Min Roughness Threshold]
</span><span>    J --> N[Low Roughness Water]
</span><span>    
</span><span>    M --> O[Reflections Restored]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ul><li><code>examples/3d/atmosphere.rs</code> (+6/-38)</ul><h3 id=changes-overview>Changes Overview</h3><p>The PR makes several targeted changes to restore functionality and improve the example’s focus:<ol><li><p><strong>Camera positioning and SSR configuration</strong>: The camera was repositioned to fix volumetric fog rendering and improve the reflection view. The SSR component was configured to allow reflections on smooth surfaces.</p><li><p><strong>Removal of redundant demonstration elements</strong>: The light probe spheres and cascade shadow configuration were removed since they were no longer needed to demonstrate the core atmospheric rendering features.</p></ol><h3 id=key-code-changes>Key Code Changes</h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: examples/3d/atmosphere.rs
</span><span style=color:#abb0b6;font-style:italic>// Before camera setup:
</span><span>Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>2.4</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.04</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>looking_at</span><span>(Vec3</span><span style=color:#ed9366>::</span><span>Y </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>0.1</span><span style=color:#61676ccc>, </span><span>Vec3</span><span style=color:#ed9366>::</span><span>Y)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After camera setup:
</span><span>Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>2.8</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.045</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>looking_at</span><span>(Vec3</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#61676ccc>, </span><span>Vec3</span><span style=color:#ed9366>::</span><span>Y)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Before SSR configuration:
</span><span>ScreenSpaceReflections</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After SSR configuration:
</span><span>ScreenSpaceReflections {
</span><span>    min_perceptual_roughness</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>}</span><span style=color:#61676ccc>,
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Removed code (spheres and cascade shadow config):
</span><span style=color:#abb0b6;font-style:italic>// The entire section creating two demonstration spheres was removed:
</span><span style=color:#fa6e32>let</span><span> sphere_mesh </span><span style=color:#ed9366>=</span><span> meshes</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(Mesh</span><span style=color:#ed9366>::</span><span>from(Sphere { radius</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>1.0 </span><span>}))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// light probe spheres
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Mesh3d(sphere_mesh</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... material and transform setup
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Also removed from directional light:
</span><span>cascade_shadow_config</span><span style=color:#61676ccc>,
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li>Bevy Screen Space Reflections Documentation: https://docs.rs/bevy/latest/bevy/core_pipeline/prepass/struct.ScreenSpaceReflections.html<li>Bevy Atmosphere System: https://docs.rs/bevy/latest/bevy/pbr/struct.Atmosphere.html<li>PR #22379 (the change that introduced the regression): Link to the PR that affected reflections<li>Bevy Material System: https://docs.rs/bevy/latest/bevy/pbr/struct.StandardMaterial.html<li>Volumetric Lighting in Bevy: https://docs.rs/bevy/latest/bevy/pbr/struct.VolumetricFog.html</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/examples/3d/atmosphere.rs b/examples/3d/atmosphere.rs
</span><span>index c392b983aa5e4..6cf920aa3907b 100644
</span><span>--- a/examples/3d/atmosphere.rs
</span><span>+++ b/examples/3d/atmosphere.rs
</span><span>@@ -15,7 +15,7 @@ use bevy::{
</span><span>     input::keyboard::KeyCode,
</span><span>     light::{
</span><span>         atmosphere::ScatteringMedium, light_consts::lux, Atmosphere, AtmosphereEnvironmentMapLight,
</span><span>-        CascadeShadowConfigBuilder, FogVolume, VolumetricFog, VolumetricLight,
</span><span>+        FogVolume, VolumetricFog, VolumetricLight,
</span><span>     },
</span><span>     pbr::{
</span><span>         AtmosphereMode, AtmosphereSettings, DefaultOpaqueRendererMethod, ExtendedMaterial,
</span><span>@@ -104,7 +104,7 @@ fn setup_camera_fog(
</span><span> ) {
</span><span>     commands.spawn((
</span><span>         Camera3d::default(),
</span><span>-        Transform::from_xyz(-2.4, 0.04, 0.0).looking_at(Vec3::Y * 0.1, Vec3::Y),
</span><span>+        Transform::from_xyz(-2.8, 0.045, 0.0).looking_at(Vec3::ZERO, Vec3::Y),
</span><span>         // Earthlike atmosphere
</span><span>         Atmosphere::earthlike(scattering_mediums.add(ScatteringMedium::default())),
</span><span>         // Can be adjusted to change the scene scale and rendering quality
</span><span>@@ -129,7 +129,10 @@ fn setup_camera_fog(
</span><span>         },
</span><span>         Msaa::Off,
</span><span>         TemporalAntiAliasing::default(),
</span><span>-        ScreenSpaceReflections::default(),
</span><span>+        ScreenSpaceReflections {
</span><span>+            min_perceptual_roughness: 0.0..0.0,
</span><span>+            ..default()
</span><span>+        },
</span><span>     ));
</span><span> }
</span><span> 
</span><span>@@ -172,18 +175,9 @@ impl MaterialExtension for Water {
</span><span> fn setup_terrain_scene(
</span><span>     mut commands: Commands,
</span><span>     mut meshes: ResMut&LTAssets&LTMesh>>,
</span><span>-    mut materials: ResMut&LTAssets&LTStandardMaterial>>,
</span><span>     mut water_materials: ResMut&LTAssets&LTExtendedMaterial&LTStandardMaterial, Water>>>,
</span><span>     asset_server: Res&LTAssetServer>,
</span><span> ) {
</span><span>-    // Configure a properly scaled cascade shadow map for this scene (defaults are too large, mesh units are in km)
</span><span>-    let cascade_shadow_config = CascadeShadowConfigBuilder {
</span><span>-        first_cascade_far_bound: 0.3,
</span><span>-        maximum_distance: 15.0,
</span><span>-        ..default()
</span><span>-    }
</span><span>-    .build();
</span><span>-
</span><span>     // Sun
</span><span>     commands.spawn((
</span><span>         DirectionalLight {
</span><span>@@ -198,7 +192,6 @@ fn setup_terrain_scene(
</span><span>         },
</span><span>         Transform::from_xyz(1.0, 0.4, 0.0).looking_at(Vec3::ZERO, Vec3::Y),
</span><span>         VolumetricLight,
</span><span>-        cascade_shadow_config,
</span><span>     ));
</span><span> 
</span><span>     // spawn the fog volume
</span><span>@@ -207,31 +200,6 @@ fn setup_terrain_scene(
</span><span>         Transform::from_scale(Vec3::new(10.0, 1.0, 10.0)).with_translation(Vec3::Y * 0.5),
</span><span>     ));
</span><span> 
</span><span>-    let sphere_mesh = meshes.add(Mesh::from(Sphere { radius: 1.0 }));
</span><span>-
</span><span>-    // light probe spheres
</span><span>-    commands.spawn((
</span><span>-        Mesh3d(sphere_mesh.clone()),
</span><span>-        MeshMaterial3d(materials.add(StandardMaterial {
</span><span>-            base_color: Color::WHITE,
</span><span>-            metallic: 1.0,
</span><span>-            perceptual_roughness: 0.0,
</span><span>-            ..default()
</span><span>-        })),
</span><span>-        Transform::from_xyz(-1.0, 0.1, -0.1).with_scale(Vec3::splat(0.05)),
</span><span>-    ));
</span><span>-
</span><span>-    commands.spawn((
</span><span>-        Mesh3d(sphere_mesh.clone()),
</span><span>-        MeshMaterial3d(materials.add(StandardMaterial {
</span><span>-            base_color: Color::WHITE,
</span><span>-            metallic: 0.0,
</span><span>-            perceptual_roughness: 1.0,
</span><span>-            ..default()
</span><span>-        })),
</span><span>-        Transform::from_xyz(-1.0, 0.1, 0.1).with_scale(Vec3::splat(0.05)),
</span><span>-    ));
</span><span>-
</span><span>     // Terrain
</span><span>     commands.spawn((
</span><span>         Terrain,
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23121.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>