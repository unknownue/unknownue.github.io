<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22872 Release-0.18.1: Ensure other half `Gizmos` Observer Fix lands correctly in release branch
        
    </title><meta content="#22872 Release-0.18.1: Ensure other half `Gizmos` Observer Fix lands correctly in release branch" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22872-zh-cn-20260209>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Release-0.18.1: Ensure other half <code>Gizmos</code> Observer Fix lands correctly in release branch<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22872<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: S-Ready-For-Final-Review, A-Gizmos<li><strong>Created</strong>: 2026-02-09T03:00:40Z<li><strong>Merged</strong>: 2026-02-09T22:35:05Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><blockquote><p>[!IMPORTANT] This will be merged into the <code>release-0.18.1</code> branch, <em>not</em> <code>main</code></blockquote><h1 id=objective>Objective</h1><ul><li>Ensure the missing part of #22800 (in the 0.18.1 milestone) that was merged as part of #22832 (in the 0.19.0 milestone) still lands in 0.18.1</ul><h2 id=solution>Solution</h2><ul><li>Ensure <code>queue()</code> is implemented in the <code>SystemBuffer</code> <code>GizmoBuffer</code>, and that <code>apply()</code> delegates to <code>queue()</code></ul><p>The other half of the solution, #22800, is in the 0.18.1 milestone and will eventually get put into this branch whenever it is needed.<p>(The code in this PR used to be in #22800, but when #22832 was merged before it, the change became lost).<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a specific problem that emerged during the release management process. The issue originated from a fix for the Gizmos system that was split across two different PRs targeting different release milestones. The complete fix involved changes to how the <code>GizmoBuffer</code> system buffer interacts with the Entity Component System (ECS) observer system.<p>The core problem was that when two related PRs were merged in a non-sequential order, part of the fix for the 0.18.1 release was lost. PR #22800 contained the complete fix for the Gizmos observer system in the 0.18.1 milestone, but before it could be merged, PR #22832 was merged into the 0.19.0 milestone branch. PR #22832 included the same code changes but targeted the newer 0.19.0 version. When #22800 was eventually merged, the overlapping code from #22832 wasn’t included in the 0.18.1 branch because it had already been committed to the 0.19.0 branch.<p>The technical issue being fixed relates to how system buffers work with the ECS observer system. In Bevy’s ECS, system buffers are used to collect data during system execution that needs to be applied to the world. The observer system introduced a new pattern where buffers should implement both <code>apply()</code> and <code>queue()</code> methods. The <code>queue()</code> method is used when working with a <code>DeferredWorld</code>, which is a special world context used by observers to safely queue changes without immediately applying them.<p>The solution implemented in this PR is straightforward: ensure that the <code>GizmoBuffer</code> properly implements the <code>SystemBuffer</code> trait by providing a <code>queue()</code> method and having the existing <code>apply()</code> method delegate to it. This follows the pattern established in other system buffers in the codebase and ensures compatibility with the observer system.<p>The changes are minimal but important:<ol><li>Add the <code>DeferredWorld</code> import to the module<li>Modify the <code>apply()</code> method to call <code>queue()</code> with a converted world<li>Implement the <code>queue()</code> method with the same logic that was previously in <code>apply()</code></ol><p>This fix ensures that Gizmos work correctly with the observer system in the 0.18.1 release, maintaining backward compatibility while properly implementing the required system buffer interface.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[System Execution] --> B[GizmoBuffer]
</span><span>    B --> C{World Context}
</span><span>    C -->|apply()| D[Immediate World]
</span><span>    C -->|queue()| E[DeferredWorld]
</span><span>    E --> F[Queued Changes]
</span><span>    F --> G[Applied via Observer System]
</span><span>    
</span><span>    style B fill:#e1f5e1
</span><span>    style E fill:#e1f5e1
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-gizmos-src-gizmos-rs-6-2><code>crates/bevy_gizmos/src/gizmos.rs</code> (+6/-2)</h3><p>This file contains the implementation of the Gizmos system. The changes ensure that <code>GizmoBuffer</code> properly implements the <code>SystemBuffer</code> trait with both <code>apply()</code> and <code>queue()</code> methods.<p><strong>Key modifications:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before the change, the SystemBuffer implementation for GizmoBuffer had:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>apply</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>_system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>SystemMeta, </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> storage </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTGizmoStorage&LTConfig, Clear>>()</span><span style=color:#61676ccc>;
</span><span>    storage</span><span style=color:#ed9366>.</span><span>list_positions</span><span style=color:#ed9366>.</span><span style=color:#f07171>append</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>list_positions)</span><span style=color:#61676ccc>;
</span><span>    storage</span><span style=color:#ed9366>.</span><span>list_colors</span><span style=color:#ed9366>.</span><span style=color:#f07171>append</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>list_colors)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... rest of the method
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After the change:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>apply</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>SystemMeta, </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>queue</span><span>(system_meta</span><span style=color:#61676ccc>,</span><span> world</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>queue</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>_system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>SystemMeta, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>:</span><span> DeferredWorld) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> storage </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTGizmoStorage&LTConfig, Clear>>()</span><span style=color:#61676ccc>;
</span><span>    storage</span><span style=color:#ed9366>.</span><span>list_positions</span><span style=color:#ed9366>.</span><span style=color:#f07171>append</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>list_positions)</span><span style=color:#61676ccc>;
</span><span>    storage</span><span style=color:#ed9366>.</span><span>list_colors</span><span style=color:#ed9366>.</span><span style=color:#f07171>append</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>list_colors)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... same logic as the old apply() method
</span><span>}
</span></code></pre><p>The changes are:<ol><li>Added <code>DeferredWorld</code> to the imports from <code>bevy_ecs::world</code><li>Modified <code>apply()</code> to delegate to <code>queue()</code> by converting the <code>World</code> reference to a <code>DeferredWorld</code> using <code>world.into()</code><li>Implemented <code>queue()</code> with the same logic that was previously in <code>apply()</code></ol><p>These changes ensure that <code>GizmoBuffer</code> properly supports the observer system pattern where buffers can queue changes for deferred application.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy ECS System Buffers</strong>: The official Bevy documentation on system parameters and buffers provides context for how system buffers work in the ECS.<li><strong>Observer Pattern in ECS</strong>: Understanding the observer system in Bevy helps explain why the <code>queue()</code> method is necessary alongside <code>apply()</code>.<li><strong>Release Branch Management</strong>: This PR serves as a case study in managing fixes across multiple release branches and avoiding code loss during parallel development.<li><strong>PR #22800 and #22832</strong>: Reviewing the related PRs provides full context for the complete fix that was split across releases.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22872.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>