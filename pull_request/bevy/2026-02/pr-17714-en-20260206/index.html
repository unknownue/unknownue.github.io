<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #17714 deprecated generate_view_layouts in favor of layout_entries (#17537)
        
    </title><meta content="#17714 deprecated generate_view_layouts in favor of layout_entries (#17537)" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-06</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-17714-zh-cn-20260206>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: deprecated generate_view_layouts in favor of layout_entries (#17537)<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/17714<li><strong>Author</strong>: Utope<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-02-07T00:18:05Z<li><strong>Merged</strong>: 2026-02-06T20:39:02Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><p>Deprecated <code>generate_view_layouts</code> in favor of <code>layout_entries</code> as described in #17537.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR implements a straightforward API evolution in Bevy’s rendering system, specifically within the mesh pipeline’s view binding infrastructure. The core issue addressed is moving from a function that pre-generates all possible view layouts to one that generates layouts on-demand based on specific configuration keys.<p>The problem stemmed from the <code>generate_view_layouts</code> function’s approach of iterating through all possible combinations of <code>MeshPipelineViewLayoutKey</code> flags to create layout entries. This brute-force method had inherent inefficiencies when only a subset of configurations was needed. The function’s internal logic for creating layout entries was already encapsulated in the <code>layout_entries</code> function, but this function was marked as private, limiting its utility for developers who needed more granular control.<p>The solution approach is a classic API refactoring pattern: expose the underlying building block function and deprecate the higher-level convenience function. The developer made the previously private <code>layout_entries</code> function public and added a deprecation notice to <code>generate_view_layouts</code>, guiding users toward the new, more flexible API. This approach maintains backward compatibility while steering the codebase toward more efficient patterns.<p>From an implementation perspective, the changes are minimal but significant. The <code>layout_entries</code> function signature already contained the necessary parameters: <code>clustered_forward_buffer_binding_type</code>, <code>visibility_ranges_buffer_binding_type</code>, and most importantly, <code>layout_key: MeshPipelineViewLayoutKey</code>. This key-based approach allows callers to generate only the specific layout they need, avoiding unnecessary computation for unused combinations. The function returns a vector of <code>BindGroupLayoutEntry</code> structures, which can be used directly to create bind group layouts.<p>The technical insight here is about API design trade-offs. While <code>generate_view_layouts</code> provided convenience by handling all cases automatically, it came with performance overhead and reduced flexibility. The new approach empowers developers to optimize their rendering pipeline by only creating the layouts actually needed for their specific use case. This aligns with Bevy’s overall philosophy of giving developers control over performance-critical paths.<p>The impact of this change is primarily on API usage patterns. Existing code using <code>generate_view_layouts</code> will continue to work but will generate deprecation warnings, encouraging migration to the new approach. New code can use <code>layout_entries</code> directly for better performance when the specific layout key is known. This change also potentially reduces memory usage by avoiding the storage of unused layout combinations.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[MeshPipelineViewLayouts] --> B[generate_view_layouts]
</span><span>    A --> C[layout_entries]
</span><span>    B --> D[Deprecated]
</span><span>    C --> E[Public API]
</span><span>    F[MeshPipelineViewLayoutKey] --> C
</span><span>    G[BufferBindingType params] --> C
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-pbr-src-render-mesh-view-bindings-rs-2-1><code>crates/bevy_pbr/src/render/mesh_view_bindings.rs</code> (+2/-1)</h3><p>This file contains the core rendering logic for mesh view bindings in Bevy’s PBR (Physically Based Rendering) pipeline. The changes modify how bind group layouts are generated for mesh views.<p><strong>Key modifications:</strong><ol><li><p><strong>Making <code>layout_entries</code> function public:</strong></p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>layout_entries</span><span>(
</span><span>    </span><span style=color:#ff8f40>clustered_forward_buffer_binding_type</span><span style=color:#61676ccc>:</span><span> BufferBindingType,
</span><span>    </span><span style=color:#ff8f40>visibility_ranges_buffer_binding_type</span><span style=color:#61676ccc>:</span><span> BufferBindingType,
</span><span>    </span><span style=color:#ff8f40>layout_key</span><span style=color:#61676ccc>:</span><span> MeshPipelineViewLayoutKey,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTBindGroupLayoutEntry> {
</span></code></pre> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>layout_entries</span><span>(
</span><span>    </span><span style=color:#ff8f40>clustered_forward_buffer_binding_type</span><span style=color:#61676ccc>:</span><span> BufferBindingType,
</span><span>    </span><span style=color:#ff8f40>visibility_ranges_buffer_binding_type</span><span style=color:#61676ccc>:</span><span> BufferBindingType,
</span><span>    </span><span style=color:#ff8f40>layout_key</span><span style=color:#61676ccc>:</span><span> MeshPipelineViewLayoutKey,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTBindGroupLayoutEntry> {
</span></code></pre> <p>This change exposes the previously internal layout generation logic, allowing developers to generate specific layout entries on demand.</p><li><p><strong>Deprecating <code>generate_view_layouts</code> function:</strong></p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>/// Generates all possible view layouts for the mesh pipeline, based on all combinations of
</span><span style=color:#abb0b6;font-style:italic>/// [`MeshPipelineViewLayoutKey`] flags.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>generate_view_layouts</span><span>(
</span><span>    </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderDevice,
</span><span>    </span><span style=color:#ff8f40>render_adapter</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderAdapter,
</span><span style=color:#abb0b6;font-style:italic>// ... function implementation
</span></code></pre> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// Generates all possible view layouts for the mesh pipeline, based on all combinations of
</span><span style=color:#abb0b6;font-style:italic>/// [`MeshPipelineViewLayoutKey`] flags.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>deprecated</span><span>(since </span><span style=color:#ed9366>= </span><span style=color:#86b300>"0.16.0"</span><span style=color:#61676ccc>,</span><span> note </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Use `layout_entries` instead"</span><span>)]
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>generate_view_layouts</span><span>(
</span><span>    </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderDevice,
</span><span>    </span><span style=color:#ff8f40>render_adapter</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderAdapter,
</span><span style=color:#abb0b6;font-style:italic>// ... function implementation (unchanged)
</span></code></pre> <p>The deprecation attribute signals that this function should no longer be used in new code and provides guidance for migration.</p></ol><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Render Graph Documentation</strong>: Understanding how bind groups and layouts work within Bevy’s render graph system<li><strong>WGSL Bind Group Layouts</strong>: The underlying WebGPU Shading Language concepts for resource binding<li><strong>API Evolution Patterns</strong>: Best practices for deprecating and evolving public APIs in Rust libraries<li><strong>Issue #17537</strong>: The original issue that proposed this API change, providing additional context about the motivation</ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_pbr/src/render/mesh_view_bindings.rs b/crates/bevy_pbr/src/render/mesh_view_bindings.rs
</span><span>index 796ae096c2e26..e527a49daa719 100644
</span><span style=color:#c594c5>--- a/crates/bevy_pbr/src/render/mesh_view_bindings.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_pbr/src/render/mesh_view_bindings.rs
</span><span style=color:#c594c5>@@ -195,7 +195,7 @@ </span><span style=color:#399ee6>pub(crate) fn buffer_layout(
</span><span> }
</span><span> 
</span><span> /// Returns the appropriate bind group layout vec based on the parameters
</span><span style=color:#f07171>-fn layout_entries(
</span><span style=color:#86b300>+pub fn layout_entries(
</span><span>     clustered_forward_buffer_binding_type: BufferBindingType,
</span><span>     visibility_ranges_buffer_binding_type: BufferBindingType,
</span><span>     layout_key: MeshPipelineViewLayoutKey,
</span><span style=color:#c594c5>@@ -470,6 +470,7 @@ </span><span style=color:#399ee6>impl MeshPipelineViewLayouts {
</span><span> 
</span><span> /// Generates all possible view layouts for the mesh pipeline, based on all combinations of
</span><span> /// [`MeshPipelineViewLayoutKey`] flags.
</span><span style=color:#86b300>+#[deprecated(since = "0.16.0", note = "Use `layout_entries` instead")]
</span><span> pub fn generate_view_layouts(
</span><span>     render_device: &RenderDevice,
</span><span>     render_adapter: &RenderAdapter,
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_17714.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>