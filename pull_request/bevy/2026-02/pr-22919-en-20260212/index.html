<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22919 Cut down on register_component codegen
        
    </title><meta content="#22919 Cut down on register_component codegen" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-12</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22919-zh-cn-20260212>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Cut down on register_component codegen<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22919<li><strong>Author</strong>: cart<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Performance<li><strong>Created</strong>: 2026-02-12T00:45:32Z<li><strong>Merged</strong>: 2026-02-12T22:24:52Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><p>#20934 [regressed] our binary sizes. This claws back 4 MiB on a release build of <code>3d_scene</code> by hoisting out the generic parts of register_component, allowing for more shared code. Based on my estimates, 0.9 MiB of this is part of the 8.3 MiB regression attributed to Resources as Components.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a binary size regression that occurred in PR #20934. The regression was significant - approximately 8.3 MiB attributed to Resources as Components, with this PR recovering 4 MiB specifically from a release build of the <code>3d_scene</code> example.<p>The core issue was excessive monomorphization of the <code>register_component</code> function. In Bevy’s ECS (Entity Component System), every component type needs to be registered with the system. Before this change, the registration logic was fully generic, meaning the compiler would generate separate machine code for each component type. This resulted in significant binary bloat as the number of component types increased.<p>The solution approach was to refactor the registration functions to reduce code duplication through type erasure. Instead of having fully generic functions, the type-specific parts are extracted as function pointers, allowing the core registration logic to be shared across all component types. This is a classic case of balancing compile-time performance with runtime efficiency - we accept a small runtime overhead from function pointer indirection to achieve substantial binary size reduction.<p>The implementation modifies two key functions: <code>register_component_checked</code> and <code>register_component_unchecked</code>. Previously, these were generic functions that accepted a type parameter <code>T: Component</code>. The new implementation accepts function pointers for the type-specific operations:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_component_checked</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>type_id</span><span style=color:#61676ccc>:</span><span> TypeId,
</span><span>    </span><span style=color:#ff8f40>descriptor</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>() </span><span style=color:#61676ccc>-></span><span> ComponentDescriptor,
</span><span>    </span><span style=color:#ff8f40>register_required_components</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(ComponentId, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> RequiredComponentsRegistrator),
</span><span>    </span><span style=color:#ff8f40>update_from_component</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentHooks) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentHooks,
</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId
</span></code></pre><p>The public-facing <code>register_component&LTT: Component></code> method now calls this shared implementation, passing the type-specific functions as arguments:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register_component</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_component_checked</span><span>(
</span><span>        TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>        ComponentDescriptor</span><span style=color:#ed9366>::</span><span>new</span><span style=color:#ed9366>::</span><span>&LTT></span><span style=color:#61676ccc>,
</span><span>        T</span><span style=color:#ed9366>::</span><span>register_required_components</span><span style=color:#61676ccc>,
</span><span>        ComponentHooks</span><span style=color:#ed9366>::</span><span>update_from_component</span><span style=color:#ed9366>::</span><span>&LTT></span><span style=color:#61676ccc>,
</span><span>    )
</span><span>}
</span></code></pre><p>Similarly, <code>register_component_unchecked</code> was refactored to accept the same set of function pointers. This change reduces monomorphization because the compiler now generates only one instance of <code>register_component_checked</code> and <code>register_component_unchecked</code>, rather than one per component type.<p>The technical insight here is that while Rust’s monomorphization provides excellent runtime performance by generating specialized code for each type, it can lead to significant code bloat. In cases where the specialized code is largely identical except for a few type-specific operations, it’s more efficient to extract those operations as function pointers and share the common code.<p>This approach has several implications:<ol><li><strong>Binary Size</strong>: The 4 MiB reduction demonstrates the effectiveness of this approach. Approximately 0.9 MiB of this reduction addresses the specific regression from Resources as Components.<li><strong>Compile Time</strong>: Reduced monomorphization should also improve compile times, as the compiler has less code to generate and optimize.<li><strong>Runtime Performance</strong>: There’s a minor trade-off - function pointer indirection adds a small overhead compared to direct inlined calls. However, this overhead is typically negligible compared to the I/O and other operations involved in component registration.</ol><p>The changes fit cleanly into Bevy’s ECS architecture. The registration process remains logically the same - components still get their unique IDs, descriptors are created, required components are registered, and hooks are updated. Only the implementation details of how this happens have changed to be more efficient.<p>One interesting aspect is that the <code>ComponentsQueuedRegistrator::run</code> method also had to be updated to use the new function signature. This ensures consistency across all registration paths.<p>The impact of this change extends beyond just fixing the regression. It sets a pattern for optimizing other similar code paths in the codebase. Anywhere there’s significant monomorphization with largely identical code, similar refactoring could yield binary size benefits.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[register_component&LTT>] --> B[register_component_checked]
</span><span>    B --> C[register_component_unchecked]
</span><span>    C --> D[components.register_component_inner]
</span><span>
</span><span>    E[Component Type T] --> F[TypeId::of::&LTT>]
</span><span>    E --> G[ComponentDescriptor::new::&LTT>]
</span><span>    E --> H[T::register_required_components]
</span><span>    E --> I[ComponentHooks::update_from_component::&LTT>]
</span><span>
</span><span>    F --> B
</span><span>    G --> B
</span><span>    H --> B
</span><span>    I --> B
</span><span>
</span><span>    style B fill:#e1f5e1
</span><span>    style C fill:#e1f5e1
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_ecs/src/component/register.rs</code> (+41/-14)</strong><p>This file contains the core changes to reduce monomorphization in the component registration system.<p><strong>Key Changes:</strong><ol><li><strong>Refactored <code>register_component_checked</code> from generic to function-pointer based:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (generic):
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>super</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_component_checked</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId {
</span><span>    </span><span style=color:#fa6e32>let</span><span> type_id </span><span style=color:#ed9366>= </span><span>TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... type-specific logic using T
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>register_component_unchecked</span><span style=color:#ed9366>::</span><span>&LTT>(id)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (type-erased):
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_component_checked</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>type_id</span><span style=color:#61676ccc>:</span><span> TypeId,
</span><span>    </span><span style=color:#ff8f40>descriptor</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>() </span><span style=color:#61676ccc>-></span><span> ComponentDescriptor,
</span><span>    </span><span style=color:#ff8f40>register_required_components</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(ComponentId, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> RequiredComponentsRegistrator),
</span><span>    </span><span style=color:#ff8f40>update_from_component</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentHooks) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentHooks,
</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... shared logic using function pointers
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_component_unchecked</span><span>(
</span><span>            type_id</span><span style=color:#61676ccc>,
</span><span>            id</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#f07171>descriptor</span><span>()</span><span style=color:#61676ccc>,
</span><span>            register_required_components</span><span style=color:#61676ccc>,
</span><span>            update_from_component</span><span style=color:#61676ccc>,
</span><span>        )</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><ol start=2><li><strong>Updated public <code>register_component</code> to use the type-erased version:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: directly called generic version
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register_component</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>register_component_checked</span><span style=color:#ed9366>::</span><span>&LTT>()
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: passes type-specific functions as arguments
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register_component</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ComponentId {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_component_checked</span><span>(
</span><span>        TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>        ComponentDescriptor</span><span style=color:#ed9366>::</span><span>new</span><span style=color:#ed9366>::</span><span>&LTT></span><span style=color:#61676ccc>,
</span><span>        T</span><span style=color:#ed9366>::</span><span>register_required_components</span><span style=color:#61676ccc>,
</span><span>        ComponentHooks</span><span style=color:#ed9366>::</span><span>update_from_component</span><span style=color:#ed9366>::</span><span>&LTT></span><span style=color:#61676ccc>,
</span><span>    )
</span><span>}
</span></code></pre><ol start=3><li><strong>Refactored <code>register_component_unchecked</code> similarly:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: generic function
</span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>register_component_unchecked</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> ComponentId) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Type-specific operations using T directly
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_component_inner</span><span>(id</span><span style=color:#61676ccc>, </span><span>ComponentDescriptor</span><span style=color:#ed9366>::</span><span>new</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> type_id </span><span style=color:#ed9366>= </span><span>TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... more T-specific logic
</span><span>    T</span><span style=color:#ed9366>::</span><span>register_required_components(id</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> required_components_registrator)</span><span style=color:#61676ccc>;
</span><span>    info</span><span style=color:#ed9366>.</span><span>hooks</span><span style=color:#ed9366>.</span><span>update_from_component</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: accepts function pointers
</span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>register_component_unchecked</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>type_id</span><span style=color:#61676ccc>:</span><span> TypeId,
</span><span>    </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> ComponentId,
</span><span>    </span><span style=color:#ff8f40>descriptor</span><span style=color:#61676ccc>:</span><span> ComponentDescriptor,
</span><span>    </span><span style=color:#ff8f40>register_required_components</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(ComponentId, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> RequiredComponentsRegistrator),
</span><span>    </span><span style=color:#ff8f40>update_from_component</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentHooks) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentHooks,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Uses passed parameters instead of T directly
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_component_inner</span><span>(id</span><span style=color:#61676ccc>,</span><span> descriptor)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... shared logic using function pointers
</span><span>    </span><span style=color:#f07171>register_required_components</span><span>(id</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> required_components_registrator)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#f07171>update_from_component</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> info</span><span style=color:#ed9366>.</span><span>hooks)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=4><li><strong>Updated <code>ComponentsQueuedRegistrator::run</code> to use the new API:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Updated call site in ComponentsQueuedRegistrator::run
</span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    registrator</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_component_unchecked</span><span>(
</span><span>        TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>        id</span><span style=color:#61676ccc>,
</span><span>        ComponentDescriptor</span><span style=color:#ed9366>::</span><span>new</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>        T</span><span style=color:#ed9366>::</span><span>register_required_components</span><span style=color:#61676ccc>,
</span><span>        ComponentHooks</span><span style=color:#ed9366>::</span><span>update_from_component</span><span style=color:#ed9366>::</span><span>&LTT></span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>These changes allow the compiler to generate only one instance of the core registration logic instead of one per component type, significantly reducing binary size.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust Monomorphization</strong>: The Rust Book section on monomorphization and generics explains how Rust handles generic code compilation.<li><strong>Code Bloat Reduction Techniques</strong>: Articles on reducing binary size in Rust, particularly focusing on minimizing monomorphization overhead.<li><strong>Bevy ECS Documentation</strong>: The Bevy ECS documentation covers component registration and the overall architecture.<li><strong>Function Pointers vs Generics</strong>: Resources comparing the performance characteristics of function pointers versus generic monomorphization in Rust.<li><strong>PR #20934</strong>: The original PR that introduced the regression, for context on what changes necessitated this optimization.<li><strong>Issue #22915</strong>: The issue tracking the binary size regression that this PR addresses.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22919.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>