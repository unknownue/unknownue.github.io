<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22844 remove Debug from material strings and add LoadContext to GltfExtensi…
        
    </title><meta content="#22844 remove Debug from material strings and add LoadContext to GltfExtensi…" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-07</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-02/pr-22844-en-20260207>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><p>remove Debug from material strings and add LoadContext to GltfExtensi…<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: remove Debug from material strings and add LoadContext to GltfExtensi…<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22844<li><strong>Author</strong>: ChristopherBiscardi<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Examples, S-Ready-For-Final-Review, A-glTF<li><strong>Created</strong>: 2026-02-07T03:19:01Z<li><strong>Merged</strong>: 2026-02-07T05:51:47Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>（PR 描述的中文翻译，保留所有技术术语、图片链接和代码格式）<p><strong>目标</strong> PR #22569 引入了一些回归问题。其中至少部分问题是由资产名称中的 debug 格式化引起的。<p>这导致了像 <code>"DefaultMaterial"#std</code> 这样的资产名称。<p><strong>解决方案</strong> 移除 debug 格式化。<p>此外，启用从 <code>GltfMaterial::default()</code> 构建的 <code>StandardMaterial</code> 等资源的初始化，以便资产加载器能够访问它们。像这种不存在的默认材质将不会调用 <code>on_material</code> 钩子，因此也不会被初始化以供后续引用。<p><strong>测试</strong> multi_asset_sync 和 hot_reloading 通过此修复得到了解决。</p><img alt="screenshot-2026-02-06-at-19 11 31@2x" height=2096 src=https://github.com/user-attachments/assets/07a31bf9-4013-4e80-a285-9b078eb28875 width=3776><img alt="screenshot-2026-02-06-at-19 16 42@2x" height=2096 src=https://github.com/user-attachments/assets/5f1c1848-9469-4108-9600-5115d71d7e4c width=3776><p>但各向异性看起来仍然不正确，因此这只是修复了一个问题，似乎还有更多工作要做。</p><img alt="screenshot-2026-02-06-at-19 17 20@2x" height=2096 src=https://github.com/user-attachments/assets/70bd1fe2-39e4-439d-a88e-e34b39aa06a8 width=3776><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这个 PR 源于一个在资产加载和热重载过程中发现的、由看似微小的格式问题导致的回归。PR #22569 引入了一些更改，无意中破坏了 <code>multi_asset_sync</code> 和 <code>hot_reloading</code> 示例的功能。经过调查，问题被追踪到资产名称的生成方式上。<p>问题的根本原因在于 <code>bevy_pbr</code> 模块中，glTF 材质扩展处理器（<code>GltfExtensionHandlerPbr</code>）在创建 <code>StandardMaterial</code> 资产时，使用了 <code>Debug</code> trait 的格式化（即 <code>format!("{:?}#std", material_label)</code>）来生成资产标签（label）。这导致当 <code>material_label</code> 是一个字符串字面量（如 <code>"DefaultMaterial"</code>）时，生成的资产名称会包含引号，变成 <code>"DefaultMaterial"#std</code>。而在资产加载和引用系统中，这些引号成为资产标签的一部分，使得后续通过 <code>format!("{}#std", material_label)</code>（不带 <code>Debug</code> 格式化）构建的标签无法匹配到之前注册的资产，从而导致资产句柄查找失败，表现为材质丢失或热重载不生效。<p>因此，解决方案的第一个部分非常直接：将 <code>format!("{:?}#std", material_label)</code> 全部替换为 <code>format!("{}#std", material_label)</code>，即使用 <code>Display</code> 格式化而非 <code>Debug</code> 格式化。这样，字符串 <code>"DefaultMaterial"</code> 生成的标签就是 <code>DefaultMaterial#std</code>，确保了标签创建和后续查找的一致性。<p>然而，修复格式化问题只是解决了资产名称不匹配的问题。PR 描述中还提到了一个更深层次的问题：对于那些没有明确指定材质、应该使用 glTF 默认材质的网格（meshes），其对应的 <code>StandardMaterial</code> 可能根本不会被创建。这是因为 <code>GltfExtensionHandlerPbr</code> 的 <code>on_material</code> 钩子只有在 glTF 文件中实际定义了材质时才会被调用。如果一个网格没有材质，它应该使用默认材质，但默认材质作为一个逻辑概念，并没有一个对应的 <code>GltfMaterial</code> 数据块来触发 <code>on_material</code> 调用。<p>为了解决这个问题，需要提前创建并注册这个默认材质资产。这就是解决方案的第二个部分：利用 <code>GltfExtensionHandler</code> trait 新增的 <code>on_root</code> 生命周期钩子。<code>on_root</code> 在 glTF 根数据被加载后、具体处理网格和材质之前被调用，它为扩展处理器提供了一个在资产加载上下文（<code>LoadContext</code>）中提前创建资产的机会。<p>在这个 PR 中，<code>GltfExtensionHandlerPbr</code> 实现了 <code>on_root</code> 方法。它使用一个预定义的标签 <code>GltfAssetLabel::DefaultMaterial</code>（其值为 <code>"DefaultMaterial"</code>）拼接上 <code>#std</code> 后缀，构造出默认材质的标签（<code>"DefaultMaterial#std"</code>）。然后，它调用 <code>load_context.add_labeled_asset</code>，将一个由 <code>GltfMaterial::default()</code> 创建的 <code>StandardMaterial</code> 注册到该标签下。这样，无论后续的网格是否指定了材质，只要它需要引用默认材质，都可以通过这个预注册的标签获取到正确的资产句柄。<p>值得注意的是，为了支持这个新的 <code>on_root</code> 钩子，<code>GltfExtensionHandler</code> trait 的定义和其在整个 glTF 加载流程中的调用点也必须进行修改。这正是另外两个被修改文件的作用：它们将 <code>LoadContext</code> 参数添加到了 <code>on_root</code> 方法的签名中，并确保在加载器（<code>GltfLoader</code>）中调用时传递了这个上下文。<p>这次修改展示了资产加载系统中一个重要的模式：对于某些逻辑上存在但数据中可能不直接存在的“默认”或“后备”资源，需要在加载流程的合适时机（如 <code>on_root</code>）主动进行创建和注册，以确保整个引用链的完整性。<p>尽管这个 PR 修复了资产名称格式化和默认材质初始化的问题，使 <code>multi_asset_sync</code> 和 <code>hot_reloading</code> 示例恢复了正常（如提交的截图所示），但作者指出各向异性（anisotropy）渲染仍然存在问题。这表明 #22569 引入的回归可能涉及多个方面，需要后续的 PR 来完全解决。<h2 id=visual-representation>Visual Representation</h2><p>以下 Mermaid 图展示了此 PR 修改后，glTF 加载流程中相关组件与资产创建的关键关系：<pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph "Gltf Loading Process"
</span><span>        A[GltfLoader.load] --> B[调用所有扩展的 on_root]
</span><span>        B --> C[GltfExtensionHandlerPbr.on_root]
</span><span>        C --> D[创建并注册 DefaultMaterial 资产]
</span><span>        A --> E[处理具体 Mesh 和 Material]
</span><span>        E --> F[调用 on_material (如果材质存在)]
</span><span>        F --> G[GltfExtensionHandlerPbr.on_material]
</span><span>        G --> H[创建并注册对应 StandardMaterial 资产]
</span><span>        E --> I[调用 on_spawn_mesh_and_material]
</span><span>        I --> J[GltfExtensionHandlerPbr.on_spawn_mesh_and_material]
</span><span>        J --> K[为 Entity 插入 MeshMaterial3d 组件]
</span><span>        K --> L[使用 LoadContext.get_label_handle 获取材质句柄]
</span><span>    end
</span><span>    subgraph "Asset Registry (LoadContext)"
</span><span>        M[Registered Assets]
</span><span>        D --> M
</span><span>        H --> M
</span><span>        L -.-> M
</span><span>    end
</span></code></pre><p>该图描绘了修改后 glTF 加载器（<code>GltfLoader</code>）如何协调各个扩展处理器（<code>GltfExtensionHandler</code>）。关键新增路径是 <code>on_root</code> 阶段提前注册默认材质，确保了后续步骤（尤其是 <code>on_spawn_mesh_and_material</code>）能够通过一致的标签（无 <code>Debug</code> 格式化）查找到所需的材质资产句柄。<h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-pbr-src-lib-rs-20-6>1. <code>crates/bevy_pbr/src/lib.rs</code> (+20/-6)</h3><p>这是本次修复的核心文件，修改了 <code>GltfExtensionHandlerPbr</code> 的实现。<p><strong>主要修改与原因:</strong><ol><li><strong>移除 Debug 格式化</strong>：在 <code>on_material</code> 和 <code>on_spawn_mesh_and_material</code> 方法中，将生成材质标签的代码从 <code>format!("{:?}#std", material_label)</code> 改为 <code>format!("{}#std", material_label)</code>。这解决了资产名称因包含引号而导致的不匹配问题。<li><strong>简化资产注册</strong>：在 <code>on_material</code> 方法中，将原本使用 <code>labeled_asset_scope</code> 的复杂注册方式，改为直接使用 <code>load_context.add_labeled_asset</code>。这使代码更清晰，并与 <code>on_root</code> 中的做法保持一致。<li><strong>实现 <code>on_root</code> 钩子</strong>：新增 <code>on_root</code> 方法实现，用于在 glTF 根数据加载后，主动创建并注册默认的 <code>StandardMaterial</code> 资产（标签为 <code>"DefaultMaterial#std"</code>）。这确保了没有明确材质的网格也能引用到有效的默认材质。</ol><p><strong>关键代码片段:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After: on_root 方法新增
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_root</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>load_context</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>LoadContext<'</span><span style=color:#ed9366>_</span><span>>, </span><span style=color:#ff8f40>_gltf</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>gltf</span><span style=color:#ed9366>::</span><span>Gltf) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 为 glTF 的 `DefaultMaterial` 创建 `StandardMaterial`，
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 以便当网格没有材质时可以访问它。
</span><span>    </span><span style=color:#fa6e32>let</span><span> std_label </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>#std"</span><span style=color:#61676ccc>, </span><span>GltfAssetLabel</span><span style=color:#ed9366>::</span><span>DefaultMaterial)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    load_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_labeled_asset</span><span>(
</span><span>        std_label</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#f07171>standard_material_from_gltf_material</span><span>(</span><span style=color:#ed9366>&</span><span>GltfMaterial</span><span style=color:#ed9366>::</span><span>default())</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: on_material 方法修改 (对比之前)
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_material</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, ...) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 修改点1: 移除 Debug 格式化 (`{:?}` -> `{}`)
</span><span>    </span><span style=color:#fa6e32>let</span><span> std_label </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>#std"</span><span style=color:#61676ccc>,</span><span> material_label)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 修改点2: 使用更直接的 add_labeled_asset 替代 labeled_asset_scope
</span><span>    load_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_labeled_asset</span><span>(
</span><span>        std_label</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#f07171>standard_material_from_gltf_material</span><span>(material_asset)</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: on_spawn_mesh_and_material 方法修改
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_spawn_mesh_and_material</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, ...) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 修改点: 移除 Debug 格式化 (`{:?}` -> `{}`)
</span><span>    </span><span style=color:#fa6e32>let</span><span> std_label </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>#std"</span><span style=color:#61676ccc>,</span><span> material_label)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> handle </span><span style=color:#ed9366>=</span><span> load_context</span><span style=color:#ed9366>.</span><span>get_label_handle</span><span style=color:#ed9366>::</span><span>&LTStandardMaterial>(std_label)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-gltf-src-loader-extensions-mod-rs-1-1>2. <code>crates/bevy_gltf/src/loader/extensions/mod.rs</code> (+1/-1)</h3><p>这个文件修改了 <code>GltfExtensionHandler</code> trait 的定义。<p><strong>主要修改与原因:</strong> 为了支持在 <code>on_root</code> 阶段创建资产，需要将 <code>LoadContext</code> 参数添加到 <code>on_root</code> 方法的签名中。这使得具体的扩展处理器（如 <code>GltfExtensionHandlerPbr</code>）在实现 <code>on_root</code> 时能够访问资产加载上下文。<p><strong>关键代码片段:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_root</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>gltf</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>gltf</span><span style=color:#ed9366>::</span><span>Gltf) {}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_root</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>load_context</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>LoadContext<'</span><span style=color:#ed9366>_</span><span>>, </span><span style=color:#ff8f40>gltf</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>gltf</span><span style=color:#ed9366>::</span><span>Gltf) {}
</span></code></pre><h3 id=3-crates-bevy-gltf-src-loader-mod-rs-1-1>3. <code>crates/bevy_gltf/src/loader/mod.rs</code> (+1/-1)</h3><p>这个文件修改了 glTF 加载器（<code>GltfLoader</code>）中调用扩展处理器的代码。<p><strong>主要修改与原因:</strong> 为了匹配 trait 定义的更改，需要在调用每个扩展的 <code>on_root</code> 方法时，传入 <code>load_context</code> 参数。<p><strong>关键代码片段:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>for</span><span> extension </span><span style=color:#ed9366>in</span><span> extensions</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter_mut</span><span>() {
</span><span>    extension</span><span style=color:#ed9366>.</span><span style=color:#f07171>on_root</span><span>(</span><span style=color:#ed9366>&</span><span>gltf)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>for</span><span> extension </span><span style=color:#ed9366>in</span><span> extensions</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter_mut</span><span>() {
</span><span>    extension</span><span style=color:#ed9366>.</span><span style=color:#f07171>on_root</span><span>(load_context</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>gltf)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Related PR</strong>: #22569 - 这个 PR 引入了最初的回归，理解它有助于了解问题的完整背景。<li><strong>Bevy Asset System</strong>: 关于 Bevy 资产系统、<code>LoadContext</code> 和标签化资产（labeled assets）的官方文档或示例，可以帮助深入理解本 PR 涉及的资产加载机制。<li><strong>glTF Extension System</strong>: Bevy 中 glTF 扩展处理器的设计文档或相关代码，有助于理解 <code>GltfExtensionHandler</code> trait 的生命周期钩子（如 <code>on_root</code>, <code>on_material</code>）是如何被集成到整个 glTF 加载流程中的。</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22844.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>