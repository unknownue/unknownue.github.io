<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22986 Add line width and quad support for wireframes.
        
    </title><meta content="#22986 Add line width and quad support for wireframes." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-18</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22986-zh-cn-20260218>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add line width and quad support for wireframes.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22986<li><strong>Author</strong>: tychedelia<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review, D-Modest<li><strong>Created</strong>: 2026-02-17T00:17:26Z<li><strong>Merged</strong>: 2026-02-18T00:18:00Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>Adds support for line width (stroke) and quad topology for wireframes.<p>The triangle line fast path stays the same, but we add a new “wide” draw function path that uses a specialized vertex shader in order to do the following via vertex pulling from the appropriate mesh slab:<ul><li>Compute screen-space altitudes for our edges.<li>Find and suppress diagonals when quad topology is enabled.</ul><p>Doing this in the vertex shader allows us to avoid needing to de-dupe on the CPU or spend additional bandwidth uploading a mesh copy at the expense of a bit of extra shading.<p>Right now, we have to break batches on the mesh when in the “wide” path, meaning we don’t get full advantage of MDI, but this is mostly because we don’t have a great way to support per-draw data. This could be fixed in the future.<h2 id=examples>Examples:</h2><img alt=image height=1126 src=https://github.com/user-attachments/assets/cd73eb9d-f215-413d-ba28-bddc6bd980b0 width=1924><img alt="Screenshot 2026-02-16 160350" height=1127 src=https://github.com/user-attachments/assets/901f5dbb-c900-43b3-bd6b-ce5c9eece82f width=1924><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Wireframe rendering in Bevy had two main limitations: it only supported 1-pixel wide lines and always rendered triangle edges, even when meshes were composed of quads. This was fine for basic debugging, but for artistic or visualization purposes, users needed thicker lines and the ability to suppress internal diagonals when rendering quad-based meshes.<p>The existing implementation used a simple approach: it rendered wireframes using <code>PolygonMode::Line</code>, which is fast but limited by the hardware’s line rendering capabilities (typically 1 pixel maximum width). To support wider lines or quad topology, the renderer would need to either generate geometry for the thickened lines or use a shader-based distance field approach.<p>The challenge was to implement these features without introducing excessive CPU overhead or memory bandwidth. Traditional approaches might involve:<ul><li>CPU-side edge deduplication for quad topology<li>Generating new geometry for thick lines<li>Uploading additional mesh data to the GPU</ul><h3 id=the-solution-approach>The Solution Approach</h3><p>The developer chose a shader-based approach using vertex pulling from mesh storage buffers. This allowed the GPU to handle both line width calculation and quad detection without CPU intervention. The solution maintains two rendering paths:<ol><li><strong>Thin path</strong> (existing): For line width ≤ 1 and triangle topology, uses the original <code>PolygonMode::Line</code> approach<li><strong>Wide path</strong> (new): For line width > 1 or quad topology, uses a custom vertex shader that pulls vertex data from storage buffers</ol><p>The key insight was to compute screen-space edge distances in the vertex shader using the altitude-based distance field technique described in Baerentzen et al.’s “Single-Pass Wireframe Rendering” (SIGGRAPH 2006). For quad topology, the shader detects shared diagonals between adjacent triangles and suppresses them while including all perimeter edges.<h3 id=the-implementation>The Implementation</h3><p>The implementation required changes across the wireframe rendering system:<p><strong>Shader Architecture</strong>: The existing <code>wireframe.wgsl</code> shader was extended with a new <code>WIREFRAME_WIDE</code> path. When enabled, this path:<ul><li>Uses storage buffers for vertex and index data instead of traditional vertex buffers<li>Computes screen-space positions and edge altitudes in the vertex shader<li>For quad topology, identifies diagonal edges and includes perimeter edges from adjacent triangles<li>Uses a distance field in the fragment shader to render lines with configurable width and smoothing</ul><p><strong>Rust-side Changes</strong>: The wireframe system was updated to support the new wide path:<ul><li>Added <code>WireframeLineWidth</code> and <code>WireframeTopology</code> components<li>Extended <code>WireframeConfig</code>, <code>WireframeMaterial</code>, and <code>RenderWireframeMaterial</code> to store line width and topology settings<li>Created <code>WireframeWideBindGroups</code> to manage storage buffer bind groups for vertex pulling<li>Added new render commands: <code>DrawWireframe3dWide</code>, <code>SetWireframe3dWideImmediates</code>, <code>SetWireframe3dWideBindGroup</code>, and <code>DrawWireframeMeshPulled</code><li>Modified pipeline specialization to create separate pipelines for thin and wide paths</ul><p><strong>Batch Management</strong>: The wide path requires per-mesh bind groups because each mesh has different vertex pull parameters. This forces batch breaking by mesh, which reduces the effectiveness of multi-draw indirect (MDI). The developer noted this as a trade-off that could be improved with better per-draw data support in the future.<h3 id=technical-insights>Technical Insights</h3><p><strong>Vertex Pulling Pattern</strong>: Instead of using traditional vertex buffers, the wide path uses storage buffers (<code>storage_buffer_read_only::&LTu32></code>) and computes vertex positions manually in the shader. This allows the same shader to work with any mesh layout without needing to know the vertex format at compile time.<p><strong>Altitude-Based Distance Field</strong>: The shader computes the altitude (perpendicular distance) from each vertex to the opposite edge in screen space. These altitudes are interpolated across the triangle, and the fragment shader takes the minimum distance to determine how close a pixel is to any edge. This creates a smooth distance field that can be used to render lines of arbitrary width.<p><strong>Quad Detection Algorithm</strong>: For quad topology, the shader assumes quads are represented as two triangles. It identifies the diagonal edge by checking which vertices are shared between adjacent triangles. The diagonal is suppressed by setting its distance to a large value, while the other triangle’s perimeter edges are included by computing distances to those edges.<p><strong>Performance Considerations</strong>: The wide path does more work in the vertex shader and uses storage buffer reads, which are slower than traditional vertex buffer fetches. However, it avoids CPU-side edge processing and duplicate geometry generation. The batch breaking issue is noted as a current limitation that could be addressed with future engine improvements.<h3 id=the-impact>The Impact</h3><p>This PR significantly expands Bevy’s wireframe rendering capabilities. Users can now:<ul><li>Render wireframes with configurable line width (in screen-space pixels)<li>Choose between triangle and quad topology for edge rendering<li>Get smooth anti-aliased edges through the distance field approach</ul><p>The implementation is backward compatible - existing wireframe rendering continues to use the fast path. The new features are opt-in through the <code>WireframeLineWidth</code> and <code>WireframeTopology</code> components.<p>The example was updated to demonstrate the new capabilities, showing how to create thick wireframes and use quad topology to suppress diagonal lines in cube rendering.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Wireframe Rendering] --> B{Line Width > 1 or Quads?}
</span><span>    B -->|No| C[Thin Path]
</span><span>    B -->|Yes| D[Wide Path]
</span><span>    
</span><span>    C --> E[PolygonMode::Line]
</span><span>    E --> F[Fast, 1-pixel lines]
</span><span>    
</span><span>    D --> G[Vertex Pulling]
</span><span>    G --> H[Storage Buffers]
</span><span>    H --> I[Distance Field Shader]
</span><span>    I --> J[Configurable width & smoothing]
</span><span>    
</span><span>    K[Quad Topology] --> L[Diagonal Detection]
</span><span>    L --> M[Perimeter Edge Inclusion]
</span><span>    M --> J
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-pbr-src-render-wireframe-wgsl-255-4>1. <code>crates/bevy_pbr/src/render/wireframe.wgsl</code> (+255/-4)</h3><p>This file contains the shader implementation for both thin and wide wireframe paths.<p><strong>Key changes:</strong><ul><li>Added <code>WIREFRAME_WIDE</code> shader define to toggle between paths<li>Implemented vertex pulling from storage buffers for the wide path<li>Added altitude-based distance field calculation for edge rendering<li>Implemented quad topology support with diagonal suppression</ul><p><strong>Code snippet (distance field calculation):</strong><pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// altitudes: h_i = 2 * area / opposite_edge_length
</span><span>// the altitude-based distance field follows Baerentzen et al., "Single-Pass
</span><span>// Wireframe Rendering" (SIGGRAPH 2006) and the NVIDIA "Solid Wireframe"
</span><span>// whitepaper (2007).
</span><span>let h0 = area2 / max(len12, 0.001);
</span><span>let h1 = area2 / max(len20, 0.001);
</span><span>let h2 = area2 / max(len01, 0.001);
</span></code></pre><h3 id=2-crates-bevy-pbr-src-wireframe-rs-716-68>2. <code>crates/bevy_pbr/src/wireframe.rs</code> (+716/-68)</h3><p>This is the main Rust implementation file for wireframe rendering.<p><strong>Key changes:</strong><ul><li>Added <code>WireframeLineWidth</code> and <code>WireframeTopology</code> components<li>Extended data structures to store line width and topology settings<li>Implemented <code>WireframeWideBindGroups</code> for managing storage buffer bindings<li>Added new render commands for the wide path<li>Modified pipeline specialization to support both thin and wide paths</ul><p><strong>Code snippet (new pipeline key structure):</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> Hash)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>WireframePipelineKey </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>mesh_key</span><span style=color:#61676ccc>:</span><span> MeshPipelineKey,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>wide</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>quads</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>line_mode</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span></code></pre><p><strong>Code snippet (wide path draw command):</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// Draw wireframes using vertex pulling for wide lines or quad topology.
</span><span style=color:#fa6e32>pub type </span><span style=color:#399ee6>DrawWireframe3dWide </span><span style=color:#ed9366>= </span><span>(
</span><span>    SetItemPipeline</span><span style=color:#61676ccc>,
</span><span>    SetMeshViewBindGroup&LT0></span><span style=color:#61676ccc>,
</span><span>    SetMeshViewBindingArrayBindGroup&LT1></span><span style=color:#61676ccc>,
</span><span>    SetMeshBindGroup&LT2></span><span style=color:#61676ccc>,
</span><span>    SetWireframe3dWideBindGroup</span><span style=color:#61676ccc>,
</span><span>    SetWireframe3dWideImmediates</span><span style=color:#61676ccc>,
</span><span>    DrawWireframeMeshPulled</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=3-examples-3d-wireframe-rs-55-7>3. <code>examples/3d/wireframe.rs</code> (+55/-7)</h3><p>Updated example to demonstrate new features.<p><strong>Key changes:</strong><ul><li>Added a purple cube with quad topology and 3-pixel line width<li>Added controls for changing line width and toggling topology<li>Updated UI to show current settings</ul><p><strong>Code snippet (new cube with wide wireframe):</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Purple cube: wireframe with explicit Quads topology override
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Mesh3d(meshes</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(Cuboid</span><span style=color:#ed9366>::</span><span>default()))</span><span style=color:#61676ccc>,
</span><span>    MeshMaterial3d(materials</span><span style=color:#ed9366>.</span><span style=color:#f07171>add</span><span>(Color</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#ff8f40>PURPLE</span><span>)))</span><span style=color:#61676ccc>,
</span><span>    Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ff8f40>1.5</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.5</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.5</span><span>)</span><span style=color:#61676ccc>,
</span><span>    Wireframe</span><span style=color:#61676ccc>,
</span><span>    WireframeColor {
</span><span>        color</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>YELLOW</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    WireframeLineWidth { width</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>3.0 </span><span>}</span><span style=color:#61676ccc>,
</span><span>    WireframeTopology</span><span style=color:#ed9366>::</span><span>Quads</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=4-examples-large-scenes-bevy-city-src-main-rs-1-0>4. <code>examples/large_scenes/bevy_city/src/main.rs</code> (+1/-0)</h3><p>Minor update to use default wireframe configuration.<p><strong>Code snippet:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(WireframeConfig {
</span><span>    global</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>    default_color</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>WHITE</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>})
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Baerentzen, J. A., & Aanæs, H. (2005). Single-pass wireframe rendering.</strong> SIGGRAPH 2006 paper that introduced the altitude-based distance field technique used in this implementation.</p><li><p><strong>NVIDIA Solid Wireframe Whitepaper (2007).</strong> Practical implementation guide for GPU-based wireframe rendering with thickness.</p><li><p><strong>WebGPU Storage Buffers Documentation.</strong> Understanding the vertex pulling pattern used in the wide path: https://www.w3.org/TR/webgpu/#buffer-usage</p><li><p><strong>Bevy Render Graph Documentation.</strong> For understanding how the wireframe system integrates into Bevy’s rendering architecture: https://bevyengine.org/learn/quick-start/rendering/render-graph/</p><li><p><strong>Distance Field Rendering Techniques.</strong> General background on signed distance fields and their applications in real-time graphics.</p></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22986.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>