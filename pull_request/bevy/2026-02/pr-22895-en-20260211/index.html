<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22895 conditionally skip test cases that use the debug feature
        
    </title><meta content="#22895 conditionally skip test cases that use the debug feature" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-11</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22895-zh-cn-20260211>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: conditionally skip test cases that use the debug feature<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22895<li><strong>Author</strong>: Person-93<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, S-Ready-For-Final-Review, C-Testing<li><strong>Created</strong>: 2026-02-11T00:12:52Z<li><strong>Merged</strong>: 2026-02-11T05:03:50Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Two test cases in the <code>ecs</code> crate use the <code>debug</code> feature to produce the expected panic message. This causes those tests to fail while testing without <code>debug</code>.<h2 id=solution>Solution</h2><p>Conditionally ignore those test cases.<h2 id=testing>Testing</h2><p>Run the tests for <code>ecs</code> with no additional features enabled.<h1 id=the-story-of-this-pull-request>The Story of This Pull Request</h1><p>This PR addresses a straightforward issue in Bevy’s ECS test suite: two specific tests were failing when the <code>debug</code> feature flag wasn’t enabled. The core problem is that these tests rely on specific panic message formatting that only occurs when the debug feature is active.<p>When the <code>debug</code> feature is disabled, Bevy’s error reporting uses a different, more minimal format. The tests in question use Rust’s <code>#[should_panic]</code> attribute with an <code>expected</code> parameter that checks for an exact panic message match. Since the panic message changes depending on the feature flag, these tests fail when running without <code>debug</code> enabled.<p>The developer took a pragmatic approach to solving this problem. Instead of trying to make the tests work in both configurations or splitting them into separate implementations, they used Rust’s conditional compilation attributes to simply skip these tests when the <code>debug</code> feature isn’t present. This is achieved by adding <code>#[cfg_attr(not(feature = "debug"), ignore)]</code> to each test.<p>This approach has several advantages. First, it’s minimal and maintainable - only two lines of code are added. Second, it preserves the existing test behavior when the debug feature <em>is</em> enabled, ensuring those tests still validate the debug-specific error formatting. Third, it allows the test suite to pass cleanly in all configurations, which is important for CI/CD pipelines and development workflows that might test with different feature combinations.<p>The implementation is technically simple but demonstrates good testing practices. When tests depend on specific feature flags or configurations, it’s often better to conditionally skip them rather than make them fail or create complex conditional logic within the test itself. This keeps the test suite clean and prevents false failures that don’t indicate actual bugs.<p>One alternative approach would have been to use conditional compilation to change the expected panic message based on the feature flag. However, this would require more complex code and potentially obscure the test’s intent. The chosen solution of simply skipping the tests when the required feature isn’t available is cleaner and more maintainable.<p>The impact of this change is that the Bevy ECS test suite now passes correctly regardless of whether the <code>debug</code> feature is enabled. This improves the developer experience for anyone running tests with different feature configurations and ensures CI systems don’t report false failures.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Test Suite Execution] --> B{debug feature enabled?}
</span><span>    B -->|Yes| C[Run Debug-Dependent Tests]
</span><span>    B -->|No| D[Skip Debug-Dependent Tests]
</span><span>    C --> E[Validate Debug-Specific Error Messages]
</span><span>    D --> F[Continue with Other Tests]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-system-mod-rs-2-0><code>crates/bevy_ecs/src/system/mod.rs</code> (+2/-0)</h3><p>This file contains the system module tests for Bevy’s ECS. Two test functions were modified to conditionally skip execution when the <code>debug</code> feature is not enabled.<p><strong>Before the change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>should_panic</span><span>(
</span><span>    expected </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Encountered an error in system `bevy_ecs::system::tests::simple_fallible_system::sys`: error"
</span><span>)]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>simple_fallible_system</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Test implementation
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>should_panic</span><span>(
</span><span>    expected </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Encountered an error in system `bevy_ecs::system::tests::simple_fallible_exclusive_system::sys`: error"
</span><span>)]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>simple_fallible_exclusive_system</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Test implementation
</span><span>}
</span></code></pre><p><strong>After the change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)</span><span style=color:#61676ccc>,</span><span> ignore)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>should_panic</span><span>(
</span><span>    expected </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Encountered an error in system `bevy_ecs::system::tests::simple_fallible_system::sys`: error"
</span><span>)]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>simple_fallible_system</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Test implementation
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)</span><span style=color:#61676ccc>,</span><span> ignore)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>should_panic</span><span>(
</span><span>    expected </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Encountered an error in system `bevy_ecs::system::tests::simple_fallible_exclusive_system::sys`: error"
</span><span>)]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>simple_fallible_exclusive_system</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Test implementation
</span><span>}
</span></code></pre><p>The key change is the addition of <code>#[cfg_attr(not(feature = "debug"), ignore)]</code> to both test functions. This attribute tells Rust: “If the <code>debug</code> feature is NOT enabled, apply the <code>ignore</code> attribute to this test.” The <code>ignore</code> attribute causes the test runner to skip these tests entirely when the condition is met.<h2 id=further-reading>Further Reading</h2><ol><li>Rust documentation on conditional compilation: https://doc.rust-lang.org/reference/conditional-compilation.html<li>Rust testing guide with <code>#[should_panic]</code>: https://doc.rust-lang.org/book/ch11-01-writing-tests.html#checking-for-panics-with-should_panic<li>Rust test attribute reference: https://doc.rust-lang.org/reference/attributes/testing.html<li>Bevy’s feature flag documentation: https://bevyengine.org/learn/quick-start/features/<li>Cargo features documentation: https://doc.rust-lang.org/cargo/reference/features.html</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_ecs/src/system/mod.rs b/crates/bevy_ecs/src/system/mod.rs
</span><span>index 1910232bb6d38..8c483c5c8ab9a 100644
</span><span>--- a/crates/bevy_ecs/src/system/mod.rs
</span><span>+++ b/crates/bevy_ecs/src/system/mod.rs
</span><span>@@ -1884,6 +1884,7 @@ mod tests {
</span><span>     }
</span><span> 
</span><span>     #[test]
</span><span>+    #[cfg_attr(not(feature = "debug"), ignore)]
</span><span>     #[should_panic(
</span><span>         expected = "Encountered an error in system `bevy_ecs::system::tests::simple_fallible_system::sys`: error"
</span><span>     )]
</span><span>@@ -1898,6 +1899,7 @@ mod tests {
</span><span>     }
</span><span> 
</span><span>     #[test]
</span><span>+    #[cfg_attr(not(feature = "debug"), ignore)]
</span><span>     #[should_panic(
</span><span>         expected = "Encountered an error in system `bevy_ecs::system::tests::simple_fallible_exclusive_system::sys`: error"
</span><span>     )]
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22895.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>