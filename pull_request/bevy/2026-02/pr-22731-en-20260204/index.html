<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22731 Make DepthOfField default respect DepthOfFieldMode default
        
    </title><meta content="#22731 Make DepthOfField default respect DepthOfFieldMode default" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-04</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22731-zh-cn-20260204>中文</a></div></div><div class=pr-content><h1 id=make-depthoffield-default-respect-depthoffieldmode-default>Make DepthOfField default respect DepthOfFieldMode default</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Make DepthOfField default respect DepthOfFieldMode default<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22731<li><strong>Author</strong>: FindlayRoyds<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Rendering, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2026-01-28T23:33:36Z<li><strong>Merged</strong>: 2026-02-04T00:49:37Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The original description is in English, so it is included exactly as-is:<h1 id=objective>Objective</h1><p>The default value for DepthOfFieldMode is Gaussian, but the default implementation of DepthOfField uses Bokeh.<p>Old version:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>DepthOfFieldMode </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// ...
</span><span>    Bokeh</span><span style=color:#61676ccc>,
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// ...
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// This is the default.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// ...
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>default</span><span>]
</span><span>    Gaussian</span><span style=color:#61676ccc>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Default </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DepthOfField </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>default</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>            mode</span><span style=color:#61676ccc>: </span><span>DepthOfFieldMode</span><span style=color:#ed9366>::</span><span>Bokeh</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h2 id=solution>Solution</h2><p>This PR updates DepthOfField to use the default value of DepthOfFieldMode.<h2 id=testing>Testing</h2><p>The depth of field example compiles and runs. I adjusted it to use the default mode of DepthOfField and it correctly uses Gaussian now.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a simple but important consistency issue in Bevy’s depth of field implementation. The problem was straightforward: there was a mismatch between the documented default value for <code>DepthOfFieldMode</code> and what was actually used when creating a default <code>DepthOfField</code> component.<p>The <code>DepthOfFieldMode</code> enum had two variants: <code>Bokeh</code> and <code>Gaussian</code>. The <code>Gaussian</code> variant was marked with the <code>#[default]</code> attribute, which meant that <code>DepthOfFieldMode::default()</code> would return <code>DepthOfFieldMode::Gaussian</code>. This was also documented in the code comments stating “This is the default.”<p>However, the <code>Default</code> implementation for the <code>DepthOfField</code> struct was hardcoded to use <code>DepthOfFieldMode::Bokeh</code> instead of respecting the enum’s default. This created an inconsistency where the documentation and the actual behavior didn’t match. Developers relying on the default behavior would get Bokeh mode when they might reasonably expect Gaussian mode based on the enum’s documentation.<p>The solution was simple and elegant: instead of hardcoding <code>DepthOfFieldMode::Bokeh</code> in the <code>DepthOfField::default()</code> implementation, the code now calls <code>DepthOfFieldMode::default()</code>. This ensures that the struct’s default respects the enum’s default, maintaining consistency throughout the codebase.<p>This type of bug is common in large codebases where defaults are defined in multiple places. The fix demonstrates good software engineering practice: when one type’s default depends on another type’s default, it should delegate to that type’s <code>default()</code> method rather than hardcoding a value. This approach ensures that if the underlying default ever changes (for example, if the team decides to make Bokeh the default mode in the future), the <code>DepthOfField</code> struct will automatically pick up that change without requiring a code update.<p>From a testing perspective, the developer verified the fix by adjusting the depth of field example to use the default mode and confirming it correctly used Gaussian. This kind of validation is important even for simple changes to ensure the fix works as intended.<p>The impact of this change is minimal for existing code - any code that explicitly sets the mode won’t be affected, and any code relying on the default will now get the correct Gaussian mode instead of Bokeh. This aligns the implementation with developer expectations and documentation.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[DepthOfField::default] --> B[Uses]
</span><span>    B --> C[DepthOfFieldMode::default]
</span><span>    C --> D[Returns Gaussian]
</span><span>    
</span><span>    E[Enum Definition] --> F[DepthOfFieldMode::Gaussian]
</span><span>    F --> G[Marked with #[default]]
</span><span>    
</span><span>    H[Before Fix] --> I[Hardcoded Bokeh]
</span><span>    J[After Fix] --> K[Delegates to enum default]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File</strong>: <code>crates/bevy_post_process/src/dof/mod.rs</code> (+1/-1)<p>This file contains the depth of field implementation in Bevy’s post-processing system. The change was minimal but important for consistency.<p><strong>Before</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span>Default </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DepthOfField </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>default</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other fields initialized
</span><span>        </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... other fields
</span><span>            mode</span><span style=color:#61676ccc>: </span><span>DepthOfFieldMode</span><span style=color:#ed9366>::</span><span>Bokeh</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p><strong>After</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span>Default </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DepthOfField </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>default</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other fields initialized
</span><span>        </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... other fields
</span><span>            mode</span><span style=color:#61676ccc>: </span><span>DepthOfFieldMode</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The change replaces the hardcoded <code>DepthOfFieldMode::Bokeh</code> with <code>DepthOfFieldMode::default()</code>, which returns <code>DepthOfFieldMode::Gaussian</code> due to the <code>#[default]</code> attribute on the Gaussian variant in the enum definition.<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rust Default Trait Documentation</strong>: Understanding how the <code>Default</code> trait works in Rust is fundamental to this change. The official Rust documentation provides details on implementing and using <code>Default</code>: https://doc.rust-lang.org/std/default/trait.Default.html</p><li><p><strong>Bevy Components and Defaults</strong>: For more context on how Bevy uses components and their default values, the Bevy documentation on components and bundles is helpful: https://bevyengine.org/learn/book/next/programming/ecs/components</p><li><p><strong>Depth of Field in Computer Graphics</strong>: To understand the technical difference between Gaussian and Bokeh depth of field modes, resources on computer graphics post-processing effects would be useful. Gaussian blur is a common approximation, while Bokeh aims to simulate the aesthetic qualities of lens blur.</p><li><p><strong>Rust Attributes</strong>: The <code>#[default]</code> attribute used in the enum is part of Rust’s derive macros. More information can be found in the Rust reference on attributes: https://doc.rust-lang.org/reference/attributes.html</p></ol><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_post_process/src/dof/mod.rs b/crates/bevy_post_process/src/dof/mod.rs
</span><span>index 1197bbf906dc5..e9143f61e55c4 100644
</span><span style=color:#c594c5>--- a/crates/bevy_post_process/src/dof/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_post_process/src/dof/mod.rs
</span><span style=color:#c594c5>@@ -319,7 +319,7 @@ </span><span style=color:#399ee6>impl Default for DepthOfField {
</span><span>             sensor_height: physical_camera_default.sensor_height,
</span><span>             max_circle_of_confusion_diameter: 64.0,
</span><span>             max_depth: f32::INFINITY,
</span><span style=color:#f07171>-            mode: DepthOfFieldMode::Bokeh,
</span><span style=color:#86b300>+            mode: DepthOfFieldMode::default(),
</span><span>         }
</span><span>     }
</span><span> }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22731.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>