<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22962 Reimplement #22722 after it was lost in the parley migration.
        
    </title><meta content="#22962 Reimplement #22722 after it was lost in the parley migration." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-14</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22962-zh-cn-20260214>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Reimplement #22722 after it was lost in the parley migration.<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Reimplement #22722 after it was lost in the parley migration.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22962<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, S-Ready-For-Final-Review, A-Text, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2026-02-14T22:44:33Z<li><strong>Merged</strong>: 2026-02-14T23:40:30Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>This fix was lost in the parley migration (#22879).</ul><h2 id=solution>Solution</h2><ul><li>Do the same thing as #22722.</ul><h2 id=testing>Testing</h2><ul><li>PixelEagle should show the diff. The edges of some characters look nicer!<li>This doesn’t seem to fully fix things, as shuffling the order that glyphs are allocated makes things look different in some cases.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a regression in Bevy’s text rendering system that occurred during the parley migration (#22879). The issue involved texture padding in font atlases, which affects how text characters are rendered, particularly the edges of glyphs.<p>The problem originated from PR #22722, which initially fixed a text rendering issue by increasing the padding in the font atlas builder from 1 to 2 pixels. Padding is critical in texture atlases to prevent texture bleeding - when neighboring glyphs in the atlas affect each other during texture sampling. Without sufficient padding, characters can appear with visual artifacts where edges from adjacent glyphs bleed into each other.<p>During the migration to the parley text layout system, this padding change was inadvertently lost, reverting the padding back to 1. The regression was subtle but noticeable in text rendering quality, particularly with anti-aliased fonts where edge artifacts are more visible.<p>The solution was straightforward: restore the padding value to 2 in the <code>FontAtlas</code> constructor. This one-character change has significant implications for text rendering quality. When glyphs are packed into texture atlases with only 1 pixel of padding, texture filtering operations (like linear filtering or mipmapping) can sample from adjacent glyphs, causing visual artifacts. Increasing the padding to 2 provides a buffer zone that prevents this sampling from reaching neighboring glyphs.<p>However, the PR author noted that this fix doesn’t completely solve all text rendering issues. The order in which glyphs are allocated to the atlas can still affect rendering outcomes. This suggests there may be deeper issues with the atlas packing algorithm or texture coordinate calculations that need further investigation. The padding fix addresses one specific class of rendering artifacts but doesn’t eliminate all potential problems with glyph positioning and texture sampling.<p>From an engineering perspective, this PR demonstrates the importance of regression testing during major system migrations. The parley migration (#22879) was a substantial change to Bevy’s text system, and subtle configuration values like padding parameters can easily be lost during such refactors. The fix also shows how small, targeted changes can have meaningful impacts on visual quality.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[FontAtlas] --> B[DynamicTextureAtlasBuilder]
</span><span>    B --> C[Padding Parameter]
</span><span>    C --> D{Value: 1 or 2}
</span><span>    D --> E[Texture Bleeding Artifacts]
</span><span>    D --> F[Clean Text Edges]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>crates/bevy_text/src/font_atlas.rs</strong> (+1/-1)<p>This file contains the <code>FontAtlas</code> struct responsible for managing texture atlases for font glyphs. The change modifies the padding parameter when creating the <code>DynamicTextureAtlasBuilder</code>.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_text/src/font_atlas.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>FontAtlas </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>(
</span><span>        </span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>        </span><span style=color:#ff8f40>texture</span><span style=color:#61676ccc>:</span><span> Image,
</span><span>        </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderDevice,
</span><span>        </span><span style=color:#ff8f40>render_queue</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderQueue,
</span><span>    ) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>Self</span><span>, TextureAtlasBuilderError> {
</span><span>        </span><span style=color:#fa6e32>let</span><span> texture_atlas </span><span style=color:#ed9366>=
</span><span>            TextureAtlas</span><span style=color:#ed9366>::</span><span>new_empty(texture</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone_weak</span><span>()</span><span style=color:#61676ccc>,</span><span> size</span><span style=color:#61676ccc>,</span><span> render_device</span><span style=color:#61676ccc>,</span><span> render_queue)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            texture_atlas</span><span style=color:#61676ccc>,
</span><span>            glyph_to_atlas_index</span><span style=color:#61676ccc>: </span><span>HashMap</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>            dynamic_texture_atlas_builder</span><span style=color:#61676ccc>: </span><span>DynamicTextureAtlasBuilder</span><span style=color:#ed9366>::</span><span>new(size</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1</span><span>)</span><span style=color:#61676ccc>,
</span><span>            texture</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>FontAtlas </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>(
</span><span>        </span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>        </span><span style=color:#ff8f40>texture</span><span style=color:#61676ccc>:</span><span> Image,
</span><span>        </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderDevice,
</span><span>        </span><span style=color:#ff8f40>render_queue</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderQueue,
</span><span>    ) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>Self</span><span>, TextureAtlasBuilderError> {
</span><span>        </span><span style=color:#fa6e32>let</span><span> texture_atlas </span><span style=color:#ed9366>=
</span><span>            TextureAtlas</span><span style=color:#ed9366>::</span><span>new_empty(texture</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone_weak</span><span>()</span><span style=color:#61676ccc>,</span><span> size</span><span style=color:#61676ccc>,</span><span> render_device</span><span style=color:#61676ccc>,</span><span> render_queue)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            texture_atlas</span><span style=color:#61676ccc>,
</span><span>            glyph_to_atlas_index</span><span style=color:#61676ccc>: </span><span>HashMap</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>            dynamic_texture_atlas_builder</span><span style=color:#61676ccc>: </span><span>DynamicTextureAtlasBuilder</span><span style=color:#ed9366>::</span><span>new(size</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>2</span><span>)</span><span style=color:#61676ccc>,
</span><span>            texture</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The key change is in the <code>DynamicTextureAtlasBuilder::new()</code> call, where the second parameter (padding) changes from <code>1</code> to <code>2</code>. This padding affects how much empty space is inserted between glyphs in the texture atlas, which prevents texture sampling artifacts during rendering.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/libgdx/libgdx/wiki/Distance-field-fonts#padding target=_blank>Texture Atlas Padding and Bleeding</a> - Explanation of why padding is necessary in texture atlases<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_text/latest/bevy_text/ target=_blank>Bevy Text Rendering Documentation</a> - Official Bevy text rendering API documentation<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22879 target=_blank>Parley Text Layout System</a> - The migration that introduced this regression<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22722 target=_blank>Original Fix #22722</a> - The initial fix that was lost during migration</ul><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_text/src/font_atlas.rs b/crates/bevy_text/src/font_atlas.rs
</span><span>index 69db4cbac8a93..3cf9cc94b70f2 100644
</span><span>--- a/crates/bevy_text/src/font_atlas.rs
</span><span>+++ b/crates/bevy_text/src/font_atlas.rs
</span><span>@@ -61,7 +61,7 @@ impl FontAtlas {
</span><span>         Self {
</span><span>             texture_atlas,
</span><span>             glyph_to_atlas_index: HashMap::default(),
</span><span>-            dynamic_texture_atlas_builder: DynamicTextureAtlasBuilder::new(size, 1),
</span><span>+            dynamic_texture_atlas_builder: DynamicTextureAtlasBuilder::new(size, 2),
</span><span>             texture,
</span><span>         }
</span><span>     }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22962.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>