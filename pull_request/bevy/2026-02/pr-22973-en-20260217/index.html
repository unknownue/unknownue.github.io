<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22973 Add bevy_city
        
    </title><meta content="#22973 Add bevy_city" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22973-zh-cn-20260217>中文</a></div></div><div class=pr-content><h1 id=title-add-bevy-city>Title: Add bevy_city</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add bevy_city<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22973<li><strong>Author</strong>: IceSentry<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Examples, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-02-16T01:23:22Z<li><strong>Merged</strong>: 2026-02-17T02:49:51Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The PR description is already in English, so it’s included exactly as-is:<h1 id=objective>Objective</h1><ul><li>Add a test scene that pushes a lot of rendering features while also pushing the ECS with a lot of entity updates</ul><h2 id=solution>Solution</h2><ul><li>Add a procedurally generated city with a lot of different assets. <ul><li>Spawn cars that move on every frame, eventually this will have a full traffic simulation that should stress the ECS</ul></ul><h2 id=testing>Testing</h2><ul><li>The example runs</ul><hr><h2 id=showcase>Showcase</h2><p><img alt=bevy_city_YncoqtzDuL src=https://github.com/user-attachments/assets/196945f2-3425-400a-9511-c366a246fd35><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR introduces a new example called <code>bevy_city</code> to the Bevy game engine. The primary objective is to create a stress test scene that pushes both rendering capabilities and the Entity Component System (ECS) performance. The example procedurally generates a city with various assets including roads, buildings, cars, and vegetation, creating a scene with a high entity count that can be used for benchmarking and testing.<p>The problem the developer is addressing is the need for a comprehensive test scene that can evaluate Bevy’s performance under realistic conditions. Existing examples might test individual features, but a complex city scene with many moving parts provides a more holistic stress test. This is important for identifying performance bottlenecks, testing rendering optimizations, and ensuring the ECS can handle large numbers of entities with frequent updates.<p>The solution approach involves creating a procedurally generated city using assets from Kenney’s asset packs. The city is laid out in a grid pattern with different density zones (forest, low-density, medium-density, high-density) determined by noise functions. Cars are spawned on roads and move continuously, providing the ECS stress through frequent position updates. The implementation is structured into several modules: asset management, city generation, main application setup, and a settings UI.<p>Looking at the implementation, the code follows a clean separation of concerns. The <code>assets.rs</code> module handles loading all 3D models and materials from remote URLs, organizing them into a <code>CityAssets</code> resource for easy access. The <code>generate_city.rs</code> module contains the procedural generation logic, using noise functions to create varied city zones and carefully positioning each entity relative to a grid. The <code>main.rs</code> file sets up the Bevy app with appropriate plugins and systems, including a free camera, atmospheric effects, and the car simulation system. The <code>settings.rs</code> module provides a UI panel to toggle features like car simulation, shadow maps, and wireframe rendering.<p>One technical insight is the use of noise functions for procedural generation. The <code>OpenSimplex</code> noise from the <code>noise</code> crate determines the density of each city block, creating natural-feeling transitions between different zone types. The car movement system is efficiently implemented using parent-child relationships: roads are parent entities with car entities as children, and the car simulation calculates positions based on travel distance along the road segment.<p>The impact of this PR is significant for the Bevy ecosystem. It provides developers with a ready-made complex scene for performance testing and benchmarking. The example showcases multiple rendering features simultaneously: HDR rendering, atmospheric scattering, bloom, temporal anti-aliasing, contact shadows, and wireframe rendering. The moving cars stress-test the ECS’s ability to handle frequent component updates. Additionally, the settings UI demonstrates how to create interactive controls for toggling features at runtime.<p>From an architectural perspective, this example demonstrates several best practices for Bevy development: using resources for shared assets, organizing systems into modules, implementing parent-child hierarchies for spatial relationships, and creating reusable UI components. The code also shows how to handle external assets from URLs and how to structure a large scene with many procedurally generated entities.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[main.rs - App Setup] --> B[assets.rs - Asset Loading]
</span><span>    A --> C[generate_city.rs - Procedural Generation]
</span><span>    A --> D[settings.rs - UI Controls]
</span><span>    B --> E[CityAssets Resource]
</span><span>    C --> F[CityRoot Entity]
</span><span>    C --> G[Road Entities]
</span><span>    C --> H[Car Entities]
</span><span>    C --> I[Building Entities]
</span><span>    C --> J[Vegetation Entities]
</span><span>    D --> K[Settings UI Panel]
</span><span>    K --> L[Toggle Car Simulation]
</span><span>    K --> M[Toggle Shadows]
</span><span>    K --> N[Toggle Wireframe]
</span><span>    G --> H
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-large-scenes-bevy-city-src-main-rs-158-0><code>examples/large_scenes/bevy_city/src/main.rs</code> (+158/-0)</h3><p>This is the entry point that sets up the Bevy application with all necessary plugins and systems.<p>Key code snippets:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    </span><span style=color:#fa6e32>let</span><span> args</span><span style=color:#61676ccc>:</span><span> Args </span><span style=color:#ed9366>= </span><span>argh</span><span style=color:#ed9366>::</span><span>from_env()</span><span style=color:#61676ccc>;
</span><span>
</span><span>    App</span><span style=color:#ed9366>::</span><span>new()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>((
</span><span>            DefaultPlugins</span><span style=color:#ed9366>.</span><span style=color:#f07171>set</span><span>(WindowPlugin {
</span><span>                primary_window</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(Window {
</span><span>                    title</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"bevy_city"</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>,
</span><span>                    resolution</span><span style=color:#61676ccc>: </span><span>WindowResolution</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>1920</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1080</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_scale_factor_override</span><span>(</span><span style=color:#ff8f40>1.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>                    present_mode</span><span style=color:#61676ccc>: </span><span>PresentMode</span><span style=color:#ed9366>::</span><span>AutoNoVsync</span><span style=color:#61676ccc>,
</span><span>                    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>                })</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>            })</span><span style=color:#61676ccc>,
</span><span>            FreeCameraPlugin</span><span style=color:#61676ccc>,
</span><span>            FeathersPlugins</span><span style=color:#61676ccc>,
</span><span>            WireframePlugin</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>        ))
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... more setup
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>simulate_cars</span><span>(
</span><span>    </span><span style=color:#ff8f40>settings</span><span style=color:#61676ccc>: </span><span>Res&LTSettings>,
</span><span>    </span><span style=color:#ff8f40>roads</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span>Road, </span><span style=color:#ed9366>&</span><span>Transform, </span><span style=color:#ed9366>&</span><span>Children), Without&LTCar>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>cars</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Car, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform), Without&LTRoad>>,
</span><span>    </span><span style=color:#ff8f40>time</span><span style=color:#61676ccc>: </span><span>Res&LTTime>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>if </span><span style=color:#ed9366>!</span><span>settings</span><span style=color:#ed9366>.</span><span>simulate_cars {
</span><span>        </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#fa6e32>let</span><span> speed </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>1.5</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>for </span><span>(road</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>_</span><span style=color:#61676ccc>,</span><span> children) </span><span style=color:#ed9366>in &</span><span>roads {
</span><span>        </span><span style=color:#fa6e32>for</span><span> child </span><span style=color:#ed9366>in</span><span> children {
</span><span>            </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((</span><span style=color:#fa6e32>mut</span><span> car</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut</span><span> car_transform)) </span><span style=color:#ed9366>=</span><span> cars</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>*</span><span>child) </span><span style=color:#fa6e32>else </span><span>{
</span><span>                </span><span style=color:#fa6e32>continue</span><span style=color:#61676ccc>;
</span><span>            }</span><span style=color:#61676ccc>;
</span><span>
</span><span>            car</span><span style=color:#ed9366>.</span><span>distance_traveled </span><span style=color:#ed9366>+=</span><span> speed </span><span style=color:#ed9366>*</span><span> time</span><span style=color:#ed9366>.</span><span style=color:#f07171>delta_secs</span><span>()</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... position calculation
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The main file establishes the application structure, sets up a 3D camera with advanced rendering features (HDR, atmosphere, bloom), and implements the car simulation system that moves cars along their parent roads.<h3 id=examples-large-scenes-bevy-city-src-generate-city-rs-351-0><code>examples/large_scenes/bevy_city/src/generate_city.rs</code> (+351/-0)</h3><p>This module contains the procedural generation logic for creating the city layout.<p>Key code snippets:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>spawn_city</span><span>(</span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Commands, </span><span style=color:#ff8f40>assets</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>CityAssets, </span><span style=color:#ff8f40>seed</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u64</span><span>, </span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> rng </span><span style=color:#ed9366>= </span><span>SmallRng</span><span style=color:#ed9366>::</span><span>seed_from_u64(seed)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> noise </span><span style=color:#ed9366>= </span><span>OpenSimplex</span><span style=color:#ed9366>::</span><span>new(rng</span><span style=color:#ed9366>.</span><span style=color:#f07171>random</span><span>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> noise_scale </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0.025</span><span style=color:#61676ccc>;
</span><span>
</span><span>    commands
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((CityRoot</span><span style=color:#61676ccc>, </span><span>Transform</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>, </span><span>Visibility</span><span style=color:#ed9366>::</span><span>default()))
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_children</span><span>(|</span><span style=color:#ff8f40>commands</span><span>| {
</span><span>            </span><span style=color:#fa6e32>let</span><span> half_size </span><span style=color:#ed9366>=</span><span> size </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>i32 </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>for</span><span> x </span><span style=color:#ed9366>in -</span><span>half_size</span><span style=color:#ed9366>..</span><span>half_size {
</span><span>                </span><span style=color:#fa6e32>for</span><span> z </span><span style=color:#ed9366>in -</span><span>half_size</span><span style=color:#ed9366>..</span><span>half_size {
</span><span>                    </span><span style=color:#abb0b6;font-style:italic>// scale the position to match the city block size
</span><span>                    </span><span style=color:#fa6e32>let</span><span> x </span><span style=color:#ed9366>=</span><span> x </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>5.5</span><span style=color:#61676ccc>;
</span><span>                    </span><span style=color:#fa6e32>let</span><span> z </span><span style=color:#ed9366>=</span><span> z </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>4.0</span><span style=color:#61676ccc>;
</span><span>                    </span><span style=color:#fa6e32>let</span><span> offset </span><span style=color:#ed9366>= </span><span>Vec3</span><span style=color:#ed9366>::</span><span>new(x</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,</span><span> z)</span><span style=color:#61676ccc>;
</span><span>
</span><span>                    </span><span style=color:#f07171>spawn_roads_and_cars</span><span>(commands</span><span style=color:#61676ccc>,</span><span> assets</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> rng</span><span style=color:#61676ccc>,</span><span> offset)</span><span style=color:#61676ccc>;
</span><span>
</span><span>                    </span><span style=color:#fa6e32>let</span><span> density </span><span style=color:#ed9366>=</span><span> noise</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>([
</span><span>                        offset</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f64 </span><span style=color:#ed9366>*</span><span> noise_scale</span><span style=color:#61676ccc>,
</span><span>                        offset</span><span style=color:#ed9366>.</span><span>z </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f64 </span><span style=color:#ed9366>*</span><span> noise_scale</span><span style=color:#61676ccc>,
</span><span>                        </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,
</span><span>                    ]) </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>0.5
</span><span>                        </span><span style=color:#ed9366>+ </span><span style=color:#ff8f40>0.5</span><span style=color:#61676ccc>;
</span><span>
</span><span>                    </span><span style=color:#abb0b6;font-style:italic>// Determine zone type based on density
</span><span>                    </span><span style=color:#fa6e32>let</span><span> forest </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0.45</span><span style=color:#61676ccc>;
</span><span>                    </span><span style=color:#fa6e32>let</span><span> low_density </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0.6</span><span style=color:#61676ccc>;
</span><span>                    </span><span style=color:#fa6e32>let</span><span> medium_density </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0.7</span><span style=color:#61676ccc>;
</span><span>
</span><span>                    </span><span style=color:#abb0b6;font-style:italic>// ... spawn appropriate zone
</span><span>                }
</span><span>            }
</span><span>        })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The generation system creates a grid of city blocks, uses noise to determine zone density for each block, and spawns appropriate content (roads, buildings, vegetation) based on the density value.<h3 id=examples-large-scenes-bevy-city-src-assets-rs-233-0><code>examples/large_scenes/bevy_city/src/assets.rs</code> (+233/-0)</h3><p>This module handles loading and organizing all 3D assets from remote URLs.<p>Key code snippets:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CityAssets </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>cars</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTHandle&LTScene>>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>crossroad</span><span style=color:#61676ccc>: </span><span>Handle&LTScene>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>road_straight</span><span style=color:#61676ccc>: </span><span>Handle&LTScene>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>high_density</span><span style=color:#61676ccc>:</span><span> Buildings,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>medium_density</span><span style=color:#61676ccc>:</span><span> Buildings,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>low_density</span><span style=color:#61676ccc>:</span><span> Buildings,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>ground_tile</span><span style=color:#61676ccc>: </span><span>(
</span><span>        Handle&LTMesh>,
</span><span>        Handle&LTStandardMaterial>,
</span><span>        Handle&LTStandardMaterial>,
</span><span>    ),
</span><span>    </span><span style=color:#fa6e32>pub </span><span>tree_small</span><span style=color:#61676ccc>: </span><span>Handle&LTScene>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>tree_large</span><span style=color:#61676ccc>: </span><span>Handle&LTScene>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>path_stones_long</span><span style=color:#61676ccc>: </span><span>Handle&LTScene>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>fence</span><span style=color:#61676ccc>: </span><span>Handle&LTScene>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load_assets</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>materials</span><span style=color:#61676ccc>: </span><span>ResMut&LTAssets&LTStandardMaterial>>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> base_url </span><span style=color:#ed9366>= </span><span style=color:#86b300>"https://github.com/bevyengine/bevy_asset_files/raw/main/kenney"</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let</span><span> cars </span><span style=color:#ed9366>= </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// TODO generate color variations
</span><span>        [
</span><span>            </span><span style=color:#86b300>"hatchback-sports"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"suv"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"suv-luxury"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"sedan"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"sedan-sports"</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#86b300>"truck"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"truck-flat"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"van"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"delivery"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"delivery-flat"</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#86b300>"taxi"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"garbage-truck"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"ambulance"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"police"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"firetruck"</span><span style=color:#61676ccc>,
</span><span>        ]
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>t</span><span>| {
</span><span>            asset_server
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(GltfAssetLabel</span><span style=color:#ed9366>::</span><span>Scene(</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>from_asset</span><span>(</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{base_url}</span><span style=color:#86b300>/car-kit/</span><span style=color:#ff8f40>{t}</span><span style=color:#86b300>.glb"</span><span>)))
</span><span>        })
</span><span>        </span><span style=color:#ed9366>.</span><span>collect</span><span style=color:#ed9366>::</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#ed9366>_</span><span>>>()
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... load other assets
</span><span>    
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(CityAssets {
</span><span>        cars</span><span style=color:#61676ccc>,
</span><span>        crossroad</span><span style=color:#61676ccc>,
</span><span>        road_straight</span><span style=color:#61676ccc>,
</span><span>        high_density</span><span style=color:#61676ccc>,
</span><span>        medium_density</span><span style=color:#61676ccc>,
</span><span>        low_density</span><span style=color:#61676ccc>,
</span><span>        ground_tile</span><span style=color:#61676ccc>,
</span><span>        tree_small</span><span style=color:#61676ccc>,
</span><span>        tree_large</span><span style=color:#61676ccc>,
</span><span>        path_stones_long</span><span style=color:#61676ccc>,
</span><span>        fence</span><span style=color:#61676ccc>,
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The asset system loads models from Kenney’s asset packs hosted on GitHub, creates material variations for buildings, and organizes everything into a resource for easy access throughout the application.<h3 id=examples-large-scenes-bevy-city-src-settings-rs-148-0><code>examples/large_scenes/bevy_city/src/settings.rs</code> (+148/-0)</h3><p>This module implements a UI settings panel with interactive controls.<p>Key code snippets:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Settings </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>simulate_cars</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>shadow_maps_enabled</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>contact_shadows_enabled</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>wireframe_enabled</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>setup_settings_ui</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands) {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Node {
</span><span>            position_type</span><span style=color:#61676ccc>: </span><span>PositionType</span><span style=color:#ed9366>::</span><span>Absolute</span><span style=color:#61676ccc>,
</span><span>            top</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>10.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>            right</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>10.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>            padding</span><span style=color:#61676ccc>: </span><span>UiRect</span><span style=color:#ed9366>::</span><span>all(Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>8.0</span><span>))</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... UI setup with checkboxes and buttons
</span><span>        </span><span style=color:#f07171>children!</span><span>[
</span><span>            (Text(</span><span style=color:#86b300>"Settings"</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_owned</span><span>()))</span><span style=color:#61676ccc>,
</span><span>            (
</span><span>                </span><span style=color:#f07171>checkbox</span><span>(Checked</span><span style=color:#61676ccc>,</span><span> Spawn((Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>"Simulate Cars"</span><span>)</span><span style=color:#61676ccc>,</span><span> ThemedText)))</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#f07171>observe</span><span>(checkbox_self_update)</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#f07171>observe</span><span>(
</span><span>                    |</span><span style=color:#ff8f40>change</span><span style=color:#61676ccc>: </span><span>On&LTValueChange<</span><span style=color:#fa6e32>bool</span><span>>></span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>settings</span><span style=color:#61676ccc>: </span><span>ResMut&LTSettings>| {
</span><span>                        settings</span><span style=color:#ed9366>.</span><span>simulate_cars </span><span style=color:#ed9366>=</span><span> change</span><span style=color:#ed9366>.</span><span>value</span><span style=color:#61676ccc>;
</span><span>                    }
</span><span>                )
</span><span>            )</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... more checkboxes for shadow maps, contact shadows, wireframe
</span><span>            (
</span><span>                </span><span style=color:#f07171>button</span><span>(
</span><span>                    ButtonProps</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>                    ()</span><span style=color:#61676ccc>,
</span><span>                    Spawn((Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>"Regenerate City"</span><span>)</span><span style=color:#61676ccc>,</span><span> ThemedText))
</span><span>                )</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#f07171>observe</span><span>(
</span><span>                    |</span><span style=color:#ff8f40>_activate</span><span style=color:#61676ccc>: </span><span>On&LTActivate></span><span style=color:#61676ccc>,
</span><span>                     </span><span style=color:#fa6e32>mut</span><span> commands</span><span style=color:#61676ccc>:</span><span> Commands</span><span style=color:#61676ccc>,
</span><span>                     city_root</span><span style=color:#61676ccc>: </span><span>Single&LTEntity, With&LTCityRoot>></span><span style=color:#61676ccc>,
</span><span>                     assets</span><span style=color:#61676ccc>: </span><span>Res&LTCityAssets></span><span style=color:#ed9366>| </span><span>{
</span><span>                        commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(</span><span style=color:#ed9366>*</span><span>city_root)</span><span style=color:#ed9366>.</span><span style=color:#f07171>despawn</span><span>()</span><span style=color:#61676ccc>;
</span><span>                        
</span><span>                        </span><span style=color:#fa6e32>let mut</span><span> rng </span><span style=color:#ed9366>= </span><span>rand</span><span style=color:#ed9366>::</span><span>rng()</span><span style=color:#61676ccc>;
</span><span>                        </span><span style=color:#fa6e32>let</span><span> seed </span><span style=color:#ed9366>=</span><span> rng</span><span style=color:#ed9366>.</span><span>random</span><span style=color:#ed9366>::</span><span><</span><span style=color:#fa6e32>u64</span><span>>()</span><span style=color:#61676ccc>;
</span><span>                        </span><span style=color:#f07171>println!</span><span>(</span><span style=color:#86b300>"new seed: </span><span style=color:#ff8f40>{seed}</span><span style=color:#86b300>"</span><span>)</span><span style=color:#61676ccc>;
</span><span>                        </span><span style=color:#f07171>spawn_city</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> commands</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>assets</span><span style=color:#61676ccc>,</span><span> seed</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>32</span><span>)</span><span style=color:#61676ccc>;
</span><span>                    }
</span><span>                )
</span><span>            )</span><span style=color:#61676ccc>,
</span><span>        ]
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The settings UI demonstrates Bevy’s UI system (Feathers) with interactive controls that modify runtime settings and even trigger a complete regeneration of the city with a new random seed.<h3 id=examples-large-scenes-bevy-city-cargo-toml-17-0><code>examples/large_scenes/bevy_city/Cargo.toml</code> (+17/-0)</h3><p>The Cargo.toml specifies dependencies including Bevy with specific features enabled:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>bevy </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../../../"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"https"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"free_camera"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"experimental_bevy_feathers"</span><span style=color:#61676ccc>,
</span><span>] }
</span><span>
</span><span style=color:#399ee6>argh </span><span>= </span><span style=color:#86b300>"0.1"
</span><span style=color:#399ee6>noise </span><span>= </span><span style=color:#86b300>"0.9.0"
</span><span style=color:#399ee6>rand </span><span>= </span><span style=color:#86b300>"0.10.0"
</span></code></pre><p>This configuration shows which Bevy features are required for this example, particularly the HTTP asset loading capability and the experimental UI system.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Engine Documentation</strong>: https://bevyengine.org/learn/<li><strong>Kenney Asset Packs</strong>: https://kenney.nl/assets - The source of 3D models used in this example<li><strong>Procedural Generation with Noise</strong>: The <code>noise</code> crate documentation (https://docs.rs/noise) for understanding the OpenSimplex noise algorithm<li><strong>ECS Pattern</strong>: The Entity Component System architecture pattern used throughout Bevy<li><strong>Bevy Feathers UI</strong>: The experimental UI system used for the settings panel (currently in development)<li><strong>Traffic Simulation Inspiration</strong>: The example was inspired by https://flecs-hub.github.io/traffic/etc/ which demonstrates a traffic simulation using the FLECS ECS</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/Cargo.toml b/Cargo.toml
</span><span>index d28f6fb2fbd31..879b296af38cf 100644
</span><span>--- a/Cargo.toml
</span><span>+++ b/Cargo.toml
</span><span>@@ -33,6 +33,7 @@ members = [
</span><span>   # Examples of large bevy scenes.
</span><span>   "examples/large_scenes/bistro",
</span><span>   "examples/large_scenes/caldera_hotel",
</span><span>+  "examples/large_scenes/bevy_city",
</span><span>   # Mipmap generator for testing large bevy scenes with mips and texture compression.
</span><span>   "examples/large_scenes/mipmap_generator",
</span><span>   # Benchmarks
</span><span>diff --git a/examples/large_scenes/bevy_city/Cargo.toml b/examples/large_scenes/bevy_city/Cargo.toml
</span><span>new file mode 100644
</span><span>index 0000000000000..efdc1155e969e
</span><span>--- /dev/null
</span><span>+++ b/examples/large_scenes/bevy_city/Cargo.toml
</span><span>@@ -0,0 +1,17 @@
</span><span>+[package]
</span><span>+name = "bevy_city"
</span><span>+version = "0.1.0"
</span><span>+edition = "2024"
</span><span>+publish = false
</span><span>+license = "MIT OR Apache-2.0"
</span><span>+
</span><span>+[dependencies]
</span><span>+bevy = { path = "../../../", features = [
</span><span>+  "https",
</span><span>+  "free_camera",
</span><span>+  "experimental_bevy_feathers",
</span><span>+] }
</span><span>+
</span><span>+argh = "0.1"
</span><span>+noise = "0.9.0"
</span><span>+rand = "0.10.0"
</span><span>diff --git a/examples/large_scenes/bevy_city/README.md b/examples/large_scenes/bevy_city/README.md
</span><span>new file mode 100644
</span><span>index 0000000000000..4b1d494d1ed54
</span><span>--- /dev/null
</span><span>+++ b/examples/large_scenes/bevy_city/README.md
</span><span>@@ -0,0 +1,6 @@
</span><span>+# bevy_city
</span><span>+
</span><span>+A procedurally generated city using assets from [kenney](https://kenney.nl)
</span><span>+
</span><span>+This project was inspired by &LThttps://flecs-hub.github.io/traffic/etc/>.
</span><span>+Currently it doesn't do any traffic simulation but the goal is to have a similar simulation but using bevy_ecs.
</span><span>diff --git a/examples/large_scenes/bevy_city/src/assets.rs b/examples/large_scenes/bevy_city/src/assets.rs
</span><span>new file mode 100644
</span><span>index 0000000000000..1db9a7bb78f91
</span><span>--- /dev/null
</span><span>+++ b/examples/large_scenes/bevy_city/src/assets.rs
</span><span>@@ -0,0 +1,233 @@
</span><span>+use bevy::{color::palettes::css::WHITE, prelude::*};
</span><span>+use rand::RngExt;
</span><span>+
</span><span>+#[derive(Resource)]
</span><span>+pub struct CityAssets {
</span><span>+    pub cars: Vec&LTHandle&LTScene>>,
</span><span>+    pub crossroad: Handle&LTScene>,
</span><span>+    pub road_straight: Handle&LTScene>,
</span><span>+    pub high_density: Buildings,
</span><span>+    pub medium_density: Buildings,
</span><span>+    pub low_density: Buildings,
</span><span>+    pub ground_tile: (
</span><span>+        Handle&LTMesh>,
</span><span>+        Handle&LTStandardMaterial>,
</span><span>+        Handle&LTStandardMaterial>,
</span><span>+    ),
</span><span>+    pub tree_small: Handle&LTScene>,
</span><span>+    pub tree_large: Handle&LTScene>,
</span><span>+    pub path_stones_long: Handle&LTScene>,
</span><span>+    pub fence: Handle&LTScene>,
</span><span>+}
</span><span>+
</span><span>+impl CityAssets {
</span><span>+    pub fn get_random_car&LTR: RngExt>(&self, rng: &mut R) -> Handle&LTScene> {
</span><span>+        self.cars[rng.random_range(0..self.cars.len())].clone()
</span><span>+    }
</span><span>+}
</span><span>+
</span><span>+pub struct Buildings {
</span><span>+    meshes: Vec&LTHandle&LTMesh>>,
</span><span>+    materials: Vec&LTHandle&LTStandardMaterial>>,
</span><span>+}
</span><span>+
</span><span>+impl Buildings {
</span><span>+    pub fn get_random_building&LTR: RngExt>(
</span><span>+        &self,
</span><span>+        rng: &mut R,
</span><span>+    ) -> (Mesh3d, MeshMaterial3d&LTStandardMaterial>) {
</span><span>+        let mesh = self.meshes[rng.random_range(0..self.meshes.len())].clone();
</span><span>+        let material = self.materials[rng.random_range(0..self.materials.len())].clone();
</span><span>+        (Mesh3d(mesh), MeshMaterial3d(material))
</span><span>+    }
</span><span>+}
</span><span>+
</span><span>+pub fn load_assets(
</span><span>+    mut commands: Commands,
</span><span>+    asset_server: Res&LTAssetServer>,
</span><span>+    mut materials: ResMut&LTAssets&LTStandardMaterial>>,
</span><span>+) {
</span><span>+    let base_url = "https://github.com/bevyengine/bevy_asset_files/raw/main/kenney";
</span><span>+
</span><span>+    let cars = {
</span><span>+        // TODO generate color variations
</span><span>+        [
</span><span>+            "hatchback-sports",
</span><span>+            "suv",
</span><span>+            "suv-luxury",
</span><span>+            "sedan",
</span><span>+            "sedan-sports",
</span><span>+            "truck",
</span><span>+            "truck-flat",
</span><span>+            "van",
</span><span>+            "delivery",
</span><span>+            "delivery-flat",
</span><span>+            "taxi",
</span><span>+            "garbage-truck",
</span><span>+            "ambulance",
</span><span>+            "police",
</span><span>+            "firetruck",
</span><span>+        ]
</span><span>+        .iter()
</span><span>+        .map(|t| {
</span><span>+            asset_server
</span><span>+                .load(GltfAssetLabel::Scene(0).from_asset(format!("{base_url}/car-kit/{t}.glb")))
</span><span>+        })
</span><span>+        .collect::&LTVec<_>>()
</span><span>+    };
</span><span>+
</span><span>+    let crossroad = asset_server.load(
</span><span>+        GltfAssetLabel::Scene(0)
</span><span>+            .from_asset(format!("{base_url}/city-kit-roads/road-crossroad-path.glb")),
</span><span>+    );
</span><span>+    let road_straight = asset_server.load(
</span><span>+        GltfAssetLabel::Scene(0).from_asset(format!("{base_url}/city-kit-roads/road-straight.glb")),
</span><span>+    );
</span><span>+
</span><span>+    let high_density = {
</span><span>+        let materials = ["colormap", "variation-a", "variation-b"]
</span><span>+            .iter()
</span><span>+            .map(|variation| {
</span><span>+                materials.add(StandardMaterial {
</span><span>+                    base_color_texture: Some(asset_server.load(format!(
</span><span>+                        "{base_url}/city-kit-commercial/Textures/{variation}.png"
</span><span>+                    ))),
</span><span>+                    ..Default::default()
</span><span>+                })
</span><span>+            })
</span><span>+            .collect::&LTVec<_>>();
</span><span>+
</span><span>+        let mut meshes = ["a", "b", "c", "d", "e"]
</span><span>+            .iter()
</span><span>+            .map(|t| {
</span><span>+                asset_server.load(
</span><span>+                    GltfAssetLabel::Primitive {
</span><span>+                        mesh: 0,
</span><span>+                        primitive: 0,
</span><span>+                    }
</span><span>+                    .from_asset(format!(
</span><span>+                        "{base_url}/city-kit-commercial/building-skyscraper-{t}.glb"
</span><span>+                    )),
</span><span>+                )
</span><span>+            })
</span><span>+            .collect::&LTVec<_>>();
</span><span>+        meshes.extend(["m", "l"].iter().map(|t| {
</span><span>+            asset_server.load(
</span><span>+                GltfAssetLabel::Primitive {
</span><span>+                    mesh: 0,
</span><span>+                    primitive: 0,
</span><span>+                }
</span><span>+                .from_asset(format!("{base_url}/city-kit-commercial/building-{t}.glb")),
</span><span>+            )
</span><span>+        }));
</span><span>+
</span><span>+        Buildings { meshes, materials }
</span><span>+    };
</span><span>+
</span><span>+    let medium_density = {
</span><span>+        let materials = ["colormap", "variation-a", "variation-b"]
</span><span>+            .iter()
</span><span>+            .map(|variation| {
</span><span>+                materials.add(StandardMaterial {
</span><span>+                    base_color_texture: Some(asset_server.load(format!(
</span><span>+                        "{base_url}/city-kit-commercial/Textures/{variation}.png"
</span><span>+                    ))),
</span><span>+                    ..Default::default()
</span><span>+                })
</span><span>+            })
</span><span>+            .collect::&LTVec<_>>();
</span><span>+        let meshes = ["a", "b", "c", "d", "f", "g", "h"]
</span><span>+            .iter()
</span><span>+            .map(|t| {
</span><span>+                asset_server.load(
</span><span>+                    GltfAssetLabel::Primitive {
</span><span>+                        mesh: 0,
</span><span>+                        primitive: 0,
</span><span>+                    }
</span><span>+                    .from_asset(format!("{base_url}/city-kit-commercial/building-{t}.glb")),
</span><span>+                )
</span><span>+            })
</span><span>+            .collect::&LTVec<_>>();
</span><span>+
</span><span>+        Buildings { meshes, materials }
</span><span>+    };
</span><span>+    let low_density = {
</span><span>+        let materials = ["colormap", "variation-a", "variation-b", "variation-c"]
</span><span>+            .iter()
</span><span>+            .map(|variation| {
</span><span>+                materials.add(StandardMaterial {
</span><span>+                    base_color_texture: Some(asset_server.load(format!(
</span><span>+                        "{base_url}/city-kit-suburban/Textures/{variation}.png"
</span><span>+                    ))),
</span><span>+                    ..Default::default()
</span><span>+                })
</span><span>+            })
</span><span>+            .collect::&LTVec<_>>();
</span><span>+        let meshes = ["b", "c", "d", "e", "f", "g", "h", "i", "k", "l", "o", "u"]
</span><span>+            .iter()
</span><span>+            .map(|t| {
</span><span>+                asset_server.load(
</span><span>+                    GltfAssetLabel::Primitive {
</span><span>+                        mesh: 0,
</span><span>+                        primitive: 0,
</span><span>+                    }
</span><span>+                    .from_asset(format!(
</span><span>+                        "{base_url}/city-kit-suburban/building-type-{t}.glb"
</span><span>+                    )),
</span><span>+                )
</span><span>+            })
</span><span>+            .collect::&LTVec<_>>();
</span><span>+
</span><span>+        Buildings { meshes, materials }
</span><span>+    };
</span><span>+
</span><span>+    let ground_tile = {
</span><span>+        let mesh = asset_server.load(
</span><span>+            GltfAssetLabel::Primitive {
</span><span>+                mesh: 0,
</span><span>+                primitive: 0,
</span><span>+            }
</span><span>+            .from_asset(format!("{base_url}/city-kit-roads/tile-low.glb")),
</span><span>+        );
</span><span>+        // TODO use this once https://github.com/bevyengine/bevy/pull/22943 is merged
</span><span>+        // let default_material: Handle&LTStandardMaterial> = asset_server.load(format!(
</span><span>+        //     "ground_tile/tile-low.glb#{}/std",
</span><span>+        //     GltfAssetLabel::DefaultMaterial
</span><span>+        // ));
</span><span>+        let white_material = materials.add(StandardMaterial::from_color(WHITE));
</span><span>+        let grass_material =
</span><span>+            materials.add(StandardMaterial::from_color(Color::srgb_u8(97, 203, 139)));
</span><span>+
</span><span>+        (mesh, white_material, grass_material)
</span><span>+    };
</span><span>+
</span><span>+    let tree_small: Handle&LTScene> = asset_server.load(
</span><span>+        GltfAssetLabel::Scene(0).from_asset(format!("{base_url}/city-kit-suburban/tree-small.glb")),
</span><span>+    );
</span><span>+    let tree_large: Handle&LTScene> = asset_server.load(
</span><span>+        GltfAssetLabel::Scene(0).from_asset(format!("{base_url}/city-kit-suburban/tree-large.glb")),
</span><span>+    );
</span><span>+
</span><span>+    let path_stones_long: Handle&LTScene> = asset_server.load(
</span><span>+        GltfAssetLabel::Scene(0)
</span><span>+            .from_asset(format!("{base_url}/city-kit-suburban/path-stones-long.glb")),
</span><span>+    );
</span><span>+
</span><span>+    let fence: Handle&LTScene> = asset_server.load(
</span><span>+        GltfAssetLabel::Scene(0).from_asset(format!("{base_url}/city-kit-suburban/fence.glb")),
</span><span>+    );
</span><span>+
</span><span>+    commands.insert_resource(CityAssets {
</span><span>+        cars,
</span><span>+        crossroad,
</span><span>+        road_straight,
</span><span>+        high_density,
</span><span>+        medium_density,
</span><span>+        low_density,
</span><span>+        ground_tile,
</span><span>+        tree_small,
</span><span>+        tree_large,
</span><span>+        path_stones_long,
</span><span>+        fence,
</span><span>+    });
</span><span>+}
</span><span>diff --git a/examples/large_scenes/bevy_city/src/generate_city.rs b/examples/large_scenes/bevy_city/src/generate_city.rs
</span><span>new file mode 100644
</span><span>index 0000000000000..46aa5594e4cc8
</span><span>--- /dev/null
</span><span>+++ b/examples/large_scenes/bevy_city/src/generate_city.rs
</span><span>@@ -0,0 +1,351 @@
</span><span>+use bevy::prelude::*;
</span><span>+use noise::{NoiseFn, OpenSimplex};
</span><span>+use rand::{rngs::SmallRng, RngExt, SeedableRng};
</span><span>+
</span><span>+use crate::{assets::CityAssets, Car, Road};
</span><span>+
</span><span>+#[derive(Component)]
</span><span>+pub struct CityRoot;
</span><span>+
</span><span>+/// Spawns a grid of city blocks
</span><span>+///
</span><span>+/// For simplicity we spawn the roads and buildings in this pattern
</span><span>+///
</span><span>+/// X-------
</span><span>+/// | B B B
</span><span>+/// | B B B
</span><span>+///
</span><span>+/// X = crossroad, B = buildings
</span><span>+///
</span><span>+/// This way we can easily tile each city block
</span><span>+/// Each city block is 5.5 units x 4.0 units.
</span><span>+///
</span><span>+/// Every asset gets spawned relative to the crossroad position
</span><span>+pub fn spawn_city(commands: &mut Commands, assets: &CityAssets, seed: u64, size: u32) {
</span><span>+    let mut rng = SmallRng::seed_from_u64(seed);
</span><span>+    let noise = OpenSimplex::new(rng.random());
</span><span>+    let noise_scale = 0.025;
</span><span>+
</span><span>+    commands
</span><span>+        .spawn((CityRoot, Transform::default(), Visibility::default()))
</span><span>+        .with_children(|commands| {
</span><span>+            let half_size = size as i32 / 2;
</span><span>+            for x in -half_size..half_size {
</span><span>+                for z in -half_size..half_size {
</span><span>+                    // scale the position to match the city block size
</span><span>+                    let x = x as f32 * 5.5;
</span><span>+                    let z = z as f32 * 4.0;
</span><span>+                    let offset = Vec3::new(x, 0.0, z);
</span><span>+
</span><span>+                    spawn_roads_and_cars(commands, assets, &mut rng, offset);
</span><span>+
</span><span>+                    let density = noise.get([
</span><span>+                        offset.x as f64 * noise_scale,
</span><span>+                        offset.z as f64 * noise_scale,
</span><span>+                        0.0,
</span><span>+                    ]) * 0.5
</span><span>+                        + 0.5;
</span><span>+
</span><span>+                    let forest = 0.45;
</span><span>+                    let low_density = 0.6;
</span><span>+                    let medium_density = 0.7;
</span><span>+
</span><span>+                    let ground_tile_scale = Vec3::new(4.5, 1.0, 3.0);
</span><span>+                    commands.spawn((
</span><span>+                        Mesh3d(assets.ground_tile.0.clone()),
</span><span>+                        if density < low_density {
</span><span>+                            MeshMaterial3d(assets.ground_tile.2.clone())
</span><span>+                        } else {
</span><span>+                            MeshMaterial3d(assets.ground_tile.1.clone())
</span><span>+                        },
</span><span>+                        Transform::from_translation(
</span><span>+                            Vec3::new(0.5, -0.5005, 0.5) + ground_tile_scale / 2.0 + offset,
</span><span>+                        )
</span><span>+                        .with_scale(ground_tile_scale),
</span><span>+                    ));
</span><span>+
</span><span>+                    if density < forest {
</span><span>+                        spawn_forest(commands, assets, &mut rng, offset);
</span><span>+                    } else if density < low_density {
</span><span>+                        spawn_low_density(commands, assets, &mut rng, offset);
</span><span>+                    } else if density < medium_density {
</span><span>+                        spawn_medium_density(commands, assets, &mut rng, offset);
</span><span>+                    } else {
</span><span>+                        spawn_high_density(commands, assets, &mut rng, offset);
</span><span>+                    }
</span><span>+                }
</span><span>+            }
</span><span>+        });
</span><span>+}
</span><span>+
</span><span>+fn spawn_roads_and_cars&LTR: RngExt>(
</span><span>+    commands: &mut ChildSpawnerCommands,
</span><span>+    assets: &CityAssets,
</span><span>+    rng: &mut R,
</span><span>+    offset: Vec3,
</span><span>+) {
</span><span>+    let x = offset.x;
</span><span>+    let z = offset.z;
</span><span>+
</span><span>+    commands.spawn((
</span><span>+        SceneRoot(assets.crossroad.clone()),
</span><span>+        Transform::from_xyz(x, 0.0, z),
</span><span>+    ));
</span><span>+
</span><span>+    let max_car_density = 0.4;
</span><span>+
</span><span>+    // When spawning roads we rotate and stretch a single road asset instead of spawning multiple
</span><span>+    // road segments
</span><span>+
</span><span>+    // NOTE most of the magic numbers were hand tweaked for something that looks visually nice
</span><span>+
</span><span>+    // horizontal road
</span><span>+    let car_count = 9;
</span><span>+    commands
</span><span>+        .spawn((
</span><span>+            Transform::from_translation(offset),
</span><span>+            Visibility::default(),
</span><span>+            Road {
</span><span>+                start: Vec3::new(0.75, 0.0, 0.0),
</span><span>+                end: Vec3::new(0.75 + (0.5 * car_count as f32), 0.0, 0.0),
</span><span>+            },
</span><span>+        ))
</span><span>+        .with_children(|commands| {
</span><span>+            commands.spawn((
</span><span>+                SceneRoot(assets.road_straight.clone()),
</span><span>+                Transform::from_translation(Vec3::new(2.75, 0.0, 0.0))
</span><span>+                    .with_scale(Vec3::new(4.5, 1.0, 1.0)),
</span><span>+            ));
</span><span>+
</span><span>+            for i in 0..car_count {
</span><span>+                let car_pos = Vec3::new(0.0, 0.0, 0.75 + i as f32 * 0.5);
</span><span>+
</span><span>+                if rng.random::&LTf32>() < max_car_density {
</span><span>+                    commands.spawn((
</span><span>+                        SceneRoot(assets.get_random_car(rng)),
</span><span>+                        Transform::from_translation(car_pos + Vec3::new(0.0, 0.0, -0.15))
</span><span>+                            .with_scale(Vec3::splat(0.15))
</span><span>+                            .with_rotation(Quat::from_axis_angle(
</span><span>+                                Vec3::Y,
</span><span>+                                3.0 * std::f32::consts::FRAC_PI_2,
</span><span>+                            )),
</span><span>+                        Car {
</span><span>+                            distance_traveled: i as f32 * 0.5,
</span><span>+                            dir: -1.0,
</span><span>+                            offset: Vec3::new(4.25, 0.0, -0.15),
</span><span>+                        },
</span><span>+                    ));
</span><span>+                }
</span><span>+
</span><span>+                if rng.random::&LTf32>() < max_car_density {
</span><span>+                    commands.spawn((
</span><span>+                        SceneRoot(assets.get_random_car(rng)),
</span><span>+                        Transform::from_translation(car_pos + Vec3::new(0.0, 0.0, 0.15))
</span><span>+                            .with_scale(Vec3::splat(0.15))
</span><span>+                            .with_rotation(Quat::from_axis_angle(
</span><span>+                                Vec3::Y,
</span><span>+                                std::f32::consts::FRAC_PI_2,
</span><span>+                            )),
</span><span>+                        Car {
</span><span>+                            distance_traveled: i as f32 * 0.5,
</span><span>+                            dir: 1.0,
</span><span>+                            offset: Vec3::new(-0.25, 0.0, 0.15),
</span><span>+                        },
</span><span>+                    ));
</span><span>+                }
</span><span>+            }
</span><span>+        });
</span><span>+
</span><span>+    // vertical road
</span><span>+    let car_count = 6;
</span><span>+    commands
</span><span>+        .spawn((
</span><span>+            Transform::from_translation(offset),
</span><span>+            Visibility::default(),
</span><span>+            Road {
</span><span>+                start: Vec3::new(0.0, 0.0, 0.75),
</span><span>+                end: Vec3::new(0.0, 0.0, 0.75 + (0.5 * car_count as f32)),
</span><span>+            },
</span><span>+        ))
</span><span>+        .with_children(|commands| {
</span><span>+            commands.spawn((
</span><span>+                SceneRoot(assets.road_straight.clone()),
</span><span>+                Transform::from_translation(Vec3::new(0.0, 0.0, 2.0))
</span><span>+                    .with_scale(Vec3::new(3.0, 1.0, 1.0))
</span><span>+                    .with_rotation(Quat::from_axis_angle(Vec3::Y, std::f32::consts::FRAC_PI_2)),
</span><span>+            ));
</span><span>+
</span><span>+            for i in 0..car_count {
</span><span>+                let car_pos = Vec3::new(0.0, 0.0, 0.75 + i as f32 * 0.5);
</span><span>+
</span><span>+                if rng.random::&LTf32>() < max_car_density {
</span><span>+                    commands.spawn((
</span><span>+                        SceneRoot(assets.get_random_car(rng)),
</span><span>+                        Transform::from_translation(car_pos + Vec3::new(0.15, 0.0, 0.0))
</span><span>+                            .with_scale(Vec3::splat(0.15)),
</span><span>+                        Car {
</span><span>+                            distance_traveled: i as f32 * 0.5,
</span><span>+                            dir: 1.0,
</span><span>+                            offset: Vec3::new(-0.15, </span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22973.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>