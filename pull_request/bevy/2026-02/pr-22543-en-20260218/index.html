<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22543 Fix build-wasm-example with `--debug` arg
        
    </title><meta content="#22543 Fix build-wasm-example with `--debug` arg" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-18</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22543-zh-cn-20260218>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix build-wasm-example with <code>--debug</code> arg<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22543<li><strong>Author</strong>: beicause<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Build-System, O-Web, D-Straightforward, S-Needs-Review<li><strong>Created</strong>: 2026-01-16T08:09:14Z<li><strong>Merged</strong>: 2026-02-18T12:50:53Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p>cargo profile is <code>dev</code> in debug build<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a subtle but important bug in Bevy’s WebAssembly build tooling. The issue centered around an inconsistency between how Cargo names its build profiles and how those profiles correspond to output directories. The <code>build-wasm-example</code> tool, used for compiling Bevy examples to WebAssembly, had a mismatch that prevented debug builds from working correctly.<p>The problem occurred when developers tried to use the <code>--debug</code> flag with the <code>build-wasm-example</code> tool. The tool was incorrectly assuming that the profile name passed to <code>cargo build --profile</code> would match the output directory name. In Cargo’s terminology, the debug profile is called <code>dev</code>, not <code>debug</code>. When you run <code>cargo build</code> without specifying a profile, it uses the <code>dev</code> profile by default and outputs to a directory named <code>debug</code>. However, when explicitly specifying <code>--profile debug</code>, Cargo would look for a custom profile named <code>debug</code> in the Cargo.toml, which doesn’t exist by default.<p>The solution involved decoupling the profile name used for the build command from the output directory name used for locating the compiled WebAssembly file. Previously, the code used a single <code>profile</code> variable for both purposes:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> profile </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> cli</span><span style=color:#ed9366>.</span><span>debug {
</span><span>    </span><span style=color:#86b300>"debug"
</span><span>} </span><span style=color:#fa6e32>else if</span><span> cli</span><span style=color:#ed9366>.</span><span>optimize_size {
</span><span>    </span><span style=color:#86b300>"wasm-release"
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#86b300>"release"
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>This approach worked for release builds because Cargo’s <code>release</code> profile outputs to a <code>release</code> directory. However, for debug builds, Cargo’s <code>dev</code> profile outputs to a <code>debug</code> directory, creating a mismatch.<p>The fix introduces a tuple containing both the profile name and the output directory name:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let </span><span>(profile</span><span style=color:#61676ccc>,</span><span> out_dir) </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> cli</span><span style=color:#ed9366>.</span><span>debug {
</span><span>    (</span><span style=color:#86b300>"dev"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"debug"</span><span>)
</span><span>} </span><span style=color:#fa6e32>else if</span><span> cli</span><span style=color:#ed9366>.</span><span>optimize_size {
</span><span>    (</span><span style=color:#86b300>"wasm-release"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"wasm-release"</span><span>)
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    (</span><span style=color:#86b300>"release"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"release"</span><span>)
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>This change ensures that:<ol><li>For debug builds, Cargo is invoked with <code>--profile dev</code> (the correct profile name)<li>The wasm-bindgen tool looks for the compiled .wasm file in the <code>debug</code> directory (where Cargo actually puts it)</ol><p>The <code>wasm-release</code> case is interesting because it represents a custom profile that developers can define in their Cargo.toml. In this case, the profile name and output directory name happen to be the same, so the tuple approach maintains consistency.<p>The fix is minimal and focused, changing only 5 lines of code but resolving a fundamental issue in the build process. It demonstrates good attention to the details of build tooling, where small mismatches between tool expectations can cause build failures that are confusing to debug.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[build-wasm-example CLI] --> B{Parse arguments}
</span><span>    B -- --debug --> C[Debug build path]
</span><span>    B -- --optimize-size --> D[Size-optimized build]
</span><span>    B -- default --> E[Release build]
</span><span>    
</span><span>    C --> F[Profile: dev, OutDir: debug]
</span><span>    D --> G[Profile: wasm-release, OutDir: wasm-release]
</span><span>    E --> H[Profile: release, OutDir: release]
</span><span>    
</span><span>    F --> I[cargo build --profile dev]
</span><span>    G --> J[cargo build --profile wasm-release]
</span><span>    H --> K[cargo build --profile release]
</span><span>    
</span><span>    I --> L[Output to target/.../debug/]
</span><span>    J --> M[Output to target/.../wasm-release/]
</span><span>    K --> N[Output to target/.../release/]
</span><span>    
</span><span>    L --> O[wasm-bindgen --out-dir .../debug/]
</span><span>    M --> P[wasm-bindgen --out-dir .../wasm-release/]
</span><span>    N --> Q[wasm-bindgen --out-dir .../release/]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>tools/build-wasm-example/src/main.rs</code></strong><p>This file contains the main logic for building Bevy examples as WebAssembly. The changes fix a mismatch between Cargo profile names and output directory names.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> profile </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> cli</span><span style=color:#ed9366>.</span><span>debug {
</span><span>    </span><span style=color:#86b300>"debug"
</span><span>} </span><span style=color:#fa6e32>else if</span><span> cli</span><span style=color:#ed9366>.</span><span>optimize_size {
</span><span>    </span><span style=color:#86b300>"wasm-release"
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#86b300>"release"
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>
</span><span style=color:#f07171>cmd!</span><span>(
</span><span>    sh</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"wasm-bindgen --out-dir examples/wasm/target --out-name wasm_example --target web target/wasm32-unknown-unknown/{profile}/examples/{example}.wasm"
</span><span>)
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let </span><span>(profile</span><span style=color:#61676ccc>,</span><span> out_dir) </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> cli</span><span style=color:#ed9366>.</span><span>debug {
</span><span>    (</span><span style=color:#86b300>"dev"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"debug"</span><span>)
</span><span>} </span><span style=color:#fa6e32>else if</span><span> cli</span><span style=color:#ed9366>.</span><span>optimize_size {
</span><span>    (</span><span style=color:#86b300>"wasm-release"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"wasm-release"</span><span>)
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    (</span><span style=color:#86b300>"release"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"release"</span><span>)
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>
</span><span style=color:#f07171>cmd!</span><span>(
</span><span>    sh</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"wasm-bindgen --out-dir examples/wasm/target --out-name wasm_example --target web target/wasm32-unknown-unknown/{out_dir}/examples/{example}.wasm"
</span><span>)
</span></code></pre><p>The key change is the introduction of two separate variables: <code>profile</code> (used for the <code>cargo build --profile</code> argument) and <code>out_dir</code> (used to construct the path to the compiled .wasm file). This correctly handles the case where Cargo’s <code>dev</code> profile outputs to a <code>debug</code> directory.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/profiles.html target=_blank>Cargo Profiles Documentation</a> - Official documentation on Cargo build profiles<li><a rel="noopener nofollow noreferrer" href=https://rustwasm.github.io/docs/wasm-bindgen/reference/cli.html target=_blank>wasm-bindgen CLI Reference</a> - Documentation for the wasm-bindgen command-line tool<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/platforms/wasm/ target=_blank>Bevy WebAssembly Guide</a> - Bevy’s official WebAssembly setup guide<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/workspaces.html target=_blank>Cargo Workspace Reference</a> - Understanding how Cargo handles builds in workspace environments</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22543.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>