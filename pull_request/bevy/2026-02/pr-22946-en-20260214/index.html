<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22946 Fix text examples post parley migration: system_fonts & generic_font_families
        
    </title><meta content="#22946 Fix text examples post parley migration: system_fonts & generic_font_families" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-14</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22946-zh-cn-20260214>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=fix-text-examples-post-parley-migration-system-fonts-generic-font-families>Fix text examples post parley migration: system_fonts & generic_font_families</h2><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix text examples post parley migration: system_fonts & generic_font_families<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22946<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Examples, S-Ready-For-Final-Review, A-Text<li><strong>Created</strong>: 2026-02-14T02:30:40Z<li><strong>Merged</strong>: 2026-02-14T17:25:51Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><ul><li>Fixes #22940</ul><p><strong>Solution</strong><ul><li>Require the new feature <code>system_font_discovery</code> for the examples, which was added during the parley migration to explicitly enable loading fonts from the system.</ul><p><strong>Testing</strong> <code>cargo run --example system_fonts --features="system_font_discovery"</code> works correctly <del>(although I should note that chinese characters do not show up correctly, don’t know if that’s an issue on the bevy side)</del> the text is ok if it’s using the font, but not if it’s not, and I guess that makes sense <img alt="Screenshot 2026-02-13 at 9 29 17 PM" height=744 src=https://github.com/user-attachments/assets/5be7b572-ee09-45f2-a7fc-528cc1640e01 width=1275><p><code>cargo run --example generic_font_families --features="system_font_discovery"</code> works correctly <img alt="Screenshot 2026-02-13 at 9 27 54 PM" height=741 src=https://github.com/user-attachments/assets/3b18e67d-84c8-42c4-b90e-6269ab8e3a12 width=1275><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important configuration issue in the Bevy game engine’s example system. The core problem was that two text rendering examples—<code>system_fonts</code> and <code>generic_font_families</code>—stopped working after a significant text system refactoring known as the “parley migration.”<p>The root cause was a feature flag mismatch. During the parley migration, the team introduced a new Cargo feature called <code>system_font_discovery</code> to gate the functionality for loading fonts from the operating system. This is a common pattern in Rust projects for conditional compilation, allowing users to opt into certain functionality that may have platform-specific dependencies or increase compilation time. However, the example configurations in <code>Cargo.toml</code> were not updated to declare their dependency on this new feature.<p>The developer, kfc35, diagnosed the issue correctly. When users attempted to run the examples with the standard command <code>cargo run --example system_fonts</code>, the necessary code for finding system fonts was not compiled, causing the examples to fail. The solution was purely additive and non-breaking: update the metadata for each example in the workspace’s <code>Cargo.toml</code> file to specify the <code>required-features</code> key.<p>The implementation involved adding a single line to each example’s configuration block:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>required-features </span><span>= [</span><span style=color:#86b300>"system_font_discovery"</span><span>]
</span></code></pre><p>This line instructs Cargo that when building this specific example target, it must enable the listed features for the package. This ensures the <code>bevy</code> crate is compiled with the <code>system_font_discovery</code> feature flag active, making the necessary APIs and system font loading logic available.<p>This fix highlights an important aspect of managing a large Rust workspace with many examples and optional features. When core functionality is moved behind a feature flag, all dependent targets must be audited and updated. The change is minimal but essential for maintaining a working examples directory, which is critical for developer onboarding and documentation.<p>The testing approach was practical: the developer ran both examples with the required feature flag and verified they rendered correctly, even noting and then reasoning through an observation about Chinese character rendering. This demonstrates good validation practice—not just checking that the code compiles, but that it produces the expected visual output.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Cargo.toml Example Config] --> B[Required Features List]
</span><span>    B --> C[system_font_discovery Feature]
</span><span>    C --> D[Bevy Text System]
</span><span>    D --> E[System Font Loading Logic]
</span><span>    E --> F[Example Executable]
</span><span>    
</span><span>    G[User runs `cargo run --example system_fonts`] --> H[Cargo checks required-features]
</span><span>    H --> I[Enables system_font_discovery feature]
</span><span>    I --> J[Compiles with system font support]
</span><span>    J --> F
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>Cargo.toml</code></strong><ul><li><strong>Change Description</strong>: Added <code>required-features = ["system_font_discovery"]</code> to the configuration blocks for the <code>generic_font_families</code> and <code>system_fonts</code> examples. This ensures the examples are only built when the necessary feature flag is enabled.<li><strong>Code Snippets</strong>:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># For the generic_font_families example
</span><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"generic_font_families"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/ui/text/generic_font_families.rs"
</span><span style=color:#abb0b6;font-style:italic># Causes an ICE on docs.rs
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>false
</span><span style=color:#399ee6>required-features </span><span>= [</span><span style=color:#86b300>"system_font_discovery"</span><span>]  </span><span style=color:#abb0b6;font-style:italic># &LT- Added line
</span><span>
</span><span style=color:#abb0b6;font-style:italic># For the system_fonts example  
</span><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"system_fonts"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/ui/text/system_fonts.rs"
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>true
</span><span style=color:#399ee6>required-features </span><span>= [</span><span style=color:#86b300>"system_font_discovery"</span><span>]  </span><span style=color:#abb0b6;font-style:italic># &LT- Added line
</span></code></pre><li><strong>Relationship to PR Purpose</strong>: These are the only changes needed. They explicitly declare the examples’ dependency on the <code>system_font_discovery</code> feature that was introduced during the parley migration, fixing the compilation and runtime errors users encountered.</ul><h2 id=further-reading>Further Reading</h2><ol><li><strong>Cargo Features Documentation</strong>: The official Rust book section on <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Cargo Features</a> explains the feature system used in this fix.<li><strong>Bevy’s Text System Migration</strong>: For context on the parley migration mentioned in the PR, see the related Bevy PRs and discussions about updating the text rendering backend.<li><strong>Bevy Examples Guide</strong>: The <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/examples#examples target=_blank>Bevy Examples</a> README provides an overview of how to run examples and the role they play in the project.<li><strong>Conditional Compilation in Rust</strong>: The Rust reference on <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation</a> covers <code>cfg</code> attributes and feature flags at the language level.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22946.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>