<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22954 Enable RenderApp Ambiguity Detection
        
    </title><meta content="#22954 Enable RenderApp Ambiguity Detection" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-17</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-02/pr-22954-en-20260217>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=ji-ben-xin-xi>基本信息</h2><ul><li><strong>标题</strong>: Enable RenderApp Ambiguity Detection<li><strong>PR链接</strong>: https://github.com/bevyengine/bevy/pull/22954<li><strong>作者</strong>: atlv24<li><strong>状态</strong>: 已合并 (MERGED)<li><strong>标签</strong>: A-Rendering, S-Ready-For-Final-Review<li><strong>创建时间</strong>: 2026-02-14T08:58:17Z<li><strong>合并时间</strong>: 2026-02-17T17:02:22Z<li><strong>合并者</strong>: alice-i-cecile</ul><h2 id=miao-shu-fan-yi>描述翻译</h2><h3 id=objective-mu-biao>Objective (目标)</h3><ul><li>修复 #7386</ul><h3 id=solution-jie-jue-fang-an>Solution (解决方案)</h3><ul><li>#22951, #22952, #22949, #22945 以及本 PR 上的一些更改。注意：在这些其他 PR 全部合并之前，CI 不会通过。<li>修复一个 bug。</ul><h3 id=testing-ce-shi>Testing (测试)</h3><ul><li>示例看起来正常。</ul><h2 id=gai-pull-request-de-gu-shi>该 Pull Request 的故事</h2><p>这个 PR 的故事始于一个已知但被容忍的问题：在 Bevy 的 RenderApp 中，系统之间的歧义（ambiguity）没有被主动检测和报告。问题 #7386 记录了这一点。系统歧义指的是当两个或多个系统无法确定其相对执行顺序，但又访问了可能冲突的数据时，会导致不确定的行为。在开发过程中，及早发现这些歧义对于保证渲染逻辑的正确性和可预测性至关重要。<p>在此之前，代码中有一个明确的妥协。在测试文件 <code>ambiguity_detection.rs</code> 中，对于 RenderApp 的歧义检测被注释掉了，并附有一条注释，指出这最终应该被禁止。这意味着，虽然主 App 的系统调度已经启用了严格的歧义检测，但渲染管线的核心部分（RenderApp）却运行在一个“盲区”中。开发者可能会在 RenderApp 中无意间引入有歧义的系统，但直到运行时出现难以调试的问题前，都不会收到任何警告。<p>这个 PR 的核心目标就是移除这个妥协，将相同的安全标准应用到 RenderApp 上。实现方式分为两个关键部分。<p>首先，需要解决现有代码库中在 RenderApp 内实际存在的歧义。这涉及到修改多个渲染相关的插件，为那些本应在同一系统集（SystemSet）内但执行顺序未明确界定的系统添加 <code>ambiguous_with</code> 约束。<code>ambiguous_with</code> 是 Bevy ECS 调度器的一个指令，它告诉调度器：“我知道这两个系统访问的数据可能存在冲突，但我明确声明它们的执行顺序可以是任意的，或者我通过其他约束（如 <code>after</code>）保证了顺序，因此请忽略这个潜在的歧义警告。” 这实际上是一种对已知、可接受情况的“消歧”操作。<p>例如，在 <code>Core3dPlugin</code> 中，<code>configure_occlusion_culling_view_targets</code> 系统被添加到 <code>RenderSystems::PrepareViews</code> 系统集中，但为了避免与同一集合内的其他系统产生歧义警告，添加了 <code>.ambiguous_with(RenderSystems::PrepareViews)</code>。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_core_pipeline/src/core_3d/mod.rs
</span><span>configure_occlusion_culling_view_targets
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(prepare_view_targets)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(RenderSystems</span><span style=color:#ed9366>::</span><span>PrepareViews)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(RenderSystems</span><span style=color:#ed9366>::</span><span>PrepareViews)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 新增：消歧
</span></code></pre><p>类似的修改也出现在 OIT（OrderIndependentTransparencyPlugin）、PBR 材质系统和景深（DepthOfFieldPlugin）插件中。特别是在 PBR 的材质系统里，除了添加 <code>ambiguous_with</code>，还引入了一个新的系统集 <code>MaterialSweepEntitiesNeedingSpecializationSystems</code>，以更好地组织相关系统并管理它们之间的歧义关系。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_pbr/src/material.rs
</span><span>extract_entities_needs_specialization</span><span style=color:#ed9366>::</span><span>&LTM>
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(MaterialExtractEntitiesNeedingSpecializationSystems)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(MaterialExtractEntitiesNeedingSpecializationSystems)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 新增：消歧
</span><span>sweep_entities_needing_specialization</span><span style=color:#ed9366>::</span><span>&LTM>
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(MaterialSweepEntitiesNeedingSpecializationSystems) </span><span style=color:#abb0b6;font-style:italic>// 新增：归入新系统集
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(MaterialSweepEntitiesNeedingSpecializationSystems) </span><span style=color:#abb0b6;font-style:italic>// 新增：消歧
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(MaterialExtractEntitiesNeedingSpecializationSystems)
</span><span>    </span><span style=color:#ed9366>...
</span></code></pre><p>其次，在解决了这些现有歧义后，就可以最终启用检测机制。这是通过在测试文件 <code>tests/ecs/ambiguity_detection.rs</code> 中取消注释两行代码来实现的。修改后，测试框架现在会对主 App <strong>和</strong> RenderApp 都运行歧义检测。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// tests/ecs/ambiguity_detection.rs
</span><span style=color:#abb0b6;font-style:italic>// 修改前:
</span><span style=color:#abb0b6;font-style:italic>// let sub_app = app.sub_app_mut(bevy_render::RenderApp);
</span><span style=color:#abb0b6;font-style:italic>// configure_ambiguity_detection(sub_app);
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后:
</span><span style=color:#fa6e32>let</span><span> sub_app </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>sub_app_mut</span><span>(bevy_render</span><span style=color:#ed9366>::</span><span>RenderApp)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>configure_ambiguity_detection</span><span>(sub_app)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 启用 RenderApp 检测
</span></code></pre><p>同时，测试断言也被更新，现在会检查并确保 RenderApp 的歧义计数也为零。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> render_app_ambiguities </span><span style=color:#ed9366>= </span><span style=color:#f07171>count_ambiguities</span><span>(app</span><span style=color:#ed9366>.</span><span style=color:#f07171>sub_app</span><span>(bevy_render</span><span style=color:#ed9366>::</span><span>RenderApp))</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(
</span><span>    render_app_ambiguities</span><span style=color:#ed9366>.</span><span style=color:#f07171>total</span><span>()</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"Render app has unexpected ambiguities..."</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>这个 PR 的合并标志着 Bevy 渲染引擎在可靠性方面的一个重要进步。它消除了一个技术债务（technical debt），使得整个引擎的调度行为更加透明和可控。现在，如果开发者在修改 RenderApp 中的系统时引入了新的歧义，CI 测试会立即失败并给出明确的错误信息，从而在代码合并前就阻止潜在的问题。这不仅提高了代码质量，也降低了未来调试与渲染顺序相关问题的难度。从工程实践角度看，这个 PR 展示了如何通过系统地添加 <code>ambiguous_with</code> 约束来管理复杂的系统依赖关系，并最终启用严格的静态检查来提升整个项目的稳健性。<h2 id=shi-jue-biao-shi>视觉表示</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph “PR #22954: 启用 RenderApp 歧义检测”
</span><span>        Goal[“目标: 修复 #7386”] --> Step1[“步骤1: 为现有歧义系统添加 .ambiguous_with 约束”]
</span><span>        Goal --> Step2[“步骤2: 在测试中启用对 RenderApp 的检测”]
</span><span>
</span><span>        Step1 --> Change1[“修改渲染插件 (core_3d, oit, material 等)”]
</span><span>        Step2 --> Change2[“修改测试文件 ambiguity_detection.rs”]
</span><span>
</span><span>        Change1 --> Outcome1[“消除现有已知歧义”]
</span><span>        Change2 --> Outcome2[“激活对 RenderApp 的 CI 检查”]
</span><span>
</span><span>        Outcome1 & Outcome2 --> Final[“结果: RenderApp 调度现在具有与主 App 同等的歧义安全性”]
</span><span>    end
</span></code></pre><h2 id=guan-jian-wen-jian-geng-gai>关键文件更改</h2><ol><li><p><strong><code>tests/ecs/ambiguity_detection.rs</code> (+8/-5)</strong></p> <ul><li><strong>更改描述及原因</strong>：这是启用检测的核心开关。之前，代码注释明确指出 RenderApp 的歧义是被允许的，并且检测被禁用。此修改移除了这个例外，使 RenderApp 接受与主 App 相同的严格检查。<li><strong>关键代码修改</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 之前 (注释掉的状态):
</span><span style=color:#abb0b6;font-style:italic>// let sub_app = app.sub_app_mut(bevy_render::RenderApp);
</span><span style=color:#abb0b6;font-style:italic>// configure_ambiguity_detection(sub_app);
</span><span style=color:#abb0b6;font-style:italic>// ...
</span><span style=color:#abb0b6;font-style:italic>// (断言只检查 main_app_ambiguities)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 之后:
</span><span style=color:#fa6e32>let</span><span> sub_app </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>sub_app_mut</span><span>(bevy_render</span><span style=color:#ed9366>::</span><span>RenderApp)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>configure_ambiguity_detection</span><span>(sub_app)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 取消注释，启用检测
</span><span style=color:#abb0b6;font-style:italic>// ...
</span><span style=color:#abb0b6;font-style:italic>// 新增对 RenderApp 的断言检查
</span><span style=color:#fa6e32>let</span><span> render_app_ambiguities </span><span style=color:#ed9366>= </span><span style=color:#f07171>count_ambiguities</span><span>(app</span><span style=color:#ed9366>.</span><span style=color:#f07171>sub_app</span><span>(bevy_render</span><span style=color:#ed9366>::</span><span>RenderApp))</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(render_app_ambiguities</span><span style=color:#ed9366>.</span><span style=color:#f07171>total</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>...</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre></ul><li><p><strong><code>crates/bevy_pbr/src/material.rs</code> (+9/-1)</strong></p> <ul><li><strong>更改描述及原因</strong>：在 PBR 材质处理系统中，有两个关键系统 <code>extract_entities_needs_specialization</code> 和 <code>sweep_entities_needs_specialization</code>。它们之间存在潜在的顺序依赖关系（通过 <code>after</code> 约束），但被放置在同一逻辑组中。为了通过歧义检测，需要将它们标记为相互“歧义”，并引入一个新的、更精确的系统集来归类。<li><strong>关键代码修改</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 为 extract 系统添加消歧
</span><span>extract_entities_needs_specialization</span><span style=color:#ed9366>::</span><span>&LTM>
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(MaterialExtractEntitiesNeedingSpecializationSystems)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(MaterialExtractEntitiesNeedingSpecializationSystems)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 新增
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 为 sweep 系统创建新系统集并添加消歧
</span><span>sweep_entities_needing_specialization</span><span style=color:#ed9366>::</span><span>&LTM>
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(MaterialSweepEntitiesNeedingSpecializationSystems) </span><span style=color:#abb0b6;font-style:italic>// 新增：定义新系统集
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(MaterialSweepEntitiesNeedingSpecializationSystems) </span><span style=color:#abb0b6;font-style:italic>// 新增
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(MaterialExtractEntitiesNeedingSpecializationSystems)
</span><span>    </span><span style=color:#ed9366>...
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 新增系统集定义
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(SystemSet</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Hash)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MaterialSweepEntitiesNeedingSpecializationSystems</span><span style=color:#61676ccc>;
</span></code></pre></ul><li><p><strong><code>crates/bevy_core_pipeline/src/core_3d/mod.rs</code> (+2/-1)</strong></p> <ul><li><strong>更改描述及原因</strong>：<code>configure_occlusion_culling_view_targets</code> 系统被添加到 <code>RenderSystems::PrepareViews</code> 系统集，但它只需要在 <code>prepare_view_targets</code> 之后运行。为了避免与该系统集内其他未指定顺序的系统产生歧义，添加了 <code>ambiguous_with</code> 约束。<li><strong>关键代码修改</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>configure_occlusion_culling_view_targets
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>after</span><span>(prepare_view_targets)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(RenderSystems</span><span style=color:#ed9366>::</span><span>PrepareViews)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(RenderSystems</span><span style=color:#ed9366>::</span><span>PrepareViews)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 新增
</span></code></pre></ul><li><p><strong><code>crates/bevy_core_pipeline/src/oit/mod.rs</code> (+3/-1)</strong></p> <ul><li><strong>更改描述及原因</strong>：与 core_3d 类似，OIT 插件中的 <code>configure_camera_depth_usages</code> 系统也需要消歧。<li><strong>关键代码修改</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>configure_camera_depth_usages
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(RenderSystems</span><span style=color:#ed9366>::</span><span>PrepareViews)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(RenderSystems</span><span style=color:#ed9366>::</span><span>PrepareViews)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 新增
</span></code></pre></ul><li><p><strong><code>crates/bevy_post_process/src/dof/mod.rs</code> (+2/-1)</strong></p> <ul><li><strong>更改描述及原因</strong>：景深插件的 <code>configure_depth_of_field_view_targets</code> 系统虽然未明确加入 <code>RenderSystems::PrepareViews</code> 集，但其执行时机（<code>after(prepare_view_targets)</code>）可能与属于该集合的系统产生资源访问冲突。因此，直接声明它与整个 <code>PrepareViews</code> 系统集存在歧义。<li><strong>关键代码修改</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>configure_depth_of_field_view_targets
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ambiguous_with</span><span>(RenderSystems</span><span style=color:#ed9366>::</span><span>PrepareViews)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 新增
</span></code></pre></ul></ol><h2 id=kuo-zhan-yue-du>扩展阅读</h2><ol><li><strong>Bevy ECS 调度器文档</strong>: 了解系统集、顺序约束（<code>before</code>, <code>after</code>, <code>chain</code>）以及歧义检测（<code>ambiguous_with</code>）的详细工作原理。<li><strong>Issue #7386</strong>: 查看此 PR 旨在解决的原始问题，了解其背景和讨论过程。<li><strong>相关 PR (#22951, #22952, #22949, #22945)</strong>: 这些 PR 可能包含了为最终启用 RenderApp 歧义检测所做的其他必要重构或修复，阅读它们可以提供更完整的上下文。<li><strong>《Data-Oriented Design》相关章节</strong>: 理解确定性调度和对共享数据访问的冲突检测在多线程/并行系统中的重要性。</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22954.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>