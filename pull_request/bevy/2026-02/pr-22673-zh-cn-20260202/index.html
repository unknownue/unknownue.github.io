<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22673 Adds tests for new `UiDebugOverlay` features into `testbed_ui`
        
    </title><meta content="#22673 Adds tests for new `UiDebugOverlay` features into `testbed_ui`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-02</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-02/pr-22673-en-20260202>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Adds tests for new <code>UiDebugOverlay</code> features into <code>testbed_ui</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22673<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-UI, S-Ready-For-Final-Review, C-Testing, D-Straightforward, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2026-01-23T21:28:52Z<li><strong>Merged</strong>: 2026-02-02T23:30:23Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>目标 (Objective)</strong><ul><li>将一些最近扩展的 UI 调试功能添加到测试平台 #21931</ul><p><strong>解决方案 (Solution)</strong> 在 <code>testbed/ui.rs</code> 中，添加第二行实体，用于演示：<ol><li>带有圆角的边框 (border)、内边距 (padding)、内容框 (content box) 轮廓<li>垂直滚动条 (vertical scrollbar) 轮廓<li>水平滚动条 (horizontal scrollbar) 轮廓<li>双向滚动条 (bidirectional scrollbar) 轮廓</ol><p>滚动条代码取自 <code>scroll.rs</code>，并尝试将其精简到能显示轮廓所需的最少代码（因此这些滚动条无法实际滚动）。<p><strong>测试 (Testing)</strong> 运行 <code>cargo run --example testbed_ui --features="bevy_ui_debug” -- debugoutlines</code> 即可。<p><strong>展示 (Showcase)</strong> 如果此截图/这些新测试用例暴露出任何非预期的 bug（例如：为什么左下角的内边距框的角也是圆角的，而只有右下角的边框半径被指定了？或者为什么双向滚动条会与文本重叠？），请创建 issue / 让我知道，以便我能创建 issue。<details><summary>截图 (Screenshot)</summary> <img alt="Screenshot 2026-01-23 at 6 50 18 PM" height=747 src=https://github.com/user-attachments/assets/a52fcec8-834c-46e9-b7a0-61c3e30cf730 width=1282></details><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>在 PR #21931 中，Bevy 的 UI 调试覆盖层（<code>UiDebugOverlay</code>）增加了新的可视化功能，用于帮助开发者理解 UI 布局。具体来说，它增加了绘制边框框 (border box)、内边距框 (padding box)、内容框 (content box) 以及滚动条轮廓 (scrollbar outlines) 的能力。这对于调试复杂的 UI 布局、检查尺寸计算和视觉重叠问题非常有用。<p>然而，<code>testbed_ui</code> 示例程序，作为 UI 功能的集成测试和展示平台，并没有更新以包含这些新特性的演示用例。这带来两个问题：第一，开发者没有一个直观的地方来快速验证这些调试功能是否正常工作；第二，这些新功能本身缺乏一个可见的“冒烟测试”（smoke test），即一个能简单运行并展示其基本效果的集成点。<p>因此，这个 PR 的目标很明确：扩展 <code>testbed_ui</code> 示例中的 <code>debug_outlines</code> 场景，使其包含对新 <code>UiDebugOverlay</code> 功能的测试和展示。<p>开发者采取了一个直接且有效的解决方案。他们没有修改核心功能代码，而是在现有的测试框架内添加新的测试实体。他们修改了 <code>examples/testbed/ui.rs</code> 文件中 <code>debug_outlines</code> 模块的 <code>setup</code> 函数。<p>原本的场景只包含一行（高度为100%）的简单测试节点。为了容纳新的测试用例，他们首先将原来那行节点的高度从 <code>percent(100)</code> 改为 <code>percent(50)</code>。然后，他们在同一父节点下创建了第二个节点，这个新节点也占据 <code>percent(50)</code> 的高度，并设置 <code>top: percent(50)</code>，使其紧挨在第一个节点下方，从而将屏幕垂直分成两半，上部分展示原有功能，下部分展示新增功能。<p>新的测试用例被组织在这第二行中，使用 <code>SpaceAround</code> 对齐方式水平排列。具体添加了四个演示实体：<ol><li><p><strong>复杂边框/内边距演示</strong>：创建一个具有不对称边框（<code>UiRect { top: px(10), bottom: px(20), left: px(30), right: px(40) }</code>）和内边距，且仅右下角有圆角（<code>BorderRadius::bottom_right(px(10))</code>）的节点。关键的是，为其设置了 <code>UiDebugOptions</code>，启用了 <code>outline_border_box</code>、<code>outline_padding_box</code> 和 <code>outline_content_box</code>，并将 <code>ignore_border_radius</code> 设为 <code>false</code>。这个用例旨在测试调试轮廓能否正确反映复杂的边框半径设置。</p><li><p><strong>垂直滚动条轮廓</strong>：创建一个固定高度、设置 <code>overflow: Overflow::scroll_y()</code> 和 <code>scrollbar_width</code> 的节点。为了模拟滚动内容，它使用 <code>Children::spawn(SpawnIter(...))</code> 动态生成了20个子文本项。一个重要的细节是它添加了 <code>ScrollPosition(Vec2::new(180., 180.))</code> 组件，这会将滚动位置预设在一个偏移量上，使得滚动条拇指（thumb）不会位于初始位置，从而可以更清楚地观察滚动条轮廓的绘制。其 <code>UiDebugOptions</code> 启用了 <code>outline_scrollbars</code>。</p><li><p><strong>水平滚动条轮廓</strong>：原理与垂直滚动条类似，但 <code>flex_direction</code> 设为 <code>Row</code>，<code>overflow</code> 设为 <code>scroll_x()</code>。这个用例没有预设 <code>ScrollPosition</code>，因此滚动条拇指会默认在起始位置。</p><li><p><strong>双向滚动条轮廓</strong>：这是最复杂的用例。节点同时启用垂直和水平滚动（<code>Overflow::scroll()</code>）。其内容是一个6x6的文本网格，通过嵌套的 <code>Children::spawn</code> 和 <code>SpawnIter</code> 生成。它也预设了 <code>ScrollPosition(Vec2::new(300., 0.))</code>，使水平滚动条拇指产生偏移，方便观察。</p></ol><p>在实现中，开发者特意指出，这些滚动条是“非功能性”的（non-functional）。这意味着他们只复制了能触发滚动条轮廓渲染所必需的 UI 结构（节点、溢出设置、子项），但剥离了所有实际的交互逻辑（如处理输入事件来更新 <code>ScrollPosition</code>）。这完全符合测试场景的定位——我们只需要视觉验证，而不需要交互功能。<p>代码中一个值得注意的实践是，对于所有作为“内容”的子文本节点，都显式地将 <code>UiDebugOptions::enabled</code> 设为 <code>false</code>。这确保了调试轮廓只绘制在作为测试目标的父容器上，避免了子项不必要的轮廓线对视觉效果造成干扰，保持了测试的清晰性。<p>从工程角度看，这个 PR 是一个典型的“测试先行”或至少是“测试同步”的良好实践。当核心功能（<code>UiDebugOverlay</code>）扩展后，及时更新相关的集成测试示例，这为功能提供了即时验证，并作为面向其他开发者的使用文档。通过将测试用例集中在一个可运行的示例中，它极大地降低了未来开发者调试和贡献 UI 调试相关代码的门槛。<p>作者在 PR 描述中主动邀请审查者注意可能由新测试暴露出的视觉 Bug（例如圆角应用的错误、滚动条与内容的重叠），这体现了积极的协作态度和对测试价值的深刻理解——测试不仅用于验证正确性，也用于发现问题。<p>最终，这个简洁、专注的 PR 成功地丰富了 <code>testbed_ui</code> 的调试场景，为 Bevy UI 的调试工具链增加了一个实用的可视化验证环节。<h2 id=visual-representation>Visual Representation</h2><p>这个 PR 主要修改了 <code>testbed_ui</code> 示例程序中一个特定场景的结构。下图展示了修改前后 <code>debug_outlines</code> 场景的 UI 节点层次结构变化：<pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph “修改前：单行布局”
</span><span>        A1[Root Node] --> B1[演示行 Row 1 height:100%]
</span><span>        B1 --> C1[原有测试节点 1]
</span><span>        B1 --> C2[原有测试节点 2]
</span><span>        B1 --> C3[...]
</span><span>    end
</span><span>
</span><span>    subgraph “修改后：双行布局”
</span><span>        A2[Root Node] --> B2[演示行 Row 1 height:50%]
</span><span>        A2 --> B3[新增演示行 Row 2 height:50%, top:50%]
</span><span>
</span><span>        B2 --> C4[原有测试节点 1]
</span><span>        B2 --> C5[原有测试节点 2]
</span><span>        B2 --> C6[...]
</span><span>
</span><span>        B3 --> D1[复杂边框/内边距节点]
</span><span>        B3 --> D2[垂直滚动条节点]
</span><span>        B3 --> D3[水平滚动条节点]
</span><span>        B3 --> D4[双向滚动条节点]
</span><span>    end
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong><code>examples/testbed/ui.rs</code> (+165/-1)</strong> 这是此 PR 修改的唯一文件。修改位于 <code>debug_outlines</code> 模块的 <code>setup</code> 函数中，目的是扩展该调试场景以包含对新 <code>UiDebugOverlay</code> 特性的测试。<ol><li><strong>修改目的</strong>：将原来的全屏单行测试布局改为半屏，并在下方新增一行，用于放置四个新的 UI 调试功能测试用例。<li><strong>关键修改代码</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 修改点1：将第一行的高度从 100% 改为 50%
</span><span style=color:#abb0b6;font-style:italic>// File: examples/testbed/ui.rs (在原有代码中)
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>Node {
</span><span>    width</span><span style=color:#61676ccc>: </span><span style=color:#f07171>percent</span><span>(</span><span style=color:#ff8f40>100</span><span>)</span><span style=color:#61676ccc>,
</span><span>    height</span><span style=color:#61676ccc>: </span><span style=color:#f07171>percent</span><span>(</span><span style=color:#ff8f40>100</span><span>)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span>    align_items</span><span style=color:#61676ccc>: </span><span>AlignItems</span><span style=color:#ed9366>::</span><span>Center</span><span style=color:#61676ccc>,
</span><span>    justify_content</span><span style=color:#61676ccc>: </span><span>JustifyContent</span><span style=color:#ed9366>::</span><span>SpaceAround</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>}</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>Node {
</span><span>    width</span><span style=color:#61676ccc>: </span><span style=color:#f07171>percent</span><span>(</span><span style=color:#ff8f40>100</span><span>)</span><span style=color:#61676ccc>,
</span><span>    height</span><span style=color:#61676ccc>: </span><span style=color:#f07171>percent</span><span>(</span><span style=color:#ff8f40>50</span><span>)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span>    align_items</span><span style=color:#61676ccc>: </span><span>AlignItems</span><span style=color:#ed9366>::</span><span>Center</span><span style=color:#61676ccc>,
</span><span>    justify_content</span><span style=color:#61676ccc>: </span><span>JustifyContent</span><span style=color:#ed9366>::</span><span>SpaceAround</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>}</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改点2：新增第二行节点和其所有子测试用例（代码较长，以下为结构示意）
</span><span>commands
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Node {
</span><span>            width</span><span style=color:#61676ccc>: </span><span style=color:#f07171>percent</span><span>(</span><span style=color:#ff8f40>100</span><span>)</span><span style=color:#61676ccc>,
</span><span>            height</span><span style=color:#61676ccc>: </span><span style=color:#f07171>percent</span><span>(</span><span style=color:#ff8f40>50</span><span>)</span><span style=color:#61676ccc>,
</span><span>            top</span><span style=color:#61676ccc>: </span><span style=color:#f07171>percent</span><span>(</span><span style=color:#ff8f40>50</span><span>)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 关键：定位在50%顶部，即下半屏
</span><span>            align_items</span><span style=color:#61676ccc>: </span><span>AlignItems</span><span style=color:#ed9366>::</span><span>Center</span><span style=color:#61676ccc>,
</span><span>            justify_content</span><span style=color:#61676ccc>: </span><span>JustifyContent</span><span style=color:#ed9366>::</span><span>SpaceAround</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>        DespawnOnExit(</span><span style=color:#fa6e32>super</span><span style=color:#ed9366>::</span><span>Scene</span><span style=color:#ed9366>::</span><span>DebugOutlines)</span><span style=color:#61676ccc>,
</span><span>    ))
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_children</span><span>(|</span><span style=color:#ff8f40>parent</span><span>| {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// 1. 复杂边框/内边距/内容框轮廓测试
</span><span>        parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(( </span><span style=color:#ed9366>... </span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// 2. 垂直滚动条轮廓测试
</span><span>        parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(( </span><span style=color:#ed9366>... </span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// 3. 水平滚动条轮廓测试
</span><span>        parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(( </span><span style=color:#ed9366>... </span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// 4. 双向滚动条轮廓测试
</span><span>        parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(( </span><span style=color:#ed9366>... </span><span>))</span><span style=color:#61676ccc>;
</span><span>    })</span><span style=color:#61676ccc>;
</span></code></pre><li><strong>与PR目标的关系</strong>：这些新增的节点分别配置了特定的 <code>UiDebugOptions</code>（如 <code>outline_border_box</code>, <code>outline_scrollbars</code> 等），直接对应了 PR #21931 中引入的新调试可视化功能。通过运行示例，开发者可以立即看到这些功能的渲染效果。</ol><h2 id=further-reading>Further Reading</h2><ol><li><strong>PR #21931</strong>: 此 PR 所测试的新功能的原始实现。阅读它可以了解 <code>UiDebugOverlay</code> 新增轮廓绘制功能的技术细节。<li><strong>Bevy UI 文档</strong>: 官方文档中关于 UI 组件（<code>Node</code>, <code>BorderRadius</code>, <code>Overflow</code>）和样式系统的部分。<li><strong>Entity Component System (ECS) 模式</strong>: 理解 Bevy 如何使用 <code>Commands</code>、<code>spawn</code>、<code>with_children</code> 以及组件（如 <code>UiDebugOptions</code>）来构建和配置 UI 实体。<li><strong>测试驱动开发 (TDD) 与可视化测试</strong>: 了解如何为图形用户界面创建有效的测试策略，包括像本例中的集成/展示型测试。</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22673.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>