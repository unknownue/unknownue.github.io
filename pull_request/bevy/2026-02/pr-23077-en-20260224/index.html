<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23077 The `testbed_ui` text scene should use a column layout
        
    </title><meta content="#23077 The `testbed_ui` text scene should use a column layout" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-23077-zh-cn-20260224>中文</a></div></div><div class=pr-content><h1 id=title-the-testbed-ui-text-scene-should-use-a-column-layout>Title: The <code>testbed_ui</code> text scene should use a column layout</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: The <code>testbed_ui</code> text scene should use a column layout<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/23077<li><strong>Author</strong>: kaio-matos<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-UI, S-Ready-For-Final-Review, C-Testing, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2026-02-20T18:19:51Z<li><strong>Merged</strong>: 2026-02-24T01:58:40Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Remove unnecessary usage of absolute positioning for each text element Fixes https://github.com/bevyengine/bevy/issues/22976<h2 id=solution>Solution</h2><p>Uses display grid with two columns to display the <code>testbed_ui</code> text. Beyond that I removed <code>DespawnOnExit(super::Scene::Text)</code> from each text element and added that only to the parent component.<h2 id=testing>Testing</h2><p>Run and hit space once:<pre class=language-sh data-lang=sh style=color:#61676c;background-color:#fafafa><code class=language-sh data-lang=sh><span style=color:#f29718>cargo</span><span> run</span><span style=color:#ff8f40> --example</span><span> testbed_ui
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a UI layout issue in the Bevy engine’s <code>testbed_ui</code> example, which serves as a testing ground for text rendering features. The problem was straightforward: the example was using manual absolute positioning for each text element, which made the code unnecessarily complex and difficult to maintain.<p>The original implementation in <code>examples/testbed/ui.rs</code> contained numerous instances of text entities with explicit <code>top</code> and <code>left</code> coordinates calculated manually. This approach required maintaining position variables and manually adjusting them for each new text element added to the scene. The code was verbose, with 518 lines dedicated to text setup that mostly consisted of repetitive positioning logic.<p>The developer, kaio-matos, identified that this manual positioning was unnecessary given Bevy’s modern UI layout system. The solution implemented two key improvements:<p>First, they restructured the layout using Bevy’s UI components. Instead of absolute positioning, they created a container with <code>FlexDirection::Column</code> and nested within it a grid with two columns using <code>Display::Grid</code> and <code>grid_template_columns</code>. This allowed the text elements to be organized in two columns (one for <code>FontHinting::Enabled</code> and one for <code>FontHinting::Disabled</code>) without manual coordinate calculations.<p>Second, they optimized entity management by moving the <code>DespawnOnExit(super::Scene::Text)</code> component from each individual text element to the parent container. This reduced component duplication and made the scene cleanup more efficient. In Bevy’s ECS architecture, reducing unnecessary components on entities can improve performance by reducing memory usage and iteration overhead.<p>The implementation demonstrates several important Bevy UI patterns:<ol><li><strong>Container-based layout</strong>: Using parent containers with layout properties (<code>FlexDirection::Column</code>, <code>Display::Grid</code>) to organize child elements<li><strong>Builder pattern</strong>: Using <code>with_child</code> and <code>with_children</code> methods to build hierarchical UI structures<li><strong>Component inheritance</strong>: Placing shared components (<code>DespawnOnExit</code>) on parent entities rather than duplicating them on children</ol><p>The refactored code is more maintainable because:<ul><li>Adding new text elements doesn’t require manual position calculations<li>The layout automatically adjusts if text content changes<li>The code structure clearly separates layout concerns from content definition</ul><p>From a technical perspective, the change from absolute positioning to grid layout also has rendering implications. With absolute positioning, each text element was essentially independent in the layout system. With the grid layout, Bevy’s UI system can perform more efficient layout calculations since it understands the relationships between elements.<p>The PR reduces the file size from 518 lines to 477 lines despite adding more structural elements (containers, grid definitions). This demonstrates how proper abstraction can make code both more concise and more maintainable.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TB
</span><span>    A[Camera2d + DespawnOnExit] --> B[Main Container&LTbr/>FlexDirection::Column&LTbr/>DespawnOnExit]
</span><span>    B --> C[Hello World Text Element]
</span><span>    B --> D[Grid Container&LTbr/>Display::Grid&LTbr/>2 columns]
</span><span>    
</span><span>    D --> E[Column Container 1&LTbr/>FontHinting::Enabled&LTbr/>FlexDirection::Column]
</span><span>    D --> F[Column Container 2&LTbr/>FontHinting::Disabled&LTbr/>FlexDirection::Column]
</span><span>    
</span><span>    E --> E1[Text: FontHinting::Enabled]
</span><span>    E --> E2[Text: white red green blue black]
</span><span>    E --> E3[Text with color variations]
</span><span>    E --> E4[Font family examples]
</span><span>    E --> E5[Font weight examples]
</span><span>    E --> E6[Font smoothing examples]
</span><span>    
</span><span>    F --> F1[Text: FontHinting::Disabled]
</span><span>    F --> F2[Text: white red green blue black]
</span><span>    F --> F3[Text with color variations]
</span><span>    F --> F4[Font family examples]
</span><span>    F --> F5[Font weight examples]
</span><span>    F --> F6[Font smoothing examples]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong><code>examples/testbed/ui.rs</code></strong> (+403/-444)<p>This file contains the <code>testbed_ui</code> example’s text scene implementation. The changes refactor the layout from manual absolute positioning to a structured grid system.<h3 id=key-changes>Key Changes:</h3><ol><li><strong>Added Container Hierarchy</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Each element positioned individually
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        left</span><span style=color:#61676ccc>,
</span><span>        top</span><span style=color:#61676ccc>: </span><span style=color:#f07171>px</span><span>(top)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"FontHinting::</span><span style=color:#ff8f40>{:?}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> hinting))</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>    DespawnOnExit(</span><span style=color:#fa6e32>super</span><span style=color:#ed9366>::</span><span>Scene</span><span style=color:#ed9366>::</span><span>Text)</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Structured container with children
</span><span style=color:#fa6e32>let mut</span><span> container </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        flex_direction</span><span style=color:#61676ccc>: </span><span>FlexDirection</span><span style=color:#ed9366>::</span><span>Column</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    DespawnOnExit(</span><span style=color:#fa6e32>super</span><span style=color:#ed9366>::</span><span>Scene</span><span style=color:#ed9366>::</span><span>Text)</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span>container</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_child</span><span>((
</span><span>    Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>"Hello World."</span><span>)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><strong>Implemented Grid Layout</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Grid container with two columns
</span><span style=color:#fa6e32>let mut</span><span> grid </span><span style=color:#ed9366>=</span><span> builder</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Node {
</span><span>    display</span><span style=color:#61676ccc>: </span><span>Display</span><span style=color:#ed9366>::</span><span>Grid</span><span style=color:#61676ccc>,
</span><span>    grid_template_columns</span><span style=color:#61676ccc>: </span><span style=color:#f07171>vec!</span><span>[GridTrack</span><span style=color:#ed9366>::</span><span>flex(</span><span style=color:#ff8f40>1.0</span><span>)</span><span style=color:#61676ccc>, </span><span>GridTrack</span><span style=color:#ed9366>::</span><span>flex(</span><span style=color:#ff8f40>1.0</span><span>)]</span><span style=color:#61676ccc>,
</span><span>    padding</span><span style=color:#61676ccc>: </span><span>UiRect</span><span style=color:#ed9366>::</span><span>horizontal(</span><span style=color:#f07171>px</span><span>(</span><span style=color:#ff8f40>5.</span><span>))</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Column Organization</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Each hinting variant gets its own column container
</span><span style=color:#fa6e32>for</span><span> hinting </span><span style=color:#ed9366>in </span><span>[FontHinting</span><span style=color:#ed9366>::</span><span>Enabled</span><span style=color:#61676ccc>, </span><span>FontHinting</span><span style=color:#ed9366>::</span><span>Disabled] {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> content </span><span style=color:#ed9366>=</span><span> grid</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Node {
</span><span>        flex_direction</span><span style=color:#61676ccc>: </span><span>FlexDirection</span><span style=color:#ed9366>::</span><span>Column</span><span style=color:#61676ccc>,
</span><span>        row_gap</span><span style=color:#61676ccc>: </span><span style=color:#f07171>px</span><span>(</span><span style=color:#ff8f40>5.</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Add text elements as children
</span><span>    content</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_child</span><span>((
</span><span>        Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"FontHinting::</span><span style=color:#ff8f40>{:?}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> hinting))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=4><li><strong>Optimized Component Management</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: DespawnOnExit on every entity
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... components
</span><span>    DespawnOnExit(</span><span style=color:#fa6e32>super</span><span style=color:#ed9366>::</span><span>Scene</span><span style=color:#ed9366>::</span><span>Text)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// Repeated on every entity
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: DespawnOnExit only on parent container
</span><span style=color:#fa6e32>let mut</span><span> container </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        flex_direction</span><span style=color:#61676ccc>: </span><span>FlexDirection</span><span style=color:#ed9366>::</span><span>Column</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    DespawnOnExit(</span><span style=color:#fa6e32>super</span><span style=color:#ed9366>::</span><span>Scene</span><span style=color:#ed9366>::</span><span>Text)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// Only here
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy UI Documentation</strong>: The official Bevy UI guide covers layout systems including Flexbox and Grid<li><strong>Bevy ECS Patterns</strong>: Understanding component inheritance and entity hierarchies in ECS<li><strong>CSS Grid/Flexbox Concepts</strong>: While Bevy’s implementation differs, CSS layout concepts provide useful mental models<li><strong>Game UI Best Practices</strong>: General principles for maintainable game UI code<li><strong>Entity Component System Architecture</strong>: How ECS affects UI implementation patterns in game engines</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23077.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>