<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22667 `animated_ui`: Animate `UiTransform::scale`, not `TextFont::font_size`
        
    </title><meta content="#22667 `animated_ui`: Animate `UiTransform::scale`, not `TextFont::font_size`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-04</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22667-zh-cn-20260204>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p><code>animated_ui</code>: Animate <code>UiTransform::scale</code>, not <code>TextFont::font_size</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: <code>animated_ui</code>: Animate <code>UiTransform::scale</code>, not <code>TextFont::font_size</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22667<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, C-Examples, A-UI, S-Ready-For-Final-Review, A-Animation, D-Straightforward<li><strong>Created</strong>: 2026-01-23T11:18:19Z<li><strong>Merged</strong>: 2026-02-04T00:51:13Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The original description is in English, so it is included exactly as-is:<h1 id=objective>Objective</h1><p>The animated_ui example interpolates the font size of the animated text entity, which rapidly generates gigabytes of font atlases.<p>Also, on main the text isn’t even visible (and it still generates infinity font atlases).<p>Fixes #22626, #22647<h2 id=solution>Solution</h2><p>Spawn the text with its font size set to the maximum value from the old animation curve. Then scale the text by interpolating the <code>UiTransform::scale</code> field, instead of the font size.<h2 id=testing>Testing</h2><p><code>cargo run --example animated_ui</code><p>The text should be visible and the memory usage should be stable.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a significant performance issue in Bevy’s <code>animated_ui</code> example. The problem stemmed from animating font size directly, which caused excessive memory usage due to continuous regeneration of font atlases. The issue was severe enough to cause gigabytes of memory allocation and made the example practically unusable.<p>The root cause was that each time the font size changed during animation, the text rendering system had to regenerate glyphs at the new size and allocate space for them in font atlases. Since the example animated font size between 24px and 80px multiple times per second, this created a continuous stream of new glyph allocations, quickly exhausting available memory.<p>The developer approached this problem by changing what property was being animated. Instead of animating <code>TextFont::font_size</code>, which triggers expensive glyph regeneration, the solution animates <code>UiTransform::scale</code>, which applies a scaling transformation to already-rasterized text. This approach is fundamentally more efficient because scaling via transformation matrices is a GPU operation that doesn’t require re-rasterizing text or allocating new font atlas space.<p>The implementation involved several key changes. First, the animation curve was modified to target <code>UiTransform::scale</code> instead of the custom <code>TextFontSizeProperty</code>. The curve values were changed from font sizes (24.0, 80.0, etc.) to scale factors (0.3, 1.0, etc.), and these values were converted to <code>Vec2::splat()</code> to scale uniformly in both dimensions.<p>Second, the text entity was spawned with a fixed font size of 80.0 (the maximum value from the original animation curve) instead of 24.0. This ensures the text starts at the largest size it would reach during animation, and the scaling transformation makes it smaller when needed.<p>Third, the custom <code>TextFontSizeProperty</code> implementation and its associated <code>AnimatableProperty</code> trait implementation were completely removed since they were no longer needed. This cleanup simplifies the codebase by removing specialized animation logic that was causing performance problems.<p>Fourth, the child entity creation was refactored from <code>entity.insert(children![...])</code> to <code>entity.with_child(...)</code>, which is a more modern and idiomatic way to add children in Bevy.<p>From an architectural perspective, this change demonstrates an important principle in graphics programming: when possible, use transformations rather than regenerating assets. The performance difference is dramatic - from gigabytes of memory allocation to stable, minimal memory usage.<p>The fix also resolved a secondary issue where the text wasn’t visible on main. This was because the text started at 24px font size but was being scaled down further by the initial animation state, making it too small to see. By starting at 80px and scaling down to 30% (24px equivalent), the text remains visible throughout the animation cycle.<p>This PR serves as a good example of how to optimize UI animations in Bevy. The key takeaway is that animating transform properties (position, rotation, scale) is almost always more efficient than animating properties that require asset regeneration or complex recomputation.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Animation System] --> B{Target Property}
</span><span>    B --> C[Font Size Animation]
</span><span>    B --> D[Transform Scale Animation]
</span><span>    C --> E[Regenerate Glyphs]
</span><span>    E --> F[Allocate Font Atlas Space]
</span><span>    F --> G[High Memory Usage]
</span><span>    D --> H[Apply Matrix Transformation]
</span><span>    H --> I[GPU-Accelerated Scaling]
</span><span>    I --> J[Low Memory Usage]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-animation-animated-ui-rs-11-40><code>examples/animation/animated_ui.rs</code> (+11/-40)</h3><p>This is the only file changed in the PR. The modifications completely overhaul how text scaling is animated in the example.<p><strong>Key Changes:</strong><ol><li><strong>Animation target changed from font size to scale:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Animating font size
</span><span>TextFontSizeProperty</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Animating UiTransform::scale
</span><span style=color:#f07171>animated_field!</span><span>(UiTransform</span><span style=color:#ed9366>::</span><span>scale)</span><span style=color:#61676ccc>,
</span></code></pre><ol start=2><li><strong>Animation curve values updated:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Font size values
</span><span style=color:#ed9366>.</span><span style=color:#f07171>zip</span><span>([</span><span style=color:#ff8f40>24.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>80.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>24.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>80.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>24.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>80.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>24.0</span><span>])</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Scale values (0.3 = 24px/80px)
</span><span style=color:#ed9366>.</span><span style=color:#f07171>zip</span><span>([</span><span style=color:#ff8f40>0.3</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.3</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.3</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.3</span><span>]</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(Vec2</span><span style=color:#ed9366>::</span><span>splat))</span><span style=color:#61676ccc>,
</span></code></pre><ol start=3><li><strong>Text entity spawned with maximum font size:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Starting at 24px
</span><span>font_size</span><span style=color:#61676ccc>: </span><span>FontSize</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>24.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Starting at 80px (maximum from old curve)
</span><span>font_size</span><span style=color:#61676ccc>: </span><span>FontSize</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>80.</span><span>)</span><span style=color:#61676ccc>,
</span></code></pre><ol start=4><li><p><strong>Removed custom <code>TextFontSizeProperty</code> implementation:</strong> The entire <code>TextFontSizeProperty</code> struct and its <code>AnimatableProperty</code> implementation (40 lines) were removed since they’re no longer needed.</p><li><p><strong>Updated child entity creation syntax:</strong></p></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Using children! macro
</span><span>entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(</span><span style=color:#f07171>children!</span><span>[</span><span style=color:#ed9366>...</span><span>])</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Using with_child method
</span><span>entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_child</span><span>(</span><span style=color:#ed9366>...</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>These changes work together to fix the performance issue: the text is created at its maximum size (80px), then scaled down via <code>UiTransform::scale</code> to achieve the visual effect of changing size, without triggering expensive font atlas regeneration.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy UI Documentation</strong>: https://bevyengine.org/learn/quick-start/ui/<li><strong>Bevy Animation System</strong>: https://bevyengine.org/learn/quick-start/animation/<li><strong>Font Atlas Management in Bevy</strong>: The <code>bevy_text</code> crate documentation explains how font atlases work<li><strong>GPU Transformations</strong>: Understanding how matrix transformations work on the GPU helps explain why scaling is more efficient than regenerating assets<li><strong>Related Issues</strong>: #22626 and #22647 provide additional context about the specific problems this PR solves</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22667.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>