<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22900 Debug Frustum Culling Usage Example
        
    </title><meta content="#22900 Debug Frustum Culling Usage Example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-13</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22900-zh-cn-20260213>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Debug Frustum Culling Usage Example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22900<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, S-Ready-For-Final-Review, A-Gizmos, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2026-02-11T03:11:06Z<li><strong>Merged</strong>: 2026-02-13T07:36:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #22881. Now that we have Aabb & Frustum Gizmos, let’s provide an example of their usage!</ul><h2 id=solution>Solution</h2><ul><li>A new usage example focused on debugging frustum culling. Using a free camera, you can inspect a scene with another stationary camera that has its frustum visualized and various shapes that interact with the frustum.</ul><h2 id=testing>Testing</h2><p><code>cargo run --example debug_frustum_culling --features="free_camera"</code><p>https://github.com/user-attachments/assets/08add970-4e80-4ac1-a81b-32b691f0a803<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses issue #22881 by creating a practical demonstration of Bevy’s recently added AABB and frustum debugging tools. The problem was straightforward: developers had new debugging gizmos available but lacked a clear example showing how to use them effectively for visibility analysis. The solution implements a comprehensive example that visualizes frustum culling in action, making these debugging tools more accessible to the Bevy community.<p>The implementation creates a self-contained scene with two cameras. The primary camera (<code>MyCamera</code>) has a viewport occupying the bottom-right corner of the screen, with its frustum visualized using Bevy’s <code>ShowFrustumGizmo</code> component. Various 3D shapes in the scene have AABB (Axis-Aligned Bounding Box) gizmos enabled via the <code>ShowAabbGizmo</code> component. The example’s core functionality monitors when shapes enter or leave the camera’s view frustum and updates their AABB colors accordingly—red when culled, green when visible.<p>A secondary free camera provides the main view of the scene and allows developers to move around and observe the culling behavior from different angles. This free camera implementation requires the <code>free_camera</code> feature flag, which the example properly declares in its Cargo.toml configuration. The scene includes multiple moving elements: shapes rotating on a ring and one shape moving behind a wall, demonstrating different culling scenarios.<p>One technical insight worth noting is how the example handles the timing of visibility updates. Frustum culling in Bevy occurs during the <code>PostUpdate</code> schedule, specifically in the <code>VisibilitySystems::CheckVisibility</code> system. The example’s <code>update_shape_aabb_colors</code> system runs after this visibility check, reading the results from <code>VisibleEntities</code> and updating AABB gizmo colors accordingly. This demonstrates proper system ordering when working with Bevy’s visibility pipeline.<p>The implementation also shows practical use of Bevy’s UI system for instructional text and camera view labels. Two UI hierarchies are created, each targeting a different camera (<code>UiTargetCamera</code>), allowing text to appear over specific camera views without interfering with other cameras.<p>From an engineering perspective, this example serves multiple purposes: it demonstrates the new AABB and frustum gizmos, shows how to work with multiple cameras and viewports, illustrates proper system ordering for visibility-dependent logic, and provides a template for debugging visibility issues in 3D applications. The code is well-structured with clear marker components (<code>MyCamera</code>, <code>MyShape</code>, <code>WallShape</code>, <code>ShapeRing</code>) that make the scene organization explicit.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Free Camera] --> B[Main Scene View]
</span><span>    C[MyCamera] --> D[Picture-in-Picture View]
</span><span>    E[Shape Ring] --> F[Rotating Shapes]
</span><span>    G[Wall Shape] --> H[Vertical Movement]
</span><span>    I[Frustum Culling System] --> J[Update AABB Colors]
</span><span>    K[User Input] --> L[Camera Position Controls]
</span><span>    
</span><span>    B --> M[Observe Culling Behavior]
</span><span>    D --> M
</span><span>    F --> I
</span><span>    H --> I
</span><span>    I --> J
</span><span>    L --> A
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-usage-debug-frustum-culling-rs-367-0><code>examples/usage/debug_frustum_culling.rs</code> (+367/-0)</h3><p>This is a new example file that demonstrates frustum culling visualization. The implementation creates a scene with two cameras, moving shapes, and AABB/frustum visualization.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Key sections of the implementation:
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Marker components for scene organization
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>MyCamera</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>require</span><span>(ShowAabbGizmo)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>MyShape</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// System that updates AABB colors based on visibility
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>update_shape_aabb_colors</span><span>(
</span><span>    </span><span style=color:#ff8f40>view_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span>VisibleEntities, With&LTMyCamera>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>gizmo_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ShowAabbGizmo, With&LTMyShape>>,
</span><span>) </span><span style=color:#61676ccc>-></span><span> Result {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Reset the color to use the config's default color
</span><span>    </span><span style=color:#fa6e32>for mut</span><span> shape_gizmo </span><span style=color:#ed9366>in &</span><span style=color:#fa6e32>mut</span><span> gizmo_query {
</span><span>        shape_gizmo</span><span style=color:#ed9366>.</span><span>color </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Query for the shape entities visible for this camera
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Update the gizmo on any such shape entity to be green
</span><span>    </span><span style=color:#fa6e32>let</span><span> visible_entities </span><span style=color:#ed9366>=</span><span> view_query</span><span style=color:#ed9366>.</span><span style=color:#f07171>single</span><span>()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>for</span><span> entity </span><span style=color:#ed9366>in</span><span> visible_entities</span><span style=color:#ed9366>.</span><span>entities</span><span style=color:#ed9366>.</span><span style=color:#f07171>values</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>flatten</span><span>() {
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(</span><span style=color:#fa6e32>mut</span><span> shape_gizmo) </span><span style=color:#ed9366>=</span><span> gizmo_query</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(</span><span style=color:#ed9366>*</span><span>entity) {
</span><span>            shape_gizmo</span><span style=color:#ed9366>.</span><span>color </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(Color</span><span style=color:#ed9366>::</span><span>LinearRgba(LinearRgba</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>GREEN</span><span>))</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(())
</span><span>}
</span></code></pre><h3 id=cargo-toml-14-0><code>Cargo.toml</code> (+14/-0)</h3><p>Added configuration for the new example, including the required <code>free_camera</code> feature.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"debug_frustum_culling"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/usage/debug_frustum_culling.rs"
</span><span style=color:#abb0b6;font-style:italic># Causes an ICE on docs.rs
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>false
</span><span style=color:#399ee6>required-features </span><span>= [</span><span style=color:#86b300>"free_camera"</span><span>]
</span><span>
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>example</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>debug_frustum_culling</span><span>]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"Debug Frustum Culling"
</span><span style=color:#399ee6>description </span><span>= </span><span style=color:#86b300>"Example demonstrating how to debug frustum culling"
</span><span style=color:#399ee6>category </span><span>= </span><span style=color:#86b300>"Usage"
</span><span style=color:#399ee6>wasm </span><span>= </span><span style=color:#ff8f40>true
</span></code></pre><h3 id=examples-readme-md-1-0><code>examples/README.md</code> (+1/-0)</h3><p>Added documentation entry for the new example in the Usage category.<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>[Debug Frustum Culling](</span><span style=color:#4cbf99;font-style:italic;text-decoration:underline>../examples/usage/debug_frustum_culling.rs</span><span>) </span><span style=color:#61676ccc>|</span><span> Example demonstrating how to debug frustum culling
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/gizmos/index.html target=_blank>Bevy Gizmos Documentation</a> - Official documentation for Bevy’s gizmo system<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Viewing_frustum target=_blank>Frustum Culling in Computer Graphics</a> - Wikipedia article on viewing frustums and culling<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/camera/index.html target=_blank>Bevy Camera and Visibility Systems</a> - Documentation for Bevy’s camera and visibility systems<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Minimum_bounding_box#Axis-aligned_minimum_bounding_box target=_blank>Axis-Aligned Bounding Boxes (AABB)</a> - Explanation of AABB collision detection<li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/system-order.html target=_blank>Bevy ECS System Ordering</a> - Guide to system ordering in Bevy’s ECS</ul><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/Cargo.toml b/Cargo.toml index b9358f62f9d5f..fbd64aefa94b4 100644 — a/Cargo.toml +++ b/Cargo.toml @@ -4608,6 +4608,20 @@ description = “Example displaying the font used by text gizmos” category = “Gizmos” wasm = true<p>+[[example]] +name = “debug_frustum_culling” +path = “examples/usage/debug_frustum_culling.rs” +# Causes an ICE on docs.rs +doc-scrape-examples = false +required-features = [“free_camera”] + +[package.metadata.example.debug_frustum_culling] +name = “Debug Frustum Culling” +description = “Example demonstrating how to debug frustum culling” +category = “Usage” +wasm = true + + [[example]] name = “custom_gltf_vertex_attribute” path = “examples/gltf/custom_gltf_vertex_attribute.rs” diff –git a/examples/README.md b/examples/README.md index a0fea2b7f4527..ef03f647e3077 100644 — a/examples/README.md +++ b/examples/README.md @@ -633,6 +633,7 @@ Example | Description — | — <a href=../examples/usage/context_menu.rs>Context Menu</a> | Example of a context menu <a href=../examples/usage/cooldown.rs>Cooldown</a> | Example for cooldown on button clicks +<a href=../examples/usage/debug_frustum_culling.rs>Debug Frustum Culling</a> | Example demonstrating how to debug frustum culling<h3 id=window>Window</h3><p>diff –git a/examples/usage/debug_frustum_culling.rs b/examples/usage/debug_frustum_culling.rs new file mode 100644 index 0000000000000..891ba8b89be1f — /dev/null +++ b/examples/usage/debug_frustum_culling.rs @@ -0,0 +1,367 @@ +//! This example demonstrates how to debug and visualize frustum culling, +//! a process (and Bevy <a href=bevy::camera::visibility::check_visibility><code>system</code></a>) that determines +//! which entities are visible and should be rendered within +//! a camera’s view. If an entity’s <a href=bevy::camera::primitives::Aabb><code>Aabb</code></a> +//! (Axis-Aligned Bounding Box) does not intersect with a camera’s +//! <a href=bevy::camera::primitives::Frustum><code>Frustum</code></a>, that entity is said to be “culled” +//! from the camera’s view frustum. +//! +//! To debug and visualize frustum culling, this example uses Aabb and Frustum gizmos provided +//! by bevy’s [<code>Gizmo</code>] library. <a href=bevy::gizmos::aabb><code>Aabb gizmos</code></a> are used to visualize the +//! <a href=bevy::camera::primitives::Aabb><code>Aabb</code></a> of entities. +//! <a href=bevy::gizmos::frustum><code>Frustum gizmos</code></a> are used to visualize the +//! <a href=bevy::camera::primitives::Frustum><code>Frustum</code></a> of a camera. +//! Both can be used together to visualize which entities have been culled +//! from a given camera’s view, which entities are visible, and when +//! that change happens during an entity’s Aabb interaction with a camera’s Frustum. +//! +//! This example contains a scene with a camera [<code>MyCamera</code>] that has its +//! <a href=bevy::camera::primitives::Frustum><code>Frustum</code></a> gizmo visible. +//! A collection of [<code>MyShape</code>]s, with their individual +//! <a href=bevy::camera::primitives::Aabb><code>Aabb</code></a> gizmos visible, periodically move in and +//! out of the camera’s frustum. The <a href=bevy::camera::primitives::Aabb><code>Aabb</code></a> +//! gizmos are colored red when they have been culled from [<code>MyCamera</code>]’s view. +//! The gizmos change color to green when the shape is considered visible by the +//! camera and would be extracted for rendering. +//! +//! A second active camera, controllable via the [<code>FreeCameraPlugin</code>], is used to observe the scene. +//! This second camera’s view occupies most of the window. [<code>MyCamera</code>]’s view is visible in the +//! bottom right ninth of the screen. + +use bevy::{<ul><li>camera::{<li><pre style=color:#61676c;background-color:#fafafa><code><span>   visibility::{VisibilitySystems, VisibleEntities},
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   Viewport,
</span></code></pre><li>},<li>camera_controller::free_camera::{FreeCamera, FreeCameraPlugin, FreeCameraState},<li>gizmos::aabb::ShowAabbGizmo,<li>input::common_conditions::input_just_pressed,<li>prelude::*, +}; +use std::f32::consts::PI;<li></ul><p>+fn main() {<ul><li>App::new()<li><pre style=color:#61676c;background-color:#fafafa><code><span>   .add_plugins((
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       DefaultPlugins.set(WindowPlugin {
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           primary_window: Some(Window {
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               resizable: false,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               ..default()
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           }),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           ..default()
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       }),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       FreeCameraPlugin,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   ))
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   .add_systems(Startup, setup)
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   .add_systems(
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       Update,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       (
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           move_shapes,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           move_free_camera_to_my_camera.run_if(input_just_pressed(KeyCode::Digit1)),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           move_free_camera_to_original_position.run_if(input_just_pressed(KeyCode::Digit2)),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       ),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   )
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   .add_systems(
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       // Frustum culling happens in PostUpdate.
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       // Our system will update the color of aabb's upon reading
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       // the results of frustum culling after CheckVisibility runs.
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       PostUpdate,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       update_shape_aabb_colors.after(VisibilitySystems::CheckVisibility),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   )
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   .run();
</span></code></pre></ul><p>+} + +/// A marker component for the ring some shapes will rotate on +#[derive(Component)] +struct ShapeRing; + +/// A marker component for our shapes so they can be queried separately from the planes. +/// The <code>ShowAabbGizmo</code> component will be automatically added to <code>MyShape</code> to make their Aabbs +/// visible. +#[derive(Component, Default)] +#[require(ShowAabbGizmo)] +struct MyShape; + +/// A marker component for the shape behind the wall. +#[derive(Component)] +#[require(MyShape)] +struct WallShape; + +/// A marker component for the camera that is being debugged +/// The <code>ShowFrustumGizmo</code> component will be automatically added to <code>MyCamera</code> to make +/// its view frustum visible. +#[derive(Component)] +#[require(ShowFrustumGizmo)] +struct MyCamera; + +const SHAPE_RING_RADIUS: f32 = 10.0; +const WALL_SHAPE_TIMER_DURATION_SECS: f32 = 8.0; +const FREE_CAMERA_START_TRANSFORM: Transform = Transform::from_xyz(-20., 10., 22.); +const FREE_CAMERA_START_TARGET: Vec3 = Vec3::new(7., 1.5, 0.); + +fn setup(<ul><li>mut commands: Commands,<li>windows: Query<&Window>,<li>mut config_store: ResMut<gizmoconfigstore>, <li>mut meshes: ResMut&LTAssets<mesh>>, <li>mut materials: ResMut&LTAssets<standardmaterial>>, +) -> Result { <li>let window = windows.single()?;</li> <li>// The camera that the user controls to observe the scene.</li> <li>let free_camera = commands</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   .spawn((
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Camera3d::default(),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       FREE_CAMERA_START_TRANSFORM.looking_at(FREE_CAMERA_START_TARGET, Vec3::Y),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       FreeCamera::default(),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   ))
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   .id();
</span></code></pre></li> <li></li> <li>// The camera that we want to debug frustum culling for. This will be rendered</li> <li>// as a picture-in-picture in the lower right ninth of the screen.</li> <li>let my_camera = commands</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   .spawn((
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Camera3d::default(),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Transform::from_xyz(0., 1.5, 0.).looking_at(Vec3::new(1.0, 1.5, 0.), Vec3::Y),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Camera {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           order: 1,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           // The camera-to-debug's view will be in the lower right ninth of the screen.
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           viewport: Some(Viewport {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>               physical_position: window.physical_size() * 2 / 3,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>               physical_size: window.physical_size() / 3,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>               ..default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           }),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           // Do not write the free camera's view rendering back into the P-I-P
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           msaa_writeback: MsaaWriteback::Off,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           ..default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       },
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       MyCamera,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   ))
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   .id();
</span></code></pre></li> <li></li> <li>// Instructions placed on top of the free_camera view</li> <li>commands.spawn((</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   UiTargetCamera(free_camera),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Node {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       width: percent(100),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       height: percent(100),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       ..default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   },
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   children![(
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Text::new(
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           "This example utilizes free camera controls i.e. move with WASD and mouse grab to change orientation.\n\
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           Press '1' to move the free camera to where MyCamera is, matching its view frustum.\n\
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           Press '2' to move the free camera to its initial position in the example.",
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       ),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Node {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           position_type: PositionType::Absolute,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           top: px(12),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           left: px(12),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           ..default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       },
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   )]
</span></code></pre></li> <li>));</li> <li>// Label for the picture-in-picture view of MyCamera</li> <li>commands.spawn((</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   UiTargetCamera(my_camera),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Node {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       width: percent(100),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       height: percent(100),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       ..default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   },
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   children![(
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Text::new("View of MyCamera"),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Node {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           position_type: PositionType::Absolute,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           bottom: px(12),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           right: px(100),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           ..default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       },
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   )],
</span></code></pre></li> <li>));</li> <li></li> <li>// Green Floor Plane</li> <li>commands.spawn((</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Mesh3d(
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       meshes.add(
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           Plane3d::default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>               .mesh()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>               .size(SHAPE_RING_RADIUS * 4., SHAPE_RING_RADIUS * 4.),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       ),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   ),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   MeshMaterial3d(materials.add(Color::srgb(0.3, 0.5, 0.3))),
</span></code></pre></li> <li>));</li> <li>// Blue Wall Plane</li> <li>commands.spawn((</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Mesh3d(meshes.add(Plane3d::default().mesh().size(5., 5.))),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   MeshMaterial3d(materials.add(Color::srgb(0.3, 0.3, 0.5))),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Transform::from_xyz(20., 2.5, 10.).with_rotation(Quat::from_rotation_z(PI / 2.)),
</span></code></pre></li> <li>));</li> <li>// Light</li> <li>commands.spawn((</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   PointLight {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       shadow_maps_enabled: true,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       ..default()
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   },
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Transform::from_xyz(0.0, 10.0, 0.0),
</span></code></pre></li> <li>));</li> <li></li> <li>// Configure all AABB’s to have a default color of red</li> <li>let (_, aabb_gizmo_config) = config_store.config_mut::<aabbgizmoconfiggroup>(); <li>aabb_gizmo_config.default_color = Some(Color::LinearRgba(LinearRgba::RED));</li> <li></li> <li>// Configure the shapes on the ring that will have their AABB’s drawn and updated</li> <li>let white_matl = materials.add(Color::WHITE);</li> <li>let shapes = [</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   meshes.add(Cuboid {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       half_size: Vec3::new(2., 0.5, 1.),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   }),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   meshes.add(Tetrahedron {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       vertices: [
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           Vec3::new(3., 4., 3.),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           Vec3::new(-0.5, 4., -0.5),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           Vec3::new(-0.5, -0.5, 3.),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           Vec3::new(3., -0.5, -0.5),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       ],
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   }),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   meshes.add(Cylinder {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       radius: 0.1,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       half_height: 1.5,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   }),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   meshes.add(Cuboid {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       half_size: Vec3::new(1., 0.1, 2.),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   }),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   meshes.add(Sphere::default().mesh().ico(5).unwrap()),
</span></code></pre></li> <li>];</li> <li>let shapes_len = shapes.len() as f32;</li> <li>let mut shape_ring = commands.spawn((Transform::default(), Visibility::default(), ShapeRing));</li> <li>for (i, shape) in shapes.into_iter().enumerate() {</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   // Space the shapes out evenly along the ring
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   let shape_angle = i as f32 * 2. * PI / shapes_len;
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   let (s, c) = ops::sin_cos(shape_angle);
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   let (x, z) = (SHAPE_RING_RADIUS * c, SHAPE_RING_RADIUS * s);
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   shape_ring.with_child((
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Mesh3d(shape),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       MeshMaterial3d(white_matl.clone()),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       Transform::from_xyz(x, 1.5, z).with_rotation(Quat::from_rotation_x(-PI / 4.)),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       MyShape,
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   ));
</span></code></pre></li> <li>}</li> <li></li> <li>// Configure the shape that peeks out of the wall plane</li> <li>let wall_shape = meshes.add(Torus::default());</li> <li>commands.spawn((</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Mesh3d(wall_shape),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   MeshMaterial3d(white_matl.clone()),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   Transform::from_xyz(25., 1.5, 12.5).with_rotation(Quat::from_rotation_x(-PI / 4.)),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   WallShape,
</span></code></pre></li> <li>));</li> <li></li> <li>Ok(()) +}</li> <li></li> <p>+// A system that: +// - rotates shapes in place +// - moves the ring shapes in a circle around MyCamera +// - moves the wall shape up and down +fn move_shapes(</p> <ul><li>time: Res<time>, <li>mut timer: Local<timer>, <li>mut ring_query: Query<&mut Transform, (With<shapering>, Without<myshape>)>, <li>mut shape_query: Query<(&mut Transform, Has<wallshape>), (With<myshape>, Without<shapering>)>, +) -> Result { <li>// Initialize the wall shape’s movement timer on the first run.</li> <li>if timer.duration().is_zero() {</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   *timer = Timer::from_seconds(WALL_SHAPE_TIMER_DURATION_SECS, TimerMode::Repeating);
</span></code></pre></li> <li>}</li> <li>timer.tick(time.delta());</li> <li>let dt = time.delta_secs();</li> <li></li> <li>// Rotate the shapes themselves on their own axis</li> <li>for (mut transform, has_wall_shape) in &mut shape_query {</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   transform.rotate_y(dt / 2.);
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   if has_wall_shape {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       // the wall shape moves up for 4 seconds and then down for 4 seconds.
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       // it oscillates between y = 1.5 and 15.0
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       transform.translation.y = if timer.elapsed_secs() < WALL_SHAPE_TIMER_DURATION_SECS / 2.0
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           1.5 + 15.0 * timer.elapsed_secs() / (WALL_SHAPE_TIMER_DURATION_SECS / 2.0)
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       } else {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>           1.5 + 15.0 * (WALL_SHAPE_TIMER_DURATION_SECS - timer.elapsed_secs())
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>               / (WALL_SHAPE_TIMER_DURATION_SECS / 2.0)
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       }
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   }
</span></code></pre></li> <li>}</li> <li></li> <li>// Rotate the ring</li> <li>let transform = &mut ring_query.single_mut()?;</li> <li>transform.rotate_y(dt / 3.);</li> <li></li> <li>Ok(()) +}</li> <li></li> <p>+// A system that changes the color of the <a href=bevy::gizmos::Aabb><code>AabbGizmo</code></a> +// if they are considered visible by the camera. +fn update_shape_aabb_colors(</p> <ul><li>view_query: Query<&VisibleEntities, With<mycamera>>, <li>mut gizmo_query: Query<&mut ShowAabbGizmo, With<myshape>>, +) -> Result { <li>// Reset the color to use the config’s default color</li> <li>for mut shape_gizmo in &mut gizmo_query {</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   shape_gizmo.color = None;
</span></code></pre></li> <li>}</li> <li></li> <li>// Query for the shape entities visible for this camera</li> <li>// Update the gizmo on any such shape entity to be green</li> <li>let visible_entities = view_query.single()?;</li> <li>for entity in visible_entities.entities.values().flatten() {</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   if let Ok(mut shape_gizmo) = gizmo_query.get_mut(*entity) {
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>       shape_gizmo.color = Some(Color::LinearRgba(LinearRgba::GREEN));
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   }
</span></code></pre></li> <li>}</li> <li>Ok(()) +}</li> <li></li> <p>+// A system that moves the free camera to <code>MyCamera</code>, matching its view frustum. +// From here, the camera orientation can be moved to more easily see the transition of +// entities’ visibilities with respect to <code>MyCamera</code> by looking at the frustum edges. +fn move_free_camera_to_my_camera(</p> <ul><li>view_query: Query<&Transform, With<mycamera>>, <li>free_camera_query: Query<</li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   (&mut Transform, &mut FreeCameraState),
</span></code></pre></li> <li><pre style=color:#61676c;background-color:#fafafa><code><span>   (With&LTCamera3d>, Without&LTMyCamera>),
</span></code></pre></li> <li><blockquote><p>, +) -> Result {</blockquote></li> <li>let my_camera_transform = view_query.single()?;</li> <li>move_free_camera(*my_camera_transform, free_camera_query) +}</li> <li></li> <p>+// A system that moves the free camera back to its starting position in the example. +fn move_free_camera_to_original_position(</p> <ul><li>free_camera_query: Query<<li><pre style=color:#61676c;background-color:#fafafa><code><span>   (&mut Transform, &mut FreeCameraState),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   (With&LTCamera3d>, Without&LTMyCamera>),
</span></code></pre><li><blockquote><p>, +) -> Result {</blockquote><li>move_free_camera(<li><pre style=color:#61676c;background-color:#fafafa><code><span>   FREE_CAMERA_START_TRANSFORM.looking_at(FREE_CAMERA_START_TARGET, Vec3::Y),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   free_camera_query,
</span></code></pre><li>) +}<li></ul> <p>+fn move_free_camera(</p> <ul><li>new_transform: Transform,<li>mut free_camera_query: Query<<li><pre style=color:#61676c;background-color:#fafafa><code><span>   (&mut Transform, &mut FreeCameraState),
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   (With&LTCamera3d>, Without&LTMyCamera>),
</span></code></pre><li><blockquote><p>, +) -> Result {</blockquote><li>let (mut transform, mut state) = free_camera_query.single_mut()?;<li>*transform = new_transform;<li><li>// Update the yaw and pitch so that free camera orientation is updated correctly upon mouse grab<li>let (yaw, pitch, _roll) = transform.rotation.to_euler(EulerRot::YXZ);<li>state.yaw = yaw;<li>state.pitch = pitch;<li><li>Ok(()) +}</ul>    <div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22900.patch id=patch-info style=display:none></div>  <div class=bottom-spacer></div> 