<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22789 Rename on_replace/Replace to on_discard/Discard
        
    </title><meta content="#22789 Rename on_replace/Replace to on_discard/Discard" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-13</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22789-zh-cn-20260213>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Rename on_replace/Replace to on_discard/Discard<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22789<li><strong>Author</strong>: jonas-meyer<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Usability, S-Ready-For-Final-Review, M-Migration-Guide<li><strong>Created</strong>: 2026-02-03T10:11:22Z<li><strong>Merged</strong>: 2026-02-13T01:37:12Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><ul><li>Rename lifecycle “Replace” hooks/events to “Discard” to reflect actual semantics (fires on overwrite, remove, and despawn), and free up “Replace” for a future true replacement event. Addresses #20729.</ul><p><strong>Solution</strong><ul><li>Renamed Replace/on_replace to Discard/on_discard across hooks, observers, events, derive macros, docs, examples, and tests.<li>Updated UI compile-fail expectations and added OnDiscard doc alias on Discard for discoverability.</ul><p><strong>Testing</strong><ul><li><code>cargo run -p ci -- compile-fail</code><li><code>cargo test -p bevy_ecs --lib --tests --features bevy_ecs/track_location</code> (fails locally due to missing bevy_ecs/debug feature in two tests that assert full system names)</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a naming inconsistency in Bevy’s Entity Component System (ECS) that had been causing confusion for developers. The core issue was that the lifecycle event named <code>Replace</code> didn’t accurately describe what it actually did, and this misleading name prevented the system from having a proper “true replacement” event in the future.<p>The <code>Replace</code> event was triggered in three distinct scenarios: when a component value was overwritten with a new value, when a component was removed from an entity, and when an entity was despawned. However, the name “Replace” only accurately described the first scenario (overwriting), while being misleading for removal and despawn operations. This semantic mismatch made the API harder to understand and use correctly.<p>The solution was straightforward but far-reaching: rename <code>Replace</code> to <code>Discard</code> and update all related APIs, documentation, and examples. The new name <code>Discard</code> more accurately reflects that the event triggers when component data is being discarded, whether through overwrite, removal, or entity despawn. This change also clears the way for introducing a future <code>Replace</code> event that would only fire on true replacements (overwrites), not on removals.<p>The implementation required changes across 24 files in the codebase, touching core ECS components, macros, documentation, and examples. Every instance of <code>Replace</code> and <code>on_replace</code> had to be updated to <code>Discard</code> and <code>on_discard</code> respectively. This included:<ol><li><strong>Lifecycle event constants</strong>: The <code>REPLACE</code> constant became <code>DISCARD</code><li><strong>Component hooks</strong>: The <code>on_replace</code> hook method became <code>on_discard</code><li><strong>Derive macro attributes</strong>: <code>#[component(on_replace = ...)]</code> became <code>#[component(on_discard = ...)]</code><li><strong>Documentation</strong>: All references in comments and guides were updated<li><strong>Examples</strong>: Working code examples were updated to use the new terminology<li><strong>Tests</strong>: Test cases and compile-fail expectations were updated</ol><p>The technical implementation was systematic but required careful attention to detail. For example, in the component derive macro (<code>crates/bevy_ecs/macros/src/component.rs</code>), the parsing logic for the <code>on_replace</code> attribute had to be updated to handle <code>on_discard</code> instead:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>} </span><span style=color:#fa6e32>else if</span><span> nested</span><span style=color:#ed9366>.</span><span>path</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ident</span><span>(</span><span style=color:#ff8f40>ON_REPLACE</span><span>) {
</span><span>    attrs</span><span style=color:#ed9366>.</span><span>on_replace </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(HookAttributeKind</span><span style=color:#ed9366>::</span><span>parse(nested</span><span style=color:#ed9366>.</span><span>input</span><span style=color:#61676ccc>, </span><span>|| {
</span><span>        </span><span style=color:#f07171>parse_quote! </span><span>{ </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>on_replace }
</span><span>    })</span><span style=color:#ed9366>?</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(())
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>} </span><span style=color:#fa6e32>else if</span><span> nested</span><span style=color:#ed9366>.</span><span>path</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ident</span><span>(</span><span style=color:#ff8f40>ON_DISCARD</span><span>) {
</span><span>    attrs</span><span style=color:#ed9366>.</span><span>on_discard </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(HookAttributeKind</span><span style=color:#ed9366>::</span><span>parse(nested</span><span style=color:#ed9366>.</span><span>input</span><span style=color:#61676ccc>, </span><span>|| {
</span><span>        </span><span style=color:#f07171>parse_quote! </span><span>{ </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>on_discard }
</span><span>    })</span><span style=color:#ed9366>?</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(())
</span></code></pre><p>Similarly, in the archetype flags system (<code>crates/bevy_ecs/src/archetype.rs</code>), the flag constants had to be renamed:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>ON_REPLACE_HOOK </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>2</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>ON_REPLACE_OBSERVER </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>7</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>ON_DISCARD_HOOK </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>2</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>ON_DISCARD_OBSERVER </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>7</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>One important consideration was maintaining backward compatibility through documentation aliases. The <code>Discard</code> struct was given <code>#[doc(alias = "OnDiscard")]</code> and <code>#[doc(alias = "Replace")]</code> attributes to help developers find the renamed type when searching for the old names.<p>The impact of this change is significant for code clarity. Developers can now more easily understand when <code>Discard</code> events fire and what they represent. The API now accurately communicates its behavior: when component data is being discarded (whether replaced, removed, or despawned), the <code>Discard</code> event fires, allowing systems to clean up related state.<p>From an engineering perspective, this change demonstrates the importance of accurate naming in API design. Misleading names can cause confusion and bugs, while clear names make the system more intuitive. The comprehensive nature of the changes (affecting macros, constants, methods, attributes, and documentation) shows how interconnected modern ECS systems are and why consistent naming is crucial.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Component Lifecycle Events] --> B[Add]
</span><span>    A --> C[Insert]
</span><span>    A --> D[Discard (formerly Replace)]
</span><span>    A --> E[Remove]
</span><span>    A --> F[Despawn]
</span><span>    
</span><span>    D --> G[Triggers on Overwrite]
</span><span>    D --> H[Triggers on Removal]
</span><span>    D --> I[Triggers on Despawn]
</span><span>    
</span><span>    J[Component Hooks] --> K[on_add]
</span><span>    J --> L[on_insert]
</span><span>    J --> M[on_discard]
</span><span>    J --> N[on_remove]
</span><span>    J --> O[on_despawn]
</span><span>    
</span><span>    M --> P[#[component(on_discard = func)]]
</span><span>    M --> Q[ComponentHooks::on_discard()]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><strong><code>crates/bevy_ecs/src/lifecycle.rs</code> (+24/-22)</strong></p> <ul><li>Renamed <code>Replace</code> struct to <code>Discard</code><li>Updated <code>REPLACE</code> constant to <code>DISCARD</code><li>Changed <code>ComponentHooks::on_replace()</code> to <code>ComponentHooks::on_discard()</code><li>Updated documentation to reflect new semantics</ul><li><p><strong><code>crates/bevy_ecs/src/world/entity_access/mod.rs</code> (+21/-21)</strong></p> <ul><li>Updated hook function names from <code>on_replace</code> to <code>on_discard</code><li>Changed observer callback names from <code>on_replace</code> to <code>on_discard</code><li>Updated test cases to use new terminology</ul><li><p><strong><code>crates/bevy_ecs/macros/src/component.rs</code> (+17/-17)</strong></p> <ul><li>Updated attribute parsing from <code>on_replace</code> to <code>on_discard</code><li>Changed constant <code>ON_REPLACE</code> to <code>ON_DISCARD</code><li>Updated error messages to reference <code>on_discard</code> instead of <code>on_replace</code></ul><li><p><strong><code>crates/bevy_ecs/src/observer/mod.rs</code> (+17/-17)</strong></p> <ul><li>Updated cached observers from <code>replace</code> to <code>discard</code><li>Changed test cases to use <code>Discard</code> instead of <code>Replace</code><li>Updated observer trigger logic for the renamed event</ul><li><p><strong><code>crates/bevy_ecs/src/world/deferred_world.rs</code> (+14/-14)</strong></p> <ul><li>Renamed <code>trigger_on_replace()</code> to <code>trigger_on_discard()</code><li>Updated safety comments to reference <code>DISCARD</code> instead of <code>REPLACE</code><li>Changed event triggering from <code>REPLACE</code> to <code>DISCARD</code></ul></ol><p>Example of a key change in <code>lifecycle.rs</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(alias </span><span style=color:#ed9366>= </span><span style=color:#86b300>"OnReplace"</span><span>)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Replace </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>entity</span><span style=color:#61676ccc>:</span><span> Entity,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(alias </span><span style=color:#ed9366>= </span><span style=color:#86b300>"OnDiscard"</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(alias </span><span style=color:#ed9366>= </span><span style=color:#86b300>"OnReplace"</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(alias </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Replace"</span><span>)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Discard </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>entity</span><span style=color:#61676ccc>:</span><span> Entity,
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/lifecycle/index.html target=_blank>Bevy ECS Lifecycle Events Documentation</a> - Official documentation for Bevy’s lifecycle system<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/20729 target=_blank>Issue #20729</a> - The original issue discussing the naming problem<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ecs/component-hooks/ target=_blank>Component Hooks Guide</a> - Bevy’s guide to using component lifecycle hooks<li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/naming.html target=_blank>API Design Guidelines</a> - Rust API design guidelines on naming conventions</ol><h2 id=full-code-diff>Full Code Diff</h2><p>The full code diff shows the comprehensive changes made across the codebase, updating all instances of <code>Replace</code>/<code>on_replace</code> to <code>Discard</code>/<code>on_discard</code> in:<ul><li>Constant definitions and usages<li>Struct and type names<li>Method names and signatures<li>Macro attribute parsing<li>Documentation comments<li>Test cases and examples<li>Error messages and compile-fail expectations</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22789.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>