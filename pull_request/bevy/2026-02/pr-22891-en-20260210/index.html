<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22891 Add `dirs` module to bevy_platform
        
    </title><meta content="#22891 Add `dirs` module to bevy_platform" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22891-zh-cn-20260210>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Add <code>dirs</code> module to bevy_platform<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add <code>dirs</code> module to bevy_platform<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22891<li><strong>Author</strong>: viridia<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Utils, M-Release-Note, A-Dev-Tools, X-Blessed, S-Needs-Review<li><strong>Created</strong>: 2026-02-10T18:52:56Z<li><strong>Merged</strong>: 2026-02-10T23:05:22Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><p>The PR description is already in English, so I’ll include it exactly as-is:<pre style=color:#61676c;background-color:#fafafa><code><span># Objective
</span><span>
</span><span>Adds a `dirs` module which provides the location of the application preferences directory.
</span><span>
</span><span>Part of: #13311 
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a common requirement in cross-platform game development: finding standard user directories for storing application data. Many applications need to save configuration files, save games, or user preferences in appropriate locations that follow platform conventions. Prior to this PR, Bevy didn’t provide a built-in way to determine these directories, requiring developers to implement platform-specific solutions themselves or rely on external crates.<p>The implementation approach follows established patterns from existing Rust ecosystem crates, specifically modeling the API after the <code>dirs-sys-rs</code> crate. This ensures compatibility with user expectations and leverages proven cross-platform solutions. The PR starts with a focused implementation providing only the preferences directory, acknowledging this as a foundational piece that can be extended with more directory types in future iterations (as indicated by the reference to issue #13311).<p>The architectural approach uses conditional compilation to provide platform-specific implementations while maintaining a clean, unified public API. This is a standard pattern in Rust for handling platform differences. The main module (<code>mod.rs</code>) serves as the entry point, conditionally re-exporting platform-specific functions based on the target OS. For unsupported platforms, it provides a fallback implementation that returns <code>None</code>, ensuring the API remains usable across all targets even if functionality is limited.<p>The Windows implementation deserves particular attention due to its complexity compared to the Unix-like systems. It uses the Windows Shell API’s <code>SHGetKnownFolderPath</code> function, which is the modern, recommended way to access standard folders on Windows. This approach properly handles localization, user permissions, and virtual folder redirection. The implementation includes proper memory management with <code>CoTaskMemFree</code> to avoid leaks, which is critical when dealing with COM APIs. The use of <code>windows-sys</code> crate follows Bevy’s established patterns for Windows API access.<p>For macOS and Linux, the initial implementations are simpler but functional. The macOS implementation follows Apple’s convention of using <code>~/Library/Preferences</code>, while Linux uses <code>~/.config</code> (with a TODO comment acknowledging the need for proper XDG_CONFIG support). These implementations use Rust’s standard library <code>home_dir()</code> function, which provides a reasonable baseline but has known limitations on some platforms.<p>The release notes addition indicates this is considered a user-facing feature worth documenting. The straightforward documentation focuses on what the module provides rather than implementation details, which is appropriate for a utility module.<p>From an engineering perspective, this PR demonstrates several good practices: starting with minimal viable functionality, using established patterns from the broader ecosystem, implementing proper resource management for platform APIs, and providing graceful fallbacks for unsupported platforms. The implementation also shows awareness of future extensibility while delivering immediate value.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_platform::dirs] --> B[Platform Detection]
</span><span>    B --> C[Windows]
</span><span>    B --> D[macOS]
</span><span>    B --> E[Linux]
</span><span>    B --> F[Other OS]
</span><span>    C --> G[SHGetKnownFolderPath API]
</span><span>    D --> H[~/Library/Preferences]
</span><span>    E --> I[~/.config]
</span><span>    F --> J[Returns None]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-platform-src-dirs-mod-rs-28-0><code>crates/bevy_platform/src/dirs/mod.rs</code> (+28/-0)</h3><p>This is the main module file that orchestrates the platform-specific implementations. It uses conditional compilation to include the appropriate platform module and export the <code>preferences_dir</code> function.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_platform/src/dirs/mod.rs
</span><span style=color:#abb0b6;font-style:italic>// Before: File did not exist
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>//! APIs that return the location of standard user directories.
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Modeled after https://github.com/dirs-dev/dirs-sys-rs/
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(</span><span style=color:#f29718>any</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"windows"</span><span style=color:#61676ccc>,</span><span> target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"macos"</span><span style=color:#61676ccc>,</span><span> target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"linux"</span><span>)))]
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>path</span><span style=color:#ed9366>::</span><span>PathBuf</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"windows"</span><span>)]
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>windows</span><span style=color:#61676ccc>;
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"windows"</span><span>)]
</span><span style=color:#fa6e32>pub use </span><span>windows</span><span style=color:#ed9366>::</span><span>preferences_dir</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"macos"</span><span>)]
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>macos</span><span style=color:#61676ccc>;
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"macos"</span><span>)]
</span><span style=color:#fa6e32>pub use </span><span>macos</span><span style=color:#ed9366>::</span><span>preferences_dir</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"linux"</span><span>)]
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>linux</span><span style=color:#61676ccc>;
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"linux"</span><span>)]
</span><span style=color:#fa6e32>pub use </span><span>linux</span><span style=color:#ed9366>::</span><span>preferences_dir</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Returns the path to the directory used for application settings. This version
</span><span style=color:#abb0b6;font-style:italic>/// always returns `None`.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(</span><span style=color:#f29718>any</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"windows"</span><span style=color:#61676ccc>,</span><span> target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"macos"</span><span style=color:#61676ccc>,</span><span> target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"linux"</span><span>)))]
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>preferences_dir</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTPathBuf> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None
</span><span>}
</span></code></pre><h3 id=crates-bevy-platform-src-dirs-windows-rs-33-0><code>crates/bevy_platform/src/dirs/windows.rs</code> (+33/-0)</h3><p>This file contains the Windows-specific implementation using the Windows Shell API. It demonstrates proper handling of Windows API calls with appropriate memory management.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_platform/src/dirs/windows.rs
</span><span style=color:#abb0b6;font-style:italic>// Before: File did not exist
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>extern crate</span><span> windows_sys </span><span style=color:#ed9366>as</span><span> windows</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>ffi</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#fa6e32>c_void</span><span style=color:#61676ccc>,</span><span> OsString}</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>os</span><span style=color:#ed9366>::</span><span>windows</span><span style=color:#ed9366>::</span><span>ffi</span><span style=color:#ed9366>::</span><span>OsStringExt</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>path</span><span style=color:#ed9366>::</span><span>PathBuf</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>slice</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>windows</span><span style=color:#ed9366>::</span><span>Win32</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>UI</span><span style=color:#ed9366>::</span><span>Shell</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Returns the path to the directory used for application settings.
</span><span style=color:#abb0b6;font-style:italic>// From https://github.com/dirs-dev/dirs-sys-rs/blob/main/src/lib.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>allow</span><span>(unsafe_code)]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>known_folder</span><span>(</span><span style=color:#ff8f40>folder_id</span><span style=color:#61676ccc>: </span><span>windows</span><span style=color:#ed9366>::</span><span>core</span><span style=color:#ed9366>::</span><span>GUID) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTPathBuf> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: SHGetKnownFolderPath allocates path_ptr which must be freed with CoTaskMemFree.
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#fa6e32>let mut</span><span> path_ptr</span><span style=color:#61676ccc>: </span><span>windows</span><span style=color:#ed9366>::</span><span>core</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>PWSTR </span><span style=color:#ed9366>= </span><span>std</span><span style=color:#ed9366>::</span><span>ptr</span><span style=color:#ed9366>::</span><span>null_mut()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> result </span><span style=color:#ed9366>=
</span><span>            Shell</span><span style=color:#ed9366>::</span><span>SHGetKnownFolderPath(</span><span style=color:#ed9366>&</span><span>folder_id</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>, </span><span>std</span><span style=color:#ed9366>::</span><span>ptr</span><span style=color:#ed9366>::</span><span>null_mut()</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> path_ptr)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>if</span><span> result </span><span style=color:#ed9366>== </span><span style=color:#ff8f40>0 </span><span>{
</span><span>            </span><span style=color:#fa6e32>let</span><span> len </span><span style=color:#ed9366>= </span><span>windows</span><span style=color:#ed9366>::</span><span>Win32</span><span style=color:#ed9366>::</span><span>Globalization</span><span style=color:#ed9366>::</span><span>lstrlenW(path_ptr) </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>usize</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>let</span><span> path </span><span style=color:#ed9366>= </span><span>slice</span><span style=color:#ed9366>::</span><span>from_raw_parts(path_ptr</span><span style=color:#61676ccc>,</span><span> len)</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>let</span><span> ostr</span><span style=color:#61676ccc>:</span><span> OsString </span><span style=color:#ed9366>= </span><span>OsStringExt</span><span style=color:#ed9366>::</span><span>from_wide(path)</span><span style=color:#61676ccc>;
</span><span>            windows</span><span style=color:#ed9366>::</span><span>Win32</span><span style=color:#ed9366>::</span><span>System</span><span style=color:#ed9366>::</span><span>Com</span><span style=color:#ed9366>::</span><span>CoTaskMemFree(path_ptr </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>*const c_void</span><span>)</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(PathBuf</span><span style=color:#ed9366>::</span><span>from(ostr))
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            windows</span><span style=color:#ed9366>::</span><span>Win32</span><span style=color:#ed9366>::</span><span>System</span><span style=color:#ed9366>::</span><span>Com</span><span style=color:#ed9366>::</span><span>CoTaskMemFree(path_ptr </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>*const c_void</span><span>)</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#55b4d4;font-style:italic>None
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Returns the path to the directory used for application settings.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>preferences_dir</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTPathBuf> {
</span><span>    </span><span style=color:#f07171>known_folder</span><span>(Shell</span><span style=color:#ed9366>::</span><span>FOLDERID_LocalAppData)
</span><span>}
</span></code></pre><h3 id=crates-bevy-platform-src-dirs-linux-rs-7-0><code>crates/bevy_platform/src/dirs/linux.rs</code> (+7/-0)</h3><p>The Linux implementation provides a basic solution using the standard <code>home_dir()</code> function, with a TODO comment acknowledging the need for proper XDG_CONFIG support.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_platform/src/dirs/linux.rs
</span><span style=color:#abb0b6;font-style:italic>// Before: File did not exist
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>{env</span><span style=color:#ed9366>::</span><span>home_dir</span><span style=color:#61676ccc>, </span><span>path</span><span style=color:#ed9366>::</span><span>PathBuf}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Returns the path to the directory used for application settings.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>preferences_dir</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTPathBuf> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// TODO: Support XDG_CONFIG
</span><span>    </span><span style=color:#f07171>home_dir</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>home</span><span>| home</span><span style=color:#ed9366>.</span><span style=color:#f07171>join</span><span>(</span><span style=color:#86b300>".config"</span><span>))
</span><span>}
</span></code></pre><h3 id=crates-bevy-platform-src-dirs-macos-rs-6-0><code>crates/bevy_platform/src/dirs/macos.rs</code> (+6/-0)</h3><p>The macOS implementation follows Apple’s convention for preference storage.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_platform/src/dirs/macos.rs
</span><span style=color:#abb0b6;font-style:italic>// Before: File did not exist
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>{env</span><span style=color:#ed9366>::</span><span>home_dir</span><span style=color:#61676ccc>, </span><span>path</span><span style=color:#ed9366>::</span><span>PathBuf}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Returns the path to the directory used for application settings.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>preferences_dir</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTPathBuf> {
</span><span>    </span><span style=color:#f07171>home_dir</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>home</span><span>| home</span><span style=color:#ed9366>.</span><span style=color:#f07171>join</span><span>(</span><span style=color:#86b300>"Library/Preferences"</span><span>))
</span><span>}
</span></code></pre><h3 id=crates-bevy-platform-cargo-toml-8-0><code>crates/bevy_platform/Cargo.toml</code> (+8/-0)</h3><p>Added Windows-specific dependency on the <code>windows-sys</code> crate with the necessary features for the Shell API calls.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#f51818>// File: crates/bevy_platform/Cargo.toml
</span><span style=color:#f51818>// Before: No windows-sys dependency
</span><span style=color:#f51818>// After addition:
</span><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(windows)'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>windows-sys </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>">= 0.59.0"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"Win32_UI_Shell"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"Win32_Foundation"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"Win32_Globalization"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"Win32_System_Com"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><h3 id=crates-bevy-platform-src-lib-rs-2-0><code>crates/bevy_platform/src/lib.rs</code> (+2/-0)</h3><p>Added the new <code>dirs</code> module to the public API when the standard library is available.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_platform/src/lib.rs
</span><span style=color:#abb0b6;font-style:italic>// Before: No dirs module
</span><span style=color:#abb0b6;font-style:italic>// After addition (in the cfg::std! block):
</span><span>    </span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>dirs</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=release-content-release-notes-platform-dirs-md-8-0><code>release-content/release-notes/platform_dirs.md</code> (+8/-0)</h3><p>Created release notes to document the new feature for users.<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>// File: release-content/release-notes/platform_dirs.md
</span><span>// Before: File did not exist
</span><span>// After:
</span><span style=color:#fa6e32;font-weight:700>---
</span><span>title: "bevy_platform standard directories"
</span><span>authors: ["@viridia"]
</span><span>pull_requests: [22891]
</span><span style=color:#fa6e32;font-weight:700>---
</span><span>
</span><span>The </span><span style=color:#ed9366;background-color:#61676c10>`dirs`</span><span> module in </span><span style=color:#ed9366;background-color:#61676c10>`bevy_platform`</span><span> provides the location of standard directories in the
</span><span>filesystem. Currently this includes the directory for storing application preferences.
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/dirs-dev/dirs-rs target=_blank>dirs-rs GitHub Repository</a> - A popular Rust crate for accessing standard directories, which served as inspiration for this implementation<li><a rel="noopener nofollow noreferrer" href=https://docs.microsoft.com/en-us/windows/win32/api/shlobj_core/ target=_blank>Windows Shell API Documentation</a> - Microsoft’s official documentation for the Windows Shell APIs used in this PR<li><a rel="noopener nofollow noreferrer" href=https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html target=_blank>XDG Base Directory Specification</a> - The standard for user directories on Linux and other Unix-like systems<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Rust Conditional Compilation</a> - Rust’s <code>cfg</code> attribute for platform-specific code<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/13311 target=_blank>Bevy Issue #13311</a> - The larger issue tracking cross-platform utility development in Bevy</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_platform/Cargo.toml b/crates/bevy_platform/Cargo.toml
</span><span>index d1af7a805be4f..ecfffdc105e02 100644
</span><span>--- a/crates/bevy_platform/Cargo.toml
</span><span>+++ b/crates/bevy_platform/Cargo.toml
</span><span>@@ -97,6 +97,14 @@ spin = { version = "0.10.0", default-features = false, features = [
</span><span> [target.'cfg(not(target_has_atomic = "ptr"))'.dependencies]
</span><span> portable-atomic-util = { version = "0.2.4", default-features = false }
</span><span> 
</span><span>+[target.'cfg(windows)'.dependencies]
</span><span>+windows-sys = { version = ">= 0.59.0", features = [
</span><span>+  "Win32_UI_Shell",
</span><span>+  "Win32_Foundation",
</span><span>+  "Win32_Globalization",
</span><span>+  "Win32_System_Com",
</span><span>+] }
</span><span>+
</span><span> [lints]
</span><span> workspace = true
</span><span> 
</span><span>diff --git a/crates/bevy_platform/src/dirs/linux.rs b/crates/bevy_platform/src/dirs/linux.rs
</span><span>new file mode 100644
</span><span>index 0000000000000..c5cce1461c214
</span><span>--- /dev/null
</span><span>+++ b/crates/bevy_platform/src/dirs/linux.rs
</span><span>@@ -0,0 +1,7 @@
</span><span>+use std::{env::home_dir, path::PathBuf};
</span><span>+
</span><span>+/// Returns the path to the directory used for application settings.
</span><span>+pub fn preferences_dir() -> Option&LTPathBuf> {
</span><span>+    // TODO: Support XDG_CONFIG
</span><span>+    home_dir().map(|home| home.join(".config"))
</span><span>+}
</span><span>diff --git a/crates/bevy_platform/src/dirs/macos.rs b/crates/bevy_platform/src/dirs/macos.rs
</span><span>new file mode 100644
</span><span>index 0000000000000..31eb77dbdd6bf
</span><span>--- /dev/null
</span><span>+++ b/crates/bevy_platform/src/dirs/macos.rs
</span><span>@@ -0,0 +1,6 @@
</span><span>+use std::{env::home_dir, path::PathBuf};
</span><span>+
</span><span>+/// Returns the path to the directory used for application settings.
</span><span>+pub fn preferences_dir() -> Option&LTPathBuf> {
</span><span>+    home_dir().map(|home| home.join("Library/Preferences"))
</span><span>+}
</span><span>diff --git a/crates/bevy_platform/src/dirs/mod.rs b/crates/bevy_platform/src/dirs/mod.rs
</span><span>new file mode 100644
</span><span>index 0000000000000..a4b2a9d2331f2
</span><span>--- /dev/null
</span><span>+++ b/crates/bevy_platform/src/dirs/mod.rs
</span><span>@@ -0,0 +1,28 @@
</span><span>+//! APIs that return the location of standard user directories.
</span><span>+
</span><span>+// Modeled after https://github.com/dirs-dev/dirs-sys-rs/
</span><span>+
</span><span>+#[cfg(not(any(target_os = "windows", target_os = "macos", target_os = "linux")))]
</span><span>+use std::path::PathBuf;
</span><span>+
</span><span>+#[cfg(target_os = "windows")]
</span><span>+mod windows;
</span><span>+#[cfg(target_os = "windows")]
</span><span>+pub use windows::preferences_dir;
</span><span>+
</span><span>+#[cfg(target_os = "macos")]
</span><span>+mod macos;
</span><span>+#[cfg(target_os = "macos")]
</span><span>+pub use macos::preferences_dir;
</span><span>+
</span><span>+#[cfg(target_os = "linux")]
</span><span>+mod linux;
</span><span>+#[cfg(target_os = "linux")]
</span><span>+pub use linux::preferences_dir;
</span><span>+
</span><span>+/// Returns the path to the directory used for application settings. This version
</span><span>+/// always returns `None`.
</span><span>+#[cfg(not(any(target_os = "windows", target_os = "macos", target_os = "linux")))]
</span><span>+pub fn preferences_dir() -> Option&LTPathBuf> {
</span><span>+    None
</span><span>+}
</span><span>diff --git a/crates/bevy_platform/src/dirs/windows.rs b/crates/bevy_platform/src/dirs/windows.rs
</span><span>new file mode 100644
</span><span>index 0000000000000..983ef26b7e3c4
</span><span>--- /dev/null
</span><span>+++ b/crates/bevy_platform/src/dirs/windows.rs
</span><span>@@ -0,0 +1,33 @@
</span><span>+extern crate windows_sys as windows;
</span><span>+use std::ffi::{c_void, OsString};
</span><span>+use std::os::windows::ffi::OsStringExt;
</span><span>+use std::path::PathBuf;
</span><span>+use std::slice;
</span><span>+use windows::Win32::UI::Shell;
</span><span>+
</span><span>+/// Returns the path to the directory used for application settings.
</span><span>+// From https://github.com/dirs-dev/dirs-sys-rs/blob/main/src/lib.rs
</span><span>+#[allow(unsafe_code)]
</span><span>+fn known_folder(folder_id: windows::core::GUID) -> Option&LTPathBuf> {
</span><span>+    // SAFETY: SHGetKnownFolderPath allocates path_ptr which must be freed with CoTaskMemFree.
</span><span>+    unsafe {
</span><span>+        let mut path_ptr: windows::core::PWSTR = std::ptr::null_mut();
</span><span>+        let result =
</span><span>+            Shell::SHGetKnownFolderPath(&folder_id, 0, std::ptr::null_mut(), &mut path_ptr);
</span><span>+        if result == 0 {
</span><span>+            let len = windows::Win32::Globalization::lstrlenW(path_ptr) as usize;
</span><span>+            let path = slice::from_raw_parts(path_ptr, len);
</span><span>+            let ostr: OsString = OsStringExt::from_wide(path);
</span><span>+            windows::Win32::System::Com::CoTaskMemFree(path_ptr as *const c_void);
</span><span>+            Some(PathBuf::from(ostr))
</span><span>+        } else {
</span><span>+            windows::Win32::System::Com::CoTaskMemFree(path_ptr as *const c_void);
</span><span>+            None
</span><span>+        }
</span><span>+    }
</span><span>+}
</span><span>+
</span><span>+/// Returns the path to the directory used for application settings.
</span><span>+pub fn preferences_dir() -> Option&LTPathBuf> {
</span><span>+    known_folder(Shell::FOLDERID_LocalAppData)
</span><span>+}
</span><span>diff --git a/crates/bevy_platform/src/lib.rs b/crates/bevy_platform/src/lib.rs
</span><span>index b4ff694f1187f..3422bcd0b1607 100644
</span><span>--- a/crates/bevy_platform/src/lib.rs
</span><span>+++ b/crates/bevy_platform/src/lib.rs
</span><span>@@ -11,6 +11,8 @@
</span><span> 
</span><span> cfg::std! {
</span><span>     extern crate std;
</span><span>+
</span><span>+    pub mod dirs;
</span><span> }
</span><span> 
</span><span> cfg::alloc! {
</span><span>diff --git a/release-content/release-notes/platform_dirs.md b/release-content/release-notes/platform_dirs.md
</span><span>new file mode 100644
</span><span>index 0000000000000..26a424da9acc0
</span><span>--- /dev/null
</span><span>+++ b/release-content/release-notes/platform_dirs.md
</span><span>@@ -0,0 +1,8 @@
</span><span>+---
</span><span>+title: "bevy_platform standard directories"
</span><span>+authors: ["@viridia"]
</span><span>+pull_requests: [22891]
</span><span>+---
</span><span>+
</span><span>+The `dirs` module in `bevy_platform` provides the location of standard directories in the
</span><span>+filesystem. Currently this includes the directory for storing application preferences.
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22891.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>