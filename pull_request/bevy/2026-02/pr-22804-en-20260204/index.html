<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22804 document bevy light
        
    </title><meta content="#22804 document bevy light" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-04</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22804-zh-cn-20260204>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>document bevy light<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: document bevy light<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22804<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-Rendering, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2026-02-04T09:00:10Z<li><strong>Merged</strong>: 2026-02-04T20:15:40Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The original description was already in English, so it’s included as-is:<h1 id=objective>Objective</h1><ul><li>yeet another <code>#![expect(missing_docs, reason = "Not all docs are written yet, see #3492.")]</code> from a rendering crate i extracted<li>yeet some stale code</ul><h2 id=solution>Solution</h2><ul><li>document</ul><h2 id=testing>Testing</h2><ul><li>ran lighting, deferred, shadow_biases, and a couple other examples. looks fine.</ul><p>note: review commit by commit<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses two straightforward but important tasks in the Bevy rendering codebase: improving documentation quality and removing stale code. The changes focus on the newly extracted <code>bevy_light</code> crate, which handles all lighting-related components and systems in Bevy.<p>The primary issue was that the crate had a blanket <code>expect</code> attribute suppressing documentation warnings, allowing many undocumented public APIs to accumulate. While the initial extraction was functionally complete, it lacked the necessary documentation for developers to understand and use the lighting system effectively. Additionally, during the extraction process, some code became redundant or was left behind without proper cleanup.<p>The approach taken is systematic and practical. For each module in the <code>bevy_light</code> crate, missing documentation was added to public types, fields, and functions. This includes:<ul><li>Module-level documentation explaining the purpose of each module<li>Documentation for struct fields that were previously undocumented<li>Documentation for constants and enum variants<li>Clarification of parameter types and return values</ul><p>Simultaneously, the PR identifies and removes stale code that’s no longer needed. This includes cleaning up a cluster initialization system that had been made redundant by component registration changes, and simplifying cascade shadow building by merging two separate systems into one.<p>One notable technical decision was to remove the <code>add_clusters</code> system entirely. Analysis revealed that this system was inserting <code>Clusters</code> components on cameras, but the same functionality could be achieved more cleanly using Bevy’s component registration system. By registering <code>Clusters</code> as a required component for <code>Camera3d</code>, the framework automatically ensures these components exist when needed, eliminating the need for a separate initialization system.<p>The cascade shadow system also received attention. Previously, two separate systems handled cascade management: <code>clear_directional_light_cascades</code> and <code>build_directional_light_cascades</code>. These were merged into a single system that handles both clearing and building in one pass, reducing system overhead and simplifying the execution graph.<p>Throughout the implementation, the developer maintained consistency with existing Bevy conventions. Documentation follows the established style, with technical terms preserved in English where they represent specific concepts (like “frustum”, “cascade”, “scattering medium”), while explanatory text provides necessary context.<p>The impact of these changes is primarily on developer experience and code maintainability. New developers exploring the lighting system will now find comprehensive documentation explaining what each component does and how to use it. The removal of stale code reduces cognitive load when reading the codebase and eliminates potential sources of bugs.<p>From an architectural perspective, the changes demonstrate good practices in evolving a codebase: documenting as you go, cleaning up after refactoring, and simplifying system graphs where possible. The PR also shows how Bevy’s component registration system can replace custom initialization logic, leveraging the engine’s built-in capabilities.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_light crate] --> B[Module Documentation]
</span><span>    A --> C[Type Documentation]
</span><span>    A --> D[Function Documentation]
</span><span>    A --> E[Code Cleanup]
</span><span>    
</span><span>    B --> F[ambient_light]
</span><span>    B --> G[atmosphere]
</span><span>    B --> H[cascade]
</span><span>    B --> I[cluster]
</span><span>    B --> J[directional_light]
</span><span>    B --> K[point_light]
</span><span>    B --> L[probe]
</span><span>    B --> M[spot_light]
</span><span>    B --> N[volumetric]
</span><span>    
</span><span>    E --> O[Remove add_clusters system]
</span><span>    E --> P[Merge cascade systems]
</span><span>    E --> Q[Fix cluster config query]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-light-src-lib-rs-26-25><code>crates/bevy_light/src/lib.rs</code> (+26/-25)</h3><p>This file serves as the main entry point for the lighting crate. The changes remove the blanket documentation suppression and add comprehensive documentation throughout.<p><strong>Key Changes:</strong><ol><li>Removed the <code>expect</code> attribute that was suppressing documentation warnings<li>Added module-level documentation explaining the crate’s purpose<li>Added documentation for the <code>gizmos</code> module when the feature is enabled<li>Documented constants in the <code>light_consts</code> module<li>Added documentation for the <code>LightPlugin</code> struct<li>Simplified system scheduling by removing the <code>add_clusters</code> system and merging cascade systems<li>Added documentation for visibility checking systems</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>expect</span><span>(missing_docs</span><span style=color:#61676ccc>,</span><span> reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Not all docs are written yet, see #3492."</span><span>)]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>//! Provides component types for lighting a bevy scene. This includes the usual
</span><span style=color:#abb0b6;font-style:italic>//! directional, point, and spot lights, as well as light probes, atmosphere,
</span><span style=color:#abb0b6;font-style:italic>//! other volumetrics, and shadow configuration.
</span></code></pre><h3 id=crates-bevy-light-src-cluster-mod-rs-16-30><code>crates/bevy_light/src/cluster/mod.rs</code> (+16/-30)</h3><p>This module handles spatial clustering of lights and other renderable objects for performance optimization. The changes add documentation and remove stale code.<p><strong>Key Changes:</strong><ol><li>Updated module documentation to better explain the purpose<li>Added documentation for <code>GlobalClusterSettings</code> struct<li>Documented fields in <code>ClusterConfig</code> enum variants<li>Added comprehensive documentation for <code>Clusters</code> struct and its fields<li>Removed the <code>add_clusters</code> system function which was made redundant by component registration</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>add_clusters</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>cameras</span><span style=color:#61676ccc>: </span><span>Query<(Entity, </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>ClusterConfig>, </span><span style=color:#ed9366>&</span><span>Camera), (Without&LTClusters>, With&LTCamera3d>)>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... initialization logic
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// No add_clusters system - handled by component registration
</span></code></pre><h3 id=crates-bevy-light-src-cascade-rs-16-14><code>crates/bevy_light/src/cascade.rs</code> (+16/-14)</h3><p>This module handles shadow cascades for directional lights. The changes improve documentation and simplify the system architecture.<p><strong>Key Changes:</strong><ol><li>Added module documentation<li>Added documentation for <code>Cascades</code> and <code>Cascade</code> structs<li>Removed the separate <code>clear_directional_light_cascades</code> system and merged its functionality into <code>build_directional_light_cascades</code><li>Improved comments about matrix orthogonality in cascade building</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>clear_directional_light_cascades</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>lights</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span>DirectionalLight, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Cascades)>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Clearing logic
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>build_directional_light_cascades</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Building logic without clearing
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>build_directional_light_cascades</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Building logic with clearing integrated
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Clear at the beginning
</span><span>    cascades</span><span style=color:#ed9366>.</span><span>cascades</span><span style=color:#ed9366>.</span><span style=color:#f07171>clear</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... rest of building logic
</span><span>}
</span></code></pre><h3 id=crates-bevy-light-src-atmosphere-rs-10-5><code>crates/bevy_light/src/atmosphere.rs</code> (+10/-5)</h3><p>This module handles atmospheric lighting and scattering effects. The changes add missing documentation.<p><strong>Key Changes:</strong><ol><li>Added module documentation<li>Documented the <code>earthlike</code> constructor for <code>Atmosphere</code><li>Converted regular comments to doc comments for <code>ScatteringMedium</code> methods<li>Added documentation for <code>Falloff::sample</code> and <code>PhaseFunction::sample</code> methods</ol><h3 id=crates-bevy-pbr-src-lib-rs-2-13><code>crates/bevy_pbr/src/lib.rs</code> (+2/-13)</h3><p>This is the main Physically Based Rendering (PBR) crate. The changes remove redundant system set configuration now that the <code>LightPlugin</code> handles it.<p><strong>Key Changes:</strong><ol><li>Removed system set configuration for cluster-related systems that are now handled by <code>LightPlugin</code><li>This simplification ensures there’s no duplication or conflict between plugins</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>configure_sets</span><span>(
</span><span>    PostUpdate</span><span style=color:#61676ccc>,
</span><span>    (
</span><span>        SimulationLightSystems</span><span style=color:#ed9366>::</span><span>AddClusters</span><span style=color:#61676ccc>,
</span><span>        SimulationLightSystems</span><span style=color:#ed9366>::</span><span>AssignLightsToClusters</span><span style=color:#61676ccc>,
</span><span>    )
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>chain</span><span>()</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// Configuration removed - handled by LightPlugin
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Documentation Guidelines</strong>: For understanding the documentation standards used in this PR<li><strong>Bevy Component Registration</strong>: To understand how required component registration works<li><strong>Spatial Clustering in Graphics</strong>: For background on why clustering is used for lighting performance<li><strong>Cascade Shadow Maps</strong>: To understand the technical details of cascade shadow implementation<li><strong>Atmospheric Scattering</strong>: For the physics and mathematics behind the atmosphere rendering techniques</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22804.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>