<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22911 `clear_all()` clears all (non-send data)
        
    </title><meta content="#22911 `clear_all()` clears all (non-send data)" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-22911-zh-cn-20260217>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: <code>clear_all()</code> clears all (non-send data)<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22911<li><strong>Author</strong>: Trashtalk217<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, S-Ready-For-Final-Review, M-Migration-Guide<li><strong>Created</strong>: 2026-02-11T15:47:11Z<li><strong>Merged</strong>: 2026-02-17T00:17:53Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Since #20934, <code>World::clear_all</code> and <code>World::clear_all_entities</code> behave identically. <code>World::clear_all</code> used to clear all resources and entities, but since resources are now components, <code>World::clear_all_entities</code> also does this.<h2 id=solution>Solution</h2><p>Since <code>World::clear_all_non_send()</code> was not included in <code>World::clear_all</code>, I’ve decided to include it.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem originated from a fundamental architectural change in Bevy’s ECS system. In PR #20934, resources were reimplemented as components. This architectural shift had subtle implications for API consistency that weren’t fully addressed initially.<p>Before this change, <code>World::clear_all</code> was documented to clear all entities and resources. However, after the resources-as-components change, <code>World::clear_entities</code> also cleared resources because resources were now just special entities with component data. This created an inconsistency where <code>clear_all</code> and <code>clear_all_entities</code> behaved identically, which was misleading from an API design perspective.<p>The specific gap was that <code>clear_all</code> wasn’t clearing non-send data. Non-send data refers to data that cannot be safely sent between threads in Rust’s ownership model - typically data that contains thread-local resources or doesn’t implement the <code>Send</code> trait. In Bevy’s ECS, non-send data is stored separately from regular components and resources.<p>The developer identified this inconsistency and proposed a straightforward solution: update <code>World::clear_all</code> to also clear non-send data by calling <code>clear_non_send()</code>. This restores the intuitive expectation that <code>clear_all</code> truly clears everything in the world, including non-send data.<p>The implementation is minimal but important for API consistency. The change modifies the <code>clear_all</code> method to call both <code>clear_entities</code> and <code>clear_non_send</code>. This ensures that after calling <code>clear_all</code>, the world is completely empty - no entities, no resources, and no non-send data remain.<p>From a technical perspective, this change is about maintaining API contracts and developer expectations. When a method is named <code>clear_all</code>, developers reasonably expect it to clear everything. The previous implementation violated this expectation by omitting non-send data.<p>The migration guide update is equally important. It ensures that developers who read the migration guide understand the new behavior and can adjust their code accordingly. Without this documentation update, developers might not realize that <code>clear_all</code> now has broader scope.<p>This PR demonstrates a common pattern in API evolution: when underlying architectural changes affect multiple methods, it’s important to review all related APIs for consistency. The fix is simple but addresses a real usability issue where method names don’t accurately reflect their behavior.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[World::clear_all] --> B[clear_entities]
</span><span>    A --> C[clear_non_send]
</span><span>    B --> D[Clears all entities]
</span><span>    B --> E[Clears resources (as components)]
</span><span>    C --> F[Clears non-send data]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-world-mod-rs-4-5><code>crates/bevy_ecs/src/world/mod.rs</code> (+4/-5)</h3><p>This file contains the main implementation change. The <code>clear_all</code> method is updated to clear non-send data in addition to entities.<p><strong>Changes:</strong><ul><li>Updated documentation to reflect that <code>clear_all</code> now clears entities, resources, AND non-send data<li>Added <code>self.clear_non_send()</code> call to the implementation</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>/// Clears all entities and resources, invalidating all [`Entity`] and resource fetches
</span><span style=color:#abb0b6;font-style:italic>/// such as [`Res`](crate::system::Res), [`ResMut`](crate::system::ResMut)
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// Since resources are entities, this is identical to [`clear_entities`](Self::clear_entities).
</span><span style=color:#abb0b6;font-style:italic>/// Non-send data is not cleared.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>clear_all</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>clear_entities</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// Clears all entities, resources, and non-send data.
</span><span style=color:#abb0b6;font-style:italic>/// This invalidates all [`Entity`] and resource fetches such as [`Res`](crate::system::Res),
</span><span style=color:#abb0b6;font-style:italic>/// [`ResMut`](crate::system::ResMut)
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>clear_all</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>clear_entities</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>clear_non_send</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=release-content-migration-guides-resources-as-components-md-1-1><code>release-content/migration-guides/resources_as_components.md</code> (+1/-1)</h3><p>This file is updated to document the change in behavior for <code>clear_all</code> in the migration guide.<p><strong>Changes:</strong><ul><li>Updated the migration guide to note that <code>World::clear_all</code> now clears entities, resources, AND non-send data</ul><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>// Before:
</span><span>Next, </span><span style=color:#ed9366;background-color:#61676c10>`World::clear_entities`</span><span> now also clears all resources.
</span><span>
</span><span>// After:
</span><span>Next, </span><span style=color:#ed9366;background-color:#61676c10>`World::clear_entities`</span><span> now also clears all resources, and </span><span style=color:#ed9366;background-color:#61676c10>`World::clear_all`</span><span> now clears all entities, resources, and non-send data.
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Bevy ECS Architecture</strong>: Understanding how Bevy’s ECS stores data separately for entities, resources, and non-send data is fundamental to working with the system effectively.</p><li><p><strong>Rust Send and Sync Traits</strong>: The distinction between send and non-send data is rooted in Rust’s concurrency model. Understanding <code>Send</code> and <code>Sync</code> traits is essential for working with thread-safe data in Rust.</p><li><p><strong>API Design Principles</strong>: This change illustrates the importance of method names accurately reflecting their behavior. The principle of “least surprise” in API design suggests that methods should behave as their names imply.</p><li><p><strong>Migration Guide Patterns</strong>: The inclusion of this change in the migration guide demonstrates best practices for maintaining documentation when APIs evolve.</p></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_22911.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>