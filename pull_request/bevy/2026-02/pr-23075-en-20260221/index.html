<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #23075 Enable the rustdoc "--generate-macro-expansion" feature
        
    </title><meta content='#23075 Enable the rustdoc "--generate-macro-expansion" feature' property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-02/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-02-21</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-02/pr-23075-zh-cn-20260221>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Enable the rustdoc “–generate-macro-expansion” feature<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/23075<li><strong>Author</strong>: GuillaumeGomez<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-Build-System, A-Cross-Cutting, D-Straightforward, S-Needs-Review<li><strong>Created</strong>: 2026-02-20T12:31:58Z<li><strong>Merged</strong>: 2026-02-21T00:55:38Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p>You can see this feature in action in the compiler docs like <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_ast_lowering/errors.rs.html#323 target=_blank>here</a> or <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_ast_lowering/format.rs.html#89 target=_blank>here</a>.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a documentation improvement for the Bevy game engine by enabling the rustdoc <code>--generate-macro-expansion</code> feature across the entire codebase. The change is straightforward but widespread, affecting documentation generation for all Bevy crates.<p>The core issue was that developers reading Bevy’s documentation couldn’t easily see the expanded code when macros were used. In Rust, macros can generate complex code, and understanding what a macro actually produces requires either manually expanding it or relying on external tools. The <code>--generate-macro-expansion</code> rustdoc flag solves this by automatically including macro expansions in the generated documentation.<p>The implementation approach was systematic: enable this feature at multiple levels where documentation is generated. First, the root <code>Cargo.toml</code> was updated to add <code>--generate-macro-expansion</code> to the <code>rustdoc-args</code> for the entire workspace. This ensures that when running <code>cargo doc</code> from the workspace root, the feature is enabled.<p>However, documentation generation on docs.rs uses per-crate metadata settings, not workspace-level settings. Therefore, the PR needed to update every single crate’s <code>Cargo.toml</code> file to include the flag in their <code>[package.metadata.docs.rs]</code> sections. This explains why 59 crate files were modified - each Bevy crate needed this configuration to ensure documentation built on docs.rs includes macro expansions.<p>The GitHub workflow for documentation also required updating. The <code>.github/workflows/docs.yml</code> file needed the flag added to the <code>RUSTDOCFLAGS</code> environment variable to ensure CI-built documentation includes the macro expansions.<p>The technical implementation is consistent across all files: each crate’s <code>Cargo.toml</code> had a <code>rustdoc-args</code> array that previously contained <code>-Zunstable-options</code> and <code>--generate-link-to-definition</code>. The PR simply adds <code>--generate-macro-expansion</code> as a third argument in the array.<p>The <code>-Zunstable-options</code> flag is necessary because <code>--generate-macro-expansion</code> is still an unstable rustdoc feature. This aligns with Bevy’s existing documentation setup, which already uses other unstable rustdoc features like <code>--generate-link-to-definition</code>.<p>This change has a low runtime impact - it only affects documentation generation, not the actual compilation or execution of Bevy code. The documentation builds might take slightly longer and produce larger output due to the inclusion of macro expansions, but this is an acceptable tradeoff for improved developer experience.<p>The benefit is clear: developers can now click to see macro expansions directly in the documentation, making it easier to understand what macros like <code>derive</code> attributes or procedural macros actually generate. This is particularly valuable in a game engine like Bevy where macros are extensively used for ECS components, resources, and other abstractions.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Root Cargo.toml] -->|Sets workspace-wide| B[Documentation Generation]
</span><span>    C[59 Crate Cargo.toml files] -->|Each sets per-crate| B
</span><span>    D[GitHub Workflow] -->|Sets CI environment| B
</span><span>    B --> E[Rustdoc with --generate-macro-expansion]
</span><span>    E --> F[Documentation with Macro Expansions]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=root-configuration-files>Root Configuration Files</h3><ol><li><strong>File: <code>.github/workflows/docs.yml</code></strong> <ul><li><strong>Change</strong>: Added <code>--generate-macro-expansion</code> to <code>RUSTDOCFLAGS</code><li><strong>Purpose</strong>: Ensures CI-generated documentation includes macro expansions<li><strong>Code snippet</strong>:</ul></ol><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>RUSTDOCFLAGS</span><span style=color:#61676ccc>: </span><span style=color:#86b300>-Zunstable-options --cfg=docsrs --generate-link-to-definition --html-after-content docs-rs/trait-tags.html
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>RUSTDOCFLAGS</span><span style=color:#61676ccc>: </span><span style=color:#86b300>-Zunstable-options --cfg=docsrs --generate-link-to-definition --generate-macro-expansion --html-after-content docs-rs/trait-tags.html
</span></code></pre><ol start=2><li><strong>File: <code>Cargo.toml</code> (root)</strong> <ul><li><strong>Change</strong>: Added <code>--generate-macro-expansion</code> to workspace <code>rustdoc-args</code><li><strong>Purpose</strong>: Sets default for <code>cargo doc</code> commands in the workspace<li><strong>Code snippet</strong>:</ul></ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>rustdoc-args </span><span>= [
</span><span>  </span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--generate-link-to-definition"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>rustdoc-args </span><span>= [
</span><span>  </span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--generate-link-to-definition"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--generate-macro-expansion"</span><span style=color:#61676ccc>,
</span><span>]
</span></code></pre><h3 id=crate-configuration-files-representative-example>Crate Configuration Files (Representative Example)</h3><ol start=3><li><strong>File: <code>crates/bevy_ecs/Cargo.toml</code></strong> <ul><li><strong>Change</strong>: Added <code>--generate-macro-expansion</code> to crate’s <code>rustdoc-args</code><li><strong>Purpose</strong>: Ensures docs.rs documentation for this crate includes macro expansions<li><strong>Code snippet</strong>:</ul></ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>docs</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>rs</span><span>]
</span><span style=color:#399ee6>rustdoc-args </span><span>= [</span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"--generate-link-to-definition"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>docs</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>rs</span><span>]
</span><span style=color:#399ee6>rustdoc-args </span><span>= [
</span><span>  </span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--generate-link-to-definition"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--generate-macro-expansion"</span><span style=color:#61676ccc>,
</span><span>]
</span></code></pre><p><strong>Note</strong>: The same pattern was applied to all 59 crate <code>Cargo.toml</code> files, including:<ul><li><code>crates/bevy_app/Cargo.toml</code><li><code>crates/bevy_render/Cargo.toml</code><li><code>crates/bevy_ecs/macros/Cargo.toml</code><li>And 56 other crate configuration files</ul><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustdoc/unstable-features.html target=_blank>Rustdoc Documentation on Unstable Features</a><li><a rel="noopener nofollow noreferrer" href=https://blog.rust-lang.org/inside-rust/2023/09/27/macro-expansions-in-rustdoc.html target=_blank>Rust Blog: Macro Expansions in rustdoc</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustdoc/unstable-features.html#generate-link-to-definition target=_blank>Rustdoc <code>--generate-link-to-definition</code> Feature</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/cargo-targets.html#configuring-a-target target=_blank>Cargo Documentation on <code>package.metadata.docs.rs</code></a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-02/pr_23075.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>