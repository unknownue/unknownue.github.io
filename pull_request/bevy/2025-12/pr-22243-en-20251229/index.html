<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22243 Make `update_tilemap_chunk_indices` public
        
    </title><meta content="#22243 Make `update_tilemap_chunk_indices` public" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22243-zh-cn-20251229>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Make <code>update_tilemap_chunk_indices</code> public<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22243<li><strong>Author</strong>: apekros<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-23T09:40:51Z<li><strong>Merged</strong>: 2025-12-29T06:26:24Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #22145<h2 id=solution>Solution</h2><p>Following @alice-i-cecile simple suggestion of making <code>update_tilemap_chunk_indices</code> public.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but significant API completeness issue in Bevy’s tilemap system. The core problem was that a critical function for managing tilemap chunk indices wasn’t accessible to users who needed to trigger manual updates.<p>In Bevy’s tilemap rendering system, chunks are used to optimize rendering by grouping tiles into manageable batches. The <code>update_tilemap_chunk_indices</code> function handles the recalculation of these chunks when tiles change position or state. However, this function was marked as private, making it unavailable for external use cases where developers needed to manually trigger chunk updates.<p>The issue #22145 highlighted a concrete scenario where this limitation became problematic. Without access to <code>update_tilemap_chunk_indices</code>, developers working with custom tile manipulation logic couldn’t properly synchronize the chunk system with their changes, potentially leading to rendering artifacts or incorrect tile behavior.<p>The solution follows a direct pattern common in API design: when a utility function serves a clear purpose that extends beyond internal system use, making it public provides flexibility for advanced use cases. The change itself is minimal but meaningful—adding the <code>pub</code> keyword transforms the function from an internal implementation detail to a public API surface.<p>This approach aligns with Rust’s principle of exposing only what’s necessary while recognizing when utilities have legitimate external applications. The function signature and implementation remain unchanged; only its visibility is modified, ensuring backward compatibility for existing code that might already be using the tilemap systems through standard Bevy APIs.<p>From an architectural perspective, this change demonstrates good API evolution. The function was already well-designed for its internal role, with appropriate parameters and return types. Making it public simply extends its utility without requiring any redesign. This is a low-risk change that solves a concrete developer pain point.<p>The impact is practical: developers can now call <code>update_tilemap_chunk_indices</code> directly when implementing custom tile manipulation logic, animation systems, or procedural generation that modifies tile positions outside the standard Bevy systems. This provides the flexibility needed for advanced 2D game development scenarios while maintaining the existing automatic update behavior for typical use cases.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Tilemap System] --> B[update_tilemap_chunk_indices]
</span><span>    B --> C[Internal Systems]
</span><span>    B --> D[External User Code]
</span><span>    C --> E[Automatic Updates]
</span><span>    D --> F[Manual Updates]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-sprite-render-src-tilemap-chunk-mod-rs-1-1><code>crates/bevy_sprite_render/src/tilemap_chunk/mod.rs</code> (+1/-1)</h3><p>This file contains the tilemap chunk management system. The change modifies a single function’s visibility from private to public, enabling external access to chunk index updates.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>update_tilemap_chunk_indices</span><span>(
</span><span>    </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<
</span><span>        (
</span><span>            Entity,
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_tilemap_chunk_indices</span><span>(
</span><span>    </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<
</span><span>        (
</span><span>            Entity,
</span></code></pre><p>The modification is minimal: adding the <code>pub</code> keyword before the function name. This change allows the function to be called from other modules or user code while maintaining its existing implementation and behavior.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch07-02-defining-modules-to-control-scope-and-privacy.html target=_blank>Rust Visibility and Privacy</a> - Understanding Rust’s module system and visibility controls<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/sprite/struct.Tilemap.html target=_blank>Bevy Tilemap Documentation</a> - Official documentation for Bevy’s tilemap system<li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/ target=_blank>API Design Principles</a> - Rust API guidelines for designing public interfaces<li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/systems.html target=_blank>Bevy ECS System Functions</a> - How system functions work in Bevy’s ECS</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_sprite_render/src/tilemap_chunk/mod.rs b/crates/bevy_sprite_render/src/tilemap_chunk/mod.rs
</span><span>index 8b4f062873262..6832b6b5f9bb5 100644
</span><span>--- a/crates/bevy_sprite_render/src/tilemap_chunk/mod.rs
</span><span>+++ b/crates/bevy_sprite_render/src/tilemap_chunk/mod.rs
</span><span>@@ -182,7 +182,7 @@ fn on_insert_tilemap_chunk(mut world: DeferredWorld, HookContext { entity, .. }:
</span><span>         .insert((Mesh2d(mesh), MeshMaterial2d(material)));
</span><span> }
</span><span> 
</span><span>-fn update_tilemap_chunk_indices(
</span><span>+pub fn update_tilemap_chunk_indices(
</span><span>     query: Query<
</span><span>         (
</span><span>             Entity,
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22243.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>