<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21827 Add vertical slider support to bevy_ui_widgets slider
        
    </title><meta content="#21827 Add vertical slider support to bevy_ui_widgets slider" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-09</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-12/pr-21827-en-20251209>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=add-vertical-slider-support-to-bevy-ui-widgets-slider>Add vertical slider support to bevy_ui_widgets slider</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add vertical slider support to bevy_ui_widgets slider<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21827<li><strong>Author</strong>: DuckyBlender<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-UI, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-11-13T15:37:03Z<li><strong>Merged</strong>: 2025-12-09T05:40:08Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=miao-shu-fan-yi>描述翻译</h2><h3 id=mu-biao>目标</h3><ul><li>修复垂直滑块无法正常工作的问题。之前创建垂直滑块时，滑块拖动行为仍然是水平的，意味着左右拖动会改变值而不是上下拖动。此外，点击滑块轨道的位置存在偏移，无法正确映射到点击位置。</ul><h3 id=jie-jue-fang-an>解决方案</h3><p>滑块控件现在根据节点尺寸自动检测方向（<code>高度 > 宽度</code> 为垂直方向，否则为水平方向），并相应调整交互行为：<ol><li><p><strong>方向检测</strong>：在 <code>slider_on_pointer_down</code> 和 <code>slider_on_drag</code> 函数中，通过比较 <code>node.size().y</code> 和 <code>node.size().x</code> 添加了滑块方向自动检测。</p><li><p><strong>拖动方向修复</strong>：</p> <ul><li>对于垂直滑块，拖动计算现在使用 Y 轴（<code>distance.y</code>）而不是 X 轴<li>Y 坐标被正确反转（因为屏幕 Y 向下增加）以匹配预期行为（向上拖动增加值）<li>滑块尺寸计算对垂直滑块使用 <code>thumb.size().y</code>，而不是总是使用 <code>thumb.size().x</code></ul><li><p><strong>点击位置修复</strong>：</p> <ul><li>修复了从 Bevy 的中心原点坐标系到左上角原点坐标系的坐标转换<li>对于垂直滑块：在计算滑块值之前，将 <code>local_pos.y</code> 从 <code>[-高度/2, +高度/2]</code> 转换为 <code>[0, 高度]</code><li>考虑滑块尺寸偏移以正确居中计算<li>对垂直滑块反转 Y 坐标，因为 Y 向下增加</ul><li><p><strong>轨道尺寸计算</strong>：计算可用轨道空间时，垂直滑块使用 <code>node.size().y - thumb_size</code>，水平滑块使用 <code>node.size().x - thumb_size</code>。</p></ol><p>这些更改向后兼容 - 水平滑块继续像以前一样工作，方向检测对 API 用户是透明的。<h3 id=ce-shi>测试</h3><ul><li><p><strong>手动测试</strong>：创建了包含垂直和水平滑块的测试应用程序以验证：</p> <ul><li>垂直滑块正确响应垂直拖拽动作（向上 = 增加，向下 = 减少）<li>水平滑块继续正确工作，响应水平拖拽动作<li>点击滑块轨道上的任意位置都能正确跳转到该位置（两种方向）<li>滑块位置在拖拽操作期间正确更新<li>多个滑块可以共存而不互相干扰</ul><li><p><strong>测试的边缘情况</strong>：</p> <ul><li>点击垂直滑块的最顶部/最底部<li>点击水平滑块的最左侧/最右侧<li>从一个极端拖拽到另一个极端<li>快速点击和拖拽交互</ul></ul><p><strong>可能需要更多测试的领域</strong>：<ul><li>具有非标准宽高比的滑块（非常宽的垂直滑块或非常高的水平滑块）<li>应用了自定义变换/旋转的滑块<li>具有复杂变换的嵌套 UI 层次结构中的滑块</ul><p><strong>审阅者如何测试</strong>：<ol><li>创建垂直滑块（高度 > 宽度）并验证： <ul><li>向上拖动增加值<li>向下拖动减少值<li>点击轨道任意位置都能跳转到该确切位置</ul><li>创建水平滑块（宽度 > 高度）并验证其仍然像以前一样工作<li>同时测试多个两种方向的滑块</ol><p><strong>测试平台</strong>：<ul><li>macOS（Apple Silicon）</ul><h3 id=zhan-shi>展示</h3><h4 id=zhi-qian>之前</h4><ul><li>垂直滑块无法使用 - 拖动会水平移动而不是垂直移动<li>点击垂直滑块轨道有偏移，点击底部附近会跳转到中间</ul><p>https://github.com/user-attachments/assets/9bda83e7-f46b-4626-9df3-a558526a8ab2<h4 id=zhi-hou>之后</h4><ul><li>垂直滑块正常工作，具有直观的上下拖动行为<li>点击滑块轨道任意位置都能准确跳转到点击位置<li>垂直和水平滑块无缝协同工作</ul><p>https://github.com/user-attachments/assets/cca24288-4cbc-4ceb-828f-9ce7a735ade0<h3 id=dai-ma-shi-li>代码示例</h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 垂直滑块 - 现在可以正常工作！
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        width</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>12.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>        height</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>300.0</span><span>)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// 高度 > 宽度 = 垂直
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    Slider</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>    SliderValue(</span><span style=color:#ff8f40>50.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    SliderRange</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... 滑块和轨道的子元素
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 水平滑块 - 继续像以前一样工作
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        width</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>300.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>        height</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>12.0</span><span>)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// 宽度 > 高度 = 水平
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    Slider</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>    SliderValue(</span><span style=color:#ff8f40>50.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    SliderRange</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... 滑块和轨道的子元素
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><p>方向基于节点尺寸自动检测 - 无需 API 更改！<h2 id=zhe-ge-pr-de-gu-shi>这个 PR 的故事</h2><p>这个 PR 解决了一个直接的 UI 组件问题：Bevy 的 <code>bevy_ui_widgets</code> 滑块控件原本只支持水平方向。当开发者尝试创建垂直滑块时，交互行为仍然是水平的 - 左右拖动会改变滑块值，而不是上下拖动。这本质上破坏了垂直滑块的可用性，限制了 UI 设计的灵活性。<p>问题源于滑块交互逻辑的硬编码假设。在 <code>slider.rs</code> 的 <code>slider_on_pointer_down</code> 和 <code>slider_on_drag</code> 函数中，所有计算都基于 X 轴坐标进行，忽略了节点的实际方向。这意味着垂直滑块的点击位置映射和拖拽方向都不正确。<p>解决方案采用了简单而有效的方法：根据节点的宽高比自动检测方向。核心逻辑是 <code>let is_vertical = node.size().y > node.size().x;</code>。这个检测在两个关键函数中重复使用，确保交互处理的一致性。<p>实现中的关键洞察是需要处理坐标系转换。对于垂直滑块，有几点需要注意：<ol><li>屏幕 Y 坐标向下增加，而用户期望向上拖动时值增加<li>Bevy 使用中心原点坐标系，而滑块计算需要左上角原点<li>滑块位置计算需要根据方向使用不同的轴</ol><p>在 <code>slider_on_pointer_down</code> 函数中，点击位置计算根据方向进行了分支：<ul><li>水平滑块：<code>local_pos.x + node.size().x / 2.0</code> 将中心原点转换为左原点<li>垂直滑块：<code>(node.size().y / 2.0) - local_pos.y</code> 进行坐标反转和原点转换</ul><p><code>slider_on_drag</code> 函数也进行了类似的调整，根据方向使用 <code>distance.x</code> 或 <code>distance.y</code>。值得注意的是，代码还移除了对 <code>SliderValue</code> 的查询，改为直接触发 <code>ValueChange</code> 事件，这简化了逻辑并确保一致性。<p>一个微妙但重要的细节是滑块大小的获取方式。原来总是使用 <code>thumb.size().x</code>，现在根据方向选择 <code>thumb.size().y</code>（垂直）或 <code>thumb.size().x</code>（水平）。这确保了轨道空间计算正确，考虑了滑块在不同方向上的实际尺寸。<p>PR 还包含了一个新的示例文件 <code>vertical_slider.rs</code>，展示了如何使用垂直和水平滑块。这个示例不仅演示了功能，还提供了滑块视觉反馈和值标签的完整实现模式。它使用了 <code>observe(slider_self_update)</code> 来确保滑块值变化时自动更新，这是 Bevy 响应式 UI 模式的典型用法。<p>从工程角度看，这个实现有几个优点：<ol><li><strong>向后兼容</strong>：水平滑块的行为完全不变<li><strong>自动检测</strong>：无需新的 API 参数，方向由布局决定<li><strong>最小改动</strong>：只修改了必要的计算逻辑，没有重构整个系统</ol><p>潜在的限制包括对非常规宽高比的处理（例如，接近正方形的滑块可能会被错误分类），以及不支持显式指定方向。对于大多数用例，自动检测是足够的，但如果需要更精确的控制，未来可能需要添加 <code>SliderOrientation</code> 组件。<p>这个修复使 Bevy 的滑块控件达到了现代 UI 库的基本标准，支持双向操作。对于构建复杂 UI 界面的开发者来说，这是一个重要的可用性改进，特别是对于音量控制、亮度调节等需要垂直滑块的场景。<h2 id=ke-shi-hua-guan-xi-tu>可视化关系图</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[UI Slider Widget] --> B[slider_on_pointer_down]
</span><span>    A --> C[slider_on_drag]
</span><span>    
</span><span>    B --> D{检测方向: node.size().y > node.size().x?}
</span><span>    D -->|垂直| E[使用Y轴坐标&LTbr>反转Y方向&LTbr>调整坐标原点]
</span><span>    D -->|水平| F[使用X轴坐标&LTbr>保持现有逻辑]
</span><span>    
</span><span>    C --> G{检测方向: node.size().y > node.size().x?}
</span><span>    G -->|垂直| H[使用distance.y&LTbr>调整滑块尺寸计算]
</span><span>    G -->|水平| I[使用distance.x&LTbr>保持现有逻辑]
</span><span>    
</span><span>    E --> J[更新SliderValue]
</span><span>    F --> J
</span><span>    H --> K[触发ValueChange事件]
</span><span>    I --> K
</span></code></pre><h2 id=zhu-yao-wen-jian-geng-gai>主要文件更改</h2><h3 id=crates-bevy-ui-widgets-src-slider-rs-60-17><code>crates/bevy_ui_widgets/src/slider.rs</code> (+60/-17)</h3><p>这是核心修改文件，实现了垂直滑块支持。<p><strong>关键修改：方向检测和条件逻辑</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 添加方向检测
</span><span style=color:#fa6e32>let</span><span> is_vertical </span><span style=color:#ed9366>=</span><span> node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>></span><span> node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 滑块大小根据方向选择
</span><span style=color:#fa6e32>let</span><span> thumb_size </span><span style=color:#ed9366>=</span><span> q_children
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>iter_descendants</span><span>(press</span><span style=color:#ed9366>.</span><span>entity)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>find_map</span><span>(|</span><span style=color:#ff8f40>child_id</span><span>| {
</span><span>        q_thumb</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(child_id)</span><span style=color:#ed9366>.</span><span style=color:#f07171>ok</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>thumb</span><span>| {
</span><span>            </span><span style=color:#fa6e32>if</span><span> is_vertical {
</span><span>                thumb</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>y  </span><span style=color:#abb0b6;font-style:italic>// 垂直滑块使用高度
</span><span>            } </span><span style=color:#fa6e32>else </span><span>{
</span><span>                thumb</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>x  </span><span style=color:#abb0b6;font-style:italic>// 水平滑块使用宽度
</span><span>            }
</span><span>        })
</span><span>    })
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or</span><span>(</span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 根据方向选择轨道尺寸
</span><span style=color:#fa6e32>let</span><span> track_size </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> is_vertical {
</span><span>    node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>-</span><span> thumb_size
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>-</span><span> thumb_size
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 垂直滑块的点击位置计算
</span><span style=color:#fa6e32>if</span><span> is_vertical {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 对于垂直滑块：从下到上（底部为0，顶部为最大值）
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// local_pos.y 范围从 -height/2（顶部）到 +height/2（底部）
</span><span>    </span><span style=color:#fa6e32>let</span><span> y_from_bottom </span><span style=color:#ed9366>= </span><span>(node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span>) </span><span style=color:#ed9366>-</span><span> local_pos</span><span style=color:#ed9366>.</span><span>y</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> adjusted_y </span><span style=color:#ed9366>=</span><span> y_from_bottom </span><span style=color:#ed9366>-</span><span> thumb_size </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>;
</span><span>    adjusted_y </span><span style=color:#ed9366>*</span><span> range</span><span style=color:#ed9366>.</span><span style=color:#f07171>span</span><span>() </span><span style=color:#ed9366>/</span><span> track_size </span><span style=color:#ed9366>+</span><span> range</span><span style=color:#ed9366>.</span><span style=color:#f07171>start</span><span>()
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// 对于水平滑块：从中心原点到左原点转换
</span><span>    </span><span style=color:#fa6e32>let</span><span> x_from_left </span><span style=color:#ed9366>=</span><span> local_pos</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>+</span><span> node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> adjusted_x </span><span style=color:#ed9366>=</span><span> x_from_left </span><span style=color:#ed9366>-</span><span> thumb_size </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>;
</span><span>    adjusted_x </span><span style=color:#ed9366>*</span><span> range</span><span style=color:#ed9366>.</span><span style=color:#f07171>span</span><span>() </span><span style=color:#ed9366>/</span><span> track_size </span><span style=color:#ed9366>+</span><span> range</span><span style=color:#ed9366>.</span><span style=color:#f07171>start</span><span>()
</span><span>}
</span></code></pre><p><strong>拖动处理的修改：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 移除了对SliderValue的查询，直接触发事件
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((node</span><span style=color:#61676ccc>,</span><span> range</span><span style=color:#61676ccc>,</span><span> precision</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#61676ccc>,</span><span> drag</span><span style=color:#61676ccc>,</span><span> disabled)) </span><span style=color:#ed9366>=</span><span> q_slider</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(event</span><span style=color:#ed9366>.</span><span>entity)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 根据方向选择拖动距离
</span><span style=color:#fa6e32>let</span><span> drag_distance </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> is_vertical { distance</span><span style=color:#ed9366>.</span><span>y } </span><span style=color:#fa6e32>else </span><span>{ distance</span><span style=color:#ed9366>.</span><span>x }</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 根据方向选择滑块尺寸
</span><span style=color:#fa6e32>let</span><span> slider_size </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> is_vertical {
</span><span>    ((node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>-</span><span> thumb_size) </span><span style=color:#ed9366>*</span><span> node</span><span style=color:#ed9366>.</span><span>inverse_scale_factor)</span><span style=color:#ed9366>.</span><span style=color:#f07171>max</span><span>(</span><span style=color:#ff8f40>1.0</span><span>)
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    ((node</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>-</span><span> thumb_size) </span><span style=color:#ed9366>*</span><span> node</span><span style=color:#ed9366>.</span><span>inverse_scale_factor)</span><span style=color:#ed9366>.</span><span style=color:#f07171>max</span><span>(</span><span style=color:#ff8f40>1.0</span><span>)
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=examples-ui-vertical-slider-rs-313-0><code>examples/ui/vertical_slider.rs</code> (+313/-0)</h3><p>新增的示例文件，展示了垂直和水平滑块的使用。<p><strong>垂直滑块定义：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>vertical_slider</span><span>() </span><span style=color:#61676ccc>-></span><span> impl Bundle {
</span><span>    (
</span><span>        Node {
</span><span>            width</span><span style=color:#61676ccc>: </span><span style=color:#f07171>px</span><span>(</span><span style=color:#ff8f40>12</span><span>)</span><span style=color:#61676ccc>,
</span><span>            height</span><span style=color:#61676ccc>: </span><span style=color:#f07171>px</span><span>(</span><span style=color:#ff8f40>200</span><span>)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// 高度 > 宽度 = 垂直滑块
</span><span>            </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... 其他组件
</span><span>    )
</span><span>}
</span></code></pre><p><strong>滑块视觉更新逻辑：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>update_slider_visuals</span><span>(...) {
</span><span>    </span><span style=color:#fa6e32>for </span><span>(slider_ent</span><span style=color:#61676ccc>,</span><span> value</span><span style=color:#61676ccc>,</span><span> range</span><span style=color:#61676ccc>,</span><span> hovered</span><span style=color:#61676ccc>,</span><span> drag_state</span><span style=color:#61676ccc>,</span><span> is_vertical) </span><span style=color:#ed9366>in</span><span> sliders</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>() {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        </span><span style=color:#fa6e32>if</span><span> is_vertical {
</span><span>            thumb_node</span><span style=color:#ed9366>.</span><span>bottom </span><span style=color:#ed9366>= </span><span style=color:#f07171>percent</span><span>(position)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// 垂直滑块使用bottom属性
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            thumb_node</span><span style=color:#ed9366>.</span><span>left </span><span style=color:#ed9366>= </span><span style=color:#f07171>percent</span><span>(position)</span><span style=color:#61676ccc>;    </span><span style=color:#abb0b6;font-style:italic>// 水平滑块使用left属性
</span><span>        }
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }
</span><span>}
</span></code></pre><h3 id=cargo-toml-12-0><code>Cargo.toml</code> (+12/-0)</h3><p>添加了新示例的配置：<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"vertical_slider"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/ui/vertical_slider.rs"
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>true
</span><span style=color:#399ee6>required-features </span><span>= [</span><span style=color:#86b300>"experimental_bevy_ui_widgets"</span><span>]
</span></code></pre><h3 id=examples-readme-md-1-0><code>examples/README.md</code> (+1/-0)</h3><p>在示例列表中添加了垂直滑块示例：<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>[Vertical Slider](</span><span style=color:#4cbf99;font-style:italic;text-decoration:underline>../examples/ui/vertical_slider.rs</span><span>) | Simple example showing vertical and horizontal slider widgets with snap behavior and value labels
</span></code></pre><h2 id=kuo-zhan-yue-du>扩展阅读</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ui/ target=_blank>Bevy UI 官方文档</a> - Bevy UI 系统的基础知识<li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/ui.html target=_blank>响应式 UI 设计模式</a> - Bevy 中的响应式 UI 编程模式<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Coordinate_system target=_blank>坐标系统转换</a> - 不同坐标系统之间的转换原理<li><a rel="noopener nofollow noreferrer" href=https://developer.apple.com/design/human-interface-guidelines/controls target=_blank>UI 控件交互设计</a> - 平台无关的 UI 控件交互最佳实践</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21827.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>