<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21887 Fix skybox example crashing in WASM by skipping unsupported TAA
        
    </title><meta content="#21887 Fix skybox example crashing in WASM by skipping unsupported TAA" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21887-zh-cn-20251210>中文</a></div></div><div class=pr-content><h1 id=fix-skybox-example-crashing-in-wasm-by-skipping-unsupported-taa>Fix skybox example crashing in WASM by skipping unsupported TAA</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix skybox example crashing in WASM by skipping unsupported TAA<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21887<li><strong>Author</strong>: it-me-joda<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, A-Rendering, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-11-20T00:41:16Z<li><strong>Merged</strong>: 2025-12-09T23:51:20Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #21731<li>Resolve the skybox example not functioning as intended. Currently, the skybox example compiles but can’t run due to TAA not being supported for WASM builds.</ul><h2 id=solution>Solution</h2><ul><li>Skip TAA if in a building for a WASM environment.</ul><h2 id=testing>Testing</h2><ul><li>I ran the skybox example locally with: <code>bevy run --example skybox --features="free_camera" web</code> and the example now compiles and runs in the browser.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important compatibility issue in Bevy’s example code. The skybox example, which demonstrates how to load and use cubemap textures for skybox effects, was failing when built for WebAssembly (WASM) targets. The root cause was that the example unconditionally included Temporal Anti-Aliasing (TAA), a graphics enhancement feature that isn’t currently supported in WASM builds of Bevy.<p>The problem manifested as a runtime crash rather than a compilation error, which is particularly problematic for an example meant to demonstrate functionality. When developers tried to run the skybox example in a browser environment, they encountered failures that prevented them from seeing the example work as intended. This issue was tracked in GitHub issue #21731.<p>The solution implemented here is a classic approach to platform-specific code: conditional compilation using Rust’s <code>#[cfg]</code> attribute. The developer made two targeted changes to the example code. First, they added a conditional import statement for the <code>TemporalAntiAliasing</code> type, ensuring it’s only imported when not targeting WASM32 architecture. Second, they applied the same conditional attribute to the component insertion in the camera setup system, preventing the component from being added to the camera entity in WASM builds.<p>This approach has several advantages. It maintains the TAA functionality for native builds where it’s supported and provides a working example for WASM targets by simply omitting the unsupported feature. The alternative would have been to disable the entire example for WASM or to create a separate WASM-specific version, both of which would have been more complex and less maintainable.<p>From an implementation perspective, the changes are minimal and focused. The developer added <code>#[cfg(not(target_arch = "wasm32"))]</code> before the import statement and before the <code>TemporalAntiAliasing::default()</code> component in the camera spawning code. This ensures that during WASM compilation, the code referencing TAA is completely excluded from the build, avoiding any runtime attempts to use unsupported APIs.<p>The testing approach was pragmatic and effective. The developer ran the example locally with the web target using Bevy’s built-in commands, verifying that the example now compiles and runs successfully in a browser environment. This direct testing approach is appropriate for this type of platform-specific fix.<p>This fix demonstrates good practices for handling platform limitations in cross-platform game engines. By using conditional compilation at the point of use, the solution keeps the code clean and maintains a single code path for the majority of the example, only diverging where absolutely necessary for compatibility reasons. The fix also doesn’t introduce any runtime overhead or complexity—it’s purely a compile-time decision.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[skybox.rs Example] --> B{Conditional Compilation Check}
</span><span>    B -->|target_arch = wasm32| C[Skip TAA Import and Component]
</span><span>    B -->|target_arch != wasm32| D[Include TAA Import and Component]
</span><span>    C --> E[WASM-Compatible Build]
</span><span>    D --> F[Native Build with TAA]
</span><span>    E --> G[Example Runs in Browser]
</span><span>    F --> H[Example Runs with Anti-Aliasing]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>examples/3d/skybox.rs</code> (4 lines added, 1 line removed)</strong><p>This file contains the skybox example that demonstrates loading cubemap textures. The changes ensure the example works in WASM environments by conditionally excluding Temporal Anti-Aliasing, which isn’t supported on that platform.<p><strong>Key Changes:</strong><ol><li><p><strong>Conditional Import</strong>: The import of <code>TemporalAntiAliasing</code> is now wrapped in a <code>#[cfg(not(target_arch = "wasm32"))]</code> attribute, preventing it from being imported in WASM builds.</p><li><p><strong>Conditional Component</strong>: The <code>TemporalAntiAliasing::default()</code> component is now only added to the camera when not targeting WASM32.</p></ol><p><strong>Code Snippets:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: examples/3d/skybox.rs
</span><span style=color:#abb0b6;font-style:italic>// Before (lines 1-9):
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>{
</span><span>    anti_alias</span><span style=color:#ed9366>::</span><span>taa</span><span style=color:#ed9366>::</span><span>TemporalAntiAliasing</span><span style=color:#61676ccc>,
</span><span>    camera_controller</span><span style=color:#ed9366>::</span><span>free_camera</span><span style=color:#ed9366>::</span><span>{FreeCamera</span><span style=color:#61676ccc>,</span><span> FreeCameraPlugin}</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other imports
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In setup function:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Camera3d</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>    Msaa</span><span style=color:#ed9366>::</span><span>Off</span><span style=color:#61676ccc>,
</span><span>    TemporalAntiAliasing</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Always added
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span>))]
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>anti_alias</span><span style=color:#ed9366>::</span><span>taa</span><span style=color:#ed9366>::</span><span>TemporalAntiAliasing</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Note: TemporalAntiAliasing removed from here
</span><span>    camera_controller</span><span style=color:#ed9366>::</span><span>free_camera</span><span style=color:#ed9366>::</span><span>{FreeCamera</span><span style=color:#61676ccc>,</span><span> FreeCameraPlugin}</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other imports
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In setup function:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Camera3d</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>    Msaa</span><span style=color:#ed9366>::</span><span>Off</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span>))]
</span><span>    TemporalAntiAliasing</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Only added for non-WASM
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rust Conditional Compilation</strong>: The official Rust book section on conditional compilation using <code>#[cfg]</code> attributes: https://doc.rust-lang.org/reference/conditional-compilation.html</p><li><p><strong>Bevy WebAssembly Support</strong>: Bevy’s documentation on building for the web, including limitations and supported features: https://bevyengine.org/learn/quick-start/getting-started/setup/#wasm-webassembly</p><li><p><strong>Temporal Anti-Aliasing in Computer Graphics</strong>: Technical explanation of TAA and why it might not be supported in certain WebGL/WebGPU contexts: https://en.wikipedia.org/wiki/Temporal_anti-aliasing</p><li><p><strong>Bevy Examples Structure</strong>: How Bevy organizes its examples and best practices for writing cross-platform examples: https://github.com/bevyengine/bevy/tree/main/examples</p></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21887.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>