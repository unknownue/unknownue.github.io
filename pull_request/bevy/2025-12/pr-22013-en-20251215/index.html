<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22013 Support MainPassResolutionOverride for Atmosphere
        
    </title><meta content="#22013 Support MainPassResolutionOverride for Atmosphere" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22013-zh-cn-20251215>中文</a></div></div><div class=pr-content><h1 id=support-mainpassresolutionoverride-for-atmosphere>Support MainPassResolutionOverride for Atmosphere</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Support MainPassResolutionOverride for Atmosphere<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22013<li><strong>Author</strong>: jannik4<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-12-02T23:28:25Z<li><strong>Merged</strong>: 2025-12-14T22:32:54Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><p>The PR description is already in English.<h1 id=objective>Objective</h1><p>Fixes #21973<h2 id=solution>Solution</h2><p>Use <code>MainPassResolutionOverride</code> in <code>RenderSkyNode</code>.<h2 id=testing>Testing</h2><p>Tested with DLSS upscaling.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a specific integration issue between the atmosphere rendering system and dynamic resolution scaling in Bevy’s rendering pipeline. The problem was that the sky/atmosphere rendering node wasn’t respecting the <code>MainPassResolutionOverride</code> component, which is used to control resolution scaling for techniques like DLSS, FSR, or other upscaling methods.<p>When using dynamic resolution scaling, different parts of the rendering pipeline need to render at potentially different resolutions. The <code>MainPassResolutionOverride</code> component allows cameras to specify an alternative resolution for the main render pass, which is particularly useful for upscaling techniques that render at a lower resolution and then upscale. However, the atmosphere rendering system was ignoring this override and rendering at the native viewport resolution, causing visual artifacts or performance issues when upscaling was enabled.<p>The solution approach was straightforward: modify the <code>RenderSkyNode</code> to query for and apply the <code>MainPassResolutionOverride</code> if present. This required several specific changes to the node’s implementation:<p>First, the necessary imports were added to bring in the required types from the camera module:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>{MainPassResolutionOverride</span><span style=color:#61676ccc>,</span><span> Viewport}</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>camera</span><span style=color:#ed9366>::</span><span>ExtractedCamera</span><span style=color:#61676ccc>;
</span></code></pre><p>The <code>ViewQuery</code> for <code>RenderSkyNode</code> was expanded to include two new components:<ul><li><code>Read&LTExtractedCamera></code>: to access the camera’s viewport information<li><code>Option&LTRead&LTMainPassResolutionOverride>></code>: to optionally get the resolution override</ul><p>The key implementation change happens in the <code>run</code> method. Instead of directly creating a render pass, the code now uses <code>render_context.begin_tracked_render_pass()</code> which provides better diagnostics. More importantly, it checks for a viewport override:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(viewport) </span><span style=color:#ed9366>=
</span><span>    Viewport</span><span style=color:#ed9366>::</span><span>from_viewport_and_override(camera</span><span style=color:#ed9366>.</span><span>viewport</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#61676ccc>,</span><span> resolution_override)
</span><span>{
</span><span>    render_sky_pass</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_camera_viewport</span><span>(</span><span style=color:#ed9366>&</span><span>viewport)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The <code>Viewport::from_viewport_and_override</code> method handles the logic of combining the camera’s base viewport with any resolution override. If an override is present, it creates a new viewport with the overridden dimensions; otherwise, it uses the camera’s original viewport.<p>This change ensures that the atmosphere rendering aligns with the rest of the rendering pipeline when using dynamic resolution scaling. The technical implementation follows established patterns in Bevy’s rendering system, where other render nodes already handle <code>MainPassResolutionOverride</code> in similar ways.<p>The impact of this change is that users can now enable DLSS or other upscaling techniques without breaking atmosphere rendering. This fixes visual artifacts that would occur when the sky was rendered at a different resolution than the main pass. The performance implications are positive as well, since the atmosphere can now benefit from the same resolution scaling as other rendering effects.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[ExtractedCamera] --> B[Viewport]
</span><span>    C[MainPassResolutionOverride] --> B
</span><span>    B --> D[RenderSkyNode]
</span><span>    D --> E[RenderPass with correct viewport]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-pbr-src-atmosphere-node-rs-20-11><code>crates/bevy_pbr/src/atmosphere/node.rs</code> (+20/-11)</h3><p>This file contains the <code>RenderSkyNode</code> implementation which renders atmospheric effects. The changes modify this node to support dynamic resolution scaling through the <code>MainPassResolutionOverride</code> component.<h4 id=key-modifications>Key modifications:</h4><ol><li><strong>Added imports</strong> for the necessary types:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>{MainPassResolutionOverride</span><span style=color:#61676ccc>,</span><span> Viewport}</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>camera</span><span style=color:#ed9366>::</span><span>ExtractedCamera</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><strong>Updated the ViewQuery</strong> to include camera and resolution override components:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>type </span><span style=color:#399ee6>ViewQuery </span><span style=color:#ed9366>= </span><span>(
</span><span>    Read&LTExtractedCamera></span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... existing components
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTRead&LTMainPassResolutionOverride>></span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Modified the run method</strong> to apply the viewport override:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (simplified):
</span><span style=color:#fa6e32>let mut</span><span> render_sky_pass </span><span style=color:#ed9366>=
</span><span>    render_context
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_render_pass</span><span>(</span><span style=color:#ed9366>&</span><span>RenderPassDescriptor {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... setup
</span><span>        })</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let mut</span><span> render_sky_pass </span><span style=color:#ed9366>=</span><span> render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_tracked_render_pass</span><span>(RenderPassDescriptor {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... setup
</span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(viewport) </span><span style=color:#ed9366>=
</span><span>    Viewport</span><span style=color:#ed9366>::</span><span>from_viewport_and_override(camera</span><span style=color:#ed9366>.</span><span>viewport</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#61676ccc>,</span><span> resolution_override)
</span><span>{
</span><span>    render_sky_pass</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_camera_viewport</span><span>(</span><span style=color:#ed9366>&</span><span>viewport)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>These changes ensure that the atmosphere rendering respects the same resolution overrides as the main render pass, fixing compatibility with upscaling techniques like DLSS.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/rendering/ target=_blank>Bevy Rendering Documentation</a> - Overview of Bevy’s rendering system<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Dynamic_resolution_scaling target=_blank>Dynamic Resolution Scaling in Games</a> - Background on resolution scaling techniques<li><a rel="noopener nofollow noreferrer" href=https://www.nvidia.com/en-us/geforce/technologies/dlss/ target=_blank>DLSS Technical Overview</a> - NVIDIA’s Deep Learning Super Sampling technology<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/camera/index.html target=_blank>Bevy Camera Components</a> - Documentation on Bevy’s camera system and components</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22013.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>