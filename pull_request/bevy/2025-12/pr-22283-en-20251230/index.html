<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22283 Rename `asset_paths` to `module_path_to_asset_id`.
        
    </title><meta content="#22283 Rename `asset_paths` to `module_path_to_asset_id`." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22283-zh-cn-20251230>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Rename <code>asset_paths</code> to <code>module_path_to_asset_id</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Rename <code>asset_paths</code> to <code>module_path_to_asset_id</code>.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22283<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, A-Assets, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-26T23:09:35Z<li><strong>Merged</strong>: 2025-12-30T01:34:39Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li><code>asset_paths</code> is a confusing name since this doesn’t store <code>AssetPath</code> at all!</ul><h2 id=solution>Solution</h2><ul><li>Rename <code>asset_paths</code> to <code>module_path_to_asset_id</code>. Note this is primarily an internal detail, other than <code>ShaderResolver::new</code> whose argument is renamed (though I suspect <code>ShaderResolver::new</code> should actually be private).</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem addressed by this PR was straightforward: a confusing field name in the Bevy shader caching system. The field <code>asset_paths</code> in <code>ShaderCache</code> didn’t actually store <code>AssetPath</code> instances, but rather a mapping from <code>wesl::syntax::ModulePath</code> to <code>AssetId&LTShader></code>. This naming mismatch created potential confusion for developers working with the codebase, as the field name suggested different contents than what it actually held.<p>The solution was a simple rename to <code>module_path_to_asset_id</code>, which more accurately reflects the field’s purpose: it’s a lookup table that maps WESL module paths to their corresponding shader asset IDs. This change improves code readability and maintainability by making the field’s purpose immediately clear from its name.<p>The implementation required changing the field name in several locations:<ol><li>The field declaration in the <code>ShaderCache</code> struct<li>The field initialization in <code>ShaderCache::new</code><li>Two usage sites in <code>ShaderCache::process</code> where the field is accessed<li>One usage site in <code>ShaderCache::set_shader</code> where the field is modified<li>The corresponding changes in the <code>ShaderResolver</code> struct and its methods</ol><p>The <code>ShaderResolver</code> struct, which uses this mapping to resolve shader imports during WESL shader compilation, also required updating its field name and constructor parameter. This change is particularly noticeable because <code>ShaderResolver::new</code> is a public method, but as noted in the PR description, this is primarily an internal implementation detail.<p>The technical context here involves Bevy’s shader system and the WESL (WebGPU Shading Language) format. When Bevy compiles shaders, it needs to resolve imports between shader modules. The <code>ShaderCache</code> maintains this mapping to allow the <code>ShaderResolver</code> to look up shader source code by module path during the compilation process. The rename clarifies that this mapping specifically deals with WESL module paths, not general asset paths.<p>This change doesn’t affect functionality or performance—it’s purely a code quality improvement. The rename makes the code more self-documenting and reduces the cognitive load for developers who need to understand or modify the shader caching system. It also aligns with good software engineering practices where accurate naming is crucial for maintainable code.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[ShaderCache] -->|contains| B[module_path_to_asset_id]
</span><span>    B -->|maps| C[wesl::syntax::ModulePath]
</span><span>    B -->|to| D[AssetId&LTShader>]
</span><span>    E[ShaderResolver] -->|uses| B
</span><span>    E -->|resolves| F[Shader Imports]
</span><span>    F -->|during| G[WESL Compilation]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-shader-src-shader-cache-rs-16-10><code>crates/bevy_shader/src/shader_cache.rs</code> (+16/-10)</h3><p>This file contains the main implementation of Bevy’s shader caching system. The changes rename a field to better reflect its actual purpose.<p><strong>Key Changes:</strong><ol><li><strong>Field declaration in <code>ShaderCache</code> struct:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"shader_format_wesl"</span><span>)]
</span><span>asset_paths</span><span style=color:#61676ccc>: </span><span>HashMap&LTwesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath, AssetId&LTShader>></span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"shader_format_wesl"</span><span>)]
</span><span>module_path_to_asset_id</span><span style=color:#61676ccc>: </span><span>HashMap&LTwesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath, AssetId&LTShader>></span><span style=color:#61676ccc>,
</span></code></pre><ol start=2><li><strong>Field initialization in <code>ShaderCache::new</code>:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"shader_format_wesl"</span><span>)]
</span><span>asset_paths</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"shader_format_wesl"</span><span>)]
</span><span>module_path_to_asset_id</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span></code></pre><ol start=3><li><strong>Usage in <code>ShaderCache::process</code> for creating <code>ShaderResolver</code>:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> shader_resolver </span><span style=color:#ed9366>= </span><span>ShaderResolver</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>asset_paths</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>shaders)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> shader_resolver </span><span style=color:#ed9366>= </span><span>ShaderResolver</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>module_path_to_asset_id</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>shaders)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=4><li><strong>Insertion in <code>ShaderCache::set_shader</code>:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>asset_paths
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(wesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath</span><span style=color:#ed9366>::</span><span>from_path(path)</span><span style=color:#61676ccc>,</span><span> id)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>module_path_to_asset_id
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(wesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath</span><span style=color:#ed9366>::</span><span>from_path(path)</span><span style=color:#61676ccc>,</span><span> id)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=5><li><strong>Corresponding changes in <code>ShaderResolver</code> struct and methods:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before in struct:
</span><span>asset_paths</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span>HashMap&LTwesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath, AssetId&LTShader>></span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After in struct:
</span><span>module_path_to_asset_id</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span>HashMap&LTwesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath, AssetId&LTShader>></span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Before in constructor:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>(
</span><span>    </span><span style=color:#ff8f40>asset_paths</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span>HashMap&LTwesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath, AssetId&LTShader>>,
</span><span>    </span><span style=color:#ff8f40>shaders</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span>HashMap&LTAssetId&LTShader>, Shader>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After in constructor:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>(
</span><span>    </span><span style=color:#ff8f40>module_path_to_asset_id</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span>HashMap&LTwesl</span><span style=color:#ed9366>::</span><span>syntax</span><span style=color:#ed9366>::</span><span>ModulePath, AssetId&LTShader>>,
</span><span>    </span><span style=color:#ff8f40>shaders</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span>HashMap&LTAssetId&LTShader>, Shader>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Before in resolve method:
</span><span style=color:#fa6e32>let</span><span> asset_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>asset_paths</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(module_path)</span><span style=color:#ed9366>.</span><span style=color:#f07171>ok_or_else</span><span>(|| {
</span><span>    wesl</span><span style=color:#ed9366>::</span><span>ResolveError</span><span style=color:#ed9366>::</span><span>ModuleNotFound(module_path</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"Invalid asset id"</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>())
</span><span>})</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After in resolve method:
</span><span style=color:#fa6e32>let</span><span> asset_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self
</span><span>    </span><span style=color:#ed9366>.</span><span>module_path_to_asset_id
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(module_path)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ok_or_else</span><span>(|| {
</span><span>        wesl</span><span style=color:#ed9366>::</span><span>ResolveError</span><span style=color:#ed9366>::</span><span>ModuleNotFound(
</span><span>            module_path</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#86b300>"Invalid asset id"</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>()</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>    })</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><p>These changes ensure that the field name consistently and accurately reflects its purpose throughout the codebase.<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Bevy Assets System</strong>: The official Bevy documentation on assets provides context for how <code>AssetId</code> is used throughout the engine: https://bevyengine.org/learn/book/features/assets/</p><li><p><strong>Rust HashMap Documentation</strong>: Understanding Rust’s HashMap is essential for working with mappings like <code>module_path_to_asset_id</code>: https://doc.rust-lang.org/std/collections/struct.HashMap.html</p><li><p><strong>Code Naming Best Practices</strong>: Clean Code by Robert C. Martin discusses the importance of meaningful names in software development.</p><li><p><strong>WESL (WebGPU Shading Language)</strong>: While not extensively documented outside the codebase, understanding WESL helps contextualize why module paths are used for shader imports.</p><li><p><strong>Bevy Shader System</strong>: The Bevy shader system documentation provides background on how shaders are processed and cached in Bevy.</p></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22283.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>