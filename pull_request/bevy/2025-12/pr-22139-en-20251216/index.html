<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22139 install x264 linux dependency in CI jobs that need it
        
    </title><meta content="#22139 install x264 linux dependency in CI jobs that need it" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22139-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: install x264 linux dependency in CI jobs that need it<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22139<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Build-System, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-15T22:22:02Z<li><strong>Merged</strong>: 2025-12-16T01:19:47Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Some CI jobs on a schedule / on main started failing after #21237<li>Fixes part of https://github.com/bevyengine/bevy/issues/21978</ul><h2 id=solution>Solution</h2><ul><li>Install the linux dependencies needed</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important CI infrastructure issue that surfaced after another change was merged. The problem began when PR #21237 introduced new functionality or tests that required the x264 video codec library as a system dependency on Linux CI runners. Without this library installed, several scheduled CI jobs began failing consistently, which is documented in issue #21978.<p>The developer identified the root cause quickly: the GitHub Actions workflows that were failing didn’t have the x264 library available in their execution environment. The solution approach was pragmatic and minimal - add the missing dependency declaration to the existing dependency installation step in each affected workflow file. This follows the established pattern in the codebase where system dependencies are declared through the <code>actions-rust-lang/setup-rust-toolchain</code> action’s configuration.<p>The implementation is clean and focused, modifying only three workflow files with identical one-line additions. Each modification adds <code>x264: true</code> to the <code>with</code> parameters of the setup-rust-toolchain step, ensuring the x264 development libraries are installed via the system package manager before the workflow proceeds to build and test the code. This is the same mechanism already used for other dependencies like Wayland and xkb.<p>From a technical perspective, this fix demonstrates several good practices in CI/CD maintenance. First, it shows the importance of tracking transitive dependencies - when PR #21237 added code that depends on x264, the CI configuration needed to be updated accordingly. Second, it illustrates how to properly handle system dependencies in a cross-platform project where only certain platforms (Linux in this case) require specific libraries. The use of GitHub Actions’ conditional dependency installation through the setup-rust-toolchain action provides a clean abstraction for this.<p>The impact is immediate and significant: it restores the reliability of scheduled CI jobs and main branch builds, preventing false negatives in the project’s automated testing. This is particularly important for a game engine like Bevy where multimedia codecs are essential for various features. The fix also helps maintain developer confidence in the CI system by ensuring that failures indicate actual problems with the code rather than missing infrastructure dependencies.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #21237 introduces x264 dependency] --> B[CI jobs start failing]
</span><span>    B --> C[Issue #21978 created]
</span><span>    C --> D[PR #22139 adds x264 to workflows]
</span><span>    
</span><span>    subgraph "GitHub Workflows Updated"
</span><span>        E[docs.yml]
</span><span>        F[update-caches.yml]
</span><span>        G[weekly.yml]
</span><span>    end
</span><span>    
</span><span>    D --> E
</span><span>    D --> F
</span><span>    D --> G
</span><span>    
</span><span>    E --> H[CI jobs pass]
</span><span>    F --> H
</span><span>    G --> H
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=github-workflows-docs-yml><code>.github/workflows/docs.yml</code></h3><p><strong>Change</strong>: Added x264 dependency to the documentation build workflow. <strong>Purpose</strong>: Ensures documentation builds that may include multimedia examples have the required codec library.<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># File: .github/workflows/docs.yml
</span><span style=color:#abb0b6;font-style:italic># Before (lines 44-47):
</span><span>      </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>        </span><span style=color:#399ee6>wayland</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>        </span><span style=color:#399ee6>xkb</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After (lines 44-48):
</span><span>      </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>        </span><span style=color:#399ee6>wayland</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>        </span><span style=color:#399ee6>xkb</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>        </span><span style=color:#399ee6>x264</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span></code></pre><h3 id=github-workflows-update-caches-yml><code>.github/workflows/update-caches.yml</code></h3><p><strong>Change</strong>: Added x264 dependency to the cache update workflow. <strong>Purpose</strong>: Ensures cache building for dependencies includes x264, preventing cache misses.<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># File: .github/workflows/update-caches.yml
</span><span style=color:#abb0b6;font-style:italic># Before (lines 113-116):
</span><span>        </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>wayland</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>          </span><span style=color:#399ee6>xkb</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After (lines 113-117):
</span><span>        </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>wayland</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>          </span><span style=color:#399ee6>xkb</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>          </span><span style=color:#399ee6>x264</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span></code></pre><h3 id=github-workflows-weekly-yml><code>.github/workflows/weekly.yml</code></h3><p><strong>Change</strong>: Added x264 dependency to the weekly scheduled workflow. <strong>Purpose</strong>: Ensures weekly maintenance tasks and tests have the required library.<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># File: .github/workflows/weekly.yml
</span><span style=color:#abb0b6;font-style:italic># Before (lines 65-68):
</span><span>        </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>wayland</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>          </span><span style=color:#399ee6>xkb</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After (lines 65-69):
</span><span>        </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>wayland</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>          </span><span style=color:#399ee6>xkb</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span><span>          </span><span style=color:#399ee6>x264</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li>GitHub Actions documentation on workflow syntax: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions<li><code>actions-rust-lang/setup-rust-toolchain</code> action documentation for available options: https://github.com/actions-rust-lang/setup-rust-toolchain<li>x264 video codec library documentation: https://www.videolan.org/developers/x264.html<li>Bevy’s CI troubleshooting guide (for understanding common CI issues): https://github.com/bevyengine/bevy/blob/main/docs/ci_troubleshooting.md</ol><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/.github/workflows/docs.yml b/.github/workflows/docs.yml index 79391d9e674c1..a4e319d710933 100644 — a/.github/workflows/docs.yml +++ b/.github/workflows/docs.yml @@ -46,6 +46,7 @@ jobs: with: wayland: true xkb: true<ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>     x264: true
</span><span>
</span><span> #  This does the following:
</span><span> #   - Replaces the docs icon with one that clearly denotes it's not the released package on crates.io
</span></code></pre></ul><p>diff –git a/.github/workflows/update-caches.yml b/.github/workflows/update-caches.yml index 0a1d137271b96..eac53e64eff58 100644 — a/.github/workflows/update-caches.yml +++ b/.github/workflows/update-caches.yml @@ -115,6 +115,7 @@ jobs: with: wayland: true xkb: true<ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>     x264: true
</span><span>
</span><span> # Fetch the cache using the complete key - to avoid rebuilding the cache if nothing changed
</span><span> - uses: actions/cache/restore@v4
</span></code></pre></ul><p>diff –git a/.github/workflows/weekly.yml b/.github/workflows/weekly.yml index f8c38dd9d5986..87b0b8193d70e 100644 — a/.github/workflows/weekly.yml +++ b/.github/workflows/weekly.yml @@ -67,6 +67,7 @@ jobs: with: wayland: true xkb: true<ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>     x264: true
</span><span> - name: Run lints
</span><span>   # See tools/ci/src/main.rs for the commands this runs
</span><span>   run: cargo run -p ci -- lints</span></code></pre></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22139.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>