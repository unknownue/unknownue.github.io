<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22091 Fix incorrect blake3 version bound
        
    </title><meta content="#22091 Fix incorrect blake3 version bound" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-12</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22091-zh-cn-20251212>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Fix incorrect blake3 version bound<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix incorrect blake3 version bound<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22091<li><strong>Author</strong>: kristoff3r<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Dependencies, S-Ready-For-Final-Review, P-Compile-Failure<li><strong>Created</strong>: 2025-12-11T22:25:49Z<li><strong>Merged</strong>: 2025-12-12T19:11:25Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><p>The PR #21925 introduced some code using the constant <code>blake3::CHUNK_LEN</code>, but that wasn’t public before version 1.8, and bevy_asset currently depends on version 1.5. This breaks users with an older version in their lock file.<p><strong>Solution</strong><p>Bump blake3 to 1.8<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR fixes a version compatibility issue that emerged from a simple oversight in dependency management. The problem started when PR #21925 added code that depended on a specific constant from the <code>blake3</code> crate. Specifically, it used <code>blake3::CHUNK_LEN</code>, which is a constant representing the chunk length used in the BLAKE3 hash algorithm.<p>The issue was that <code>blake3::CHUNK_LEN</code> wasn’t exposed as a public constant until version 1.8 of the <code>blake3</code> crate. The <code>bevy_asset</code> crate was still declaring a dependency on version 1.5 in its Cargo.toml file. This created a mismatch: the code was written against version 1.8’s API, but the dependency specification allowed older versions that didn’t have that API.<p>This type of problem often surfaces in CI environments or when new contributors clone the repository and run <code>cargo build</code>. If Cargo resolves the <code>blake3</code> dependency to version 1.5 (which might happen if it’s already in a global cache or if version resolution picks an older compatible version), the build fails with a compilation error indicating that <code>CHUNK_LEN</code> doesn’t exist in the <code>blake3</code> module.<p>The solution was straightforward: update the version requirement in Cargo.toml to explicitly require at least version 1.8, which contains the public <code>CHUNK_LEN</code> constant that the code now depends on. This ensures that anyone building the project will get a compatible version of the <code>blake3</code> crate.<p>This fix highlights an important aspect of Rust dependency management. When you add code that uses a specific feature from a dependency, you need to ensure your version bounds reflect the minimum version where that feature became available. The Cargo.lock file pins exact versions, but the version bounds in Cargo.toml determine what versions are considered compatible. If the bounds are too loose, different environments might resolve to incompatible versions, leading to compilation failures.<p>The change is minimal but important for maintaining build reliability across different environments. It follows the standard practice of keeping dependency versions in sync with the actual API usage in the codebase.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #21925] --> B[Uses blake3::CHUNK_LEN]
</span><span>    C[blake3 crate] --> D[Version 1.5]
</span><span>    C --> E[Version 1.8]
</span><span>    B --> F[Requires public CHUNK_LEN]
</span><span>    F --> G[Only available in 1.8+]
</span><span>    H[bevy_asset/Cargo.toml] --> I[Specified version 1.5]
</span><span>    I --> J[Version mismatch]
</span><span>    K[PR #22091] --> L[Bump to version 1.8]
</span><span>    L --> M[Compatibility restored]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>crates/bevy_asset/Cargo.toml</strong> (+1/-1) This file contains the dependency declaration for the <code>bevy_asset</code> crate. The change updates the version requirement for the <code>blake3</code> dependency from 1.5 to 1.8.<p><strong>Code Change:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>blake3 </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1.5"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>blake3 </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1.8"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span></code></pre><p>The change ensures that the <code>blake3</code> crate resolves to a version that includes the public <code>CHUNK_LEN</code> constant used elsewhere in the codebase. This is a direct fix for the compilation error that occurred when the dependency resolved to version 1.5 or any version before 1.8.<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rust Dependency Management</strong>: The <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html target=_blank>Cargo Book section on dependencies</a> provides detailed information about version specifications and how Cargo resolves dependencies.</p><li><p><strong>Semantic Versioning in Rust</strong>: Understanding how Rust crates use semantic versioning can help prevent similar issues. The <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/semver.html target=_blank>SemVer Compatibility</a> section in the Cargo documentation explains what constitutes a breaking change in Rust.</p><li><p><strong>BLAKE3 Algorithm</strong>: The <a rel="noopener nofollow noreferrer" href=https://github.com/BLAKE3-team/BLAKE3-specs target=_blank>BLAKE3 specification</a> provides technical details about the hash algorithm, including the chunk size constant that was the source of this issue.</p><li><p><strong>Rust Crates.io</strong>: The <a rel="noopener nofollow noreferrer" href=https://crates.io/crates/blake3 target=_blank>blake3 crate page</a> shows the version history and release notes, which would indicate when <code>CHUNK_LEN</code> became public.</p></ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_asset/Cargo.toml b/crates/bevy_asset/Cargo.toml
</span><span>index d20e9c0974ee7..fb19e7e841d5a 100644
</span><span style=color:#c594c5>--- a/crates/bevy_asset/Cargo.toml
</span><span style=color:#c594c5>+++ b/crates/bevy_asset/Cargo.toml
</span><span style=color:#c594c5>@@ -58,7 +58,7 @@ </span><span style=color:#399ee6>futures-util = { version = "0.3", default-features = false, features = [
</span><span> ] }
</span><span> futures-io = { version = "0.3", default-features = false }
</span><span> futures-lite = { version = "2.0.1", default-features = false }
</span><span style=color:#f07171>-blake3 = { version = "1.5", default-features = false }
</span><span style=color:#86b300>+blake3 = { version = "1.8", default-features = false }
</span><span> ron = { version = "0.12", default-features = false }
</span><span> serde = { version = "1", default-features = false, features = ["derive"] }
</span><span> thiserror = { version = "2", default-features = false }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22091.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>