<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22038 Font weight support
        
    </title><meta content="#22038 Font weight support" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22038-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=font-weight-support>Font weight support</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Font weight support<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22038<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, A-Text, M-Release-Note, D-Modest<li><strong>Created</strong>: 2025-12-05T16:39:32Z<li><strong>Merged</strong>: 2025-12-16T20:39:19Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Add font weight support.<h2 id=solution>Solution</h2><ul><li>New <code>FontWeight</code> struct that newtypes a <code>u16</code>.<li>New <code>font: FontWeight</code> field on <code>TextFont</code>.<li>The weight attribute for the cosmic text buffer is set in <code>TextPipeline</code> during text updates.<li>Added a new font asset, <code>MonSans-VariableFont.ttf</code>. This needs a variable font for testing.</ul><h1></h1><p>Doesn’t support <code>lighter</code> and <code>bolder</code> as that would require text style inheritance, which we don’t support yet.<p>I added stretch and slant as well, but split them off from this PR. Swash only has limited variable-font support and there’s no way to demonstrate that they work without other changes.<h2 id=testing>Testing</h2><p>Added a basic example: <code>cargo run --example font_weights</code><h2 id=showcase>Showcase</h2><img alt=font_weights height=845 src=https://github.com/user-attachments/assets/8a8686ac-faa8-442c-89d4-f56348a7e788 width=671><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The Bevy engine’s text rendering system had a limitation: it didn’t support font weights beyond what was defined in the font file itself. When working with variable fonts that offer a range of weights (from thin to black), developers couldn’t programmatically adjust the weight of rendered text. This PR addresses that gap by introducing a comprehensive font weight system.<p>The core problem was that the existing text pipeline used a fixed weight from the font face information stored during font loading. The <code>FontFaceInfo</code> struct in the pipeline contained a <code>weight</code> field that was set once when the font was loaded and couldn’t be changed per text section. This meant all text using a particular font would render with the same weight, regardless of any weight specifications in the text styling.<p>The solution involved three main changes. First, a new <code>FontWeight</code> struct was created to represent font weights as a newtype around a <code>u16</code>. This follows CSS conventions where font weights range from 1 to 1000, with common named constants like <code>THIN</code> (100), <code>NORMAL</code> (400), and <code>BOLD</code> (700). The struct includes validation logic to clamp values within the valid range and handle edge cases like zero values.<p>Second, the <code>TextFont</code> component was extended with a <code>weight</code> field, allowing each text section to specify its desired weight independently. This change required updates throughout the text rendering pipeline to pass the weight information through to the underlying cosmic-text library.<p>Third, the pipeline itself was refactored to use the weight from <code>TextFont</code> rather than from the cached font face information. This involved modifying the <code>glyph_info</code> buffer to include weight data and updating the font attribute calculations to use the specified weight when retrieving font metrics.<p>A key technical decision was to use cosmic-text’s <code>Weight</code> type directly via conversion from <code>FontWeight</code>. This maintains compatibility with the existing text rendering backend while adding the new functionality. The implementation also handles font smoothing and metrics calculation based on the specified weight, ensuring proper rendering of text decorations like underlines and strikeouts at different weights.<p>The PR adds a new variable font asset (Mona Sans) to demonstrate the feature, as traditional static fonts typically only include a few discrete weights. Variable fonts can interpolate between weight values, making them ideal for testing the full range of weight support.<p>There are intentional limitations in this implementation. The <code>lighter</code> and <code>bolder</code> relative weight values from CSS aren’t supported because they would require text style inheritance, which Bevy doesn’t currently implement. Additionally, the author mentions that stretch and slant (italic/oblique) support were considered but split into separate PRs due to limitations in the underlying swash library’s variable font support.<p>The changes are backward compatible through sensible defaults - existing code continues to work with <code>FontWeight::NORMAL</code> (400) as the default weight. The new system provides flexibility for UI design while maintaining performance by integrating cleanly with the existing text atlas generation and caching systems.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[FontWeight Struct] --> B[TextFont Component]
</span><span>    B --> C[TextPipeline Processing]
</span><span>    C --> D[cosmic-text Buffer]
</span><span>    D --> E[Rendered Text]
</span><span>    F[Variable Font Asset] --> C
</span><span>    C --> G[Font Metrics Calculation]
</span><span>    G --> E
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><strong><code>crates/bevy_text/src/text.rs</code></strong> (+75/-0)</p> <ul><li>Added the <code>FontWeight</code> struct with constants for common weights (THIN=100, EXTRA_LIGHT=200, LIGHT=300, NORMAL=400, etc.)<li>Added <code>weight</code> field to <code>TextFont</code> struct with default value <code>FontWeight::NORMAL</code><li>Implemented <code>From&LTFontWeight></code> for cosmic_text::Weight to enable integration with the text rendering backend</ul> <p>Key code snippet:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> PartialOrd</span><span style=color:#61676ccc>,</span><span> Ord</span><span style=color:#61676ccc>,</span><span> Hash</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>FontWeight</span><span>(pub </span><span style=color:#fa6e32>u16</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>FontWeight </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Weight 100.
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>THIN</span><span style=color:#61676ccc>:</span><span> FontWeight </span><span style=color:#ed9366>=</span><span> FontWeight(</span><span style=color:#ff8f40>100</span><span>)</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Weight 400.
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>NORMAL</span><span style=color:#61676ccc>:</span><span> FontWeight </span><span style=color:#ed9366>=</span><span> FontWeight(</span><span style=color:#ff8f40>400</span><span>)</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Weight 700.
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>BOLD</span><span style=color:#61676ccc>:</span><span> FontWeight </span><span style=color:#ed9366>=</span><span> FontWeight(</span><span style=color:#ff8f40>700</span><span>)</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Clamp the weight value to between 1 and 1000.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Values of 0 are mapped to `Weight::DEFAULT`.
</span><span>    </span><span style=color:#fa6e32>pub const fn </span><span style=color:#f29718>clamp</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>== </span><span style=color:#ff8f40>0 </span><span>{
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>DEFAULT</span><span style=color:#61676ccc>;
</span><span>        } </span><span style=color:#fa6e32>else if </span><span style=color:#ff8f40>1000 </span><span style=color:#ed9366>< </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>{
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>1000</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>        </span><span style=color:#fa6e32>Self</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)
</span><span>    }
</span><span>}
</span></code></pre><li><p><strong><code>crates/bevy_text/src/pipeline.rs</code></strong> (+13/-20)</p> <ul><li>Removed <code>weight</code> field from <code>FontFaceInfo</code> struct (weight is now per-text-section, not per-font)<li>Updated <code>glyph_info</code> buffer to include weight as the 7th element<li>Modified font attribute calculation to use weight from <code>TextFont</code> instead of cached font face weight<li>Simplified conditional logic for font metric calculations</ul> <p>Key code snippet showing the updated glyph info and weight usage:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: 6-element tuple
</span><span>glyph_info</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(AssetId&LTFont>, FontSmoothing, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>)>
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: 7-element tuple with weight added
</span><span>glyph_info</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(AssetId&LTFont>, FontSmoothing, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>u16</span><span>)>
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Weight is extracted from TextFont and stored
</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>((
</span><span>    section_font</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>,
</span><span>    section_font</span><span style=color:#ed9366>.</span><span>font_smoothing</span><span style=color:#61676ccc>,
</span><span>    section_font</span><span style=color:#ed9366>.</span><span>font_size</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,
</span><span>    text_font</span><span style=color:#ed9366>.</span><span>weight</span><span style=color:#ed9366>.</span><span style=color:#f07171>clamp</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// New: weight field
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><li><p><strong><code>examples/ui/font_weights.rs</code></strong> (+128/-0)</p> <ul><li>New example demonstrating all available font weights from THIN (100) to BLACK (900)<li>Uses the new Mona Sans variable font to show smooth weight transitions<li>Shows how to set different weights on individual text elements</ul> <p>Key code snippet showing weight usage:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>TextFont {
</span><span>    font</span><span style=color:#61676ccc>:</span><span> font</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>    font_size</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>32.0</span><span style=color:#61676ccc>,
</span><span>    weight</span><span style=color:#61676ccc>: </span><span>FontWeight</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>BOLD</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 700
</span><span>    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>}</span><span style=color:#61676ccc>,
</span></code></pre><li><p><strong><code>assets/fonts/MonaSans-VariableFont.ttf</code></strong> (new binary file)</p> <ul><li>Variable font file added for testing weight support<li>Needed because traditional static fonts don’t support continuous weight ranges</ul><li><p><strong><code>Cargo.toml</code></strong> (+11/-0)</p> <ul><li>Added new example configuration for <code>font_weights</code></ul></ol><h2 id=further-reading>Further Reading</h2><ol><li><strong>CSS Font Weight Specification</strong>: https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight<li><strong>Variable Fonts</strong>: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_fonts/Variable_fonts_guide<li><strong>cosmic-text library</strong>: https://github.com/pop-os/cosmic-text (the text rendering backend used by Bevy)<li><strong>OpenType Font Variations</strong>: https://docs.microsoft.com/en-us/typography/opentype/spec/otvaroverview (technical specification for variable fonts)</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22038.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>