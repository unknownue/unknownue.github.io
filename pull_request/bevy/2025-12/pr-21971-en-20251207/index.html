<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21971 Remove `getrandom` dependency from `bevy_platform`.
        
    </title><meta content="#21971 Remove `getrandom` dependency from `bevy_platform`." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21971-zh-cn-20251207>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Remove <code>getrandom</code> dependency from <code>bevy_platform</code>.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21971<li><strong>Author</strong>: kpreid<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Dependencies, S-Ready-For-Final-Review, X-Uncontroversial<li><strong>Created</strong>: 2025-11-28T22:48:57Z<li><strong>Merged</strong>: 2025-12-07T03:03:20Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The original description is in English, so it’s included as-is:<h1 id=objective>Objective</h1><p>Fixes #21336.<p><code>bevy_platform</code> and dependents such as <code>bevy_ecs</code> may be used on web without incurring the <code>RUSTFLAGS</code> requirement of <code>getrandom</code>.<h2 id=solution>Solution</h2><p>Remove dependency <code>bevy_platform</code> → <code>getrandom</code>.<p>Note: There was a suggestion of adding a dependency <code>bevy_math</code> → <code>getrandom</code> to replace it, but <code>bevy_math</code> does not actually depend transitively on <code>getrandom</code> at all (except in its examples), nor does any other Bevy library. If making <code>getrandom</code> work is desired for convenience of Bevy users, we could add <code>bevy_internal/web</code> → <code>getrandom/wasm_js</code>, but that would not be for the use of Bevy itself at all, and it would mean that Bevy users would hit the <code>RUSTFLAGS</code> requirement even if they don’t truly need it.<h2 id=testing>Testing</h2><ul><li>Ran <code>cargo run -p ci -- compile</code> and <code>cargo run -p ci -- test</code>.<li>Tested depending on this version of <code>bevy_ecs</code> in my own wasm32 project.<li>Have not tested any further feature combinations.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a practical issue that affected developers using Bevy for WebAssembly (wasm) projects. The core problem was that <code>bevy_platform</code>, a low-level crate in the Bevy engine, had a transitive dependency on the <code>getrandom</code> crate when building for the web. This dependency came with a specific requirement: users needed to set certain <code>RUSTFLAGS</code> environment variables to make it work in wasm32-unknown-unknown targets. This created an unnecessary hurdle for developers who didn’t actually need random number generation functionality but were just using parts of Bevy like <code>bevy_ecs</code> on the web.<p>The issue was reported in GitHub issue #21336, where developers encountered build failures when trying to use Bevy crates in wasm environments without the proper <code>RUSTFLAGS</code> configuration. The root cause was traced to <code>bevy_platform</code>’s <code>web</code> feature, which included <code>getrandom</code> as a dependency with the <code>wasm_js</code> feature enabled. This made sense if Bevy itself needed random number generation for web platforms, but upon investigation, it turned out that <code>bevy_platform</code> and its dependents didn’t actually use <code>getrandom</code> at all—it was an unused dependency that was only pulling in the crate for potential convenience.<p>The developer approached this problem by analyzing the dependency chain. They first verified that <code>bevy_math</code> (which was suggested as an alternative location for the dependency) didn’t actually use <code>getrandom</code> either, except in its examples. This meant the dependency wasn’t essential for Bevy’s core functionality. They then considered two options: completely removing the dependency or moving it to a different location like <code>bevy_internal/web</code>. They chose the former because adding it elsewhere would still impose the <code>RUSTFLAGS</code> requirement on all Bevy users targeting the web, regardless of whether they needed random number generation.<p>The implementation was straightforward but required careful consideration of feature flags and conditional compilation. In <code>bevy_platform</code>’s <code>Cargo.toml</code>, the <code>web</code> feature previously included <code>dep:getrandom</code> in its list of dependencies. The fix simply removed this line, along with the conditional dependency declaration for <code>getrandom</code> that was specific to <code>target_arch = "wasm32"</code>. This cleanly eliminated the transitive dependency without affecting any other functionality.<p>The change was tested by running Bevy’s CI compile and test commands, and the author also verified it worked in their own wasm32 project. This validation confirmed that the removal didn’t break existing functionality while solving the original problem. The PR demonstrates a good practice in dependency management: removing unused dependencies reduces build complexity and potential issues for downstream users, especially in constrained environments like web assembly.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_platform] --> B[getrandom]
</span><span>    C[bevy_ecs] --> A
</span><span>    D[wasm32 projects] --> C
</span><span>    
</span><span>    style B stroke:#f66,stroke-width:4px
</span><span>    
</span><span>    subgraph "After PR #21971"
</span><span>        A2[bevy_platform] --> C2[bevy_ecs]
</span><span>        D2[wasm32 projects] --> C2
</span><span>    end
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File</strong>: <code>crates/bevy_platform/Cargo.toml</code><p>This is the only file changed in the PR. The modifications removed the <code>getrandom</code> dependency from the <code>web</code> feature and the wasm32-specific dependency section.<p><strong>Before the change:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>web </span><span>= [
</span><span>  </span><span style=color:#86b300>"std"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:web-time"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:getrandom"</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic># This line was removed
</span><span>  </span><span style=color:#86b300>"dep:wasm-bindgen-futures"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:wasm-bindgen"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:js-sys"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:web-sys"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># ...
</span><span>
</span><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(target_arch = "wasm32")'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>web-time </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1.1"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span style=color:#399ee6>getrandom </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.3.0"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"wasm_js"</span><span style=color:#61676ccc>,
</span><span>] }  </span><span style=color:#abb0b6;font-style:italic># This entire block was removed
</span><span style=color:#399ee6>wasm-bindgen-futures </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.4"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span style=color:#abb0b6;font-style:italic># ...
</span></code></pre><p><strong>After the change:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>web </span><span>= [
</span><span>  </span><span style=color:#86b300>"std"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:web-time"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#abb0b6;font-style:italic># getrandom dependency removed here
</span><span>  </span><span style=color:#86b300>"dep:wasm-bindgen-futures"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:wasm-bindgen"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:js-sys"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"dep:web-sys"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># ...
</span><span>
</span><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(target_arch = "wasm32")'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>web-time </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1.1"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span style=color:#abb0b6;font-style:italic># getrandom block removed entirely
</span><span style=color:#399ee6>wasm-bindgen-futures </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.4"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span style=color:#abb0b6;font-style:italic># ...
</span></code></pre><p><strong>Explanation</strong>: The changes are minimal but significant. By removing <code>getrandom</code> from the <code>web</code> feature list and deleting its conditional dependency declaration, the PR eliminates the transitive dependency that was causing the <code>RUSTFLAGS</code> requirement for wasm32 targets. This solves the original issue without affecting any functionality since the dependency wasn’t being used.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://rustwasm.github.io/docs/book/ target=_blank>Rust and WebAssembly documentation</a> - For understanding Rust’s wasm target and common issues<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/getrandom/latest/getrandom/ target=_blank>The <code>getrandom</code> crate documentation</a> - For understanding the random number generation capabilities<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Cargo features documentation</a> - For understanding feature flags and conditional dependencies<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/dependencies.md target=_blank>Bevy’s dependency management guide</a> - For understanding Bevy’s approach to dependencies</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_platform/Cargo.toml b/crates/bevy_platform/Cargo.toml
</span><span>index c428a6bf7b79d..e17d5a4bc0c72 100644
</span><span>--- a/crates/bevy_platform/Cargo.toml
</span><span>+++ b/crates/bevy_platform/Cargo.toml
</span><span>@@ -50,7 +50,6 @@ critical-section = ["dep:critical-section", "portable-atomic/critical-section"]
</span><span> web = [
</span><span>   "std",
</span><span>   "dep:web-time",
</span><span>-  "dep:getrandom",
</span><span>   "dep:wasm-bindgen-futures",
</span><span>   "dep:wasm-bindgen",
</span><span>   "dep:js-sys",
</span><span>@@ -76,9 +75,6 @@ rayon = { version = "1", default-features = false, optional = true }
</span><span> 
</span><span> [target.'cfg(target_arch = "wasm32")'.dependencies]
</span><span> web-time = { version = "1.1", default-features = false, optional = true }
</span><span>-getrandom = { version = "0.3.0", default-features = false, optional = true, features = [
</span><span>-  "wasm_js",
</span><span>-] }
</span><span> wasm-bindgen-futures = { version = "0.4", default-features = false, optional = true }
</span><span> futures-channel = { version = "0.3", default-features = false }
</span><span> js-sys = { version = "0.3", default-features = false, optional = true }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21971.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>