<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22024 Add Clone derive to ViewTarget
        
    </title><meta content="#22024 Add Clone derive to ViewTarget" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22024-zh-cn-20251203>中文</a></div></div><div class=pr-content><h1 id=add-clone-derive-to-viewtarget>Add Clone derive to ViewTarget</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add Clone derive to ViewTarget<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22024<li><strong>Author</strong>: tychedelia<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, D-Trivial, A-Rendering, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-03T22:05:47Z<li><strong>Merged</strong>: 2025-12-03T22:54:48Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>For esoteric reasons we need to send this to the MainWorld for processing. All the fields are GPU resources or Arc’d so it can be trivially cloned.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The developer was working with Bevy’s rendering system and encountered a scenario where a <code>ViewTarget</code> component needed to be sent to the <code>MainWorld</code> for additional processing. <code>ViewTarget</code> represents the target for a camera view in the rendering pipeline, containing texture resources and format information that define where a camera renders its output.<p>The problem was straightforward: the <code>ViewTarget</code> struct lacked the <code>Clone</code> trait derivation, making it impossible to create copies when moving between different ECS (Entity Component System) worlds in Bevy. This limitation became apparent when certain rendering operations required transferring the view target data from the render world to the main world. Without clone capability, the developer would need to either manually implement cloning or restructure the code to avoid copying.<p>The solution was to add <code>Clone</code> to the derive macro for <code>ViewTarget</code>. This approach was chosen because all the struct’s fields—<code>main_textures: MainTargetTextures</code>, <code>main_texture_format: TextureFormat</code>, <code>out_texture: Option&LTTexture></code>—are either GPU resources that support cloning (creating new handles, not copying GPU data) or simple value types that are trivially clonable. GPU resources in Bevy are typically reference-counted or handle-based, so cloning them creates new references to the same underlying resources rather than duplicating the actual GPU data.<p>The implementation is minimal and safe. By adding <code>Clone</code> to the derive list, Rust’s compiler automatically generates a clone implementation that calls <code>.clone()</code> on each field. Since the fields already implement <code>Clone</code> appropriately, this doesn’t introduce any performance issues or memory safety concerns. The existing <code>Component</code> derive is retained, so <code>ViewTarget</code> continues to function as an ECS component.<p>This change enables developers to move <code>ViewTarget</code> instances between worlds without complex workarounds. The term “esoteric reasons” in the PR description suggests there are specific rendering scenarios or custom rendering pipelines that require accessing <code>ViewTarget</code> in the main world, perhaps for post-processing effects, screen-space operations, or custom compositing that needs to happen outside the standard render graph.<p>The impact is modest but meaningful for developers building advanced rendering features. It provides flexibility in system architecture without requiring unsafe code or manual trait implementations. The change is backward-compatible and doesn’t affect existing code—it only adds capabilities.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[ViewTarget Component] --> B[Rendering System]
</span><span>    B --> C[Render World]
</span><span>    C --> D[Clone]
</span><span>    D --> E[Main World]
</span><span>    E --> F[Additional Processing]
</span><span>    
</span><span>    subgraph "GPU Resources"
</span><span>        G[MainTargetTextures]
</span><span>        H[TextureFormat]
</span><span>        I[Option&LTTexture>]
</span><span>    end
</span><span>    
</span><span>    A -.-> G
</span><span>    A -.-> H
</span><span>    A -.-> I
</span><span>    G --> J[Texture Handles]
</span><span>    J --> K[Reference Counting]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File:</strong> <code>crates/bevy_render/src/view/mod.rs</code><p><strong>Description:</strong> Added the <code>Clone</code> derive to the <code>ViewTarget</code> struct to enable cloning instances for transfer between ECS worlds.<p><strong>Code Change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ViewTarget </span><span>{
</span><span>    main_textures</span><span style=color:#61676ccc>:</span><span> MainTargetTextures,
</span><span>    main_texture_format</span><span style=color:#61676ccc>:</span><span> TextureFormat,
</span><span>    out_texture</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTTexture>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ViewTarget </span><span>{
</span><span>    main_textures</span><span style=color:#61676ccc>:</span><span> MainTargetTextures,
</span><span>    main_texture_format</span><span style=color:#61676ccc>:</span><span> TextureFormat,
</span><span>    out_texture</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTTexture>,
</span><span>}
</span></code></pre><p><strong>Explanation:</strong> The change adds <code>Clone</code> to the derive macro list. The struct’s fields all implement <code>Clone</code>: <code>MainTargetTextures</code> likely contains <code>Arc</code>-wrapped or handle-based GPU resources, <code>TextureFormat</code> is an enum or simple type, and <code>Option&LTTexture></code> where <code>Texture</code> is a GPU resource handle. This enables safe cloning that creates new references to the same GPU resources.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/clone/trait.Clone.html target=_blank>Rust Clone trait documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ecs/ target=_blank>Bevy ECS Worlds and Resources</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_render/src/view/mod.rs target=_blank>Bevy Rendering: ViewTarget and Camera systems</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/procedural-macros.html#derive-macros target=_blank>Derive macros in Rust</a></ol><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_render/src/view/mod.rs b/crates/bevy_render/src/view/mod.rs
</span><span>index 0226f22c770b8..040d0ce7bc3cc 100644
</span><span style=color:#c594c5>--- a/crates/bevy_render/src/view/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_render/src/view/mod.rs
</span><span style=color:#c594c5>@@ -601,7 +601,7 @@ </span><span style=color:#399ee6>pub struct ViewUniformOffset {
</span><span>     pub offset: u32,
</span><span> }
</span><span> 
</span><span style=color:#f07171>-#[derive(Component)]
</span><span style=color:#86b300>+#[derive(Component, Clone)]
</span><span> pub struct ViewTarget {
</span><span>     main_textures: MainTargetTextures,
</span><span>     main_texture_format: TextureFormat,
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22024.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>