<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22162 Revise release_notes/get_components_mut.md
        
    </title><meta content="#22162 Revise release_notes/get_components_mut.md" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22162-zh-cn-20251217>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Revise release_notes/get_components_mut.md<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22162<li><strong>Author</strong>: Architector4<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-ECS, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-17T12:22:01Z<li><strong>Merged</strong>: 2025-12-17T19:01:50Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>This release note provides useful information, but it is written as a single long paragraph with subpar grammar and at times unclear meaning.<h1 id=solution>Solution</h1><p>Revise the text in this release note: split into three paragraphs, each delivering its own point separately.<p>(for the record, no i don’t use LLMs, don’t @ me about the hyphens lmao)<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a documentation clarity issue in the Bevy game engine’s release notes. The problem was straightforward: a release note describing a new API addition was difficult to read and understand due to poor grammatical structure and formatting. The existing documentation contained all necessary technical information, but it was compressed into a single dense paragraph, making it hard for developers to quickly grasp the key points about the new <code>get_components_mut</code> methods.<p>The developer approached this problem by restructuring the content into logical paragraphs. The original release note attempted to explain three distinct concepts in one continuous block: 1) the addition of the new safe methods, 2) why the previous unsafe versions were necessary, and 3) the performance trade-offs of the new safe implementation. By separating these concepts into three paragraphs, the revision creates a much clearer progression of information.<p>Looking at the implementation, we can see the developer made several key improvements beyond just paragraph breaks. The revised text uses clearer terminology and more precise language. For example, the original stated that the unsafe version “needed to be unsafe because specifying (&mut T, &mut T) is possible which would return multiple mutable references to the same component.” The revised version explains this more clearly: “They are not safe because they allow retrieving <code>(&mut T, &mut T)</code> - two mutable references to a single component - which breaks Rust’s pointer aliasing rules.” This phrasing is more technically accurate and explicitly references Rust’s safety guarantees.<p>The developer also improved the explanation of the performance considerations. The original note mentioned “a O(n^2) check for conflicts” and warned that “if your code is performance sensitive it may make sense to keep using <code>get_components_mut_unchecked</code>.” The revised version clarifies this with “The new methods work around this via performing a quadratic time complexity check between all specified components for conflicts” and adds the important caveat “if you can guarantee that no aliasing would occur.” This gives developers clearer guidance about when to use each version.<p>This documentation change has a significant impact on developer experience. Clear release notes are essential for a project like Bevy where developers need to understand API changes quickly and accurately. Well-structured documentation reduces the cognitive load on developers trying to understand new features or changes. The three-paragraph structure creates natural breaking points that allow developers to process each piece of information separately, making the entire feature easier to understand and apply correctly in their own code.<p>The technical insight here is that even simple documentation improvements can have substantial impact on a project’s usability. While this PR doesn’t change any functional code, it improves the quality of information available to developers working with Bevy’s Entity Component System. The clearer explanation of the safety versus performance trade-off helps developers make more informed decisions about which API to use in different situations, potentially preventing bugs or performance issues in their games.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Original Release Note&LTbr>Single Paragraph] --> B{Problem: Poor Readability}
</span><span>    B --> C[Solution: Restructure Content]
</span><span>    C --> D[Paragraph 1: New Safe Methods]
</span><span>    C --> E[Paragraph 2: Unsafe Version Context]
</span><span>    C --> F[Paragraph 3: Performance Trade-offs]
</span><span>    D --> G[Improved Developer Experience]
</span><span>    E --> G
</span><span>    F --> G
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>release-content/release-notes/get_components_mut.md</code></strong><p>This file contains the release note documentation for the <code>get_components_mut</code> API addition. The changes improve readability by restructuring a single paragraph into three logically separated paragraphs with clearer language and better grammar.<p><strong>Before:</strong><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>A safe version of </span><span style=color:#ed9366;background-color:#61676c10>`EntityMut::get_components_mut`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`EntityWorldMut::get_components_mut`</span><span>
</span><span>was added. Previously a unsafe version was added </span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span>. It needed
</span><span>to be unsafe because specifying (&mut T, &mut T) is possible which would return multiple
</span><span>mutable references to the same component. This was done by adding a O(n^2) check for
</span><span>conflicts which returns a </span><span style=color:#ed9366;background-color:#61676c10>`QueryAccessError::Conflict`</span><span>. Because of the cost of the checks
</span><span>if your code is performance sensitive it may make sense to keep using
</span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span>.
</span></code></pre><p><strong>After:</strong><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>Methods </span><span style=color:#ed9366;background-color:#61676c10>`EntityMut::get_components_mut`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`EntityWorldMut::get_components_mut`</span><span> are now
</span><span>added, providing a safe API for retrieving mutable references to multiple components via
</span><span>these entity access APIs.
</span><span>
</span><span>Previously, only the unsafe variants of these methods, called
</span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span>, were present. They are not safe because they allow
</span><span>retrieving </span><span style=color:#ed9366;background-color:#61676c10>`(&mut T, &mut T)`</span><span> - two mutable references to a single component - which
</span><span>breaks Rust's pointer aliasing rules.
</span><span>
</span><span>The new methods work around this via performing a quadratic time complexity check between
</span><span>all specified components for conflicts, returning </span><span style=color:#ed9366;background-color:#61676c10>`QueryAccessError::Conflict`</span><span> if such
</span><span>occurs. This potentially has a runtime performance cost, so it might be favorable to still
</span><span>use </span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span> if you can guarantee that no aliasing would occur.
</span></code></pre><p>The changes transform a single, dense paragraph into three clear sections:<ol><li><strong>Introduction of new safe methods</strong> - Clearly states what was added<li><strong>Context about unsafe versions</strong> - Explains why unsafe versions were necessary<li><strong>Performance considerations</strong> - Details the implementation trade-off and when to use which version</ol><h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rust’s Aliasing Rules</strong>: The Rustonomicon section on aliasing explains why having multiple mutable references to the same data is unsafe (https://doc.rust-lang.org/nomicon/aliasing.html)</p><li><p><strong>Bevy ECS Documentation</strong>: The Bevy ECS guide provides background on entity-component systems and how to work with entities and components (https://bevy-cheatbook.github.io/programming/ecs-intro.html)</p><li><p><strong>API Design for Safety and Performance</strong>: This article discusses trade-offs between safety and performance in API design, relevant to the decision to provide both safe and unsafe versions of the method (https://rust-lang.github.io/api-guidelines/)</p><li><p><strong>Quadratic Time Complexity</strong>: Big O notation explanation for understanding the O(n²) performance characteristic mentioned in the release notes (https://en.wikipedia.org/wiki/Time_complexity)</p><li><p><strong>Bevy Release Notes Structure</strong>: Understanding how Bevy organizes its release notes can help contributors write better documentation (https://github.com/bevyengine/bevy/blob/main/RELEASES.md)</p></ol><h1 id=full-code-diff>Full Code Diff</h1><h2 id=diff-git-a-release-content-release-notes-get-components-mut-md-b-release-content-release-notes-get-components-mut-mdindex-85a300e9f1496-c7d72563d9c26-100644-a-release-content-release-notes-get-components-mut-md-b-release-content-release-notes-get-components-mut-md-4-10-4-16-authors-hymm-pull-requests-21780>diff –git a/release-content/release-notes/get_components_mut.md b/release-content/release-notes/get_components_mut.md index 85a300e9f1496..c7d72563d9c26 100644 — a/release-content/release-notes/get_components_mut.md +++ b/release-content/release-notes/get_components_mut.md @@ -4,10 +4,16 @@ authors: [“@hymm”] pull_requests: [21780]</h2><p>-A safe version of <code>EntityMut::get_components_mut</code> and <code>EntityWorldMut::get_components_mut</code> -was added. Previously a unsafe version was added <code>get_components_mut_unchecked</code>. It needed -to be unsafe because specifying (&mut T, &mut T) is possible which would return multiple -mutable references to the same component. This was done by adding a O(n^2) check for -conflicts which returns a <code>QueryAccessError::Conflict</code>. Because of the cost of the checks -if your code is performance sensitive it may make sense to keep using -<code>get_components_mut_unchecked</code>. +Methods <code>EntityMut::get_components_mut</code> and <code>EntityWorldMut::get_components_mut</code> are now +added, providing a safe API for retrieving mutable references to multiple components via +these entity access APIs. + +Previously, only the unsafe variants of these methods, called +<code>get_components_mut_unchecked</code>, were present. They are not safe because they allow +retrieving <code>(&mut T, &mut T)</code> - two mutable references to a single component - which +breaks Rust’s pointer aliasing rules. + +The new methods work around this via performing a quadratic time complexity check between +all specified components for conflicts, returning <code>QueryAccessError::Conflict</code> if such +occurs. This potentially has a runtime performance cost, so it might be favorable to still +use <code>get_components_mut_unchecked</code> if you can guarantee that no aliasing would occur.</div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22162.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>