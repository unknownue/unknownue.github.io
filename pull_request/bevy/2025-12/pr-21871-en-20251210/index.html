<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21871 Fix scene viewer animation switching
        
    </title><meta content="#21871 Fix scene viewer animation switching" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21871-zh-cn-20251210>中文</a></div></div><div class=pr-content><h1 id=fix-scene-viewer-animation-switching>Fix scene viewer animation switching</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix scene viewer animation switching<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21871<li><strong>Author</strong>: greeble-dev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, C-Examples, S-Ready-For-Final-Review, A-Animation, D-Straightforward<li><strong>Created</strong>: 2025-11-17T16:10:50Z<li><strong>Merged</strong>: 2025-12-10T00:19:59Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The PR description is already in English and remains unchanged.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The scene_viewer example in Bevy is a tool for previewing 3D scenes and their animations. It allows users to load a model and cycle through its available animations using the Enter key. However, there was a bug where switching between animations didn’t properly stop the previous animation - instead, it kept playing in the background, causing multiple animations to blend together in unexpected ways.<p>The issue appears to have been introduced when animation graphs were added in PR #11989, though the author notes they haven’t confirmed this definitively. Animation graphs in Bevy allow multiple animations to play simultaneously and blend together, which is useful for complex animation states. However, for the scene_viewer example’s specific use case of previewing individual animations sequentially, this behavior was incorrect.<p>Looking at the original code, the problem was in how animation switching was handled. When the user pressed Enter to switch animations, the code would:<ol><li>Check if any animations were playing (not paused)<li>Rewind all animations and pause them<li>Advance to the next animation clip<li>Play the new clip<li>If animations were playing before, resume all animations</ol><p>The critical issue was in step 5: <code>player.resume_all()</code> would resume ALL animations, including the ones that were supposed to be stopped. This happened because the code only paused animations rather than stopping them entirely. In Bevy’s animation system, paused animations are still part of the animation graph and will resume playing when unpaused.<p>The fix is straightforward: instead of pausing all animations and then resuming them, we need to actually stop the previous animations. The <code>stop_all()</code> method removes animations from the animation graph entirely, ensuring they don’t continue to affect the model. The implementation maintains the pause state correctly - if animations were paused before switching, the new animation should also start paused.<p>The revised logic now:<ol><li>Records whether animations are currently paused<li>Stops all animations (removing them from the animation graph)<li>Advances to the next clip<li>Plays the new clip<li>If animations were paused before, pauses the new animation</ol><p>This approach ensures clean transitions between animations without residual animation state bleeding through. The change is minimal - just 4 lines added and 5 lines removed - but it corrects the fundamental misunderstanding of how the animation system should be used for this specific use case.<p>The fix demonstrates an important distinction in animation systems: the difference between pausing an animation (temporarily halting playback while keeping it in the animation graph) versus stopping an animation (removing it from the animation graph entirely). For single-animation preview tools like scene_viewer, stopping is the correct approach. For more complex animation state machines where animations might need to resume from where they left off, pausing would be appropriate.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[User Presses Enter] --> B{Animations Playing?}
</span><span>    B -->|Yes| C[Record: not paused]
</span><span>    B -->|No| D[Record: paused]
</span><span>    C --> E[Stop all animations]
</span><span>    D --> E
</span><span>    E --> F[Advance to next animation clip]
</span><span>    F --> G[Play new clip]
</span><span>    G --> H{Paused before?}
</span><span>    H -->|Yes| I[Pause new animation]
</span><span>    H -->|No| J[New animation plays normally]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-tools-scene-viewer-animation-plugin-rs-4-5><code>examples/tools/scene_viewer/animation_plugin.rs</code> (+4/-5)</h3><p>This file contains the animation handling logic for the scene_viewer example. The changes fix a bug where switching animations would cause multiple animations to play simultaneously instead of cleanly switching between them.<p><strong>Key Changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>if</span><span> keyboard_input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(KeyCode</span><span style=color:#ed9366>::</span><span>Enter) {
</span><span>    </span><span style=color:#f07171>info!</span><span>(</span><span style=color:#86b300>"switching to new animation for {display_entity_name}"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let</span><span> resume </span><span style=color:#ed9366>= !</span><span>player</span><span style=color:#ed9366>.</span><span style=color:#f07171>all_paused</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// set the current animation to its start and pause it to reset to its starting state
</span><span>    player</span><span style=color:#ed9366>.</span><span style=color:#f07171>rewind_all</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>pause_all</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>    clips</span><span style=color:#ed9366>.</span><span style=color:#f07171>advance_to_next</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> current_clip </span><span style=color:#ed9366>=</span><span> clips</span><span style=color:#ed9366>.</span><span style=color:#f07171>current</span><span>()</span><span style=color:#61676ccc>;
</span><span>    player</span><span style=color:#ed9366>.</span><span style=color:#f07171>play</span><span>(current_clip)</span><span style=color:#ed9366>.</span><span style=color:#f07171>repeat</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>if</span><span> resume {
</span><span>        player</span><span style=color:#ed9366>.</span><span style=color:#f07171>resume_all</span><span>()</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if</span><span> keyboard_input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(KeyCode</span><span style=color:#ed9366>::</span><span>Enter) {
</span><span>    </span><span style=color:#f07171>info!</span><span>(</span><span style=color:#86b300>"switching to new animation for {display_entity_name}"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let</span><span> paused </span><span style=color:#ed9366>=</span><span> player</span><span style=color:#ed9366>.</span><span style=color:#f07171>all_paused</span><span>()</span><span style=color:#61676ccc>;
</span><span>    player</span><span style=color:#ed9366>.</span><span style=color:#f07171>stop_all</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>    clips</span><span style=color:#ed9366>.</span><span style=color:#f07171>advance_to_next</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> current_clip </span><span style=color:#ed9366>=</span><span> clips</span><span style=color:#ed9366>.</span><span style=color:#f07171>current</span><span>()</span><span style=color:#61676ccc>;
</span><span>    player</span><span style=color:#ed9366>.</span><span style=color:#f07171>play</span><span>(current_clip)</span><span style=color:#ed9366>.</span><span style=color:#f07171>repeat</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>if</span><span> paused {
</span><span>        player</span><span style=color:#ed9366>.</span><span style=color:#f07171>pause_all</span><span>()</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>The key differences:<ol><li>Changed from <code>let resume = !player.all_paused()</code> to <code>let paused = player.all_paused()</code> (more direct semantics)<li>Replaced <code>player.rewind_all().pause_all()</code> with <code>player.stop_all()</code> (actually removes animations instead of just pausing them)<li>Changed from checking <code>resume</code> to checking <code>paused</code> and using <code>pause_all()</code> instead of <code>resume_all()</code></ol><p>These changes ensure that when switching animations, previous animations are completely stopped rather than just paused, preventing multiple animations from playing simultaneously.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Animation Documentation</strong>: Official documentation for Bevy’s animation system<li><strong>PR #11989</strong>: The original PR that added animation graphs to Bevy (may provide context for when this bug was introduced)<li><strong>Bevy Examples</strong>: Other animation examples in the Bevy repository demonstrate different animation patterns<li><strong>Animation State Machines</strong>: Concepts for managing complex animation transitions in game engines<li><strong>glTF Animation Format</strong>: Understanding how animations are stored and played from glTF files</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21871.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>