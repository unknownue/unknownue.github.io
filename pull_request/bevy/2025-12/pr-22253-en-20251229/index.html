<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22253 Solari: Enable directional light soft shadows
        
    </title><meta content="#22253 Solari: Enable directional light soft shadows" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22253-zh-cn-20251229>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Solari: Enable directional light soft shadows<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Solari: Enable directional light soft shadows<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22253<li><strong>Author</strong>: JMS55<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-12-24T02:38:39Z<li><strong>Merged</strong>: 2025-12-29T05:21:50Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>Another last minute defaults change for Solari (I need to make these proper configs soon…)<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a configuration issue in Bevy’s Solari rendering system related to directional light soft shadows. The problem was straightforward: the default behavior for directional light shadows needed to be changed from hard shadows to soft shadows. The technical context is that Solari, Bevy’s new renderer, is still in active development, and configuration options are currently implemented through compile-time flags in shader code rather than runtime settings.<p>The developer faced a practical issue: soft shadows for directional lights were disabled by default, requiring explicit enablement via the <code>DIRECTIONAL_LIGHT_SOFT_SHADOWS</code> preprocessor flag. This default didn’t match the desired user experience for the Solari renderer, where soft shadows should be the standard behavior. The constraint was that the configuration system for Solari wasn’t yet mature - as noted in the PR description, the developer acknowledged the need for proper configuration systems in the future.<p>The solution approach was minimal and pragmatic: invert the conditional logic in the shader code. Instead of requiring the presence of a flag to enable soft shadows, the code now enables soft shadows by default unless a different flag (<code>NO_DIRECTIONAL_LIGHT_SOFT_SHADOWS</code>) is explicitly defined. This represents a straightforward engineering decision - change the default behavior with minimal code impact while maintaining backward compatibility for users who explicitly want to disable the feature.<p>The implementation consists of a single-line change in a WGSL shader file. The technical insight here is about compile-time configuration management in graphics pipelines. The <code>#ifdef</code> and <code>#ifndef</code> preprocessor directives control which code paths are included during shader compilation. By changing from <code>#ifdef DIRECTIONAL_LIGHT_SOFT_SHADOWS</code> to <code>#ifndef NO_DIRECTIONAL_LIGHT_SOFT_SHADOWS</code>, the default behavior flips from opt-in to opt-out. This approach maintains the same technical capability (soft shadows can still be disabled) while changing the default experience.<p>The impact of this change is primarily about user experience defaults rather than technical functionality. Users of the Solari renderer will now get soft shadows for directional lights without needing to configure anything. The codebase impact is minimal - just one line changed. A key technical lesson from this PR is the importance of thoughtful default settings in rendering systems, especially during active development when user expectations are being established. The developer’s comment about needing “proper configs soon” highlights a common pattern in systems development: starting with compile-time configuration and evolving toward runtime configuration as the system matures.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Solari Rendering System] --> B[Directional Light Shadows]
</span><span>    B --> C{Soft Shadows Configuration}
</span><span>    C -->|Default Before| D[Hard Shadows]
</span><span>    C -->|Default After| E[Soft Shadows]
</span><span>    C -->|Explicit Option| F[NO_DIRECTIONAL_LIGHT_SOFT_SHADOWS]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-solari-src-scene-sampling-wgsl-1-1><code>crates/bevy_solari/src/scene/sampling.wgsl</code> (+1/-1)</h3><p>This WGSL shader file handles light sampling in the Solari renderer. The change flips the default behavior for directional light soft shadows from disabled to enabled.<p><strong>Code Change:</strong><pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// Before:
</span><span>#ifdef DIRECTIONAL_LIGHT_SOFT_SHADOWS
</span><span>    // Sample a random direction within a cone whose base is the sun approximated as a disk
</span><span>    // https://www.realtimerendering.com/raytracinggems/unofficial_RayTracingGems_v1.9.pdf#0004286901.INDD%3ASec30%3A305
</span><span>    var rng = light_sample.seed;
</span><span>
</span><span>// After:
</span><span>#ifndef NO_DIRECTIONAL_LIGHT_SOFT_SHADOWS
</span><span>    // Sample a random direction within a cone whose base is the sun approximated as a disk
</span><span>    // https://www.realtimerendering.com/raytracinggems/unofficial_RayTracingGems_v1.9.pdf#0004286901.INDD%3ASec30%3A305
</span><span>    var rng = light_sample.seed;
</span></code></pre><p>The change replaces a <code>#ifdef</code> (if defined) directive with <code>#ifndef</code> (if not defined), effectively inverting the condition. The code block that implements soft shadow sampling for directional lights is now included by default unless the <code>NO_DIRECTIONAL_LIGHT_SOFT_SHADOWS</code> flag is explicitly defined during compilation.<p>This change directly implements the PR’s goal of enabling directional light soft shadows by default in the Solari renderer, while maintaining the ability to disable them for specific use cases.<h2 id=further-reading>Further Reading</h2><ol><li><strong>WGSL Specification</strong>: Understanding WebGPU Shading Language syntax and preprocessor directives<li><strong>Real-Time Rendering Techniques</strong>: The linked Ray Tracing Gems resource provides background on the soft shadow implementation technique<li><strong>Configuration Management in Game Engines</strong>: Patterns for managing renderer settings at compile-time vs. runtime<li><strong>Bevy’s Solari Renderer Documentation</strong>: For context on the broader rendering system this change affects<li><strong>Graphics Pipeline Configuration</strong>: Best practices for managing shader variants and feature flags in modern rendering engines</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22253.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>