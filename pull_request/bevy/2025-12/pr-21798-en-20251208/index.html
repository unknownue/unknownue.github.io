<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21798 Implement world.trigger_event remote method
        
    </title><meta content="#21798 Implement world.trigger_event remote method" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-08</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21798-zh-cn-20251208>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Implement world.trigger_event remote method<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Implement world.trigger_event remote method<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21798<li><strong>Author</strong>: Lancelotbronner<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, A-Dev-Tools, X-Uncontroversial<li><strong>Created</strong>: 2025-11-10T06:57:09Z<li><strong>Merged</strong>: 2025-12-08T22:01:20Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Tools using <code>bevy_remote</code> will be able to identify (via the schema) and trigger events.<ul><li><input checked disabled type=checkbox> Document <code>bevy_ecs/src/reflect/event.rs</code></ul><h2 id=solution>Solution</h2><p>I’ve added a method <code>world.trigger_event</code>, added <code>Event</code> to the schema’s reflection metadata and <code>ReflectEvent</code> to allow this.<h2 id=testing>Testing</h2><p>I have copied the (tested) code from my game but have NOT tested this branch yet. I am new to Rust/Cargo and need to go to sleep now, I’ll figure this out and test it tomorrow.<hr><h2 id=showcase>Showcase</h2><p>Here’s what I needed to add to my game in order to allow my editor to access and trigger an event:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Event</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Event)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>AssignToRoute </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>vehicle</span><span style=color:#61676ccc>:</span><span> Entity,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>route</span><span style=color:#61676ccc>:</span><span> Entity,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>origin</span><span style=color:#61676ccc>:</span><span> Entity,
</span><span>}
</span></code></pre><p>Here’s a screenshot of my editor using this feature:</p><img alt="Screenshot 2025-11-10 at 1 40 42 AM" height=967 src=https://github.com/user-attachments/assets/7696ddb8-3552-4e0d-a78f-6178c0c66cbb width=1463><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a specific gap in Bevy’s remote tooling capabilities. The developer was building an external editor that needed to interact with a running Bevy application through the <code>bevy_remote</code> system. While the remote API already provided methods for manipulating components and resources, it lacked a way to trigger events, which are a fundamental part of Bevy’s ECS architecture for handling one-shot occurrences.<p>The core problem was straightforward: external tools couldn’t trigger events in a remote Bevy application. This limitation meant that editors couldn’t simulate game interactions or send commands to the application via events. The developer needed this functionality for their editor to assign vehicles to routes in their game, as shown in the showcase example.<p>The solution follows Bevy’s existing patterns for reflection and remote APIs. The implementation adds three main components:<ol><li><strong>Event reflection infrastructure</strong> similar to what already existed for components and resources<li><strong>A new remote method</strong> <code>world.trigger_event</code> that uses this reflection<li><strong>Schema updates</strong> so remote tools can discover which events are available</ol><p>Looking at the implementation, the developer created a new <code>ReflectEvent</code> type in <code>bevy_ecs/src/reflect/event.rs</code>. This follows the same pattern as <code>ReflectComponent</code> and <code>ReflectResource</code> - it provides a way to work with events through runtime type information rather than compile-time generics. The <code>ReflectEvent</code> struct contains a function pointer that knows how to trigger an event of a specific type given a reflected representation of that event.<p>The key insight here is that events in Bevy need to be triggered through their specific <code>Event</code> trait implementation, but when working remotely, we only know the type at runtime. The <code>ReflectEvent</code> implementation bridges this gap by using <code>from_reflect_with_fallback</code> to deserialize the event data and then calling <code>world.trigger()</code> with the deserialized event.<p>In the remote layer, the new <code>process_remote_trigger_event_request</code> function handles incoming requests. It looks up the event type in the type registry, finds its <code>ReflectEvent</code> implementation, deserializes the event payload if provided (or uses a default), and triggers the event. This follows the same error handling patterns as existing remote methods - if the event type isn’t found or isn’t reflectable, appropriate errors are returned.<p>The implementation also includes comprehensive documentation in the new event reflection module, explaining how <code>ReflectEvent</code> works and when developers might need to create custom implementations. This is important because the pattern mirrors existing reflection types in Bevy, and the documentation helps maintain consistency across the codebase.<p>One interesting detail is the test included in <code>builtin_methods.rs</code>. It shows how the feature works end-to-end: defining a reflectable event, setting up an observer to detect when the event is triggered, then using the remote method to trigger it and verifying the observer was called. This test pattern is consistent with existing tests in the module and provides confidence that the implementation works correctly.<p>The impact of this change is that external tools can now fully interact with Bevy applications through events, not just through component and resource manipulation. This completes the remote API’s coverage of Bevy’s core ECS concepts and enables more sophisticated tooling. For example, game editors can now send commands to the game, debugging tools can simulate specific scenarios, and automation scripts can trigger events as part of testing pipelines.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Remote Client] -->|BRP Request| B[bevy_remote]
</span><span>    B -->|world.trigger_event| C[process_remote_trigger_event_request]
</span><span>    C --> D[TypeRegistry]
</span><span>    D -->|Lookup| E[ReflectEvent]
</span><span>    E -->|Trigger| F[World]
</span><span>    F -->|Event Observer| G[Game Systems]
</span><span>    
</span><span>    H[Event Definition] -->|#[reflect(Event)]| I[Type Registration]
</span><span>    I --> D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-reflect-event-rs-76-0><code>crates/bevy_ecs/src/reflect/event.rs</code> (+76/-0)</h3><p>This new file adds event reflection capabilities to match existing component and resource reflection patterns. It defines <code>ReflectEvent</code> and <code>ReflectEventFns</code> structs that allow triggering events through runtime type information.<p>Key code:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ReflectEvent</span><span>(ReflectEventFns)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ReflectEventFns </span><span>{
</span><span>    trigger</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>fn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World, </span><span style=color:#ed9366>&</span><span>dyn PartialReflect, </span><span style=color:#ed9366>&</span><span>TypeRegistry),
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ReflectEvent </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>trigger</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World, </span><span style=color:#ff8f40>event</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>dyn PartialReflect, </span><span style=color:#ff8f40>registry</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>TypeRegistry) {
</span><span>        (</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span>trigger)(world</span><span style=color:#61676ccc>,</span><span> event</span><span style=color:#61676ccc>,</span><span> registry)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-remote-src-builtin-methods-rs-94-4><code>crates/bevy_remote/src/builtin_methods.rs</code> (+94/-4)</h3><p>This file adds the new remote method implementation. It includes the request parameter struct, the handler function, and a comprehensive test.<p>Key additions:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>BRP_TRIGGER_EVENT_METHOD</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str </span><span style=color:#ed9366>= </span><span style=color:#86b300>"world.trigger_event"</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Serialize</span><span style=color:#61676ccc>,</span><span> Deserialize</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>BrpTriggerEventParams </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>event</span><span style=color:#61676ccc>:</span><span> String,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>value</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTValue>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>process_remote_trigger_event_request</span><span>(
</span><span>    In(</span><span style=color:#ff8f40>params</span><span>): In<</span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTValue>>,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World,
</span><span>) </span><span style=color:#61676ccc>-></span><span> BrpResult {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation handles event lookup and triggering
</span><span>}
</span></code></pre><h3 id=crates-bevy-remote-src-lib-rs-15-1><code>crates/bevy_remote/src/lib.rs</code> (+15/-1)</h3><p>Updated to document the new remote method and register it in the <code>RemotePlugin</code>.<p>Key change:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added to method registration in RemotePlugin
</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_method</span><span>(
</span><span>    builtin_methods</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>BRP_TRIGGER_EVENT_METHOD</span><span style=color:#61676ccc>,
</span><span>    builtin_methods</span><span style=color:#ed9366>::</span><span>process_remote_trigger_event_request</span><span style=color:#61676ccc>,
</span><span>)
</span></code></pre><h3 id=crates-bevy-remote-src-schemas-mod-rs-2-1><code>crates/bevy_remote/src/schemas/mod.rs</code> (+2/-1)</h3><p>Updated to include <code>ReflectEvent</code> in schema metadata so remote tools can discover available events.<p>Key change:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>data_types</span><span style=color:#ed9366>.</span><span>map_type_data</span><span style=color:#ed9366>::</span><span>&LTReflectEvent>(</span><span style=color:#86b300>"Event"</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-ecs-src-lib-rs-1-1><code>crates/bevy_ecs/src/lib.rs</code> (+1/-1)</h3><p>Updated the prelude to export <code>ReflectEvent</code> when the <code>bevy_reflect</code> feature is enabled.<p>Key change:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub use crate</span><span style=color:#ed9366>::</span><span>reflect</span><span style=color:#ed9366>::</span><span>{
</span><span>    AppTypeRegistry</span><span style=color:#61676ccc>,</span><span> ReflectComponent</span><span style=color:#61676ccc>,</span><span> ReflectEvent</span><span style=color:#61676ccc>,</span><span> ReflectFromWorld</span><span style=color:#61676ccc>,</span><span> ReflectResource</span><span style=color:#61676ccc>,
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/events/ target=_blank>Bevy ECS Events Documentation</a> - Official guide to Bevy’s event system<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/reflection/ target=_blank>Bevy Reflection System</a> - How Bevy’s reflection system works<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_remote target=_blank>Bevy Remote API</a> - Source code and examples for remote tooling<li><a rel="noopener nofollow noreferrer" href=https://docs.serde.rs/serde_json/ target=_blank>Serde JSON</a> - JSON serialization used in remote protocol</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21798.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>