<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22175 Fix Unused Warnings in Bevy Dev Tools on WASM
        
    </title><meta content="#22175 Fix Unused Warnings in Bevy Dev Tools on WASM" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-18</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22175-zh-cn-20251218>中文</a></div></div><div class=pr-content><h1 id=title-fix-unused-warnings-in-bevy-dev-tools-on-wasm>Title: Fix Unused Warnings in Bevy Dev Tools on WASM</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fix unused warnings in bevy_dev_tools on wasm<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22175<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Code-Quality, S-Ready-For-Final-Review, A-Dev-Tools, D-Straightforward<li><strong>Created</strong>: 2025-12-17T22:33:09Z<li><strong>Merged</strong>: 2025-12-18T18:48:42Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>After https://github.com/bevyengine/bevy/pull/21885, FPS overlay has some unused warnings when building for wasm without webgpu</ul><h2 id=solution>Solution</h2><ul><li>Fix them</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a specific compiler warning issue that surfaced after PR #21885 was merged. When building Bevy for WebAssembly (WASM) targets without the WebGPU feature enabled, the compiler started emitting warnings about unused parameters in the FPS overlay system. These warnings weren’t breaking functionality, but they cluttered the build output and represented technical debt that could mask real issues.<p>The root cause was conditional compilation logic in the FPS overlay code. Certain resources, specifically frame time graph materials and shader storage buffers, are only needed when the target architecture supports them. On WASM without WebGPU, these resources aren’t used, but their parameters were still declared in function signatures, causing the compiler to warn about them being unused.<p>The developer approached this by applying more precise conditional compilation attributes. Instead of removing the resources entirely (which would break other configurations), they used <code>#[cfg_attr]</code> to conditionally apply the <code>#[expect(unused)]</code> attribute. This tells the Rust compiler: “We know these parameters won’t be used in this specific configuration, and that’s expected behavior - don’t warn us about it.”<p>The implementation shows good understanding of Rust’s conditional compilation system. The condition <code>all(target_arch = "wasm32", not(feature = "webgpu"))</code> precisely targets the problematic configuration. The use of <code>#[cfg_attr]</code> with a reason string (<code>reason = "Unused variables in wasm32 without webgpu feature"</code>) follows best practices for documentation, making it clear to future developers why this exception exists.<p>This fix maintains the existing architecture while cleaning up compiler warnings. It doesn’t change any functionality - the WASM without WebGPU build path remains the same, just without the warning noise. The solution is minimal and focused, addressing only the specific issue without introducing unnecessary complexity or changes to other parts of the codebase.<p>From an engineering perspective, this PR demonstrates proper use of Rust’s attribute system for platform-specific code. The <code>#[expect(unused)]</code> attribute is particularly useful here because it’s a lint attribute that can be controlled at the function parameter level, allowing fine-grained suppression of warnings only where needed. This approach is superior to blanket <code>#[allow(unused)]</code> attributes because it’s more specific and self-documenting.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #21885 Changes] --> B[Compiler Warnings in WASM without WebGPU]
</span><span>    B --> C[Diagnosis: Unused Parameters]
</span><span>    C --> D[Solution: Conditional #[expect(unused)]]
</span><span>    D --> E[Clean Build Output]
</span><span>    
</span><span>    F[bevy_dev_tools] --> G[fps_overlay.rs]
</span><span>    G --> H[setup function]
</span><span>    H --> I[FrameTimeGraphMaterials Parameter]
</span><span>    H --> J[ShaderStorageBuffer Parameter]
</span><span>    I --> K[Conditional #[expect(unused)]]
</span><span>    J --> K
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-dev-tools-src-fps-overlay-rs-12-5><code>crates/bevy_dev_tools/src/fps_overlay.rs</code> (+12/-5)</h3><p>This file contains the FPS overlay system for development tools. The changes fix compiler warnings that appeared when building for WASM without WebGPU support.<p><strong>Key modifications:</strong><ol><li><strong>Conditional imports</strong>: Added <code>#[cfg]</code> attributes to conditionally import certain modules only when they’re actually used:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_ui_render</span><span style=color:#ed9366>::</span><span>prelude</span><span style=color:#ed9366>::</span><span>MaterialNode</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use crate</span><span style=color:#ed9366>::</span><span>frame_time_graph</span><span style=color:#ed9366>::</span><span>{
</span><span>    FrameTimeGraphConfigUniform</span><span style=color:#61676ccc>,</span><span> FrameTimeGraphPlugin</span><span style=color:#61676ccc>,</span><span> FrametimeGraphMaterial</span><span style=color:#61676ccc>,
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(</span><span style=color:#f29718>all</span><span>(target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"webgpu"</span><span>))))]
</span><span style=color:#fa6e32>use </span><span>bevy_ui_render</span><span style=color:#ed9366>::</span><span>prelude</span><span style=color:#ed9366>::</span><span>MaterialNode</span><span style=color:#61676ccc>;
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(</span><span style=color:#f29718>all</span><span>(target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"webgpu"</span><span>))))]
</span><span style=color:#fa6e32>use crate</span><span style=color:#ed9366>::</span><span>frame_time_graph</span><span style=color:#ed9366>::</span><span>FrameTimeGraphConfigUniform</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use crate</span><span style=color:#ed9366>::</span><span>frame_time_graph</span><span style=color:#ed9366>::</span><span>{FrameTimeGraphPlugin</span><span style=color:#61676ccc>,</span><span> FrametimeGraphMaterial}</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><strong>Conditional parameter attributes</strong>: Applied <code>#[cfg_attr]</code> to suppress unused parameter warnings only in the specific configuration where they’re expected to be unused:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>setup</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>overlay_config</span><span style=color:#61676ccc>: </span><span>Res&LTFpsOverlayConfig>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>frame_time_graph_materials</span><span style=color:#61676ccc>: </span><span>ResMut&LTAssets&LTFrametimeGraphMaterial>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>buffers</span><span style=color:#61676ccc>: </span><span>ResMut&LTAssets&LTShaderStorageBuffer>>,
</span><span>) {
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>setup</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>overlay_config</span><span style=color:#61676ccc>: </span><span>Res&LTFpsOverlayConfig>,
</span><span>    #[cfg_attr(
</span><span>        </span><span style=color:#ff8f40>all</span><span>(</span><span style=color:#ff8f40>target_arch</span><span> = "</span><span style=color:#ff8f40>wasm32</span><span>"</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>not</span><span>(</span><span style=color:#ff8f40>feature</span><span> = "</span><span style=color:#ff8f40>webgpu</span><span>"))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#f07171>expect</span><span>(unused</span><span style=color:#61676ccc>,</span><span> reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Unused variables in wasm32 without webgpu feature"</span><span>)
</span><span>    )]
</span><span>    (</span><span style=color:#fa6e32>mut</span><span> frame_time_graph_materials</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut</span><span> buffers)</span><span style=color:#61676ccc>: </span><span>(
</span><span>        ResMut&LTAssets&LTFrametimeGraphMaterial>></span><span style=color:#61676ccc>,
</span><span>        ResMut&LTAssets&LTShaderStorageBuffer>></span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>,
</span><span>) {
</span></code></pre><p><strong>Relationship to PR purpose:</strong> These changes directly address the compiler warnings described in the PR. The conditional imports prevent unused import warnings, while the <code>#[cfg_attr]</code> with <code>#[expect(unused)]</code> prevents unused parameter warnings, both specifically for the WASM without WebGPU configuration.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust Conditional Compilation</strong>: The Rust Book section on conditional compilation explains <code>#[cfg]</code> and related attributes: https://doc.rust-lang.org/reference/conditional-compilation.html<li><strong>Rust Lint Attributes</strong>: Documentation on Rust’s lint attributes including <code>#[allow]</code>, <code>#[warn]</code>, <code>#[deny]</code>, and <code>#[expect]</code>: https://doc.rust-lang.org/rustc/lints/levels.html<li><strong>Bevy Conditional Compilation</strong>: Bevy’s documentation on platform-specific code and conditional compilation patterns used throughout the engine<li><strong>WebAssembly in Bevy</strong>: Information about Bevy’s WASM support and feature flags for different rendering backends</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_dev_tools/src/fps_overlay.rs b/crates/bevy_dev_tools/src/fps_overlay.rs
</span><span>index f6a3c10269856..47729573e1513 100644
</span><span>--- a/crates/bevy_dev_tools/src/fps_overlay.rs
</span><span>+++ b/crates/bevy_dev_tools/src/fps_overlay.rs
</span><span>@@ -20,13 +20,14 @@ use bevy_ui::{
</span><span>     widget::{Text, TextUiWriter},
</span><span>     FlexDirection, GlobalZIndex, Node, PositionType, Val,
</span><span> };
</span><span>+#[cfg(not(all(target_arch = "wasm32", not(feature = "webgpu"))))]
</span><span> use bevy_ui_render::prelude::MaterialNode;
</span><span> use core::time::Duration;
</span><span> use tracing::warn;
</span><span> 
</span><span>-use crate::frame_time_graph::{
</span><span>-    FrameTimeGraphConfigUniform, FrameTimeGraphPlugin, FrametimeGraphMaterial,
</span><span>-};
</span><span>+#[cfg(not(all(target_arch = "wasm32", not(feature = "webgpu"))))]
</span><span>+use crate::frame_time_graph::FrameTimeGraphConfigUniform;
</span><span>+use crate::frame_time_graph::{FrameTimeGraphPlugin, FrametimeGraphMaterial};
</span><span> 
</span><span> /// [`GlobalZIndex`] used to render the fps overlay.
</span><span> ///
</span><span>@@ -163,8 +164,14 @@ struct FrameTimeGraph;
</span><span> fn setup(
</span><span>     mut commands: Commands,
</span><span>     overlay_config: Res&LTFpsOverlayConfig>,
</span><span>-    mut frame_time_graph_materials: ResMut&LTAssets&LTFrametimeGraphMaterial>>,
</span><span>-    mut buffers: ResMut&LTAssets&LTShaderStorageBuffer>>,
</span><span>+    #[cfg_attr(
</span><span>+        all(target_arch = "wasm32", not(feature = "webgpu")),
</span><span>+        expect(unused, reason = "Unused variables in wasm32 without webgpu feature")
</span><span>+    )]
</span><span>+    (mut frame_time_graph_materials, mut buffers): (
</span><span>+        ResMut&LTAssets&LTFrametimeGraphMaterial>>,
</span><span>+        ResMut&LTAssets&LTShaderStorageBuffer>>,
</span><span>+    ),
</span><span> ) {
</span><span>     commands
</span><span>         .spawn((
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22175.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>