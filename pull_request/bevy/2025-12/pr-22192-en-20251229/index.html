<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22192 fixing docs with scraping examples enabled
        
    </title><meta content="#22192 fixing docs with scraping examples enabled" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22192-zh-cn-20251229>中文</a></div></div><div class=pr-content><h1 id=fixing-docs-with-scraping-examples-enabled>fixing docs with scraping examples enabled</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fixing docs with scraping examples enabled<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22192<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, C-Docs, S-Ready-For-Final-Review, A-Cross-Cutting<li><strong>Created</strong>: 2025-12-18T22:20:36Z<li><strong>Merged</strong>: 2025-12-29T04:46:27Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>https://github.com/bevyengine/bevy/pull/22142 didn’t work as intended as scrapping examples is enabled by default on docs.rs</ul><h2 id=solution>Solution</h2><ul><li>Disable only the examples that causes scraping to ICE</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a build failure issue in the Bevy engine’s documentation generation process on docs.rs. The problem stemmed from an internal compiler error (ICE) that occurred when certain examples were processed with the <code>rustdoc-scrape-examples</code> feature enabled by default on the docs.rs documentation hosting platform.<p>The issue began with PR #22142, which attempted to address documentation problems but didn’t achieve the intended result. The core issue was that docs.rs automatically enables example scraping (<code>-Zrustdoc-scrape-examples</code>) when building documentation, which caused compilation failures for specific examples in Bevy’s codebase. An ICE in Rust is a critical compiler bug that halts compilation, preventing successful documentation generation.<p>The solution implemented in this PR takes a targeted approach. Instead of disabling example scraping entirely, which would reduce the quality of documentation by removing helpful example code references, the PR selectively disables scraping only for the examples that cause the ICE. This approach maintains scraping functionality for the majority of examples while fixing the build failures.<p>The implementation involves two key changes. First, the GitHub Actions workflow for building documentation needed to explicitly enable the unstable Rust options and the example scraping feature. This was necessary to reproduce the same build conditions as docs.rs during local testing and CI builds. The workflow modification adds <code>-Zunstable-options</code> and <code>-Zrustdoc-scrape-examples</code> flags to the <code>cargo doc</code> command, ensuring consistency between local documentation builds and docs.rs builds.<p>Second, and more extensively, the PR modifies the <code>Cargo.toml</code> file to disable scraping for problematic examples. The change affects a substantial portion of Bevy’s example definitions - approximately 255 examples have their <code>doc-scrape-examples</code> attribute changed from <code>true</code> to <code>false</code>. Each disabled example includes a comment explaining the rationale: “# Causes an ICE on docs.rs”. This pattern follows Rust’s convention of documenting why a particular configuration choice was made, making the codebase more maintainable.<p>The selective approach is pragmatic. It recognizes that while example scraping is valuable for documentation quality, some examples trigger compiler bugs that prevent the entire documentation build from succeeding. By disabling scraping for only the problematic examples, the PR ensures that documentation builds can complete successfully on docs.rs while preserving scraping functionality for the majority of examples that work correctly.<p>The PR also includes an update to the docs.rs metadata section in <code>Cargo.toml</code>, adding <code>cargo-args = ["-Zunstable-options", "-Zrustdoc-scrape-examples"]</code>. This ensures that when the documentation is built on docs.rs, the same scraping options are applied consistently. The combination of workflow changes and example-specific configuration creates a cohesive solution that addresses the build failures while maintaining as much functionality as possible.<p>This approach demonstrates good software engineering practice: when a feature causes systemic failures, rather than disabling it entirely, selectively disable it where problematic while preserving functionality elsewhere. The solution is minimal and targeted, affecting only what’s necessary to resolve the build failures. The extensive commenting provides clear rationale for future maintainers who might wonder why certain examples don’t have scraping enabled.<p>The technical insight here is understanding the interaction between docs.rs’s default configuration and Rust’s compiler stability. The <code>rustdoc-scrape-examples</code> feature is unstable and can trigger compiler bugs in edge cases. By identifying which examples trigger these bugs and selectively disabling scraping for them, the Bevy team can continue to benefit from example scraping for the majority of their codebase while avoiding build failures.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TB
</span><span>    A[docs.rs builds docs] --> B[Enables scraping by default]
</span><span>    B --> C[Causes ICE for some examples]
</span><span>    C --> D[Build fails]
</span><span>    
</span><span>    E[This PR] --> F[Enable scraping in CI workflow]
</span><span>    F --> G[Selectively disable scraping for problematic examples]
</span><span>    G --> H[Add docs.rs metadata for consistent scraping]
</span><span>    H --> I[Documentation builds successfully]
</span><span>    
</span><span>    D --> I
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-github-workflows-docs-yml>1. <code>.github/workflows/docs.yml</code></h3><p>This file was modified to enable example scraping during documentation builds in GitHub Actions, matching the default behavior of docs.rs.<p><strong>Key change:</strong><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>|
</span><span style=color:#86b300>  cargo doc \
</span><span style=color:#86b300>    --all-features \
</span><span style=color:#86b300>    --workspace \
</span><span style=color:#86b300>    --no-deps \
</span><span style=color:#86b300>    --document-private-items
</span><span style=color:#86b300>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>|
</span><span style=color:#86b300>  cargo doc \
</span><span style=color:#86b300>    -Zunstable-options \
</span><span style=color:#86b300>    -Zrustdoc-scrape-examples \
</span><span style=color:#86b300>    --all-features \
</span><span style=color:#86b300>    --workspace \
</span><span style=color:#86b300>    --no-deps \
</span><span style=color:#86b300>    --document-private-items
</span></code></pre><p>The addition of <code>-Zunstable-options</code> and <code>-Zrustdoc-scrape-examples</code> flags ensures that local documentation builds in CI match the configuration used by docs.rs, allowing developers to catch scraping-related issues before they affect the public documentation.<h3 id=2-cargo-toml>2. <code>Cargo.toml</code></h3><p>This file contains the bulk of the changes, with approximately 255 examples having their scraping disabled.<p><strong>Example of change pattern:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"context_menu"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/usage/context_menu.rs"
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>true
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"context_menu"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/usage/context_menu.rs"
</span><span style=color:#abb0b6;font-style:italic># Causes an ICE on docs.rs
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>false
</span></code></pre><p><strong>docs.rs metadata configuration:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Added to ensure consistent scraping behavior on docs.rs
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>docs</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>rs</span><span>]
</span><span style=color:#399ee6>cargo-args </span><span>= [</span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"-Zrustdoc-scrape-examples"</span><span>]
</span></code></pre><p>The pattern is consistent across all affected examples: the <code>doc-scrape-examples</code> attribute is changed from <code>true</code> to <code>false</code> with a comment explaining that the example causes an ICE on docs.rs. This targeted approach fixes the build failures while preserving scraping for examples that work correctly.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/rust-lang/rfcs/blob/master/text/3123-rustdoc-scrape-examples.md target=_blank>Rustdoc Scrape Examples RFC</a> - The RFC that introduced example scraping to rustdoc<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustdoc/scraped-examples.html target=_blank>Rustdoc Book - Scraping Examples</a> - Official documentation on rustdoc’s example scraping feature<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/about/builds target=_blank>docs.rs Build Process Documentation</a> - Information about how docs.rs builds documentation<li><a rel="noopener nofollow noreferrer" href=https://github.com/rust-lang/rust/blob/master/COMPILER_TEAM.md#reporting-ices target=_blank>Rust Compiler ICE Reporting Guide</a> - How to report internal compiler errors in Rust</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22192.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>