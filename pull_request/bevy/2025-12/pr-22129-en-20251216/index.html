<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22129 Add warning about tracy being enabled
        
    </title><meta content="#22129 Add warning about tracy being enabled" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22129-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add warning about tracy being enabled<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22129<li><strong>Author</strong>: laundmo<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Usability, S-Ready-For-Final-Review, A-Diagnostics, D-Straightforward<li><strong>Created</strong>: 2025-12-15T15:34:45Z<li><strong>Merged</strong>: 2025-12-16T03:55:05Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The original description is in English, so it is included exactly as-is:<h1 id=objective>Objective</h1><ul><li>Fixes: #10831</ul><h2 id=solution>Solution</h2><ul><li>Print a warning about tracy memory usage</ul><h2 id=testing>Testing</h2><p>Did this from my phone, so obviously untested, but its also very simple. Will test later if i don’t forget.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a usability issue where developers might not realize that enabling Tracy profiling in Bevy applications can lead to unexpected memory consumption. The problem was documented in issue #10831, which reported that when the <code>tracing-tracy</code> feature is enabled but no Tracy client is connected, memory usage continuously grows without any indication to the developer.<p>The core issue is a common pitfall with profiling tools: Tracy, a real-time profiling library, buffers profiling data in memory when no client is connected to collect it. Without a visible warning, developers might enable Tracy for profiling purposes, forget to connect a Tracy client, and then wonder why their application’s memory usage keeps increasing during extended runs.<p>The solution implemented here is straightforward and pragmatic. Instead of attempting to modify Tracy’s behavior or implement complex memory monitoring, the PR adds a simple warning message that alerts developers when Tracy is active. This follows the principle of fail-fast and clear communication - letting developers know about potential side effects immediately rather than letting them discover the issue through debugging.<p>The implementation modifies the <code>LogPlugin</code> in Bevy’s logging system. Specifically, it adds a warning log statement that triggers when the <code>tracing-tracy</code> feature is enabled. The warning is placed within the <code>Plugin::build</code> method of <code>LogPlugin</code>, which is executed when the plugin is initialized. This placement ensures the warning appears early in the application lifecycle, giving developers immediate feedback.<p>From a technical perspective, the implementation uses Rust’s conditional compilation with <code>#[cfg(feature = "tracing-tracy")]</code> to ensure the warning only appears when the Tracy feature is actually enabled. This prevents unnecessary warnings in builds without Tracy support. The warning message clearly states both the condition (“Tracing with Tracy is active”) and the consequence (“memory consumption will grow until a client is connected”), providing developers with complete information.<p>The PR demonstrates good practice in diagnostic messaging. The warning is logged at the appropriate level (warn), uses clear and actionable language, and appears at the right time in the application lifecycle. It also respects existing logging configurations since it’s integrated into Bevy’s established logging infrastructure.<p>The impact of this change is significant for developer experience. While the code change is minimal, it prevents potentially confusing debugging sessions where developers might suspect memory leaks in their own code when the actual issue is Tracy’s buffering behavior. This aligns with Bevy’s focus on developer ergonomics and clear error/warning messages.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Application starts] --> B[LogPlugin initializes]
</span><span>    B --> C{Is tracing-tracy feature enabled?}
</span><span>    C -->|Yes| D[Print Tracy memory warning]
</span><span>    C -->|No| E[Continue normal initialization]
</span><span>    D --> F[Proceed with application execution]
</span><span>    E --> F
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-log-src-lib-rs-3-0><code>crates/bevy_log/src/lib.rs</code> (+3/-0)</h3><p>This file contains the LogPlugin implementation that handles Bevy’s logging setup. The change adds a warning message when the Tracy profiling feature is enabled.<p><strong>Key Modification:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_log/src/lib.rs
</span><span style=color:#abb0b6;font-style:italic>// Before (simplified context):
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>LogPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#fa6e32>let</span><span> subscriber_already_set </span><span style=color:#ed9366>=
</span><span>            tracing</span><span style=color:#ed9366>::</span><span>subscriber</span><span style=color:#ed9366>::</span><span>set_global_default(finished_subscriber)</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_err</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>match </span><span>(logger_already_set</span><span style=color:#61676ccc>,</span><span> subscriber_already_set) {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... existing error handling
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>LogPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#fa6e32>let</span><span> subscriber_already_set </span><span style=color:#ed9366>=
</span><span>            tracing</span><span style=color:#ed9366>::</span><span>subscriber</span><span style=color:#ed9366>::</span><span>set_global_default(finished_subscriber)</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_err</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"tracing-tracy"</span><span>)]
</span><span>        </span><span style=color:#f07171>warn!</span><span>(</span><span style=color:#86b300>"Tracing with Tracy is active, memory consumption will grow until a client is connected"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>match </span><span>(logger_already_set</span><span style=color:#61676ccc>,</span><span> subscriber_already_set) {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... existing error handling
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The change adds three lines:<ol><li>A conditional compilation attribute <code>#[cfg(feature = "tracing-tracy")]</code> that ensures the code only compiles when the Tracy feature is enabled<li>A warning log statement using the <code>warn!</code> macro<li>The warning message clearly explains both the state and the consequence</ol><p>This change directly addresses the issue by providing immediate feedback to developers when they enable Tracy profiling, preventing confusion about memory growth.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Tracy Profiler Documentation</strong>: <a rel="noopener nofollow noreferrer" href=https://github.com/wolfpld/tracy target=_blank>https://github.com/wolfpld/tracy</a> - Official Tracy profiler documentation for understanding its features and behavior<li><strong>Rust Conditional Compilation</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>https://doc.rust-lang.org/reference/conditional-compilation.html</a> - Rust reference on <code>#[cfg]</code> attributes and feature-based compilation<li><strong>Bevy Logging System</strong>: <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_log target=_blank>https://github.com/bevyengine/bevy/tree/main/crates/bevy_log</a> - Source code for Bevy’s logging infrastructure<li><strong>Issue #10831</strong>: <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/10831 target=_blank>https://github.com/bevyengine/bevy/issues/10831</a> - The original issue that reported the problem with Tracy memory usage<li><strong>Diagnostic Best Practices</strong>: Patterns for effective error and warning messages in software systems</ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_log/src/lib.rs b/crates/bevy_log/src/lib.rs
</span><span>index 0abe1941c5793..72163f2516075 100644
</span><span style=color:#c594c5>--- a/crates/bevy_log/src/lib.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_log/src/lib.rs
</span><span style=color:#c594c5>@@ -407,6 +407,9 @@ </span><span style=color:#399ee6>impl Plugin for LogPlugin {
</span><span>         let subscriber_already_set =
</span><span>             tracing::subscriber::set_global_default(finished_subscriber).is_err();
</span><span> 
</span><span style=color:#86b300>+        #[cfg(feature = "tracing-tracy")]
</span><span style=color:#86b300>+        warn!("Tracing with Tracy is active, memory consumption will grow until a client is connected");
</span><span style=color:#86b300>+
</span><span>         match (logger_already_set, subscriber_already_set) {
</span><span>             (true, true) => error!(
</span><span>                 "Could not set global logger and tracing subscriber as they are already set. Consider disabling LogPlugin."
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22129.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>