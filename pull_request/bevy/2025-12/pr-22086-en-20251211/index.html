<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22086 fix gltf path texture usages
        
    </title><meta content="#22086 fix gltf path texture usages" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-11</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22086-zh-cn-20251211>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fix gltf path texture usages<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22086<li><strong>Author</strong>: robtfm<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, S-Ready-For-Final-Review, A-glTF<li><strong>Created</strong>: 2025-12-11T00:05:56Z<li><strong>Merged</strong>: 2025-12-11T00:53:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>the asset usages from <code>GltfLoaderSettings::load_materials</code> are not respected when loading path-based / non-embedded textures.<h2 id=solution>Solution</h2><p>use them<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a specific bug in Bevy’s glTF loader where asset usage settings were not being properly applied to path-based textures. When loading glTF files with external texture references (textures stored in separate files rather than embedded in the glTF binary), the loader was ignoring the <code>RenderAssetUsages</code> configuration specified in <code>GltfLoaderSettings::load_materials</code>. This meant that path-based textures would default to standard asset usage patterns regardless of user configuration, while embedded textures correctly respected the settings.<p>The core issue was in the data flow through the texture loading pipeline. The glTF loader handles two types of textures differently: embedded textures (stored within the glTF file) and path-based textures (referenced by external file paths). For embedded textures, the asset usage settings were correctly passed through, but for path-based textures, this configuration was being dropped during the image loading process.<p>The fix involved modifying the <code>ImageOrPath</code> enum to include a <code>render_asset_usages</code> field in its <code>Path</code> variant. Previously, when creating an <code>ImageOrPath::Path</code> instance to represent an external texture file, only the path, srgb setting, and sampler descriptor were included. The asset usage setting from <code>GltfLoaderSettings::load_materials</code> was missing.<p>The change was straightforward but important: when the <code>ImageOrPath::load</code> method processes a <code>Path</code> variant, it now passes the <code>render_asset_usages</code> value to the <code>ImageLoaderSettings</code> via a closure that configures the loader. This ensures that external texture files receive the same asset usage configuration as embedded textures.<p>From an engineering perspective, this fix maintains consistency across different texture loading paths. The <code>GltfLoaderSettings::load_materials</code> setting controls whether materials (and their textures) should be marked for CPU access, GPU-only usage, or other combinations. This is particularly important for optimization - for example, textures that don’t need CPU access can be stored in more efficient GPU memory formats.<p>The implementation is minimal and surgical, changing only what’s necessary to fix the bug without refactoring the surrounding code. The diff shows exactly four lines added: one to store the setting when creating the <code>ImageOrPath::Path</code>, and three to consume it when loading the image. This approach minimizes the risk of introducing new bugs while ensuring the existing configuration system works as intended across all texture loading scenarios.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[GltfLoaderSettings] --> B[load_materials: RenderAssetUsages]
</span><span>    B --> C[load_image function]
</span><span>    C --> D[ImageOrPath::Path]
</span><span>    D --> E[ImageLoaderSettings]
</span><span>    E --> F[Image loaded with correct asset usage]
</span><span>    
</span><span>    style D fill:#f9f,stroke:#333
</span><span>    style E fill:#ccf,stroke:#333
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>crates/bevy_gltf/src/loader/mod.rs</strong> (+4/-0)<p>This was the only file modified in the PR. The changes ensure that the <code>render_asset_usages</code> setting from <code>GltfLoaderSettings::load_materials</code> is properly passed through to path-based texture loading.<p><strong>Key changes:</strong><ol><li><strong>When creating ImageOrPath::Path in load_image function</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In load_image function
</span><span>ImageOrPath</span><span style=color:#ed9366>::</span><span>Path {
</span><span>    path</span><span style=color:#61676ccc>:</span><span> image_path</span><span style=color:#61676ccc>,
</span><span>    is_srgb</span><span style=color:#61676ccc>,
</span><span>    sampler_descriptor</span><span style=color:#61676ccc>,
</span><span>    render_asset_usages</span><span style=color:#61676ccc>:</span><span> settings</span><span style=color:#ed9366>.</span><span>load_materials</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// ← Added this line
</span><span>}
</span></code></pre><ol start=2><li><strong>Updated ImageOrPath enum definition</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>enum </span><span style=color:#399ee6>ImageOrPath </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other variants ...
</span><span>    Path {
</span><span>        path</span><span style=color:#61676ccc>: </span><span>AssetPath<</span><span style=color:#fa6e32>'static</span><span>></span><span style=color:#61676ccc>,
</span><span>        is_srgb</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span><span>        sampler_descriptor</span><span style=color:#61676ccc>:</span><span> ImageSamplerDescriptor</span><span style=color:#61676ccc>,
</span><span>        render_asset_usages</span><span style=color:#61676ccc>:</span><span> RenderAssetUsages</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// ← Added this field
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><ol start=3><li><strong>When loading the image from ImageOrPath::Path</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ImageOrPath </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>load_context</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>LoadContext) </span><span style=color:#61676ccc>-></span><span> UntypedHandle {
</span><span>        </span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self </span><span>{
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... other variants ...
</span><span>            ImageOrPath</span><span style=color:#ed9366>::</span><span>Path {
</span><span>                path</span><span style=color:#61676ccc>,
</span><span>                is_srgb</span><span style=color:#61676ccc>,
</span><span>                sampler_descriptor</span><span style=color:#61676ccc>,
</span><span>                render_asset_usages</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// ← Now available here
</span><span>            } </span><span style=color:#ed9366>=></span><span> load_context
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>loader</span><span>()
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_settings</span><span>(</span><span style=color:#fa6e32>move </span><span style=color:#ed9366>|</span><span>settings</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ImageLoaderSettings</span><span style=color:#ed9366>| </span><span>{
</span><span>                    settings</span><span style=color:#ed9366>.</span><span>is_srgb </span><span style=color:#ed9366>=</span><span> is_srgb</span><span style=color:#61676ccc>;
</span><span>                    settings</span><span style=color:#ed9366>.</span><span>sampler </span><span style=color:#ed9366>= </span><span>ImageSampler</span><span style=color:#ed9366>::</span><span>Descriptor(sampler_descriptor</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>                    settings</span><span style=color:#ed9366>.</span><span>asset_usage </span><span style=color:#ed9366>=</span><span> render_asset_usages</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// ← Passed to loader
</span><span>                })
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(path)</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The changes ensure that when loading path-based textures, the asset usage settings from the glTF loader configuration are properly forwarded to the image loader, maintaining consistency with how embedded textures are handled.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/asset/index.html target=_blank>Bevy Asset System Documentation</a> - Understanding how assets are loaded and managed in Bevy<li><a rel="noopener nofollow noreferrer" href=https://www.khronos.org/gltf/ target=_blank>glTF Specification</a> - Official glTF file format specification<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/render/render_resource/enum.RenderAssetUsages.html target=_blank>Bevy Render Asset Usages</a> - Documentation on different render asset usage patterns<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/render/texture/struct.ImageLoader.html target=_blank>Image Loading in Bevy</a> - How images are loaded with different settings</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22086.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>