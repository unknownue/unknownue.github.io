<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21447 Put input sources for `bevy_input` under features
        
    </title><meta content="#21447 Put input sources for `bevy_input` under features" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21447-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Put input sources for <code>bevy_input</code> under features<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Put input sources for <code>bevy_input</code> under features<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21447<li><strong>Author</strong>: Shatur<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Input, C-Usability, S-Ready-For-Final-Review, M-Migration-Guide, X-Contentious, O-Embedded<li><strong>Created</strong>: 2025-10-07T18:04:49Z<li><strong>Merged</strong>: 2025-12-16T20:39:19Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p><code>bevy_input</code> provides primitives for all kinds of input. But on consoles you usually don’t have things like touch. On more obscure platforms, like GBA, only gamepad input is needed.<h2 id=solution>Solution</h2><p>To avoid including extra stuff, I put each source under a feature. I didn’t enable them by default to avoid typing<pre style=color:#61676c;background-color:#fafafa><code><span>default-features = false, features = [
</span><span>    "std",
</span><span>    "bevy_reflect",
</span><span>    "bevy_ecs/async_executor",
</span><span>    "smol_str"
</span><span>]
</span></code></pre><p>in all places that include <code>bevy_input</code>. Instead, I just enabled the used input sources in <code>bevy_window</code> and <code>bevy_gilrs</code>. This way, when a crate that provides hardware support for a specific input source is not used, the corresponding feature in <code>bevy_input</code> also won’t be enabled.<p>For GBA this reduced the binary size for the <code>game</code> example from 1.6M to 1.4M.<h2 id=considered-alternatives>Considered alternatives</h2><p>I also considered doing something like this:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InputPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>keyboard</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>mouse</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>gamepad</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>touch</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span></code></pre><p>But this doesn’t eliminate extra code even with LTO enabled and might be confusing for users, since toggling these values could cause a crash due to a missing resource when a crate like <code>bevy_window</code> expects it.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem this PR addresses is straightforward: the Bevy engine’s input system was carrying unnecessary bloat for certain target platforms. The <code>bevy_input</code> crate provided abstractions for all input types—keyboard, mouse, gamepad, touch, and gestures—regardless of whether a particular platform supported them. This meant that a game targeting a console without touch input, or an embedded platform like the GBA with only gamepad support, would still compile and link code for unused input systems. This led to wasted binary size, which is particularly critical for resource-constrained embedded systems.<p>The author identified this as an optimization opportunity, especially for platforms like GBA where binary size directly impacts distribution and performance. The initial observation was that the binary size for a GBA example could be reduced by approximately 200KB (from 1.6MB to 1.4MB) simply by eliminating unused input code.<p>The solution implemented follows Rust’s standard approach for conditional compilation: using Cargo features. The core insight was to make each input source type (mouse, keyboard, gamepad, touch, gestures) individually optional through feature flags. However, the implementation had to consider developer experience—forcing users to manually enable features for common desktop platforms would create unnecessary friction.<p>To address this, the author designed a dependency-based feature activation system. Instead of requiring users to manually specify which input features they need, the system automatically enables appropriate features when users depend on crates that provide hardware support for those input types:<ul><li><code>bevy_window</code> (which handles windowing and typically provides mouse, keyboard, touch, and gesture input) automatically enables the corresponding <code>bevy_input</code> features<li><code>bevy_gilrs</code> (which handles gamepad input) automatically enables the gamepad feature</ul><p>This creates a clean separation: users targeting standard platforms continue to work as before without configuration changes, while users targeting specialized platforms can omit these dependency crates and only enable the specific input features they need.<p>The implementation required changes at multiple levels of the dependency chain. First, the root <code>Cargo.toml</code> exposed the new features as pass-throughs to <code>bevy_internal</code>. Then <code>bevy_internal</code> passed them through to <code>bevy_input</code>. The <code>bevy_input</code> crate itself defined the features and used <code>#[cfg(feature = "...")]</code> attributes throughout its codebase to conditionally compile modules, type definitions, and plugin setup logic.<p>One notable aspect of the implementation is how it handles the <code>InputPlugin</code>. The plugin’s <code>build</code> method is now conditional on each feature, with separate blocks for each input type. This required adding <code>#[allow(unused)]</code> attributes because with all features disabled, the <code>app</code> parameter would be unused. The approach maintains the plugin’s single responsibility while allowing fine-grained control over what gets compiled.<p>The author considered an alternative approach using a configurable <code>InputPlugin</code> struct with boolean flags to enable/disable input sources at runtime. This was rejected for two reasons: first, it wouldn’t eliminate unused code from the binary (only compile-time features achieve that); second, it could lead to runtime crashes if users disabled an input source that a downstream crate expected to be available.<p>The migration impact is minimal for most users. Those using <code>bevy_window</code> or <code>bevy_gilrs</code> will see no change in behavior. Users who directly depend on <code>bevy_input</code> without these intermediary crates (likely targeting custom or embedded platforms) need to explicitly enable the features they require. A migration guide was added to document this change.<p>This change represents a practical application of Rust’s feature system to solve a real optimization problem. It demonstrates how to balance optimization goals with user experience by using dependency-based feature activation. The approach reduces binary size for constrained platforms while maintaining convenience for mainstream use cases.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    Root[Cargo.toml&LTbr/>root features] --> Internal[bevy_internal&LTbr/>feature passthrough]
</span><span>    Internal --> Input[bevy_input&LTbr/>conditional compilation]
</span><span>    
</span><span>    Window[bevy_window] -->|enables| Input
</span><span>    Window -->|requires| InputFeatures[keyboard, mouse,&LTbr/>touch, gestures]
</span><span>    
</span><span>    Gilrs[bevy_gilrs] -->|enables| Input
</span><span>    Gilrs -->|requires| GamepadFeature[gamepad]
</span><span>    
</span><span>    Input -->|conditionally compiles| Modules[input modules]
</span><span>    Input -->|conditionally adds| Systems[ECS systems]
</span><span>    Input -->|conditionally adds| Resources[ECS resources]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-input-src-lib-rs-59-24><code>crates/bevy_input/src/lib.rs</code> (+59/-24)</h3><p>This is the core file where conditional compilation was implemented. The changes wrap entire modules, prelude re-exports, system registrations, and resource initializations with feature guards.<p><strong>Key changes:</strong><ol><li>Module declarations are now conditional:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>gamepad</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>gestures</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>keyboard</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>mouse</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>touch</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"gamepad"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>gamepad</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"gestures"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>gestures</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"keyboard"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>keyboard</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"mouse"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>mouse</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"touch"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>touch</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li>The <code>prelude</code> module conditionally re-exports types:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>prelude </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#61676ccc>::</span><span>{
</span><span>        gamepad</span><span style=color:#ed9366>::</span><span>{Gamepad</span><span style=color:#61676ccc>,</span><span> GamepadAxis</span><span style=color:#61676ccc>,</span><span> GamepadButton</span><span style=color:#61676ccc>,</span><span> GamepadSettings}</span><span style=color:#61676ccc>,
</span><span>        keyboard</span><span style=color:#ed9366>::</span><span>KeyCode</span><span style=color:#61676ccc>,
</span><span>        mouse</span><span style=color:#ed9366>::</span><span>MouseButton</span><span style=color:#61676ccc>,
</span><span>        touch</span><span style=color:#ed9366>::</span><span>{TouchInput</span><span style=color:#61676ccc>,</span><span> Touches}</span><span style=color:#61676ccc>,
</span><span>        Axis</span><span style=color:#61676ccc>,</span><span> ButtonInput</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>prelude </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#61676ccc>::</span><span>{Axis</span><span style=color:#61676ccc>,</span><span> ButtonInput}</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"gamepad"</span><span>)]
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#ed9366>::</span><span>gamepad</span><span style=color:#ed9366>::</span><span>{Gamepad</span><span style=color:#61676ccc>,</span><span> GamepadAxis</span><span style=color:#61676ccc>,</span><span> GamepadButton</span><span style=color:#61676ccc>,</span><span> GamepadSettings}</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"keyboard"</span><span>)]
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#ed9366>::</span><span>keyboard</span><span style=color:#ed9366>::</span><span>KeyCode</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"mouse"</span><span>)]
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#ed9366>::</span><span>mouse</span><span style=color:#ed9366>::</span><span>MouseButton</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"touch"</span><span>)]
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#ed9366>::</span><span>touch</span><span style=color:#ed9366>::</span><span>{TouchInput</span><span style=color:#61676ccc>,</span><span> Touches}</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=3><li>The <code>InputPlugin::build</code> method is now split into conditional blocks:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (simplified):
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// keyboard setup
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// mouse setup  
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// gamepad setup
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// touch setup
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"keyboard"</span><span>)]
</span><span>    app</span><span style=color:#ed9366>.</span><span>add_message</span><span style=color:#ed9366>::</span><span>&LTKeyboardInput>()
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... keyboard systems
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"mouse"</span><span>)]
</span><span>    app</span><span style=color:#ed9366>.</span><span>add_message</span><span style=color:#ed9366>::</span><span>&LTMouseButtonInput>()
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... mouse systems
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"gamepad"</span><span>)]
</span><span>    app</span><span style=color:#ed9366>.</span><span>add_message</span><span style=color:#ed9366>::</span><span>&LTGamepadEvent>()
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... gamepad systems
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"touch"</span><span>)]
</span><span>    app</span><span style=color:#ed9366>.</span><span>add_message</span><span style=color:#ed9366>::</span><span>&LTTouchInput>()
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... touch systems
</span><span>}
</span></code></pre><h3 id=cargo-toml-15-0><code>Cargo.toml</code> (+15/-0)</h3><p>The root Cargo.toml now exposes the input source features to users, with clear documentation about which crates automatically enable them.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Mouse support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>mouse </span><span>= [</span><span style=color:#86b300>"bevy_internal/mouse"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Keyboard support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>keyboard </span><span>= [</span><span style=color:#86b300>"bevy_internal/keyboard"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Gamepad support. Automatically enabled by `bevy_gilrs`.
</span><span style=color:#399ee6>gamepad </span><span>= [</span><span style=color:#86b300>"bevy_internal/gamepad"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Touch support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>touch </span><span>= [</span><span style=color:#86b300>"bevy_internal/touch"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Gestures support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>gestures </span><span>= [</span><span style=color:#86b300>"bevy_internal/gestures"</span><span>]
</span></code></pre><h3 id=crates-bevy-input-cargo-toml-7-0><code>crates/bevy_input/Cargo.toml</code> (+7/-0)</h3><p>Defines the actual features in the <code>bevy_input</code> crate itself:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic>## Input sources
</span><span style=color:#399ee6>mouse </span><span>= []
</span><span style=color:#399ee6>keyboard </span><span>= []
</span><span style=color:#399ee6>gamepad </span><span>= []
</span><span style=color:#399ee6>touch </span><span>= []
</span><span style=color:#399ee6>gestures </span><span>= []
</span></code></pre><h3 id=crates-bevy-internal-cargo-toml-7-0><code>crates/bevy_internal/Cargo.toml</code> (+7/-0)</h3><p>Passes the features through from the root to <code>bevy_input</code>:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Input sources.
</span><span style=color:#399ee6>mouse </span><span>= [</span><span style=color:#86b300>"bevy_input/mouse"</span><span>]
</span><span style=color:#399ee6>keyboard </span><span>= [</span><span style=color:#86b300>"bevy_input/keyboard"</span><span>]
</span><span style=color:#399ee6>gamepad </span><span>= [</span><span style=color:#86b300>"bevy_input/gamepad"</span><span>]
</span><span style=color:#399ee6>touch </span><span>= [</span><span style=color:#86b300>"bevy_input/touch"</span><span>]
</span><span style=color:#399ee6>gestures </span><span>= [</span><span style=color:#86b300>"bevy_input/gestures"</span><span>]
</span></code></pre><h3 id=crates-bevy-window-cargo-toml-and-crates-bevy-gilrs-cargo-toml><code>crates/bevy_window/Cargo.toml</code> and <code>crates/bevy_gilrs/Cargo.toml</code></h3><p>These crates now explicitly enable the features they need:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># In bevy_window/Cargo.toml:
</span><span style=color:#399ee6>bevy_input </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_input"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"gestures"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"keyboard"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"mouse"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"touch"</span><span style=color:#61676ccc>,
</span><span>] }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># In bevy_gilrs/Cargo.toml:
</span><span style=color:#399ee6>bevy_input </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_input"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"gamepad"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><h3 id=release-content-migration-guides-bevy-input-features-md-27-0><code>release-content/migration-guides/bevy_input_features.md</code> (+27/-0)</h3><p>Added a comprehensive migration guide explaining when users need to manually enable features:<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>If you use </span><span style=color:#ed9366;background-color:#61676c10>`bevy_window`</span><span> or </span><span style=color:#ed9366;background-color:#61676c10>`bevy_gilrs`</span><span>, they will automatically
</span><span>enable the necessary features on </span><span style=color:#ed9366;background-color:#61676c10>`bevy_input`</span><span>. If you don't depend
</span><span>on them (for example, if you are developing for a platform that
</span><span>isn't supported by these crates), you need to enable the required
</span><span>input sources on </span><span style=color:#ed9366;background-color:#61676c10>`bevy_input`</span><span> manually:
</span><span>
</span><span>```</span><span style=color:#ff8f40>toml
</span><span style=color:#61676c;background-color:#61676c07># Before:
</span><span style=color:#61676c;background-color:#61676c07>bevy = { version = "0.17", default-features = false }
</span><span style=color:#61676c;background-color:#61676c07># After (enable sources that you actually use):
</span><span style=color:#61676c;background-color:#61676c07>bevy = { version = "0.18", default-features = false, features = [
</span><span style=color:#61676c;background-color:#61676c07>  "mouse",
</span><span style=color:#61676c;background-color:#61676c07>  "keyboard",
</span><span style=color:#61676c;background-color:#61676c07>  "gamepad",
</span><span style=color:#61676c;background-color:#61676c07>  "touch",
</span><span style=color:#61676c;background-color:#61676c07>  "gestures",
</span><span style=color:#61676c;background-color:#61676c07>] }
</span></code></pre><h3 id=docs-cargo-features-md><code>docs/cargo_features.md</code></h3><p>Updated the feature documentation to include the new input source features with clear explanations of their automatic enablement.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust Cargo Features Documentation</strong>: The official guide on conditional compilation and features in Rust: https://doc.rust-lang.org/cargo/reference/features.html<li><strong>Bevy’s Input System</strong>: Official Bevy documentation on handling input: https://bevyengine.org/learn/quick-start/input/<li><strong>Conditional Compilation in Rust</strong>: Rust by Example chapter on <code>cfg</code> attribute: https://doc.rust-lang.org/rust-by-example/attribute/cfg.html<li><strong>Embedded Development with Bevy</strong>: Community resources for using Bevy on embedded platforms and consoles<li><strong>Binary Size Optimization in Rust</strong>: Techniques for reducing Rust binary size, particularly important for embedded targets</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21447.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>