<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22292 Fix many_foxes animation controls
        
    </title><meta content="#22292 Fix many_foxes animation controls" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22292-zh-cn-20251230>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Fix many_foxes animation controls<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix many_foxes animation controls<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22292<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-28T20:43:47Z<li><strong>Merged</strong>: 2025-12-30T01:41:28Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fix #22285</ul><h2 id=solution>Solution</h2><ul><li>Example is relying on component <code>AnimationTransitions</code> which wasn’t added. Add it</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a straightforward bug in the <code>many_foxes</code> stress test example where animation controls were broken. The example is designed to demonstrate performance by rendering thousands of animated fox models, but it had a missing component dependency that prevented the animation system from functioning correctly.<p>The problem originated in the animation system refactoring where the <code>AnimationTransitions</code> component became a required dependency for entities using animation graphs. This component tracks state for animation transitions and is necessary for the animation playback system to function. Without it, entities with <code>AnimationGraphHandle</code> components couldn’t properly play animations.<p>The fix is minimal but important for maintaining example correctness. The developer identified that the example was trying to use animation features that required the <code>AnimationTransitions</code> component but wasn’t actually adding it to the entities. This is a classic missing dependency issue where the system expects certain components to be present but the setup code doesn’t provide them.<p>Looking at the implementation, the fix involves two changes. First, there’s a minor optimization in the clip setup code where <code>animation_clips.iter().cloned()</code> is simplified to just <code>animation_clips</code>. Since <code>animation_clips</code> is an array that can be turned into an iterator directly, the extra cloning and iterator wrapping was unnecessary. This is a small cleanup but doesn’t affect functionality.<p>The main fix is in the entity setup where the <code>AnimationTransitions::default()</code> component is now added alongside the <code>AnimationGraphHandle</code>. This ensures each fox entity has the necessary component for the animation system to manage its animation state:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(child)</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(AnimationGraphHandle(animations</span><span style=color:#ed9366>.</span><span>graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(child)</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>((
</span><span>    AnimationGraphHandle(animations</span><span style=color:#ed9366>.</span><span>graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>,
</span><span>    AnimationTransitions</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><p>This change follows the Bevy ECS pattern where systems query for component combinations, and entities must have all required components for those systems to process them. The animation system likely queries for entities with both <code>AnimationGraphHandle</code> and <code>AnimationTransitions</code> components, so missing the latter meant the entities were silently ignored.<p>From an engineering perspective, this fix demonstrates the importance of keeping examples up-to-date with API changes. Examples serve as both documentation and test cases, so when they break, it indicates either an API design issue or missing documentation about required component combinations. In this case, the example was missing a required component that should have been obvious from the animation system’s component requirements.<p>The fix also shows good practices in Bevy development: using tuple inserts for adding multiple components efficiently and relying on default values for components where appropriate. The <code>AnimationTransitions::default()</code> provides a reasonable starting state with no active transitions, which is appropriate for the initial animation setup.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Setup Function] --> B[Create Animation Graph]
</span><span>    B --> C[Setup Scene Function]
</span><span>    C --> D[For Each Fox Entity]
</span><span>    D --> E[Add AnimationGraphHandle]
</span><span>    D --> F[Add AnimationTransitions]
</span><span>    E --> G[Animation System Processes Entity]
</span><span>    F --> G
</span><span>    G --> H[Fox Animates Correctly]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File:</strong> <code>examples/stress_tests/many_foxes.rs</code><p>This file contains the <code>many_foxes</code> stress test example that demonstrates rendering performance with thousands of animated fox models.<p><strong>Changes made:</strong><ol><li><p><strong>Minor optimization in animation clip setup:</strong></p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_clips</span><span>(animation_clips</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>cloned</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>,</span><span> animation_graph</span><span style=color:#ed9366>.</span><span>root)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_clips</span><span>(animation_clips</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>,</span><span> animation_graph</span><span style=color:#ed9366>.</span><span>root)
</span></code></pre> <p>This change simplifies the code by passing the array directly instead of creating an iterator of clones. Since arrays implement <code>IntoIterator</code>, this is equivalent but cleaner.</p><li><p><strong>Fixed missing <code>AnimationTransitions</code> component:</strong></p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>commands
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(child)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(AnimationGraphHandle(animations</span><span style=color:#ed9366>.</span><span>graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(child)</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>((
</span><span>    AnimationGraphHandle(animations</span><span style=color:#ed9366>.</span><span>graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>,
</span><span>    AnimationTransitions</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre> <p>This is the core fix. The example was missing the <code>AnimationTransitions</code> component that the animation system requires to manage animation state and transitions between animations. Without this component, the animation system would ignore these entities.</p></ol><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_animation/latest/bevy_animation/ target=_blank>Bevy Animation System Documentation</a> - Official documentation for Bevy’s animation system<li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/ecs-intro.html target=_blank>Bevy ECS Component Patterns</a> - Guide to Entity Component System patterns in Bevy<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/22285 target=_blank>Issue #22285</a> - Original issue reporting the broken animation controls<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/examples target=_blank>Bevy Examples Repository</a> - Other Bevy examples demonstrating various features</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22292.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>