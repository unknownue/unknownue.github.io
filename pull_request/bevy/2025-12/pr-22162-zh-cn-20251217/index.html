<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22162 Revise release_notes/get_components_mut.md
        
    </title><meta content="#22162 Revise release_notes/get_components_mut.md" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-17</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-12/pr-22162-en-20251217>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=ji-ben-xin-xi>基本信息</h2><ul><li><strong>标题</strong>: Revise release_notes/get_components_mut.md<li><strong>PR 链接</strong>: https://github.com/bevyengine/bevy/pull/22162<li><strong>作者</strong>: Architector4<li><strong>状态</strong>: 已合并<li><strong>标签</strong>: C-Docs, A-ECS, S-Ready-For-Final-Review<li><strong>创建时间</strong>: 2025-12-17T12:22:01Z<li><strong>合并时间</strong>: 2025-12-17T19:01:50Z<li><strong>合并者</strong>: alice-i-cecile</ul><h2 id=miao-shu-fan-yi>描述翻译</h2><h3 id=mu-biao>目标</h3><p>这份发布说明提供了有用的信息，但它写成了一个单一的长段落，语法不佳，有时含义不清晰。<h3 id=jie-jue-fang-an>解决方案</h3><p>修订这份发布说明的文本：将其拆分为三个段落，每个段落独立传达其要点。<p>（特此声明，我不使用LLM，别因为连字符的事儿@我，笑）<h2 id=ben-ci-pr-de-gu-shi>本次 PR 的故事</h2><p>这个 PR 是关于改进文档的，核心问题是提升一份技术发布说明的可读性和清晰度。故事始于一个对开发者体验有直接影响但未被优先处理的问题：一份描述重要新功能的技术说明因其结构而难以阅读。<p><strong>问题的核心</strong> 在于 PR #21780 为 Bevy 的 ECS (Entity Component System) 系统引入了新的安全 API：<code>EntityMut::get_components_mut</code> 和 <code>EntityWorldMut::get_components_mut</code>。相关的发布说明文档虽然包含了关键技术细节——例如解释为什么之前只有不安全的版本 (<code>get_components_mut_unchecked</code>)，以及新安全版本通过 O(n²) 冲突检查实现的机制和性能权衡——但这些信息被塞进了一个冗长、语法不规范的单一段落中。这种格式对于开发者快速扫描和理解要点构成了障碍。可读性差的文档会降低信息的传递效率，可能导致开发者误解 API 的用途、风险或适用场景，尤其是在涉及“安全”(safe) 与“不安全”(unsafe) 这种关键抉择时。<p><strong>解决方案</strong> 采取了直接且有效的工程方法：重构文档结构，而非重写内容。开发者没有改变文档的技术实质，而是聚焦于信息架构。主要策略是将原先的“信息块”按逻辑拆解。原段落混合了三个主要信息点：1) 新安全 API 的引入，2) 旧不安全 API 的存在原因，3) 新 API 的实现机制与性能权衡。改进后的版本为每个信息点创建了独立的段落。这种分离使得每个论点都能被清晰地陈述，读者可以逐点消化，而不会被淹没在连续的文本流中。<p><strong>具体的文本改进</strong> 体现了对技术写作细节的关注。例如：<ul><li>开篇语句从描述性 (“A safe version … was added”) 改为更直接、更像公告的陈述 (“Methods … are now added”)。<li>对不安全原因的解释更加精确，明确指出了 <code>(&mut T, &mut T)</code> 会违反 Rust 的别名规则 (aliasing rules)，而不仅仅是模糊地说“可能返回多个可变引用”。<li>性能权衡的表述也从“因为检查的成本”这种模糊说法，明确为“二次时间复杂度检查”和“运行时性能成本”，并更清晰地指出了使用不安全版本的前提是“你能保证不会发生别名引用”。</ul><p><strong>最终的影响</strong> 是一份显著提升的发布说明。它保留了所有必要的技术细节，但通过更好的组织结构使其更易于访问。对于 Bevy 这样的开源项目，清晰的文档对于社区采用新特性、理解安全边界以及做出明智的性能权衡决策至关重要。这次修改虽然不涉及任何运行时代码，但对项目的整体健康度和用户体验有直接的正面贡献。它展示了即使在纯文档工作中，应用软件工程中的“关注点分离”和“清晰接口”原则同样有价值。<h2 id=ke-shi-hua-biao-shi>可视化表示</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[原始文档: 单一段落] --> B{问题: 可读性差};
</span><span>    B --> C[解决方案: 结构重构];
</span><span>    C --> D[段落1: 宣布新安全API];
</span><span>    C --> E[段落2: 解释旧API的不安全性];
</span><span>    C --> F[段落3: 说明实现机制与性能权衡];
</span><span>    D --> G[结果: 清晰的三段式文档];
</span><span>    E --> G;
</span><span>    F --> G;
</span></code></pre><h2 id=guan-jian-wen-jian-bian-geng>关键文件变更</h2><ul><li><code>release-content/release-notes/get_components_mut.md</code> (+13/-7)</ul><p><strong>变更描述</strong>：此文件是本次 PR 修改的唯一文件。变更内容是对该发布说明文档的纯文本重构，目的是提升可读性和清晰度，技术内容保持不变。<p><strong>代码片段 (Diff)</strong>:<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#4cbf99>- </span><span>A safe version of </span><span style=color:#ed9366;background-color:#61676c10>`EntityMut::get_components_mut`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`EntityWorldMut::get_components_mut`</span><span>
</span><span style=color:#4cbf99>-</span><span> was added. Previously a unsafe version was added </span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span>. It needed
</span><span style=color:#4cbf99>-</span><span> to be unsafe because specifying (&mut T, &mut T) is possible which would return multiple
</span><span style=color:#4cbf99>-</span><span> mutable references to the same component. This was done by adding a O(n^2) check for
</span><span style=color:#4cbf99>-</span><span> conflicts which returns a </span><span style=color:#ed9366;background-color:#61676c10>`QueryAccessError::Conflict`</span><span>. Because of the cost of the checks
</span><span style=color:#4cbf99>-</span><span> if your code is performance sensitive it may make sense to keep using
</span><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span>.
</span><span style=color:#4cbf99>+</span><span> Methods </span><span style=color:#ed9366;background-color:#61676c10>`EntityMut::get_components_mut`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`EntityWorldMut::get_components_mut`</span><span> are now
</span><span style=color:#4cbf99>+</span><span> added, providing a safe API for retrieving mutable references to multiple components via
</span><span style=color:#4cbf99>+</span><span> these entity access APIs.
</span><span style=color:#4cbf99>+
</span><span style=color:#4cbf99>+</span><span> Previously, only the unsafe variants of these methods, called
</span><span style=color:#4cbf99>+ </span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span>, were present. They are not safe because they allow
</span><span style=color:#4cbf99>+</span><span> retrieving </span><span style=color:#ed9366;background-color:#61676c10>`(&mut T, &mut T)`</span><span> - two mutable references to a single component - which
</span><span style=color:#4cbf99>+</span><span> breaks Rust's pointer aliasing rules.
</span><span style=color:#4cbf99>+
</span><span style=color:#4cbf99>+</span><span> The new methods work around this via performing a quadratic time complexity check between
</span><span style=color:#4cbf99>+</span><span> all specified components for conflicts, returning </span><span style=color:#ed9366;background-color:#61676c10>`QueryAccessError::Conflict`</span><span> if such
</span><span style=color:#4cbf99>+</span><span> occurs. This potentially has a runtime performance cost, so it might be favorable to still
</span><span style=color:#4cbf99>+</span><span> use </span><span style=color:#ed9366;background-color:#61676c10>`get_components_mut_unchecked`</span><span> if you can guarantee that no aliasing would occur.
</span></code></pre><p><strong>与 PR 目标的关联</strong>：这些变更直接实现了 PR 描述中的目标，将原先单一、语法不佳的长段落，拆分并重构成了三个逻辑清晰的段落，分别阐述了新 API 的引入、旧 API 不安全的根本原因，以及新 API 的实现与性能权衡。<h2 id=yan-shen-yue-du>延伸阅读</h2><ol><li><strong>相关 PR</strong>: 实现 <code>get_components_mut</code> 功能的原始 PR #21780，其中包含了具体的 API 设计和实现代码。<li><strong>Bevy 官方文档 - ECS</strong>: 了解 Bevy 实体组件系统的基本概念和工作原理。<li><strong>Rust 参考 - 别名与借用检查</strong>: 深入理解 Rust 的所有权系统和为何 <code>&mut T</code> 不能别名化，这是理解为什么需要 <code>get_components_mut_unchecked</code> 以及新的安全检查机制的根本原因。<li><strong>技术写作指南</strong> (如 <em>Google Developer Documentation Style Guide</em>): 了解如何编写清晰、有效、对开发者友好的技术文档。</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22162.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>