<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22294 use zizmor to lint GitHub actions
        
    </title><meta content="#22294 use zizmor to lint GitHub actions" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>‚Üê Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22294-zh-cn-20251230>‰∏≠Êñá</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: use zizmor to lint GitHub actions<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22294<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Build-System, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-28T23:03:18Z<li><strong>Merged</strong>: 2025-12-30T01:48:30Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><h1 id=objective>Objective</h1><ul><li>Improve security of Bevy CI</ul><h2 id=solution>Solution</h2><ul><li>Use zizmor to lint actions https://github.com/zizmorcore/zizmor<li>Fix a few lints <ul><li>pin actions<li>specify <code>persist-credentials</code><li>set write permissions at job level instead of workflow level<li>set target branch for <code>pull_request_target</code> workflows</ul><li>Add the linter as CI. With the proposed config, it should report potential issues in the security center and not block merging. There are still a few lints that fail and need more rework to fix</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses GitHub Actions security improvements in the Bevy repository. The core issue was that the existing CI workflows had several security anti-patterns that could potentially expose the repository to supply chain attacks or credential leakage. The developer identified that while Bevy already had various quality checks in place, the GitHub Actions configuration itself needed security hardening.<p>The solution involved implementing a multi-pronged approach. First, the developer integrated zizmor, a specialized linter for GitHub Actions workflows, as a continuous security check. Zizmor scans workflows for security issues like unpinned actions, excessive permissions, and other misconfigurations. Rather than immediately blocking all workflows, the linter was configured to report issues to GitHub‚Äôs security center without preventing merges, allowing for gradual improvement while maintaining development velocity.<p>The implementation required changes across 14 different workflow files. The most significant changes fell into four main categories:<ol><li><strong>Action version pinning</strong>: All GitHub Actions references were updated from version tags (like <code>v6</code>) to specific commit SHAs with version comments. This prevents supply chain attacks where a malicious actor could push new code to a tagged version.</ol><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@v6
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 </span><span style=color:#abb0b6;font-style:italic># v6.0.1
</span></code></pre><ol start=2><li><p><strong>Credential persistence control</strong>: The <code>persist-credentials: false</code> parameter was added to all checkout actions to prevent the GITHUB_TOKEN from being stored in git configuration, reducing the attack surface.</p><li><p><strong>Granular permission scoping</strong>: Write permissions were moved from the workflow level to individual job levels. This follows the principle of least privilege - only jobs that actually need write access (like commenting on PRs) receive it, rather than granting blanket permissions to all jobs in the workflow.</p></ol><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before (at workflow level):
</span><span style=color:#399ee6>permissions</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>pull-requests</span><span style=color:#61676ccc>: </span><span style=color:#86b300>'write'
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After (at job level):
</span><span style=color:#399ee6>jobs</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>comment-on-migration-guide-label</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>permissions</span><span style=color:#61676ccc>:
</span><span>      </span><span style=color:#399ee6>pull-requests</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"write"
</span></code></pre><ol start=4><li><strong>Branch targeting for pull_request_target</strong>: Workflows using the <code>pull_request_target</code> event were updated to explicitly target the <code>main</code> branch. This is important because <code>pull_request_target</code> runs in the context of the base repository with write permissions, so restricting it to specific branches prevents potentially malicious code from forked repositories from running with elevated privileges.</ol><p>The technical implementation shows careful consideration of the trade-offs between security and usability. The developer chose to fix the most critical security issues immediately while leaving some zizmor warnings for future work, acknowledging that complete security hardening requires incremental improvement rather than blocking all development.<p>An interesting technical detail is the renaming of <code>codeql.yml</code> to <code>security-static-analysis.yml</code>. This reflects a broader categorization where CodeQL becomes one component of a comprehensive security analysis suite that now includes zizmor. The new workflow structure provides a clear separation between different types of security checks.<p>From an engineering perspective, this PR demonstrates several best practices for securing CI/CD pipelines. The use of a specialized linter for infrastructure-as-code (in this case, GitHub Actions workflows) parallels the use of linters for application code. The gradual rollout approach - fixing critical issues first while establishing ongoing monitoring for others - shows practical risk management.<p>The changes affect various aspects of Bevy‚Äôs development workflow:<ul><li>CI builds now use pinned, immutable action versions<li>Comment automation jobs have more restricted permissions<li>Security scanning is now integrated into the regular CI process<li>Example runs and documentation builds inherit the same security improvements</ul><p>This PR doesn‚Äôt just fix immediate security issues but establishes a framework for ongoing security maintenance. By integrating zizmor into the CI pipeline, future changes to GitHub Actions workflows will be automatically checked for security issues before they can be merged. This creates a sustainable security model where the tooling helps maintain security standards rather than relying solely on manual review.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[GitHub Actions Security Issues] --> B[Integrate zizmor linter]
</span><span>    B --> C[Fix critical linter warnings]
</span><span>    C --> D1[Pin all actions to SHAs]
</span><span>    C --> D2[Add persist-credentials: false]
</span><span>    C --> D3[Scope permissions to jobs]
</span><span>    C --> D4[Specify target branches]
</span><span>    D1 --> E[Prevent supply chain attacks]
</span><span>    D2 --> F[Prevent credential leakage]
</span><span>    D3 --> G[Principle of least privilege]
</span><span>    D4 --> H[Limit privileged execution]
</span><span>    E --> I[Secure CI pipeline]
</span><span>    F --> I
</span><span>    G --> I
</span><span>    H --> I
</span><span>    I --> J[Ongoing security monitoring]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=github-workflows-ci-yml-101-49><code>.github/workflows/ci.yml</code> (+101/-49)</h3><p>This is the main CI workflow file. The changes here standardize security practices across the primary build and test pipeline.<p>Key changes:<ul><li>Updated all action references from version tags to pinned SHA hashes with version comments<li>Added <code>persist-credentials: false</code> to every checkout step<li>Standardized the format for dtolnay/rust-toolchain usage with explicit toolchain parameters</ul><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@v6
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@stable
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 </span><span style=color:#abb0b6;font-style:italic># v6.0.1
</span><span>  </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>persist-credentials</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@f7ccc83f9ed1e5b9c81d8a67d7ad1a747e22a561
</span><span>  </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>toolchain</span><span style=color:#61676ccc>: </span><span style=color:#86b300>stable
</span></code></pre><h3 id=github-workflows-ci-comment-failures-yml-17-16><code>.github/workflows/ci-comment-failures.yml</code> (+17/-16)</h3><p>This workflow posts comments on PRs when specific CI failures occur. The security changes here are particularly important since this workflow interacts with PRs.<p>Key changes:<ul><li>Moved <code>pull-requests: write</code> permissions from workflow level to each job level<li>Updated action versions to pinned SHAs<li>Added <code>persist-credentials: false</code> to checkout steps</ul><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before (permissions at workflow level):
</span><span style=color:#399ee6>permissions</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>pull-requests</span><span style=color:#61676ccc>: </span><span style=color:#86b300>'write'
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After (permissions at job level):
</span><span style=color:#399ee6>jobs</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>missing-examples</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>permissions</span><span style=color:#61676ccc>:
</span><span>      </span><span style=color:#399ee6>pull-requests</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"write"
</span></code></pre><h3 id=github-workflows-example-run-yml-30-18><code>.github/workflows/example-run.yml</code> (+30/-18)</h3><p>This workflow runs Bevy examples and generates screenshots. It uses multiple platforms and handles artifact uploads.<p>Key changes:<ul><li>Pinned all action versions (checkout, rust-toolchain, cache, upload-artifact)<li>Added <code>persist-credentials: false</code> to checkout steps<li>Maintained existing functionality while improving security posture</ul><h3 id=github-workflows-dependencies-yml-24-8><code>.github/workflows/dependencies.yml</code> (+24/-8)</h3><p>This workflow checks for dependency issues using cargo-deny. The changes follow the same pattern as other workflows.<p>Key changes:<ul><li>Updated checkout and rust-toolchain actions to pinned versions<li>Added <code>persist-credentials: false</code> to all checkout steps</ul><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@v6
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@stable
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 </span><span style=color:#abb0b6;font-style:italic># v6.0.1
</span><span>  </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>persist-credentials</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false
</span><span>- </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@f7ccc83f9ed1e5b9c81d8a67d7ad1a747e22a561
</span><span>  </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>toolchain</span><span style=color:#61676ccc>: </span><span style=color:#86b300>stable
</span></code></pre><h3 id=github-workflows-security-static-analysis-yml-renamed-from-codeql-yml><code>.github/workflows/security-static-analysis.yml</code> (renamed from <code>codeql.yml</code>)</h3><p>This file was renamed and expanded to include zizmor alongside CodeQL analysis.<p>Key changes:<ul><li>Renamed from <code>codeql.yml</code> to reflect broader security scope<li>Added new <code>zizmor</code> job that runs the security linter<li>Pinned action versions for checkout and CodeQL actions</ul><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># New zizmor job added:
</span><span style=color:#399ee6>zizmor</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>runs-on</span><span style=color:#61676ccc>: </span><span style=color:#86b300>ubuntu-latest
</span><span>  </span><span style=color:#399ee6>permissions</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>security-events</span><span style=color:#61676ccc>: </span><span style=color:#86b300>write
</span><span>    </span><span style=color:#399ee6>contents</span><span style=color:#61676ccc>: </span><span style=color:#86b300>read
</span><span>    </span><span style=color:#399ee6>actions</span><span style=color:#61676ccc>: </span><span style=color:#86b300>read
</span><span>  </span><span style=color:#399ee6>steps</span><span style=color:#61676ccc>:
</span><span>    - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Checkout repository
</span><span>      </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 </span><span style=color:#abb0b6;font-style:italic># v6.0.0
</span><span>      </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>        </span><span style=color:#399ee6>persist-credentials</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false
</span><span>    - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Run zizmor üåà
</span><span>      </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>zizmorcore/zizmor-action@e639db99335bc9038abc0e066dfcd72e23d26fb4 </span><span style=color:#abb0b6;font-style:italic># v0.3.0
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions target=_blank>GitHub Actions Security Hardening Guide</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/zizmorcore/zizmor target=_blank>zizmor GitHub Action Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions#using-third-party-actions target=_blank>Supply Chain Security for GitHub Actions</a><li><a rel="noopener nofollow noreferrer" href=https://cloud.google.com/architecture/devops/devops-tech-least-privilege target=_blank>Principle of Least Privilege in CI/CD</a><li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/code-security/getting-started/github-security-features target=_blank>GitHub Security Best Practices</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22294.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>