<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22052 Adds UIDebug Overlay centered scene to examples/testbed/ui
        
    </title><meta content="#22052 Adds UIDebug Overlay centered scene to examples/testbed/ui" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-08</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22052-zh-cn-20251208>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Adds UIDebug Overlay centered scene to examples/testbed/ui<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22052<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-UI, S-Ready-For-Final-Review, C-Testing<li><strong>Created</strong>: 2025-12-07T03:14:50Z<li><strong>Merged</strong>: 2025-12-08T22:56:05Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #22019</ul><h2 id=solution>Solution</h2><ul><li>Adds a new scene in the ui testbed that tests the generation of the Ui Debug Overlay. It only is viewable if you run the example with <code>--features bevy_ui_debug</code>.<li>Added a way to override the color used by the overlay to ensure that screenshots are consistent between CI runs (the line colors are generated based on the <code>Entity</code>, which changes every time you change the scene.)<li>Added the <code>--features bevy_ui_debug</code> flag to <code>example-run.yml</code>, ensuring that screenshots and their validations take this new scene into account. (I assumed I’m not supposed to add this to <code>validation-jobs.yml</code> under <code>run-examples-on-wasm</code>, but if I’m supposed to, let me know and I can add it. I figured a debug feature does not need that specific validation).</ul><h2 id=testing>Testing</h2><ul><li>I ran the command <code>cargo run --example testbed_ui --features bevy_ui_debug</code> and verified that debug lines showed up for regular outlines, for a node with <code>Visibility::Hidden</code> with <code>show_hidden = true</code>, and that clipped areas have outlines with <code>show_clipped = true</code>. I carouseled through all the scenes a couple of times<li>I also ran <code>cargo run --example testbed_ui </code> and made sure nothing was ruined after multiple carousels through all the scenes.</ul><hr><h2 id=showcase>Showcase</h2><p><code>cargo run --example testbed_ui --features bevy_ui_debug</code> , press spacebar 11x to see the scene.</p><img alt="Screenshot 2025-12-06 at 10 03 25 PM" height=750 src=https://github.com/user-attachments/assets/f76ef3ac-b762-4eef-9843-573f362fe45a width=1282><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a missing test scenario for the UI debug overlay feature in Bevy’s testbed UI example. The core problem was straightforward: while Bevy had a UI debug overlay system for visualizing UI node boundaries, clipping regions, and hidden elements, there wasn’t a dedicated test scene in the main UI testbed example to verify this functionality worked correctly.<p>The implementation needed to solve two related challenges. First, creating a proper test scene that demonstrates the debug overlay’s capabilities. Second, ensuring that CI screenshot tests would be consistent across runs, since the debug overlay’s default color generation depended on entity indices that could change between runs.<p>The developer approached this by adding a new <code>DebugOutlines</code> scene to the existing UI testbed example, but with a key constraint: this scene should only be compiled and available when the <code>bevy_ui_debug</code> feature flag is enabled. This keeps the default example clean for users who don’t need debug functionality.<p>The architectural challenge was in the debug overlay’s color generation. By default, the system uses <code>Hsla::sequential_dispersed(entity.index_u32())</code> to generate colors, which creates visually distinct colors based on entity indices. While useful for debugging, this creates non-deterministic colors for CI screenshot comparison because entity indices can change when the scene structure changes. The solution was to add an optional color override field to <code>UiDebugOptions</code> that, when set, bypasses the entity-based color generation.<p>Looking at the implementation, the changes follow Bevy’s established patterns. In <code>debug_overlay.rs</code>, the <code>UiDebugOptions</code> struct gains a new <code>line_color_override</code> field of type <code>Option&LTLinearRgba></code>. The extraction system then checks for this override:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>color</span><span style=color:#61676ccc>:</span><span> debug_options
</span><span>    </span><span style=color:#ed9366>.</span><span>line_color_override
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or_else</span><span>(|| Hsla</span><span style=color:#ed9366>::</span><span>sequential_dispersed(entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>index_u32</span><span>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())</span><span style=color:#61676ccc>,
</span></code></pre><p>This maintains backward compatibility while providing deterministic color control for testing.<p>The test scene implementation demonstrates three key debug overlay features:<ol><li>Regular UI node outlines<li>Outlines for hidden nodes (when <code>show_hidden</code> is enabled)<li>Outlines for clipped areas (when <code>show_clipped</code> is enabled)</ol><p>The scene setup configures the debug options appropriately:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>debug_options</span><span style=color:#ed9366>.</span><span>enabled </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>;
</span><span>debug_options</span><span style=color:#ed9366>.</span><span>line_width </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>5.</span><span style=color:#61676ccc>;
</span><span>debug_options</span><span style=color:#ed9366>.</span><span>line_color_override </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(LinearRgba</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>GREEN</span><span>)</span><span style=color:#61676ccc>;
</span><span>debug_options</span><span style=color:#ed9366>.</span><span>show_hidden </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>;
</span><span>debug_options</span><span style=color:#ed9366>.</span><span>show_clipped </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>;
</span></code></pre><p>Notably, the teardown system resets the debug options to defaults when leaving the scene, preventing debug settings from leaking into other scenes.<p>For CI integration, the PR adds the <code>bevy_ui_debug</code> feature to three different CI job configurations in <code>.github/workflows/example-run.yml</code>, ensuring the new scene is exercised during automated testing. This is important because without this flag, the scene wouldn’t be compiled or executed in CI.<p>From a testing perspective, this PR demonstrates good practice: it adds a dedicated test for existing functionality, ensures deterministic behavior for automated testing, and properly isolates debug features behind feature flags. The implementation avoids breaking changes while extending functionality in a clean, maintainable way.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[UI Testbed Example] --> B[Scene Management]
</span><span>    B --> C[DebugOutlines Scene]
</span><span>    C --> D{bevy_ui_debug feature}
</span><span>    D -->|Enabled| E[Debug Overlay Test]
</span><span>    D -->|Disabled| F[Scene Skipped]
</span><span>    G[UiDebugOptions] --> H[line_color_override]
</span><span>    H --> I[Deterministic CI Colors]
</span><span>    E --> J[Tests Three Features]
</span><span>    J --> K[Regular Outlines]
</span><span>    J --> L[Hidden Nodes]
</span><span>    J --> M[Clipped Areas]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-testbed-ui-rs-97-0><code>examples/testbed/ui.rs</code> (+97/-0)</h3><p><strong>What changed</strong>: Added a new <code>DebugOutlines</code> scene with setup and teardown systems, conditionally compiled behind the <code>bevy_ui_debug</code> feature flag.<p><strong>Key modifications</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_ui_debug"</span><span>)]
</span><span>{
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(OnEnter(Scene</span><span style=color:#ed9366>::</span><span>DebugOutlines)</span><span style=color:#61676ccc>, </span><span>debug_outlines</span><span style=color:#ed9366>::</span><span>setup)</span><span style=color:#61676ccc>;
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(OnExit(Scene</span><span style=color:#ed9366>::</span><span>DebugOutlines)</span><span style=color:#61676ccc>, </span><span>debug_outlines</span><span style=color:#ed9366>::</span><span>teardown)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In the Scene enum:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_ui_debug"</span><span>)]
</span><span>DebugOutlines</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Scene transition logic includes the new scene when the feature is enabled
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_ui_debug"</span><span>)]
</span><span>Scene</span><span style=color:#ed9366>::</span><span>RadialGradient </span><span style=color:#ed9366>=> </span><span>Scene</span><span style=color:#ed9366>::</span><span>DebugOutlines</span><span style=color:#61676ccc>,
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_ui_debug"</span><span>)]
</span><span>Scene</span><span style=color:#ed9366>::</span><span>DebugOutlines </span><span style=color:#ed9366>=> </span><span>Scene</span><span style=color:#ed9366>::</span><span>Transformations</span><span style=color:#61676ccc>,
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_ui_debug"</span><span>))]
</span><span>Scene</span><span style=color:#ed9366>::</span><span>RadialGradient </span><span style=color:#ed9366>=> </span><span>Scene</span><span style=color:#ed9366>::</span><span>Transformations</span><span style=color:#61676ccc>,
</span></code></pre><p><strong>Why it matters</strong>: This adds comprehensive testing for the debug overlay system while keeping it optional. The conditional compilation ensures the debug scene doesn’t affect users who don’t need it.<h3 id=crates-bevy-ui-render-src-debug-overlay-rs-7-1><code>crates/bevy_ui_render/src/debug_overlay.rs</code> (+7/-1)</h3><p><strong>What changed</strong>: Added <code>line_color_override</code> field to <code>UiDebugOptions</code> and modified the color extraction logic to use it when present.<p><strong>Key modifications</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UiDebugOptions </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>enabled</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>line_width</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Override Color for the overlay's lines
</span><span>    </span><span style=color:#fa6e32>pub </span><span>line_color_override</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTLinearRgba>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>show_hidden</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>show_clipped</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In extract_debug_overlay function:
</span><span>color</span><span style=color:#61676ccc>:</span><span> debug_options
</span><span>    </span><span style=color:#ed9366>.</span><span>line_color_override
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or_else</span><span>(|| Hsla</span><span style=color:#ed9366>::</span><span>sequential_dispersed(entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>index_u32</span><span>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())</span><span style=color:#61676ccc>,
</span></code></pre><p><strong>Why it matters</strong>: This enables deterministic color output for CI screenshot testing while maintaining the useful entity-based color coding for manual debugging.<h3 id=github-workflows-example-run-yml-3-3><code>.github/workflows/example-run.yml</code> (+3/-3)</h3><p><strong>What changed</strong>: Added <code>bevy_ui_debug</code> feature to the example run commands in CI workflows.<p><strong>Key modifications</strong>:<pre class=language-bash data-lang=bash style=color:#61676c;background-color:#fafafa><code class=language-bash data-lang=bash><span style=color:#abb0b6;font-style:italic># Changed from:
</span><span style=color:#f29718>time</span><span> TRACE_CHROME=trace-$example_name.json CI_TESTING_CONFIG=$example cargo run</span><span style=color:#ff8f40> --example </span><span>$example_name</span><span style=color:#ff8f40> --features </span><span style=color:#86b300>"bevy_ci_testing,trace,trace_chrome"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># To:
</span><span style=color:#f29718>time</span><span> TRACE_CHROME=trace-$example_name.json CI_TESTING_CONFIG=$example cargo run</span><span style=color:#ff8f40> --example </span><span>$example_name</span><span style=color:#ff8f40> --features </span><span style=color:#86b300>"bevy_ci_testing,trace,trace_chrome,bevy_ui_debug"
</span></code></pre><p><strong>Why it matters</strong>: Ensures the new debug scene is compiled and tested in CI, maintaining test coverage for the debug overlay functionality.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ui/latest/bevy_ui/ target=_blank>Bevy UI System Documentation</a> - Comprehensive guide to Bevy’s UI system<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Feature Flags in Cargo</a> - How to use conditional compilation in Rust projects<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Entity_component_system target=_blank>Entity Component System Pattern</a> - Background on ECS architecture used by Bevy<li><a rel="noopener nofollow noreferrer" href=https://gafferongames.com/post/deterministic_lockstep/ target=_blank>Deterministic Testing in Game Engines</a> - Importance of deterministic behavior for testing</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22052.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>