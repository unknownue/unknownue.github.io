<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20734 Implementing Reflect for `indexmap::IndexMap` and `indexmap::IndexSet`
        
    </title><meta content="#20734 Implementing Reflect for `indexmap::IndexMap` and `indexmap::IndexSet`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-20734-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=title-implementing-reflect-for-indexmap-indexmap-and-indexmap-indexset>Title: Implementing Reflect for <code>indexmap::IndexMap</code> and <code>indexmap::IndexSet</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Implement Reflect for <code>indexmap::IndexMap</code>and <code>indexmap::IndexSet</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20734<li><strong>Author</strong>: 2ne1ugly<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Usability, S-Ready-For-Final-Review, A-Reflection, D-Modest<li><strong>Created</strong>: 2025-08-24T06:48:35Z<li><strong>Merged</strong>: 2025-12-16T05:25:24Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #19681</ul><h2 id=solution>Solution</h2><ul><li>Implement Map, PartialReflect, Reflect, Typed, FromReflect, GetTypeRegistration for <code>indexmap::IndexMap</code> and <code>indexmap::IndexSet</code><li>Add <code>#[derive(Reflect)]</code> to <code>EntityIndexSet</code><li>Add indexmap feature to <code>bevy_reflect</code> and Update docs accordingly</ul><h2 id=testing>Testing</h2><ul><li>Added test on indexmap::IndexMap</ul><hr><p>I initially tried using <code>impl_reflect_for_hashmap</code>, but ran into two issues:<ol><li><code>IndexMap::drain</code> requires a range parameter, unlike <code>HashMap::drain</code>.<li><code>IndexMap::remove</code> defaults to <code>swap_remove</code>, and is now deprecated.</ol><p>I went with <code>shift_remove</code>, since I think it matches user expectations.<br> That said, it’s <code>O(n)</code>, while <code>swap_remove</code> is <code>O(1)</code>.<br> Would love feedback on which behavior we should prefer.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a gap in Bevy’s reflection system by adding support for <code>IndexMap</code> and <code>IndexSet</code> from the <code>indexmap</code> crate. The core issue was that these data structures, which are used in various parts of the Bevy ecosystem, couldn’t be serialized, deserialized, or manipulated through Bevy’s reflection APIs.<p>The problem stemmed from the fact that <code>indexmap</code> provides map and set implementations that preserve insertion order, unlike the standard library’s <code>HashMap</code> and <code>HashSet</code>. This makes them particularly useful in game development scenarios where predictable iteration order matters. However, without reflection support, these types couldn’t participate in Bevy’s serialization, scene system, or property inspection workflows.<p>The developer initially attempted to reuse the existing <code>impl_reflect_for_hashmap</code> pattern but encountered two key API differences. First, <code>IndexMap::drain</code> requires a range parameter (needing <code>..</code> to drain the entire map), while <code>HashMap::drain</code> takes no arguments. Second, <code>IndexMap::remove</code> is deprecated in favor of <code>swap_remove</code> and <code>shift_remove</code>, with different performance characteristics. The developer chose <code>shift_remove</code> for its predictable behavior (maintaining order after removal), despite its O(n) complexity versus <code>swap_remove</code>’s O(1) performance.<p>The implementation follows Bevy’s established patterns for reflection. For <code>IndexMap&LTK, V, S></code>, it implements:<ul><li><code>Map</code> trait for map-specific operations<li><code>PartialReflect</code> and <code>Reflect</code> for basic reflection capabilities<li><code>Typed</code> for type information<li><code>FromReflect</code> for deserialization from reflected data<li><code>GetTypeRegistration</code> for type registration in the type registry</ul><p>Similarly, for <code>IndexSet&LTT, S></code>, it implements:<ul><li><code>Set</code> trait for set-specific operations<li>The same reflection traits as above</ul><p>The key challenge was adapting the generic implementations to handle <code>indexmap</code>’s API differences while maintaining compatibility with the existing reflection system. The solution uses <code>IndexMap::drain(..)</code> to drain all elements and <code>IndexMap::shift_remove</code> for element removal, which preserves insertion order but has linear time complexity.<p>One notable design decision was the handling of type constraints. The implementations require that key, value, and set element types implement <code>FromReflect</code>, <code>MaybeTyped</code>, <code>TypePath</code>, and <code>GetTypeRegistration</code>, ensuring they can be properly reflected and reconstructed. The hasher type <code>S</code> must implement <code>BuildHasher</code>, <code>Default</code>, <code>Send</code>, <code>Sync</code>, and <code>TypePath</code>.<p>The PR also updates <code>EntityIndexSet</code> in the ECS module to derive <code>Reflect</code> when the reflection feature is enabled. This enables reflection support for a commonly used ECS type without breaking existing code.<p>The performance consideration around <code>shift_remove</code> versus <code>swap_remove</code> is significant. While <code>shift_remove</code> provides predictable behavior that matches user expectations for an insertion-order-preserving map, its O(n) complexity could be problematic for large maps. The developer explicitly asked for feedback on this trade-off, indicating an awareness of the performance implications.<p>The implementation includes comprehensive tests to ensure the reflection system works correctly with <code>IndexMap</code>. These tests verify that type information is correctly registered and that the map can be used through reflection interfaces.<p>From an architectural perspective, this PR follows Bevy’s pattern of implementing reflection for external types via feature flags. The <code>indexmap</code> feature is added to <code>bevy_reflect</code> and enabled by default in the <code>bevy</code> meta-feature, ensuring that reflection support is available when using the full engine.<p>The changes are relatively self-contained, adding a new module <code>impls/indexmap.rs</code> without modifying existing reflection implementations. This keeps the codebase maintainable and follows the principle of separation of concerns.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_reflect crate] --> B[indexmap feature]
</span><span>    B --> C[IndexMap reflection]
</span><span>    B --> D[IndexSet reflection]
</span><span>    
</span><span>    E[bevy_ecs crate] --> F[EntityIndexSet]
</span><span>    F --> G[Derives Reflect]
</span><span>    
</span><span>    C --> H[Implements Map, Reflect, etc.]
</span><span>    D --> I[Implements Set, Reflect, etc.]
</span><span>    
</span><span>    H --> J[Used in scene serialization]
</span><span>    I --> J
</span><span>    G --> J
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-reflect-src-impls-indexmap-rs-496-0>1. <code>crates/bevy_reflect/src/impls/indexmap.rs</code> (+496/-0)</h3><p>This new file contains the core implementation of reflection traits for <code>IndexMap</code> and <code>IndexSet</code>. The implementation is structured similarly to existing hashmap and hashset reflection implementations but adapts to <code>indexmap</code>’s API.<p><strong>Key Implementation Details:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// For IndexMap::drain - note the need for range parameter
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>drain</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn PartialReflect>, </span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn PartialReflect>)> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>drain</span><span>(</span><span style=color:#ed9366>..</span><span>)  </span><span style=color:#abb0b6;font-style:italic>// Uses full range
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|(</span><span style=color:#ff8f40>key</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>value</span><span>)| {
</span><span>            (
</span><span>                </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(key) </span><span style=color:#ed9366>as </span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn PartialReflect></span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(value) </span><span style=color:#ed9366>as </span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn PartialReflect></span><span style=color:#61676ccc>,
</span><span>            )
</span><span>        })
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>collect</span><span>()
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// For IndexMap::remove - uses shift_remove instead of remove
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>remove</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>key</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>dyn PartialReflect) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn PartialReflect>> {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> from_reflect </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span>    key</span><span style=color:#ed9366>.</span><span>try_downcast_ref</span><span style=color:#ed9366>::</span><span>&LTK>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>or_else</span><span>(|| {
</span><span>            from_reflect </span><span style=color:#ed9366>= </span><span>K</span><span style=color:#ed9366>::</span><span>from_reflect(key)</span><span style=color:#61676ccc>;
</span><span>            from_reflect</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()
</span><span>        })
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>and_then</span><span>(|</span><span style=color:#ff8f40>key</span><span>| </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>shift_remove</span><span>(key))  </span><span style=color:#abb0b6;font-style:italic>// Uses shift_remove
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>value</span><span>| </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(value) </span><span style=color:#ed9366>as </span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn PartialReflect>)
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-reflect-src-lib-rs-32-4>2. <code>crates/bevy_reflect/src/lib.rs</code> (+32/-4)</h3><p>Updated to include the new indexmap module and update documentation.<p><strong>Changes:</strong><ul><li>Added <code>indexmap</code> module under <code>#[cfg(feature = "indexmap")]</code><li>Updated documentation to mention <code>indexmap</code> as a dependency<li>Added test case for <code>IndexMap</code> reflection</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added module declaration
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"indexmap"</span><span>)]
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>indexmap</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Updated documentation table
</span><span style=color:#abb0b6;font-style:italic>//! | Default | Dependencies                                        |
</span><span style=color:#abb0b6;font-style:italic>//! | :-----: | :-------------------------------------------------: |
</span><span style=color:#abb0b6;font-style:italic>//! | ❌      | [`bevy_math`], [`glam`], [`indexmap`], [`smallvec`] |
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added test case
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"indexmap"</span><span>)]
</span><span>{
</span><span>    </span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>hash</span><span style=color:#ed9366>::</span><span>RandomState</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>MyIndexMap </span><span style=color:#ed9366>= </span><span>indexmap</span><span style=color:#ed9366>::</span><span>IndexMap<</span><span style=color:#55b4d4;font-style:italic>String</span><span>, </span><span style=color:#fa6e32>u32</span><span>, RandomState></span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... test implementation
</span><span>}
</span></code></pre><h3 id=3-crates-bevy-reflect-cargo-toml-5-1>3. <code>crates/bevy_reflect/Cargo.toml</code> (+5/-1)</h3><p>Added <code>indexmap</code> as an optional dependency and feature.<p><strong>Changes:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Added to features
</span><span style=color:#399ee6>indexmap </span><span>= [</span><span style=color:#86b300>"dep:indexmap"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Added to dependencies
</span><span style=color:#399ee6>indexmap </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"2.5.0"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Updated default features to include indexmap
</span><span style=color:#399ee6>default </span><span>= [</span><span style=color:#86b300>"std"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"smallvec"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"indexmap"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"debug"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"auto_register_inventory"</span><span>]
</span></code></pre><h3 id=4-crates-bevy-ecs-src-entity-index-set-rs-4-0>4. <code>crates/bevy_ecs/src/entity/index_set.rs</code> (+4/-0)</h3><p>Added <code>Reflect</code> derive to <code>EntityIndexSet</code> when the <code>bevy_reflect</code> feature is enabled.<p><strong>Changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_reflect"</span><span>)]
</span><span style=color:#fa6e32>use </span><span>bevy_reflect</span><span style=color:#ed9366>::</span><span>Reflect</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_reflect"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>derive</span><span>(Reflect))]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>EntityIndexSet</span><span>(pub(crate) IndexSet&LTEntity, EntityHash>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=5-crates-bevy-ecs-cargo-toml-1-0>5. <code>crates/bevy_ecs/Cargo.toml</code> (+1/-0)</h3><p>Enabled the <code>indexmap</code> feature of <code>bevy_reflect</code> dependency.<p><strong>Changes:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>bevy_reflect </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_reflect"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"smallvec"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"indexmap"</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic># Added this line
</span><span>]</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Reflection System</strong>: <a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_reflect/latest/bevy_reflect/ target=_blank>Bevy Reflection Documentation</a><li><strong>IndexMap Crate</strong>: <a rel="noopener nofollow noreferrer" href=https://docs.rs/indexmap/latest/indexmap/ target=_blank>indexmap documentation</a><li><strong>Rust Orphan Rules</strong>: Understanding why reflection implementations must be in the bevy_reflect crate due to Rust’s orphan rules<li><strong>Feature Flags in Rust</strong>: How Bevy uses feature flags to manage optional dependencies<li><strong>Type-Driven Design</strong>: The pattern of implementing <code>Typed</code>, <code>GetTypeRegistration</code>, and type registry usage in Bevy</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_20734.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>