<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21968 Fix the doc test for WebAssetPlugin
        
    </title><meta content="#21968 Fix the doc test for WebAssetPlugin" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21968-zh-cn-20251207>中文</a></div></div><div class=pr-content><h1 id=fix-the-doc-test-for-webassetplugin>Fix the doc test for WebAssetPlugin</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix the doc test for WebAssetPlugin<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21968<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Assets, S-Ready-For-Final-Review, C-Testing<li><strong>Created</strong>: 2025-11-28T19:13:52Z<li><strong>Merged</strong>: 2025-12-07T18:24:09Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p>Objective<ul><li>Fix <code>cargo t -p bevy_asset --all-features</code>. <ul><li>Note: <code>all-features</code> do not run on CI!</ul><li>The doc tests for the <code>WebAssetPlugin</code> don’t compile at all. There are bad imports and we don’t even add the <code>AssetPlugin</code>.</ul><p>Solution<ul><li>Add missing imports, and add missing plugins to the <code>App</code>.</ul><p>Testing<ul><li>Ran <code>cargo t -p bevy_asset --all-features</code> and it passes now!</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a specific but important issue in Bevy’s documentation: a broken doc test for the <code>WebAssetPlugin</code> that prevented compilation when running tests with the <code>--all-features</code> flag. The problem was that the example code in the documentation contained incorrect imports and was missing necessary plugin setup, making it non-compilable despite being presented as working example code.<p>The issue became apparent when running <code>cargo t -p bevy_asset --all-features</code>, which isn’t part of the CI pipeline. This highlights a common problem in large codebases where certain configurations aren’t regularly tested and can drift out of sync with code changes over time. In this case, the <code>WebAssetPlugin</code> example was likely correct when initially written but became outdated as the Bevy API evolved.<p>The solution is straightforward but important for documentation quality: update the imports to reference the correct paths and add the missing plugins that the example actually needs to function. The example was trying to use Bevy’s asset system without actually including the <code>AssetPlugin</code>, which is a fundamental requirement. Similarly, the mock implementation of <code>DefaultPlugins</code> had an incorrect method signature that didn’t match the actual API.<p>From an engineering perspective, this fix demonstrates several best practices:<ol><li><strong>Documentation as executable code</strong>: Doc tests in Rust are more than just examples - they’re compiled and run, serving as living documentation that verifies the examples actually work.<li><strong>Testing edge cases</strong>: While CI might not run all feature combinations, developers should still test these configurations locally to catch issues like this.<li><strong>API consistency</strong>: The mock implementation in the example now correctly mirrors the real <code>DefaultPlugins</code> API with the <code>&self</code> receiver, making the example more accurate and educational.</ol><p>The changes themselves are minimal but important for anyone trying to use the <code>WebAssetPlugin</code> in a web context. The updated imports now correctly reflect Bevy’s module structure, with <code>Asset</code>, <code>AssetApp</code>, <code>AssetPlugin</code>, <code>AssetServer</code>, and <code>Handle</code> all properly imported from <code>bevy_asset</code>. The addition of <code>TypePath</code> from <code>bevy_reflect</code> is also necessary since the example defines an <code>Image</code> asset that derives <code>Asset</code> and <code>TypePath</code>.<p>The most significant addition is the explicit inclusion of <code>TaskPoolPlugin::default()</code> and <code>AssetPlugin::default()</code> in the app builder, followed by <code>init_asset::&LTImage>()</code>. This shows users that when mocking <code>DefaultPlugins</code> in a doc test, they need to manually include the essential plugins that would normally be part of the default set. This educational aspect is valuable for developers learning Bevy’s plugin architecture.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[WebAssetPlugin Doc Test] --> B[Import Issues]
</span><span>    A --> C[Missing Plugin Setup]
</span><span>    B --> D[Update Imports]
</span><span>    C --> E[Add Required Plugins]
</span><span>    D --> F[Fixed Doc Test]
</span><span>    E --> F
</span><span>    F --> G[Compilation Success]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-asset-src-io-web-rs-7-5><code>crates/bevy_asset/src/io/web.rs</code> (+7/-5)</h3><p>This file contains the documentation for the <code>WebAssetPlugin</code>, including the example code that was broken. The changes fix the imports and plugin setup in the example.<p><strong>Key Changes:</strong><ol><li><strong>Fixed imports</strong> - Updated the import statements to include all necessary types and correct paths<li><strong>Fixed mock implementation</strong> - Corrected the <code>DefaultPlugins</code> mock method signature<li><strong>Added required plugins</strong> - Explicitly added <code>TaskPoolPlugin</code> and <code>AssetPlugin</code> to the app builder<li><strong>Added asset initialization</strong> - Called <code>init_asset::&LTImage>()</code> to properly set up the asset type</ol><p><strong>Code snippets showing the key modifications:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (incorrect imports and setup):
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_app</span><span style=color:#ed9366>::</span><span>{App</span><span style=color:#61676ccc>,</span><span> Startup}</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>prelude</span><span style=color:#ed9366>::</span><span>{Commands</span><span style=color:#61676ccc>,</span><span> Res}</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_asset</span><span style=color:#ed9366>::</span><span>web</span><span style=color:#ed9366>::</span><span>{WebAssetPlugin</span><span style=color:#61676ccc>,</span><span> AssetServer}</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>DefaultPlugins</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>DefaultPlugins </span><span>{ </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>set</span><span>(</span><span style=color:#ff8f40>plugin</span><span style=color:#61676ccc>:</span><span> WebAssetPlugin) </span><span style=color:#61676ccc>-></span><span> WebAssetPlugin { plugin } }
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_asset</span><span style=color:#ed9366>::</span><span>web</span><span style=color:#ed9366>::</span><span>AssetServer</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (corrected imports and setup):
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_app</span><span style=color:#ed9366>::</span><span>{App</span><span style=color:#61676ccc>,</span><span> Startup</span><span style=color:#61676ccc>,</span><span> TaskPoolPlugin}</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>prelude</span><span style=color:#ed9366>::</span><span>{Commands</span><span style=color:#61676ccc>,</span><span> Component</span><span style=color:#61676ccc>,</span><span> Res}</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_asset</span><span style=color:#ed9366>::</span><span>{Asset</span><span style=color:#61676ccc>,</span><span> AssetApp</span><span style=color:#61676ccc>,</span><span> AssetPlugin</span><span style=color:#61676ccc>,</span><span> AssetServer</span><span style=color:#61676ccc>,</span><span> Handle</span><span style=color:#61676ccc>, </span><span>io</span><span style=color:#ed9366>::</span><span>web</span><span style=color:#ed9366>::</span><span>WebAssetPlugin}</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>use </span><span>bevy_reflect</span><span style=color:#ed9366>::</span><span>TypePath</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>DefaultPlugins</span><span style=color:#61676ccc>;
</span><span style=color:#ed9366># </span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>DefaultPlugins </span><span>{ </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>set</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>plugin</span><span style=color:#61676ccc>:</span><span> WebAssetPlugin) </span><span style=color:#61676ccc>-></span><span> WebAssetPlugin { plugin } }
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Also added to the App builder:
</span><span style=color:#ed9366>#   .</span><span style=color:#f07171>add_plugins</span><span>((TaskPoolPlugin</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>, </span><span>AssetPlugin</span><span style=color:#ed9366>::</span><span>default()))
</span><span style=color:#ed9366>#   .</span><span>init_asset</span><span style=color:#ed9366>::</span><span>&LTImage>()
</span></code></pre><p>These changes ensure that the example code is actually compilable and serves as a valid reference for users wanting to use the <code>WebAssetPlugin</code> in web environments.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html target=_blank>Rust Documentation Tests</a> - Official guide to writing documentation tests in Rust<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/plugins/ target=_blank>Bevy Plugin System</a> - Documentation on Bevy’s plugin architecture<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/assets/ target=_blank>Bevy Asset System</a> - Guide to Bevy’s asset management system<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/platforms/wasm/ target=_blank>WebAssembly with Bevy</a> - Information on using Bevy in web environments with WebAssembly</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21968.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>