<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22172 impl Deref for BackgroundColor
        
    </title><meta content="#22172 impl Deref for BackgroundColor" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22172-zh-cn-20251217>中文</a></div></div><div class=pr-content><h1 id=title-impl-deref-for-backgroundcolor>Title: impl Deref for BackgroundColor</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: impl Deref for BackgroundColor<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22172<li><strong>Author</strong>: IWonderWhatThisAPIDoes<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-UI, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-17T20:40:27Z<li><strong>Merged</strong>: 2025-12-17T21:37:14Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>Many newtypes in Bevy implement <code>Deref</code> and <code>DerefMut</code> for convenience. Let us extend that to <code>BackgroundColor</code>.<h2 id=solution>Solution</h2><p>Derived <code>Deref</code> and <code>DerefMut</code> for <code>BackgroundColor</code>.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a consistency issue in the Bevy UI system’s API design. The <code>BackgroundColor</code> struct, which wraps a <code>Color</code> value to serve as the fill color for UI nodes, was missing the standard convenience traits that similar “newtype” wrapper structs in Bevy typically implement.<p>The core problem was that <code>BackgroundColor</code> didn’t implement the <code>Deref</code> and <code>DerefMut</code> traits. In Rust, newtype wrappers (structs with a single field) often implement these traits to provide automatic dereferencing to their inner type. This pattern allows users to work with the wrapper type as if it were the inner type in many contexts, reducing boilerplate and improving ergonomics.<p>The context here is that Bevy follows a common Rust idiom where newtype wrappers implement <code>Deref</code> and <code>DerefMut</code> to expose the methods of the wrapped type. For example, if you have a <code>BackgroundColor</code> instance, you should be able to call methods on the underlying <code>Color</code> directly without having to access the inner field each time.<p>Without these traits, developers working with <code>BackgroundColor</code> would need to either:<ol><li>Explicitly access the <code>.0</code> field every time they wanted to work with the <code>Color</code><li>Manually dereference using <code>*background_color</code> (which wouldn’t work without <code>Deref</code>)<li>Write additional helper methods or conversion code</ol><p>The solution was straightforward: add <code>Deref</code> and <code>DerefMut</code> to the existing derive macro list for <code>BackgroundColor</code>. This is a minimal change that follows established patterns in the codebase.<p>Looking at the implementation, <code>BackgroundColor</code> is defined as a tuple struct with a single <code>Color</code> field:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BackgroundColor</span><span>(pub Color)</span><span style=color:#61676ccc>;
</span></code></pre><p>By adding <code>#[derive(Deref, DerefMut)]</code> to this struct, the compiler automatically generates implementations that:<ul><li><code>Deref</code> provides an immutable reference to the inner <code>Color</code><li><code>DerefMut</code> provides a mutable reference to the inner <code>Color</code></ul><p>This means that after the change, all methods available on <code>Color</code> become available on <code>BackgroundColor</code> through deref coercion. For example, users can now write:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let mut</span><span> bg_color </span><span style=color:#ed9366>=</span><span> BackgroundColor(Color</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>RED</span><span>)</span><span style=color:#61676ccc>;
</span><span>bg_color</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_a</span><span>(</span><span style=color:#ff8f40>0.5</span><span>)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// set_a is a method on Color, now accessible on BackgroundColor
</span></code></pre><p>The technical implementation is simple but follows an important principle: consistency in API design. When similar types in a library follow consistent patterns, developers can make reasonable assumptions about how to use them. This reduces cognitive load and makes the API more predictable.<p>The impact of this change is primarily improved developer ergonomics. While it doesn’t add new functionality, it makes existing functionality more accessible. Developers can now work with <code>BackgroundColor</code> more naturally, using the same patterns they’re familiar with from other Bevy newtypes.<p>One important consideration with <code>Deref</code> is that it should generally only be used for smart pointers and newtype wrappers where the wrapper is essentially just the inner type with additional semantics. This is exactly the case with <code>BackgroundColor</code> - it’s a <code>Color</code> with the additional semantic meaning of being a background color for UI nodes.<p>The change was reviewed and merged quickly (within an hour), indicating that it was a clear improvement that aligned with existing patterns. The labels “D-Trivial” and “C-Usability” accurately reflect the nature of the change: a minor implementation detail that improves usability.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[BackgroundColor struct] --> B[Derives Deref trait]
</span><span>    A --> C[Derives DerefMut trait]
</span><span>    B --> D[Provides &Color access]
</span><span>    C --> E[Provides &mut Color access]
</span><span>    D --> F[Enables Color method calls]
</span><span>    E --> F
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_ui/src/ui_node.rs</code></strong> This file contains the <code>BackgroundColor</code> struct definition in the Bevy UI module. The change adds <code>Deref</code> and <code>DerefMut</code> to the derive macro list.<p>Before:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(
</span><span>    feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"serialize"</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>derive</span><span>(serde::Serialize</span><span style=color:#61676ccc>,</span><span> serde::Deserialize)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>reflect</span><span>(Serialize</span><span style=color:#61676ccc>,</span><span> Deserialize)
</span><span>)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BackgroundColor</span><span>(pub Color)</span><span style=color:#61676ccc>;
</span></code></pre><p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Deref</span><span style=color:#61676ccc>,</span><span> DerefMut</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(
</span><span>    feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"serialize"</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>derive</span><span>(serde::Serialize</span><span style=color:#61676ccc>,</span><span> serde::Deserialize)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>reflect</span><span>(Serialize</span><span style=color:#61676ccc>,</span><span> Deserialize)
</span><span>)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BackgroundColor</span><span>(pub Color)</span><span style=color:#61676ccc>;
</span></code></pre><p>The change adds <code>Deref</code> and <code>DerefMut</code> to the derive list, making all methods of the inner <code>Color</code> type automatically available on <code>BackgroundColor</code> instances through deref coercion.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust Documentation on Deref Trait</strong>: https://doc.rust-lang.org/std/ops/trait.Deref.html<li><strong>The Newtype Pattern in Rust</strong>: https://doc.rust-lang.org/rust-by-example/generics/new_types.html<li><strong>Bevy’s Component Documentation</strong>: https://bevyengine.org/learn/book/getting-started/ecs/<li><strong>Rust Deref Coercion</strong>: https://doc.rust-lang.org/book/ch15-02-deref.html#implicit-deref-coercions-with-functions-and-methods</ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ui/src/ui_node.rs b/crates/bevy_ui/src/ui_node.rs
</span><span>index e3cf6feae28d1..4f672126e4800 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ui/src/ui_node.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ui/src/ui_node.rs
</span><span style=color:#c594c5>@@ -2205,7 +2205,7 @@ </span><span style=color:#399ee6>pub enum GridPlacementError {
</span><span> /// The background color of the node
</span><span> ///
</span><span> /// This serves as the "fill" color.
</span><span style=color:#f07171>-#[derive(Component, Copy, Clone, Debug, PartialEq, Reflect)]
</span><span style=color:#86b300>+#[derive(Component, Copy, Clone, Debug, Deref, DerefMut, PartialEq, Reflect)]
</span><span> #[reflect(Component, Default, Debug, PartialEq, Clone)]
</span><span> #[cfg_attr(
</span><span>     feature = "serialize",
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22172.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>