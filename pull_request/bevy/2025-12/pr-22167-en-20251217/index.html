<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22167 Enable the necessary features for `bevy_input` for `bevy_input_focus`
        
    </title><meta content="#22167 Enable the necessary features for `bevy_input` for `bevy_input_focus`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22167-zh-cn-20251217>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Enable the necessary features for <code>bevy_input</code> for <code>bevy_input_focus</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Enable the necessary features for <code>bevy_input</code> for <code>bevy_input_focus</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22167<li><strong>Author</strong>: Shatur<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, A-Input, A-UI, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-17T16:03:27Z<li><strong>Merged</strong>: 2025-12-17T18:50:46Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Features added for <code>bevy_input</code> in #21447 wasn’t enabled for <code>bevy_input_focus</code> which causes compilation error.</ul><h2 id=solution>Solution</h2><ul><li>Enable them.</ul><h2 id=testing>Testing</h2><ul><li>I checked that <code>cargo check -p bevy_input_focus</code> no longer fails.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR fixes a straightforward build issue that emerged from a recent change to the Bevy input system. The problem was essentially a missing feature flag dependency that caused a compilation failure in the <code>bevy_input_focus</code> crate.<p>The issue originated from PR #21447, which restructured the <code>bevy_input</code> crate by splitting its functionality into separate Cargo features. This modularization approach allows users to enable only the input functionality they need, reducing compile times and binary size for projects that don’t require all input capabilities. The specific features introduced were <code>keyboard</code> and <code>gamepad</code>, which separate keyboard and gamepad input handling from the core input system.<p>However, when these features were introduced, they weren’t properly enabled for downstream crates that depend on them. The <code>bevy_input_focus</code> crate, which handles input focus management for UI elements, relies on keyboard input functionality. Without the <code>keyboard</code> feature explicitly enabled, the compilation fails because the code references types and functions that are now gated behind this feature flag.<p>The fix is minimal and surgical: update the dependency declaration in <code>bevy_input_focus</code>’s Cargo.toml to enable the required features. This is a common pattern in Rust’s Cargo ecosystem where features must be explicitly propagated through the dependency chain. When a library splits functionality into features, downstream users must opt into those features even if they’re indirect dependencies.<p>The implementation change is exactly one line modified in the Cargo.toml file, adding the <code>keyboard</code> and <code>gamepad</code> features to the <code>bevy_input</code> dependency. The <code>bevy_input_focus</code> crate likely needs both features because it may handle focus for both keyboard and gamepad navigation, though keyboard is the primary use case for most UI interactions.<p>This kind of issue is typical in large Rust codebases using feature flags. When a library introduces optional features, all dependent crates must update their feature requirements. The fact that this slipped through indicates either a missing CI check or that the <code>bevy_input_focus</code> crate wasn’t tested as part of the initial feature flag implementation in PR #21447.<p>From an engineering perspective, this PR highlights several important patterns:<ol><li>Feature flag propagation in Rust dependencies<li>The importance of comprehensive CI testing across all dependent crates when introducing feature flags<li>How modular architecture decisions in one crate (splitting functionality into features) can create downstream maintenance requirements</ol><p>The fix ensures that <code>bevy_input_focus</code> continues to work correctly with the modularized input system, maintaining the benefits of feature-based compilation while fixing the broken dependency chain.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #21447: Refactor bevy_input] --> B[Adds keyboard/gamepad features]
</span><span>    B --> C[Breaking change for dependents]
</span><span>    D[bevy_input_focus crate] --> E[Depends on bevy_input]
</span><span>    E --> F[Missing feature flags]
</span><span>    F --> G[Compilation error]
</span><span>    H[PR #22167] --> I[Adds feature flags to dependency]
</span><span>    I --> J[Compilation fixed]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-input-focus-cargo-toml><code>crates/bevy_input_focus/Cargo.toml</code></h3><p><strong>What changed and why</strong>: Added the <code>keyboard</code> and <code>gamepad</code> features to the <code>bevy_input</code> dependency. These features were introduced in PR #21447 but weren’t enabled for the <code>bevy_input_focus</code> crate, causing compilation errors.<p><strong>Code snippets</strong>:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>bevy_input </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_input"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>bevy_input </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_input"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"keyboard"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"gamepad"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><p><strong>Relationship to overall purpose</strong>: This single change fixes the compilation error by ensuring that <code>bevy_input_focus</code> has access to the keyboard and gamepad functionality it needs from the <code>bevy_input</code> crate. The change is minimal but essential for maintaining a working build.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>The Cargo Book: Features</a> - Official documentation on Cargo features and dependency management<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation in Rust</a> - How Rust uses features for conditional compilation<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/input/ target=_blank>Bevy Engine Documentation on Input</a> - Bevy’s input handling system<li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/dependencies.html target=_blank>Rust Dependency Management Patterns</a> - Best practices for managing dependencies in Rust</ol><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/crates/bevy_input_focus/Cargo.toml b/crates/bevy_input_focus/Cargo.toml index 80c355c82292d..60ca101301436 100644 — a/crates/bevy_input_focus/Cargo.toml +++ b/crates/bevy_input_focus/Cargo.toml @@ -63,7 +63,10 @@ libm = [“bevy_math/libm”, “bevy_window/libm”] bevy_app = { path = “../bevy_app”, version = “0.18.0-dev”, default-features = false } bevy_camera = { path = “../bevy_camera”, version = “0.18.0-dev”, default-features = false } bevy_ecs = { path = “../bevy_ecs”, version = “0.18.0-dev”, default-features = false } -bevy_input = { path = “../bevy_input”, version = “0.18.0-dev”, default-features = false } +bevy_input = { path = “../bevy_input”, version = “0.18.0-dev”, default-features = false, features = [<ul><li>“keyboard”,<li>“gamepad”, +] } bevy_math = { path = “../bevy_math”, version = “0.18.0-dev”, default-features = false } bevy_picking = { path = “../bevy_picking”, version = “0.18.0-dev”, default-features = false, optional = true } bevy_ui = { path = “../bevy_ui”, version = “0.18.0-dev”, default-features = false }</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22167.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>