<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22197 Add `Dir2::from_angle`
        
    </title><meta content="#22197 Add `Dir2::from_angle`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22197-zh-cn-20251222>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Add <code>Dir2::from_angle</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add <code>Dir2::from_angle</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22197<li><strong>Author</strong>: lynn-lumen<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, A-Math, D-Straightforward<li><strong>Created</strong>: 2025-12-19T14:17:27Z<li><strong>Merged</strong>: 2025-12-22T20:12:40Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>I have found myself writing <code>Dir2::new_unchecked(Vec2::from_angle(angle))</code> or <code>Dir2::new(Vec2::from_angle(angle)).unwrap()</code> quite frequently. This is pretty cumbersome and should not require calling <code>.unwrap()</code> or unchecked functions.</ul><h2 id=solution>Solution</h2><ul><li>Added <code>Dir2::from_angle(angle)</code></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a small but frequent ergonomic issue in the Bevy math library. When working with 2D directions represented as angles, developers were forced to write verbose code that either used unsafe methods or required unwrapping results. The core problem was that creating a normalized direction vector from an angle required multiple steps, even though the mathematical operation is straightforward and always valid.<p>The developer encountered this issue repeatedly in their workflow: to create a <code>Dir2</code> from an angle, they had to first create a <code>Vec2</code> using <code>Vec2::from_angle()</code>, then convert it to a <code>Dir2</code>. Since <code>Vec2::from_angle()</code> always produces a normalized vector (because <code>[cos(θ), sin(θ)]</code> has unit length by definition), the conversion should be safe, but the existing API required either:<ol><li>Using <code>Dir2::new_unchecked()</code> which bypasses safety checks<li>Using <code>Dir2::new()</code> followed by <code>.unwrap()</code> which adds unnecessary error handling</ol><p>Both approaches were suboptimal. The first bypasses the type system’s safety guarantees, while the second adds unnecessary runtime overhead and complexity for an operation that mathematically cannot fail.<p>The solution implemented is straightforward and follows existing patterns in the codebase. A new method <code>Dir2::from_angle()</code> was added that directly constructs a <code>Dir2</code> from an angle. Internally, it calls <code>Vec2::from_angle()</code> and wraps the result in a <code>Dir2</code>. Since <code>Vec2::from_angle()</code> guarantees a normalized vector, this conversion is always safe.<p>This change improves code ergonomics in several ways:<ol><li>It eliminates the need for unsafe operations or unwrapping for a common use case<li>It makes the intent clearer - when reading <code>Dir2::from_angle(θ)</code>, it’s immediately obvious what the code is doing<li>It reduces boilerplate and potential for errors<li>It maintains type safety without runtime overhead</ol><p>The implementation is efficient - it’s marked with <code>#[inline]</code> to allow the compiler to optimize away the function call overhead. The method simply delegates to <code>Vec2::from_angle()</code> which already computes the cosine and sine of the angle.<p>This change follows the principle that APIs should make common patterns easy and safe. When a mathematical operation is well-defined and cannot fail (like creating a unit direction vector from an angle), the API should reflect that by providing a direct, safe method rather than forcing developers through error-prone or verbose workarounds.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Angle: f32] --> B[Vec2::from_angle]
</span><span>    B --> C[Normalized Vec2]
</span><span>    C --> D[Dir2::new/unchecked with unwrap]
</span><span>    C --> E[New: Dir2::from_angle]
</span><span>    D --> F[Verbose, unsafe or error-prone]
</span><span>    E --> G[Concise, always safe]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_math/src/direction.rs</code></strong><ul><li><strong>Change</strong>: Added the <code>from_angle</code> method to the <code>Dir2</code> struct<li><strong>Why</strong>: To provide a direct, safe way to create a 2D direction from an angle without requiring unsafe operations or error handling</ul><p><strong>Code Snippet:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: No direct method to create Dir2 from angle
</span><span style=color:#abb0b6;font-style:italic>// Developers had to write:
</span><span style=color:#fa6e32>let</span><span> dir1 </span><span style=color:#ed9366>= </span><span>Dir2</span><span style=color:#ed9366>::</span><span>new_unchecked(Vec2</span><span style=color:#ed9366>::</span><span>from_angle(angle))</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Unsafe
</span><span style=color:#fa6e32>let</span><span> dir2 </span><span style=color:#ed9366>= </span><span>Dir2</span><span style=color:#ed9366>::</span><span>new(Vec2</span><span style=color:#ed9366>::</span><span>from_angle(angle))</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Error-prone
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: New method added
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Dir2 </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Creates a 2D direction containing `[angle.cos(), angle.sin()]`.
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>from_angle</span><span>(</span><span style=color:#ff8f40>angle</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span>(Vec2</span><span style=color:#ed9366>::</span><span>from_angle(angle))
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Usage becomes simple and safe:
</span><span style=color:#fa6e32>let</span><span> dir </span><span style=color:#ed9366>= </span><span>Dir2</span><span style=color:#ed9366>::</span><span>from_angle(angle)</span><span style=color:#61676ccc>;
</span></code></pre><p>The implementation leverages the existing <code>Vec2::from_angle()</code> method which guarantees a normalized vector, making the conversion to <code>Dir2</code> always safe. The method is inline to avoid function call overhead, and the documentation clearly states what it does.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Math Documentation</strong>: For more information about <code>Dir2</code> and other math types in Bevy<li><strong>Trigonometry Fundamentals</strong>: Understanding why <code>[cos(θ), sin(θ)]</code> always produces a unit vector<li><strong>API Design Principles</strong>: The importance of making safe operations easy and unsafe operations difficult<li><strong>Rust Inline Attributes</strong>: When and why to use <code>#[inline]</code> for performance optimization</ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_math/src/direction.rs b/crates/bevy_math/src/direction.rs
</span><span>index 03cb9f969f1e6..d2c6d4b629370 100644
</span><span style=color:#c594c5>--- a/crates/bevy_math/src/direction.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_math/src/direction.rs
</span><span style=color:#c594c5>@@ -179,6 +179,12 @@ </span><span style=color:#399ee6>impl Dir2 {
</span><span>         Self::new_unchecked(Vec2::new(x, y))
</span><span>     }
</span><span> 
</span><span style=color:#86b300>+    /// Creates a 2D direction containing `[angle.cos(), angle.sin()]`.
</span><span style=color:#86b300>+    #[inline]
</span><span style=color:#86b300>+    pub fn from_angle(angle: f32) -> Self {
</span><span style=color:#86b300>+        Self(Vec2::from_angle(angle))
</span><span style=color:#86b300>+    }
</span><span style=color:#86b300>+
</span><span>     /// Returns the inner [`Vec2`]
</span><span>     pub const fn as_vec2(&self) -> Vec2 {
</span><span>         self.0
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22197.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>