<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22142 disable scraping examples in doc
        
    </title><meta content="#22142 disable scraping examples in doc" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22142-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: disable scraping examples in doc<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22142<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, C-Docs, D-Trivial, A-Build-System, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-15T22:38:38Z<li><strong>Merged</strong>: 2025-12-16T05:20:40Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>rustdoc example scraping is too unstable, and often ICE<li>Fixes https://github.com/bevyengine/bevy/issues/21978</ul><h2 id=solution>Solution</h2><ul><li>Stop using it</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a CI reliability issue in the Bevy game engine’s documentation build process. The problem centered on rustdoc’s experimental example scraping feature, which automatically finds and includes code examples from the repository’s <code>examples/</code> directory in the generated API documentation. While this feature provides value by showing practical usage of APIs, it was causing frequent build failures in CI due to its unstable nature.<p>Specifically, the issue (#21978) reported that the documentation build was encountering Internal Compiler Errors (ICEs) - catastrophic failures in the Rust compiler itself - when using the <code>-Zrustdoc-scrape-examples</code> flag. These ICEs are particularly problematic because they represent bugs in the compiler rather than errors in the Bevy codebase, making them difficult to diagnose or work around. The feature requires the <code>-Zunstable-options</code> flag because it’s not yet stable Rust, meaning it’s only available on nightly toolchains and subject to frequent breaking changes.<p>The solution approach was straightforward and pragmatic: completely disable the example scraping feature by removing the unstable flags from both the CI workflow and the Cargo.toml configuration. This decision reflects a common engineering trade-off between additional functionality and build stability. When a feature causes consistent, unpredictable failures that block development workflows, the most practical solution is often to temporarily disable it until the underlying technology stabilizes.<p>From an implementation perspective, the changes were minimal but targeted. The CI workflow for building documentation (<code>.github/workflows/docs.yml</code>) was modified to remove the <code>-Zunstable-options</code> and <code>-Zrustdoc-scrape-examples</code> flags from the cargo doc command. Similarly, the <code>Cargo.toml</code> file was updated to remove the corresponding <code>cargo-args</code> configuration that passed these flags to the documentation build process for docs.rs.<p>The technical insight here is about managing dependencies on unstable compiler features in production codebases. While nightly Rust features can provide valuable capabilities, they come with significant maintenance costs and reliability risks. The Bevy team’s decision to remove these flags demonstrates good practice in CI/CD pipeline management: prioritizing reliable, predictable builds over experimental features that introduce instability.<p>The impact of this change is immediate build stability for documentation generation. Developers no longer face random ICE failures when documentation builds run, which improves the overall developer experience and reduces noise in the CI system. The trade-off is that API documentation will no longer automatically include examples from the <code>examples/</code> directory, potentially making it slightly harder for users to find usage examples. However, this loss is mitigated by Bevy’s existing comprehensive example system and the fact that users can still manually browse the examples directory.<p>An important technical consideration is that this fix doesn’t address the root cause of the ICEs in rustdoc itself, but rather works around them by disabling the problematic feature. This is a valid approach when the feature is non-essential and the failures are outside the project’s control. The Rust team can continue to stabilize the scraping feature independently, and Bevy can re-enable it once it becomes more reliable.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[GitHub Actions CI Workflow] --> B[cargo doc command]
</span><span>    B --> C[Remove unstable flags]
</span><span>    C --> D[Stable documentation build]
</span><span>    
</span><span>    E[Cargo.toml metadata] --> F[docs.rs configuration]
</span><span>    F --> G[Remove scrape-examples config]
</span><span>    G --> H[Stable docs.rs builds]
</span><span>    
</span><span>    I[Unstable rustdoc feature] --> J[Frequent ICE failures]
</span><span>    J --> K[Documentation build failures]
</span><span>    K --> L{Decision point}
</span><span>    L --> M[Keep unstable feature with failures]
</span><span>    L --> N[Remove unstable feature for stability]
</span><span>    N --> O[Chosen: Stable builds]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-github-workflows-docs-yml>1. <code>.github/workflows/docs.yml</code></h3><p><strong>What changed</strong>: Removed the unstable Rust flags from the cargo doc command in the CI workflow for building documentation.<p><strong>Code snippet</strong>:<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>        </span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>|
</span><span style=color:#86b300>          cargo doc \
</span><span style=color:#86b300>            -Zunstable-options \
</span><span style=color:#86b300>            -Zrustdoc-scrape-examples \
</span><span style=color:#86b300>            --all-features \
</span><span style=color:#86b300>            --workspace \
</span><span style=color:#86b300>            --no-deps \
</span><span style=color:#86b300>            --document-private-items
</span><span style=color:#86b300>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>        </span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>|
</span><span style=color:#86b300>          cargo doc \
</span><span style=color:#86b300>            --all-features \
</span><span style=color:#86b300>            --workspace \
</span><span style=color:#86b300>            --no-deps \
</span><span style=color:#86b300>            --document-private-items
</span></code></pre><p><strong>Why it matters</strong>: This change prevents the CI system from using the unstable rustdoc feature that was causing Internal Compiler Errors, making documentation builds reliable and predictable.<h3 id=2-cargo-toml>2. <code>Cargo.toml</code></h3><p><strong>What changed</strong>: Removed the <code>cargo-args</code> configuration that enabled example scraping for docs.rs builds.<p><strong>Code snippet</strong>:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>rustdoc-args </span><span>= [
</span><span>  </span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--cfg=docsrs"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--generate-link-to-definition"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--html-after-content"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"docs-rs/trait-tags.html"</span><span style=color:#61676ccc>,
</span><span>]
</span><span style=color:#399ee6>all-features </span><span>= </span><span style=color:#ff8f40>true
</span><span style=color:#399ee6>cargo-args </span><span>= [</span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"-Zrustdoc-scrape-examples"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>rustdoc-args </span><span>= [
</span><span>  </span><span style=color:#86b300>"-Zunstable-options"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--cfg=docsrs"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--generate-link-to-definition"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"--html-after-content"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"docs-rs/trait-tags.html"</span><span style=color:#61676ccc>,
</span><span>]
</span><span style=color:#399ee6>all-features </span><span>= </span><span style=color:#ff8f40>true
</span></code></pre><p><strong>Why it matters</strong>: This ensures that documentation builds on docs.rs (the official Rust documentation hosting service) also avoid the unstable feature, providing consistent behavior between local builds, CI builds, and published documentation.<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rustdoc Scrape Examples RFC</strong>: The original proposal for this feature provides insight into its intended design and use cases: https://github.com/rust-lang/rfcs/pull/3123</p><li><p><strong>Rust Unstable Features Guide</strong>: Understanding how unstable features work in Rust and the risks associated with using them: https://doc.rust-lang.org/unstable-book/</p><li><p><strong>Bevy Examples System</strong>: Learn about Bevy’s comprehensive example system that provides practical usage demonstrations: https://github.com/bevyengine/bevy/tree/main/examples</p><li><p><strong>Rust ICE (Internal Compiler Error)</strong>: Information about what ICEs are and how to report them: https://doc.rust-lang.org/nightly/rustc/ice.html</p><li><p><strong>GitHub Actions for Rust</strong>: Best practices for setting up reliable CI/CD for Rust projects: https://github.com/actions-rs/meta</p></ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/.github/workflows/docs.yml b/.github/workflows/docs.yml
</span><span>index 79391d9e674c1..c059134276829 100644
</span><span style=color:#c594c5>--- a/.github/workflows/docs.yml
</span><span style=color:#c594c5>+++ b/.github/workflows/docs.yml
</span><span style=color:#c594c5>@@ -62,8 +62,6 @@ </span><span style=color:#399ee6>jobs:
</span><span>           RUSTDOCFLAGS: -Zunstable-options --cfg=docsrs --generate-link-to-definition --html-after-content docs-rs/trait-tags.html
</span><span>         run: |
</span><span>           cargo doc \
</span><span style=color:#f07171>-            -Zunstable-options \
</span><span style=color:#f07171>-            -Zrustdoc-scrape-examples \
</span><span>             --all-features \
</span><span>             --workspace \
</span><span>             --no-deps \
</span><span>diff --git a/Cargo.toml b/Cargo.toml
</span><span>index 61d0d5a580a80..c249d71a0f267 100644
</span><span style=color:#c594c5>--- a/Cargo.toml
</span><span style=color:#c594c5>+++ b/Cargo.toml
</span><span style=color:#c594c5>@@ -4691,7 +4691,6 @@ </span><span style=color:#399ee6>rustdoc-args = [
</span><span>   "docs-rs/trait-tags.html",
</span><span> ]
</span><span> all-features = true
</span><span style=color:#f07171>-cargo-args = ["-Zunstable-options", "-Zrustdoc-scrape-examples"]
</span><span> 
</span><span> [[example]]
</span><span> name = "monitor_info"
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22142.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>