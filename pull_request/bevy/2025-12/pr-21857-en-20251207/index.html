<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21857 Add `Observer::with_components`
        
    </title><meta content="#21857 Add `Observer::with_components`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21857-zh-cn-20251207>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add <code>Observer::with_components</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21857<li><strong>Author</strong>: Shatur<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Usability, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-11-16T10:47:48Z<li><strong>Merged</strong>: 2025-12-07T23:15:48Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><ul><li>Closes #21848.</ul><p><strong>Solution</strong><ul><li>Add <code>Observer::with_components</code>, for consistency with <code>Observer::with_entities</code> for entities.</ul><p><strong>Testing</strong><ul><li>I didn’t test it, but it’s a very simple helper function, similar to already existing <code>Observer::with_component</code> (singular).</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a minor API inconsistency in Bevy’s ECS observer system. Observers in Bevy allow systems to react to specific events, and they can be configured to trigger based on various criteria, including which components are involved in the event.<p>The existing observer API provided a <code>with_component</code> method for observing a single component, but only had <code>with_entities</code> (plural) for observing multiple entities. There was no corresponding plural method for components, which created an asymmetry in the API. When developers needed to observe multiple components, they had to chain multiple <code>with_component</code> calls, which was less ergonomic than having a dedicated plural method.<p>The implementation follows a straightforward pattern. The <code>Observer</code> struct maintains a <code>descriptor</code> field that contains various trigger criteria. The <code>components</code> field within this descriptor is a collection of <code>ComponentId</code>s. The new <code>with_components</code> method accepts an iterator of <code>ComponentId</code>s and extends this collection, similar to how <code>with_entities</code> works.<p>This is a small quality-of-life improvement that enhances API consistency. It doesn’t introduce new functionality but provides a more convenient way to express intent when observers need to monitor multiple components. The implementation is minimal and low-risk, following established patterns in the codebase.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Observer] --> B[ObserverDescriptor]
</span><span>    B --> C[components: Vec&LTComponentId>]
</span><span>    D[with_components] --> C
</span><span>    E[with_component] --> C
</span><span>    F[with_entities] --> G[entities: Vec&LTEntity>]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: crates/bevy_ecs/src/observer/distributed_storage.rs</strong> This file contains the <code>Observer</code> struct definition and its builder methods. The change adds a new method <code>with_components</code> that allows adding multiple component IDs to the observer’s trigger criteria.<p><strong>Before:</strong> The file had methods for adding single components (<code>with_component</code>) and multiple entities (<code>with_entities</code>), but no method for adding multiple components.<p><strong>After:</strong> Added the <code>with_components</code> method:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// Observes the given `components`. This will cause the [`Observer`] to run whenever the [`Event`] has
</span><span style=color:#abb0b6;font-style:italic>/// an [`EntityComponentsTrigger`](crate::event::EntityComponentsTrigger) that targets any of the `components`.
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>with_components</span><span>&LTI</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>IntoIterator</span><span>&LTItem = ComponentId>>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>:</span><span> I) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>descriptor</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>extend</span><span>(components)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self
</span><span>}
</span></code></pre><p>The method follows the same pattern as <code>with_entities</code>:<ul><li>Takes an iterator of <code>ComponentId</code>s<li>Extends the internal <code>components</code> collection<li>Returns <code>self</code> for method chaining</ul><p>This change provides symmetry with the existing <code>with_entities</code> method and improves ergonomics when setting up observers that need to monitor multiple components.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Observer Documentation</strong>: For understanding the observer pattern in Bevy’s ECS<li><strong>Bevy Events System</strong>: To understand how events and observers work together<li><strong>Iterator Pattern in Rust</strong>: For understanding the <code>IntoIterator</code> trait used in the method signature<li><strong>Builder Pattern</strong>: This PR follows the builder pattern common in Bevy’s API design</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21857.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>