<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22216 Add wayland to `flake.nix` linux dependencies example
        
    </title><meta content="#22216 Add wayland to `flake.nix` linux dependencies example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22216-zh-cn-20251222>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add wayland to <code>flake.nix</code> linux dependencies example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22216<li><strong>Author</strong>: apekros<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, O-Linux<li><strong>Created</strong>: 2025-12-21T05:55:12Z<li><strong>Merged</strong>: 2025-12-22T01:31:23Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #22215<h2 id=solution>Solution</h2><ul><li>Adds wayland to <code>flake.nix</code> example in the Linux dependencies documentation</ul><h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? Use the main branch <code>flake.nix</code> and run <code>cargo build</code> and it gives: <code>error: failed to run custom build command for wayland-sys v0.31.7</code> With this change it does compile successfully</ul><hr><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a straightforward but important documentation issue affecting Linux developers using Nix for their development environment. The problem was discovered when a developer attempted to build Bevy using the provided <code>flake.nix</code> configuration from the main branch and encountered a compilation failure related to missing Wayland dependencies.<p>The issue manifested as a build error when running <code>cargo build</code> with the existing <code>flake.nix</code> configuration. The error message indicated that the <code>wayland-sys</code> crate version 0.31.7 failed to run its custom build command, which is a clear signal that the necessary Wayland development libraries were not available in the Nix environment. This is a common problem when documentation examples don’t include all required dependencies, particularly for cross-platform development where different display server protocols like Wayland and X11 require different libraries.<p>The solution is minimal and direct: add the <code>wayland</code> package to the list of build inputs in the <code>flake.nix</code> example. This change ensures that developers using Nix on Linux systems with Wayland as their display server protocol have all necessary dependencies available. The fix is pragmatic - rather than investigating complex workarounds or conditional dependencies, the approach correctly identifies that Wayland support is a standard requirement for modern Linux graphics applications and should be included by default in the development environment setup.<p>From an implementation perspective, the change fits cleanly into the existing pattern. The <code>flake.nix</code> file already lists several graphics and windowing dependencies including <code>libxkbcommon</code>, <code>xorg.libX11</code>, and others. Adding <code>wayland</code> to this list maintains consistency and completeness. The placement after <code>libxkbcommon</code> follows logical grouping since both are related to input handling and window system integration.<p>This fix highlights an important aspect of cross-platform game engine development: documentation for platform-specific dependencies must be accurate and complete. Even small omissions like this can create significant friction for developers trying to set up their environment. The fact that the error occurred during the build process for <code>wayland-sys</code> (a system-scanning build script) rather than at link time underscores how certain Rust crates dynamically detect and bind to system libraries.<p>The impact of this change is immediate and practical. Developers using Nix on Wayland-based Linux distributions (which are increasingly common, especially with modern desktop environments like GNOME and KDE Plasma) will now have a working development environment out of the box. This reduces setup time and eliminates a common point of confusion for new contributors.<p>From a technical perspective, it’s worth noting that Wayland is a display server protocol that has been gaining adoption as a modern replacement for X11. Including it as a dependency reflects Bevy’s commitment to supporting contemporary Linux graphics infrastructure. The <code>wayland</code> package in Nix provides both the client libraries and development headers needed to compile applications that use Wayland, which the <code>wayland-sys</code> Rust crate relies on during its build process.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Developer runs cargo build] --> B{Uses flake.nix from docs}
</span><span>    B --> C[Without wayland dependency]
</span><span>    B --> D[With wayland dependency]
</span><span>    C --> E[Build fails: wayland-sys error]
</span><span>    D --> F[Build succeeds]
</span><span>    
</span><span>    G[docs/linux_dependencies.md] --> H[flake.nix example]
</span><span>    H --> I[Build inputs list]
</span><span>    I --> J[Added wayland package]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=docs-linux-dependencies-md><code>docs/linux_dependencies.md</code></h3><p>This file contains documentation for setting up Linux dependencies for Bevy development. The change adds the <code>wayland</code> package to the example Nix flake configuration, ensuring developers have all necessary dependencies for building Bevy on Wayland-based Linux systems.<p><strong>Change:</strong><pre class=language-nix data-lang=nix style=color:#61676c;background-color:#fafafa><code class=language-nix data-lang=nix><span style=color:#abb0b6;font-style:italic># File: docs/linux_dependencies.md
</span><span style=color:#abb0b6;font-style:italic># Before:
</span><span>              </span><span style=color:#f51818>];
</span><span>              </span><span style=color:#ff8f40>packages </span><span style=color:#f51818>= with </span><span style=color:#ff8f40>pkgs</span><span style=color:#f51818>; </span><span>[
</span><span>                </span><span style=color:#ff8f40>udev
</span><span>                </span><span style=color:#ff8f40>alsa-lib
</span><span>                </span><span style=color:#ff8f40>vulkan-loader
</span><span>                </span><span style=color:#ff8f40>libxkbcommon
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libX11
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libXcursor
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libXi
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libXrandr
</span><span>                </span><span style=color:#ff8f40>libxkbcommon
</span><span>              ]</span><span style=color:#f51818>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>              </span><span style=color:#f51818>];
</span><span>              </span><span style=color:#ff8f40>packages </span><span style=color:#f51818>= with </span><span style=color:#ff8f40>pkgs</span><span style=color:#f51818>; </span><span>[
</span><span>                </span><span style=color:#ff8f40>udev
</span><span>                </span><span style=color:#ff8f40>alsa-lib
</span><span>                </span><span style=color:#ff8f40>vulkan-loader
</span><span>                </span><span style=color:#ff8f40>libxkbcommon
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libX11
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libXcursor
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libXi
</span><span>                </span><span style=color:#ff8f40>xorg</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>libXrandr
</span><span>                </span><span style=color:#ff8f40>libxkbcommon
</span><span>                </span><span style=color:#ff8f40>wayland
</span><span>              ]</span><span style=color:#f51818>;
</span></code></pre><p>The addition of <code>wayland</code> to the packages list ensures that the Nix development environment includes Wayland client libraries and development headers, which are required by the <code>wayland-sys</code> crate during compilation.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://wayland.freedesktop.org/docs/html/ target=_blank>Wayland Protocol Documentation</a> - Official documentation for the Wayland display server protocol<li><a rel="noopener nofollow noreferrer" href=https://nixos.org/guides/nix-pills/ target=_blank>Nix Package Manager</a> - Comprehensive guide to Nix and NixOS<li><a rel="noopener nofollow noreferrer" href=https://nixos.org/guides/rust/ target=_blank>Rust and Nix Integration</a> - Best practices for Rust development with Nix<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/linux_dependencies.md target=_blank>Bevy Linux Dependencies</a> - Complete Linux dependency documentation for Bevy<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/wayland-sys/latest/wayland_sys/ target=_blank>Wayland-sys Crate Documentation</a> - Documentation for the Rust bindings to Wayland system libraries</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22216.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>