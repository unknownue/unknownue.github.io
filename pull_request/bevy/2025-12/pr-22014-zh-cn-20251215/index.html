<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22014 Doc trivial ecs unsafe
        
    </title><meta content="#22014 Doc trivial ecs unsafe" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-15</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-12/pr-22014-en-20251215>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><p>Doc trivial ecs unsafe<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Doc trivial ecs unsafe<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22014<li><strong>Author</strong>: hymm<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-ECS, S-Ready-For-Final-Review, D-Straightforward, D-Unsafe<li><strong>Created</strong>: 2025-12-02T23:36:48Z<li><strong>Merged</strong>: 2025-12-15T02:40:43Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>尝试为ecs crate中的大多数unsafe代码添加文档，以便我们可以开启<code>unsafe_op_in_unsafe_fn</code>检查。</ul><h2 id=solution>Solution</h2><ul><li>不幸的是，如果尝试在一个PR中审查所有unsafe文档，这不会是一件简单的事情。开启这个lint时会生成400多个警告。因此我们需要尽可能将其分解，因为在某些情况下审查安全契约并不容易。<li>这个PR包含两种类型的unsafe块。 <ol><li>已经包含安全注释但缺少<code>unsafe {}</code>块的代码块。<li>安全契约与其unsafe父函数相同且非常简短的unsafe函数。（通常只是对函数的调用）。</ol></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这是一个关于代码库现代化和提升安全性的技术故事。Bevy团队正在逐步改进他们的ECS（Entity Component System）模块，其中一个重要步骤是启用Rust的<code>unsafe_op_in_unsafe_fn</code> lint。这个lint要求在每个unsafe函数内部明确标记哪些操作是unsafe的，这有助于提高代码的可读性和安全性。<p>问题的核心在于Bevy的ECS模块中有大量的unsafe代码——总共有超过400个相关的lint警告。试图在一个PR中一次性修复所有这些警告是不可行的，因为每个unsafe块都需要仔细审查其安全契约（safety contract）。安全契约指的是调用者必须满足的条件，以确保unsafe代码能够正确且安全地执行。<p>开发者hymm采用了一个分而治之的策略。这个PR只处理两种相对简单的情况：<ol><li>那些已经有安全注释但缺少显式<code>unsafe {}</code>块的代码<li>安全契约与父函数相同且非常简短的unsafe函数</ol><p>这种方法的明智之处在于它降低了审查复杂度。处理简单的案例后，剩下的复杂案例可以在后续的PR中单独处理，每批都更容易审查。<p>让我们看一个具体的例子。在<code>crates/bevy_ecs/src/bundle/impls.rs</code>中，有一个处理bundle的宏。修改前是这样的：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// SAFETY: Caller ensures requirements for calling `get_components` are met.
</span><span style=color:#ed9366>$</span><span>( $name</span><span style=color:#ed9366>::</span><span>get_components($alias</span><span style=color:#61676ccc>,</span><span> func)</span><span style=color:#61676ccc>; </span><span>)</span><span style=color:#ed9366>*
</span></code></pre><p>修改后变成了：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>allow</span><span>(
</span><span>    unused_unsafe</span><span style=color:#61676ccc>,
</span><span>    reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Zero-length tuples will generate a function body equivalatent to (); however, this macro is meant for all applicable tuples, and as such it makes no sense to rewrite it just for that case."
</span><span>)]
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: Caller ensures requirements for calling `get_components` are met.
</span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    </span><span style=color:#ed9366>$</span><span>( $name</span><span style=color:#ed9366>::</span><span>get_components($alias</span><span style=color:#61676ccc>,</span><span> func)</span><span style=color:#61676ccc>; </span><span>)</span><span style=color:#ed9366>*
</span><span>}
</span></code></pre><p>这里有几个关键点：<ol><li>添加了明确的<code>unsafe {}</code>块来包裹unsafe操作<li>保留了原有的安全注释，说明调用者必须满足的条件<li>添加了<code>#[allow(unused_unsafe)]</code>属性，因为对于零元组（zero-length tuple）这种特殊情况，生成的函数体相当于<code>();</code>，但重写宏只为了处理这种情况是不合理的</ol><p>另一种常见的模式出现在系统参数（system param）的处理中。以<code>crates/bevy_ecs/src/system/system_param.rs</code>中的变化为例：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span>T</span><span style=color:#ed9366>::</span><span>validate_param(state</span><span style=color:#61676ccc>,</span><span> system_meta</span><span style=color:#61676ccc>,</span><span> world)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>ok</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|()| T</span><span style=color:#ed9366>::</span><span>get_param(state</span><span style=color:#61676ccc>,</span><span> system_meta</span><span style=color:#61676ccc>,</span><span> world</span><span style=color:#61676ccc>,</span><span> change_tick))
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    T</span><span style=color:#ed9366>::</span><span>validate_param(state</span><span style=color:#61676ccc>,</span><span> system_meta</span><span style=color:#61676ccc>,</span><span> world)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>ok</span><span>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|()| T</span><span style=color:#ed9366>::</span><span>get_param(state</span><span style=color:#61676ccc>,</span><span> system_meta</span><span style=color:#61676ccc>,</span><span> world</span><span style=color:#61676ccc>,</span><span> change_tick))
</span><span>}
</span></code></pre><p>这里的安全契约是“由调用者保证“（Upheld by caller），这意味着调用<code>Option&LTT></code>作为系统参数的代码必须确保所有安全条件都已满足。通过将整个操作包裹在<code>unsafe {}</code>块中，代码现在明确标记了哪些操作依赖于外部安全保证。<p>这种模式在查询（query）系统的代码中也很明显。在<code>crates/bevy_ecs/src/query/state.rs</code>中：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>query_unchecked</span><span>(world)</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_inner</span><span>(entity)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: Upheld by caller
</span><span style=color:#fa6e32>unsafe </span><span>{ </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>query_unchecked</span><span>(world) }</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_inner</span><span>(entity)
</span></code></pre><p>这里的变化不仅添加了<code>unsafe {}</code>块，还添加了一个明确的安全注释，说明安全条件“由调用者保证“。这清楚地传达了责任边界：<code>query_unchecked</code>的调用者必须确保访问模式是安全的。<p>这个PR的技术影响是直接而实际的。通过逐步添加这些明确的unsafe块：<ol><li>代码变得更加清晰——unsafe操作的边界更加明确<li>安全注释与unsafe块的对应关系更加明显<li>为后续启用<code>unsafe_op_in_unsafe_fn</code> lint铺平了道路<li>为审查更复杂的unsafe案例建立了模式</ol><p>从工程角度看，这种渐进式的方法展示了处理大型代码库重构的良好实践：从小处着手，建立模式，然后逐步扩展。每次更改都相对简单且自包含，这使得代码审查更加高效和安全。<p>值得注意的是，这个PR还处理了一些边缘情况。例如，对于零元组的特殊情况，开发者选择了添加<code>#[allow(unused_unsafe)]</code>属性而不是重写整个宏。这反映了实用的工程决策：在某些情况下，完美的解决方案可能过于复杂，而一个清晰的解释和适当的属性可能是更好的选择。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[unsafe操作调用] --> B{已有安全注释?}
</span><span>    B -->|是| C[添加unsafe块]
</span><span>    B -->|否| D[保留原状]
</span><span>    C --> E[安全契约明确]
</span><span>    D --> F[后续处理]
</span><span>    E --> G[启用unsafe_op_in_unsafe_fn]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-system-system-param-rs-51-19><code>crates/bevy_ecs/src/system/system_param.rs</code> (+51/-19)</h3><p>这个文件包含系统参数的核心实现。修改主要集中在为已经包含安全注释的unsafe操作添加明确的<code>unsafe {}</code>块。这些修改确保了每个unsafe操作都被正确标记。<p><strong>关键修改示例：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Option&LTT>作为系统参数的实现
</span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>validate_param</span><span>(
</span><span>    </span><span style=color:#ff8f40>state</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut Self</span><span style=color:#ed9366>::</span><span>State,
</span><span>    </span><span style=color:#ff8f40>system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>SystemMeta,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>:</span><span> UnsafeWorldCell,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), SystemParamValidationError> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: Upheld by caller
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        T</span><span style=color:#ed9366>::</span><span>validate_param(state</span><span style=color:#61676ccc>,</span><span> system_meta</span><span style=color:#61676ccc>,</span><span> world)
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-world-entity-access-world-mut-rs-20-11><code>crates/bevy_ecs/src/world/entity_access/world_mut.rs</code> (+20/-11)</h3><p>这个文件处理实体访问和修改。修改主要围绕实体组件访问方法，确保unsafe操作被正确包裹。<p><strong>关键修改示例：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>into_mut_assume_mutable_by_id</span><span>&LTF</span><span style=color:#61676ccc>:</span><span> DynamicComponentFetch>(
</span><span>    </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>component_ids</span><span style=color:#61676ccc>:</span><span> F,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>F</span><span style=color:#ed9366>::</span><span>Mut<'</span><span style=color:#ed9366>_</span><span>>, EntityComponentError> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: Upheld by caller
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_mutable</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>into_mut_assume_mutable_by_id</span><span>(component_ids)
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-system-commands-mod-rs-17-11><code>crates/bevy_ecs/src/system/commands/mod.rs</code> (+17/-11)</h3><p>这个文件处理命令系统。修改确保命令系统的unsafe操作被正确标记，特别是在命令队列和分配器的处理中。<p><strong>关键修改示例：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>validate_param</span><span>(
</span><span>    </span><span style=color:#ff8f40>state</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut Self</span><span style=color:#ed9366>::</span><span>State,
</span><span>    </span><span style=color:#ff8f40>system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>SystemMeta,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>:</span><span> UnsafeWorldCell,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), SystemParamValidationError> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: Upheld by caller
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#ed9366><</span><span>__StructFieldsAlias </span><span style=color:#ed9366>as </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>system</span><span style=color:#ed9366>::</span><span>SystemParam</span><span style=color:#ed9366>>::</span><span>validate_param(
</span><span>            </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> state</span><span style=color:#ed9366>.</span><span>state</span><span style=color:#61676ccc>,
</span><span>            system_meta</span><span style=color:#61676ccc>,
</span><span>            world</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-component-required-rs-13-10><code>crates/bevy_ecs/src/component/required.rs</code> (+13/-10)</h3><p>这个文件处理组件间的依赖关系。修改主要围绕组件注册和依赖关系重建的unsafe操作。<p><strong>关键修改示例：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// SAFETY: the caller guarantees that `requiree` is valid in `self`.
</span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>required_components_scope</span><span>(requiree</span><span style=color:#61676ccc>, </span><span>|</span><span style=color:#ff8f40>this</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>required_components</span><span>| {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// SAFETY: the caller guarantees that `required` is valid for type `R` in `self`
</span><span>        required_components</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_by_id</span><span>(required</span><span style=color:#61676ccc>,</span><span> this</span><span style=color:#61676ccc>,</span><span> constructor)</span><span style=color:#61676ccc>;
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-bundle-impls-rs-14-2><code>crates/bevy_ecs/src/bundle/impls.rs</code> (+14/-2)</h3><p>这个文件包含bundle的实现宏。修改确保bundle操作的unsafe调用被正确包裹。<p><strong>关键修改示例：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>allow</span><span>(
</span><span>    unused_unsafe</span><span style=color:#61676ccc>,
</span><span>    reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Zero-length tuples will generate a function body equivalent to `()`; however, this macro is meant for all applicable tuples, and as such it makes no sense to rewrite it just for that case."
</span><span>)]
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: Caller ensures requirements for calling `apply_effect` are met.
</span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    </span><span style=color:#ed9366>$</span><span>( $name</span><span style=color:#ed9366>::</span><span>apply_effect($alias</span><span style=color:#61676ccc>,</span><span> entity)</span><span style=color:#61676ccc>; </span><span>)</span><span style=color:#ed9366>*
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust Unsafe Code Guidelines</strong>: https://rust-lang.github.io/unsafe-code-guidelines/<li><strong>The Rustonomicon</strong>: https://doc.rust-lang.org/nomicon/ - Rust不安全代码的权威指南<li><strong>Bevy ECS Documentation</strong>: https://bevyengine.org/learn/ecs-intro/ - Bevy ECS系统概述<li><strong>unsafe_op_in_unsafe_fn lint</strong>: https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#unsafe-op-in-unsafe-fn - Rust lint的官方文档<li><strong>Rust Safety Patterns</strong>: https://github.com/rust-unofficial/patterns - Rust设计模式和安全实践</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22014.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>