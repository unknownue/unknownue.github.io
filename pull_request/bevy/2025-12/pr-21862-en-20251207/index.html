<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21862 Slightly improve the window settings example
        
    </title><meta content="#21862 Slightly improve the window settings example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21862-zh-cn-20251207>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Slightly improve the window settings example<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Slightly improve the window settings example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21862<li><strong>Author</strong>: rmsthebest<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Examples, A-Windowing, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-11-16T19:49:19Z<li><strong>Merged</strong>: 2025-12-07T23:26:10Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Update the example to avoid teaching new people that the recommended way of updating a component is to re-insert it.<h2 id=solution>Solution</h2><p>Instead of inserting the component every time we want to change it, update the value.<h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? Yes, ran the example<li>Are there any parts that need more testing? I don’t think so?<li>How can other people (reviewers) test your changes? Is there anything specific they need to know? Run the example, press left and right mouse.<li>If relevant, what platforms did you test these changes on, and are there any important ones you can’t test? (linux/wayland)</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a minor but important issue in Bevy’s window settings example code. The problem was pedagogical: the example was demonstrating an inefficient and non-idiomatic way to update component values. Specifically, it was using a re-insertion pattern where components were completely removed and re-added each time they needed to be modified, rather than directly updating their values.<p>The context here is that examples in a framework like Bevy serve dual purposes. They demonstrate functionality, but they also teach best practices to new users who study them. When an example uses non-optimal patterns, it risks teaching those patterns to developers who might assume “this is how the framework intends it to be done.” In this case, the <code>cycle_cursor_icon</code> system was teaching the wrong approach to component updates.<p>The solution approach was straightforward: replace the re-insertion pattern with direct mutation. Instead of using <code>commands.entity(*window).insert(cursor_icons.0[*index].clone())</code> on every mouse click, the system now takes a mutable reference to the <code>CursorIcon</code> component and updates it directly: <code>**cursor = cursor_icons.0[*index].clone()</code>. This approach is more efficient because it doesn’t trigger unnecessary component removal and addition events, and it’s more idiomatic in the ECS paradigm where direct mutation of existing components is preferred when possible.<p>An important technical insight from this implementation is the change in system parameters. The original system used <code>mut commands: Commands</code> and <code>window: Single&LTEntity, With&LTWindow>></code> to get the window entity ID and then issue commands to modify it. The new approach uses <code>mut cursor: Single<&mut CursorIcon></code> to get direct mutable access to the component. This change illustrates a key principle in ECS design: when you have direct access to a component and only need to modify its value (not its presence or type), direct mutation is cleaner and more performant than command-based approaches.<p>The implementation also required a change to the initialization system. Since the <code>CursorIcon</code> component wasn’t initially present on the window entity (the default window doesn’t have a cursor icon set), the <code>init_cursor_icons</code> system now adds it during initialization. This ensures the <code>cycle_cursor_icon</code> system can query for it as a mutable reference later. The system signature changed to include <code>window: Single&LTEntity, With&LTWindow>></code> so it can access the window entity and insert the initial cursor icon.<p>Two minor documentation improvements were also made: converting a regular comment to a doc comment for the <code>toggle_theme</code> system, and adding a doc comment for the <code>CursorIcons</code> resource. These improve the example’s self-documentation.<p>The impact of these changes is primarily educational. The example now teaches the correct way to update component values in Bevy. For performance, the difference is negligible in this specific case, but the pattern matters more for complex systems where unnecessary re-insertions could have measurable overhead. The changes also make the code cleaner and more aligned with Bevy’s ECS idioms.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[init_cursor_icons System] --> B[Adds CursorIcon component&LTbr>to Window entity]
</span><span>    B --> C[Creates CursorIcons resource]
</span><span>    C --> D[cycle_cursor_icon System]
</span><span>    D --> E[Directly mutates&LTbr>CursorIcon component]
</span><span>    F[Mouse Click Events] --> D
</span><span>    
</span><span>    style B fill:#e1f5e1
</span><span>    style E fill:#e1f5e1
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-window-window-settings-rs-11-11><code>examples/window/window_settings.rs</code> (+11/-11)</h3><p>This file contains the window settings example that demonstrates various window configuration options. The changes refactor how cursor icons are updated to use direct component mutation instead of re-insertion.<p><strong>Key changes:</strong><ol><li><strong>Documentation improvements:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>// This system will toggle the color theme used by the window
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// This system will toggle the color theme used by the window
</span></code></pre><ol start=2><li><strong>Resource documentation added:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added doc comment:
</span><span style=color:#abb0b6;font-style:italic>/// Resource with a set of cursor icons we want to cycle through
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>CursorIcons</span><span>(</span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTCursorIcon>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Initialization system updated to add CursorIcon component:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_cursor_icons</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    #[cfg(</span><span style=color:#ff8f40>feature</span><span> = "</span><span style=color:#ff8f40>custom_cursor</span><span>")] </span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>,
</span><span>) {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(CursorIcons(</span><span style=color:#f07171>vec!</span><span>[
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... cursor icons
</span><span>    ]))</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_cursor_icons</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>window</span><span style=color:#61676ccc>: </span><span>Single&LTEntity, With&LTWindow>>,
</span><span>    #[cfg(</span><span style=color:#ff8f40>feature</span><span> = "</span><span style=color:#ff8f40>custom_cursor</span><span>")] </span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> cursor_icons </span><span style=color:#ed9366>=</span><span> CursorIcons(</span><span style=color:#f07171>vec!</span><span>[
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... cursor icons
</span><span>    ])</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// By default the Window entity does not have a CursorIcon component, so we add it here.
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(</span><span style=color:#ed9366>*</span><span>window)</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>[</span><span style=color:#ff8f40>0</span><span>]</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(cursor_icons)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=4><li><strong>Cursor cycling system refactored to use direct mutation:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>cycle_cursor_icon</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>window</span><span style=color:#61676ccc>: </span><span>Single&LTEntity, With&LTWindow>>,
</span><span>    </span><span style=color:#ff8f40>input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTMouseButton>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>index</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>,
</span><span>    </span><span style=color:#ff8f40>cursor_icons</span><span style=color:#61676ccc>: </span><span>Res&LTCursorIcons>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(MouseButton</span><span style=color:#ed9366>::</span><span>Left) {
</span><span>        </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>+ </span><span style=color:#ff8f40>1</span><span>) </span><span style=color:#ed9366>%</span><span> cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>len</span><span>()</span><span style=color:#61676ccc>;
</span><span>        commands
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(</span><span style=color:#ed9366>*</span><span>window)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>[</span><span style=color:#ed9366>*</span><span>index]</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>    } </span><span style=color:#fa6e32>else if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(MouseButton</span><span style=color:#ed9366>::</span><span>Right) {
</span><span>        </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>== </span><span style=color:#ff8f40>0 </span><span>{
</span><span>            cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>len</span><span>() </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1
</span><span>        }</span><span style=color:#61676ccc>;
</span><span>        commands
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(</span><span style=color:#ed9366>*</span><span>window)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>[</span><span style=color:#ed9366>*</span><span>index]</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>cycle_cursor_icon</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>cursor</span><span style=color:#61676ccc>: </span><span>Single<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> CursorIcon>,
</span><span>    </span><span style=color:#ff8f40>input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTMouseButton>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>index</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>,
</span><span>    </span><span style=color:#ff8f40>cursor_icons</span><span style=color:#61676ccc>: </span><span>Res&LTCursorIcons>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(MouseButton</span><span style=color:#ed9366>::</span><span>Left) {
</span><span>        </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>+ </span><span style=color:#ff8f40>1</span><span>) </span><span style=color:#ed9366>%</span><span> cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>len</span><span>()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#ed9366>**</span><span>cursor </span><span style=color:#ed9366>=</span><span> cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>[</span><span style=color:#ed9366>*</span><span>index]</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>;
</span><span>    } </span><span style=color:#fa6e32>else if</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>just_pressed</span><span>(MouseButton</span><span style=color:#ed9366>::</span><span>Right) {
</span><span>        </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>== </span><span style=color:#ff8f40>0 </span><span>{
</span><span>            cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>len</span><span>() </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=color:#ed9366>*</span><span>index </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1
</span><span>        }</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#ed9366>**</span><span>cursor </span><span style=color:#ed9366>=</span><span> cursor_icons</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>[</span><span style=color:#ed9366>*</span><span>index]</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy ECS Components Documentation</strong>: For understanding how to work with components in Bevy’s ECS system<li><strong>Bevy Commands vs Direct Access</strong>: Documentation on when to use <code>Commands</code> versus direct component access<li><strong>Entity Component System Patterns</strong>: General ECS patterns and best practices<li><strong>Bevy Window API</strong>: Documentation on window management and configuration in Bevy<li><strong>Rust Ownership and Borrowing</strong>: Understanding mutable references and the double dereference (<code>**cursor</code>) pattern used in the updated code</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21862.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>