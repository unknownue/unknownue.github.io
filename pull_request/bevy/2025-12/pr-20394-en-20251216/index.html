<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20394 Alternative glTF coordinate conversion
        
    </title><meta content="#20394 Alternative glTF coordinate conversion" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-20394-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Alternative glTF coordinate conversion<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20394<li><strong>Author</strong>: greeble-dev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, S-Ready-For-Review, M-Migration-Guide, X-Blessed, A-glTF<li><strong>Created</strong>: 2025-08-03T11:58:31Z<li><strong>Merged</strong>: 2025-12-16T00:58:04Z<li><strong>Merged By</strong>: cart</ul><h2 id=description>Description</h2><h3 id=objective>Objective</h3><p>Change glTF coordinate conversion to satisfy some common use cases while dodging the more controversial aspects. This fixes #20621, but at the cost of removing one feature.<h3 id=summary>Summary</h3><p>The Bevy glTF loader can optionally convert nodes and meshes from glTF’s “+Z forward” semantics to Bevy’s “-Z forward”. But the current implementation <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/20621 target=_blank>has issues</a>, particularly with cameras and lights. It might also cause problems for users who want to re-orient the scene as a whole while preserving the original node semantics.<p>This PR replaces node conversion with a simpler correction to the scene root and mesh entities. The new approach satisfies many use cases and fixes the issues with cameras and lights. But it could be a regression for some users.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The glTF format uses different coordinate system semantics than Bevy. glTF’s standard specifies “+Z forward, +Y up, right-handed”, while Bevy uses “-Z forward, +Y up, right-handed”. This mismatch creates a practical problem: when loading glTF assets into Bevy, objects face the wrong direction unless some conversion happens.<p>In Bevy 0.17, a solution was introduced via the <code>use_model_forward_direction</code> flag. When enabled, this would convert node transforms and mesh data from glTF’s +Z forward to Bevy’s -Z forward. The implementation worked by applying coordinate transformations to individual nodes in the hierarchy. However, this approach had several technical problems documented in issue #20621.<p>The core issue was that glTF cameras and lights already use -Z forward, matching Bevy’s convention. When the conversion was applied to nodes, it would incorrectly rotate camera and light nodes, breaking their expected behavior. Additionally, the conversion logic became complex when dealing with animation tracks, child nodes of cameras/lights, and the rare case where a node could be both a mesh and a camera/light.<p>The developer faced a choice: either fix the complex node conversion logic with special cases for cameras and lights, or take a different architectural approach. They chose the latter, recognizing that most users simply want the overall scene to face the correct direction, not necessarily individual node transforms.<p>The solution was to move the conversion higher up in the hierarchy. Instead of converting every node, the PR applies corrective transforms at two strategic points:<ol><li><strong>Scene root entity</strong>: A rotation applied to the parent of all glTF root nodes<li><strong>Mesh primitive entities</strong>: A rotation applied to individual mesh instances</ol><p>This approach maintains the visual orientation while avoiding the complexity of node-by-node conversion. The mathematical transformation remains the same: a 180-degree rotation around the Y axis (represented by the quaternion <code>Quat::from_xyzw(0.0, 1.0, 0.0, 0.0)</code>), which converts +Z forward to -Z forward.<p>The implementation splits the previous single boolean flag into two separate options: <code>rotate_scene_entity</code> for scene conversion and <code>rotate_meshes</code> for mesh conversion. This provides users with more granular control. For example, someone might want scene orientation corrected but keep mesh assets in their original format, or vice versa.<p>One important technical detail is that the conversion is applied differently to different components:<ul><li><strong>Scene conversion</strong>: Affects the scene root entity only, which indirectly affects all child nodes through transform inheritance<li><strong>Mesh conversion</strong>: Affects both the mesh asset data and the transform of mesh primitive entities</ul><p>The change required updating how skinning works. For skinned meshes, the inverse bind matrices need to be multiplied by the conversion matrix to maintain proper skin deformation when mesh conversion is enabled. The PR handles this by applying the conversion matrix to the bind matrices during skin loading.<p>While this approach fixes camera and light issues and simplifies the code, it does remove node conversion as a feature. Users who relied on individual node transforms being converted to Bevy semantics will see different behavior. The migration guide addresses this by recommending that users enable both scene and mesh conversion for behavior closest to the previous version.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph "Before PR"
</span><span>        A[User Entity with SceneRoot] --> B[Scene Root Entity]
</span><span>        B --> C[glTF Root Node Entity]
</span><span>        C --> D[glTF Intermediate Node Entities]
</span><span>        D --> E[glTF Mesh Node Entity]
</span><span>        E --> F[Mesh Primitive Entities]
</span><span>        
</span><span>        style C stroke:#f66
</span><span>        style D stroke:#f66
</span><span>        style E stroke:#f66
</span><span>    end
</span><span>    
</span><span>    subgraph "After PR"
</span><span>        A2[User Entity with SceneRoot] --> B2[Scene Root Entity]
</span><span>        B2 --> C2[glTF Root Node Entity]
</span><span>        C2 --> D2[glTF Intermediate Node Entities]
</span><span>        D2 --> E2[glTF Mesh Node Entity]
</span><span>        E2 --> F2[Mesh Primitive Entities]
</span><span>        
</span><span>        style B2 stroke:#6f6
</span><span>        style F2 stroke:#6f6
</span><span>    end
</span><span>    
</span><span>    subgraph "Legend"
</span><span>        G[Node Conversion]:::converted
</span><span>        H[Scene/Mesh Correction]:::corrective
</span><span>    end
</span><span>    
</span><span>    classDef converted fill:#fcc
</span><span>    classDef corrective fill:#cfc
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-gltf-src-convert-coordinates-rs-81-46>1. <code>crates/bevy_gltf/src/convert_coordinates.rs</code> (+81/-46)</h3><p>This file was completely restructured. The old conversion traits were removed and replaced with a <code>GltfConvertCoordinates</code> struct that provides separate options for scene and mesh conversion.<p><strong>Key changes:</strong><ul><li>Removed <code>ConvertCoordinates</code> and <code>ConvertCameraCoordinates</code> traits<li>Added <code>GltfConvertCoordinates</code> struct with <code>rotate_scene_entity</code> and <code>rotate_meshes</code> fields<li>Added methods to get conversion transforms for different contexts</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Multiple traits for different conversions
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>trait </span><span style=color:#399ee6>ConvertCoordinates </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>convert_coordinates</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>trait </span><span style=color:#399ee6>ConvertCameraCoordinates </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>convert_camera_coordinates</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Single struct with clear options
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GltfConvertCoordinates </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>rotate_scene_entity</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>rotate_meshes</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>GltfConvertCoordinates </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>scene_conversion_transform</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Transform {
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>rotate_scene_entity {
</span><span>            </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>CONVERSION_TRANSFORM
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            Transform</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>IDENTITY
</span><span>        }
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>mesh_conversion_mat4</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Mat4 {
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>rotate_meshes {
</span><span>            </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>conversion_mat4()
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            Mat4</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>IDENTITY
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-gltf-src-loader-mod-rs-37-67>2. <code>crates/bevy_gltf/src/loader/mod.rs</code> (+37/-67)</h3><p>This file contains the main loader logic changes. The conversion is now applied at the scene root and mesh primitive levels instead of per-node.<p><strong>Key changes:</strong><ul><li>Changed from per-node conversion to scene-level and mesh-level conversion<li>Updated skin loading to apply mesh conversion to inverse bind matrices<li>Removed coordinate conversion from animation tracks</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Applying conversion to each node
</span><span style=color:#fa6e32>let</span><span> transform </span><span style=color:#ed9366>= </span><span style=color:#f07171>node_transform</span><span>(</span><span style=color:#ed9366>&</span><span>node</span><span style=color:#61676ccc>,</span><span> convert_coordinates)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: No node conversion, just scene root conversion
</span><span style=color:#fa6e32>let</span><span> world_root_transform </span><span style=color:#ed9366>=</span><span> convert_coordinates</span><span style=color:#ed9366>.</span><span style=color:#f07171>scene_conversion_transform</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> world_root_id </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((world_root_transform</span><span style=color:#61676ccc>, </span><span>Visibility</span><span style=color:#ed9366>::</span><span>default()))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Mesh entity gets corrective transform
</span><span style=color:#fa6e32>let</span><span> mesh_entity_transform </span><span style=color:#ed9366>=</span><span> convert_coordinates</span><span style=color:#ed9366>.</span><span style=color:#f07171>mesh_conversion_transform_inverse</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> mesh_entity </span><span style=color:#ed9366>=</span><span> parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Mesh3d(load_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_label_handle</span><span>(primitive_label</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>()))</span><span style=color:#61676ccc>,
</span><span>    mesh_entity_transform</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=3-release-content-migration-guides-gltf-coordinate-conversion-md-96-0>3. <code>release-content/migration-guides/gltf-coordinate-conversion.md</code> (+96/-0)</h3><p>This new file provides a comprehensive migration guide explaining:<ul><li>The change from <code>use_model_forward_direction</code> to <code>convert_coordinates</code><li>How to achieve similar behavior with the new options<li>Scenarios where behavior might differ</ul><h3 id=4-crates-bevy-gltf-src-lib-rs-7-17>4. <code>crates/bevy_gltf/src/lib.rs</code> (+7/-17)</h3><p>Updated the plugin configuration to use the new <code>GltfConvertCoordinates</code> struct.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Single boolean flag
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GltfPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>use_model_forward_direction</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Struct with separate options
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GltfPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>convert_coordinates</span><span style=color:#61676ccc>:</span><span> GltfConvertCoordinates,
</span><span>}
</span></code></pre><h3 id=5-crates-bevy-gltf-src-loader-gltf-ext-scene-rs-3-15>5. <code>crates/bevy_gltf/src/loader/gltf_ext/scene.rs</code> (+3/-15)</h3><p>Simplified the <code>node_transform</code> function by removing coordinate conversion logic.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Node transform with conversion parameter
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>node_transform</span><span>(</span><span style=color:#ff8f40>node</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Node, </span><span style=color:#ff8f40>convert_coordinates</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>) </span><span style=color:#61676ccc>-></span><span> Transform {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Complex logic with special cases for cameras/lights
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Simple transform extraction
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>node_transform</span><span>(</span><span style=color:#ff8f40>node</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Node) </span><span style=color:#61676ccc>-></span><span> Transform {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Just extracts the transform without conversion
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html#coordinate-system-and-units target=_blank>glTF Specification - Coordinate System</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/transform/components/struct.Transform.html target=_blank>Bevy Transform Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/20621 target=_blank>Issue #20621: glTF coordinate conversion bugs</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/19633 target=_blank>Original coordinate conversion PR (#19633)</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_20394.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>