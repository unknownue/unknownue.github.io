<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22244 Remove `*_api` feature from `2d` and `3d`
        
    </title><meta content="#22244 Remove `*_api` feature from `2d` and `3d`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22244-zh-cn-20251229>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Remove <code>*_api</code> feature from <code>2d</code> and <code>3d</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22244<li><strong>Author</strong>: Shatur<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Code-Quality, S-Ready-For-Final-Review, A-Cross-Cutting<li><strong>Created</strong>: 2025-12-23T16:55:31Z<li><strong>Merged</strong>: 2025-12-29T05:53:31Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>It’s already enabled by <code>*_bevy_render</code>.</ul><h2 id=solution>Solution</h2><ul><li>Looks like it can be removed. Makes it easier to reason what to re-enable if you’re enable specific subsets.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a straightforward issue of feature flag redundancy in Bevy’s Cargo.toml file. The problem centered around two features, <code>2d_api</code> and <code>3d_api</code>, which were included in the <code>2d</code> and <code>3d</code> feature sets respectively. The developer, Shatur, identified that these features were already implicitly enabled through their corresponding <code>*_bevy_render</code> features. Having them explicitly listed created unnecessary duplication and made the feature dependency graph harder to reason about.<p>The context here involves managing Rust’s feature system in a large project like Bevy. Features allow conditional compilation and can have complex dependencies. When a feature <code>A</code> depends on feature <code>B</code>, and both are included in another feature <code>C</code>, it’s redundant to list both <code>A</code> and <code>B</code> in <code>C</code>’s definition if <code>A</code> already brings in <code>B</code>. This redundancy doesn’t cause functional bugs but creates maintenance overhead and cognitive load for developers trying to understand which features are actually needed.<p>The solution approach was simple and pragmatic: remove the redundant feature declarations. No architectural changes or code modifications were required since this was purely a build system configuration issue. The developer correctly reasoned that if <code>2d_bevy_render</code> already enables <code>2d_api</code>, then explicitly listing <code>2d_api</code> in the <code>2d</code> feature set serves no purpose. The same logic applies to the 3D counterpart.<p>The implementation consisted of a minimal two-line change in the Cargo.toml file, removing the <code>"2d_api"</code> entry from the <code>2d</code> feature array and the <code>"3d_api"</code> entry from the <code>3d</code> feature array. This change demonstrates effective feature management by eliminating redundant declarations and simplifying the feature hierarchy.<p>From a technical perspective, this change has several benefits. First, it reduces the surface area for potential feature-related bugs - fewer explicit dependencies mean fewer places where inconsistencies can be introduced. Second, it makes the feature structure more transparent; developers can now trace dependencies more easily without encountering circular or redundant relationships. Third, it aligns with the principle of DRY (Don’t Repeat Yourself) applied to build configuration.<p>The impact of this change is primarily on developer experience and codebase maintainability. For users enabling specific feature subsets, the simplified dependency graph makes it clearer what actually needs to be re-enabled when working with partial feature sets. This is particularly valuable in large projects where feature combinations can become complex. The change also slightly reduces the cognitive load for new contributors trying to understand Bevy’s feature architecture.<p>This PR serves as a good example of routine code quality maintenance in Rust projects using Cargo’s feature system. It shows how even small, seemingly trivial changes can improve the overall health and clarity of a project’s build configuration.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[2d feature] --> B[2d_bevy_render feature]
</span><span>    B --> C[2d_api feature]
</span><span>    D[3d feature] --> E[3d_bevy_render feature]
</span><span>    E --> F[3d_api feature]
</span><span>    
</span><span>    style A stroke-width:2px
</span><span>    style D stroke-width:2px
</span><span>    style C stroke-dasharray: 5 5
</span><span>    style F stroke-dasharray: 5 5
</span></code></pre><p><em>Solid lines show explicit feature dependencies. Dashed lines show implicit dependencies that were previously explicit but removed in this PR.</em><h2 id=key-files-changed>Key Files Changed</h2><h3 id=cargo-toml-0-2><code>Cargo.toml</code> (+0/-2)</h3><p>This was the only file changed in the PR. The modifications removed redundant feature declarations from the <code>2d</code> and <code>3d</code> feature sets.<p><strong>Before the changes:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>2d </span><span>= [
</span><span>  </span><span style=color:#86b300>"default_app"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_platform"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"2d_api"</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic># This line was removed
</span><span>  </span><span style=color:#86b300>"2d_bevy_render"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"ui"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"scene"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_font"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_winit"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#399ee6>3d </span><span>= [
</span><span>  </span><span style=color:#86b300>"default_app"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_platform"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"3d_api"</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic># This line was removed
</span><span>  </span><span style=color:#86b300>"3d_bevy_render"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"ui"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"scene"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_font"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_winit"</span><span style=color:#61676ccc>,
</span><span>]
</span></code></pre><p><strong>After the changes:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>2d </span><span>= [
</span><span>  </span><span style=color:#86b300>"default_app"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_platform"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"2d_bevy_render"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"ui"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"scene"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_font"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_winit"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#399ee6>3d </span><span>= [
</span><span>  </span><span style=color:#86b300>"default_app"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_platform"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"3d_bevy_render"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"ui"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"scene"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_font"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"default_winit"</span><span style=color:#61676ccc>,
</span><span>]
</span></code></pre><p>The changes are minimal but significant for code quality. By removing the explicit <code>2d_api</code> and <code>3d_api</code> dependencies, the feature definitions become cleaner and more accurate. Since <code>2d_bevy_render</code> already depends on <code>2d_api</code> (and similarly for 3D), listing it explicitly was redundant. This simplification makes it easier for developers to understand the actual dependency structure when working with these features.<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>The Cargo Book - Features Chapter</strong>: https://doc.rust-lang.org/cargo/reference/features.html</p> <ul><li>Official documentation on Rust’s feature system, essential for understanding how features work in Cargo</ul><li><p><strong>Bevy’s Feature Documentation</strong>: https://bevyengine.org/learn/book/getting-started/features/</p> <ul><li>Bevy-specific guidance on using features in the engine</ul><li><p><strong>Rust API Guidelines - Feature Documentation</strong>: https://rust-lang.github.io/api-guidelines/documentation.html#c-feature</p> <ul><li>Best practices for documenting and managing features in Rust crates</ul><li><p><strong>“The Little Book of Rust Macros” - Conditional Compilation</strong>: https://veykril.github.io/tlborm/decl-macros/macros-conditionally-compiling.html</p> <ul><li>Covers how conditional compilation works in Rust, which is closely related to feature flags</ul><li><p><strong>GitHub Issue on Feature Flag Best Practices</strong>: https://github.com/rust-lang/cargo/issues/3494</p> <ul><li>Discussion about feature flag patterns and anti-patterns in the Rust ecosystem</ul></ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/Cargo.toml b/Cargo.toml
</span><span>index 7dda86c8f1418..015e84dce0a39 100644
</span><span style=color:#c594c5>--- a/Cargo.toml
</span><span style=color:#c594c5>+++ b/Cargo.toml
</span><span style=color:#c594c5>@@ -131,7 +131,6 @@ </span><span style=color:#399ee6>default = ["2d", "3d", "ui"]
</span><span> 2d = [
</span><span>   "default_app",
</span><span>   "default_platform",
</span><span style=color:#f07171>-  "2d_api",
</span><span>   "2d_bevy_render",
</span><span>   "ui",
</span><span>   "scene",
</span><span style=color:#c594c5>@@ -143,7 +142,6 @@ </span><span style=color:#399ee6>default = ["2d", "3d", "ui"]
</span><span> 3d = [
</span><span>   "default_app",
</span><span>   "default_platform",
</span><span style=color:#f07171>-  "3d_api",
</span><span>   "3d_bevy_render",
</span><span>   "ui",
</span><span>   "scene",
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22244.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>