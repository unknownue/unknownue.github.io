<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21447 Put input sources for `bevy_input` under features
        
    </title><meta content="#21447 Put input sources for `bevy_input` under features" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-12/pr-21447-en-20251216>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=put-input-sources-for-bevy-input-under-features>Put input sources for <code>bevy_input</code> under features</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Put input sources for <code>bevy_input</code> under features<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21447<li><strong>Author</strong>: Shatur<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Input, C-Usability, S-Ready-For-Final-Review, M-Migration-Guide, X-Contentious, O-Embedded<li><strong>Created</strong>: 2025-10-07T18:04:49Z<li><strong>Merged</strong>: 2025-12-16T20:39:19Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=mu-biao>目标</h1><p><code>bevy_input</code> 提供了各种输入的原语。但在游戏主机上，通常没有触摸屏等功能。在更冷门的平台（如GBA）上，只需要游戏手柄输入。<h2 id=jie-jue-fang-an>解决方案</h2><p>为了避免包含额外的东西，我将每个输入源放在一个特性（feature）下。我没有默认启用它们，以避免在所有包含 <code>bevy_input</code> 的地方都输入：<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#f51818>, features = [
</span><span>    </span><span style=color:#86b300>"std"</span><span style=color:#f51818>,
</span><span>    </span><span style=color:#86b300>"bevy_reflect"</span><span style=color:#f51818>,
</span><span>    </span><span style=color:#86b300>"bevy_ecs/async_executor"</span><span style=color:#f51818>,
</span><span>    </span><span style=color:#86b300>"smol_str"
</span><span style=color:#f51818>]
</span></code></pre><p>相反，我只是在 <code>bevy_window</code> 和 <code>bevy_gilrs</code> 中启用了使用的输入源。这样，当不提供特定输入源硬件支持的crate被使用时，<code>bevy_input</code> 中相应的特性也不会被启用。<p>对于GBA平台，这使 <code>game</code> 示例的二进制大小从1.6M减少到1.4M。<h2 id=kao-lu-de-ti-dai-fang-an>考虑的替代方案</h2><p>我也考虑过这样做：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InputPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>keyboard</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>mouse</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>gamepad</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>touch</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span></code></pre><p>但即使启用LTO，这也不能消除额外的代码，并且可能让用户感到困惑，因为切换这些值可能会导致由于缺少资源而崩溃（当像 <code>bevy_window</code> 这样的crate期望它时）。<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这个 PR 解决了一个在跨平台游戏开发中常见的问题：如何为不同平台只包含必要的输入支持代码。Bevy 引擎被设计为跨平台，从桌面、Web 到嵌入式设备（如 GBA）都能运行。然而，不同的硬件平台支持的输入设备差异很大。例如，游戏主机通常没有触摸屏，而像 GBA 这样的嵌入式设备可能只支持游戏手柄输入。<p>在 PR 实施之前，<code>bevy_input</code> crate 无条件地包含了所有输入源的支持代码：键盘、鼠标、游戏手柄、触摸和手势。这意味着，即使目标平台不支持某些输入类型，相关的代码、资源和系统仍然会被编译进最终二进制文件。这不仅增加了二进制大小，还可能引入不必要的依赖和潜在的错误处理。<p>开发者 Shatur 面临的问题是如何在不破坏现有 API 和用户体验的前提下，优雅地移除未使用的输入代码。他们考虑了两种方案：<ol><li>在 <code>InputPlugin</code> 中增加配置布尔值，让用户在运行时选择启用哪些输入源。<li>使用 Cargo 的特性门控（feature gating）在编译时排除不需要的模块。</ol><p>第一种方案虽然看起来更灵活，但存在明显缺陷。即使通过配置禁用某个输入源，其相关的类型和函数仍然会被编译，因为 Rust 的编译单元是整个 crate，无法基于运行时配置进行条件编译。这无法实现减少二进制大小的目标。此外，如果用户错误地禁用了某个输入源，而其他 crate（如 <code>bevy_window</code>）却依赖它，就会导致运行时资源缺失而崩溃。<p>因此，Shatur 选择了第二种方案：利用 Cargo 的特性系统。这种方案的核心思想是将每个输入源模块（键盘、鼠标、游戏手柄、触摸、手势）分别置于独立的特性标志后面。然后，在高级别的 crate（如 <code>bevy_window</code> 和 <code>bevy_gilrs</code>）中，根据它们实际提供的硬件支持，有选择地启用 <code>bevy_input</code> 的相应特性。<p>这个方案需要修改多个文件。首先，在 <code>bevy_input/Cargo.toml</code> 中定义了五个新的特性：<code>mouse</code>、<code>keyboard</code>、<code>gamepad</code>、<code>touch</code> 和 <code>gestures</code>。这些特性默认不启用，因此用户必须显式选择他们需要的输入源。<p>然后，在 <code>bevy_input/src/lib.rs</code> 中，使用 <code>#[cfg(feature = "...")]</code> 属性来条件编译各个模块的导入、重新导出以及插件构建逻辑。例如，只有在启用 <code>keyboard</code> 特性时，才会导入 <code>keyboard</code> 模块，添加 <code>KeyboardInput</code> 消息，初始化 <code>ButtonInput&LTKeyCode></code> 资源，并注册键盘输入系统。<p>为了让这个特性系统对最终用户透明，Shatur 修改了 <code>bevy_window</code> 和 <code>bevy_gilrs</code> 的 <code>Cargo.toml</code> 文件，让它们自动启用相应的输入特性。<code>bevy_window</code> 启用了 <code>gestures</code>、<code>keyboard</code>、<code>mouse</code> 和 <code>touch</code>，因为这些是窗口系统通常支持的输入方式。<code>bevy_gilrs</code> 则只启用了 <code>gamepad</code> 特性，因为它专门处理游戏手柄输入。<p>为了在根 <code>Cargo.toml</code> 中暴露这些新特性，并确保它们能通过 <code>bevy</code> 元 crate 使用，Shatur 在根 <code>Cargo.toml</code> 中添加了相应的特性定义，并在 <code>bevy_internal/Cargo.toml</code> 中添加了转发。这样，用户既可以通过 <code>bevy_input</code> 直接启用特性，也可以通过 <code>bevy</code> 元 crate 来启用。<p>这个更改带来了直接的收益。在 GBA 平台上，<code>game</code> 示例的二进制大小从 1.6MB 减少到了 1.4MB，减少了约 12.5%。对于资源受限的嵌入式平台，这是一个显著的优化。<p>当然，这个改动是破坏性的。之前没有显式管理 <code>bevy_input</code> 特性的用户可能会发现他们的输入系统停止工作。为了帮助用户迁移，Shatur 添加了一个迁移指南文档 <code>release-content/migration-guides/bevy_input_features.md</code>，并更新了 <code>docs/cargo_features.md</code> 以记录新特性。<p>总的来说，这个 PR 通过引入编译时的输入源特性门控，优雅地解决了跨平台输入代码冗余的问题。它遵循了 Rust 生态系统中的常见模式（通过特性进行条件编译），并将配置责任放在了最合适的层级（提供硬件支持的 crate），从而在保持 API 简洁的同时，实现了二进制大小的优化。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph "User's Cargo.toml"
</span><span>        A[bevy]
</span><span>        B[bevy_input]
</span><span>        C[bevy_window]
</span><span>        D[bevy_gilrs]
</span><span>    end
</span><span>
</span><span>    subgraph "bevy (metacrate)"
</span><span>        E[feature: keyboard]
</span><span>        F[feature: mouse]
</span><span>        G[feature: touch]
</span><span>        H[feature: gestures]
</span><span>        I[feature: gamepad]
</span><span>    end
</span><span>
</span><span>    subgraph "bevy_internal (forwarding)"
</span><span>        J[feature: keyboard]
</span><span>        K[feature: mouse]
</span><span>        L[feature: touch]
</span><span>        M[feature: gestures]
</span><span>        N[feature: gamepad]
</span><span>    end
</span><span>
</span><span>    subgraph "bevy_input (conditionally compiled)"
</span><span>        O[module: keyboard]
</span><span>        P[module: mouse]
</span><span>        Q[module: touch]
</span><span>        R[module: gestures]
</span><span>        S[module: gamepad]
</span><span>    end
</span><span>
</span><span>    A --> E
</span><span>    A --> F
</span><span>    A --> G
</span><span>    A --> H
</span><span>    A --> I
</span><span>    
</span><span>    E --> J
</span><span>    F --> K
</span><span>    G --> L
</span><span>    H --> M
</span><span>    I --> N
</span><span>    
</span><span>    J --> O
</span><span>    K --> P
</span><span>    L --> Q
</span><span>    M --> R
</span><span>    N --> S
</span><span>    
</span><span>    C -->|enables| O
</span><span>    C -->|enables| P
</span><span>    C -->|enables| Q
</span><span>    C -->|enables| R
</span><span>    
</span><span>    D -->|enables| S
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-input-cargo-toml-7-0><code>crates/bevy_input/Cargo.toml</code> (+7/-0)</h3><p>这是改动的基础，在这里定义了五个新的输入源特性。这些特性默认不启用，需要用户或依赖的 crate 显式启用。<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic>## Input sources
</span><span style=color:#399ee6>mouse </span><span>= []
</span><span style=color:#399ee6>keyboard </span><span>= []
</span><span style=color:#399ee6>gamepad </span><span>= []
</span><span style=color:#399ee6>touch </span><span>= []
</span><span style=color:#399ee6>gestures </span><span>= []
</span></code></pre><h3 id=crates-bevy-input-src-lib-rs-59-24><code>crates/bevy_input/src/lib.rs</code> (+59/-24)</h3><p>这是核心的改动文件，几乎所有逻辑都围绕条件编译展开。改动包括：<ol><li>在每个输入模块的声明前加上 <code>#[cfg(feature = "...")]</code>。<li>在 <code>prelude</code> 模块中，对每个输入类型的重新导出也加上条件编译。<li>在 <code>InputPlugin::build</code> 方法中，将不同输入源的初始化逻辑分别包裹在相应的 <code>#[cfg(feature = "...")]</code> 块中。<li>在导入语句中也添加了条件编译。</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 模块声明条件编译
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"gamepad"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>gamepad</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"gestures"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>gestures</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"keyboard"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>keyboard</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"mouse"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>mouse</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"touch"</span><span>)]
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>touch</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// prelude 中的条件重新导出
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"gamepad"</span><span>)]
</span><span style=color:#fa6e32>pub use crate</span><span style=color:#ed9366>::</span><span>gamepad</span><span style=color:#ed9366>::</span><span>{Gamepad</span><span style=color:#61676ccc>,</span><span> GamepadAxis</span><span style=color:#61676ccc>,</span><span> GamepadButton</span><span style=color:#61676ccc>,</span><span> GamepadSettings}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Plugin 构建中的条件初始化
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"keyboard"</span><span>)]
</span><span>app</span><span style=color:#ed9366>.</span><span>add_message</span><span style=color:#ed9366>::</span><span>&LTKeyboardInput>()
</span><span>    </span><span style=color:#ed9366>.</span><span>add_message</span><span style=color:#ed9366>::</span><span>&LTKeyboardFocusLost>()
</span><span>    </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTButtonInput&LTKeyCode>>()
</span><span>    </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTButtonInput&LTKey>>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(PreUpdate</span><span style=color:#61676ccc>,</span><span> keyboard_input_system</span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(InputSystems))</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=cargo-toml-15-0-he-crates-bevy-internal-cargo-toml-7-0><code>Cargo.toml</code> (+15/-0) 和 <code>crates/bevy_internal/Cargo.toml</code> (+7/-0)</h3><p>这两个文件将新特性从 <code>bevy_input</code> 暴露给整个 <code>bevy</code> 元 crate 的用户。根 <code>Cargo.toml</code> 定义了用户可以启用的特性，而 <code>bevy_internal/Cargo.toml</code> 将这些特性转发给 <code>bevy_input</code>。<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#f51818>// 根 Cargo.toml 中的新增特性定义
</span><span style=color:#abb0b6;font-style:italic># Mouse support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>mouse </span><span>= [</span><span style=color:#86b300>"bevy_internal/mouse"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Keyboard support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>keyboard </span><span>= [</span><span style=color:#86b300>"bevy_internal/keyboard"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Gamepad support. Automatically enabled by `bevy_gilrs`.
</span><span style=color:#399ee6>gamepad </span><span>= [</span><span style=color:#86b300>"bevy_internal/gamepad"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Touch support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>touch </span><span>= [</span><span style=color:#86b300>"bevy_internal/touch"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Gestures support. Automatically enabled by `bevy_window`.
</span><span style=color:#399ee6>gestures </span><span>= [</span><span style=color:#86b300>"bevy_internal/gestures"</span><span>]
</span><span>
</span><span style=color:#f51818>// bevy_internal/Cargo.toml 中的特性转发
</span><span style=color:#399ee6>mouse </span><span>= [</span><span style=color:#86b300>"bevy_input/mouse"</span><span>]
</span><span style=color:#399ee6>keyboard </span><span>= [</span><span style=color:#86b300>"bevy_input/keyboard"</span><span>]
</span><span style=color:#399ee6>gamepad </span><span>= [</span><span style=color:#86b300>"bevy_input/gamepad"</span><span>]
</span><span style=color:#399ee6>touch </span><span>= [</span><span style=color:#86b300>"bevy_input/touch"</span><span>]
</span><span style=color:#399ee6>gestures </span><span>= [</span><span style=color:#86b300>"bevy_input/gestures"</span><span>]
</span></code></pre><h3 id=crates-bevy-window-cargo-toml-he-crates-bevy-gilrs-cargo-toml><code>crates/bevy_window/Cargo.toml</code> 和 <code>crates/bevy_gilrs/Cargo.toml</code></h3><p>这两个文件确保了在典型使用场景下，用户无需手动管理输入特性。<code>bevy_window</code> 启用了它支持的输入源特性，<code>bevy_gilrs</code> 启用了游戏手柄特性。<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#f51818>// bevy_window/Cargo.toml
</span><span style=color:#399ee6>bevy_input </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_input"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"gestures"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"keyboard"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"mouse"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"touch"</span><span style=color:#61676ccc>,
</span><span>] }
</span><span>
</span><span style=color:#f51818>// bevy_gilrs/Cargo.toml
</span><span style=color:#399ee6>bevy_input </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_input"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"gamepad"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><h3 id=release-content-migration-guides-bevy-input-features-md-27-0><code>release-content/migration-guides/bevy_input_features.md</code> (+27/-0)</h3><p>这是一个新增的迁移指南，帮助用户从旧版本升级。它解释了改动的原因，并提供了示例说明如何手动启用需要的输入源特性。<h3 id=docs-cargo-features-md-6-0><code>docs/cargo_features.md</code> (+6/-0)</h3><p>这个文件被更新，加入了新特性的文档，方便用户查阅。<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rust 官方文档：Cargo 特性</strong> - 了解 Rust 中特性（features）的工作原理和最佳实践。</p> <ul><li>https://doc.rust-lang.org/cargo/reference/features.html</ul><li><p><strong>Bevy 官方文档：跨平台开发</strong> - 了解 Bevy 如何支持不同平台以及相关的考量。</p> <ul><li>https://bevyengine.org/learn/book/getting-started/platforms/</ul><li><p><strong>条件编译（<code>#[cfg]</code>）</strong> - Rust 中条件编译属性的详细说明。</p> <ul><li>https://doc.rust-lang.org/reference/conditional-compilation.html</ul><li><p><strong>嵌入式开发中的二进制大小优化</strong> - 讨论在资源受限环境中减少二进制大小的各种技术。</p> <ul><li>https://rust-embedded.github.io/book/unsorted/shrinking.html</ul><li><p><strong>Bevy 输入系统架构</strong> - 理解 Bevy 输入系统是如何设计的，包括事件、资源和系统。</p> <ul><li>https://bevyengine.org/learn/book/input/</ul></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21447.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>