<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21746 Upgrade to wgpu 27 and associated crates
        
    </title><meta content="#21746 Upgrade to wgpu 27 and associated crates" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-21746-zh-cn-20251210>中文</a></div></div><div class=pr-content><h1 id=title-upgrade-to-wgpu-27-and-associated-crates>Title: Upgrade to wgpu 27 and associated crates</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Upgrade to wgpu 27 and associated crates<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21746<li><strong>Author</strong>: JMS55<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Dependencies, S-Ready-For-Final-Review, X-Contentious<li><strong>Created</strong>: 2025-11-05T02:01:39Z<li><strong>Merged</strong>: 2025-12-10T07:51:33Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p>Supersedes https://github.com/bevyengine/bevy/pull/21725.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR begins with a straightforward but significant task: updating Bevy’s core graphics dependencies from wgpu 26 to wgpu 27. While version bumps are common, this particular upgrade introduces several breaking API changes that require careful attention throughout the rendering stack. The author, JMS55, addresses these changes systematically, focusing on maintaining functionality while adapting to the new API surface.<p>The core challenge is that wgpu 27 introduces API changes that affect multiple areas of Bevy’s rendering system. These changes aren’t just cosmetic—they touch fundamental operations like buffer mapping, shader module creation, and device limits configuration. The implementation needs to handle these breaking changes while preserving existing behavior.<p>One significant change involves how Bevy handles device polling for buffer operations. In wgpu 26, the code used <code>PollType::Wait</code>, but wgpu 27 introduces a new method-based approach. This change appears in two locations: Tracy GPU profiling and headless rendering examples. The migration is straightforward but requires attention to detail:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (wgpu 26):
</span><span>device</span><span style=color:#ed9366>.</span><span style=color:#f07171>poll</span><span>(PollType</span><span style=color:#ed9366>::</span><span>Wait)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (wgpu 27):
</span><span>device</span><span style=color:#ed9366>.</span><span style=color:#f07171>poll</span><span>(PollType</span><span style=color:#ed9366>::</span><span>wait_indefinitely())
</span></code></pre><p>Another important change affects the dynamic uniform buffer writer system. The wgpu 27 API removes lifetime parameters from <code>QueueWriteBufferView</code>, which simplifies the code by eliminating lifetime management complexity. The implementation adapts by removing the lifetime parameter from <code>DynamicUniformBufferWriter</code> and its associated wrapper:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (wgpu 26):
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DynamicUniformBufferWriter</span><span><</span><span style=color:#fa6e32>'a</span><span>, T> {
</span><span>    buffer</span><span style=color:#61676ccc>: </span><span>encase</span><span style=color:#ed9366>::</span><span>DynamicUniformBuffer&LTQueueWriteBufferViewWrapper<</span><span style=color:#fa6e32>'a</span><span>>>,
</span><span>    _marker</span><span style=color:#61676ccc>: </span><span>PhantomData<</span><span style=color:#fa6e32>fn</span><span>() </span><span style=color:#61676ccc>-></span><span> T>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (wgpu 27):
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DynamicUniformBufferWriter</span><span>&LTT> {
</span><span>    buffer</span><span style=color:#61676ccc>: </span><span>encase</span><span style=color:#ed9366>::</span><span>DynamicUniformBuffer&LTQueueWriteBufferViewWrapper>,
</span><span>    _marker</span><span style=color:#61676ccc>: </span><span>PhantomData<</span><span style=color:#fa6e32>fn</span><span>() </span><span style=color:#61676ccc>-></span><span> T>,
</span><span>}
</span></code></pre><p>The shader compilation system also sees changes, particularly around SPIR-V passthrough functionality. Wgpu 27 renames the feature flag and modifies the descriptor structure for creating shader modules. This requires updating the feature check and the method call:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (wgpu 26):
</span><span style=color:#fa6e32>if</span><span> device</span><span style=color:#ed9366>.</span><span style=color:#f07171>features</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(wgpu</span><span style=color:#ed9366>::</span><span>Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>SPIRV_SHADER_PASSTHROUGH</span><span>) {
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>device</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_shader_module_passthrough</span><span>(
</span><span>            wgpu</span><span style=color:#ed9366>::</span><span>ShaderModuleDescriptorPassthrough</span><span style=color:#ed9366>::</span><span>SpirV(
</span><span>                wgpu</span><span style=color:#ed9366>::</span><span>ShaderModuleDescriptorSpirV {
</span><span>                    label</span><span style=color:#61676ccc>:</span><span> desc</span><span style=color:#ed9366>.</span><span>label</span><span style=color:#61676ccc>,
</span><span>                    source</span><span style=color:#61676ccc>:</span><span> source</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>                }</span><span style=color:#61676ccc>,
</span><span>            )</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (wgpu 27):
</span><span style=color:#fa6e32>if</span><span> device</span><span style=color:#ed9366>.</span><span style=color:#f07171>features</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(wgpu</span><span style=color:#ed9366>::</span><span>Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>EXPERIMENTAL_PASSTHROUGH_SHADERS</span><span>) {
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>device</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_shader_module_passthrough</span><span>(
</span><span>            wgpu</span><span style=color:#ed9366>::</span><span>ShaderModuleDescriptorPassthrough {
</span><span>                label</span><span style=color:#61676ccc>:</span><span> desc</span><span style=color:#ed9366>.</span><span>label</span><span style=color:#61676ccc>,
</span><span>                spirv</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(source</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#ed9366>..</span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()
</span><span>            }</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>    }
</span><span>}
</span></code></pre><p>The renderer initialization process expands to include new wgpu 27 capabilities. Several new limits are introduced for features like acceleration structures, mesh shaders, and multiview rendering. These limits need to be properly constrained against the adapter’s reported capabilities:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>max_acceleration_structures_per_shader_stage</span><span style=color:#61676ccc>:</span><span> limits
</span><span>    </span><span style=color:#ed9366>.</span><span>max_acceleration_structures_per_shader_stage
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>min</span><span>(constrained_limits</span><span style=color:#ed9366>.</span><span>max_acceleration_structures_per_shader_stage)</span><span style=color:#61676ccc>,
</span><span>max_task_workgroup_total_count</span><span style=color:#61676ccc>:</span><span> limits
</span><span>    </span><span style=color:#ed9366>.</span><span>max_task_workgroup_total_count
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>min</span><span>(constrained_limits</span><span style=color:#ed9366>.</span><span>max_task_workgroup_total_count)</span><span style=color:#61676ccc>,
</span><span style=color:#abb0b6;font-style:italic>// ... additional new limits
</span></code></pre><p>Interestingly, the PR also removes the requirement for the <code>MULTI_DRAW_INDIRECT</code> feature in GPU preprocessing. This suggests that either the feature became default in wgpu 27 or the preprocessing system was refined to work without it. The change simplifies the feature requirement check:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (wgpu 26):
</span><span style=color:#fa6e32>let</span><span> culling_feature_support </span><span style=color:#ed9366>=</span><span> device</span><span style=color:#ed9366>.</span><span style=color:#f07171>features</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(
</span><span>    Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>INDIRECT_FIRST_INSTANCE
</span><span>        </span><span style=color:#ed9366>| </span><span>Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MULTI_DRAW_INDIRECT
</span><span>        </span><span style=color:#ed9366>| </span><span>Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>PUSH_CONSTANTS</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (wgpu 27):
</span><span style=color:#fa6e32>let</span><span> culling_feature_support </span><span style=color:#ed9366>=</span><span> device
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>features</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>INDIRECT_FIRST_INSTANCE </span><span style=color:#ed9366>| </span><span>Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>PUSH_CONSTANTS</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>The dependency updates are comprehensive, touching multiple crates throughout the Bevy ecosystem. Each crate that depends on wgpu-types or related graphics libraries needs its version updated. This includes not just the core rendering crates but also peripheral systems like anti-aliasing, cameras, meshes, sprites, and text rendering.<p>One notable change in the solari crate (ray tracing) removes the requirement for <code>EXPERIMENTAL_RAY_TRACING_ACCELERATION_STRUCTURE</code>. This suggests that wgpu 27 might have changed how ray tracing acceleration structures are handled or that the feature was consolidated into other flags.<p>The implementation includes proper handling of experimental features through an unsafe call to <code>wgpu::ExperimentalFeatures::enabled()</code>, with a TODO comment noting the need for proper safety considerations. This demonstrates a pragmatic approach to adopting new wgpu features while acknowledging the need for future safety review.<p>Throughout the changes, the author maintains consistency in error handling and follows established patterns for device feature checking and limit configuration. The PR successfully navigates the breaking changes in wgpu 27 while preserving Bevy’s rendering functionality, setting the foundation for future graphics features and performance improvements.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[wgpu 26] --> B[API Changes]
</span><span>    B --> C[Device Polling]
</span><span>    B --> D[Buffer Writer Lifetimes]
</span><span>    B --> E[Shader Module Creation]
</span><span>    B --> F[Device Limits]
</span><span>    B --> G[Feature Flags]
</span><span>    C --> H[PollType.wait_indefinitely()]
</span><span>    D --> I[Removed Lifetime Parameters]
</span><span>    E --> J[New Descriptor Structure]
</span><span>    F --> K[New Mesh/Acceleration Limits]
</span><span>    G --> L[Updated Feature Names]
</span><span>    H --> M[wgpu 27 Compatibility]
</span><span>    I --> M
</span><span>    J --> M
</span><span>    K --> M
</span><span>    L --> M
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-src-renderer-mod-rs-20-1><code>crates/bevy_render/src/renderer/mod.rs</code> (+20/-1)</h3><p>This file handles renderer initialization and needed updates for wgpu 27’s expanded device limits and experimental features.<p><strong>Key Changes:</strong><ul><li>Added new wgpu 27 limits for acceleration structures, mesh shaders, and multiview rendering<li>Enabled experimental features via unsafe API (with TODO for safety review)<li>Updated DX12 backend options with new configuration parameters</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added new device limits for wgpu 27
</span><span>max_acceleration_structures_per_shader_stage</span><span style=color:#61676ccc>:</span><span> limits
</span><span>    </span><span style=color:#ed9366>.</span><span>max_acceleration_structures_per_shader_stage
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>min</span><span>(constrained_limits</span><span style=color:#ed9366>.</span><span>max_acceleration_structures_per_shader_stage)</span><span style=color:#61676ccc>,
</span><span>max_task_workgroup_total_count</span><span style=color:#61676ccc>:</span><span> limits
</span><span>    </span><span style=color:#ed9366>.</span><span>max_task_workgroup_total_count
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>min</span><span>(constrained_limits</span><span style=color:#ed9366>.</span><span>max_task_workgroup_total_count)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added experimental features (with safety note)
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: TODO, see https://github.com/bevyengine/bevy/issues/22082
</span><span>experimental_features</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>unsafe </span><span>{ wgpu</span><span style=color:#ed9366>::</span><span>ExperimentalFeatures</span><span style=color:#ed9366>::</span><span>enabled() }</span><span style=color:#61676ccc>,
</span></code></pre><h3 id=crates-bevy-render-src-render-resource-uniform-buffer-rs-8-8><code>crates/bevy_render/src/render_resource/uniform_buffer.rs</code> (+8/-8)</h3><p>Updated dynamic uniform buffer writer to work with wgpu 27’s lifetime changes.<p><strong>Key Changes:</strong><ul><li>Removed lifetime parameter from <code>DynamicUniformBufferWriter</code><li>Simplified <code>QueueWriteBufferViewWrapper</code> structure<li>Updated type signatures throughout the module</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DynamicUniformBufferWriter</span><span><</span><span style=color:#fa6e32>'a</span><span>, T> {
</span><span>    buffer</span><span style=color:#61676ccc>: </span><span>encase</span><span style=color:#ed9366>::</span><span>DynamicUniformBuffer&LTQueueWriteBufferViewWrapper<</span><span style=color:#fa6e32>'a</span><span>>>,
</span><span>    _marker</span><span style=color:#61676ccc>: </span><span>PhantomData<</span><span style=color:#fa6e32>fn</span><span>() </span><span style=color:#61676ccc>-></span><span> T>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DynamicUniformBufferWriter</span><span>&LTT> {
</span><span>    buffer</span><span style=color:#61676ccc>: </span><span>encase</span><span style=color:#ed9366>::</span><span>DynamicUniformBuffer&LTQueueWriteBufferViewWrapper>,
</span><span>    _marker</span><span style=color:#61676ccc>: </span><span>PhantomData<</span><span style=color:#fa6e32>fn</span><span>() </span><span style=color:#61676ccc>-></span><span> T>,
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-renderer-render-device-rs-6-7><code>crates/bevy_render/src/renderer/render_device.rs</code> (+6/-7)</h3><p>Updated shader module creation for wgpu 27’s SPIR-V passthrough changes.<p><strong>Key Changes:</strong><ul><li>Changed feature flag from <code>SPIRV_SHADER_PASSTHROUGH</code> to <code>EXPERIMENTAL_PASSTHROUGH_SHADERS</code><li>Updated shader module descriptor structure to match new wgpu API</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Updated shader module creation for SPIR-V passthrough
</span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>device</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_shader_module_passthrough</span><span>(
</span><span>        wgpu</span><span style=color:#ed9366>::</span><span>ShaderModuleDescriptorPassthrough {
</span><span>            label</span><span style=color:#61676ccc>:</span><span> desc</span><span style=color:#ed9366>.</span><span>label</span><span style=color:#61676ccc>,
</span><span>            spirv</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(source</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#ed9366>..</span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>    )
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-batching-gpu-preprocessing-rs-3-5><code>crates/bevy_render/src/batching/gpu_preprocessing.rs</code> (+3/-5)</h3><p>Simplified feature requirements for GPU preprocessing.<p><strong>Key Changes:</strong><ul><li>Removed <code>MULTI_DRAW_INDIRECT</code> from required features<li>Maintained compatibility with existing preprocessing functionality</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Simplified feature check
</span><span style=color:#fa6e32>let</span><span> culling_feature_support </span><span style=color:#ed9366>=</span><span> device
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>features</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>INDIRECT_FIRST_INSTANCE </span><span style=color:#ed9366>| </span><span>Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>PUSH_CONSTANTS</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-shader-cargo-toml-4-4><code>crates/bevy_shader/Cargo.toml</code> (+4/-4)</h3><p>Updated wgpu-types and naga dependencies to version 27.<p><strong>Key Changes:</strong><ul><li>Bumped <code>wgpu-types</code> from 26 to 27<li>Bumped <code>naga</code> from 26 to 27<li>Updated <code>naga_oil</code> to version 0.20</ul><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>wgpu-types </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"26"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span><span style=color:#399ee6>naga </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"26"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"wgsl-in"</span><span>] }
</span><span style=color:#399ee6>naga_oil </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.19"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>wgpu-types </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"27"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span><span style=color:#399ee6>naga </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"27"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"wgsl-in"</span><span>] }
</span><span style=color:#399ee6>naga_oil </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.20"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/gfx-rs/wgpu/releases/tag/v27.0.0 target=_blank>wgpu 27.0 Release Notes</a> - Detailed changelog and migration guide<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/next/plugins/render/ target=_blank>Bevy Render Architecture</a> - Understanding Bevy’s rendering system<li><a rel="noopener nofollow noreferrer" href=https://www.w3.org/TR/webgpu/ target=_blank>WebGPU Specification</a> - Underlying standard that wgpu implements<li><a rel="noopener nofollow noreferrer" href=https://github.com/gfx-rs/naga target=_blank>Naga Shader Translation</a> - Shader translation library used by wgpu<li><a rel="noopener nofollow noreferrer" href=https://sotrh.github.io/learn-wgpu/ target=_blank>GPU Buffer Management Patterns</a> - Best practices for GPU resource management</ol><h1 id=full-code-diff>Full Code Diff</h1><p><em>(Provided in the original request)</em></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_21746.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>