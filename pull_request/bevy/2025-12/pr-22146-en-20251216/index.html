<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22146 Suppress Warnings for unused code in bevy_gizmos_render
        
    </title><meta content="#22146 Suppress Warnings for unused code in bevy_gizmos_render" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22146-zh-cn-20251216>中文</a></div></div><div class=pr-content><h1 id=title-suppress-warnings-for-unused-code-in-bevy-gizmos-render>Title: Suppress Warnings for unused code in bevy_gizmos_render</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Suppress Warnings for unused code in bevy_gizmos_render<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22146<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Code-Quality, S-Ready-For-Final-Review, A-Gizmos<li><strong>Created</strong>: 2025-12-16T02:26:33Z<li><strong>Merged</strong>: 2025-12-16T05:17:50Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #22137</ul><h2 id=solution>Solution</h2><p>Add <code>expect</code>’s to suppress the warnings generated after running <code>cargo build -p bevy_gizmos_render</code>. All of the warnings stem from fields/structs/functions that go unused if neither the <code>bevy_pbr</code> or <code>bevy_sprite_render</code> features are on (they are only used if either the plugin in <code>pipeline_2d</code> or <code>pipeline_3d</code> are added), so the expects are gated to that particular circumstance.<h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? Running <code>cargo build -p bevy_gizmos_render</code> emits no warnings Running <code>cargo clippy</code> emits no warnings</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important code quality issue: eliminating compiler warnings when building the <code>bevy_gizmos_render</code> crate with certain feature configurations. The problem emerged when building without either the <code>bevy_pbr</code> or <code>bevy_sprite_render</code> features enabled. In this configuration, several structs, functions, and variables become unused, triggering Rust’s standard dead code and unused variable warnings.<p>The developer faced a common problem in feature-gated codebases: code that’s conditionally compiled based on features can appear unused when those features are disabled. While the code is technically correct and will be used when the appropriate features are enabled, the compiler sees it as dead code in the current configuration. This creates noise in build outputs and can obscure legitimate warnings.<p>The solution approach is methodical and precise. Instead of using <code>#[allow(...)]</code> attributes, which would suppress warnings unconditionally, the developer used <code>#[expect(...)]</code> attributes gated with <code>#[cfg_attr(...)]</code>. This approach has several advantages: it only suppresses warnings when the specific conditions are met (both <code>bevy_pbr</code> and <code>bevy_sprite_render</code> features disabled), and it uses <code>expect</code> rather than <code>allow</code>, which is the newer, more intentional way to handle expected warnings in Rust.<p>The implementation shows careful attention to detail. The developer didn’t just blanket-allow all warnings; they analyzed each warning source and applied targeted suppressions. The pattern used throughout is:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(
</span><span>    </span><span style=color:#f29718>not</span><span>(</span><span style=color:#f29718>any</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_pbr"</span><span style=color:#61676ccc>,</span><span> feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_sprite_render"</span><span>))</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>expect</span><span>(
</span><span>        dead_code</span><span style=color:#61676ccc>,
</span><span>        reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"struct is not constructed when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>    )
</span><span>)]
</span></code></pre><p>This configuration attribute applies the <code>expect</code> attribute only when neither feature is enabled. The reason strings provide clear documentation about why the code appears unused in this configuration.<p>Looking at the specific changes, we can see they fall into three categories:<ol><li><p><strong>Unused variable warnings</strong>: In <code>extract_gizmo_data()</code> and <code>extract_linegizmos()</code>, the <code>handle</code> and <code>render_layers</code> variables are only used when the render pipelines are available. When features are disabled, these variables are still declared but never used.</p><li><p><strong>Dead code warnings</strong>: Several structs like <code>GpuLineGizmo</code>, <code>LineGizmoUniformBindgroup</code>, <code>SetLineGizmoBindGroup</code>, <code>DrawLineGizmo</code>, and <code>DrawLineJointGizmo</code> are only constructed when the render pipelines exist. Without those features, the struct definitions exist but are never instantiated.</p><li><p><strong>Unused function warnings</strong>: The <code>line_gizmo_vertex_buffer_layouts()</code> and <code>line_joint_gizmo_vertex_buffer_layouts()</code> functions are only called from code that’s feature-gated.</p></ol><p>The technical insight here is understanding how Bevy’s renderer is modularized. The <code>bevy_gizmos_render</code> crate provides rendering infrastructure for gizmos, but it can work with either the 3D PBR pipeline (<code>bevy_pbr</code>) or the 2D sprite pipeline (<code>bevy_sprite_render</code>). When neither is enabled, the rendering code has nothing to hook into, so much of it becomes dead code. However, the code needs to remain present for when either feature is enabled.<p>The impact of these changes is purely about code quality and developer experience. By eliminating false positive warnings, developers get cleaner build outputs. This makes it easier to spot legitimate warnings and maintains a professional standard for the codebase. The use of <code>expect</code> with clear reasoning also serves as documentation, explaining to future maintainers why certain code might appear unused.<p>From an engineering perspective, this PR demonstrates good practices for handling feature-gated code in Rust:<ul><li>Using <code>expect</code> over <code>allow</code> for intentional warning suppression<li>Gating suppressions with precise conditions<li>Providing clear reason strings<li>Addressing warnings individually rather than with blanket suppressions</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_gizmos_render crate] --> B{Features enabled?}
</span><span>    B -->|bevy_pbr or bevy_sprite_render| C[Rendering code used]
</span><span>    B -->|Neither feature| D[Rendering code unused]
</span><span>    D --> E[Compiler warnings]
</span><span>    E --> F[PR adds #[expect] attributes]
</span><span>    F --> G[Clean builds]
</span><span>    
</span><span>    subgraph "Feature-gated Structures"
</span><span>        H[GpuLineGizmo]
</span><span>        I[LineGizmoUniformBindgroup]
</span><span>        J[SetLineGizmoBindGroup]
</span><span>        K[DrawLineGizmo]
</span><span>        L[DrawLineJointGizmo]
</span><span>    end
</span><span>    
</span><span>    subgraph "Feature-gated Functions"
</span><span>        M[line_gizmo_vertex_buffer_layouts]
</span><span>        N[line_joint_gizmo_vertex_buffer_layouts]
</span><span>    end
</span><span>    
</span><span>    subgraph "Conditionally Used Variables"
</span><span>        O[handle in extract_gizmo_data]
</span><span>        P[render_layers in extract_linegizmos]
</span><span>    end
</span><span>    
</span><span>    H --> D
</span><span>    I --> D
</span><span>    J --> D
</span><span>    K --> D
</span><span>    L --> D
</span><span>    M --> D
</span><span>    N --> D
</span><span>    O --> D
</span><span>    P --> D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-gizmos-render-src-lib-rs-58-1><code>crates/bevy_gizmos_render/src/lib.rs</code> (+58/-1)</h3><p>This file contains the main rendering logic for gizmos. The changes add <code>#[cfg_attr]</code> with <code>#[expect]</code> attributes to suppress warnings for code that’s only used when either <code>bevy_pbr</code> or <code>bevy_sprite_render</code> features are enabled.<p>Key modifications:<ol><li><strong>Line 147-156</strong>: Added conditional expectation for unused variable warning on <code>handle</code> in <code>extract_gizmo_data()</code> function.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(
</span><span>    </span><span style=color:#f29718>not</span><span>(</span><span style=color:#f29718>any</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_pbr"</span><span style=color:#61676ccc>,</span><span> feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_sprite_render"</span><span>))</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>expect</span><span>(
</span><span>        unused_variables</span><span style=color:#61676ccc>,
</span><span>        reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"`handle` is unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>    )
</span><span>)]
</span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(handle) </span><span style=color:#ed9366>=</span><span> handle
</span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#fa6e32>continue</span><span style=color:#61676ccc>;
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><p><strong>Line 223-229</strong>: Added conditional expectation for dead code warning on <code>GpuLineGizmo</code> struct.</p><li><p><strong>Line 290-296</strong>: Added conditional expectation for dead code warning on <code>LineGizmoUniformBindgroup</code> struct.</p><li><p><strong>Line 320-326</strong>: Added conditional expectation for dead code warning on <code>SetLineGizmoBindGroup</code> struct.</p><li><p><strong>Line 354-360</strong>: Added conditional expectation for dead code warning on <code>DrawLineGizmo</code> struct.</p><li><p><strong>Line 420-426</strong>: Added conditional expectation for dead code warning on <code>DrawLineJointGizmo</code> struct.</p><li><p><strong>Line 498-504</strong>: Added conditional expectation for dead code warning on <code>line_gizmo_vertex_buffer_layouts()</code> function.</p><li><p><strong>Line 559-565</strong>: Added conditional expectation for dead code warning on <code>line_joint_gizmo_vertex_buffer_layouts()</code> function.</p></ol><h3 id=crates-bevy-gizmos-render-src-retained-rs-7-0><code>crates/bevy_gizmos_render/src/retained.rs</code> (+7/-0)</h3><p>This file handles retained mode gizmo rendering. The change adds a conditional expectation for an unused variable warning.<p>Key modification:<ol><li><strong>Line 25-33</strong>: Added conditional expectation for unused variable warning on <code>render_layers</code> in <code>extract_linegizmos()</code> function.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(
</span><span>    </span><span style=color:#f29718>not</span><span>(</span><span style=color:#f29718>any</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_pbr"</span><span style=color:#61676ccc>,</span><span> feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_sprite_render"</span><span>))</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>expect</span><span>(
</span><span>        unused_variables</span><span style=color:#61676ccc>,
</span><span>        reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"`render_layers` is unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>    )
</span><span>)]
</span><span style=color:#fa6e32>for </span><span>(entity</span><span style=color:#61676ccc>,</span><span> gizmo</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#61676ccc>,</span><span> render_layers) </span><span style=color:#ed9366>in &</span><span>query {
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust’s <code>#[expect]</code> attribute</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/attributes/diagnostics.html#the-expect-attribute target=_blank>The Rust Reference - Attributes</a><li><strong>Conditional compilation in Rust</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>The Rust Reference - Conditional Compilation</a><li><strong>Bevy’s feature system</strong>: <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/plugins_guidelines.md#cargo-features target=_blank>Bevy’s Cargo Features documentation</a><li><strong>Rust’s lint system</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustc/lints/index.html target=_blank>Rustc Book - Lints</a><li><strong>Bevy’s renderer architecture</strong>: <a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/rendering.html target=_blank>Bevy’s rendering documentation</a></ol><h2 id=full-code-diff>Full Code Diff</h2><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_gizmos_render/src/lib.rs b/crates/bevy_gizmos_render/src/lib.rs
</span><span>index 42e73e9192c00..c69977e115828 100755
</span><span>--- a/crates/bevy_gizmos_render/src/lib.rs
</span><span>+++ b/crates/bevy_gizmos_render/src/lib.rs
</span><span>@@ -147,7 +147,15 @@ fn extract_gizmo_data(
</span><span>             continue;
</span><span>         }
</span><span> 
</span><span>-        let Some(handle) = handle else {
</span><span>+        #[cfg_attr(
</span><span>+            not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+            expect(
</span><span>+                unused_variables,
</span><span>+                reason = "`handle` is unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+            )
</span><span>+        )]
</span><span>+        let Some(handle) = handle
</span><span>+        else {
</span><span>             continue;
</span><span>         };
</span><span> 
</span><span>@@ -215,6 +223,13 @@ struct LineGizmoUniform {
</span><span>     _padding: bevy_math::Vec3,
</span><span> }
</span><span> 
</span><span>+#[cfg_attr(
</span><span>+    not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+    expect(
</span><span>+        dead_code,
</span><span>+        reason = "fields are unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+    )
</span><span>+)]
</span><span> #[derive(Debug, Clone)]
</span><span> struct GpuLineGizmo {
</span><span>     list_position_buffer: Buffer,
</span><span>@@ -275,6 +290,13 @@ struct LineGizmoUniformBindgroupLayout {
</span><span>     layout: BindGroupLayoutDescriptor,
</span><span> }
</span><span> 
</span><span>+#[cfg_attr(
</span><span>+    not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+    expect(
</span><span>+        dead_code,
</span><span>+        reason = "fields are unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+    )
</span><span>+)]
</span><span> #[derive(Resource)]
</span><span> struct LineGizmoUniformBindgroup {
</span><span>     bindgroup: BindGroup,
</span><span>@@ -298,6 +320,13 @@ fn prepare_line_gizmo_bind_group(
</span><span>     }
</span><span> }
</span><span> 
</span><span>+#[cfg_attr(
</span><span>+    not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+    expect(
</span><span>+        dead_code,
</span><span>+        reason = "struct is not constructed when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+    )
</span><span>+)]
</span><span> struct SetLineGizmoBindGroup&LTconst I: usize>;
</span><span> 
</span><span> impl&LTconst I: usize, P: PhaseItem> RenderCommand&LTP> for SetLineGizmoBindGroup&LTI> {
</span><span>@@ -325,6 +354,13 @@ impl&LTconst I: usize, P: PhaseItem> RenderCommand&LTP> for SetLineGizmoBindGroup&LTI>
</span><span>     }
</span><span> }
</span><span> 
</span><span>+#[cfg_attr(
</span><span>+    not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+    expect(
</span><span>+        dead_code,
</span><span>+        reason = "struct is not constructed when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+    )
</span><span>+)]
</span><span> struct DrawLineGizmo&LTconst STRIP: bool>;
</span><span> 
</span><span> impl&LTP: PhaseItem, const STRIP: bool> RenderCommand&LTP> for DrawLineGizmo&LTSTRIP> {
</span><span>@@ -384,6 +420,13 @@ impl&LTP: PhaseItem, const STRIP: bool> RenderCommand&LTP> for DrawLineGizmo&LTSTRIP>
</span><span>     }
</span><span> }
</span><span> 
</span><span>+#[cfg_attr(
</span><span>+    not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+    expect(
</span><span>+        dead_code,
</span><span>+        reason = "struct is not constructed when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+    )
</span><span>+)]
</span><span> struct DrawLineJointGizmo;
</span><span> 
</span><span> impl&LTP: PhaseItem> RenderCommand&LTP> for DrawLineJointGizmo {
</span><span>@@ -455,6 +498,13 @@ impl&LTP: PhaseItem> RenderCommand&LTP> for DrawLineJointGizmo {
</span><span>     }
</span><span> }
</span><span> 
</span><span>+#[cfg_attr(
</span><span>+    not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+    expect(
</span><span>+        dead_code,
</span><span>+        reason = "function is unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+    )
</span><span>+)]
</span><span> fn line_gizmo_vertex_buffer_layouts(strip: bool) -> Vec&LTVertexBufferLayout> {
</span><span>     use VertexFormat::*;
</span><span>     let mut position_layout = VertexBufferLayout {
</span><span>@@ -509,6 +559,13 @@ fn line_gizmo_vertex_buffer_layouts(strip: bool) -> Vec&LTVertexBufferLayout> {
</span><span>     }
</span><span> }
</span><span> 
</span><span>+#[cfg_attr(
</span><span>+    not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+    expect(
</span><span>+        dead_code,
</span><span>+        reason = "function is unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+    )
</span><span>+)]
</span><span> fn line_joint_gizmo_vertex_buffer_layouts() -> Vec&LTVertexBufferLayout> {
</span><span>     use VertexFormat::*;
</span><span>     let mut position_layout = VertexBufferLayout {
</span><span>diff --git a/crates/bevy_gizmos_render/src/retained.rs b/crates/bevy_gizmos_render/src/retained.rs
</span><span>index d31746a931860..d9130fb69dc72 100644
</span><span>--- a/crates/bevy_gizmos_render/src/retained.rs
</span><span>+++ b/crates/bevy_gizmos_render/src/retained.rs
</span><span>@@ -25,6 +25,13 @@ pub(crate) fn extract_linegizmos(
</span><span>     query: Extract&LTQuery<(Entity, &Gizmo, &GlobalTransform, Option<&RenderLayers>)>>,
</span><span> ) {
</span><span>     let mut values = Vec::with_capacity(*previous_len);
</span><span>+    #[cfg_attr(
</span><span>+        not(any(feature = "bevy_pbr", feature = "bevy_sprite_render")),
</span><span>+        expect(
</span><span>+            unused_variables,
</span><span>+            reason = "`render_layers` is unused when bevy_pbr and bevy_sprite_render are both disabled."
</span><span>+        )
</span><span>+    )]
</span><span>     for (entity, gizmo, transform, render_layers) in &query {
</span><span>         let joints_resolution = if let GizmoLineJoint::Round(resolution) = gizmo.line_config.joints
</span><span>         {
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22146.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>