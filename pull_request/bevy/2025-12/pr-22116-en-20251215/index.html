<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22116 Use slice `last` instead of iter `last
        
    </title><meta content="#22116 Use slice `last` instead of iter `last" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22116-zh-cn-20251215>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Use slice <code>last</code> instead of iter <code>last</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Use slice <code>last</code> instead of iter `last<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22116<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Code-Quality, S-Needs-Review, A-glTF<li><strong>Created</strong>: 2025-12-15T04:26:31Z<li><strong>Merged</strong>: 2025-12-15T09:01:42Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Followup to #22106.</ul><h2 id=solution>Solution</h2><ul><li>Use slice <code>last</code> instead of iter <code>last</code> for better performance - we don’t need to iterate just to find the last element.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request represents a straightforward micro-optimization in Bevy’s glTF loader. The issue was about using the most efficient method to access the last element of a collection. In two places within the glTF loading code, the developer used an iterator-based approach with <code>iter().last()</code> to get the last texture handle from a collection.<p>The original code looked like this:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>texture_handles</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>last</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()
</span></code></pre><p>The problem with this approach is that it creates an iterator over the entire collection just to access the last element. While for small collections this overhead is minimal, it’s an unnecessary abstraction that adds overhead to every call. The <code>iter().last()</code> chain works by creating an iterator and then iterating through all elements until it reaches the last one, even though we know we want direct access to the last element.<p>The solution is simple and direct: use the <code>last()</code> method available directly on slices. This method has the same signature and behavior but avoids creating an intermediate iterator. The optimized code becomes:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>texture_handles</span><span style=color:#ed9366>.</span><span style=color:#f07171>last</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()
</span></code></pre><p>This change builds on a previous optimization in PR #22106, indicating a pattern of identifying and eliminating small inefficiencies throughout the codebase. The author recognized that these two locations in the glTF loader were performing the same suboptimal pattern that had been addressed elsewhere.<p>The implementation is minimal - just two lines changed in a single file. Both changes are identical in nature, replacing <code>iter().last()</code> with <code>last()</code>. This consistency makes the code easier to read and maintains a uniform style across the codebase.<p>From a technical perspective, this change improves performance by:<ol><li>Eliminating the creation of an iterator object<li>Avoiding the iterator’s internal state management<li>Reducing function call overhead</ol><p>While the performance improvement for individual calls is small, these optimizations accumulate and demonstrate good coding practices. The <code>last()</code> method on slices uses direct indexing (or pointer arithmetic) to access the final element, which is constant time O(1) and more efficient than creating and traversing an iterator.<p>The changes fit cleanly into the existing architecture without any ripple effects. The method signatures remain the same, and the behavior is identical. This is a classic example of a micro-optimization that improves code clarity while providing a small performance benefit.<p>For other developers, this PR serves as a reminder to use the most direct API available for common operations. When working with Rust collections, it’s worth checking if there’s a dedicated method on the collection itself before reaching for iterator combinators, especially for simple operations like getting the first or last element.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[glTF Loading Process] --> B[Texture Processing]
</span><span>    B --> C[Call Extension Handlers]
</span><span>    C --> D[Get Last Texture Handle]
</span><span>    D --> E{Method Used}
</span><span>    E -->|Before| F[iter().last()]
</span><span>    E -->|After| G[slice.last()]
</span><span>    
</span><span>    F --> H[Creates Iterator]
</span><span>    H --> I[Iterates to End]
</span><span>    I --> J[Returns Element]
</span><span>    
</span><span>    G --> K[Direct Access]
</span><span>    K --> J
</span><span>    
</span><span>    J --> L[Clone and Pass to Extension]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>crates/bevy_gltf/src/loader/mod.rs</strong> (+2/-2) This file contains the glTF loader implementation that handles loading and processing glTF files in Bevy.<p><strong>Change 1: Line 649</strong><ul><li><strong>Before</strong>: <code>texture_handles.iter().last().unwrap().clone()</code><li><strong>After</strong>: <code>texture_handles.last().unwrap().clone()</code></ul><p><strong>Change 2: Line 687</strong><ul><li><strong>Before</strong>: <code>texture_handles.iter().last().unwrap().clone()</code><li><strong>After</strong>: <code>texture_handles.last().unwrap().clone()</code></ul><p>Both changes follow the same pattern: when processing texture extensions in the glTF loader, the code needs to pass the last texture handle to extension handlers. The original implementation unnecessarily created an iterator to access this element. The optimized version uses the direct <code>last()</code> method available on slices, which is more efficient and clearer in intent.<p>The changes are in the <code>GltfLoader</code> implementation, specifically in the methods that handle texture loading and extension processing. Both locations are within loops that iterate over textures and their extensions, so the optimization applies to every texture processed during glTF loading.<h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust Slice Documentation</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/primitive.slice.html target=_blank>https://doc.rust-lang.org/std/primitive.slice.html</a> - Official documentation for slice methods including <code>last()</code>.<li><strong>Rust Iterator Documentation</strong>: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/iter/trait.Iterator.html target=_blank>https://doc.rust-lang.org/std/iter/trait.Iterator.html</a> - Understanding iterator methods and their performance characteristics.<li><strong>Bevy glTF Loading</strong>: <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_gltf target=_blank>https://github.com/bevyengine/bevy/tree/main/crates/bevy_gltf</a> - The glTF loader implementation in Bevy.<li><strong>Related PR #22106</strong>: <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/22106 target=_blank>https://github.com/bevyengine/bevy/pull/22106</a> - Previous optimization that addressed similar patterns in the codebase.<li><strong>Rust Performance Patterns</strong>: <a rel="noopener nofollow noreferrer" href=https://nnethercote.github.io/perf-book/ target=_blank>https://nnethercote.github.io/perf-book/</a> - The Rust Performance Book for understanding optimization patterns in Rust.</ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_gltf/src/loader/mod.rs b/crates/bevy_gltf/src/loader/mod.rs
</span><span>index e4ecf35f814d4..68e5eb41dc69d 100644
</span><span style=color:#c594c5>--- a/crates/bevy_gltf/src/loader/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_gltf/src/loader/mod.rs
</span><span style=color:#c594c5>@@ -646,7 +646,7 @@ </span><span style=color:#399ee6>impl GltfLoader {
</span><span>                 for extension in extensions.iter_mut() {
</span><span>                     extension.on_texture(
</span><span>                         texture.extensions(),
</span><span style=color:#f07171>-                        texture_handles.iter().last().unwrap().clone(),
</span><span style=color:#86b300>+                        texture_handles.last().unwrap().clone(),
</span><span>                     );
</span><span>                 }
</span><span>             }
</span><span style=color:#c594c5>@@ -684,7 +684,7 @@ </span><span style=color:#399ee6>impl GltfLoader {
</span><span>                         for extension in extensions.iter_mut() {
</span><span>                             extension.on_texture(
</span><span>                                 extension_data.as_ref(),
</span><span style=color:#f07171>-                                texture_handles.iter().last().unwrap().clone(),
</span><span style=color:#86b300>+                                texture_handles.last().unwrap().clone(),
</span><span>                             );
</span><span>                         }
</span><span>                     }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22116.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>