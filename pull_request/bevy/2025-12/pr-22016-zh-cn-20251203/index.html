<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22016 TypeData dependencies
        
    </title><meta content="#22016 TypeData dependencies" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>â† Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-03</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-12/pr-22016-en-20251203>English</a> / <span class="lang-link active" data-lang=zh-cn>ä¸­æ–‡</span></div></div><div class=pr-content><h1 id=typedata-dependencies>TypeData dependencies</h1><h2 id=ji-ben-xin-xi>åŸºæœ¬ä¿¡æ¯</h2><ul><li><strong>æ ‡é¢˜</strong>: TypeData dependencies<li><strong>PRé“¾æ¥</strong>: https://github.com/bevyengine/bevy/pull/22016<li><strong>ä½œè€…</strong>: cart<li><strong>çŠ¶æ€</strong>: å·²åˆå¹¶<li><strong>æ ‡ç­¾</strong>: C-Usability, A-Reflection, X-Uncontroversial, D-Modest, S-Needs-Review<li><strong>åˆ›å»ºæ—¶é—´</strong>: 2025-12-03T01:11:23Z<li><strong>åˆå¹¶æ—¶é—´</strong>: 2025-12-03T20:41:05Z<li><strong>åˆå¹¶è€…</strong>: cart</ul><h2 id=miao-shu-fan-yi>æè¿°ç¿»è¯‘</h2><h1 id=mu-biao>ç›®æ ‡</h1><p>æè®®çš„ <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20934 target=_blank>â€œResources as entitiesâ€</a> PR è®© Resource å®ç°äº† Componentã€‚è¿™å¯¼è‡´äº†è¿™æ ·ä¸€ç§æƒ…å†µï¼šæˆ‘ä»¬éœ€è¦è¿™æ ·å†™ï¼š<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Component)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Thing</span><span style=color:#61676ccc>;
</span></code></pre><p>æˆ‘è®¤ä¸ºåº”è¯¥ä¸º TypeData æ·»åŠ â€œä¾èµ–â€œåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œ<code>reflect(Resource)</code> åº”è¯¥éšå« <code>reflect(Component)</code>ã€‚å¯¹äºâ€œå­ç‰¹å¾â€œ(subtrait)ç±»å‹ï¼Œæˆ‘è®¤ä¸ºæ”¯æŒè¿™ç§åŠŸèƒ½æ˜¯åˆä¹é€»è¾‘çš„/ç”¨æˆ·ä¼šå–œæ¬¢çš„ã€‚<h2 id=jie-jue-fang-an>è§£å†³æ–¹æ¡ˆ</h2><ol><li>å‘ <code>FromType&LTT></code> æ·»åŠ ä¸€ä¸ªæ–°çš„ <code>insert_dependencies</code> å‡½æ•°ï¼Œå¹¶æä¾›ä¸€ä¸ªé»˜è®¤å®ç°ï¼ˆä½¿è¿™æ˜¯ä¸€ä¸ªéç ´åæ€§å˜æ›´ï¼‰ã€‚è¿™æœ‰ç‚¹åƒæ˜¯é‡è½½äº† <code>FromType</code> ç‰¹æ€§ï¼ˆä¾‹å¦‚ï¼šåœ¨è¿™ä¸ªæ–°èƒŒæ™¯ä¸‹ï¼Œåƒ <code>GetTypeData</code> è¿™æ ·çš„åå­—å¯èƒ½æ›´å¥½ï¼‰ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªç›¸å½“å°ä¼—çš„ç‰¹æ€§/åŠŸèƒ½ç‰‡æ®µï¼Œè€Œä¸”æˆ‘å–œæ¬¢ä¸ç ´åç”¨æˆ·ä»£ç çš„æƒ³æ³•ã€‚<li>å‘ <code>TypeRegistration</code> æ·»åŠ ä¸€ä¸ªæ–°çš„ <code>register_type_data&LTT, V></code> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ºç»™å®šç±»å‹ <code>V</code> åˆå§‹åŒ– TypeData <code>T</code>ï¼Œæ’å…¥è¯¥ç±»å‹æ•°æ®ï¼Œå¹¶ä½¿ç”¨ <code>insert_dependencies</code> æ’å…¥ä»»ä½•ä¾èµ–çš„ç±»å‹æ•°æ®ã€‚<li>è°ƒæ•´ <code>Reflect</code> å®ï¼Œä½¿å…¶ä½¿ç”¨ <code>register_type_data</code> è€Œä¸æ˜¯ <code>insert(FromType::&LTSelf>::from_type())</code></ol><p>è¿™ä½¿å¾—å¯ä»¥åšåˆ°ä»¥ä¸‹äº‹æƒ…ï¼š<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl</span><span>&LTR</span><span style=color:#61676ccc>:</span><span> Resource </span><span style=color:#ed9366>+</span><span> FromReflect </span><span style=color:#ed9366>+</span><span> TypePath> FromType&LTR> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ReflectResource </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_type</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        ReflectResource
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>insert_dependencies</span><span>(</span><span style=color:#ff8f40>type_registration</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> TypeRegistration) {
</span><span>        type_registration</span><span style=color:#ed9366>.</span><span>register_type_data</span><span style=color:#ed9366>::</span><span>&LTReflectComponent, R>()</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>ç„¶åå°±å¯ä»¥çœç•¥ <code>reflect(Component)</code>ï¼š<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Resource)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Thing</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=ce-shi>æµ‹è¯•</h2><p>æˆ‘æ·»åŠ äº†ä¸€ä¸ªå•å…ƒæµ‹è¯• ğŸ˜œ<h2 id=gai-pr-de-gu-shi>è¯¥ PR çš„æ•…äº‹</h2><p>è¿™ä¸ª PR çš„æ•…äº‹å§‹äº Bevy ç”Ÿæ€ç³»ç»Ÿä¸­ä¸€ä¸ªå³å°†åˆ°æ¥çš„æ¶æ„å˜åŒ–ã€‚â€œResources as entitiesâ€ PR (#20934) æè®®è®© Resource å®ç° Componentï¼Œè¿™åœ¨è®¾è®¡ä¸Šæ˜¯åˆç†çš„ï¼Œå› ä¸º Resource æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„ Componentã€‚ç„¶è€Œï¼Œè¿™ä¸ªå˜åŒ–å¸¦æ¥äº†ä¸€ä¸ªç”¨æˆ·ä½“éªŒé—®é¢˜ï¼šå½“ä¸€ä¸ªç±»å‹æ—¢æ˜¯ Resource åˆæ˜¯ Component æ—¶ï¼Œç”¨æˆ·éœ€è¦åœ¨ <code>#[reflect(...)]</code> å±æ€§ä¸­åŒæ—¶æŒ‡å®šä¸¤è€…ã€‚<p>é—®é¢˜å¾ˆç®€å•ï¼šåœ¨å½“å‰çš„ Bevy åå°„ç³»ç»Ÿä¸­ï¼Œ<code>ReflectResource</code> å’Œ <code>ReflectComponent</code> æ˜¯ä¸¤ç§ç‹¬ç«‹çš„ç±»å‹æ•°æ®ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰è‡ªåŠ¨çš„ä¾èµ–å…³ç³»ã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Resource ç‰¹å¾ï¼Œå¹¶ä¸” Resource æ˜¯ Component çš„å­ç‰¹å¾ï¼Œé‚£ä¹ˆä»é€»è¾‘ä¸Šè®²ï¼Œä¸ºè¯¥ç±»å‹æ³¨å†Œ <code>ReflectResource</code> ä¹Ÿåº”è¯¥è‡ªåŠ¨æ³¨å†Œ <code>ReflectComponent</code>ã€‚<p>cart çš„è§£å†³æ–¹æ¡ˆéå¸¸ä¼˜é›…ã€‚ä»–æ²¡æœ‰é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼æ¥å¤„ç† Resource-Component å…³ç³»ï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ä¸ªé€šç”¨çš„ä¾èµ–æœºåˆ¶ï¼Œè®©ä»»ä½• TypeData éƒ½å¯ä»¥å£°æ˜å¯¹å…¶ä»– TypeData çš„ä¾èµ–ã€‚<p>è§£å†³æ–¹æ¡ˆçš„æ ¸å¿ƒæ˜¯å¯¹ <code>FromType</code> ç‰¹æ€§è¿›è¡Œæ‰©å±•ï¼Œå¢åŠ äº† <code>insert_dependencies</code> æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªé»˜è®¤çš„ç©ºå®ç°ï¼Œç¡®ä¿äº†å‘åå…¼å®¹æ€§ã€‚ç„¶åï¼Œåœ¨ <code>TypeRegistration</code> ä¸­æ·»åŠ äº† <code>register_type_data</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå…ˆæ’å…¥æŒ‡å®šçš„ TypeDataï¼Œç„¶åè°ƒç”¨å…¶ <code>insert_dependencies</code> æ–¹æ³•ã€‚æœ€åï¼Œä¿®æ”¹äº† <code>Reflect</code> è¡ç”Ÿå®çš„å®ç°ï¼Œç”¨æ–°çš„ <code>register_type_data</code> æ›¿æ¢äº†åŸæ¥çš„ <code>insert</code> è°ƒç”¨ã€‚<p>ä»æŠ€æœ¯å®ç°çš„è§’åº¦çœ‹ï¼Œè¿™ä¸ªè®¾è®¡æœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ã€‚é¦–å…ˆï¼Œä¾èµ–å…³ç³»æ˜¯åœ¨ TypeData å±‚é¢å®šä¹‰çš„ï¼Œè€Œä¸æ˜¯åœ¨ç±»å‹æ³¨å†Œå±‚é¢ï¼Œè¿™ç¬¦åˆå…³æ³¨ç‚¹åˆ†ç¦»çš„åŸåˆ™ã€‚å…¶æ¬¡ï¼Œé»˜è®¤å®ç°ç¡®ä¿äº†éç ´åæ€§å˜æ›´â€”â€”ç°æœ‰çš„ TypeData å®ç°ä¸éœ€è¦ä»»ä½•ä¿®æ”¹ã€‚ç¬¬ä¸‰ï¼Œè®¾è®¡æ˜¯æ³›å‹çš„ï¼Œå¯ä»¥å¤„ç†ä»»æ„ç±»å‹çš„ TypeData ä¾èµ–ï¼Œè€Œä¸ä»…ä»…æ˜¯ Resource-Component å…³ç³»ã€‚<p>åœ¨å®ç°ç»†èŠ‚ä¸Šï¼Œ<code>register_type_data</code> æ–¹æ³•å·§å¦™åœ°åˆ©ç”¨äº† Rust çš„ç±»å‹ç³»ç»Ÿã€‚å®ƒè¦æ±‚ <code>T: TypeData + FromType&LTV></code>ï¼Œè¿™æ„å‘³ç€è°ƒç”¨è€…å¿…é¡»æä¾›èƒ½åˆ›å»º TypeData çš„ <code>FromType</code> å®ç°ã€‚ç„¶åæ–¹æ³•é€šè¿‡ <code>T::from_type()</code> åˆ›å»ºå®ä¾‹å¹¶æ’å…¥ï¼Œå†è°ƒç”¨ <code>T::insert_dependencies(self)</code> æ¥æ’å…¥ä¾èµ–ã€‚<p>è¿™ç§è®¾è®¡æ¨¡å¼åœ¨åå°„ç³»ç»Ÿä¸­å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ç±»å‹æ•°æ®çš„ä¾èµ–å…³ç³»è¢«é™æ€åœ°å®šä¹‰åœ¨ <code>FromType</code> å®ç°ä¸­ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—ã€‚è¿™æ—¢ä¿è¯äº†æ€§èƒ½ï¼ˆç¼–è¯‘æ—¶å†³å®šï¼‰ï¼Œåˆæä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§ã€‚<p>ä¿®æ”¹åçš„ <code>Reflect</code> è¡ç”Ÿå®ç°åœ¨ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»ã€‚è¿™æ„å‘³ç€å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä»–ä»¬å¯ä»¥åªå†™ <code>#[reflect(Resource)]</code>ï¼Œè€Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºä»–ä»¬æ³¨å†Œ <code>ReflectComponent</code>ï¼ˆå‰ææ˜¯ç›¸åº”çš„ <code>FromType</code> å®ç°å®šä¹‰äº†è¿™ç§ä¾èµ–å…³ç³»ï¼‰ã€‚<p>è¿™ä¸ª PR ä¹ŸåŒ…å«äº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨ TypeData ä¾èµ–ã€‚æµ‹è¯•ä¸­å®šä¹‰äº†ä¸¤ä¸ªç®€å•çš„ TypeData ç»“æ„ä½“ <code>ReflectA</code> å’Œ <code>ReflectB</code>ï¼Œå…¶ä¸­ <code>ReflectA</code> çš„ <code>insert_dependencies</code> æ–¹æ³•ä¼šæ’å…¥ <code>ReflectB</code>ã€‚æµ‹è¯•éªŒè¯äº†å½“æ³¨å†Œå¸¦æœ‰ <code>#[reflect(A)]</code> å±æ€§çš„ç±»å‹æ—¶ï¼Œä¸¤ç§ç±»å‹æ•°æ®éƒ½ä¼šè¢«æ­£ç¡®åœ°æ’å…¥ã€‚<p>ä»å·¥ç¨‹è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰å‡ ä¸ªä¼˜ç‚¹ã€‚é¦–å…ˆï¼Œå®ƒè§£å†³äº†å…·ä½“çš„ç”¨æˆ·ç—›ç‚¹ï¼Œä½¿ API æ›´åŠ ç®€æ´ã€‚å…¶æ¬¡ï¼Œå®ƒå»ºç«‹äº†ä¸€ä¸ªå¯æ‰©å±•çš„æ¨¡å¼ï¼Œæœªæ¥å…¶ä»–ç±»ä¼¼çš„ä¾èµ–å…³ç³»ä¹Ÿå¯ä»¥è½»æ¾æ·»åŠ ã€‚ç¬¬ä¸‰ï¼Œå®ç°æ˜¯éä¾µå…¥æ€§çš„ï¼Œä¸ä¼šå½±å“ç°æœ‰ä»£ç ã€‚<p>æ½œåœ¨çš„æ”¹è¿›ç‚¹åŒ…æ‹¬ï¼šå½“å‰è®¾è®¡ä¸­ï¼Œä¾èµ–å…³ç³»æ˜¯å•å‘çš„ï¼ˆA ä¾èµ– Bï¼‰ï¼Œä¸æ”¯æŒå¾ªç¯ä¾èµ–ã€‚è¿™åœ¨å®é™…ä½¿ç”¨ä¸­é€šå¸¸ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå¾ªç¯ä¾èµ–é€šå¸¸æ˜¯è®¾è®¡é—®é¢˜çš„æ ‡å¿—ã€‚å¦ä¸€ä¸ªè€ƒè™‘æ˜¯ï¼Œä¾èµ–å…³ç³»æ˜¯é€šè¿‡é™æ€æ–¹æ³•å®šä¹‰çš„ï¼Œè¿™æ„å‘³ç€æ— æ³•æ ¹æ®å…·ä½“ç±»å‹çš„ç‰¹æ€§åŠ¨æ€å†³å®šä¾èµ–å…³ç³»ã€‚<h2 id=shi-jue-biao-shi>è§†è§‰è¡¨ç¤º</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[FromType trait] -->|æ‰©å±•| B[æ–°å¢ insert_dependencies æ–¹æ³•]
</span><span>    B -->|é»˜è®¤å®ç°| C[ç©ºæ“ä½œ]
</span><span>    D[TypeRegistration] -->|æ–°å¢| E[register_type_data æ–¹æ³•]
</span><span>    E -->|è°ƒç”¨| F[T::from_type()]
</span><span>    E -->|è°ƒç”¨| G[T::insert_dependencies()]
</span><span>    H[Reflect å®] -->|ä½¿ç”¨| E[register_type_data]
</span><span>    I[ReflectResource] -->|ä¾èµ–| J[ReflectComponent]
</span></code></pre><h2 id=guan-jian-wen-jian-bian-geng>å…³é”®æ–‡ä»¶å˜æ›´</h2><ol><li><p><strong>crates/bevy_reflect/src/lib.rs</strong> (+30/-0)</p> <p>è¿™ä¸ªæ–‡ä»¶æ·»åŠ äº†ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¥éªŒè¯ TypeData ä¾èµ–åŠŸèƒ½ã€‚æµ‹è¯•å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸¤ä¸ªç›¸å…³çš„ TypeData ç»“æ„ä½“ï¼Œå¹¶éªŒè¯ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®å·¥ä½œã€‚</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>type_data_dependency</span><span>() {
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Reflect)]
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(A)]
</span><span>    </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>X</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone)]
</span><span>    </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>ReflectA</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>impl</span><span>&LTT> FromType&LTT> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ReflectA </span><span>{
</span><span>        </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_type</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            ReflectA
</span><span>        }
</span><span>        
</span><span>        </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>insert_dependencies</span><span>(</span><span style=color:#ff8f40>type_registration</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> TypeRegistration) {
</span><span>            type_registration</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(ReflectB)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone)]
</span><span>    </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>ReflectB</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> registry </span><span style=color:#ed9366>= </span><span>TypeRegistry</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>    registry</span><span style=color:#ed9366>.</span><span>register</span><span style=color:#ed9366>::</span><span>&LTX>()</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>let</span><span> registration </span><span style=color:#ed9366>=</span><span> registry</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTX>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#f07171>assert!</span><span>(registration</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>::</span><span>&LTReflectA>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_some</span><span>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#f07171>assert!</span><span>(registration</span><span style=color:#ed9366>.</span><span>data</span><span style=color:#ed9366>::</span><span>&LTReflectB>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_some</span><span>())</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><li><p><strong>crates/bevy_reflect/src/type_registry.rs</strong> (+11/-0)</p> <p>è¿™ä¸ªæ–‡ä»¶æœ‰ä¸¤ä¸ªå…³é”®ä¿®æ”¹ã€‚é¦–å…ˆï¼Œå‘ <code>FromType</code> trait æ·»åŠ äº† <code>insert_dependencies</code> æ–¹æ³•åŠå…¶é»˜è®¤å®ç°ã€‚å…¶æ¬¡ï¼Œåœ¨ <code>TypeRegistration</code> ä¸­æ·»åŠ äº† <code>register_type_data</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è´Ÿè´£æ’å…¥ç±»å‹æ•°æ®åŠå…¶ä¾èµ–ã€‚</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>FromType</span><span>&LTT> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_type</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// æ–°å¢çš„æ–¹æ³•
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>insert_dependencies</span><span>(</span><span style=color:#ff8f40>_type_registration</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> TypeRegistration) {}
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>TypeRegistration </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// æ–°å¢çš„æ–¹æ³•
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register_type_data</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> TypeData </span><span style=color:#ed9366>+ </span><span>FromType&LTV>, V>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(T</span><span style=color:#ed9366>::</span><span>from_type())</span><span style=color:#61676ccc>;
</span><span>        T</span><span style=color:#ed9366>::</span><span>insert_dependencies(</span><span style=color:#55b4d4;font-style:italic>self</span><span>)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><li><p><strong>crates/bevy_reflect/derive/src/registration.rs</strong> (+1/-1)</p> <p>è¿™ä¸ªæ–‡ä»¶ä¿®æ”¹äº† <code>Reflect</code> è¡ç”Ÿå®çš„å®ç°ï¼Œå°†åŸæ¥çš„ç›´æ¥æ’å…¥æ“ä½œæ›¿æ¢ä¸ºæ–°çš„ <code>register_type_data</code> è°ƒç”¨ã€‚è¿™æ˜¯ç”¨æˆ·ä»£ç å®é™…è°ƒç”¨çš„åœ°æ–¹ã€‚</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// ä¿®æ”¹å‰:
</span><span style=color:#ed9366>#</span><span>(registration</span><span style=color:#ed9366>.</span><span>insert</span><span style=color:#ed9366>::</span><span><</span><span style=color:#f51818>#</span><span>registration_data</span><span style=color:#ed9366>></span><span>(</span><span style=color:#ed9366>#</span><span>bevy_reflect_path</span><span style=color:#ed9366>::</span><span>FromType</span><span style=color:#ed9366>::</span><span><</span><span style=color:#fa6e32>Self</span><span>></span><span style=color:#ed9366>::</span><span>from_type())</span><span style=color:#61676ccc>;</span><span>)</span><span style=color:#ed9366>*
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// ä¿®æ”¹å:
</span><span style=color:#ed9366>#</span><span>(registration</span><span style=color:#ed9366>.</span><span>register_type_data</span><span style=color:#ed9366>::</span><span><</span><span style=color:#f51818>#</span><span>registration_data</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>></span><span>()</span><span style=color:#61676ccc>;</span><span>)</span><span style=color:#ed9366>*
</span></code></pre></ol><h2 id=jin-yi-bu-yue-du>è¿›ä¸€æ­¥é˜…è¯»</h2><ol><li><strong>Rust ç‰¹å¾å’Œæ³›å‹</strong>: äº†è§£ Rust çš„ç‰¹å¾(trait)ç³»ç»Ÿã€æ³›å‹å’Œå…³è”ç±»å‹å¯¹äºç†è§£è¿™ä¸ª PR å¾ˆé‡è¦<li><strong>Bevy åå°„ç³»ç»Ÿ</strong>: æŸ¥çœ‹ Bevy çš„åå°„æ–‡æ¡£äº†è§£ TypeDataã€TypeRegistration å’Œ FromType çš„å·¥ä½œåŸç†<li><strong>ä¾èµ–æ³¨å…¥æ¨¡å¼</strong>: è¿™ä¸ª PR å®ç°äº†ä¸€ç§ç®€å•çš„ç¼–è¯‘æ—¶ä¾èµ–æ³¨å…¥æ¨¡å¼<li><strong>å®ç¼–ç¨‹</strong>: äº†è§£ Rust çš„è¿‡ç¨‹å®å¦‚ä½•ç”Ÿæˆä»£ç ï¼Œç‰¹åˆ«æ˜¯è¡ç”Ÿå®</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22016.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>