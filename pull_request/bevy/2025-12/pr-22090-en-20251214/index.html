<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22090 Fix non-srgb `RenderTarget::Image`
        
    </title><meta content="#22090 Fix non-srgb `RenderTarget::Image`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-12/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-12-14</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-12/pr-22090-zh-cn-20251214>中文</a></div></div><div class=pr-content><h1 id=title-fix-non-srgb-rendertarget-image>Title: Fix non-srgb <code>RenderTarget::Image</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix non-srgb <code>RenderTarget::Image</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22090<li><strong>Author</strong>: beicause<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Rendering, S-Ready-For-Final-Review, P-Regression<li><strong>Created</strong>: 2025-12-11T21:53:31Z<li><strong>Merged</strong>: 2025-12-14T23:22:16Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><p>Fixes https://github.com/bevyengine/bevy/pull/22031#issuecomment-3640036590. Fixes #15201. #22031 makes <code>ViewTarget::out_texture_format</code> to return the underlying texture’s format, which causes some issues:<ol><li><code>ExtractedWindow::swap_chain_texture_view</code> always uses srgb view. But the underlying swap chain texture in WebGPU can be Bgra8unorm, leading to format mismatch between the render pipeline and the render pass.<li>We can no longer use srgb view for non-srgb target texture, it will panic due to incompatible pipeline:</ol><pre class=language-rs data-lang=rs style=color:#61676c;background-color:#fafafa><code class=language-rs data-lang=rs><span>    </span><span style=color:#fa6e32>let mut</span><span> image </span><span style=color:#ed9366>= </span><span>Image</span><span style=color:#ed9366>::</span><span>new_target_texture(</span><span style=color:#ff8f40>512</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>512</span><span style=color:#61676ccc>, </span><span>TextureFormat</span><span style=color:#ed9366>::</span><span>Rgba8Unorm)</span><span style=color:#61676ccc>;
</span><span>    image</span><span style=color:#ed9366>.</span><span>texture_view_descriptor </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(bevy_render</span><span style=color:#ed9366>::</span><span>render_resource</span><span style=color:#ed9366>::</span><span>TextureViewDescriptor {
</span><span>        format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(TextureFormat</span><span style=color:#ed9366>::</span><span>Rgba8UnormSrgb)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>    image</span><span style=color:#ed9366>.</span><span>texture_descriptor</span><span style=color:#ed9366>.</span><span>view_formats </span><span style=color:#ed9366>= &</span><span>[TextureFormat</span><span style=color:#ed9366>::</span><span>Rgba8UnormSrgb]</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=solution>Solution</h2><p>Reverts #22031. Renames some <code>format</code> to <code>view_format</code> explicitly. Adds <code>view_format</code> to <code>GpuImage</code> and <code>Image::new_target_texture</code> so we can make render pipeline match render pass texture view.<h2 id=testing>Testing</h2><p>Tested <code>render_to_texture</code> and <code>screenshot</code> examples on linux and webgpu.<details><summary>The rendered Rgba8Unorm texture with or without srgb view in MeshMaterial3d looks the same, but the underlaying data is different:</summary> <p>With srgb view: <img alt=屏幕截图_20251212_223355 height=640 src=https://github.com/user-attachments/assets/d320bad9-d11a-4d3d-93a9-879af6413658 width=912></p> <p>Without srgb view: <img alt=屏幕截图_20251212_223313 height=640 src=https://github.com/user-attachments/assets/522abf23-9c85-468d-8d17-a94495ee4452 width=912></p></details><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a regression introduced by PR #22031 that caused format mismatches between render pipelines and render passes when dealing with non-sRGB render targets. The issue surfaced in two specific scenarios: WebGPU compatibility problems and crashes when using sRGB views on non-sRGB textures.<p>The core problem stemmed from a change in <code>ViewTarget::out_texture_format()</code> that started returning the underlying texture’s format instead of considering the texture view format. This broke the distinction between a texture’s storage format and how it’s interpreted during rendering.<p>The solution involves reverting the problematic change from #22031 and introducing a clearer separation between texture format and view format. The implementation adds a new <code>texture_view_format</code> field to <code>GpuImage</code> and updates the <code>Image::new_target_texture</code> function to accept an optional view format parameter. This allows the render system to properly match pipeline expectations with actual render pass configurations.<p>One key insight driving this fix is that textures can have multiple view formats, allowing the same underlying texture data to be interpreted differently (e.g., as sRGB or linear color space). The PR introduces a <code>TextureSrgbViewFormats</code> trait that provides the sRGB view formats for texture formats that support them. This is crucial for maintaining compatibility across different graphics APIs and hardware configurations.<p>The changes cascade through the rendering pipeline, affecting how textures are prepared, how render targets are configured, and how screenshots are captured. Each component that interacts with texture formats needed updating to distinguish between the base format and the view format.<p>An important aspect of this fix is that it maintains backward compatibility while fixing the regression. The example code updates show how to properly create render target textures with sRGB views, demonstrating the correct usage pattern for developers.<p>The fix also addresses WebGPU compatibility issues where swap chain textures might be in non-sRGB formats (like <code>Bgra8Unorm</code>) but the rendering pipeline expects sRGB views. By properly tracking the view format separately, the system can ensure compatibility across different platforms and graphics APIs.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Image Asset] --> B[GpuImage Conversion]
</span><span>    B --> C[Texture View Creation]
</span><span>    C --> D[Render Pipeline Configuration]
</span><span>    D --> E[Render Pass Execution]
</span><span>    
</span><span>    F[Texture Format] --> B
</span><span>    G[View Format] --> C
</span><span>    H[TextureSrgbViewFormats] --> G
</span><span>    
</span><span>    I[Swap Chain] --> J[ExtractedWindow]
</span><span>    J --> K[swap_chain_texture_view_format]
</span><span>    K --> C
</span><span>    
</span><span>    L[Camera/RenderTarget] --> M[ViewTarget]
</span><span>    M --> N[out_texture_view_format]
</span><span>    N --> D
</span><span>    
</span><span>    style A fill:#e1f5fe
</span><span>    style I fill:#f3e5f5
</span><span>    style L fill:#e8f5e8
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-image-src-image-rs-138-3><code>crates/bevy_image/src/image.rs</code> (+138/-3)</h3><p>Added the <code>TextureSrgbViewFormats</code> trait and updated <code>Image::new_target_texture</code> to support separate texture and view formats. The trait provides a mapping from base texture formats to their sRGB view format equivalents.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Key addition: TextureSrgbViewFormats trait
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>TextureSrgbViewFormats </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>srgb_view_formats</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static </span><span>[TextureFormat]</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Updated function signature
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new_target_texture</span><span>(
</span><span>    </span><span style=color:#ff8f40>width</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>,
</span><span>    </span><span style=color:#ff8f40>height</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>,
</span><span>    </span><span style=color:#ff8f40>format</span><span style=color:#61676ccc>:</span><span> TextureFormat,
</span><span>    </span><span style=color:#ff8f40>view_format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTTextureFormat>,  </span><span style=color:#abb0b6;font-style:italic>// New parameter
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    texture_descriptor</span><span style=color:#61676ccc>:</span><span> TextureDescriptor {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        view_formats</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>match</span><span> view_format {
</span><span>            </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#ed9366>_</span><span>) </span><span style=color:#ed9366>=></span><span> format</span><span style=color:#ed9366>.</span><span style=color:#f07171>srgb_view_formats</span><span>()</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Use sRGB view formats if specified
</span><span>            </span><span style=color:#55b4d4;font-style:italic>None </span><span style=color:#ed9366>=> &</span><span>[]</span><span style=color:#61676ccc>,
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    texture_view_descriptor</span><span style=color:#61676ccc>:</span><span> view_format</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>f</span><span>| TextureViewDescriptor {
</span><span>        format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(f)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Set the view format
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default()
</span><span>    })</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-texture-gpu-image-rs-6-1><code>crates/bevy_render/src/texture/gpu_image.rs</code> (+6/-1)</h3><p>Added <code>texture_view_format</code> field to <code>GpuImage</code> struct to track the view format separately from the texture format.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GpuImage </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture</span><span style=color:#61676ccc>:</span><span> Texture,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture_view</span><span style=color:#61676ccc>:</span><span> TextureView,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture_format</span><span style=color:#61676ccc>:</span><span> TextureFormat,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>texture_view_format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTTextureFormat>,  </span><span style=color:#abb0b6;font-style:italic>// New field
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-view-mod-rs-4-6><code>crates/bevy_render/src/view/mod.rs</code> (+4/-6)</h3><p>Changed <code>ViewTarget::out_texture_format()</code> to <code>out_texture_view_format()</code> to return the view format instead of the texture format.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>out_texture_format</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> TextureFormat {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>out_texture</span><span style=color:#ed9366>.</span><span>format
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>out_texture_view_format</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> TextureFormat {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>out_texture</span><span style=color:#ed9366>.</span><span>view_format  </span><span style=color:#abb0b6;font-style:italic>// Returns the view format
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-view-window-mod-rs-14-5><code>crates/bevy_render/src/view/window/mod.rs</code> (+14/-5)</h3><p>Added <code>swap_chain_texture_view_format</code> to <code>ExtractedWindow</code> and updated surface creation to properly handle view formats.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ExtractedWindow </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>pub </span><span>swap_chain_texture_format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTTextureFormat>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>swap_chain_texture_view_format</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTTextureFormat>,  </span><span style=color:#abb0b6;font-style:italic>// New field
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ExtractedWindow </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>set_swapchain_texture</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>frame</span><span style=color:#61676ccc>: </span><span>wgpu</span><span style=color:#ed9366>::</span><span>SurfaceTexture) {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>swap_chain_texture_view_format </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(frame</span><span style=color:#ed9366>.</span><span>texture</span><span style=color:#ed9366>.</span><span style=color:#f07171>format</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_srgb_suffix</span><span>())</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-camera-rs-6-6><code>crates/bevy_render/src/camera.rs</code> (+6/-6)</h3><p>Renamed <code>get_texture_format</code> to <code>get_texture_view_format</code> and updated it to return the view format when available.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Updated method name and implementation
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>get_texture_view_format</span><span><</span><span style=color:#fa6e32>'a</span><span>>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>windows</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a</span><span> ExtractedWindows,
</span><span>    </span><span style=color:#ff8f40>images</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span>RenderAssets&LTGpuImage>,
</span><span>    </span><span style=color:#ff8f40>manual_texture_views</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a</span><span> ManualTextureViews,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTTextureFormat> {
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self </span><span>{
</span><span>        NormalizedRenderTarget</span><span style=color:#ed9366>::</span><span>Window(window_ref) </span><span style=color:#ed9366>=></span><span> windows
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(</span><span style=color:#ed9366>&</span><span>window_ref</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>())
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>and_then</span><span>(|</span><span style=color:#ff8f40>window</span><span>| window</span><span style=color:#ed9366>.</span><span>swap_chain_texture_view_format)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Use view format
</span><span>        NormalizedRenderTarget</span><span style=color:#ed9366>::</span><span>Image(image_target) </span><span style=color:#ed9366>=></span><span> images
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(</span><span style=color:#ed9366>&</span><span>image_target</span><span style=color:#ed9366>.</span><span>handle)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>image</span><span>| image</span><span style=color:#ed9366>.</span><span>texture_view_format</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or</span><span>(image</span><span style=color:#ed9366>.</span><span>texture_format))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/#texture-formats target=_blank>WebGPU Texture Formats Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/SRGB target=_blank>sRGB Color Space</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/render/camera/enum.RenderTarget.html target=_blank>Bevy Render Targets Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/wgpu/latest/wgpu/struct.TextureDescriptor.html#structfield.view_formats target=_blank>wgpu Texture View Formats</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/wgpu/latest/wgpu/enum.TextureFormat.html target=_blank>GPU Texture Compression Formats</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-12/pr_22090.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>