<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20811 fix reflect feature gate
        
    </title><meta content="#20811 fix reflect feature gate" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-01</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-20811-zh-cn-20250901>中文</a></div></div><div class=pr-content><h1 id=fix-reflect-feature-gate>fix reflect feature gate</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fix reflect feature gate<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20811<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Windowing, S-Ready-For-Final-Review, A-Reflection, D-Straightforward<li><strong>Created</strong>: 2025-08-31T20:28:32Z<li><strong>Merged</strong>: 2025-09-01T19:57:15Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>fix building bevy_window with reflect disabled</ul><h2 id=solution>Solution</h2><ul><li>I missed one last thing to gate last time I tried to fix it</ul><h2 id=testing>Testing</h2><p><code>cargo build -p bevy_window --no-default-features --features bevy_math/libm</code><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a conditional compilation issue in the Bevy windowing system where reflection-related code wasn’t properly gated behind the appropriate feature flag. The problem occurred when building the <code>bevy_window</code> crate with the <code>reflect</code> feature disabled, causing compilation failures due to missing reflection components.<p>The core issue was straightforward - an import statement for <code>ReflectComponent</code> from <code>bevy_ecs</code> wasn’t properly guarded by the <code>bevy_reflect</code> feature flag. This meant that when reflection was disabled, the compiler would encounter an import that shouldn’t exist, causing the build to fail.<p>The solution implemented was minimal and surgical: adding the appropriate <code>#[cfg(feature = "bevy_reflect")]</code> attribute to the problematic import. This approach maintains the existing architecture while ensuring proper conditional compilation behavior. The fix follows the same pattern already established in the codebase for other reflection-related imports in the same file.<p>This type of issue is common in Rust projects using feature flags extensively, where it’s easy to miss conditional compilation guards on individual imports. The testing approach described in the PR - using <code>cargo build -p bevy_window --no-default-features --features bevy_math/libm</code> - verifies that the windowing system can now compile without reflection support, confirming the fix works as intended.<p>The change demonstrates good Rust practices for feature gating: keeping conditional compilation as close to the usage as possible and maintaining consistency with existing patterns in the codebase.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_window crate] --> B[Conditional Compilation]
</span><span>    B --> C[With reflect feature]
</span><span>    B --> D[Without reflect feature]
</span><span>    C --> E[Includes ReflectComponent import]
</span><span>    D --> F[Excludes ReflectComponent import]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-window-src-cursor-mod-rs-3-1><code>crates/bevy_window/src/cursor/mod.rs</code> (+3/-1)</h3><p>This file handles cursor-related functionality for the windowing system. The change ensures proper conditional compilation when the reflection feature is disabled.<p><strong>Key modifications:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>{component</span><span style=color:#ed9366>::</span><span>Component</span><span style=color:#61676ccc>, </span><span>reflect</span><span style=color:#ed9366>::</span><span>ReflectComponent}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>Component</span><span style=color:#61676ccc>;
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_reflect"</span><span>)]
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>reflect</span><span style=color:#ed9366>::</span><span>ReflectComponent</span><span style=color:#61676ccc>;
</span></code></pre><p>The change splits the import statement and adds the feature guard to the reflection-specific import, ensuring it’s only included when the <code>bevy_reflect</code> feature is enabled.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Rust Conditional Compilation</a> - Official Rust documentation on feature flags and conditional compilation<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/4-resources/4.4-reflection target=_blank>Bevy Reflection System</a> - Bevy’s reflection system documentation<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Cargo Features Guide</a> - How to work with features in Cargo</ul><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_window/src/cursor/mod.rs b/crates/bevy_window/src/cursor/mod.rs
</span><span>index 3f297a574f108..257950d7f645f 100644
</span><span style=color:#c594c5>--- a/crates/bevy_window/src/cursor/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_window/src/cursor/mod.rs
</span><span style=color:#c594c5>@@ -8,7 +8,9 @@ </span><span style=color:#399ee6>mod system_cursor;
</span><span> pub use custom_cursor::*;
</span><span> pub use system_cursor::*;
</span><span> 
</span><span style=color:#f07171>-use bevy_ecs::{component::Component, reflect::ReflectComponent};
</span><span style=color:#86b300>+use bevy_ecs::component::Component;
</span><span style=color:#86b300>+#[cfg(feature = "bevy_reflect")]
</span><span style=color:#86b300>+use bevy_ecs::reflect::ReflectComponent;
</span><span> #[cfg(feature = "bevy_reflect")]
</span><span> use bevy_reflect::{std_traits::ReflectDefault, Reflect};
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_20811.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>