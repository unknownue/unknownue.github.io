<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21297 disable macos/ios check for clustered decals
        
    </title><meta content="#21297 disable macos/ios check for clustered decals" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21297-zh-cn-20250930>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: disable macos/ios check for clustered decals<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21297<li><strong>Author</strong>: robtfm<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: None<li><strong>Created</strong>: 2025-09-30T15:06:22Z<li><strong>Merged</strong>: 2025-09-30T22:49:26Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>disable macos/ios check for clustered decals<h2 id=solution>Solution</h2><p>disable macos/ios check for clustered decals<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a platform-specific limitation in Bevy’s rendering system. The core issue was that clustered decals, a rendering feature for applying decals to 3D surfaces, were being disabled on macOS and iOS platforms due to a conditional check in the feature detection system.<p>The problem originated from a technical limitation where clustered decals required specific GPU features that weren’t consistently available across all platforms. The original implementation included a platform check that explicitly excluded macOS and iOS:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>binding_arrays_are_usable</span><span>(render_device</span><span style=color:#61676ccc>,</span><span> render_adapter)
</span><span>    </span><span style=color:#ed9366>&& </span><span style=color:#f07171>cfg!</span><span>(</span><span style=color:#f07171>not</span><span>(</span><span style=color:#f07171>any</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"macos"</span><span style=color:#61676ccc>,</span><span> target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"ios"</span><span>)))
</span><span>    </span><span style=color:#ed9366>&& </span><span style=color:#f07171>cfg!</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"pbr_clustered_decals"</span><span>)
</span></code></pre><p>This conditional logic meant that even when the underlying hardware and drivers on Apple platforms supported the required features, the feature would remain disabled due to the hardcoded platform exclusion.<p>The solution approach was straightforward: remove the platform-specific restriction while keeping the other validation checks intact. This change allows the rendering system to properly evaluate hardware capabilities on Apple platforms rather than making assumptions based solely on the operating system.<p>The implementation consisted of a single-line change that removed the platform check while preserving the essential validation for binding arrays and feature flags. This maintains the safety of only enabling the feature when the actual hardware supports it, while expanding availability to properly supported Apple devices.<p>From a technical perspective, this change demonstrates an important principle in cross-platform graphics programming: feature detection should be based on actual hardware capabilities rather than platform assumptions. The remaining <code>binding_arrays_are_usable</code> function performs runtime checks to ensure the required GPU features are present, making the platform check redundant and potentially overly restrictive.<p>The impact of this change is that macOS and iOS users with compatible hardware can now benefit from clustered decals rendering. This improves feature parity across platforms and ensures that Apple users with capable hardware aren’t unnecessarily limited by platform-based restrictions.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Clustered Decals Feature Check] --> B{Binding Arrays Usable?}
</span><span>    B -->|Yes| C{Platform Check?}
</span><span>    B -->|No| D[Feature Disabled]
</span><span>    C -->|Old: Not macOS/iOS| E[Feature Enabled]
</span><span>    C -->|New: All Platforms| E
</span><span>    E --> F[Clustered Decals Active]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-pbr-src-decal-clustered-rs-0-1><code>crates/bevy_pbr/src/decal/clustered.rs</code> (+0/-1)</h3><p>This file contains the feature detection logic for clustered decals. The change removed the platform-specific exclusion for macOS and iOS.<p><strong>Key Modification:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>clustered_decals_are_usable</span><span>(
</span><span>    </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderDevice,
</span><span>    </span><span style=color:#ff8f40>render_adapter</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderAdapter,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// See issue #17553.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Re-enable this when `wgpu` has first-class bindless.
</span><span>    </span><span style=color:#f07171>binding_arrays_are_usable</span><span>(render_device</span><span style=color:#61676ccc>,</span><span> render_adapter)
</span><span>        </span><span style=color:#ed9366>&& </span><span style=color:#f07171>cfg!</span><span>(</span><span style=color:#f07171>not</span><span>(</span><span style=color:#f07171>any</span><span>(target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"macos"</span><span style=color:#61676ccc>,</span><span> target_os </span><span style=color:#ed9366>= </span><span style=color:#86b300>"ios"</span><span>)))
</span><span>        </span><span style=color:#ed9366>&& </span><span style=color:#f07171>cfg!</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"pbr_clustered_decals"</span><span>)
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>clustered_decals_are_usable</span><span>(
</span><span>    </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderDevice,
</span><span>    </span><span style=color:#ff8f40>render_adapter</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>RenderAdapter,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// See issue #17553.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Re-enable this when `wgpu` has first-class bindless.
</span><span>    </span><span style=color:#f07171>binding_arrays_are_usable</span><span>(render_device</span><span style=color:#61676ccc>,</span><span> render_adapter)
</span><span>        </span><span style=color:#ed9366>&& </span><span style=color:#f07171>cfg!</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"pbr_clustered_decals"</span><span>)
</span><span>}
</span></code></pre><p>The change removes the platform restriction while keeping the hardware capability check (<code>binding_arrays_are_usable</code>) and feature flag check intact. This allows the feature to be enabled on Apple platforms when the underlying hardware supports the required features.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/rendering/ target=_blank>Bevy Rendering Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/#bindings target=_blank>WebGPU Binding Model</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/gfx-rs/wgpu target=_blank>Cross-platform Graphics Programming</a> - The graphics backend used by Bevy<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Feature_detection target=_blank>Feature Detection vs Platform Detection</a> - The principle of detecting capabilities rather than assuming based on platform</ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_pbr/src/decal/clustered.rs b/crates/bevy_pbr/src/decal/clustered.rs
</span><span>index 857969510bd05..7aeed1518ed77 100644
</span><span style=color:#c594c5>--- a/crates/bevy_pbr/src/decal/clustered.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_pbr/src/decal/clustered.rs
</span><span style=color:#c594c5>@@ -437,6 +437,5 @@ </span><span style=color:#399ee6>pub fn clustered_decals_are_usable(
</span><span>     // See issue #17553.
</span><span>     // Re-enable this when `wgpu` has first-class bindless.
</span><span>     binding_arrays_are_usable(render_device, render_adapter)
</span><span style=color:#f07171>-        && cfg!(not(any(target_os = "macos", target_os = "ios")))
</span><span>         && cfg!(feature = "pbr_clustered_decals")
</span><span> }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21297.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>