<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20807 Bump hashbrown to 0.16.0
        
    </title><meta content="#20807 Bump hashbrown to 0.16.0" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-02</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-20807-zh-cn-20250902>中文</a></div></div><div class=pr-content><h1 id=bump-hashbrown-to-0-16-0>Bump hashbrown to 0.16.0</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Bump hashbrown to 0.16.0<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20807<li><strong>Author</strong>: mirsella<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Dependencies, A-Cross-Cutting, X-Uncontroversial, D-Straightforward, S-Needs-Review<li><strong>Created</strong>: 2025-08-31T12:41:59Z<li><strong>Merged</strong>: 2025-09-02T09:06:52Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>use the latest hashbrown, and foldhash version (foldhash went from 0.1.5 to 0.2.0) small performance improvement in foldhash.<h1 id=notes>Notes</h1><p><code>FoldHasher</code> now takes a lifetime, had to specify it.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a routine but important maintenance task: updating two key dependencies in the Bevy engine. The primary goal was to upgrade hashbrown from version 0.15.1 to 0.16.0 and foldhash from 0.1.3 to 0.2.0. These updates provide performance improvements and bug fixes from the upstream crates.<p>The challenge emerged when the foldhash update introduced a breaking API change. The <code>FoldHasher</code> type now requires a lifetime parameter, which necessitated updates throughout the codebase. This is a common pattern in dependency updates where minor version changes can introduce breaking API modifications that must be propagated through the consuming code.<p>The implementation involved straightforward but widespread changes across multiple Cargo.toml files to update the version numbers. More significantly, several type annotations needed to be updated to include the new lifetime parameter on <code>FoldHasher</code> and related types.<p>In <code>bevy_platform/src/hash.rs</code>, the <code>FixedHasher</code> implementation had to be updated to specify the <code>'static</code> lifetime for its associated <code>DefaultHasher</code> type:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Hasher </span><span style=color:#ed9366>=</span><span> DefaultHasher</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Hasher </span><span style=color:#ed9366>= </span><span>DefaultHasher<</span><span style=color:#fa6e32>'static</span><span>></span><span style=color:#61676ccc>;
</span></code></pre><p>Similarly, in <code>bevy_reflect/src/impls/foldhash.rs</code>, all instances of <code>FoldHasher</code> in the <code>impl_type_path!</code> macros needed to include the lifetime parameter:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>impl_type_path!</span><span>(</span><span style=color:#ed9366>::</span><span>foldhash</span><span style=color:#ed9366>::</span><span>fast</span><span style=color:#ed9366>::</span><span>FoldHasher)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>impl_type_path!</span><span>(</span><span style=color:#ed9366>::</span><span>foldhash</span><span style=color:#ed9366>::</span><span>fast</span><span style=color:#ed9366>::</span><span>FoldHasher<</span><span style=color:#fa6e32>'a</span><span>>)</span><span style=color:#61676ccc>;
</span></code></pre><p>The <code>reflect_hasher()</code> function in <code>bevy_reflect/src/utility.rs</code> also required the same lifetime annotation update to maintain compatibility with the new API.<p>These changes demonstrate a common pattern in Rust dependency management: when upstream crates introduce lifetime parameters, consumers must propagate these changes through their type annotations. The PR successfully handles this breaking change while maintaining all existing functionality.<p>The impact of this update is primarily performance-oriented, leveraging the improvements in the newer versions of hashbrown and foldhash. Since these crates are fundamental to Bevy’s hashing operations, even small performance gains can have meaningful effects across the engine.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[hashbrown 0.15.1] --> B[hashbrown 0.16.0]
</span><span>    C[foldhash 0.1.3] --> D[foldhash 0.2.0]
</span><span>    B --> E[API Breaking Change]
</span><span>    D --> E
</span><span>    E --> F[Lifetime Parameter Required]
</span><span>    F --> G[Update Type Annotations]
</span><span>    G --> H[bevy_platform]
</span><span>    G --> I[bevy_reflect]
</span><span>    G --> J[tools]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><strong><code>crates/bevy_platform/Cargo.toml</code></strong> (+2/-2)</p> <ul><li>Updated hashbrown and foldhash version dependencies<li>Essential for accessing the latest performance improvements</ul><li><p><strong><code>crates/bevy_reflect/Cargo.toml</code></strong> (+2/-2)</p> <ul><li>Mirror update of dependencies to maintain consistency</ul><li><p><strong><code>crates/bevy_reflect/src/impls/foldhash.rs</code></strong> (+2/-2)</p> <ul><li>Added lifetime parameter to FoldHasher type references<li>Required due to breaking API change in foldhash</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>impl_type_path!</span><span>(</span><span style=color:#ed9366>::</span><span>foldhash</span><span style=color:#ed9366>::</span><span>fast</span><span style=color:#ed9366>::</span><span>FoldHasher)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>impl_type_path!</span><span>(</span><span style=color:#ed9366>::</span><span>foldhash</span><span style=color:#ed9366>::</span><span>fast</span><span style=color:#ed9366>::</span><span>FoldHasher<</span><span style=color:#fa6e32>'a</span><span>>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=4><li><strong><code>crates/bevy_platform/src/hash.rs</code></strong> (+1/-1) <ul><li>Updated associated type to include lifetime parameter<li>Maintains compatibility with updated foldhash API</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Hasher </span><span style=color:#ed9366>=</span><span> DefaultHasher</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Hasher </span><span style=color:#ed9366>= </span><span>DefaultHasher<</span><span style=color:#fa6e32>'static</span><span>></span><span style=color:#61676ccc>;
</span></code></pre><ol start=5><li><strong><code>crates/bevy_reflect/src/utility.rs</code></strong> (+1/-1) <ul><li>Updated return type to include lifetime parameter<li>Ensures type consistency throughout the codebase</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>reflect_hasher</span><span>() </span><span style=color:#61676ccc>-></span><span> DefaultHasher
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>reflect_hasher</span><span>() </span><span style=color:#61676ccc>-> </span><span>DefaultHasher<</span><span style=color:#fa6e32>'static</span><span>>
</span></code></pre><ol start=6><li><strong><code>tools/build-templated-pages/Cargo.toml</code></strong> (+1/-1) <ul><li>Updated hashbrown dependency for tooling consistency<li>Maintains uniform dependency versions across the project</ul></ol><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/hashbrown/0.16.0/hashbrown/ target=_blank>hashbrown crate documentation</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/foldhash/0.2.0/foldhash/ target=_blank>foldhash crate documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch10-03-lifetime-syntax.html target=_blank>Rust lifetimes explained</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/semver.html target=_blank>Semantic Versioning in Rust</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_20807.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>