<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21067 Run release exporter in ci
        
    </title><meta content="#21067 Run release exporter in ci" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21067-zh-cn-20250915>中文</a></div></div><div class=pr-content><h1 id=run-release-exporter-in-ci>Run release exporter in ci</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Run release exporter in ci<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21067<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Build-System, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-09-15T21:06:09Z<li><strong>Merged</strong>: 2025-09-15T22:26:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fail PRs that add a release content that fails parsing</ul><h2 id=solution>Solution</h2><ul><li>Add a check mode to the exporter tool<li>Run it in CI</ul><h2 id=testing>Testing</h2><ul><li>Should fail on this PR before https://github.com/bevyengine/bevy/pull/21065 is merged</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The core problem this PR addresses is maintaining quality control over release content in the Bevy project. When developers add new release notes or migration guides, there’s a risk that malformed content could slip through without proper validation. This could break the release process or cause issues for users trying to read the documentation.<p>The solution implemented here takes a practical approach by leveraging existing infrastructure. The team already had an export-content tool that parsed and processed release content, but it was only run manually. The key insight was to repurpose this tool for CI validation by adding a simple check mode that validates content without running the full export process.<p>The implementation follows a clean separation of concerns. First, the content loading logic was extracted from the App struct into a new Content struct with a load() method. This refactoring allows the same parsing logic to be used both by the interactive TUI application and the new CI validation mode.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: tools/export-content/src/app.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>App </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span>&LTApp> {
</span><span>        </span><span style=color:#fa6e32>let</span><span> exe_dir </span><span style=color:#ed9366>= </span><span>env</span><span style=color:#ed9366>::</span><span>current_exe()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> content_dir </span><span style=color:#ed9366>=</span><span> exe_dir</span><span style=color:#ed9366>.</span><span style=color:#f07171>parent</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>join</span><span>(</span><span style=color:#86b300>"content"</span><span>)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... content loading logic embedded in App constructor
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Content </span><span>{
</span><span>    content_dir</span><span style=color:#61676ccc>:</span><span> PathBuf,
</span><span>    migration_guides</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEntry>,
</span><span>    release_notes</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEntry>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Content </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>Self</span><span>> {
</span><span>        </span><span style=color:#fa6e32>let</span><span> exe_dir </span><span style=color:#ed9366>= </span><span>env</span><span style=color:#ed9366>::</span><span>current_exe()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> content_dir </span><span style=color:#ed9366>=</span><span> exe_dir</span><span style=color:#ed9366>.</span><span style=color:#f07171>parent</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>join</span><span>(</span><span style=color:#86b300>"content"</span><span>)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... content loading logic now reusable
</span><span>    }
</span><span>}
</span></code></pre><p>The main entry point was then modified to support a –check flag that uses this new Content::load() method:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: tools/export-content/src/main.rs
</span><span style=color:#abb0b6;font-style:italic>// Added:
</span><span style=color:#fa6e32>let</span><span> check </span><span style=color:#ed9366>= </span><span>std</span><span style=color:#ed9366>::</span><span>env</span><span style=color:#ed9366>::</span><span>args()</span><span style=color:#ed9366>.</span><span style=color:#f07171>any</span><span>(|</span><span style=color:#ff8f40>arg</span><span>| arg </span><span style=color:#ed9366>== </span><span style=color:#86b300>"--check"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>if</span><span> check {
</span><span>    Content</span><span style=color:#ed9366>::</span><span>load()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(())</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>Finally, the CI pipeline was updated with a new job that runs this check mode:<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># File: .github/workflows/ci.yml
</span><span style=color:#abb0b6;font-style:italic># Added:
</span><span style=color:#399ee6>check-release-content</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>runs-on</span><span style=color:#61676ccc>: </span><span style=color:#86b300>ubuntu-latest
</span><span>  </span><span style=color:#399ee6>timeout-minutes</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>30
</span><span>  </span><span style=color:#399ee6>steps</span><span style=color:#61676ccc>:
</span><span>    - </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@v5
</span><span>    - </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@stable
</span><span>    - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Check Release Content
</span><span>      </span><span style=color:#399ee6>shell</span><span style=color:#61676ccc>: </span><span style=color:#86b300>bash
</span><span>      </span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>|
</span><span style=color:#86b300>        cargo run --package export-content -- --check
</span></code></pre><p>This approach is effective because it reuses the existing parsing logic exactly as it would be used in production, ensuring consistency between validation and actual usage. The check is fast and lightweight, making it suitable for CI runs where execution time matters.<p>The impact is straightforward but significant: any PR that introduces malformed release content will now fail CI immediately, preventing broken content from entering the codebase. This creates a safety net that helps maintain documentation quality without requiring manual review of every content change.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[CI Pipeline] --> B[check-release-content Job]
</span><span>    B --> C[Run export-content tool]
</span><span>    C --> D[--check flag]
</span><span>    D --> E[Content::load()]
</span><span>    E --> F[Parse release notes]
</span><span>    E --> G[Parse migration guides]
</span><span>    F --> H[Validation Result]
</span><span>    G --> H
</span><span>    H --> I[CI Pass/Fail]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><code>tools/export-content/src/app.rs</code> (+26/-5) <ul><li>Extracted content loading logic from App into new Content struct<li>Added Content::load() method for reusable content validation<li>Changed path::PathBuf to PathBuf for consistency</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Key changes in app.rs
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Content </span><span>{
</span><span>    content_dir</span><span style=color:#61676ccc>:</span><span> PathBuf,
</span><span>    migration_guides</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEntry>,
</span><span>    release_notes</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEntry>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Content </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>Self</span><span>> {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Content loading logic now available independently
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>App </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span>&LTApp> {
</span><span>        </span><span style=color:#fa6e32>let</span><span> Content { content_dir</span><span style=color:#61676ccc>,</span><span> release_notes</span><span style=color:#61676ccc>,</span><span> migration_guides } </span><span style=color:#ed9366>= </span><span>Content</span><span style=color:#ed9366>::</span><span>load()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Use loaded content to initialize App
</span><span>    }
</span><span>}
</span></code></pre><ol start=2><li><code>.github/workflows/ci.yml</code> (+11/-0) <ul><li>Added new CI job for release content validation<li>Job runs the export-content tool with –check flag</ul></ol><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#399ee6>check-release-content</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>runs-on</span><span style=color:#61676ccc>: </span><span style=color:#86b300>ubuntu-latest
</span><span>  </span><span style=color:#399ee6>timeout-minutes</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>30
</span><span>  </span><span style=color:#399ee6>steps</span><span style=color:#61676ccc>:
</span><span>    - </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@v5
</span><span>    - </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@stable
</span><span>    - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Check Release Content
</span><span>      </span><span style=color:#399ee6>shell</span><span style=color:#61676ccc>: </span><span style=color:#86b300>bash
</span><span>      </span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>|
</span><span style=color:#86b300>        cargo run --package export-content -- --check
</span></code></pre><ol start=3><li><code>tools/export-content/src/main.rs</code> (+8/-0) <ul><li>Added –check flag support<li>Early return when in check mode after validating content</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added to main.rs
</span><span style=color:#fa6e32>let</span><span> check </span><span style=color:#ed9366>= </span><span>std</span><span style=color:#ed9366>::</span><span>env</span><span style=color:#ed9366>::</span><span>args()</span><span style=color:#ed9366>.</span><span style=color:#f07171>any</span><span>(|</span><span style=color:#ff8f40>arg</span><span>| arg </span><span style=color:#ed9366>== </span><span style=color:#86b300>"--check"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>if</span><span> check {
</span><span>    Content</span><span style=color:#ed9366>::</span><span>load()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(())</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/actions target=_blank>GitHub Actions documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-cli.github.io/book/ target=_blank>Rust CLI application patterns</a><li><a rel="noopener nofollow noreferrer" href=https://diataxis.fr/continuous-integration/ target=_blank>CI/CD best practices for documentation validation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/content/README.md target=_blank>Bevy’s content format specification</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21067.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>