<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21043 Clean up mentions to update_archetype_component* functions
        
    </title><meta content="#21043 Clean up mentions to update_archetype_component* functions" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21043-zh-cn-20250915>中文</a></div></div><div class=pr-content><h1 id=clean-up-mentions-to-update-archetype-component-functions>Clean up mentions to update_archetype_component* functions</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Clean up mentions to update_archetype_component* functions<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21043<li><strong>Author</strong>: james7132<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-09-15T01:16:04Z<li><strong>Merged</strong>: 2025-09-15T02:01:26Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>There are still mentions of <code>update_archetype_component*</code> functions in a few places.<h2 id=solution>Solution</h2><p>Yeet.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward cleanup task in the Bevy ECS codebase. The core issue was that several comments still referenced <code>update_archetype_component*</code> functions that had been previously removed or renamed during earlier refactoring work. These outdated comments created potential confusion for developers working with the codebase, as they referenced functionality that no longer existed.<p>The changes focus on three specific areas where these outdated references remained:<ol><li>In the query fetch implementation, a safety comment incorrectly mentioned both <code>update_component_access</code> and <code>update_archetype_component_access</code> methods, when only the former was relevant<li>In the multi-threaded executor, a safety comment included an unnecessary reference to <code>update_archetype_component_access</code> being called<li>In the system trait implementation, two safety comments contained similar outdated references</ol><p>The solution was simple and direct: remove the incorrect or unnecessary comments. This cleanup improves code clarity and maintains accurate documentation for the unsafe code blocks, which is critical for future maintenance and development.<p>The changes don’t affect any actual functionality - they only improve documentation accuracy. This type of cleanup is important in large codebases like Bevy where outdated comments can mislead developers and potentially lead to incorrect assumptions about how unsafe code should be implemented.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Outdated Comments] --> B[Query Fetch Module]
</span><span>    A --> C[Multi-threaded Executor]
</span><span>    A --> D[System Trait]
</span><span>    B --> E[Updated Safety Comment]
</span><span>    C --> F[Removed Outdated Comment]
</span><span>    D --> G[Removed Two Outdated Comments]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-query-fetch-rs><code>crates/bevy_ecs/src/query/fetch.rs</code></h3><p>Updated a safety comment in test code to remove reference to non-existent function.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>/// SAFETY:
</span><span style=color:#abb0b6;font-style:italic>/// `update_component_access` and `update_archetype_component_access` do nothing.
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// SAFETY:
</span><span style=color:#abb0b6;font-style:italic>/// `update_component_access` do nothing.
</span></code></pre><h3 id=crates-bevy-ecs-src-schedule-executor-multi-threaded-rs><code>crates/bevy_ecs/src/schedule/executor/multi_threaded.rs</code></h3><p>Removed an outdated comment line about <code>update_archetype_component_access</code>.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Removed line:
</span><span style=color:#abb0b6;font-style:italic>// - `update_archetype_component_access` has been called for condition.
</span></code></pre><h3 id=crates-bevy-ecs-src-system-system-rs><code>crates/bevy_ecs/src/system/system.rs</code></h3><p>Removed two outdated comment lines about <code>update_archetype_component_access</code>.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Removed lines:
</span><span style=color:#abb0b6;font-style:italic>// - `update_archetype_component_access` has been called.
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/ target=_blank>Bevy ECS Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/rfcs/2585-unsafe-code-guidelines.html target=_blank>Rust Safety Comments Guidelines</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/rust-lang/api-guidelines/blob/master/src/comments.html target=_blank>Code Commenting Best Practices</a></ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ecs/src/query/fetch.rs b/crates/bevy_ecs/src/query/fetch.rs
</span><span>index ec7d7d87015f1..7b1ff2387f1d4 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/query/fetch.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/query/fetch.rs
</span><span style=color:#c594c5>@@ -3036,7 +3036,7 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         struct NonReleaseQueryData;
</span><span> 
</span><span>         /// SAFETY:
</span><span style=color:#f07171>-        /// `update_component_access` and `update_archetype_component_access` do nothing.
</span><span style=color:#86b300>+        /// `update_component_access` do nothing.
</span><span>         /// This is sound because `fetch` does not access components.
</span><span>         unsafe impl WorldQuery for NonReleaseQueryData {
</span><span>             type Fetch<'w> = ();
</span><span>diff --git a/crates/bevy_ecs/src/schedule/executor/multi_threaded.rs b/crates/bevy_ecs/src/schedule/executor/multi_threaded.rs
</span><span>index c1ed3ff73bd44..497b937c31f51 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/schedule/executor/multi_threaded.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/schedule/executor/multi_threaded.rs
</span><span style=color:#c594c5>@@ -849,7 +849,6 @@ </span><span style=color:#399ee6>unsafe fn evaluate_and_fold_conditions(
</span><span>                     // SAFETY:
</span><span>                     // - The caller ensures that `world` has permission to read any data
</span><span>                     //   required by the condition.
</span><span style=color:#f07171>-                    // - `update_archetype_component_access` has been called for condition.
</span><span>                     unsafe {
</span><span>                         __rust_begin_short_backtrace::readonly_run_unsafe(&mut **condition, world)
</span><span>                     }
</span><span>diff --git a/crates/bevy_ecs/src/system/system.rs b/crates/bevy_ecs/src/system/system.rs
</span><span>index 177d056e48cfd..8986ec812a462 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/system/system.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/system/system.rs
</span><span style=color:#c594c5>@@ -135,7 +135,6 @@ </span><span style=color:#399ee6>pub trait System: Send + Sync + 'static {
</span><span>         unsafe { self.validate_param_unsafe(world_cell) }?;
</span><span>         // SAFETY:
</span><span>         // - We have exclusive access to the entire world.
</span><span style=color:#f07171>-        // - `update_archetype_component_access` has been called.
</span><span>         unsafe { self.run_unsafe(input, world_cell) }
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -241,7 +240,6 @@ </span><span style=color:#399ee6>pub unsafe trait ReadOnlySystem: System {
</span><span>         unsafe { self.validate_param_unsafe(world) }?;
</span><span>         // SAFETY:
</span><span>         // - We have read-only access to the entire world.
</span><span style=color:#f07171>-        // - `update_archetype_component_access` has been called.
</span><span>         unsafe { self.run_unsafe(input, world) }
</span><span>     }
</span><span> }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21043.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>