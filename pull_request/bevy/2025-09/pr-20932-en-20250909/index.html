<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20932 add helper functions for registering bundles to world
        
    </title><meta content="#20932 add helper functions for registering bundles to world" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-20932-zh-cn-20250909>中文</a></div></div><div class=pr-content><h1 id=add-helper-functions-for-registering-bundles-to-world>add helper functions for registering bundles to world</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: add helper functions for registering bundles to world<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20932<li><strong>Author</strong>: janis-bhm<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Code-Quality, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward, D-Unsafe<li><strong>Created</strong>: 2025-09-08T11:55:54Z<li><strong>Merged</strong>: 2025-09-09T22:51:37Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>This avoids having to create a <code>ComponentRegistrator</code> and passing it to Bundles::register_info everywhere it’s called, reducing unsafe blocks. There aren’t any calls to <code>register_info</code> and related functions that don’t have access to a <code>&mut World</code> where it wouldn’t be possible to do this.<p>(part 2 to #20790), #20739<h1 id=objective>Objective</h1><p>calling <code>Bundles::register_info</code> involves creating a <code>ComponentRegistrator</code> from world <code>components</code> and <code>component_ids</code>, requiring a <code>&mut World</code> and a safety comment ensuring the <code>ComponentRegistrator</code> belongs to the same world as the <code>Bundles</code>.<h2 id=solution>Solution</h2><p>create a helper function to the world that calls <code>register_info</code> with the correct <code>ComponentRegistrator</code>, removing the need for unsafe blocks.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a recurring pattern in Bevy’s ECS system where bundle registration required manual creation of <code>ComponentRegistrator</code> instances and unsafe code blocks. The problem stemmed from the need to register bundle information across multiple systems - bundle insertion, removal, spawning, and entity operations - each duplicating the same unsafe initialization code.<p>The core issue was that registering a bundle required:<ol><li>Creating a <code>ComponentRegistrator</code> from world components and component IDs<li>Ensuring safety by verifying all components belonged to the same world<li>Calling <code>register_info</code> with the correct parameters</ol><p>This pattern was repeated in 5 different locations with nearly identical unsafe code blocks and safety comments. Each instance required careful manual verification that the <code>ComponentRegistrator</code> was properly constructed from the same world’s components.<p>The solution introduced two new helper methods on the <code>World</code> struct:<ul><li><code>register_bundle_info&LTB: Bundle>() -> BundleId</code><li><code>register_contributed_bundle_info&LTB: Bundle>() -> BundleId</code></ul><p>These methods encapsulate the unsafe operations of creating the <code>ComponentRegistrator</code> and calling the appropriate registration methods on the world’s bundles. The implementation ensures that all components and registrators are properly associated with the same world, maintaining the necessary safety guarantees while eliminating code duplication.<p>The changes affected multiple systems that work with bundles:<ul><li><strong>Bundle insertion</strong>: When adding components to entities<li><strong>Bundle removal</strong>: When removing components from entities<li><strong>Bundle spawning</strong>: When creating new entities with component sets<li><strong>Entity operations</strong>: When modifying entity component compositions</ul><p>By centralizing the bundle registration logic, the PR reduces the cognitive load on developers working with these systems. Instead of manually managing unsafe blocks and safety comments, developers can now call a single safe method that handles the complexity internally.<p>The implementation maintains the same performance characteristics as the original code since it simply moves the existing logic into reusable methods. The safety guarantees remain intact because the helper methods still perform the same validation, just in a centralized location.<p>This change follows good software engineering practices by reducing code duplication, encapsulating unsafe operations, and providing a cleaner API for bundle registration. It makes the codebase more maintainable and less error-prone by minimizing the surface area where unsafe operations are performed.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TB
</span><span>    World[World] -->|calls| RegisterBundle[register_bundle_info]
</span><span>    World -->|calls| RegisterContributed[register_contributed_bundle_info]
</span><span>    
</span><span>    RegisterBundle -->|used by| Inserter[BundleInserter]
</span><span>    RegisterBundle -->|used by| Remover[BundleRemover]
</span><span>    RegisterBundle -->|used by| Spawner[BundleSpawner]
</span><span>    RegisterBundle -->|used by| EntityOps[Entity Operations]
</span><span>    
</span><span>    RegisterContributed -->|used by| EntityOps
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-world-mod-rs-28-27><code>crates/bevy_ecs/src/world/mod.rs</code> (+28/-27)</h3><p>Added helper methods for bundle registration and refactored existing code to use them.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added methods:
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_bundle_info</span><span>&LTB</span><span style=color:#61676ccc>:</span><span> Bundle>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> BundleId {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: These come from the same world. `Self.components_registrator` can't be used since we borrow other fields too.
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> registrator </span><span style=color:#ed9366>=
</span><span>        </span><span style=color:#fa6e32>unsafe </span><span>{ ComponentsRegistrator</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>component_ids) }</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: `registrator`, `self.storages` and `self.bundles` all come from this world.
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>bundles
</span><span>            </span><span style=color:#ed9366>.</span><span>register_info</span><span style=color:#ed9366>::</span><span>&LTB>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> registrator</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>storages)
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_contributed_bundle_info</span><span>&LTB</span><span style=color:#61676ccc>:</span><span> Bundle>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> BundleId {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: These come from the same world. `Self.components_registrator` can't be used since we borrow other fields too.
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> registrator </span><span style=color:#ed9366>=
</span><span>        </span><span style=color:#fa6e32>unsafe </span><span>{ ComponentsRegistrator</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>component_ids) }</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: `registrator`, `self.bundles` and `self.storages` are all from this world.
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>bundles
</span><span>            </span><span style=color:#ed9366>.</span><span>register_contributed_bundle_info</span><span style=color:#ed9366>::</span><span>&LTB>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> registrator</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>storages)
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Refactored existing method to use helper:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register_bundle</span><span>&LTB</span><span style=color:#61676ccc>:</span><span> Bundle>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>BundleInfo {
</span><span>    </span><span style=color:#fa6e32>let</span><span> id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>register_bundle_info</span><span style=color:#ed9366>::</span><span>&LTB>()</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Now uses helper method
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: We just initialized the bundle so its id should definitely be valid.
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{ </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>bundles</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(id)</span><span style=color:#ed9366>.</span><span style=color:#f07171>debug_checked_unwrap</span><span>() }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-bundle-insert-rs-3-11><code>crates/bevy_ecs/src/bundle/insert.rs</code> (+3/-11)</h3><p>Refactored bundle insertion to use the new helper method.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: These come from the same world. `world.components_registrator` can't be used since we borrow other fields too.
</span><span style=color:#fa6e32>let mut</span><span> registrator </span><span style=color:#ed9366>=
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{ ComponentsRegistrator</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>component_ids) }</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: `registrator`, `world.bundles`, and `world.storages` all come from the same world
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    world
</span><span>        </span><span style=color:#ed9366>.</span><span>bundles
</span><span>        </span><span style=color:#ed9366>.</span><span>register_info</span><span style=color:#ed9366>::</span><span>&LTT>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> registrator</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>storages)
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>register_bundle_info</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-ecs-src-bundle-remove-rs-3-11><code>crates/bevy_ecs/src/bundle/remove.rs</code> (+3/-11)</h3><p>Refactored bundle removal to use the new helper method.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: These come from the same world. `world.components_registrator` can't be used since we borrow other fields too.
</span><span style=color:#fa6e32>let mut</span><span> registrator </span><span style=color:#ed9366>=
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{ ComponentsRegistrator</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>component_ids) }</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: `registrator`, `world.storages`, and `world.bundles` all come from the same world.
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    world
</span><span>        </span><span style=color:#ed9366>.</span><span>bundles
</span><span>        </span><span style=color:#ed9366>.</span><span>register_info</span><span style=color:#ed9366>::</span><span>&LTT>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> registrator</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>storages)
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>register_bundle_info</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-ecs-src-bundle-spawner-rs-2-10><code>crates/bevy_ecs/src/bundle/spawner.rs</code> (+2/-10)</h3><p>Refactored bundle spawning to use the new helper method.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: These come from the same world. `world.components_registrator` can't be used since we borrow other fields too.
</span><span style=color:#fa6e32>let mut</span><span> registrator </span><span style=color:#ed9366>=
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{ ComponentsRegistrator</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>component_ids) }</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: `registrator`, `world.bundles`, and `world.storages` all come from the same world.
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    world
</span><span>        </span><span style=color:#ed9366>.</span><span>bundles
</span><span>        </span><span style=color:#ed9366>.</span><span>register_info</span><span style=color:#ed9366>::</span><span>&LTT>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> registrator</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> world</span><span style=color:#ed9366>.</span><span>storages)
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>register_bundle_info</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-ecs-src-world-entity-ref-rs-9-31><code>crates/bevy_ecs/src/world/entity_ref.rs</code> (+9/-31)</h3><p>Refactored entity operations to use the new helper methods.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before multiple instances of:
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: These come from the same world.
</span><span style=color:#fa6e32>let mut</span><span> registrator </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>unsafe </span><span>{
</span><span>    ComponentsRegistrator</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>world</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>world</span><span style=color:#ed9366>.</span><span>component_ids)
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: `storages`, `bundles` and `registrator` come from the same world.
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>=
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{ bundles</span><span style=color:#ed9366>.</span><span>register_contributed_bundle_info</span><span style=color:#ed9366>::</span><span>&LTT>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> registrator</span><span style=color:#61676ccc>,</span><span> storages) }</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> bundle_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>world</span><span style=color:#ed9366>.</span><span>register_contributed_bundle_info</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/ target=_blank>Bevy ECS Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/unsafe-code-guidelines/ target=_blank>Rust Unsafe Code Guidelines</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ecs/#components target=_blank>Component Registration in Bevy</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20790 target=_blank>Related PR #20790</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20739 target=_blank>Related PR #20739</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_20932.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>