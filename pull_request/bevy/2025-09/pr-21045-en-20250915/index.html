<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21045 Impl Debug for triggers
        
    </title><meta content="#21045 Impl Debug for triggers" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21045-zh-cn-20250915>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Impl Debug for triggers<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Impl Debug for triggers<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21045<li><strong>Author</strong>: akimakinai<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-09-15T03:07:49Z<li><strong>Merged</strong>: 2025-09-15T06:36:39Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Debug-printing <code>Trigger</code> (now <code>On</code>) was handy for debugging events. It becomes an error in 0.17-rc due to triggers not implementing <code>Debug</code>.</ul><h2 id=solution>Solution</h2><ul><li>Impl <code>Debug</code> for triggers</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important usability issue in Bevy’s ECS event system. The problem emerged when developers tried to use debug printing (<code>{:?}</code>) on trigger types during event debugging sessions. While this worked in previous versions, the upcoming 0.17 release introduced a breaking change where triggers no longer implemented the <code>Debug</code> trait, causing compilation errors.<p>The core issue was that three trigger types (<code>GlobalTrigger</code>, <code>EntityTrigger</code>, and <code>PropagateEntityTrigger</code>) lacked proper <code>Debug</code> implementations. The solution involved two complementary approaches:<ol><li>For simple structs (<code>GlobalTrigger</code> and <code>EntityTrigger</code>), the PR added <code>Debug</code> to their derive macros<li>For the more complex <code>PropagateEntityTrigger</code> with generic parameters and internal state, a manual <code>Debug</code> implementation was provided</ol><p>The implementation follows Rust’s standard debugging conventions. For <code>PropagateEntityTrigger</code>, the debug output includes:<ul><li>The original event target<li>Propagation status<li>Type marker information</ul><p>These changes maintain backward compatibility while restoring essential debugging functionality. The manual implementation for <code>PropagateEntityTrigger</code> carefully handles the generic parameters while providing meaningful debug output that includes the struct’s relevant internal state.<p>The fix is minimal and focused - it doesn’t alter any functionality beyond adding debugging capabilities. This approach ensures that developers can continue using standard Rust debugging techniques while working with Bevy’s event system, which is particularly valuable when troubleshooting complex event interactions.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Trigger Traits] --> B[GlobalTrigger]
</span><span>    A --> C[EntityTrigger]
</span><span>    A --> D[PropagateEntityTrigger]
</span><span>    
</span><span>    B --> E[Derives Debug]
</span><span>    C --> E
</span><span>    D --> F[Manual Debug Implementation]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-event-trigger-rs-15-3><code>crates/bevy_ecs/src/event/trigger.rs</code> (+15/-3)</h3><p>This file contains the core implementation of Bevy’s event trigger system. The changes add <code>Debug</code> implementations to three trigger types.<p><strong>Key changes:</strong><ol><li>Added <code>Debug</code> derive to <code>GlobalTrigger</code> and <code>EntityTrigger</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GlobalTrigger</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GlobalTrigger</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li>Added manual <code>Debug</code> implementation for <code>PropagateEntityTrigger</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New implementation:
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>const</span><span> AUTO_PROPAGATE</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>, E</span><span style=color:#61676ccc>:</span><span> EntityEvent, T</span><span style=color:#61676ccc>: </span><span>Traversal&LTE>> </span><span style=color:#399ee6>fmt</span><span>::</span><span style=color:#399ee6>Debug
</span><span>    </span><span style=color:#399ee6>for PropagateEntityTrigger</span><span>&LTAUTO_PROPAGATE, E, T>
</span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>fmt</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>f</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>fmt</span><span style=color:#ed9366>::</span><span>Formatter<'</span><span style=color:#ed9366>_</span><span>>) </span><span style=color:#61676ccc>-> </span><span>fmt</span><span style=color:#ed9366>::</span><span>Result {
</span><span>        f</span><span style=color:#ed9366>.</span><span style=color:#f07171>debug_struct</span><span>(</span><span style=color:#86b300>"PropagateEntityTrigger"</span><span>)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>field</span><span>(</span><span style=color:#86b300>"original_event_target"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>original_event_target)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>field</span><span>(</span><span style=color:#86b300>"propagate"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>propagate)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>field</span><span>(</span><span style=color:#86b300>"_marker"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>_marker)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>finish</span><span>()
</span><span>    }
</span><span>}
</span></code></pre><ol start=3><li>Added necessary import for <code>fmt</code> module:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added import:
</span><span style=color:#fa6e32>use </span><span>core</span><span style=color:#ed9366>::</span><span>{fmt</span><span style=color:#61676ccc>, </span><span>marker</span><span style=color:#ed9366>::</span><span>PhantomData}</span><span style=color:#61676ccc>;
</span></code></pre><p>These changes ensure all trigger types can be properly formatted for debugging purposes, resolving the compilation errors that would occur in Bevy 0.17.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/fmt/trait.Debug.html target=_blank>Rust Debug Trait Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/0.17/programming/events/ target=_blank>Bevy Event System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/procedural-macros.html#derive-macros target=_blank>Derive Macros in Rust</a></ul><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ecs/src/event/trigger.rs b/crates/bevy_ecs/src/event/trigger.rs
</span><span>index 45b5e52b06b7b..9492380b63159 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/event/trigger.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/event/trigger.rs
</span><span style=color:#c594c5>@@ -7,7 +7,7 @@ </span><span style=color:#399ee6>use crate::{
</span><span>     world::DeferredWorld,
</span><span> };
</span><span> use bevy_ptr::PtrMut;
</span><span style=color:#f07171>-use core::marker::PhantomData;
</span><span style=color:#86b300>+use core::{fmt, marker::PhantomData};
</span><span> 
</span><span> /// [`Trigger`] determines _how_ an [`Event`] is triggered when [`World::trigger`](crate::world::World::trigger) is called.
</span><span> /// This decides which [`Observer`](crate::observer::Observer)s will run, what data gets passed to them, and the order they will
</span><span style=color:#c594c5>@@ -57,7 +57,7 @@ </span><span style=color:#399ee6>pub unsafe trait Trigger&LTE: Event> {
</span><span> /// that matches the given [`Event`].
</span><span> ///
</span><span> /// The [`Event`] derive defaults to using this [`Trigger`], and it is usable for any [`Event`] type.
</span><span style=color:#f07171>-#[derive(Default)]
</span><span style=color:#86b300>+#[derive(Default, Debug)]
</span><span> pub struct GlobalTrigger;
</span><span> 
</span><span> // SAFETY:
</span><span style=color:#c594c5>@@ -127,7 +127,7 @@ </span><span style=color:#399ee6>impl GlobalTrigger {
</span><span> /// The [`EntityEvent`] derive defaults to using this [`Trigger`], and it is usable for any [`EntityEvent`] type.
</span><span> ///
</span><span> /// [`Observer`]: crate::observer::Observer
</span><span style=color:#f07171>-#[derive(Default)]
</span><span style=color:#86b300>+#[derive(Default, Debug)]
</span><span> pub struct EntityTrigger;
</span><span> 
</span><span> // SAFETY:
</span><span style=color:#c594c5>@@ -251,6 +251,18 @@ </span><span style=color:#399ee6>impl&LTconst AUTO_PROPAGATE: bool, E: EntityEvent, T: Traversal&LTE>> Default
</span><span>     }
</span><span> }
</span><span> 
</span><span style=color:#86b300>+impl&LTconst AUTO_PROPAGATE: bool, E: EntityEvent, T: Traversal&LTE>> fmt::Debug
</span><span style=color:#86b300>+    for PropagateEntityTrigger&LTAUTO_PROPAGATE, E, T>
</span><span style=color:#86b300>+{
</span><span style=color:#86b300>+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
</span><span style=color:#86b300>+        f.debug_struct("PropagateEntityTrigger")
</span><span style=color:#86b300>+            .field("original_event_target", &self.original_event_target)
</span><span style=color:#86b300>+            .field("propagate", &self.propagate)
</span><span style=color:#86b300>+            .field("_marker", &self._marker)
</span><span style=color:#86b300>+            .finish()
</span><span style=color:#86b300>+    }
</span><span style=color:#86b300>+}
</span><span style=color:#86b300>+
</span><span> // SAFETY:
</span><span> // - `E`'s [`Event::Trigger`] is constrained to [`PropagateEntityTrigger&LTE>`]
</span><span> unsafe impl<
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21045.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>