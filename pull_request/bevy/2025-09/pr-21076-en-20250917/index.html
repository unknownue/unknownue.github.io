<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21076 fix `wasm32v1-none` compiling with --no-default-features
        
    </title><meta content="#21076 fix `wasm32v1-none` compiling with --no-default-features" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21076-zh-cn-20250917>中文</a></div></div><div class=pr-content><h1 id=fix-wasm32v1-none-compiling-with-no-default-features>fix <code>wasm32v1-none</code> compiling with –no-default-features</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fix <code>wasm32v1-none</code> compiling with –no-default-features<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21076<li><strong>Author</strong>: janis-bhm<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Build-System, S-Ready-For-Final-Review, P-Compile-Failure<li><strong>Created</strong>: 2025-09-16T00:02:01Z<li><strong>Merged</strong>: 2025-09-17T21:21:51Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #21006<h2 id=solution>Solution</h2><p>disable default features for wasm32 arch dependency on <code>async-channel</code><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The issue began when users attempted to compile Bevy for the <code>wasm32v1-none</code> target without default features. This configuration failed to build due to a dependency conflict in the <code>async-channel</code> crate. The problem was specific to WebAssembly targets where certain default features of <code>async-channel</code> weren’t compatible with the constrained environment.<p>The root cause was that <code>async-channel</code>’s default features included functionality that relied on system APIs unavailable in the wasm32 environment, particularly when compiling without default features. This created a dependency chain that pulled in incompatible code paths during compilation.<p>The solution was straightforward and surgical: disable the default features for the <code>async-channel</code> dependency specifically for wasm32 targets. This approach ensures that only the minimal necessary functionality from <code>async-channel</code> is included when targeting WebAssembly, avoiding the incompatible code paths while maintaining the required channel functionality for async task execution.<p>The implementation involved a single-line change in the Cargo.toml file, modifying the dependency declaration from a simple version string to a more detailed specification that explicitly disables default features. This change demonstrates a common pattern in Rust dependency management where target-specific feature configuration is necessary for cross-platform compatibility.<p>From an engineering perspective, this fix highlights the importance of carefully managing dependency features across different target architectures. The WebAssembly environment has unique constraints that require explicit feature control, and this change follows established best practices for Rust-WASM development.<p>The impact is significant for developers targeting WebAssembly with minimal feature sets - they can now successfully compile Bevy projects for <code>wasm32v1-none</code> without default features enabled. This maintains Bevy’s cross-platform compatibility while addressing a specific compilation barrier for WebAssembly deployments.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[wasm32v1-none target] --> B[async-channel dependency]
</span><span>    B --> C[Default features conflict]
</span><span>    C --> D[Compilation failure]
</span><span>    B --> E[Disable default features]
</span><span>    E --> F[Successful compilation]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>crates/bevy_tasks/Cargo.toml</strong> (+1/-1) This file contains the dependency configuration for Bevy’s task system. The change modifies how the async-channel dependency is configured for WebAssembly targets.<p><strong>Before:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(target_arch = "wasm32")'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>pin-project </span><span>= </span><span style=color:#86b300>"1"
</span><span style=color:#399ee6>async-channel </span><span>= </span><span style=color:#86b300>"2.3.0"
</span></code></pre><p><strong>After:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(target_arch = "wasm32")'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>pin-project </span><span>= </span><span style=color:#86b300>"1"
</span><span style=color:#399ee6>async-channel </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"2.3.0"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span></code></pre><p>The change adds <code>default-features = false</code> to the async-channel dependency specification for wasm32 targets, preventing the inclusion of incompatible default features when compiling for WebAssembly without default features.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#target-specific-dependencies target=_blank>Cargo Target-specific dependencies documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rustwasm.github.io/ target=_blank>The Rust WebAssembly Working Group</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/async-channel/latest/async_channel/ target=_blank>Async-channel crate documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/platform-specifics/web/ target=_blank>Bevy WebAssembly development guide</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21076.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>