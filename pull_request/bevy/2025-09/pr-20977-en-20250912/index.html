<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20977 Improve the standard_widgets_observers example
        
    </title><meta content="#20977 Improve the standard_widgets_observers example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-12</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-20977-zh-cn-20250912>中文</a></div></div><div class=pr-content><h1 id=improve-the-standard-widgets-observers-example>Improve the standard_widgets_observers example</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Improve the standard_widgets_observers example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20977<li><strong>Author</strong>: cart<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, A-UI, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-09-12T02:13:08Z<li><strong>Merged</strong>: 2025-09-12T03:09:52Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Currently <code>standard_widgets_observers</code> is redundant / noisy to the point of being a “user quality perception liability”. I think we either need to remove it completely or improve it.<h2 id=solution>Solution</h2><ul><li>Make the redundant observer logic generic, which allows all observers to reuse the same function</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The <code>standard_widgets_observers</code> example had become a maintenance burden due to excessive code duplication. The original implementation contained numerous observer functions that followed nearly identical patterns for handling UI component interactions. This redundancy made the example difficult to maintain and understand, potentially giving users a negative impression of Bevy’s UI system quality.<p>The solution approach focused on generic programming to eliminate code duplication. Instead of maintaining separate functions for each type of UI interaction (button presses, slider changes, checkbox toggles), the PR introduced generic observer functions that could handle multiple interaction types through type parameters. This approach significantly reduced the amount of code while maintaining the same functionality.<p>The implementation involved creating three main generic functions:<ol><li><code>button_on_interaction</code> - handles all button state changes (pressed, hovered, disabled)<li><code>slider_on_interaction</code> - handles slider interaction states (disabled, hovered)<li><code>checkbox_on_interaction</code> - handles checkbox states (checked, disabled, hovered)</ol><p>These functions use type parameters to determine which specific interaction they’re handling, with runtime type checking provided by a new <code>Is</code> trait:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>trait </span><span style=color:#399ee6>Is </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>is</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Any>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTA</span><span style=color:#61676ccc>:</span><span> Any> Is </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>A </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>is</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Any>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{
</span><span>        TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTA>() </span><span style=color:#ed9366>== </span><span>TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>()
</span><span>    }
</span><span>}
</span></code></pre><p>The key technical insight was recognizing that all the observer functions followed similar patterns - they queried for specific components and updated visual properties based on state changes. By parameterizing these patterns, the code could be consolidated without losing functionality.<p>The impact is substantial code reduction and improved maintainability. The example now has 111 lines added versus 362 lines removed, resulting in a net reduction of 251 lines of code. This makes the example easier to understand and maintain while demonstrating better practices for handling UI observers in Bevy.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[UI Component Events] --> B[Generic Observer Functions]
</span><span>    B --> C[Button Interactions]
</span><span>    B --> D[Slider Interactions]
</span><span>    B --> E[Checkbox Interactions]
</span><span>    C --> F[Visual Updates]
</span><span>    D --> F
</span><span>    E --> F
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ul><li><code>examples/ui/standard_widgets_observers.rs</code> (+111/-362)</ul><p>This file underwent significant refactoring to replace multiple specific observer functions with generic implementations:<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_on_add_pressed</span><span>(
</span><span>    </span><span style=color:#ff8f40>add</span><span style=color:#61676ccc>: </span><span>On&LTAdd, Pressed>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>buttons</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#abb0b6;font-style:italic>/* ... */</span><span>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>text_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Text>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Specific implementation for add pressed
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_on_remove_pressed</span><span>(
</span><span>    </span><span style=color:#ff8f40>remove</span><span style=color:#61676ccc>: </span><span>On&LTRemove, Pressed>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>buttons</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#abb0b6;font-style:italic>/* ... */</span><span>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>text_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Text>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Specific implementation for remove pressed
</span><span>}
</span><span style=color:#abb0b6;font-style:italic>// ... 13 more similar functions
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_on_interaction</span><span>&LTE</span><span style=color:#61676ccc>:</span><span> EntityEvent, C</span><span style=color:#61676ccc>:</span><span> Component>(
</span><span>    </span><span style=color:#ff8f40>event</span><span style=color:#61676ccc>: </span><span>On&LTE, C>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>buttons</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#abb0b6;font-style:italic>/* ... */</span><span>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>text_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Text>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Generic implementation handling all button interactions
</span><span>    </span><span style=color:#fa6e32>let</span><span> pressed </span><span style=color:#ed9366>=</span><span> pressed </span><span style=color:#ed9366>&& !</span><span>(E</span><span style=color:#ed9366>::</span><span>is</span><span style=color:#ed9366>::</span><span>&LTRemove>() </span><span style=color:#ed9366>&& </span><span>C</span><span style=color:#ed9366>::</span><span>is</span><span style=color:#ed9366>::</span><span>&LTPressed>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> disabled </span><span style=color:#ed9366>=</span><span> disabled </span><span style=color:#ed9366>&& !</span><span>(E</span><span style=color:#ed9366>::</span><span>is</span><span style=color:#ed9366>::</span><span>&LTRemove>() </span><span style=color:#ed9366>&& </span><span>C</span><span style=color:#ed9366>::</span><span>is</span><span style=color:#ed9366>::</span><span>&LTInteractionDisabled>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Handle all button states
</span><span>}
</span></code></pre><p>The changes demonstrate how generics can dramatically reduce code duplication while maintaining the same functionality. The generic functions handle all the previous cases through type parameters and conditional logic based on the event and component types.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch10-00-generics.html target=_blank>Rust Generics Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/advanced-topics/observers/ target=_blank>Bevy ECS Observers</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/any/index.html target=_blank>TypeId and Any Trait in Rust</a></ul><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/examples/ui/standard_widgets_observers.rs b/examples/ui/standard_widgets_observers.rs
</span><span>index 54220a0214c38..c8a8734afc542 100644
</span><span style=color:#c594c5>--- a/examples/ui/standard_widgets_observers.rs
</span><span style=color:#c594c5>+++ b/examples/ui/standard_widgets_observers.rs
</span><span style=color:#c594c5>@@ -15,6 +15,7 @@ </span><span style=color:#399ee6>use bevy::{
</span><span>         UiWidgetsPlugins, ValueChange,
</span><span>     },
</span><span> };
</span><span style=color:#86b300>+use std::any::{Any, TypeId};
</span><span> 
</span><span> fn main() {
</span><span>     App::new()
</span><span style=color:#c594c5>@@ -26,21 +27,21 @@ </span><span style=color:#399ee6>fn main() {
</span><span>         ))
</span><span>         .insert_resource(DemoWidgetStates { slider_value: 50.0 })
</span><span>         .add_systems(Startup, setup)
</span><span style=color:#f07171>-        .add_observer(button_on_add_pressed)
</span><span style=color:#f07171>-        .add_observer(button_on_remove_pressed)
</span><span style=color:#f07171>-        .add_observer(button_on_add_disabled)
</span><span style=color:#f07171>-        .add_observer(button_on_remove_disabled)
</span><span style=color:#f07171>-        .add_observer(button_on_change_hover)
</span><span style=color:#f07171>-        .add_observer(slider_on_add_disabled)
</span><span style=color:#f07171>-        .add_observer(slider_on_remove_disabled)
</span><span style=color:#f07171>-        .add_observer(slider_on_change_hover)
</span><span style=color:#f07171>-        .add_observer(slider_on_change_value)
</span><span style=color:#f07171>-        .add_observer(slider_on_change_range)
</span><span style=color:#f07171>-        .add_observer(checkbox_on_add_disabled)
</span><span style=color:#f07171>-        .add_observer(checkbox_on_remove_disabled)
</span><span style=color:#f07171>-        .add_observer(checkbox_on_change_hover)
</span><span style=color:#f07171>-        .add_observer(checkbox_on_add_checked)
</span><span style=color:#f07171>-        .add_observer(checkbox_on_remove_checked)
</span><span style=color:#86b300>+        .add_observer(button_on_interaction::&LTAdd, Pressed>)
</span><span style=color:#86b300>+        .add_observer(button_on_interaction::&LTRemove, Pressed>)
</span><span style=color:#86b300>+        .add_observer(button_on_interaction::&LTAdd, InteractionDisabled>)
</span><span style=color:#86b300>+        .add_observer(button_on_interaction::&LTRemove, InteractionDisabled>)
</span><span style=color:#86b300>+        .add_observer(button_on_interaction::&LTInsert, Hovered>)
</span><span style=color:#86b300>+        .add_observer(slider_on_interaction::&LTAdd, InteractionDisabled>)
</span><span style=color:#86b300>+        .add_observer(slider_on_interaction::&LTRemove, InteractionDisabled>)
</span><span style=color:#86b300>+        .add_observer(slider_on_interaction::&LTInsert, Hovered>)
</span><span style=color:#86b300>+        .add_observer(slider_on_change_value::&LTSliderValue>)
</span><span style=color:#86b300>+        .add_observer(slider_on_change_value::&LTSliderRange>)
</span><span style=color:#86b300>+        .add_observer(checkbox_on_interaction::&LTAdd, InteractionDisabled>)
</span><span style=color:#86b300>+        .add_observer(checkbox_on_interaction::&LTRemove, InteractionDisabled>)
</span><span style=color:#86b300>+        .add_observer(checkbox_on_interaction::&LTInsert, Hovered>)
</span><span style=color:#86b300>+        .add_observer(checkbox_on_interaction::&LTAdd, Checked>)
</span><span style=color:#86b300>+        .add_observer(checkbox_on_interaction::&LTRemove, Checked>)
</span><span>         .add_systems(Update, (update_widget_values, toggle_disabled))
</span><span>         .run();
</span><span> }
</span><span style=color:#c594c5>@@ -157,99 +158,13 @@ </span><span style=color:#399ee6>fn button(asset_server: &AssetServer, on_click: Callback&LTIn&LTActivate>>) -> impl
</span><span>     )
</span><span> }
</span><span> 
</span><span style=color:#f07171>-fn button_on_add_pressed(
</span><span style=color:#f07171>-    add: On&LTAdd, Pressed>,
</span><span style=color:#86b300>+fn button_on_interaction&LTE: EntityEvent, C: Component>(
</span><span style=color:#86b300>+    event: On&LTE, C>,
</span><span>     mut buttons: Query<
</span><span>         (
</span><span>             &Hovered,
</span><span>             Has&LTInteractionDisabled>,
</span><span style=color:#f07171>-            &mut BackgroundColor,
</span><span style=color:#f07171>-            &mut BorderColor,
</span><span style=color:#f07171>-            &Children,
</span><span style=color:#f07171>-        ),
</span><span style=color:#f07171>-        With&LTDemoButton>,
</span><span style=color:#f07171>-    >,
</span><span style=color:#f07171>-    mut text_query: Query<&mut Text>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((hovered, disabled, mut color, mut border_color, children)) =
</span><span style=color:#f07171>-        buttons.get_mut(add.entity)
</span><span style=color:#f07171>-    {
</span><span style=color:#f07171>-        let mut text = text_query.get_mut(children[0]).unwrap();
</span><span style=color:#f07171>-        set_button_style(
</span><span style=color:#f07171>-            disabled,
</span><span style=color:#f07171>-            hovered.get(),
</span><span style=color:#f07171>-            true,
</span><span style=color:#f07171>-            &mut color,
</span><span style=color:#f07171>-            &mut border_color,
</span><span style=color:#f07171>-            &mut text,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn button_on_remove_pressed(
</span><span style=color:#f07171>-    remove: On&LTRemove, Pressed>,
</span><span style=color:#f07171>-    mut buttons: Query<
</span><span style=color:#f07171>-        (
</span><span style=color:#f07171>-            &Hovered,
</span><span style=color:#f07171>-            Has&LTInteractionDisabled>,
</span><span style=color:#f07171>-            &mut BackgroundColor,
</span><span style=color:#f07171>-            &mut BorderColor,
</span><span style=color:#f07171>-            &Children,
</span><span style=color:#f07171>-        ),
</span><span style=color:#f07171>-        With&LTDemoButton>,
</span><span style=color:#f07171>-    >,
</span><span style=color:#f07171>-    mut text_query: Query<&mut Text>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((hovered, disabled, mut color, mut border_color, children)) =
</span><span style=color:#f07171>-        buttons.get_mut(remove.entity)
</span><span style=color:#f07171>-    {
</span><span style=color:#f07171>-        let mut text = text_query.get_mut(children[0]).unwrap();
</span><span style=color:#f07171>-        set_button_style(
</span><span style=color:#f07171>-            disabled,
</span><span style=color:#f07171>-            hovered.get(),
</span><span style=color:#f07171>-            false,
</span><span style=color:#f07171>-            &mut color,
</span><span style=color:#f07171>-            &mut border_color,
</span><span style=color:#f07171>-            &mut text,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn button_on_add_disabled(
</span><span style=color:#f07171>-    add: On&LTAdd, InteractionDisabled>,
</span><span style=color:#f07171>-    mut buttons: Query<
</span><span style=color:#f07171>-        (
</span><span style=color:#f07171>-            Has&LTPressed>,
</span><span style=color:#f07171>-            &Hovered,
</span><span style=color:#f07171>-            &mut BackgroundColor,
</span><span style=color:#f07171>-            &mut BorderColor,
</span><span style=color:#f07171>-            &Children,
</span><span style=color:#f07171>-        ),
</span><span style=color:#f07171>-        With&LTDemoButton>,
</span><span style=color:#f07171>-    >,
</span><span style=color:#f07171>-    mut text_query: Query<&mut Text>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((pressed, hovered, mut color, mut border_color, children)) =
</span><span style=color:#f07171>-        buttons.get_mut(add.entity)
</span><span style=color:#f07171>-    {
</span><span style=color:#f07171>-        let mut text = text_query.get_mut(children[0]).unwrap();
</span><span style=color:#f07171>-        set_button_style(
</span><span style=color:#f07171>-            true,
</span><span style=color:#f07171>-            hovered.get(),
</span><span style=color:#f07171>-            pressed,
</span><span style=color:#f07171>-            &mut color,
</span><span style=color:#f07171>-            &mut border_color,
</span><span style=color:#f07171>-            &mut text,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn button_on_remove_disabled(
</span><span style=color:#f07171>-    remove: On&LTRemove, InteractionDisabled>,
</span><span style=color:#f07171>-    mut buttons: Query<
</span><span style=color:#f07171>-        (
</span><span>             Has&LTPressed>,
</span><span style=color:#f07171>-            &Hovered,
</span><span>             &mut BackgroundColor,
</span><span>             &mut BorderColor,
</span><span>             &Children,
</span><span style=color:#c594c5>@@ -258,38 +173,8 @@ </span><span style=color:#399ee6>fn button_on_remove_disabled(
</span><span>     >,
</span><span>     mut text_query: Query<&mut Text>,
</span><span> ) {
</span><span style=color:#f07171>-    if let Ok((pressed, hovered, mut color, mut border_color, children)) =
</span><span style=color:#f07171>-        buttons.get_mut(remove.entity)
</span><span style=color:#f07171>-    {
</span><span style=color:#f07171>-        let mut text = text_query.get_mut(children[0]).unwrap();
</span><span style=color:#f07171>-        set_button_style(
</span><span style=color:#f07171>-            false,
</span><span style=color:#f07171>-            hovered.get(),
</span><span style=color:#f07171>-            pressed,
</span><span style=color:#f07171>-            &mut color,
</span><span style=color:#f07171>-            &mut border_color,
</span><span style=color:#f07171>-            &mut text,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn button_on_change_hover(
</span><span style=color:#f07171>-    insert: On&LTInsert, Hovered>,
</span><span style=color:#f07171>-    mut buttons: Query<
</span><span style=color:#f07171>-        (
</span><span style=color:#f07171>-            Has&LTPressed>,
</span><span style=color:#f07171>-            &Hovered,
</span><span style=color:#f07171>-            Has&LTInteractionDisabled>,
</span><span style=color:#f07171>-            &mut BackgroundColor,
</span><span style=color:#f07171>-            &mut BorderColor,
</span><span style=color:#f07171>-            &Children,
</span><span style=color:#f07171>-        ),
</span><span style=color:#f07171>-        With&LTDemoButton>,
</span><span style=color:#f07171>-    >,
</span><span style=color:#f07171>-    mut text_query: Query<&mut Text>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((pressed, hovered, disabled, mut color, mut border_color, children)) =
</span><span style=color:#f07171>-        buttons.get_mut(insert.entity)
</span><span style=color:#86b300>+    if let Ok((hovered, disabled, pressed, mut color, mut border_color, children)) =
</span><span style=color:#86b300>+        buttons.get_mut(event.event_target())
</span><span>     {
</span><span>         if children.is_empty() {
</span><span>             return;
</span><span style=color:#c594c5>@@ -297,52 +182,37 @@ </span><span style=color:#399ee6>fn button_on_change_hover(
</span><span>         let Ok(mut text) = text_query.get_mut(children[0]) else {
</span><span>             return;
</span><span>         };
</span><span style=color:#f07171>-        set_button_style(
</span><span style=color:#f07171>-            disabled,
</span><span style=color:#f07171>-            hovered.get(),
</span><span style=color:#f07171>-            pressed,
</span><span style=color:#f07171>-            &mut color,
</span><span style=color:#f07171>-            &mut border_color,
</span><span style=color:#f07171>-            &mut text,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn set_button_style(
</span><span style=color:#f07171>-    disabled: bool,
</span><span style=color:#f07171>-    hovered: bool,
</span><span style=color:#f07171>-    pressed: bool,
</span><span style=color:#f07171>-    color: &mut BackgroundColor,
</span><span style=color:#f07171>-    border_color: &mut BorderColor,
</span><span style=color:#f07171>-    text: &mut Text,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    match (disabled, hovered, pressed) {
</span><span style=color:#f07171>-        // Disabled button
</span><span style=color:#f07171>-        (true, _, _) => {
</span><span style=color:#f07171>-            **text = "Disabled".to_string();
</span><span style=color:#f07171>-            *color = NORMAL_BUTTON.into();
</span><span style=color:#f07171>-            border_color.set_all(GRAY);
</span><span style=color:#f07171>-        }
</span><span style=color:#86b300>+        let hovered = hovered.get();
</span><span style=color:#86b300>+        let pressed = pressed && !(E::is::&LTRemove>() && C::is::&LTPressed>());
</span><span style=color:#86b300>+        let disabled = disabled && !(E::is::&LTRemove>() && C::is::&LTInteractionDisabled>());
</span><span style=color:#86b300>+        match (disabled, hovered, pressed) {
</span><span style=color:#86b300>+            // Disabled button
</span><span style=color:#86b300>+            (true, _, _) => {
</span><span style=color:#86b300>+                **text = "Disabled".to_string();
</span><span style=color:#86b300>+                *color = NORMAL_BUTTON.into();
</span><span style=color:#86b300>+                border_color.set_all(GRAY);
</span><span style=color:#86b300>+            }
</span><span> 
</span><span style=color:#f07171>-        // Pressed and hovered button
</span><span style=color:#f07171>-        (false, true, true) => {
</span><span style=color:#f07171>-            **text = "Press".to_string();
</span><span style=color:#f07171>-            *color = PRESSED_BUTTON.into();
</span><span style=color:#f07171>-            border_color.set_all(RED);
</span><span style=color:#f07171>-        }
</span><span style=color:#86b300>+            // Pressed and hovered button
</span><span style=color:#86b300>+            (false, true, true) => {
</span><span style=color:#86b300>+                **text = "Press".to_string();
</span><span style=color:#86b300>+                *color = PRESSED_BUTTON.into();
</span><span style=color:#86b300>+                border_color.set_all(RED);
</span><span style=color:#86b300>+            }
</span><span> 
</span><span style=color:#f07171>-        // Hovered, unpressed button
</span><span style=color:#f07171>-        (false, true, false) => {
</span><span style=color:#f07171>-            **text = "Hover".to_string();
</span><span style=color:#f07171>-            *color = HOVERED_BUTTON.into();
</span><span style=color:#f07171>-            border_color.set_all(WHITE);
</span><span style=color:#f07171>-        }
</span><span style=color:#86b300>+            // Hovered, unpressed button
</span><span style=color:#86b300>+            (false, true, false) => {
</span><span style=color:#86b300>+                **text = "Hover".to_string();
</span><span style=color:#86b300>+                *color = HOVERED_BUTTON.into();
</span><span style=color:#86b300>+                border_color.set_all(WHITE);
</span><span style=color:#86b300>+            }
</span><span> 
</span><span style=color:#f07171>-        // Unhovered button (either pressed or not).
</span><span style=color:#f07171>-        (false, false, _) => {
</span><span style=color:#f07171>-            **text = "Button".to_string();
</span><span style=color:#f07171>-            *color = NORMAL_BUTTON.into();
</span><span style=color:#f07171>-            border_color.set_all(BLACK);
</span><span style=color:#86b300>+            // Unhovered button (either pressed or not).
</span><span style=color:#86b300>+            (false, false, _) => {
</span><span style=color:#86b300>+                **text = "Button".to_string();
</span><span style=color:#86b300>+                *color = NORMAL_BUTTON.into();
</span><span style=color:#86b300>+                border_color.set_all(BLACK);
</span><span style=color:#86b300>+            }
</span><span>         }
</span><span>     }
</span><span> }
</span><span style=color:#c594c5>@@ -420,47 +290,14 @@ </span><span style=color:#399ee6>fn slider(
</span><span>     )
</span><span> }
</span><span> 
</span><span style=color:#f07171>-fn slider_on_add_disabled(
</span><span style=color:#f07171>-    add: On&LTAdd, InteractionDisabled>,
</span><span style=color:#f07171>-    sliders: Query<(Entity, &Hovered), With&LTDemoSlider>>,
</span><span style=color:#f07171>-    children: Query<&Children>,
</span><span style=color:#f07171>-    mut thumbs: Query<(&mut BackgroundColor, Has&LTDemoSliderThumb>), Without&LTDemoSlider>>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((slider_ent, hovered)) = sliders.get(add.entity) {
</span><span style=color:#f07171>-        for child in children.iter_descendants(slider_ent) {
</span><span style=color:#f07171>-            if let Ok((mut thumb_bg, is_thumb)) = thumbs.get_mut(child)
</span><span style=color:#f07171>-                && is_thumb
</span><span style=color:#f07171>-            {
</span><span style=color:#f07171>-                thumb_bg.0 = thumb_color(true, hovered.0);
</span><span style=color:#f07171>-            }
</span><span style=color:#f07171>-        }
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn slider_on_remove_disabled(
</span><span style=color:#f07171>-    remove: On&LTRemove, InteractionDisabled>,
</span><span style=color:#f07171>-    sliders: Query<(Entity, &Hovered), With&LTDemoSlider>>,
</span><span style=color:#f07171>-    children: Query<&Children>,
</span><span style=color:#f07171>-    mut thumbs: Query<(&mut BackgroundColor, Has&LTDemoSliderThumb>), Without&LTDemoSlider>>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((slider_ent, hovered)) = sliders.get(remove.entity) {
</span><span style=color:#f07171>-        for child in children.iter_descendants(slider_ent) {
</span><span style=color:#f07171>-            if let Ok((mut thumb_bg, is_thumb)) = thumbs.get_mut(child)
</span><span style=color:#f07171>-                && is_thumb
</span><span style=color:#f07171>-            {
</span><span style=color:#f07171>-                thumb_bg.0 = thumb_color(false, hovered.0);
</span><span style=color:#f07171>-            }
</span><span style=color:#f07171>-        }
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn slider_on_change_hover(
</span><span style=color:#f07171>-    insert: On&LTInsert, Hovered>,
</span><span style=color:#86b300>+fn slider_on_interaction&LTE: EntityEvent, C: Component>(
</span><span style=color:#86b300>+    event: On&LTE, C>,
</span><span>     sliders: Query<(Entity, &Hovered, Has&LTInteractionDisabled>), With&LTDemoSlider>>,
</span><span>     children: Query<&Children>,
</span><span>     mut thumbs: Query<(&mut BackgroundColor, Has&LTDemoSliderThumb>), Without&LTDemoSlider>>,
</span><span> ) {
</span><span style=color:#f07171>-    if let Ok((slider_ent, hovered, disabled)) = sliders.get(insert.entity) {
</span><span style=color:#86b300>+    if let Ok((slider_ent, hovered, disabled)) = sliders.get(event.event_target()) {
</span><span style=color:#86b300>+        let disabled = disabled && !(E::is::&LTRemove>() && C::is::&LTInteractionDisabled>());
</span><span>         for child in children.iter_descendants(slider_ent) {
</span><span>             if let Ok((mut thumb_bg, is_thumb)) = thumbs.get_mut(child)
</span><span>                 && is_thumb
</span><span style=color:#c594c5>@@ -471,25 +308,8 @@ </span><span style=color:#399ee6>fn slider_on_change_hover(
</span><span>     }
</span><span> }
</span><span> 
</span><span style=color:#f07171>-fn slider_on_change_value(
</span><span style=color:#f07171>-    insert: On&LTInsert, SliderValue>,
</span><span style=color:#f07171>-    sliders: Query<(Entity, &SliderValue, &SliderRange), With&LTDemoSlider>>,
</span><span style=color:#f07171>-    children: Query<&Children>,
</span><span style=color:#f07171>-    mut thumbs: Query<(&mut Node, Has&LTDemoSliderThumb>), Without&LTDemoSlider>>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((slider_ent, value, range)) = sliders.get(insert.entity) {
</span><span style=color:#f07171>-        for child in children.iter_descendants(slider_ent) {
</span><span style=color:#f07171>-            if let Ok((mut thumb_node, is_thumb)) = thumbs.get_mut(child)
</span><span style=color:#f07171>-                && is_thumb
</span><span style=color:#f07171>-            {
</span><span style=color:#f07171>-                thumb_node.left = percent(range.thumb_position(value.0) * 100.0);
</span><span style=color:#f07171>-            }
</span><span style=color:#f07171>-        }
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn slider_on_change_range(
</span><span style=color:#f07171>-    insert: On&LTInsert, SliderRange>,
</span><span style=color:#86b300>+fn slider_on_change_value&LTC: Component>(
</span><span style=color:#86b300>+    insert: On&LTInsert, C>,
</span><span>     sliders: Query<(Entity, &SliderValue, &SliderRange), With&LTDemoSlider>>,
</span><span>     children: Query<&Children>,
</span><span>     mut thumbs: Query<(&mut Node, Has&LTDemoSliderThumb>), Without&LTDemoSlider>>,
</span><span style=color:#c594c5>@@ -576,37 +396,8 @@ </span><span style=color:#399ee6>fn checkbox(
</span><span>     )
</span><span> }
</span><span> 
</span><span style=color:#f07171>-fn checkbox_on_add_disabled(
</span><span style=color:#f07171>-    add: On&LTAdd, InteractionDisabled>,
</span><span style=color:#f07171>-    checkboxes: Query<(&Hovered, Has&LTChecked>, &Children), With&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    mut borders: Query<(&mut BorderColor, &mut Children), Without&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    mut marks: Query<&mut BackgroundColor, (Without&LTDemoCheckbox>, Without&LTChildren>)>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((hovered, checked, children)) = checkboxes.get(add.entity) {
</span><span style=color:#f07171>-        set_checkbox_style(children, &mut borders, &mut marks, true, hovered.0, checked);
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn checkbox_on_remove_disabled(
</span><span style=color:#f07171>-    remove: On&LTRemove, InteractionDisabled>,
</span><span style=color:#f07171>-    checkboxes: Query<(&Hovered, Has&LTChecked>, &Children), With&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    mut borders: Query<(&mut BorderColor, &mut Children), Without&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    mut marks: Query<&mut BackgroundColor, (Without&LTDemoCheckbox>, Without&LTChildren>)>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((hovered, checked, children)) = checkboxes.get(remove.entity) {
</span><span style=color:#f07171>-        set_checkbox_style(
</span><span style=color:#f07171>-            children,
</span><span style=color:#f07171>-            &mut borders,
</span><span style=color:#f07171>-            &mut marks,
</span><span style=color:#f07171>-            false,
</span><span style=color:#f07171>-            hovered.0,
</span><span style=color:#f07171>-            checked,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-fn checkbox_on_change_hover(
</span><span style=color:#f07171>-    insert: On&LTInsert, Hovered>,
</span><span style=color:#86b300>+fn checkbox_on_interaction&LTE: EntityEvent, C: Component>(
</span><span style=color:#86b300>+    event: On&LTE, C>,
</span><span>     checkboxes: Query<
</span><span>         (&Hovered, Has&LTInteractionDisabled>, Has&LTChecked>, &Children),
</span><span>         With&LTDemoCheckbox>,
</span><span style=color:#c594c5>@@ -614,106 +405,53 @@ </span><span style=color:#399ee6>fn checkbox_on_change_hover(
</span><span>     mut borders: Query<(&mut BorderColor, &mut Children), Without&LTDemoCheckbox>>,
</span><span>     mut marks: Query<&mut BackgroundColor, (Without&LTDemoCheckbox>, Without&LTChildren>)>,
</span><span> ) {
</span><span style=color:#f07171>-    if let Ok((hovered, disabled, checked, children)) = checkboxes.get(insert.entity) {
</span><span style=color:#f07171>-        set_checkbox_style(
</span><span style=color:#f07171>-            children,
</span><span style=color:#f07171>-            &mut borders,
</span><span style=color:#f07171>-            &mut marks,
</span><span style=color:#f07171>-            disabled,
</span><span style=color:#f07171>-            hovered.0,
</span><span style=color:#f07171>-            checked,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#86b300>+    if let Ok((hovered, disabled, checked, children)) = checkboxes.get(event.event_target()) {
</span><span style=color:#86b300>+        let hovered = hovered.get();
</span><span style=color:#86b300>+        let checked = checked && !(E::is::&LTRemove>() && C::is::&LTChecked>());
</span><span style=color:#86b300>+        let disabled = disabled && !(E::is::&LTRemove>() && C::is::&LTInteractionDisabled>());
</span><span> 
</span><span style=color:#f07171>-fn checkbox_on_add_checked(
</span><span style=color:#f07171>-    add: On&LTAdd, Checked>,
</span><span style=color:#f07171>-    checkboxes: Query<
</span><span style=color:#f07171>-        (&Hovered, Has&LTInteractionDisabled>, Has&LTChecked>, &Children),
</span><span style=color:#f07171>-        With&LTDemoCheckbox>,
</span><span style=color:#f07171>-    >,
</span><span style=color:#f07171>-    mut borders: Query<(&mut BorderColor, &mut Children), Without&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    mut marks: Query<&mut BackgroundColor, (Without&LTDemoCheckbox>, Without&LTChildren>)>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((hovered, disabled, checked, children)) = checkboxes.get(add.entity) {
</span><span style=color:#f07171>-        set_checkbox_style(
</span><span style=color:#f07171>-            children,
</span><span style=color:#f07171>-            &mut borders,
</span><span style=color:#f07171>-            &mut marks,
</span><span style=color:#f07171>-            disabled,
</span><span style=color:#f07171>-            hovered.0,
</span><span style=color:#f07171>-            checked,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#86b300>+        let Some(border_id) = children.first() else {
</span><span style=color:#86b300>+            return;
</span><span style=color:#86b300>+        };
</span><span> 
</span><span style=color:#f07171>-fn checkbox_on_remove_checked(
</span><span style=color:#f07171>-    remove: On&LTRemove, Checked>,
</span><span style=color:#f07171>-    checkboxes: Query<(&Hovered, Has&LTInteractionDisabled>, &Children), With&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    mut borders: Query<(&mut BorderColor, &mut Children), Without&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    mut marks: Query<&mut BackgroundColor, (Without&LTDemoCheckbox>, Without&LTChildren>)>,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    if let Ok((hovered, disabled, children)) = checkboxes.get(remove.entity) {
</span><span style=color:#f07171>-        set_checkbox_style(
</span><span style=color:#f07171>-            children,
</span><span style=color:#f07171>-            &mut borders,
</span><span style=color:#f07171>-            &mut marks,
</span><span style=color:#f07171>-            disabled,
</span><span style=color:#f07171>-            hovered.0,
</span><span style=color:#f07171>-            false,
</span><span style=color:#f07171>-        );
</span><span style=color:#f07171>-    }
</span><span style=color:#f07171>-}
</span><span style=color:#86b300>+        let Ok((mut border_color, border_children)) = borders.get_mut(*border_id) else {
</span><span style=color:#86b300>+            return;
</span><span style=color:#86b300>+        };
</span><span> 
</span><span style=color:#f07171>-fn set_checkbox_style(
</span><span style=color:#f07171>-    children: &Children,
</span><span style=color:#f07171>-    borders: &mut Query<(&mut BorderColor, &mut Children), Without&LTDemoCheckbox>>,
</span><span style=color:#f07171>-    marks: &mut Query<&mut BackgroundColor, (Without&LTDemoCheckbox>, Without&LTChildren>)>,
</span><span style=color:#f07171>-    disabled: bool,
</span><span style=color:#f07171>-    hovering: bool,
</span><span style=color:#f07171>-    checked: bool,
</span><span style=color:#f07171>-) {
</span><span style=color:#f07171>-    let Some(border_id) = children.first() else {
</span><span style=color:#f07171>-        return;
</span><span style=color:#f07171>-    };
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-    let Ok((mut border_color, border_children)) = borders.get_mut(*border_id) else {
</span><span style=color:#f07171>-        return;
</span><span style=color:#f07171>-    };
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-    let Some(mark_id) = border_children.first() else {
</span><span style=color:#f07171>-        warn!("Checkbox does not have a mark entity.");
</span><span style=color:#f07171>-        return;
</span><span style=color:#f07171>-    };
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-    let Ok(mut mark_bg) = marks.get_mut(*mark_id) else {
</span><span style=color:#f07171>-        warn!("Checkbox mark entity lacking a background color.");
</span><span style=color:#f07171>-        return;
</span><span style=color:#f07171>-    };
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-    let color: Color = if disabled {
</span><span style=color:#f07171>-        // If the checkbox is disabled, use a lighter color
</span><span style=color:#f07171>-        CHECKBOX_OUTLINE.with_alpha(0.2)
</span><span style=color:#f07171>-    } else if hovering {
</span><span style=color:#f07171>-        // If hovering, use a lighter color
</span><span style=color:#f07171>-        CHECKBOX_OUTLINE.lighter(0.2)
</span><span style=color:#f07171>-    } else {
</span><span style=color:#f07171>-        // Default color for the checkbox
</span><span style=color:#f07171>-        CHECKBOX_OUTLINE
</span><span style=color:#f07171>-    };
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-    // Update the background color of the check mark
</span><span style=color:#f07171>-    border_color.set_all(color);
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-    let mark_color: Color = match (disabled, checked) {
</span><span style=color:#f07171>-        (true, true) => CHECKBOX_CHECK.with_alpha(0.5),
</span><span style=color:#f07171>-        (false, true) => CHECKBOX_CHECK,
</span><span style=color:#f07171>-        (_, false) => Srgba::NONE.into(),
</span><span style=color:#f07171>-    };
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-    if mark_bg.0 != mark_color {
</span><span style=color:#f07171>-        // Update the color of the check mark
</span><span style=color:#f07171>-        mark_bg.0 = mark_color;
</span><span style=color:#86b300>+        let Some(mark_id) = border_children.first() else {
</span><span style=color:#86b300>+            warn!("Checkbox does not have a mark entity.");
</span><span style=color:#86b300>+            return;
</span><span style=color:#86b300>+        };
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+        let Ok(mut mark_bg) = marks.get_mut(*mark_id) else {
</span><span style=color:#86b300>+            warn!("Checkbox mark entity lacking a background color.");
</span><span style=color:#86b300>+            return;
</span><span style=color:#86b300>+        };
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+        let color: Color = if disabled {
</span><span style=color:#86b300>+            // If the checkbox is disabled, use a lighter color
</span><span style=color:#86b300>+            CHECKBOX_OUTLINE.with_alpha(0.2)
</span><span style=color:#86b300>+        } else if hovered {
</span><span style=color:#86b300>+            // If hovering, use a lighter color
</span><span style=color:#86b300>+            CHECKBOX_OUTLINE.lighter(0.2)
</span><span style=color:#86b300>+        } else {
</span><span style=color:#86b300>+            // Default color for the checkbox
</span><span style=color:#86b300>+            CHECKBOX_OUTLINE
</span><span style=color:#86b300>+        };
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+        // Update the background color of the check mark
</span><span style=color:#86b300>+        border_color.set_all(color);
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+        let mark_color: Color = match (disabled, checked) {
</span><span style=color:#86b300>+            (true, true) => CHECKBOX_CHECK.with_alpha(0.5),
</span><span style=color:#86b300>+            (false, true) => CHECKBOX_CHECK,
</span><span style=color:#86b300>+            (_, false) => Srgba::NONE.into(),
</span><span style=color:#86b300>+        };
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+        if mark_bg.0 != mark_color {
</span><span style=color:#86b300>+            // Update the color of the check mark
</span><span style=color:#86b300>+            mark_bg.0 = mark_color;
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> }
</span><span> 
</span><span style=color:#c594c5>@@ -752,3 +490,14 @@ </span><span style=color:#399ee6>fn toggle_disabled(
</span><span>         }
</span><span>     }
</span><span> }
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+trait Is {
</span><span style=color:#86b300>+    fn is&LTT: Any>() -> bool;
</span><span style=color:#86b300>+}
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+impl&LTA: Any> Is for A {
</span><span style=color:#86b300>+    #[inline]
</span><span style=color:#86b300>+    fn is&LTT: Any>() -> bool {
</span><span style=color:#86b300>+        TypeId::of::&LTA>() == TypeId::of::&LTT>()
</span><span style=color:#86b300>+    }
</span><span style=color:#86b300>+}
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_20977.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>