<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21241 Remove redundant `$arg: ident` of the `impl_typed_function` macro
        
    </title><meta content="#21241 Remove redundant `$arg: ident` of the `impl_typed_function` macro" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-28</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21241-zh-cn-20250928>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Remove redundant <code>$arg: ident</code> of the <code>impl_typed_function</code> macro<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21241<li><strong>Author</strong>: Mysvac<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Code-Quality, S-Ready-For-Final-Review, A-Reflection<li><strong>Created</strong>: 2025-09-27T11:49:11Z<li><strong>Merged</strong>: 2025-09-28T18:02:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>bevy_reflect: function reflection<p>The <code>$arg: ident</code> in macro <code>impl_typed_function</code> is redundant. It is not used internally at all. So I removed it.<h2 id=testing>Testing</h2><ul><li><code>cargo run --features="reflect_functions" --example function_reflection</code><li><code>cargo test -p bevy_reflect --features="functions"</code></ul><hr><h2 id=showcase>Showcase</h2><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>macro_rules! </span><span style=color:#399ee6>impl_typed_function </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ($((</span><span style=color:#61676c;font-style:italic>$Arg</span><span style=color:#abb0b6;font-style:italic>:ident, </span><span style=color:#61676c;font-style:italic>$arg</span><span style=color:#abb0b6;font-style:italic>:ident)),*) => {
</span><span>    (</span><span style=color:#ed9366>$</span><span>(</span><span style=color:#ff8f40>$Arg</span><span style=color:#61676ccc>:</span><span style=color:#fa6e32>ident</span><span>),</span><span style=color:#ed9366>*</span><span>) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ......
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// all_tuples!(impl_typed_function, 0, 15, Arg, arg);
</span><span style=color:#f07171>all_tuples!</span><span>(impl_typed_function</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>15</span><span style=color:#61676ccc>,</span><span> Arg)</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward code quality issue in Bevy’s reflection system. The problem was in the <code>impl_typed_function</code> macro, which had an unused parameter that served no functional purpose but added unnecessary complexity to the code.<p>The <code>impl_typed_function</code> macro is responsible for generating implementations of the <code>TypedFunction</code> trait for Rust functions with different numbers of arguments. The macro was designed to accept pairs of identifiers - one for the argument type and one for the argument name. However, during the macro expansion, only the type identifiers (<code>$Arg</code>) were actually used in the generated code, while the argument name identifiers (<code>$arg</code>) were completely unused.<p>The developer identified this redundancy through code inspection and realized that the <code>$arg</code> parameters were essentially dead code. They weren’t referenced in any of the macro’s expansion patterns, making them unnecessary complexity. This is a common type of technical debt that accumulates in complex macro systems - parameters that were perhaps intended for future use but never actually utilized.<p>The solution was simple and direct: remove the unused <code>$arg</code> parameters from both the macro pattern definition and the call to <code>all_tuples!</code>. This change reduced the macro’s complexity without affecting any functionality, since the removed parameters weren’t contributing to the actual code generation.<p>The implementation involved two key changes. First, the macro pattern was simplified from <code>$(($Arg:ident, $arg:ident)),*</code> to <code>$($Arg:ident),*</code>. Second, the invocation of the <code>all_tuples!</code> helper macro was updated to pass only the type identifiers instead of both type and name identifiers.<p>This change demonstrates good code hygiene practices. By removing unused parameters, the code becomes more maintainable and easier to understand. Future developers working with this macro won’t need to wonder about the purpose of the <code>$arg</code> parameters or whether they’re missing some functionality that depends on them.<p>The testing approach was appropriate for this type of change - running the existing function reflection example and executing the relevant test suite to ensure no regressions were introduced. Since this was purely a code cleanup change that didn’t affect runtime behavior, comprehensive testing of the reflection system’s functionality was sufficient to validate the change.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[impl_typed_function Macro] --> B[Before: Complex Pattern]
</span><span>    A --> C[After: Simplified Pattern]
</span><span>    B --> D[Unused $arg parameters]
</span><span>    C --> E[Cleaner Implementation]
</span><span>    D --> F[Code Complexity]
</span><span>    E --> G[Better Maintainability]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-reflect-src-func-info-rs-7-7><code>crates/bevy_reflect/src/func/info.rs</code> (+7/-7)</h3><p>This file contains the core implementation of function reflection in Bevy. The changes focus on simplifying the macro that generates typed function implementations.<p><strong>Key modifications:</strong><ol><li><strong>Macro pattern simplification:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>macro_rules! </span><span style=color:#399ee6>impl_typed_function </span><span>{
</span><span>    (</span><span style=color:#ed9366>$</span><span>((</span><span style=color:#ff8f40>$Arg</span><span style=color:#61676ccc>:</span><span style=color:#fa6e32>ident</span><span>, </span><span style=color:#ff8f40>$arg</span><span style=color:#61676ccc>:</span><span style=color:#fa6e32>ident</span><span>))</span><span style=color:#61676ccc>,</span><span>*) => {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Macro implementation using only </span><span style=color:#61676c;font-style:italic>$Arg</span><span style=color:#abb0b6;font-style:italic> parameters
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>macro_rules! </span><span style=color:#399ee6>impl_typed_function </span><span>{
</span><span>    (</span><span style=color:#ed9366>$</span><span>(</span><span style=color:#ff8f40>$Arg</span><span style=color:#61676ccc>:</span><span style=color:#fa6e32>ident</span><span>),</span><span style=color:#ed9366>*</span><span>) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Same macro implementation, but cleaner signature
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=2><li><strong>Macro invocation update:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>all_tuples!</span><span>(impl_typed_function</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>15</span><span style=color:#61676ccc>,</span><span> Arg</span><span style=color:#61676ccc>,</span><span> arg)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>all_tuples!</span><span>(impl_typed_function</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>15</span><span style=color:#61676ccc>,</span><span> Arg)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Documentation alignment:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before comment:
</span><span style=color:#abb0b6;font-style:italic>// This currently implements it for the following signatures (where `argX` may be any of `T`, `&T`, or `&mut T`):
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After comment:  
</span><span style=color:#abb0b6;font-style:italic>// This currently implements it for the following signatures (where `ArgX` may be any of `T`, `&T`, or `&mut T`):
</span></code></pre><p>The changes ensure that the macro’s external interface matches its internal implementation, eliminating the cognitive overhead of understanding why certain parameters are present but unused.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch19-06-macros.html target=_blank>The Rust Programming Language - Macros</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/reflection/ target=_blank>Bevy Engine Reflection System</a><li><a rel="noopener nofollow noreferrer" href=https://danielkeep.github.io/tlborm/book/README.html target=_blank>Rust Macro Patterns and Best Practices</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21241.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>