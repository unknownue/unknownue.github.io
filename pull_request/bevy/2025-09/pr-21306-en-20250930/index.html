<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21306 Replace `feature(doc_auto_cfg)` with `feature(doc_cfg)`, part 2
        
    </title><meta content="#21306 Replace `feature(doc_auto_cfg)` with `feature(doc_cfg)`, part 2" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21306-zh-cn-20250930>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Replace <code>feature(doc_auto_cfg)</code> with <code>feature(doc_cfg)</code>, part 2<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21306<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-Build-System<li><strong>Created</strong>: 2025-09-30T21:56:46Z<li><strong>Merged</strong>: 2025-09-30T22:41:34Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><p>This is a follow-up to PR #21304 that addresses a few remaining instances where the <code>feature(doc_auto_cfg)</code> attribute needed to be replaced with <code>feature(doc_cfg)</code>. The solution simply changes these remaining occurrences.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR represents a straightforward cleanup task that continues work started in a previous pull request (#21304). The core issue involved updating Rust feature flags used for documentation generation across the Bevy codebase.<p>The problem stemmed from changes in Rust’s documentation generation system. The <code>doc_auto_cfg</code> feature, which automatically generated documentation for conditional compilation features, was being replaced by the more stable <code>doc_cfg</code> feature. While PR #21304 addressed most instances of this transition, several key crates were missed during the initial implementation.<p>The solution approach was methodical and targeted. The developer identified the four remaining crates that still used the old feature flag and systematically updated each one. This required understanding how Rust’s conditional compilation attributes work, particularly the <code>cfg_attr</code> macro that conditionally enables features based on documentation build contexts.<p>The implementation is minimal but important for maintaining consistency across the codebase. Each change follows the same pattern:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_auto_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:  
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span></code></pre><p>From a technical perspective, this change affects how Rustdoc generates documentation for conditional compilation features. The <code>doc_cfg</code> feature provides more explicit control over how feature-gated APIs are documented, replacing the automatic behavior of <code>doc_auto_cfg</code>. This is particularly important for a large project like Bevy that has many feature-gated components.<p>The impact of these changes is primarily on the documentation build process. By standardizing on <code>doc_cfg</code>, the project ensures consistent documentation generation across all crates and maintains compatibility with evolving Rust documentation tools. This cleanup also prevents potential build issues that could arise from mixing different documentation feature flags.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #21304] --> B[Initial doc_auto_cfg replacement]
</span><span>    B --> C[Missed crates identified]
</span><span>    C --> D[bevy_app crate updated]
</span><span>    C --> E[bevy_ecs crate updated] 
</span><span>    C --> F[bevy_reflect crate updated]
</span><span>    C --> G[bevy_render crate updated]
</span><span>    D --> H[Consistent doc_cfg usage]
</span><span>    E --> H
</span><span>    F --> H
</span><span>    G --> H
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>crates/bevy_app/src/lib.rs</strong> (+1/-1)<ul><li>This file contains core application framework code<li>Changed the documentation feature flag from <code>doc_auto_cfg</code> to <code>doc_cfg</code></ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_auto_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span></code></pre><p><strong>crates/bevy_ecs/src/lib.rs</strong> (+1/-1)<ul><li>This file contains the Entity Component System core<li>Updated the same documentation feature flag</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_auto_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span></code></pre><p><strong>crates/bevy_reflect/src/lib.rs</strong> (+1/-1)<ul><li>This file handles reflection system capabilities<li>Applied the same documentation feature update</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_auto_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span></code></pre><p><strong>crates/bevy_render/src/lib.rs</strong> (+1/-1)<ul><li>This file contains rendering system infrastructure<li>Completed the documentation feature flag standardization</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_auto_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#!</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>any</span><span>(docsrs</span><span style=color:#61676ccc>,</span><span> docsrs_dep)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>feature</span><span>(doc_cfg</span><span style=color:#61676ccc>,</span><span> rustdoc_internals))]
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/rfcs/2974-conditional-doc.html target=_blank>Rust RFC: <code>doc_cfg</code> and <code>doc_auto_cfg</code></a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html#conditional-compilation target=_blank>Rustdoc documentation on conditional compilation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/plugins_guidelines.md#documentation target=_blank>Bevy Engine documentation guidelines</a></ul><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/crates/bevy_app/src/lib.rs b/crates/bevy_app/src/lib.rs index 188ba957f68b0..c626c6c73e838 100644 — a/crates/bevy_app/src/lib.rs +++ b/crates/bevy_app/src/lib.rs @@ -5,7 +5,7 @@ reason = “rustdoc_internals is needed for fake_variadic” ) )] -#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_auto_cfg, rustdoc_internals))] +#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_cfg, rustdoc_internals))] #![forbid(unsafe_code)] #![doc( html_logo_url = “https://bevy.org/assets/icon.png”, diff –git a/crates/bevy_ecs/src/lib.rs b/crates/bevy_ecs/src/lib.rs index d34932cb06751..2e9174bf2404c 100644 — a/crates/bevy_ecs/src/lib.rs +++ b/crates/bevy_ecs/src/lib.rs @@ -10,7 +10,7 @@ reason = “rustdoc_internals is needed for fake_variadic” ) )] -#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_auto_cfg, rustdoc_internals))] +#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_cfg, rustdoc_internals))] #![expect(unsafe_code, reason = “Unsafe code is used to improve performance.”)] #![doc( html_logo_url = “https://bevy.org/assets/icon.png”, diff –git a/crates/bevy_reflect/src/lib.rs b/crates/bevy_reflect/src/lib.rs index 359b8aaad3b03..9649d23470b61 100644 — a/crates/bevy_reflect/src/lib.rs +++ b/crates/bevy_reflect/src/lib.rs @@ -5,7 +5,7 @@ reason = “rustdoc_internals is needed for fake_variadic” ) )] -#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_auto_cfg, rustdoc_internals))] +#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_cfg, rustdoc_internals))] #![doc( html_logo_url = “https://bevy.org/assets/icon.png”, html_favicon_url = “https://bevy.org/assets/icon.png” diff –git a/crates/bevy_render/src/lib.rs b/crates/bevy_render/src/lib.rs index 8fb4ff8c0a527..b3620c7e079fa 100644 — a/crates/bevy_render/src/lib.rs +++ b/crates/bevy_render/src/lib.rs @@ -20,7 +20,7 @@ reason = “rustdoc_internals is needed for fake_variadic” ) )] -#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_auto_cfg, rustdoc_internals))] +#![cfg_attr(any(docsrs, docsrs_dep), feature(doc_cfg, rustdoc_internals))] #![doc( html_logo_url = “https://bevy.org/assets/icon.png”, html_favicon_url = “https://bevy.org/assets/icon.png”</div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21306.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>