<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20991 Use bevy_reflect::Is in standard_widgets_observers and add more comments
        
    </title><meta content="#20991 Use bevy_reflect::Is in standard_widgets_observers and add more comments" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-13</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-20991-zh-cn-20250913>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Use bevy_reflect::Is in standard_widgets_observers and add more comments<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Use bevy_reflect::Is in standard_widgets_observers and add more comments<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20991<li><strong>Author</strong>: cart<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, A-UI, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-09-12T21:31:04Z<li><strong>Merged</strong>: 2025-09-12T23:56:57Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><p><code>Is</code> has been added to <code>bevy_reflect</code>, removing the need to inline it in our examples. I’ve also taken the chance to add more comments to the standard_widgets examples.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses two related issues in Bevy’s UI examples. First, it removes code duplication by leveraging a newly available utility from <code>bevy_reflect</code>. Second, it improves documentation for a non-obvious edge case in UI event handling.<p>The core problem was that the <code>standard_widgets_observers</code> example contained a custom implementation of the <code>Is</code> trait, which provides type checking functionality. This trait was recently added to <code>bevy_reflect</code>, making the local implementation redundant. Maintaining duplicate code in examples creates maintenance overhead and sets a poor example for users who might copy this pattern.<p>The solution was straightforward: replace the custom trait implementation with the official one from <code>bevy_reflect</code>. This involved:<ol><li>Adding the import: <code>use bevy::reflect::Is;</code><li>Removing the local trait implementation<li>Updating the Cargo.toml to ensure the reflect feature was available (though this wasn’t shown in the diff)</ol><p>While making these changes, the author also identified an opportunity to improve documentation. The example contained several instances of what appeared to be redundant checks for component removal:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> pressed </span><span style=color:#ed9366>=</span><span> pressed </span><span style=color:#ed9366>&& !</span><span>(E</span><span style=color:#ed9366>::</span><span>is</span><span style=color:#ed9366>::</span><span>&LTRemove>() </span><span style=color:#ed9366>&& </span><span>C</span><span style=color:#ed9366>::</span><span>is</span><span style=color:#ed9366>::</span><span>&LTPressed>())</span><span style=color:#61676ccc>;
</span></code></pre><p>These checks exist because of a subtle timing issue in Bevy’s ECS - the <code>Remove</code> event is triggered before the component is actually removed from the entity, meaning the component still appears in queries during event processing. Without these checks, the system would incorrectly process interactions for components that are being removed.<p>The PR adds clarifying comments at three key locations where this pattern occurs:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// These "removal event checks" exist because the `Remove` event is triggered _before_ the component is actually
</span><span style=color:#abb0b6;font-style:italic>// removed, meaning it still shows up in the query. We're investigating the best way to improve this scenario.
</span></code></pre><p>These comments serve two purposes: they explain why the seemingly redundant code exists, and they acknowledge that this is a known issue with potential future improvements.<p>The changes to <code>standard_widgets.rs</code> are minor but important - they add a warning about “user experience” issues with the current widget API, setting appropriate expectations for developers who might use this example as reference.<p>From an architectural perspective, this PR demonstrates good practice in leveraging centralized utilities rather than maintaining local implementations. It also shows thoughtful attention to documentation, particularly for edge cases that might confuse other developers.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[bevy_reflect::Is] --> B[standard_widgets_observers.rs]
</span><span>    B --> C[Button interaction system]
</span><span>    B --> D[Slider interaction system]
</span><span>    B --> E[Checkbox interaction system]
</span><span>    C --> F[Removal event checks]
</span><span>    D --> F
</span><span>    E --> F
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-ui-standard-widgets-observers-rs-9-13><code>examples/ui/standard_widgets_observers.rs</code> (+9/-13)</h3><p>This file received the most significant changes:<ol><li>Added import for <code>bevy::reflect::Is</code><li>Removed custom <code>Is</code> trait implementation<li>Added explanatory comments for removal event checks</ol><p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>any</span><span style=color:#ed9366>::</span><span>{Any</span><span style=color:#61676ccc>,</span><span> TypeId}</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... (custom Is trait implementation at end of file)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>reflect</span><span style=color:#ed9366>::</span><span>Is</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... (custom Is trait removed)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added comments in three functions:
</span><span style=color:#abb0b6;font-style:italic>// These "removal event checks" exist because the `Remove` event is triggered _before_ the component is actually
</span><span style=color:#abb0b6;font-style:italic>// removed, meaning it still shows up in the query. We're investigating the best way to improve this scenario.
</span></code></pre><h3 id=examples-ui-standard-widgets-rs-2-1><code>examples/ui/standard_widgets.rs</code> (+2/-1)</h3><p>This file received minor documentation updates:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>//! matures, so please exercise caution if you are using this as a reference for your own code.
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>//! matures, so please exercise caution if you are using this as a reference for your own code,
</span><span style=color:#abb0b6;font-style:italic>//! and note that there are still "user experience" issues with this API.
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_reflect/latest/bevy_reflect/ target=_blank>Bevy Reflect documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/ebook/ecs/events/ target=_blank>Bevy ECS events documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch19-04-advanced-types.html#using-the-newtype-pattern-for-type-safety-and-abstraction target=_blank>Type checking in Rust</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_20991.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>