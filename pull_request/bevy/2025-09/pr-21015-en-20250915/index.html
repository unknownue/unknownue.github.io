<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21015 fps overlay: text node display none if disable
        
    </title><meta content="#21015 fps overlay: text node display none if disable" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21015-zh-cn-20250915>中文</a></div></div><div class=pr-content><h1 id=fps-overlay-text-node-display-none-if-disabled>FPS Overlay: Text Node Display None If Disabled</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fps overlay: text node display none if disable<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21015<li><strong>Author</strong>: torsteingrindvik<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-UI, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-09-13T16:32:44Z<li><strong>Merged</strong>: 2025-09-15T22:26:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>Fixes https://github.com/bevyengine/bevy/issues/21003<h1 id=objective>Objective</h1><p>Make sure the FPS overlay properly removes node footprint when not enabled.<h2 id=solution>Solution</h2><p>Hide the text node like the graph node does. The text node was currently using visibility, which doesn’t change the node footprint.<h2 id=testing>Testing</h2><p>My project works as expected now, buttons no longer exhibit strange picking bugs.<h2 id=showcase>Showcase</h2><p>https://github.com/user-attachments/assets/8562af43-c12d-42e0-a2db-19ae49b85d24<p>Notice unlike the linked issue the outline of the FPS overlay completely disappears now when disabled.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The issue emerged when users reported UI interaction problems in areas where the FPS overlay was positioned. Even when disabled, the overlay’s text node continued to occupy layout space, blocking interactions with underlying UI elements like buttons. This occurred because the text node used <code>Visibility::Hidden</code> instead of proper layout removal.<p>The developer identified the root cause: while the frame time graph node correctly used <code>Display::None</code> to remove itself from layout calculations, the text node relied on visibility changes that only affected rendering, not layout. This inconsistency created a situation where disabled overlay elements still impacted UI layout and interaction.<p>The solution involved standardizing the approach across both overlay components. The implementation refactored the <code>toggle_display</code> system to:<ol><li>Use targeted queries with <code>Single</code> to efficiently access both text and graph nodes<li>Apply <code>Display::None</code> consistently to both components when disabled<li>Maintain proper scaling behavior for the graph when enabled</ol><p>Key technical considerations included:<ul><li>The difference between <code>Visibility</code> (affects rendering only) and <code>Display</code> (affects layout)<li>Using <code>Single</code> queries with filter tuples for precise component access<li>Preserving the graph scaling logic when the overlay is enabled</ul><p>The changes ensure that when the FPS overlay is disabled, both text and graph nodes are completely removed from layout calculations, eliminating any footprint they previously occupied. This fixes UI interaction issues while maintaining the overlay’s functionality when enabled.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[FpsOverlayConfig] --> B[toggle_display system]
</span><span>    B --> C[FpsText Node]
</span><span>    B --> D[FrameTimeGraph Node]
</span><span>    C --> E[Display::None when disabled]
</span><span>    D --> F[Display::None when disabled]
</span><span>    D --> G[Proper scaling when enabled]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-dev-tools-src-fps-overlay-rs-16-21><code>crates/bevy_dev_tools/src/fps_overlay.rs</code> (+16/-21)</h3><p>This file contains the core logic for the FPS overlay functionality. The changes focused on the <code>toggle_display</code> system to fix layout issues when the overlay is disabled.<p><strong>Key changes:</strong><ol><li>Removed unnecessary imports (<code>Visibility</code>, <code>DetectChangesMut</code>)<li>Added targeted queries using <code>Single</code> with filter tuples<li>Replaced visibility-based hiding with display-based layout removal</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>toggle_display</span><span>(
</span><span>    </span><span style=color:#ff8f40>overlay_config</span><span style=color:#61676ccc>: </span><span>Res&LTFpsOverlayConfig>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Visibility, With&LTFpsText>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>graph_style</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Node, With&LTFrameTimeGraph>>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>for mut</span><span> visibility </span><span style=color:#ed9366>in &</span><span style=color:#fa6e32>mut</span><span> query {
</span><span>        visibility</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_if_neq</span><span>(</span><span style=color:#fa6e32>match</span><span> overlay_config</span><span style=color:#ed9366>.</span><span>enabled {
</span><span>            </span><span style=color:#ff8f40>true </span><span style=color:#ed9366>=> </span><span>Visibility</span><span style=color:#ed9366>::</span><span>Visible</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#ff8f40>false </span><span style=color:#ed9366>=> </span><span>Visibility</span><span style=color:#ed9366>::</span><span>Hidden</span><span style=color:#61676ccc>,
</span><span>        })</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... graph handling code
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>toggle_display</span><span>(
</span><span>    </span><span style=color:#ff8f40>overlay_config</span><span style=color:#61676ccc>: </span><span>Res&LTFpsOverlayConfig>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>text_node</span><span style=color:#61676ccc>: </span><span>Single<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Node, (With&LTFpsText>, Without&LTFrameTimeGraph>)>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>graph_node</span><span style=color:#61676ccc>: </span><span>Single<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Node, (With&LTFrameTimeGraph>, Without&LTFpsText>)>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>if</span><span> overlay_config</span><span style=color:#ed9366>.</span><span>enabled {
</span><span>        text_node</span><span style=color:#ed9366>.</span><span>display </span><span style=color:#ed9366>= </span><span>bevy_ui</span><span style=color:#ed9366>::</span><span>Display</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>DEFAULT</span><span style=color:#61676ccc>;
</span><span>    } </span><span style=color:#fa6e32>else </span><span>{
</span><span>        text_node</span><span style=color:#ed9366>.</span><span>display </span><span style=color:#ed9366>= </span><span>bevy_ui</span><span style=color:#ed9366>::</span><span>Display</span><span style=color:#ed9366>::</span><span>None</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... simplified graph handling code
</span><span>}
</span></code></pre><p>The changes ensure both text and graph nodes use consistent display management, completely removing them from layout when disabled rather than just hiding them visually.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/ui target=_blank>Bevy UI Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://developer.mozilla.org/en-US/docs/Web/CSS/display target=_blank>CSS Display vs Visibility (similar concepts)</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/ecs#queries target=_blank>Bevy ECS Query System</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21015.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>