<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21070 Add StateScoped as deprecated type alias
        
    </title><meta content="#21070 Add StateScoped as deprecated type alias" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-09/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-09-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-09/pr-21070-zh-cn-20250915>中文</a></div></div><div class=pr-content><h1 id=add-statescoped-as-deprecated-type-alias>Add StateScoped as deprecated type alias</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add StateScoped as deprecated type alias<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21070<li><strong>Author</strong>: alice-i-cecile<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Usability, S-Ready-For-Final-Review, A-States<li><strong>Created</strong>: 2025-09-15T22:42:17Z<li><strong>Merged</strong>: 2025-09-15T23:25:56Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Make migration easier.<li>Fixes #21035.</ul><h2 id=solution>Solution</h2><ul><li>Add a deprecated type alias to help with the rename, rather than immediately renaming.<li>Remember to re-export it in the prelude too to reduce compiler errors.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important migration problem in the Bevy engine’s state system. The core issue was that the <code>StateScoped</code> type was being renamed to <code>DespawnOnExit</code>, which would break existing codebases that hadn’t yet migrated to the new naming convention.<p>The problem emerged from issue #21035, where users needed a smoother transition path when updating their code. Instead of forcing an immediate breaking change, the solution implements a standard deprecation pattern: creating a type alias that maintains backward compatibility while encouraging migration to the new naming.<p>The implementation follows established patterns for deprecating types in Rust. The key insight was that simply adding a deprecated type alias would allow existing code to continue working while providing clear migration guidance through compiler warnings. This approach balances the need for API evolution with developer experience, ensuring that users aren’t faced with sudden breaking changes.<p>The technical implementation involved two coordinated changes. First, a type alias was added to the <code>state_scoped</code> module that maps <code>StateScoped</code> to <code>DespawnOnExit</code> with appropriate deprecation attributes. Second, this deprecated alias was re-exported in the prelude module to maintain visibility and reduce compiler errors during the transition period.<p>The use of the <code>#[expect(deprecated)]</code> attribute in the prelude re-export is particularly noteworthy. This suppresses warnings for the intentional deprecation within Bevy’s own codebase while still allowing user code to see the deprecation warnings. This demonstrates careful consideration of both internal and external developer experience.<p>This change follows semantic versioning practices by marking the deprecation with the version number (0.17.0) when the change will take effect, giving users clear timing for when they need to complete their migration.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[StateScoped type alias] --> B[DespawnOnExit actual type]
</span><span>    C[lib.rs prelude] --> D[Re-exports StateScoped]
</span><span>    D --> A
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-state-src-state-scoped-rs-4-0><code>crates/bevy_state/src/state_scoped.rs</code> (+4/-0)</h3><p>Added a deprecated type alias to maintain backward compatibility during the rename from <code>StateScoped</code> to <code>DespawnOnExit</code>.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// A deprecated alias for [`DespawnOnExit`].
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>deprecated</span><span>(since </span><span style=color:#ed9366>= </span><span style=color:#86b300>"0.17.0"</span><span style=color:#61676ccc>,</span><span> note </span><span style=color:#ed9366>= </span><span style=color:#86b300>"use DespawnOnExit instead"</span><span>)]
</span><span style=color:#fa6e32>pub type </span><span style=color:#399ee6>StateScoped</span><span style=color:#ed9366><</span><span>S</span><span style=color:#ed9366>> = </span><span>DespawnOnExit&LTS></span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-state-src-lib-rs-7-0><code>crates/bevy_state/src/lib.rs</code> (+7/-0)</h3><p>Re-exported the deprecated type alias in the prelude module to maintain visibility and reduce compiler errors during migration.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>expect</span><span>(
</span><span>    deprecated</span><span style=color:#61676ccc>,
</span><span>    reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"Temporarily re-exporting deprecated type for transition"
</span><span>)]
</span><span style=color:#fa6e32>pub use crate</span><span style=color:#ed9366>::</span><span>state_scoped</span><span style=color:#ed9366>::</span><span>StateScoped</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li>Rust Deprecation Attributes: https://doc.rust-lang.org/reference/attributes/diagnostics.html#the-deprecated-attribute<li>Semantic Versioning: https://semver.org/<li>Bevy States Documentation: https://bevyengine.org/learn/books/introduction/states</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-09/pr_21070.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>