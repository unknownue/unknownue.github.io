<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19191 Record render diagnostics for all engine passes
        
    </title><meta content="#19191 Record render diagnostics for all engine passes" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-06</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-19191-zh-cn-20250806>中文</a></div></div><div class=pr-content><h2 id=record-render-diagnostics-for-all-engine-passes>Record render diagnostics for all engine passes</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Record render diagnostics for all engine passes<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19191<li><strong>Author</strong>: jf908<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Rendering, S-Ready-For-Final-Review, D-Modest<li><strong>Created</strong>: 2025-05-12T19:10:48Z<li><strong>Merged</strong>: 2025-08-06T16:29:47Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><h1 id=objective>Objective</h1><ul><li>Fixes #16742</ul><h2 id=solution>Solution</h2><ul><li>Adds GPU spans for all the engine’s render and compute passes. Related passes have been grouped into a single span (following the same convention as bloom, which was already implemented).</ul><h2 id=testing>Testing</h2><ul><li>Tested all the various rendering features on Windows 11 + Vulkan and also some on DirectX.</ul><h2 id=showcase>Showcase</h2><p>A tracy graph with lots of rendering features enabled:<p><img alt=tracy-profiler_K9YpjdqJL5 src=https://github.com/user-attachments/assets/62ac41cf-394e-4cc1-b448-4cab26340501><h2 id=follow-up>Follow up</h2><ul><li>Nesting spans - there are 2 problems I encountered that stopped me from implementing this <ol><li>Spans have to be declared in the same scope so it’s not clear how to group passes across nodes in the render graph. Possibly a skill issue on my part :)<li>Nested spans appear incorrectly in tracy (all on the same y axis). I don’t know if this is a bug in tracy, a bug in the tracy_client crate or something to do with the multithreading workaround <code>end_zone()</code> hack but I couldn’t really get it to work. I left a nested span in meshlet_visibility_buffer_raster for each shadow view so you can see what it looks like by trying the meshlet example (let me know if I should remove it).</ol><li>Improve developer usability - after writing the same code over and over I started to feel like bevy should have its own create render/compute pass functions so it can instrument them automatically. It would also make it less likely for future PRs to forget to add diagnostics.</ul><h2 id=additional-notes>Additional notes</h2><p>There were talks on render crate refactors happening - I think the changes are small enough that rebases won’t be difficult but also feel free to delay merging until later if it’ll get in the way.<h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><h4 id=the-problem-and-context>The Problem and Context</h4><p>Prior to this PR, Bevy lacked comprehensive GPU profiling instrumentation across its rendering passes. Issue #16742 specifically highlighted the need for better diagnostics to analyze GPU performance. Without detailed timing information for each render and compute pass, performance optimization was challenging. Developers couldn’t easily identify bottlenecks in complex rendering pipelines using tools like Tracy. The technical constraint was that instrumentation needed to be added to every pass without significantly impacting performance or code readability.<h4 id=the-solution-approach>The Solution Approach</h4><p>The solution involved systematically adding GPU timing spans to all render and compute passes throughout Bevy’s rendering systems. The author followed these principles:<ol><li>Use Bevy’s existing <code>RecordDiagnostics</code> trait to instrument passes<li>Group related passes under single spans where appropriate (following bloom pass convention)<li>Maintain consistent labeling for easier trace analysis<li>Handle both render passes (via <code>pass_span</code>) and compute passes (via <code>time_span</code>)<li>Add debug groups for multi-pass operations</ol><p>The implementation required modifications across 28 files in the codebase. The author considered nested spans for hierarchical grouping but encountered technical limitations with Tracy visualization and render graph node scoping.<h4 id=the-implementation>The Implementation</h4><p>The changes followed a consistent pattern across all rendering systems:<ol><li>Retrieve <code>diagnostic_recorder</code> from render context<li>Create a timing span before pass execution<li>End the span after pass completion<li>Update pass labels for consistency</ol><p>For example, in the FXAA pass (<code>crates/bevy_anti_aliasing/src/fxaa/node.rs</code>):<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let mut</span><span> render_pass </span><span style=color:#ed9366>=</span><span> render_context
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_render_pass</span><span>(</span><span style=color:#ed9366>&</span><span>pass_descriptor)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> diagnostics </span><span style=color:#ed9366>=</span><span> render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>diagnostic_recorder</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ...
</span><span style=color:#fa6e32>let mut</span><span> render_pass </span><span style=color:#ed9366>=</span><span> render_context
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_render_pass</span><span>(</span><span style=color:#ed9366>&</span><span>pass_descriptor)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>pass_span</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> render_pass</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"fxaa"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// ... pass execution ...
</span><span>
</span><span>pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> render_pass)</span><span style=color:#61676ccc>;
</span></code></pre><p>Compute passes received similar treatment, as seen in the auto exposure pass (<code>crates/bevy_core_pipeline/src/auto_exposure/node.rs</code>):<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let mut</span><span> compute_pass </span><span style=color:#ed9366>=</span><span> render_context
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_compute_pass</span><span>(</span><span style=color:#ed9366>&</span><span>ComputePassDescriptor { </span><span style=color:#ed9366>... </span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> diagnostics </span><span style=color:#ed9366>=</span><span> render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>diagnostic_recorder</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> compute_pass </span><span style=color:#ed9366>= ...</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> compute_pass</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"auto_exposure"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// ... compute operations ...
</span><span>
</span><span>pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> compute_pass)</span><span style=color:#61676ccc>;
</span></code></pre><h4 id=technical-insights>Technical Insights</h4><p>The implementation revealed several important insights:<ol><li><strong>Span Management</strong>: The <code>RecordDiagnostics</code> API requires explicit span management around pass execution. The pattern <code>let span = diagnostics...</code> followed by <code>span.end()</code> ensures proper scope.<li><strong>Label Consistency</strong>: Pass labels were standardized to lowercase snake_case for uniformity in traces.<li><strong>Debug Groups</strong>: For complex multi-pass operations (like SSAO), debug groups provide additional context in profiling tools:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_debug_group</span><span>(</span><span style=color:#86b300>"smaa"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> time_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"smaa"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... passes ...
</span><span>time_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>())</span><span style=color:#61676ccc>;
</span><span>render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>pop_debug_group</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><ol start=4><li><strong>Nesting Challenges</strong>: Attempts to nest spans faced technical hurdles: <ul><li>Spans require declaration in the same lexical scope<li>Tracy visualization issues with nested spans<li>The meshlet visibility buffer pass demonstrates experimental nesting:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In meshlet_visibility_buffer_raster_node.rs
</span><span style=color:#fa6e32>for</span><span> shadow_view </span><span style=color:#ed9366>in</span><span> shadow_views {
</span><span>    </span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(
</span><span>        render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#61676ccc>,
</span><span>        shadow_view</span><span style=color:#ed9366>.</span><span>pass_name</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... sub-pass operations ...
</span><span>    pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>())</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h4 id=the-impact>The Impact</h4><p>These changes provide comprehensive GPU profiling capabilities throughout Bevy’s rendering pipeline:<ul><li>All major passes now appear in Tracy with consistent labeling<li>Developers can identify performance bottlenecks at the pass level<li>The changes add minimal overhead (only span recording operations)<li>Pass execution times can be compared across different hardware and configurations<li>Future optimization work will have built-in measurement capabilities</ul><p>The implementation demonstrates that systematic instrumentation can be added across a complex rendering architecture with minimal disruption. The consistent pattern makes it easier to maintain and extend instrumentation in future development.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Render/Compute Pass] --> B[Get Diagnostic Recorder]
</span><span>    B --> C[Start Timing Span]
</span><span>    C --> D[Execute Pass]
</span><span>    D --> E[End Timing Span]
</span><span>    E --> F[Tracy Visualization]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><ol><li><strong><code>crates/bevy_pbr/src/render/gpu_preprocess.rs</code> (+29/-13)</strong> <ul><li>Added instrumentation to GPU preprocessing compute passes<li>Key changes:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: 
</span><span style=color:#fa6e32>let mut</span><span> compute_pass </span><span style=color:#ed9366>=</span><span> command_encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_compute_pass</span><span>(</span><span style=color:#ed9366>&</span><span>ComputePassDescriptor {
</span><span>    label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#86b300>"early mesh preprocessing"</span><span>)</span><span style=color:#61676ccc>,
</span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> diagnostics </span><span style=color:#ed9366>=</span><span> render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>diagnostic_recorder</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> compute_pass </span><span style=color:#ed9366>=</span><span> command_encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_compute_pass</span><span>(</span><span style=color:#ed9366>&</span><span>ComputePassDescriptor {
</span><span>    label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#86b300>"early_mesh_preprocessing"</span><span>)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Updated label
</span><span>})</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> compute_pass</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"early_mesh_preprocessing"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... pass execution ...
</span><span>pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> compute_pass)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><strong><code>crates/bevy_pbr/src/ssao/mod.rs</code> (+20/-21)</strong> <ul><li>Instrumented SSAO passes and added debug groups<li>Key changes:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added debug group and top-level span
</span><span style=color:#fa6e32>let</span><span> command_encoder </span><span style=color:#ed9366>=</span><span> render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#61676ccc>;
</span><span>command_encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_debug_group</span><span>(</span><span style=color:#86b300>"ssao"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> time_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(command_encoder</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"ssao"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Each sub-pass instrumented
</span><span style=color:#fa6e32>let mut</span><span> preprocess_depth_pass </span><span style=color:#ed9366>=</span><span> command_encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_compute_pass</span><span>(</span><span style=color:#ed9366>&</span><span>ComputePassDescriptor {
</span><span>    label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#86b300>"ssao_preprocess_depth"</span><span>)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Updated label
</span><span>})</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... pass execution ...
</span></code></pre><ol start=3><li><strong><code>crates/bevy_pbr/src/meshlet/material_shade_nodes.rs</code> (+20/-3)</strong> <ul><li>Added spans to meshlet material passes<li>Key changes:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let mut</span><span> render_pass </span><span style=color:#ed9366>=</span><span> render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_tracked_render_pass</span><span>(RenderPassDescriptor {
</span><span>    label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#86b300>"meshlet_prepass"</span><span>)</span><span style=color:#61676ccc>,
</span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> diagnostics </span><span style=color:#ed9366>=</span><span> render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>diagnostic_recorder</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> render_pass </span><span style=color:#ed9366>= ...</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>pass_span</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> render_pass</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"meshlet_material_prepass"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... pass execution ...
</span><span>pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> render_pass)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=4><li><strong><code>crates/bevy_pbr/src/atmosphere/node.rs</code> (+13/-2)</strong> <ul><li>Instrumented atmosphere LUT generation and sky rendering<li>Key changes:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Atmosphere LUTs
</span><span style=color:#fa6e32>let mut</span><span> luts_pass </span><span style=color:#ed9366>=</span><span> command_encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_compute_pass</span><span>(</span><span style=color:#ed9366>&</span><span>ComputePassDescriptor {
</span><span>    label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#86b300>"atmosphere_luts"</span><span>)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Updated label
</span><span>})</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> luts_pass</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"atmosphere_luts"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... pass execution ...
</span><span>pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> luts_pass)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Sky rendering
</span><span style=color:#fa6e32>let mut</span><span> render_sky_pass </span><span style=color:#ed9366>=</span><span> command_encoder</span><span style=color:#ed9366>.</span><span style=color:#f07171>begin_render_pass</span><span>(</span><span style=color:#ed9366>...</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>pass_span</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> render_sky_pass</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"render_sky"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... pass execution ...
</span><span>pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> render_sky_pass)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=5><li><strong><code>crates/bevy_pbr/src/meshlet/visibility_buffer_raster_node.rs</code> (+14/-0)</strong> <ul><li>Added experimental nested spans for shadow views<li>Key changes:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>push_debug_group</span><span>(</span><span style=color:#86b300>"meshlet_visibility_buffer_raster"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> time_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(
</span><span>    render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"meshlet_visibility_buffer_raster"</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>for</span><span> shadow_view </span><span style=color:#ed9366>in</span><span> shadow_views {
</span><span>    </span><span style=color:#fa6e32>let</span><span> pass_span </span><span style=color:#ed9366>=</span><span> diagnostics</span><span style=color:#ed9366>.</span><span style=color:#f07171>time_span</span><span>(
</span><span>        render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>()</span><span style=color:#61676ccc>,
</span><span>        shadow_view</span><span style=color:#ed9366>.</span><span>pass_name</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// Individual span per shadow view
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... sub-pass operations ...
</span><span>    pass_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>())</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span>time_span</span><span style=color:#ed9366>.</span><span style=color:#f07171>end</span><span>(render_context</span><span style=color:#ed9366>.</span><span style=color:#f07171>command_encoder</span><span>())</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/wolfpld/tracy target=_blank>Tracy Profiler documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/rendering/render-graph/ target=_blank>Bevy Render Graph documentation</a><li><a rel="noopener nofollow noreferrer" href=https://gpuopen.com/learn/gpu-profiling-command-buffer-instrumentation/ target=_blank>GPU Command Buffer Instrumentation Best Practices</a></ol><h3 id=full-code-diff>Full Code Diff</h3><details><summary>View full diff (28 files modified)</summary> <pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_anti_aliasing/src/contrast_adaptive_sharpening/node.rs b/crates/bevy_anti_aliasing/src/contrast_adaptive_sharpening/node.rs
</span><span>index 070b57099707e..c1e6ccdda02c3 100644
</span><span style=color:#c594c5>--- a/crates/bevy_anti_aliasing/src/contrast_adaptive_sharpening/node.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_anti_aliasing/src/contrast_adaptive_sharpening/node.rs
</span><span style=color:#c594c5>@@ -3,6 +3,7 @@ </span><span style=color:#399ee6>use std::sync::Mutex;
</span><span> use crate::contrast_adaptive_sharpening::ViewCasPipeline;
</span><span> use bevy_ecs::prelude::*;
</span><span> use bevy_render::{
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     extract_component::{ComponentUniforms, DynamicUniformIndex},
</span><span>     render_graph::{Node, NodeRunError, RenderGraphContext},
</span><span>     render_resource::{
</span><span style=color:#c594c5>@@ -66,6 +67,8 @@ </span><span style=color:#399ee6>impl Node for CasNode {
</span><span>             return Ok(());
</span><span>         };
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         let view_target = target.post_process_write();
</span><span>         let source = view_target.source;
</span><span>         let destination = view_target.destination;
</span><span style=color:#c594c5>@@ -110,11 +113,14 @@ </span><span style=color:#399ee6>impl Node for CasNode {
</span><span>         let mut render_pass = render_context
</span><span>             .command_encoder()
</span><span>             .begin_render_pass(&pass_descriptor);
</span><span style=color:#86b300>+        let pass_span = diagnostics.time_span(&mut render_pass, "contrast_adaptive_sharpening");
</span><span> 
</span><span>         render_pass.set_pipeline(pipeline);
</span><span>         render_pass.set_bind_group(0, bind_group, &[uniform_index.index()]);
</span><span>         render_pass.draw(0..3, 0..1);
</span><span> 
</span><span style=color:#86b300>+        pass_span.end(&mut render_pass);
</span><span style=color:#86b300>+
</span><span>         Ok(())
</span><span>     }
</span><span> }
</span><span>diff --git a/crates/bevy_anti_aliasing/src/fxaa/node.rs b/crates/bevy_anti_aliasing/src/fxaa/node.rs
</span><span>index 8881607cba4e4..54d2afd33e736 100644
</span><span style=color:#c594c5>--- a/crates/bevy_anti_aliasing/src/fxaa/node.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_anti_aliasing/src/fxaa/node.rs
</span><span style=color:#c594c5>@@ -3,6 +3,7 @@ </span><span style=color:#399ee6>use std::sync::Mutex;
</span><span> use crate::fxaa::{CameraFxaaPipeline, Fxaa, FxaaPipeline};
</span><span> use bevy_ecs::{prelude::*, query::QueryItem};
</span><span> use bevy_render::{
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     render_graph::{NodeRunError, RenderGraphContext, ViewNode},
</span><span>     render_resource::{
</span><span>         BindGroup, BindGroupEntries, Operations, PipelineCache, RenderPassColorAttachment,
</span><span style=color:#c594c5>@@ -42,6 +43,8 @@ </span><span style=color:#399ee6>impl ViewNode for FxaaNode {
</span><span>             return Ok(());
</span><span>         };
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         let post_process = target.post_process_write();
</span><span>         let source = post_process.source;
</span><span>         let destination = post_process.destination;
</span><span style=color:#c594c5>@@ -61,7 +64,7 @@ </span><span style=color:#399ee6>impl ViewNode for FxaaNode {
</span><span>         };
</span><span> 
</span><span>         let pass_descriptor = RenderPassDescriptor {
</span><span style=color:#f07171>-            label: Some("fxaa_pass"),
</span><span style=color:#86b300>+            label: Some("fxaa"),
</span><span>             color_attachments: &[Some(RenderPassColorAttachment {
</span><span>                 view: destination,
</span><span>                 depth_slice: None,
</span><span style=color:#c594c5>@@ -76,11 +79,14 @@ </span><span style=color:#399ee6>impl ViewNode for FxaaNode {
</span><span>         let mut render_pass = render_context
</span><span>             .command_encoder()
</span><span>             .begin_render_pass(&pass_descriptor);
</span><span style=color:#86b300>+        let pass_span = diagnostics.pass_span(&mut render_pass, "fxaa");
</span><span> 
</span><span>         render_pass.set_pipeline(pipeline);
</span><span>         render_pass.set_bind_group(0, bind_group, &[]);
</span><span>         render_pass.draw(0..3, 0..1);
</span><span> 
</span><span style=color:#86b300>+        pass_span.end(&mut render_pass);
</span><span style=color:#86b300>+
</span><span>         Ok(())
</span><span>     }
</span><span> }
</span><span>diff --git a/crates/bevy_anti_aliasing/src/smaa/mod.rs b/crates/bevy_anti_aliasing/src/smaa/mod.rs
</span><span>index cafab566a0732..d54dff8e9ce5d 100644
</span><span style=color:#c594c5>--- a/crates/bevy_anti_aliasing/src/smaa/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_anti_aliasing/src/smaa/mod.rs
</span><span style=color:#c594c5>@@ -53,6 +53,7 @@ </span><span style=color:#399ee6>use bevy_math::{vec4, Vec4};
</span><span> use bevy_reflect::{std_traits::ReflectDefault, Reflect};
</span><span> use bevy_render::{
</span><span>     camera::ExtractedCamera,
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     extract_component::{ExtractComponent, ExtractComponentPlugin},
</span><span>     render_asset::RenderAssets,
</span><span>     render_graph::{
</span><span style=color:#c594c5>@@ -824,6 +825,10 @@ </span><span style=color:#399ee6>impl ViewNode for SmaaNode {
</span><span>             return Ok(());
</span><span>         };
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+        render_context.command_encoder().push_debug_group("smaa");
</span><span style=color:#86b300>+        let time_span = diagnostics.time_span(render_context.command_encoder(), "smaa");
</span><span style=color:#86b300>+
</span><span>         // Fetch the framebuffer textures.
</span><span>         let postprocess = view_target.post_process_write();
</span><span>         let (source, destination) = (postprocess.source, postprocess.destination);
</span><span style=color:#c594c5>@@ -864,6 +869,9 @@ </span><span style=color:#399ee6>impl ViewNode for SmaaNode {
</span><span>             destination,
</span><span>         );
</span><span> 
</span><span style=color:#86b300>+        time_span.end(render_context.command_encoder());
</span><span style=color:#86b300>+        render_context.command_encoder().pop_debug_group();
</span><span style=color:#86b300>+
</span><span>         Ok(())
</span><span>     }
</span><span> }
</span><span>diff --git a/crates/bevy_anti_aliasing/src/taa/mod.rs b/crates/bevy_anti_aliasing/src/taa/mod.rs
</span><span>index 658e31aa586f6..263ebd00436ff 100644
</span><span style=color:#c594c5>--- a/crates/bevy_anti_aliasing/src/taa/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_anti_aliasing/src/taa/mod.rs
</span><span style=color:#c594c5>@@ -20,6 +20,7 @@ </span><span style=color:#399ee6>use bevy_math::vec2;
</span><span> use bevy_reflect::{std_traits::ReflectDefault, Reflect};
</span><span> use bevy_render::{
</span><span>     camera::{ExtractedCamera, MipBias, TemporalJitter},
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     prelude::{Camera, Projection},
</span><span>     render_graph::{NodeRunError, RenderGraphContext, RenderGraphExt, ViewNode, ViewNodeRunner},
</span><span>     render_resource::{
</span><span style=color:#c594c5>@@ -181,6 +182,9 @@ </span><span style=color:#399ee6>impl ViewNode for TemporalAntiAliasNode {
</span><span>         ) else {
</span><span>             return Ok(());
</span><span>         };
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         let view_target = view_target.post_process_write();
</span><span> 
</span><span>         let taa_bind_group = render_context.render_device().create_bind_group(
</span><span style=color:#c594c5>@@ -198,7 +202,7 @@ </span><span style=color:#399ee6>impl ViewNode for TemporalAntiAliasNode {
</span><span> 
</span><span>         {
</span><span>             let mut taa_pass = render_context.begin_tracked_render_pass(RenderPassDescriptor {
</span><span style=color:#f07171>-                label: Some("taa_pass"),
</span><span style=color:#86b300>+                label: Some("taa"),
</span><span>                 color_attachments: &[
</span><span>                     Some(RenderPassColorAttachment {
</span><span>                         view: view_target.destination,
</span><span style=color:#c594c5>@@ -217,12 +221,16 @@ </span><span style=color:#399ee6>impl ViewNode for TemporalAntiAliasNode {
</span><span>                 timestamp_writes: None,
</span><span>                 occlusion_query_set: None,
</span><span>             });
</span><span style=color:#86b300>+            let pass_span = diagnostics.pass_span(&mut taa_pass, "taa");
</span><span style=color:#86b300>+
</span><span>             taa_pass.set_render_pipeline(taa_pipeline);
</span><span>             taa_pass.set_bind_group(0, &taa_bind_group, &[]);
</span><span>             if let Some(viewport) = camera.viewport.as_ref() {
</span><span>                 taa_pass.set_camera_viewport(viewport);
</span><span>             }
</span><span>             taa_pass.draw(0..3, 0..1);
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+            pass_span.end(&mut taa_pass);
</span><span>         }
</span><span> 
</span><span>         Ok(())
</span><span>diff --git a/crates/bevy_core_pipeline/src/auto_exposure/node.rs b/crates/bevy_core_pipeline/src/auto_exposure/node.rs
</span><span>index 222efe5c62bd0..c7f88dfb28d6f 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/auto_exposure/node.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/auto_exposure/node.rs
</span><span style=color:#c594c5>@@ -10,6 +10,7 @@ </span><span style=color:#399ee6>use bevy_ecs::{
</span><span>     world::{FromWorld, World},
</span><span> };
</span><span> use bevy_render::{
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     globals::GlobalsBuffer,
</span><span>     render_asset::RenderAssets,
</span><span>     render_graph::*,
</span><span style=color:#c594c5>@@ -98,6 +99,8 @@ </span><span style=color:#399ee6>impl Node for AutoExposureNode {
</span><span>             return Ok(());
</span><span>         };
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         let compute_bind_group = render_context.render_device().create_bind_group(
</span><span>             None,
</span><span>             &pipeline.histogram_layout,
</span><span style=color:#c594c5>@@ -122,9 +125,10 @@ </span><span style=color:#399ee6>impl Node for AutoExposureNode {
</span><span>             render_context
</span><span>                 .command_encoder()
</span><span>                 .begin_compute_pass(&ComputePassDescriptor {
</span><span style=color:#f07171>-                    label: Some("auto_exposure_pass"),
</span><span style=color:#86b300>+                    label: Some("auto_exposure"),
</span><span>                     timestamp_writes: None,
</span><span>                 });
</span><span style=color:#86b300>+        let pass_span = diagnostics.time_span(&mut compute_pass, "auto_exposure");
</span><span> 
</span><span>         compute_pass.set_bind_group(0, &compute_bind_group, &[view_uniform_offset.offset]);
</span><span>         compute_pass.set_pipeline(histogram_pipeline);
</span><span style=color:#c594c5>@@ -136,6 +140,8 @@ </span><span style=color:#399ee6>impl Node for AutoExposureNode {
</span><span>         compute_pass.set_pipeline(average_pipeline);
</span><span>         compute_pass.dispatch_workgroups(1, 1, 1);
</span><span> 
</span><span style=color:#86b300>+        pass_span.end(&mut compute_pass);
</span><span style=color:#86b300>+
</span><span>         Ok(())
</span><span>     }
</span><span> }
</span><span>diff --git a/crates/bevy_core_pipeline/src/core_3d/main_transmissive_pass_3d_node.rs b/crates/bevy_core_pipeline/src/core_3d/main_transmissive_pass_3d_node.rs
</span><span>index ec108b8753924..37d359785bfd6 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/core_3d/main_transmissive_pass_3d_node.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/core_3d/main_transmissive_pass_3d_node.rs
</span><span style=color:#c594c5>@@ -5,6 +5,7 @@ </span><span style=color:#399ee6>use bevy_ecs::{prelude::*, query::QueryItem};
</span><span> use bevy_image::ToExtents;
</span><span> use bevy_render::{
</span><span>     camera::{ExtractedCamera, MainPassResolutionOverride},
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     render_graph::{NodeRunError, RenderGraphContext, ViewNode},
</span><span>     render_phase::ViewSortedRenderPhases,
</span><span>     render_resource::{RenderPassDescriptor, StoreOp},
</span><span style=color:#c594c5>@@ -53,6 +54,8 @@ </span><span style=color:#399ee6>impl ViewNode for MainTransmissivePass3dNode {
</span><span>             return Ok(());
</span><span>         };
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         let physical_target_size = camera.physical_target_size.unwrap();
</span><span> 
</span><span>         let render_pass_descriptor = RenderPassDescriptor {
</span><span style=color:#c594c5>@@ -95,6 +98,8 @@ </span><span style=color:#399ee6>impl ViewNode for MainTransmissivePass3dNode {
</span><span> 
</span><span>                     let mut render_pass =
</span><span>                         render_context.begin_tracked_render_pass(render_pass_descriptor.clone());
</span><span style=color:#86b300>+                    let pass_span =
</span><span style=color:#86b300>+                        diagnostics.pass_span(&mut render_pass, "main_transmissive_pass_3d");
</span><span> 
</span><span>                     if let Some(viewport) = camera.viewport.as_ref() {
</span><span>                         render_pass.set_camera_viewport(viewport);
</span><span style=color:#c594c5>@@ -106,10 +111,14 @@ </span><span style=color:#399ee6>impl ViewNode for MainTransmissivePass3dNode {
</span><span>                     {
</span><span>                         error!("Error encountered while rendering the transmissive phase {err:?}");
</span><span>                     }
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+                    pass_span.end(&mut render_pass);
</span><span>                 }
</span><span>             } else {
</span><span>                 let mut render_pass =
</span><span>                     render_context.begin_tracked_render_pass(render_pass_descriptor);
</span><span style=color:#86b300>+                let pass_span =
</span><span style=color:#86b300>+                    diagnostics.pass_span(&mut render_pass, "main_transmissive_pass_3d");
</span><span> 
</span><span>                 if let Some(viewport) = Viewport::from_viewport_and_override(
</span><span>                     camera.viewport.as_ref(),
</span><span style=color:#c594c5>@@ -121,6 +130,8 @@ </span><span style=color:#399ee6>impl ViewNode for MainTransmissivePass3dNode {
</span><span>                 if let Err(err) = transmissive_phase.render(&mut render_pass, world, view_entity) {
</span><span>                     error!("Error encountered while rendering the transmissive phase {err:?}");
</span><span>                 }
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+                pass_span.end(&mut render_pass);
</span><span>             }
</span><span>         }
</span><span> 
</span><span>diff --git a/crates/bevy_core_pipeline/src/deferred/copy_lighting_id.rs b/crates/bevy_core_pipeline/src/deferred/copy_lighting_id.rs
</span><span>index 9a23c0e34d752..68d1634160f8a 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/deferred/copy_lighting_id.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/deferred/copy_lighting_id.rs
</span><span style=color:#c594c5>@@ -8,6 +8,7 @@ </span><span style=color:#399ee6>use bevy_ecs::prelude::*;
</span><span> use bevy_image::ToExtents;
</span><span> use bevy_render::{
</span><span>     camera::ExtractedCamera,
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     render_resource::{binding_types::texture_2d, *},
</span><span>     renderer::RenderDevice,
</span><span>     texture::{CachedTexture, TextureCache},
</span><span style=color:#c594c5>@@ -77,6 +78,8 @@ </span><span style=color:#399ee6>impl ViewNode for CopyDeferredLightingIdNode {
</span><span>             return Ok(());
</span><span>         };
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         let bind_group = render_context.render_device().create_bind_group(
</span><span>             "copy_deferred_lighting_id_bind_group",
</span><span>             &ampcopy_deferred_lighting_id_pipeline.layout,
</span><span style=color:#c594c5>@@ -84,7 +87,7 @@ </span><span style=color:#399ee6>impl ViewNode for CopyDeferredLightingIdNode {
</span><span>         );
</span><span> 
</span><span>         let mut render_pass = render_context.begin_tracked_render_pass(RenderPassDescriptor {
</span><span style=color:#f07171>-            label: Some("copy_deferred_lighting_id_pass"),
</span><span style=color:#86b300>+            label: Some("copy_deferred_lighting_id"),
</span><span>             color_attachments: &[],
</span><span>             depth_stencil_attachment: Some(RenderPassDepthStencilAttachment {
</span><span>                 view: &deferred_lighting_id_depth_texture.texture.default_view,
</span><span style=color:#c594c5>@@ -98,10 +101,14 @@ </span><span style=color:#399ee6>impl ViewNode for CopyDeferredLightingIdNode {
</span><span>             occlusion_query_set: None,
</span><span>         });
</span><span> 
</span><span style=color:#86b300>+        let pass_span = diagnostics.pass_span(&mut render_pass, "copy_deferred_lighting_id");
</span><span style=color:#86b300>+
</span><span>         render_pass.set_render_pipeline(pipeline);
</span><span>         render_pass.set_bind_group(0, &bind_group, &[]);
</span><span>         render_pass.draw(0..3, 0..1);
</span><span> 
</span><span style=color:#86b300>+        pass_span.end(&mut render_pass);
</span><span style=color:#86b300>+
</span><span>         Ok(())
</span><span>     }
</span><span> }
</span><span>diff --git a/crates/bevy_core_pipeline/src/deferred/node.rs b/crates/bevy_core_pipeline/src/deferred/node.rs
</span><span>index ffd51763ca88b..db983c9043567 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/deferred/node.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/deferred/node.rs
</span><span style=color:#c594c5>@@ -7,6 +7,7 @@ </span><span style=color:#399ee6>use bevy_render::render_graph::ViewNode;
</span><span> use bevy_render::view::{ExtractedView, NoIndirectDrawing};
</span><span> use bevy_render::{
</span><span>     camera::ExtractedCamera,
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     render_graph::{NodeRunError, RenderGraphContext},
</span><span>     render_phase::{TrackedRenderPass, ViewBinnedRenderPhases},
</span><span>     render_resource::{CommandEncoderDescriptor, RenderPassDescriptor, StoreOp},
</span><span style=color:#c594c5>@@ -131,6 +132,8 @@ </span><span style=color:#399ee6>fn run_deferred_prepass<'w>(
</span><span>         return Ok(());
</span><span>     };
</span><span> 
</span><span style=color:#86b300>+    let diagnostic = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>     let mut color_attachments = vec![];
</span><span>     color_attachments.push(
</span><span>         view_prepass_textures
</span><span style=color:#c594c5>@@ -223,6 +226,7 @@ </span><span style=color:#399ee6>fn run_deferred_prepass<'w>(
</span><span>             occlusion_query_set: None,
</span><span>         });
</span><span>         let mut render_pass = TrackedRenderPass::new(&render_device, render_pass);
</span><span style=color:#86b300>+        let pass_span = diagnostic.pass_span(&mut render_pass, label);
</span><span>         if let Some(viewport) =
</span><span>             Viewport::from_viewport_and_override(camera.viewport.as_ref(), resolution_override)
</span><span>         {
</span><span style=color:#c594c5>@@ -251,6 +255,7 @@ </span><span style=color:#399ee6>fn run_deferred_prepass<'w>(
</span><span>             }
</span><span>         }
</span><span> 
</span><span style=color:#86b300>+        pass_span.end(&mut render_pass);
</span><span>         drop(render_pass);
</span><span> 
</span><span>         // After rendering to the view depth texture, copy it to the prepass depth texture
</span><span>diff --git a/crates/bevy_core_pipeline/src/dof/mod.rs b/crates/bevy_core_pipeline/src/dof/mod.rs
</span><span>index 0e65c4d0a4dfa..51ec0b97af61d 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/dof/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/dof/mod.rs
</span><span style=color:#c594c5>@@ -32,6 +32,7 @@ </span><span style=color:#399ee6>use bevy_math::ops;
</span><span> use bevy_reflect::{prelude::ReflectDefault, Reflect};
</span><span> use bevy_render::{
</span><span>     camera::{PhysicalCameraParameters, Projection},
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     extract_component::{ComponentUniforms, DynamicUniformIndex, UniformComponentPlugin},
</span><span>     render_graph::{
</span><span>         NodeRunError, RenderGraphContext, RenderGraphExt as _, ViewNode, ViewNodeRunner,
</span><span style=color:#c594c5>@@ -354,6 +355,8 @@ </span><span style=color:#399ee6>impl ViewNode for DepthOfFieldNode {
</span><span>         let view_uniforms = world.resource::&LTViewUniforms>();
</span><span>         let global_bind_group = world.resource::&LTDepthOfFieldGlobalBindGroup>();
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         // We can be in either Gaussian blur or bokeh mode here. Both modes are
</span><span>         // similar, consisting of two passes each. We factor out the information
</span><span>         // specific to each pass into
</span><span style=color:#c594c5>@@ -448,6 +451,9 @@ </span><span style=color:#399ee6>impl ViewNode for DepthOfFieldNode {
</span><span>             let mut render_pass = render_context
</span><span>                 .command_encoder()
</span><span>                 .begin_render_pass(&render_pass_descriptor);
</span><span style=color:#86b300>+            let pass_span =
</span><span style=color:#86b300>+                diagnostics.pass_span(&mut render_pass, pipeline_render_info.pass_label);
</span><span style=color:#86b300>+
</span><span>             render_pass.set_pipeline(render_pipeline);
</span><span>             // Set the per-view bind group.
</span><span>             render_pass.set_bind_group(0, &view_bind_group, &[view_uniform_offset.offset]);
</span><span style=color:#c594c5>@@ -459,6 +465,8 @@ </span><span style=color:#399ee6>impl ViewNode for DepthOfFieldNode {
</span><span>             );
</span><span>             // Render the full-screen pass.
</span><span>             render_pass.draw(0..3, 0..1);
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+            pass_span.end(&mut render_pass);
</span><span>         }
</span><span> 
</span><span>         Ok(())
</span><span>diff --git a/crates/bevy_core_pipeline/src/motion_blur/node.rs b/crates/bevy_core_pipeline/src/motion_blur/node.rs
</span><span>index 5fb8eeebcdc02..00e4d4df873d5 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/motion_blur/node.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/motion_blur/node.rs
</span><span style=color:#c594c5>@@ -1,5 +1,6 @@
</span><span> use bevy_ecs::{query::QueryItem, world::World};
</span><span> use bevy_render::{
</span><span style=color:#86b300>+    diagnostic::RecordDiagnostics,
</span><span>     extract_component::ComponentUniforms,
</span><span>     globals::GlobalsBuffer,
</span><span>     render_graph::{NodeRunError, RenderGraphContext, ViewNode},
</span><span style=color:#c594c5>@@ -59,6 +60,8 @@ </span><span style=color:#399ee6>impl ViewNode for MotionBlurNode {
</span><span>             return Ok(());
</span><span>         };
</span><span> 
</span><span style=color:#86b300>+        let diagnostics = render_context.diagnostic_recorder();
</span><span style=color:#86b300>+
</span><span>         let post_process = view_target.post_process_write();
</span><span> 
</span><span>         let layout = if msaa.samples() == 1 {
</span><span style=color:#c594c5>@@ -81,7 +84,7 @@ </span><span style=color:#399ee6>impl ViewNode for MotionBlurNode {
</span><span>         );
</span><span> 
</span><span>         let mut render_pass = render_context.begin_tracked_render_pass(RenderPassDescriptor {
</span><span style=color:#f07171>-            label: Some("motion_blur_pass"),
</span><span style=color:#86b300>+            label: Some("motion_blur"),
</span><span>             color_attachments: &[Some(RenderPassColorAttachment {
</span><span>                 view: post_process.destination,
</span><span>                 depth_slice: None,
</span><span style=color:#c594c5>@@ -92,11 +95,14 @@ </span><span style=color:#399ee6>impl ViewNode for MotionBlurNode {
</span><span>             timestamp_writes: None,
</span><span>             occlusion_query_set: None,
</span><span>         });
</span><span style=color:#86b300>+        let pass_span = diagnostics.pass_span(&mut render_pass, "motion_blur");
</span><span> 
</span><span>         render_pass.set_render_pipeline(pipeline);
</span><span>         render_pass.set_bind_group(0, &bind_group, &[]);
</span><span>         render_pass.draw(0..3, 0..1);
</span><span> 
</span><span style=color:#86b300>+        pass_span.end(&mut render_pass);
</span><span style=color:#86b300>+
</span><span>         Ok(())
</span><span>     }
</span><span> }
</span><span>diff --git a/crates/bevy_core_pipeline/src/msaa_writeback.rs b/crates/bevy_core_pipeline/src/msaa_writeback.rs
</span><span>index 4b63de7dad131..f1a833047fbb1 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/msaa_writeback.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/msaa_writeback.rs
</span><span style=color:#c594c5>@@ -8,6 +8,7 @@ </span><span style=color:#399ee6>use bevy</span></code></pre>    <div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_19191.patch id=patch-info style=display:none></div>  <div class=bottom-spacer></div>