<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20565 Opt-in raw vulkan initialization with hooks
        
    </title><meta content="#20565 Opt-in raw vulkan initialization with hooks" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20565-zh-cn-20250815>中文</a></div></div><div class=pr-content><h2 id=opt-in-raw-vulkan-initialization-with-hooks>Opt-in raw vulkan initialization with hooks</h2><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Opt-in raw vulkan initialization with hooks<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20565<li><strong>Author</strong>: cart<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Rendering, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-08-13T23:48:14Z<li><strong>Merged</strong>: 2025-08-15T03:17:22Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Currently registering additional required Vulkan features requires either hard-coding them into <code>bevy_render</code> (see the current <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/19864 target=_blank>DLSS proposal</a>), or forcing the plugin to take full manual control over wgpu initialization. Neither is an acceptable or scalable option for a modular engine like Bevy.<h2 id=solution>Solution</h2><ul><li>Add a new <code>raw_vulkan_init</code> Cargo feature, that when enabled switches to wgpu’s raw Vulkan init path, which accepts callbacks that allow checking and requiring additional Vulkan features.<li>Add a new <code>WgpuRawVulkanInitSettings</code> resource, which provides wgpu Vulkan Instance and Device init callbacks, which can be used to detect and register vulkan features.<li>These callbacks can register arbitrary features in the new <code>AdditionalVulkanFeatures</code> resource, which is inserted into the RenderApp at the same time that the RenderDevice is.</ul><p>This enables plugins to register initialization callbacks, which must happen <em>before</em> RenderPlugin. They can then feed off of <code>AdditionalVulkanFeatures</code>, after the renderer is initialized, to detect if a given feature is supported.<p>Due to the current lifecycles, this is best accomplished with either:<ul><li>A separate “init plugin” that is registered before RenderPlugin, and a “logic plugin” that does everything else. This should be used if the plugin logic needs <code>Plugin::build()</code> access to render device state, which needs to be registered <em>after</em> RenderPlugin to have access. The proposed DLSS feature needs this pattern.<li>A single “init plugin” that is registered before RenderPlugin and does everything. Use this pattern if you can as it is simpler.</ul><p>With deferred plugin init, we could remove the need for this split.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Bevy’s rendering system uses wgpu for cross-platform graphics, but there was no clean way for plugins to extend Vulkan-specific initialization. Previously, adding Vulkan features like those required for DLSS required either hardcoding them into <code>bevy_render</code> (making engine modifications) or having plugins take complete control over wgpu initialization (breaking modularity). Both approaches were unsustainable for a plugin-based architecture.<p>The core limitation was that wgpu’s standard initialization path didn’t expose hooks for modifying Vulkan instance or device creation. Plugins needing Vulkan extensions had no way to safely inject their requirements during Bevy’s standard renderer setup.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution introduces an opt-in mechanism to use wgpu’s raw Vulkan initialization path with custom hooks. Key decisions:<ol><li><strong>Feature-flagged Implementation</strong>: Added a <code>raw_vulkan_init</code> cargo feature that switches to wgpu’s Vulkan HAL backend<li><strong>Callback Resource</strong>: Created <code>RawVulkanInitSettings</code> to collect instance/device creation callbacks<li><strong>Feature Registry</strong>: Added <code>AdditionalVulkanFeatures</code> resource to track custom feature support<li><strong>Lifecycle Handling</strong>: Ensured callbacks execute before renderer initialization but their results are available after</ol><p>The implementation uses wgpu’s <code>wgpu::hal::vulkan</code> module which provides lower-level control over Vulkan initialization. Callbacks are passed through to wgpu’s unsafe initialization functions with proper safety documentation.<h3 id=the-implementation>The Implementation</h3><p>The core changes refactor renderer initialization to conditionally use raw Vulkan paths when the feature is enabled. The new <code>raw_vulkan_init.rs</code> module contains:<ol><li><strong>Callback Structures</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RawVulkanInitSettings </span><span>{
</span><span>    create_instance_callbacks</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#f51818>.</span><span>..>,
</span><span>    create_device_callbacks</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#f51818>.</span><span>..>,
</span><span>}
</span></code></pre><p>These hold callback functions that will modify Vulkan creation parameters.<ol start=2><li><strong>Unsafe Callback Registration</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span style=color:#399ee6>RawVulkanInitSettings </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>add_create_instance_callback</span><span>(...) { </span><span style=color:#ed9366>... </span><span>}
</span><span>    </span><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>add_create_device_callback</span><span>(...) { </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span></code></pre><p>Callbacks are unsafe because they must not remove features or exceed hardware capabilities.<ol start=3><li><strong>Feature Tracking</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>AdditionalVulkanFeatures</span><span>(HashSet&LTTypeId>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>AdditionalVulkanFeatures </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>register</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Any>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) { </span><span style=color:#ed9366>... </span><span>}
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>has</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Any>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span></code></pre><p>This allows plugins to register and check for custom features using Rust’s type system.<p>The renderer initialization in <code>mod.rs</code> was refactored to:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span style=color:#fa6e32>let</span><span> instance </span><span style=color:#ed9366>= </span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>create_raw_vulkan_instance(
</span><span>    </span><span style=color:#ed9366>&</span><span>instance_descriptor</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>&</span><span>raw_vulkan_init_settings</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> additional_vulkan_features</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span style=color:#fa6e32>let </span><span>(device</span><span style=color:#61676ccc>,</span><span> queue) </span><span style=color:#ed9366>= </span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>create_raw_device(</span><span style=color:#ed9366>...</span><span>)</span><span style=color:#ed9366>.</span><span>await</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><p>These functions invoke the registered callbacks during Vulkan object creation.<p>The <code>RenderPlugin</code> in <code>lib.rs</code> was updated to:<ol><li>Conditionally include <code>RawVulkanInitSettings</code><li>Pass settings to <code>initialize_renderer</code><li>Insert <code>AdditionalVulkanFeatures</code> into the render app:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> additional_vulkan_features </span><span style=color:#ed9366>=</span><span> render_resources</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>5</span><span style=color:#61676ccc>;
</span><span>    render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(additional_vulkan_features)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><ol><li><strong>Type-based Feature Tracking</strong>: Using <code>TypeId</code> in <code>AdditionalVulkanFeatures</code> provides a lightweight way to represent arbitrary features without predefined enums<li><strong>Unsafe Boundaries</strong>: Callbacks are marked unsafe with clear documentation about invariants: <ul><li>Must not remove features<li>Must not exceed hardware capabilities</ul><li><strong>Conditional Compilation</strong>: The <code>#[cfg(feature = "raw_vulkan_init")]</code> attributes ensure no overhead when the feature is disabled<li><strong>Lifecycle Management</strong>: The split between initialization (before renderer) and feature querying (after renderer) respects Bevy’s plugin ordering constraints</ol><p>A limitation is that plugins must be split into initialization and logic parts due to current lifecycle constraints. The PR mentions this could be resolved with deferred plugin initialization in the future.<h3 id=the-impact>The Impact</h3><p>This change enables several important capabilities:<ol><li>DLSS support can be implemented as a plugin<li>Other Vulkan extensions (e.g., ray tracing) can be cleanly added<li>Advanced rendering techniques requiring Vulkan extensions become possible<li>Maintains Bevy’s modular architecture without core engine modifications</ol><p>The changes are backward-compatible and opt-in, preserving the default wgpu initialization path. The implementation adds approximately 300 lines of focused, testable code with comprehensive safety documentation.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    Plugin -->|Registers| RawVulkanInitSettings
</span><span>    RawVulkanInitSettings -->|Callbacks| InitializeRenderer
</span><span>    InitializeRenderer -->|Creates| AdditionalVulkanFeatures
</span><span>    AdditionalVulkanFeatures -->|Queried By| Plugin
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><code>crates/bevy_render/src/renderer/mod.rs</code> (+125/-43) <ul><li>Refactored renderer initialization to support raw Vulkan path<li>Added conditional calls to raw Vulkan initialization functions</ul></ol><p>Key changes:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub</span><span> async </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>initialize_renderer</span><span>(
</span><span>    </span><span style=color:#ff8f40>backends</span><span style=color:#61676ccc>:</span><span> Backends,
</span><span>    </span><span style=color:#ff8f40>primary_window</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTRawHandleWrapperHolder>,
</span><span>    </span><span style=color:#ff8f40>options</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>WgpuSettings,
</span><span>    #[cfg(</span><span style=color:#ff8f40>feature</span><span> = "</span><span style=color:#ff8f40>raw_vulkan_init</span><span>")]
</span><span>    </span><span style=color:#ff8f40>raw_vulkan_init_settings</span><span style=color:#61676ccc>: </span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>RawVulkanInitSettings,
</span><span>) </span><span style=color:#61676ccc>-></span><span> RenderResources {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span>    </span><span style=color:#fa6e32>let</span><span> instance </span><span style=color:#ed9366>= </span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>create_raw_vulkan_instance(</span><span style=color:#ed9366>...</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><ol start=2><li><code>crates/bevy_render/src/renderer/raw_vulkan_init.rs</code> (+146/-0) <ul><li>New module implementing raw Vulkan initialization hooks</ul></ol><p>Key structures:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RawVulkanInitSettings </span><span>{ </span><span style=color:#abb0b6;font-style:italic>/* callbacks */ </span><span>}
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>AdditionalVulkanFeatures</span><span>(HashSet&LTTypeId>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>create_raw_vulkan_instance</span><span>(...) </span><span style=color:#61676ccc>-></span><span> Instance { </span><span style=color:#ed9366>... </span><span>}
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) async </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>create_raw_device</span><span>(...) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(Device, Queue), </span><span style=color:#f51818>.</span><span style=color:#ed9366>..> </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span></code></pre><ol start=3><li><code>crates/bevy_render/src/lib.rs</code> (+30/-70) <ul><li>Updated RenderPlugin to handle new initialization flow</ul></ol><p>Key changes:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span style=color:#fa6e32>let</span><span> raw_vulkan_init_settings </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span>get_resource</span><span style=color:#ed9366>::</span><span>&LTrenderer</span><span style=color:#ed9366>::</span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>RawVulkanInitSettings>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>cloned</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or_default</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let</span><span> render_resources </span><span style=color:#ed9366>= </span><span>renderer</span><span style=color:#ed9366>::</span><span>initialize_renderer(</span><span style=color:#ed9366>...</span><span>)</span><span style=color:#ed9366>.</span><span>await</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> additional_vulkan_features </span><span style=color:#ed9366>=</span><span> render_resources</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>5</span><span style=color:#61676ccc>;
</span><span>    render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(additional_vulkan_features)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=4><li><code>crates/bevy_render/src/settings.rs</code> (+14/-1) <ul><li>Extended RenderResources to include AdditionalVulkanFeatures</ul></ol><p>Change:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RenderResources</span><span>(
</span><span>    pub RenderDevice,
</span><span>    pub RenderQueue,
</span><span>    pub RenderAdapterInfo,
</span><span>    pub RenderAdapter,
</span><span>    pub RenderInstance,
</span><span>    #[cfg(feature = "raw_vulkan_init")]
</span><span>    </span><span style=color:#fa6e32>pub crate</span><span style=color:#ed9366>::</span><span>renderer</span><span style=color:#ed9366>::</span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>AdditionalVulkanFeatures</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=5><li><code>Cargo.toml</code> (+3/-0) <ul><li>Added new feature flag</ul></ol><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/wgpu/latest/wgpu/hal/vulkan/index.html target=_blank>wgpu Vulkan HAL documentation</a><li><a rel="noopener nofollow noreferrer" href=https://www.khronos.org/registry/vulkan/specs/1.3-extensions/man/html/VkInstanceCreateInfo.html target=_blank>Vulkan Instance Creation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/plugins/ target=_blank>Bevy Plugin System</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/any/struct.TypeId.html target=_blank>TypeId documentation</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20565.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>