<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20752 Clean up root toml features
        
    </title><meta content="#20752 Clean up root toml features" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-27</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20752-zh-cn-20250827>中文</a></div></div><div class=pr-content><h1 id=clean-up-root-toml-features>Clean up root toml features</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Clean up root toml features<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20752<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Dependencies, S-Ready-For-Final-Review, A-Cross-Cutting<li><strong>Created</strong>: 2025-08-25T15:28:39Z<li><strong>Merged</strong>: 2025-08-26T23:44:53Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>We currently specify transitive feature dependencies in two places: bevy and bevy_internal Cargo.tomls<li>This means they get out of sync often, accumulate unnecessary duplication, and sometimes forget certain transitive deps.</ul><h2 id=solution>Solution</h2><ul><li>Standardize on bevy_internal. Why: this makes it impossible to use it incorrectly if you depend on bevy_internal directly for some reason. If we standardized on bevy Cargo.toml holding these, it would mean that they could be bypassed by depending on bevy_internal. Not sure why someone would do that, but this feels right.<li>Move the few transitive feature dependency specifications that are still in bevy to bevy_internal<li>clean up a lot of duplicates<li>add a few missing dependencies<li>add top level bevy_mesh, bevy_camera, bevy_light, and bevy_shader features.</ul><h2 id=testing>Testing</h2><ul><li>this stuff is hard to test automatically or comprehensively. #20741 might make it easy to have a no-render test suite we can maintain coverage for, but other than that its just manual verification.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a persistent maintenance issue in Bevy’s dependency management system. The core problem was that transitive feature dependencies were being specified in two separate locations: the root <code>Cargo.toml</code> and <code>crates/bevy_internal/Cargo.toml</code>. This duplication led to frequent synchronization issues, unnecessary code repetition, and occasional missing dependencies.<p>The solution approach was straightforward but required careful execution: standardize on a single location for transitive feature definitions. The developer chose <code>bevy_internal</code> as the canonical location because it prevents incorrect usage patterns - if someone directly depends on <code>bevy_internal</code>, they can’t accidentally bypass the proper dependency chain that would be defined in the root <code>Cargo.toml</code>.<p>The implementation involved several key changes. First, the root <code>Cargo.toml</code> was significantly simplified by removing redundant transitive dependency specifications. Features that previously listed multiple dependencies now simply reference their corresponding <code>bevy_internal</code> feature:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>bevy_mesh_picking_backend </span><span>= [
</span><span>  </span><span style=color:#86b300>"bevy_picking"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_internal/bevy_mesh_picking_backend"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>bevy_mesh_picking_backend </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_mesh_picking_backend"</span><span>]
</span></code></pre><p>This pattern was applied consistently across all picking backends and many core features like <code>bevy_pbr</code>, <code>bevy_render</code>, and <code>bevy_scene</code>.<p>The second major change was enhancing <code>bevy_internal/Cargo.toml</code> to properly handle all the transitive dependencies that were removed from the root. This involved adding missing dependencies and ensuring proper feature propagation:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Enhanced feature definitions in bevy_internal
</span><span style=color:#399ee6>bevy_image </span><span>= [</span><span style=color:#86b300>"dep:bevy_image"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_color"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_asset"</span><span>]
</span><span style=color:#399ee6>bevy_sprite </span><span>= [</span><span style=color:#86b300>"dep:bevy_sprite"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_camera"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_gizmos?/bevy_sprite"</span><span>]
</span></code></pre><p>The PR also introduced several new top-level features (<code>bevy_mesh</code>, <code>bevy_camera</code>, <code>bevy_light</code>, and <code>bevy_shader</code>) to provide better modularity and clearer dependency boundaries.<p>From a technical perspective, this change improves maintainability by following the DRY (Don’t Repeat Yourself) principle. It eliminates the synchronization burden between two files and reduces the surface area for errors. The architecture now follows a cleaner pattern where the root <code>Cargo.toml</code> acts as a public interface, while <code>bevy_internal</code> handles the internal dependency graph.<p>The impact is significant for Bevy maintainers - they no longer need to update dependency lists in two places when adding or modifying features. For users, the change is mostly transparent but provides more consistent feature behavior and potentially better compile times due to reduced redundant dependency resolution.<p>One important consideration was preserving all existing functionality while simplifying the structure. The developer carefully verified that no essential dependencies were lost during the migration, and added several missing ones that were previously overlooked due to the duplication issue.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TB
</span><span>    Root[Cargo.toml - Root] -->|References| Internal[bevy_internal/Cargo.toml]
</span><span>    Internal -->|Defines| Features[Transitive Features]
</span><span>    Internal -->|Manages| Dependencies[Internal Dependencies]
</span><span>    
</span><span>    Root -->|Defines| Public[Public Features]
</span><span>    Public -->|Simplified| Interface[Clean Interface]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=cargo-toml-42-73><code>Cargo.toml</code> (+42/-73)</h3><p>This file was significantly simplified by removing redundant transitive dependency declarations and adding new top-level features.<p><strong>Key changes:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Added new top-level features to default set
</span><span style=color:#399ee6>default </span><span>= [
</span><span>  </span><span style=color:#abb0b6;font-style:italic># ... existing features ...
</span><span>  </span><span style=color:#86b300>"bevy_image"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_mesh"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_camera"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_light"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_shader"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Simplified feature definitions
</span><span style=color:#399ee6>bevy_pbr </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_pbr"</span><span>]  </span><span style=color:#abb0b6;font-style:italic># Previously had 5 dependencies
</span><span style=color:#399ee6>bevy_render </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_render"</span><span>]  </span><span style=color:#abb0b6;font-style:italic># Previously had 2 dependencies
</span><span style=color:#399ee6>bevy_scene </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_scene"</span><span>]  </span><span style=color:#abb0b6;font-style:italic># Previously had 2 dependencies
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Added new top-level features
</span><span style=color:#399ee6>bevy_mesh </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_mesh"</span><span>]
</span><span style=color:#399ee6>bevy_camera </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_camera"</span><span>]
</span><span style=color:#399ee6>bevy_light </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_light"</span><span>]
</span><span style=color:#399ee6>bevy_shader </span><span>= [</span><span style=color:#86b300>"bevy_internal/bevy_shader"</span><span>]
</span></code></pre><h3 id=crates-bevy-internal-cargo-toml-26-15><code>crates/bevy_internal/Cargo.toml</code> (+26/-15)</h3><p>This file was enhanced to handle all transitive dependencies that were removed from the root Cargo.toml.<p><strong>Key changes:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Enhanced feature definitions with proper dependencies
</span><span style=color:#399ee6>bevy_image </span><span>= [</span><span style=color:#86b300>"dep:bevy_image"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_color"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_asset"</span><span>]
</span><span style=color:#399ee6>bevy_sprite </span><span>= [</span><span style=color:#86b300>"dep:bevy_sprite"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_camera"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_gizmos?/bevy_sprite"</span><span>]
</span><span style=color:#399ee6>bevy_render </span><span>= [
</span><span>  </span><span style=color:#86b300>"dep:bevy_render"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_camera"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_shader"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_color/wgpu-types"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_color/encase"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_gizmos?/bevy_render"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Fixed trace_tracy_memory dependencies
</span><span style=color:#399ee6>trace_tracy_memory </span><span>= [</span><span style=color:#86b300>"bevy_log/trace_tracy_memory"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"trace"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"trace_tracy"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># Consolidated texture feature dependencies
</span><span style=color:#399ee6>tonemapping_luts </span><span>= [
</span><span>  </span><span style=color:#86b300>"bevy_core_pipeline?/tonemapping_luts"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"ktx2"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_image/zstd"</span><span style=color:#61676ccc>,
</span><span>]
</span><span style=color:#399ee6>smaa_luts </span><span>= [</span><span style=color:#86b300>"bevy_anti_aliasing?/smaa_luts"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"ktx2"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_image/zstd"</span><span>]
</span><span style=color:#399ee6>bluenoise_texture </span><span>= [</span><span style=color:#86b300>"bevy_pbr?/bluenoise_texture"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"ktx2"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_image/zstd"</span><span>]
</span></code></pre><h3 id=docs-cargo-features-md-5-1><code>docs/cargo_features.md</code> (+5/-1)</h3><p>Updated documentation to reflect the new top-level features and maintain accuracy.<p><strong>Key changes:</strong><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#fa6e32;font-weight:700># </span><span style=color:#399ee6;font-weight:700>Added documentation for new features
</span><span>|bevy_camera|Provides camera and visibility types, as well as culling primitives.|
</span><span>|bevy_image|Load and access image data. Usually added by an image format|
</span><span>|bevy_light|Provides light types such as point lights, directional lights, spotlights.|
</span><span>|bevy_mesh|Provides a mesh format and some primitive meshing routines.|
</span><span>|bevy_shader|Provides shaders usable through asset handles.|
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Cargo Features Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/ target=_blank>Bevy Engine Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/dependencies.html target=_blank>Dependency Management in Rust</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20752.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>