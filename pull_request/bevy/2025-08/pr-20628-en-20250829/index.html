<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20628 WebAssets without filtering
        
    </title><meta content="#20628 WebAssets without filtering" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20628-zh-cn-20250829>中文</a></div></div><div class=pr-content><h1 id=webassets-without-filtering>WebAssets without filtering</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: WebAssets without filtering<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20628<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Assets, S-Ready-For-Final-Review, M-Needs-Release-Note, X-Blessed<li><strong>Created</strong>: 2025-08-17T23:05:47Z<li><strong>Merged</strong>: 2025-08-29T03:42:33Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>adopt #17889<li>Fixes #5061</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a long-standing feature request to enable Bevy to load assets directly from web URLs. Previously, developers had to use external crates like <code>bevy_web_asset</code> or implement custom solutions to load assets from HTTP/HTTPS sources. The implementation needed to work across both native and WebAssembly targets while maintaining security awareness.<p>The core problem was that Bevy’s asset system only supported local filesystem paths and embedded assets, limiting applications that needed to load resources from remote servers. This was particularly relevant for web-based games and applications that dynamically fetch content.<p>The solution introduces a new <code>WebAssetPlugin</code> that registers HTTP and HTTPS asset sources with Bevy’s asset system. The implementation handles both native and WASM environments differently:<ul><li><strong>Native</strong>: Uses the <code>ureq</code> HTTP client with optional compression support<li><strong>WASM</strong>: Leverages the browser’s <code>fetch</code> API through existing WASM infrastructure</ul><p>The plugin registers two new asset sources (<code>http</code> and <code>https</code>) that can be enabled via cargo features. When these features are active, any asset path starting with <code>http://</code> or <code>https://</code> will be handled by the web asset reader instead of the filesystem reader.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example usage:
</span><span style=color:#fa6e32>let</span><span> image </span><span style=color:#ed9366>=</span><span> asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"https://example.com/image.png"</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>A key implementation detail is the reuse of existing WASM infrastructure. The <code>WebAssetReader</code> shares the <code>fetch_bytes</code> implementation with <code>HttpWasmAssetReader</code>, avoiding code duplication. For native platforms, the implementation uses <code>ureq</code> with proper error handling that maps HTTP status codes to appropriate <code>AssetReaderError</code> variants.<p>The PR also includes an optional caching mechanism (<code>web_asset_cache</code> feature) that stores downloaded assets locally. This cache uses a simple hash-based filename approach and currently never invalidates entries, which is noted as a limitation.<p>Security considerations are prominently addressed. The implementation includes warnings about potential risks of loading arbitrary URLs, as malicious URLs could exploit vulnerabilities in asset loaders or cause denial-of-service through large downloads. Developers are advised to validate URLs before loading them.<p>The changes also include a fix to the <code>get_meta_path</code> function to properly handle assets with extensions. Previously, it would incorrectly generate meta paths like <code>foo.bar.meta</code> instead of <code>foo.bar.meta</code> for files with extensions.<p>The implementation demonstrates good async patterns by using <code>bevy_tasks::blocking::unblock</code> to move HTTP requests off the main async executor thread, preventing blocking of other async tasks during network operations.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[AssetServer.load] --> B{URL scheme}
</span><span>    B -->|http://| C[WebAssetReader]
</span><span>    B -->|https://| C
</span><span>    B -->|file://| D[FileAssetReader]
</span><span>    
</span><span>    C --> E{Target platform}
</span><span>    E -->|Native| F[ureq HTTP client]
</span><span>    E -->|WASM| G[fetch API]
</span><span>    
</span><span>    F --> H[Optional caching]
</span><span>    G --> H
</span><span>    
</span><span>    H --> I[Asset loaded]
</span><span>    D --> I
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-asset-src-io-web-rs-314-0><code>crates/bevy_asset/src/io/web.rs</code> (+314/-0)</h3><p>This new file contains the core implementation of web asset loading:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>WebAssetReader </span><span>{
</span><span>    Http</span><span style=color:#61676ccc>,
</span><span>    Https</span><span style=color:#61676ccc>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span>AssetReader </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>WebAssetReader </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>read</span><span><</span><span style=color:#fa6e32>'a</span><span>>(
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span style=color:#ff8f40>self</span><span>,
</span><span>        </span><span style=color:#ff8f40>path</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a</span><span> Path,
</span><span>    ) </span><span style=color:#61676ccc>-></span><span> impl ConditionalSendFuture&LTOutput = </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTdyn Reader>, AssetReaderError>> {
</span><span>        </span><span style=color:#f07171>get</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>make_uri</span><span>(path))
</span><span>    }
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other required methods
</span><span>}
</span></code></pre><h3 id=crates-bevy-asset-src-io-mod-rs-32-3><code>crates/bevy_asset/src/io/mod.rs</code> (+32/-3)</h3><p>Modified to fix meta path generation and add tests:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>extension</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#86b300>".meta"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if </span><span style=color:#ed9366>!</span><span>extension</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_empty</span><span>() {
</span><span>    extension</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#86b300>"."</span><span>)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>extension</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#86b300>"meta"</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=cargo-toml-22-1><code>Cargo.toml</code> (+22/-1)</h3><p>Added new features for HTTP, HTTPS, and web asset caching:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>http </span><span>= [</span><span style=color:#86b300>"bevy_internal/http"</span><span>]
</span><span style=color:#399ee6>https </span><span>= [</span><span style=color:#86b300>"bevy_internal/https"</span><span>]
</span><span style=color:#399ee6>web_asset_cache </span><span>= [</span><span style=color:#86b300>"bevy_internal/web_asset_cache"</span><span>]
</span></code></pre><h3 id=examples-asset-web-asset-rs-22-0><code>examples/asset/web_asset.rs</code> (+22/-0)</h3><p>New example demonstrating web asset loading:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>setup</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands, </span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>) {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Camera2d)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> url </span><span style=color:#ed9366>= </span><span style=color:#86b300>"https://raw.githubusercontent.com/bevyengine/bevy/refs/heads/main/assets/branding/bevy_bird_dark.png"</span><span style=color:#61676ccc>;
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Sprite</span><span style=color:#ed9366>::</span><span>from_image(asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(url)))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=release-content-release-notes-web-assets-md-21-0><code>release-content/release-notes/web_assets.md</code> (+21/-0)</h3><p>Release notes documenting the new feature and security considerations.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/ureq/ target=_blank>ureq crate documentation</a> - HTTP client used for native implementation<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/features/assets/ target=_blank>Bevy Asset System documentation</a> - Understanding Bevy’s asset pipeline<li><a rel="noopener nofollow noreferrer" href=https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API target=_blank>Fetch API documentation</a> - Web standard used for WASM implementation<li><a rel="noopener nofollow noreferrer" href=https://github.com/johanhelsing/bevy_web_asset target=_blank>Original bevy_web_asset crate</a> - The external crate that inspired this implementation</ul><h1 id=full-code-diff>Full Code Diff</h1><p><em>(The full code diff is preserved exactly as provided in the original PR)</em></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20628.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>