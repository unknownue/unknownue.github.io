<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20794 Add `vulkan-portability` to fix compiling with `--all-features`
        
    </title><meta content="#20794 Add `vulkan-portability` to fix compiling with `--all-features`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-31</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20794-zh-cn-20250831>中文</a></div></div><div class=pr-content><h1 id=add-vulkan-portability-to-fix-compiling-with-all-features>Add <code>vulkan-portability</code> to fix compiling with <code>--all-features</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add <code>vulkan-portability</code> to fix compiling with <code>--all-features</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20794<li><strong>Author</strong>: tychedelia<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, S-Needs-Review<li><strong>Created</strong>: 2025-08-30T04:17:00Z<li><strong>Merged</strong>: 2025-08-31T16:26:59Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p>#20565 broke compiling with <code>--all-features</code> on macos. Add the <code>vulkan-portability</code> feature to <code>bevy_render</code> required to make vulkan compile with wgpu on mac.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a build system regression introduced by PR #20565 that broke compilation on macOS when using the <code>--all-features</code> flag. The core issue was that the Vulkan backend of wgpu requires additional configuration to work properly on macOS, which wasn’t being properly forwarded through Bevy’s feature flags.<p>When PR #20565 modified the rendering infrastructure, it inadvertently created a situation where compiling with all features enabled on macOS would fail because the Vulkan backend dependencies weren’t properly configured. macOS doesn’t have native Vulkan support, so wgpu relies on the <code>vulkan-portability</code> feature to provide Vulkan compatibility through MoltenVK, which implements Vulkan on top of Metal.<p>The solution was straightforward: add the missing feature flag mapping in <code>bevy_render</code>’s Cargo.toml to forward the <code>vulkan-portability</code> feature to the underlying wgpu dependency. This ensures that when Vulkan features are enabled on macOS, the necessary portability layer is also included in the build.<p>The implementation consists of a single line addition to the feature definitions in the Cargo.toml file:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>vulkan-portability </span><span>= [</span><span style=color:#86b300>"wgpu/vulkan-portability"</span><span>]
</span></code></pre><p>This change follows the established pattern in Bevy’s build system where crate features are used to control backend-specific dependencies and configurations. The <code>vulkan-portability</code> feature enables wgpu’s corresponding feature, which is essential for Vulkan to work on platforms like macOS that don’t have native Vulkan support.<p>The impact of this change is minimal but important: it restores the ability to compile Bevy with all features enabled on macOS systems. This is particularly valuable for developers who need to test their applications with different rendering backends or who rely on CI systems that build with the <code>--all-features</code> flag.<p>From a technical perspective, this PR demonstrates the importance of properly forwarding feature flags in Rust workspace configurations, especially when dealing with cross-platform graphics APIs that have different implementation requirements on various operating systems.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[bevy_render Cargo.toml] --> B[Adds vulkan-portability feature]
</span><span>    B --> C[Forwards to wgpu/vulkan-portability]
</span><span>    C --> D[Enables MoltenVK on macOS]
</span><span>    D --> E[Fixes Vulkan compilation]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-cargo-toml><code>crates/bevy_render/Cargo.toml</code></h3><p>This file received a single line addition to define the <code>vulkan-portability</code> feature and forward it to the wgpu dependency.<p><strong>Change:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>webgl </span><span>= [</span><span style=color:#86b300>"wgpu/webgl"</span><span>]
</span><span style=color:#399ee6>webgpu </span><span>= [</span><span style=color:#86b300>"wgpu/webgpu"</span><span>]
</span><span style=color:#399ee6>gles </span><span>= [</span><span style=color:#86b300>"wgpu/gles"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>webgl </span><span>= [</span><span style=color:#86b300>"wgpu/webgl"</span><span>]
</span><span style=color:#399ee6>webgpu </span><span>= [</span><span style=color:#86b300>"wgpu/webgpu"</span><span>]
</span><span style=color:#399ee6>vulkan-portability </span><span>= [</span><span style=color:#86b300>"wgpu/vulkan-portability"</span><span>]
</span><span style=color:#399ee6>gles </span><span>= [</span><span style=color:#86b300>"wgpu/gles"</span><span>]
</span></code></pre><p>This change ensures that when the Vulkan backend is used on macOS, the necessary portability layer (MoltenVK) is included in the build, fixing compilation issues when using <code>--all-features</code>.<h2 id=further-reading>Further Reading</h2><ul><li><a href="https://github.com/gfx-rs/wgpu?tab=readme-ov-file#vulkan-portability" rel="noopener nofollow noreferrer" target=_blank>wgpu’s vulkan-portability feature documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/KhronosGroup/MoltenVK target=_blank>MoltenVK: Vulkan on macOS and iOS</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Rust Cargo features documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/features/#renderer target=_blank>Bevy’s rendering backend system</a></ul><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_render/Cargo.toml b/crates/bevy_render/Cargo.toml
</span><span>index ecd28dec39fe2..d2f3e1e55cf71 100644
</span><span style=color:#c594c5>--- a/crates/bevy_render/Cargo.toml
</span><span style=color:#c594c5>+++ b/crates/bevy_render/Cargo.toml
</span><span style=color:#c594c5>@@ -40,6 +40,7 @@ </span><span style=color:#399ee6>tracing-tracy = ["dep:tracy-client"]
</span><span> ci_limits = []
</span><span> webgl = ["wgpu/webgl"]
</span><span> webgpu = ["wgpu/webgpu"]
</span><span style=color:#86b300>+vulkan-portability = ["wgpu/vulkan-portability"]
</span><span> gles = ["wgpu/gles"]
</span><span> detailed_trace = []
</span><span> ## Adds serialization support through `serde`.
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20794.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>