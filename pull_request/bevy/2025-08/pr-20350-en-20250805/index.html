<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20350 Virtual keyboard widget
        
    </title><meta content="#20350 Virtual keyboard widget" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-05</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20350-zh-cn-20250805>中文</a></div></div><div class=pr-content><h3 id=virtual-keyboard-widget-implementation>Virtual Keyboard Widget Implementation</h3><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Virtual keyboard widget<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20350<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, C-Examples, A-Input, A-UI, S-Ready-For-Final-Review, M-Needs-Release-Note, D-Modest<li><strong>Created</strong>: 2025-07-31T12:08:33Z<li><strong>Merged</strong>: 2025-08-05T19:59:04Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Minimal virtual keyboard widget implementation.<h2 id=solution>Solution</h2><p>Added a <code>virtual_keyboard</code> module to <code>bevy_feathers::controls</code> with a single function also called <code>virtual_keyboard</code>. <code>virtual_keyboard</code> takes a list of rows of keys and a system ID for the key press handler and returns a bundle of buttons representing the keys arranged into rows.<p>Lot of limitations:<ul><li>No modifier keys.<li>No styling for individual keyboard buttons.<li>The keyboard buttons can only display text, no image support.<li>The keys don’t repeat when held.<li>Doesn’t have any navigation support for use with a controller.<li>Doesn’t support tall keys that span multiple rows.</ul><h1></h1><p>I deliberately didn’t spend even a moment thinking about the design, this is just meant to be a super basic implementation that I can hook up to the text input widget for testing. Still looks quite neat, even so.<h2 id=testing>Testing</h2><pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example virtual_keyboard --features="experimental_bevy_feathers"
</span></code></pre><hr><h2 id=showcase>Showcase</h2><img alt=virtual_keyboard height=573 src=https://github.com/user-attachments/assets/f882cbec-ccdf-4df1-a32e-255c063454d4 width=1042><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h4 id=the-problem-and-context>The Problem and Context</h4><p>Bevy’s UI system lacked a built-in virtual keyboard component, which is essential for applications requiring touch-based text input. Without this, developers would need to implement their own solution from scratch for scenarios like kiosks, mobile interfaces, or gamepad-based text entry. The author needed a minimal implementation specifically for testing text input widgets, with the explicit understanding that this would be a foundational component rather than a fully-featured solution.<h4 id=the-solution-approach>The Solution Approach</h4><p>The approach centered on creating a flexible, data-driven keyboard generator that accepts:<ol><li>A list of key rows where each row contains (label, component) pairs<li>A callback system ID for handling key presses</ol><p>The implementation leverages existing Bevy UI components and Feathers controls, particularly reusing the button widget for individual keys. The keyboard is constructed as a vertical flex container (<code>FlexDirection::Column</code>) containing horizontal rows (<code>FlexDirection::Row</code>), with each key being a standard button component. This composition approach avoids reinventing basic UI layout mechanics.<h4 id=the-implementation>The Implementation</h4><p>The core implementation resides in the <code>virtual_keyboard</code> function which returns a UI bundle. The function iterates through the provided key rows, spawning a horizontal container for each row. Within each row, it spawns button components for every key:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>virtual_keyboard</span><span>&LTT>(
</span><span>    </span><span style=color:#ff8f40>keys</span><span style=color:#61676ccc>:</span><span> impl </span><span style=color:#55b4d4;font-style:italic>Iterator</span><span>&LTItem = </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(String, T)>> + Send + Sync + </span><span style=color:#fa6e32>'static</span><span>,
</span><span>    </span><span style=color:#ff8f40>on_key_press</span><span style=color:#61676ccc>: </span><span>SystemId&LTIn&LTActivate>>,
</span><span>) </span><span style=color:#61676ccc>-></span><span> impl Bundle
</span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... 
</span><span>    Children</span><span style=color:#ed9366>::</span><span>spawn((SpawnWith(</span><span style=color:#fa6e32>move </span><span style=color:#ed9366>|</span><span>parent</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>RelatedSpawner&LTChildOf></span><span style=color:#ed9366>| </span><span>{
</span><span>        </span><span style=color:#fa6e32>for</span><span> row </span><span style=color:#ed9366>in</span><span> keys {
</span><span>            parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>                Node {
</span><span>                    flex_direction</span><span style=color:#61676ccc>: </span><span>FlexDirection</span><span style=color:#ed9366>::</span><span>Row</span><span style=color:#61676ccc>,
</span><span>                    column_gap</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>4.</span><span>)</span><span style=color:#61676ccc>,
</span><span>                    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>                }</span><span style=color:#61676ccc>,
</span><span>                Children</span><span style=color:#ed9366>::</span><span>spawn(SpawnWith(</span><span style=color:#fa6e32>move </span><span style=color:#ed9366>|</span><span>parent</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>RelatedSpawner&LTChildOf></span><span style=color:#ed9366>| </span><span>{
</span><span>                    </span><span style=color:#fa6e32>for </span><span>(label</span><span style=color:#61676ccc>,</span><span> key_id) </span><span style=color:#ed9366>in</span><span> row</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_iter</span><span>() {
</span><span>                        parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(</span><span style=color:#f07171>button</span><span>(
</span><span>                            ButtonProps {
</span><span>                                on_click</span><span style=color:#61676ccc>: </span><span>Callback</span><span style=color:#ed9366>::</span><span>System(on_key_press)</span><span style=color:#61676ccc>,
</span><span>                                </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>                            }</span><span style=color:#61676ccc>,
</span><span>                            (key_id</span><span style=color:#61676ccc>,</span><span>)</span><span style=color:#61676ccc>,
</span><span>                            Spawn(Text</span><span style=color:#ed9366>::</span><span>new(label))</span><span style=color:#61676ccc>,
</span><span>                        ))</span><span style=color:#61676ccc>;
</span><span>                    }
</span><span>                }))</span><span style=color:#61676ccc>,
</span><span>            ))</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    })</span><span style=color:#61676ccc>,</span><span>))</span><span style=color:#61676ccc>,
</span></code></pre><p>Key technical aspects:<ul><li>Uses Bevy’s ECS relationship system (<code>ChildOf</code>, <code>RelatedSpawner</code>) for hierarchical UI construction<li>Implements tab navigation support via <code>TabGroup</code> component<li>Passes key identifiers as components attached to each button<li>Uses <code>Callback::System</code> to connect button presses to the handler system</ul><h4 id=technical-insights>Technical Insights</h4><p>The implementation demonstrates several practical Bevy UI patterns:<ol><li><strong>Component-based key identification</strong>: Each key carries a custom component (<code>VirtualKey</code> in the example) containing its label<li><strong>System callbacks</strong>: Uses <code>SystemId</code> for efficient event handling without closures<li><strong>UI composition</strong>: Builds complex widgets from simpler existing components (buttons within flex containers)<li><strong>Tab navigation</strong>: Integrates with Bevy’s <code>TabNavigationPlugin</code> for keyboard navigation</ol><p>Notable limitations acknowledged by the author:<ul><li>No support for key repeat behavior<li>No modifier key handling (Shift/Ctrl/Alt)<li>Limited to text labels without icons<li>No controller navigation support</ul><h4 id=the-impact>The Impact</h4><p>This PR adds a foundational virtual keyboard widget to Bevy’s Feathers UI toolkit. The immediate impact includes:<ol><li>Enabling text input for touch-based applications<li>Providing a reference implementation for custom keyboard layouts<li>Demonstrating practical composition of Bevy UI components<li>Adding a new example (<code>virtual_keyboard.rs</code>) showcasing the implementation</ol><p>The implementation’s simplicity makes it easily extendable for more complex use cases while providing immediate utility for basic text input scenarios. The explicit limitations document the component’s current scope and provide clear guidance for future enhancements.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[virtual_keyboard function] --> B[Vertical Node]
</span><span>    B --> C[Row Node]
</span><span>    C --> D[Button with Text]
</span><span>    B --> E[Row Node]
</span><span>    E --> F[Button with Text]
</span><span>    D --> G[Activate Callback]
</span><span>    F --> G
</span><span>    G --> H[on_key_pressed System]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-feathers-src-controls-virtual-keyboard-rs-56-0><code>crates/bevy_feathers/src/controls/virtual_keyboard.rs</code> (+56/-0)</h3><p>Added the core implementation of the virtual keyboard widget.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>virtual_keyboard</span><span>&LTT>(
</span><span>    </span><span style=color:#ff8f40>keys</span><span style=color:#61676ccc>:</span><span> impl </span><span style=color:#55b4d4;font-style:italic>Iterator</span><span>&LTItem = </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(String, T)>> + Send + Sync + </span><span style=color:#fa6e32>'static</span><span>,
</span><span>    </span><span style=color:#ff8f40>on_key_press</span><span style=color:#61676ccc>: </span><span>SystemId&LTIn&LTActivate>>,
</span><span>) </span><span style=color:#61676ccc>-></span><span> impl Bundle
</span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation as shown above
</span><span>}
</span></code></pre><h3 id=examples-ui-virtual-keyboard-rs-95-0><code>examples/ui/virtual_keyboard.rs</code> (+95/-0)</h3><p>Added a demonstration of the virtual keyboard in use.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>setup</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> callback </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_system</span><span>(on_virtual_key_pressed)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> layout </span><span style=color:#ed9366>= </span><span>[ </span><span style=color:#ed9366>... </span><span>]</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Keyboard layout definition
</span><span>    
</span><span>    commands
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Node { </span><span style=color:#ed9366>... </span><span>})
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_children</span><span>(|</span><span style=color:#ff8f40>parent</span><span>| {
</span><span>            parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>                </span><span style=color:#f07171>virtual_keyboard</span><span>(
</span><span>                    keys_iter</span><span style=color:#61676ccc>, 
</span><span>                    callback
</span><span>                )
</span><span>            ))</span><span style=color:#61676ccc>;
</span><span>        })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=crates-bevy-feathers-src-controls-mod-rs-2-0><code>crates/bevy_feathers/src/controls/mod.rs</code> (+2/-0)</h3><p>Exported the new virtual keyboard module.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub use </span><span>virtual_keyboard</span><span style=color:#ed9366>::</span><span>virtual_keyboard</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=cargo-toml-12-0><code>Cargo.toml</code> (+12/-0)</h3><p>Added the new example to the project manifest.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"virtual_keyboard"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/ui/virtual_keyboard.rs"
</span><span style=color:#399ee6>required-features </span><span>= [</span><span style=color:#86b300>"experimental_bevy_feathers"</span><span>]
</span></code></pre><h3 id=release-content-release-notes-feathers-md-3-2><code>release-content/release-notes/feathers.md</code> (+3/-2)</h3><p>Updated release notes to include the new feature.<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>-authors: ["@viridia", "@Atlas16A"]
</span><span>-pull_requests: [19730, 19900, 19928, 20237, 20169]
</span><span>+authors: ["@viridia", "@Atlas16A", "@ickshonpe"]
</span><span>+pull_requests: [19730, 19900, 19928, 20237, 20169, 20350]
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ui/ target=_blank>Bevy UI Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_feathers target=_blank>Feathers UI Component System</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/input/ target=_blank>Bevy Input Handling</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ecs/relationships/ target=_blank>Bevy ECS Relationships</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20350.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>