<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20426 Trim dependencies.
        
    </title><meta content="#20426 Trim dependencies." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-06</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20426-zh-cn-20250806>中文</a></div></div><div class=pr-content><h3 id=trim-dependencies-removing-unused-crates-from-bevy>Trim Dependencies: Removing Unused Crates from Bevy</h3><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Trim dependencies.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20426<li><strong>Author</strong>: nnethercote<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Dependencies, C-Code-Quality, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-08-05T06:06:38Z<li><strong>Merged</strong>: 2025-08-06T09:04:39Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Remove unneeded dependencies.<h2 id=solution>Solution</h2><p>Found using <code>cargo-shear</code>, <code>cargo-machete</code>, and <code>cargo-udeps</code>. They all do the same thing (identify unused dependencies), they are all so-so at it (with lots of false negatives and positives) but the combination of all three is enough to get a useful outcome.<h2 id=testing>Testing</h2><ul><li>I double-checked all the removals by grepping for each removed dependency’s name within the affected crate, to make sure there weren’t any uses remaining. I think they’re all ok.<li><code>cargo run -p ci</code></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>Bevy’s dependency tree had accumulated several unused crates over time, increasing build times and binary size without providing value. The primary challenge was reliably identifying which dependencies were truly unused, as existing tools like <code>cargo-udeps</code> produce both false positives and false negatives.<p>The solution combined three dependency analysis tools (<code>cargo-shear</code>, <code>cargo-machete</code>, and <code>cargo-udeps</code>) to cross-validate results. While each tool alone was unreliable, their combined output provided sufficient confidence to identify removable dependencies. For each candidate dependency, manual verification was performed using <code>grep</code> to confirm no references remained in the codebase.<p>The implementation focused on removing dependencies from several key locations:<ol><li>Root workspace dependencies for non-essential utilities<li>Benchmarks that included unnecessary rendering components<li>Render/text/winit subsystems with unused helper crates<li>Example tooling with unneeded serialization formats</ol><p>This approach maintained safety through redundant verification:<ol><li>Tool-based identification provided the initial candidate list<li>Manual code inspection confirmed no remaining references<li>CI pipeline ensured no breakages after removal</ol><p>The changes simplify Bevy’s dependency graph and reduce build times. Future dependency audits could use this same multi-tool verification approach to maintain lean dependencies. The PR demonstrates that while dependency analysis tools have limitations, combining them with manual verification produces reliable results.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    Tools["Dependency Analysis Tools"] -->|Identify candidates| Verification[Manual Grep Verification]
</span><span>    Verification -->|Safe to remove| Root[Cargo.toml]
</span><span>    Verification -->|Safe to remove| Benches[benches/Cargo.toml]
</span><span>    Verification -->|Safe to remove| Render[crates/bevy_render]
</span><span>    Verification -->|Safe to remove| Text[crates/bevy_text]
</span><span>    Verification -->|Safe to remove| Winit[crates/bevy_winit]
</span><span>    Verification -->|Safe to remove| ExampleTools[tools/example-showcase]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=root-cargo-toml>Root Cargo.toml</h3><p>Removed unused networking and macro utilities from dev dependencies:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(not(target_family = "wasm"))'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dev-dependencies</span><span>]
</span><span style=color:#399ee6>smol </span><span>= </span><span style=color:#86b300>"2"
</span><span style=color:#399ee6>smol-macros </span><span>= </span><span style=color:#86b300>"0.1"
</span><span style=color:#399ee6>smol-hyper </span><span>= </span><span style=color:#86b300>"0.1"
</span><span>
</span><span>[</span><span style=color:#399ee6>dev-dependencies</span><span>]
</span><span style=color:#399ee6>hyper </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"server"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"http1"</span><span>] }
</span><span style=color:#399ee6>http-body-util </span><span>= </span><span style=color:#86b300>"0.1"
</span><span style=color:#399ee6>macro_rules_attribute </span><span>= </span><span style=color:#86b300>"0.2"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After: (all above dependencies removed)
</span></code></pre><h3 id=benches-cargo-toml>Benches Cargo.toml</h3><p>Removed unnecessary utils and Linux-specific rendering dependencies:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>bevy_utils </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../crates/bevy_utils" </span><span>}
</span><span>
</span><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(target_os = "linux")'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dev-dependencies</span><span>]
</span><span style=color:#399ee6>bevy_winit </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../crates/bevy_winit"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"x11"</span><span>] }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After: (both sections removed)
</span></code></pre><h3 id=render-cargo-toml>Render Cargo.toml</h3><p>Removed unused error reporting dependency:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#abb0b6;font-style:italic># misc
</span><span style=color:#399ee6>codespan-reporting </span><span>= </span><span style=color:#86b300>"0.12.0"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After: (dependency removed)
</span></code></pre><h3 id=text-cargo-toml>Text Cargo.toml</h3><p>Removed unused bidirectional text processing:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>unicode-bidi </span><span>= </span><span style=color:#86b300>"0.3.13"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After: (dependency removed)
</span></code></pre><h3 id=winit-cargo-toml>Winit Cargo.toml</h3><p>Removed unused concurrency primitive for Wasm:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>target</span><span style=color:#61676ccc>.</span><span style=color:#86b300>'cfg(target_arch = "wasm32")'</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>crossbeam-channel </span><span>= </span><span style=color:#86b300>"0.5"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After: (dependency removed)
</span></code></pre><h3 id=example-tools-cargo-toml>Example Tools Cargo.toml</h3><p>Removed unused serialization format:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>ron </span><span>= </span><span style=color:#86b300>"0.10"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After: (dependency removed)
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/est31/cargo-udeps target=_blank>cargo-udeps documentation</a> - Unused dependency checker<li><a rel="noopener nofollow noreferrer" href=https://github.com/bnjbvr/cargo-machete target=_blank>cargo-machete</a> - Fast unused dependency remover<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/guide/dependencies.html target=_blank>Rust dependency management best practices</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20426.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>