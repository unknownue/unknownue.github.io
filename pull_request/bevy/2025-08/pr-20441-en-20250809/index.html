<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20441 Update toml_edit requirement from 0.22.7 to 0.23.2
        
    </title><meta content="#20441 Update toml_edit requirement from 0.22.7 to 0.23.2" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20441-zh-cn-20250809>中文</a></div></div><div class=pr-content><h2 id=pull-request-analysis-update-toml-edit-requirement-from-0-22-7-to-0-23-2>Pull Request Analysis: Update toml_edit requirement from 0.22.7 to 0.23.2</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Update toml_edit requirement from 0.22.7 to 0.23.2<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20441<li><strong>Author</strong>: mnmaita<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Dependencies, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-08-06T09:19:01Z<li><strong>Merged</strong>: 2025-08-09T01:41:08Z<li><strong>Merged By</strong>: james7132</ul><h3 id=description-translation>Description Translation</h3><p>The original description is in English and requires no translation:<p><strong>Objective</strong><ul><li>Closes #20410</ul><p><strong>Solution</strong><ul><li>Updated a deprecated type alias name (<code>ImDocument</code> -> <code>Document</code>).</ul><p><strong>Testing</strong><ul><li>CI checks</ul><hr><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>This dependency update addresses a breaking change introduced in the toml_edit crate. The core issue was straightforward: toml_edit 0.23 renamed its <code>ImDocument</code> type to <code>Document</code>, causing compilation errors in Bevy when upgrading. The PR solves this through coordinated dependency version bumps and type alias updates across multiple crates.<p>The problem surfaced because Bevy’s <code>bevy_macro_utils</code> crate and several tools depended on toml_edit 0.22.7, which used <code>ImDocument</code> for its parsed TOML representation. When the dependency was updated to 0.23.2, the renamed type became immediately incompatible with existing code. This type is central to Bevy’s manifest parsing operations, used for reading and processing Cargo.toml files during build procedures.<p>The solution approach was systematic: First update the dependency version in all relevant Cargo.toml files, then replace every occurrence of <code>ImDocument</code> with <code>Document</code> in the source code. This required changes in both library code (bevy_macro_utils) and build tools (build-templated-pages and example-showcase). The modifications are minimal but essential for maintaining compatibility with the updated dependency.<p>Implementation-wise, the changes are confined to three areas: dependency declarations, type annotations, and parser method calls. The most significant change occurs in <code>bevy_manifest.rs</code>, where both the type declaration and parsing logic needed updating. The solution preserves all existing functionality while adapting to the dependency’s new API.<p>This update demonstrates a common maintenance pattern in Rust ecosystems: tracking dependency changes and adapting to API evolutions. The impact is primarily maintenance-oriented - it prevents build failures and keeps Bevy compatible with the latest library versions. The changes also eliminate deprecation warnings, resulting in cleaner build outputs.<hr><h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[toml_edit 0.23.2] --> B[bevy_macro_utils]
</span><span>    A --> C[build-templated-pages]
</span><span>    A --> D[example-showcase]
</span><span>    B --> E[Bevy Manifest Parsing]
</span></code></pre><hr><h3 id=key-files-changed>Key Files Changed</h3><ol><li><p><strong>crates/bevy_macro_utils/Cargo.toml</strong><br> Updated dependency version:</p> <pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>toml_edit </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.22.7"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"parse"</span><span>] }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>toml_edit </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.23.2"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"parse"</span><span>] }
</span></code></pre><li><p><strong>crates/bevy_macro_utils/src/bevy_manifest.rs</strong><br> Core type and parser updates:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>toml_edit</span><span style=color:#ed9366>::</span><span>{ImDocument</span><span style=color:#61676ccc>,</span><span> Item}</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BevyManifest </span><span>{
</span><span>    manifest</span><span style=color:#61676ccc>: </span><span>ImDocument<</span><span style=color:#55b4d4;font-style:italic>Box</span><span><</span><span style=color:#fa6e32>str</span><span>>>,
</span><span>}
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>read_manifest</span><span>(</span><span style=color:#ff8f40>path</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Path) </span><span style=color:#61676ccc>-> </span><span>ImDocument<</span><span style=color:#55b4d4;font-style:italic>Box</span><span><</span><span style=color:#fa6e32>str</span><span>>> {
</span><span>    ImDocument</span><span style=color:#ed9366>::</span><span>parse(manifest)
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>toml_edit</span><span style=color:#ed9366>::</span><span>{Document</span><span style=color:#61676ccc>,</span><span> Item}</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BevyManifest </span><span>{
</span><span>    manifest</span><span style=color:#61676ccc>: </span><span>Document<</span><span style=color:#55b4d4;font-style:italic>Box</span><span><</span><span style=color:#fa6e32>str</span><span>>>,
</span><span>}
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>read_manifest</span><span>(</span><span style=color:#ff8f40>path</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Path) </span><span style=color:#61676ccc>-> </span><span>Document<</span><span style=color:#55b4d4;font-style:italic>Box</span><span><</span><span style=color:#fa6e32>str</span><span>>> {
</span><span>    Document</span><span style=color:#ed9366>::</span><span>parse(manifest)
</span><span>}
</span></code></pre><li><p><strong>tools/build-templated-pages/Cargo.toml</strong><br> Dependency version bump:</p> <pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>toml_edit </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.22.7"</span><span style=color:#61676ccc>, </span><span style=color:#f51818>... }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>toml_edit </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.23.2"</span><span style=color:#61676ccc>, </span><span style=color:#f51818>... }
</span></code></pre><li><p><strong>tools/example-showcase/Cargo.toml</strong><br> Consistent dependency update:</p> <pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>toml_edit </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.22.7"</span><span style=color:#61676ccc>, </span><span style=color:#f51818>... }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>toml_edit </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.23.2"</span><span style=color:#61676ccc>, </span><span style=color:#f51818>... }
</span></code></pre></ol><hr><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/toml-rs/toml/blob/main/toml_edit/CHANGELOG.md#0230-2025-07-14 target=_blank>toml_edit 0.23 release notes</a> - Details breaking changes<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html target=_blank>Rust dependency management</a> - Official Cargo documentation<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/semver.html target=_blank>Semantic Versioning in Rust</a> - How Rust handles breaking changes</ol><hr><h3 id=full-code-diff>Full Code Diff</h3><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_macro_utils/Cargo.toml b/crates/bevy_macro_utils/Cargo.toml
</span><span>index b998ae4fd4553..4353ad2136475 100644
</span><span style=color:#c594c5>--- a/crates/bevy_macro_utils/Cargo.toml
</span><span style=color:#c594c5>+++ b/crates/bevy_macro_utils/Cargo.toml
</span><span style=color:#c594c5>@@ -12,7 +12,7 @@ </span><span style=color:#399ee6>keywords = ["bevy"]
</span><span> syn = "2.0"
</span><span> quote = "1.0"
</span><span> proc-macro2 = "1.0"
</span><span style=color:#f07171>-toml_edit = { version = "0.22.7", default-features = false, features = [
</span><span style=color:#86b300>+toml_edit = { version = "0.23.2", default-features = false, features = [
</span><span>   "parse",
</span><span> ] }
</span><span> parking_lot = { version = "0.12" }
</span><span>diff --git a/crates/bevy_macro_utils/src/bevy_manifest.rs b/crates/bevy_macro_utils/src/bevy_manifest.rs
</span><span>index 0b8a496812376..378e04a44869c 100644
</span><span style=color:#c594c5>--- a/crates/bevy_macro_utils/src/bevy_manifest.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_macro_utils/src/bevy_manifest.rs
</span><span style=color:#c594c5>@@ -8,12 +8,12 @@ </span><span style=color:#399ee6>use std::{
</span><span>     path::{Path, PathBuf},
</span><span>     time::SystemTime,
</span><span> };
</span><span style=color:#f07171>-use toml_edit::{ImDocument, Item};
</span><span style=color:#86b300>+use toml_edit::{Document, Item};
</span><span> 
</span><span> /// The path to the `Cargo.toml` file for the Bevy project.
</span><span> #[derive(Debug)]
</span><span> pub struct BevyManifest {
</span><span style=color:#f07171>-    manifest: ImDocument&LTBox&LTstr>>,
</span><span style=color:#86b300>+    manifest: Document&LTBox&LTstr>>,
</span><span>     modified_time: SystemTime,
</span><span> }
</span><span> 
</span><span style=color:#c594c5>@@ -69,11 +69,11 @@ </span><span style=color:#399ee6>impl BevyManifest {
</span><span>         std::fs::metadata(cargo_manifest_path).and_then(|metadata| metadata.modified())
</span><span>     }
</span><span> 
</span><span style=color:#f07171>-    fn read_manifest(path: &Path) -> ImDocument&LTBox&LTstr>> {
</span><span style=color:#86b300>+    fn read_manifest(path: &Path) -> Document&LTBox&LTstr>> {
</span><span>         let manifest = std::fs::read_to_string(path)
</span><span>             .unwrap_or_else(|_| panic!("Unable to read cargo manifest: {}", path.display()))
</span><span>             .into_boxed_str();
</span><span style=color:#f07171>-        ImDocument::parse(manifest)
</span><span style=color:#86b300>+        Document::parse(manifest)
</span><span>             .unwrap_or_else(|_| panic!("Failed to parse cargo manifest: {}", path.display()))
</span><span>     }
</span><span> 
</span><span>diff --git a/tools/build-templated-pages/Cargo.toml b/tools/build-templated-pages/Cargo.toml
</span><span>index 70e5d827a2de2..6fa774af63fc9 100644
</span><span style=color:#c594c5>--- a/tools/build-templated-pages/Cargo.toml
</span><span style=color:#c594c5>+++ b/tools/build-templated-pages/Cargo.toml
</span><span style=color:#c594c5>@@ -6,7 +6,7 @@ </span><span style=color:#399ee6>publish = false
</span><span> license = "MIT OR Apache-2.0"
</span><span> 
</span><span> [dependencies]
</span><span style=color:#f07171>-toml_edit = { version = "0.22.7", default-features = false, features = [
</span><span style=color:#86b300>+toml_edit = { version = "0.23.2", default-features = false, features = [
</span><span>   "parse",
</span><span> ] }
</span><span> tera = "1.15"
</span><span>diff --git a/tools/example-showcase/Cargo.toml b/tools/example-showcase/Cargo.toml
</span><span>index c17477de73522..f2fe0bb55bc38 100644
</span><span style=color:#c594c5>--- a/tools/example-showcase/Cargo.toml
</span><span style=color:#c594c5>+++ b/tools/example-showcase/Cargo.toml
</span><span style=color:#c594c5>@@ -8,7 +8,7 @@ </span><span style=color:#399ee6>license = "MIT OR Apache-2.0"
</span><span> [dependencies]
</span><span> xshell = "0.2"
</span><span> clap = { version = "4.0", features = ["derive"] }
</span><span style=color:#f07171>-toml_edit = { version = "0.22.7", default-features = false, features = [
</span><span style=color:#86b300>+toml_edit = { version = "0.23.2", default-features = false, features = [
</span><span>   "parse",
</span><span> ] }
</span><span> pbr = "1.1"
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20441.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>