<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20502 Make bevy_ui not depend on bevy_render
        
    </title><meta content="#20502 Make bevy_ui not depend on bevy_render" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-12</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20502-zh-cn-20250812>中文</a></div></div><div class=pr-content><h3 id=make-bevy-ui-not-depend-on-bevy-render>Make bevy_ui not depend on bevy_render</h3><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Make bevy_ui not depend on bevy_render<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20502<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Usability, S-Ready-For-Final-Review, M-Needs-Migration-Guide<li><strong>Created</strong>: 2025-08-11T02:27:40Z<li><strong>Merged</strong>: 2025-08-12T03:41:04Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Reduce coupling between UI and rendering subsystems<li>Improve codebase modularity and separation of concerns</ul><h2 id=solution>Solution</h2><ul><li>Move ImagePlugin and related initialization to bevy_image crate<li>Rename TexturePlugin to clarify responsibilities<li>Migrate TRANSPARENT_IMAGE_HANDLE to bevy_image<li>Update system set naming conventions (InheritWeights → InheritWeightSystems)<li>Refactor dependency chains across multiple crates</ul><h2 id=testing>Testing</h2><ul><li>Verified existing UI functionality remains intact<li>Ensured image loading and rendering works as expected<li>Confirmed system ordering constraints are maintained</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The primary goal of this PR was to decouple the bevy_ui crate from bevy_render, improving architectural separation. This allows UI systems to function without requiring a full renderer dependency, which is valuable for headless applications or alternative rendering backends.<p>The core problem was that bevy_ui depended on bevy_render primarily for image handling functionality. This created unnecessary coupling and limited flexibility. The solution involved relocating image-related responsibilities to the more appropriate bevy_image crate.<p>First, we moved the TRANSPARENT_IMAGE_HANDLE constant from bevy_render to bevy_image. This handle is used throughout the UI system for placeholder textures, so moving it eliminated a key dependency:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before in bevy_render:
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>TRANSPARENT_IMAGE_HANDLE</span><span style=color:#61676ccc>: </span><span>Handle&LTImage> </span><span style=color:#ed9366>= ...</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After in bevy_image:
</span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>TRANSPARENT_IMAGE_HANDLE</span><span style=color:#61676ccc>: </span><span>Handle&LTImage> </span><span style=color:#ed9366>= ...</span><span style=color:#61676ccc>;
</span></code></pre><p>Next, we migrated the ImagePlugin from bevy_render to bevy_image. This plugin handles critical image initialization tasks like registering asset loaders and inserting default images:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New in bevy_image/src/image.rs
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ImagePlugin </span><span>{ ... }
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ImagePlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Asset loader registration
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Default image insertion
</span><span>    }
</span><span>}
</span></code></pre><p>The renderer’s texture handling was simplified and renamed to TexturePlugin to better reflect its responsibilities. This plugin now focuses solely on GPU texture management while delegating asset handling to bevy_image:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ImagePlugin </span><span>{ ... }
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TexturePlugin</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>TexturePlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Texture cache initialization
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Manual texture view handling
</span><span>    }
</span><span>}
</span></code></pre><p>We also updated system set naming conventions for consistency. The InheritWeights system set was renamed to InheritWeightSystems to follow Bevy’s naming standards:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InheritWeights</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InheritWeightSystems</span><span style=color:#61676ccc>;
</span></code></pre><p>Dependency trees were refactored across multiple crates. For example, bevy_ui’s Cargo.toml was updated to remove the bevy_render dependency entirely, replacing it with bevy_image where needed:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>bevy_render </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_render"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.17.0-dev" </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#abb0b6;font-style:italic># bevy_render dependency removed
</span></code></pre><p>The changes required careful adjustment of feature flags across the ecosystem. Features like compressed texture support were migrated to depend on bevy_image instead of bevy_render:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before in bevy_anti_aliasing:
</span><span style=color:#399ee6>smaa_luts </span><span>= [</span><span style=color:#86b300>"bevy_render/ktx2"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_image/ktx2"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_image/zstd"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>smaa_luts </span><span>= [</span><span style=color:#86b300>"bevy_image/ktx2"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_image/zstd"</span><span>]
</span></code></pre><p>Finally, we updated the migration guide and release notes to document these architectural changes. The key impact is that projects can now use UI components without pulling in the entire rendering stack, reducing binary size and improving compilation times for non-graphical applications.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[bevy_ui] --> B[bevy_image]
</span><span>    B --> C[ImagePlugin]
</span><span>    B --> D[TRANSPARENT_IMAGE_HANDLE]
</span><span>    A -.-> E[bevy_render]
</span><span>    style E stroke-dash:2
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-image-src-image-rs-82-1>crates/bevy_image/src/image.rs (+82/-1)</h3><p>Centralized image handling functionality:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>TRANSPARENT_IMAGE_HANDLE</span><span style=color:#61676ccc>: </span><span>Handle&LTImage> </span><span style=color:#ed9366>= ...</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ImagePlugin </span><span>{ ... }
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ImagePlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        app</span><span style=color:#ed9366>.</span><span>init_asset</span><span style=color:#ed9366>::</span><span>&LTImage>()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let mut</span><span> image_assets </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()</span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTAssets&LTImage>>()</span><span style=color:#61676ccc>;
</span><span>        image_assets</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>TRANSPARENT_IMAGE_HANDLE</span><span style=color:#61676ccc>, </span><span>Image</span><span style=color:#ed9366>::</span><span>transparent())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Asset loader initialization
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-texture-mod-rs-10-91>crates/bevy_render/src/texture/mod.rs (+10/-91)</h3><p>Simplified texture management:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TexturePlugin</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>TexturePlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>((
</span><span>            RenderAssetPlugin</span><span style=color:#ed9366>::</span><span>&LTGpuImage></span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>            ExtractResourcePlugin</span><span style=color:#ed9366>::</span><span>&LTManualTextureViews></span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>        ))
</span><span>        </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTManualTextureViews>()</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-internal-cargo-toml-12-14>crates/bevy_internal/Cargo.toml (+12/-14)</h3><p>Updated feature dependencies:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>compressed_image_saver </span><span>= [
</span><span>  </span><span style=color:#86b300>"bevy_image/compressed_image_saver"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_render/compressed_image_saver"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>compressed_image_saver </span><span>= [</span><span style=color:#86b300>"bevy_image/compressed_image_saver"</span><span>]
</span></code></pre><h3 id=crates-bevy-ui-cargo-toml>crates/bevy_ui/Cargo.toml</h3><p>Removed renderer dependency:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Removed:
</span><span style=color:#abb0b6;font-style:italic># bevy_render = { path = "../bevy_render", version = "0.17.0-dev" }
</span></code></pre><h3 id=crates-bevy-mesh-src-lib-rs>crates/bevy_mesh/src/lib.rs</h3><p>Updated system set naming:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InheritWeights</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InheritWeightSystems</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/plugins/ target=_blank>Bevy Plugin System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/system-order/ target=_blank>ECS System Ordering Constraints</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/assets/ target=_blank>Asset Handling in Bevy</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20502.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>