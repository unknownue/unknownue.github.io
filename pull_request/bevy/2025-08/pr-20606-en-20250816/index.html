<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20606 Fix some lints and feature gates
        
    </title><meta content="#20606 Fix some lints and feature gates" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20606-zh-cn-20250816>中文</a></div></div><div class=pr-content><h2 id=fix-some-lints-and-feature-gates>Fix some lints and feature gates</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Fix some lints and feature gates<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20606<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-08-16T07:45:06Z<li><strong>Merged</strong>: 2025-08-16T20:13:38Z<li><strong>Merged By</strong>: mockersf</ul><h3 id=description-translation>Description Translation</h3><h1 id=objective>Objective</h1><ul><li>Some more lints<li>Also fixes #20542</ul><h2 id=solution>Solution</h2><ul><li>Fix them</ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>This PR addresses two main technical concerns in the Bevy codebase: improving code quality by fixing linter warnings and resolving feature-gating issues. The changes were necessary to maintain build correctness across different feature configurations and to follow modern Rust idioms.<p>The initial problem involved inconsistent handling of feature gates, particularly around the <code>alloc</code> feature. When certain features were disabled, unused imports and implementations remained in the code, causing compiler warnings. Additionally, issue #20542 reported a type error in the <code>DebugName</code> implementation that needed correction. The PR also included a minor refactor to simplify conditional logic using Rust’s newer <code>let-else</code> syntax.<p>For the feature-gating issues, the solution involved adding <code>#[cfg(feature = "alloc")]</code> attributes to imports and implementations that depend on heap allocation. This ensures the compiler only includes these code paths when the relevant feature is enabled. The changes were spread across multiple math modules where polygon-related functionality requires allocation.<p>The bug in <code>DebugName</code> was straightforward - a reference was being returned where a direct value was expected. The fix modified the return statement to match the expected <code>&str</code> type rather than <code>&&str</code>. This resolved the type mismatch and fixed the reported issue.<p>In <code>sync_file_asset.rs</code>, the solution modernized the meta file filtering logic by using Rust 1.58’s <code>if let</code> chaining syntax. This replaced a nested if-statement with a single, more readable condition that combines pattern matching and boolean logic.<p>These changes collectively improve the codebase in three ways:<ol><li>They eliminate compiler warnings for unused code when features are disabled<li>They fix a concrete type error affecting debug functionality<li>They modernize syntax for better readability</ol><p>The implementation required careful attention to conditional compilation attributes. For example, in <code>primitive_impls.rs</code>, the <code>ConvexPolygon</code> import was moved inside the <code>alloc</code> feature gate since this type depends on heap allocation. Similarly, in <code>dim2.rs</code>, the <code>TryFrom</code> implementation for <code>ConvexPolygon</code> was properly feature-gated since it depends on <code>Polygon</code> which requires allocation.<p>The changes demonstrate good practices for feature gating in Rust crates and show how to properly handle conditional compilation to keep builds clean across different configurations. The PR also illustrates the importance of precise type matching in trait implementations, as shown in the <code>DebugName</code> fix.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #20606] --> B[Fix Lints]
</span><span>    A --> C[Feature Gates]
</span><span>    A --> D[Bug Fix #20542]
</span><span>    B --> E[Modernize condition syntax]
</span><span>    C --> F[Add alloc feature guards]
</span><span>    D --> G[Correct DebugName type]
</span><span>    F --> H[bevy_math modules]
</span><span>    F --> I[bevy_reflect]
</span><span>    G --> J[bevy_utils]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><ol><li><strong><code>crates/bevy_asset/src/io/file/sync_file_asset.rs</code></strong><br> Simplified condition for filtering meta files using modern Rust syntax:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(ext) </span><span style=color:#ed9366>=</span><span> path</span><span style=color:#ed9366>.</span><span style=color:#f07171>extension</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>and_then</span><span>(|</span><span style=color:#ff8f40>e</span><span>| e</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_str</span><span>()) {
</span><span>    </span><span style=color:#fa6e32>if</span><span> ext</span><span style=color:#ed9366>.</span><span style=color:#f07171>eq_ignore_ascii_case</span><span>(</span><span style=color:#86b300>"meta"</span><span>) {
</span><span>        </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(ext) </span><span style=color:#ed9366>=</span><span> path</span><span style=color:#ed9366>.</span><span style=color:#f07171>extension</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>and_then</span><span>(|</span><span style=color:#ff8f40>e</span><span>| e</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_str</span><span>())
</span><span>    </span><span style=color:#ed9366>&&</span><span> ext</span><span style=color:#ed9366>.</span><span style=color:#f07171>eq_ignore_ascii_case</span><span>(</span><span style=color:#86b300>"meta"</span><span>)
</span><span>{
</span><span>    </span><span style=color:#fa6e32>return </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=2><li><strong><code>crates/bevy_math/src/bounding/bounded2d/primitive_impls.rs</code></strong><br> Corrected feature-gating for alloc-dependent types:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (unconditional import):
</span><span style=color:#fa6e32>use crate</span><span style=color:#ed9366>::</span><span>primitives</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#ed9366>...</span><span style=color:#61676ccc>,</span><span> ConvexPolygon</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>...</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (conditional import):
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"alloc"</span><span>)]
</span><span style=color:#fa6e32>use crate</span><span style=color:#ed9366>::</span><span>primitives</span><span style=color:#ed9366>::</span><span>{ConvexPolygon</span><span style=color:#61676ccc>,</span><span> Polygon</span><span style=color:#61676ccc>,</span><span> Polyline2d}</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong><code>crates/bevy_math/src/primitives/dim2.rs</code></strong><br> Added missing feature guards:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added feature guard for error type
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"alloc"</span><span>)]
</span><span style=color:#fa6e32>use </span><span>thiserror</span><span style=color:#ed9366>::</span><span>Error</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added feature guard for conversion implementation
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"alloc"</span><span>)]
</span><span style=color:#fa6e32>impl </span><span>TryFrom&LTPolygon> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ConvexPolygon </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span></code></pre><ol start=4><li><strong><code>crates/bevy_utils/src/debug_info.rs</code></strong><br> Fixed type error in DebugName implementation:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>return </span><span style=color:#ed9366>&</span><span style=color:#ff8f40>FEATURE_DISABLED</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>return </span><span style=color:#ff8f40>FEATURE_DISABLED</span><span style=color:#61676ccc>;
</span></code></pre><ol start=5><li><strong><code>crates/bevy_reflect/src/lib.rs</code></strong><br> Added feature guard for auto-registration exports:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added conditional compilation
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>any</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"auto_register_static"</span><span style=color:#61676ccc>,</span><span> feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"auto_register_inventory"</span><span>))]
</span><span style=color:#fa6e32>pub use </span><span>__automatic_type_registration_impl</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Rust Feature Gates Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://blog.rust-lang.org/2022/01/13/Rust-1.58.0.html#let-else-statements target=_blank>Rust 1.58 if-let Chains</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/ops/trait.Deref.html target=_blank>Deref Trait Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation in Rust</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20606.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>