<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20495 Depend on bevy_tasks::block_on instead of futures_lite::block_on
        
    </title><meta content="#20495 Depend on bevy_tasks::block_on instead of futures_lite::block_on" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-11</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20495-zh-cn-20250811>中文</a></div></div><div class=pr-content><h2 id=depend-on-bevy-tasks-block-on-instead-of-futures-lite-block-on>Depend on bevy_tasks::block_on instead of futures_lite::block_on</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Depend on bevy_tasks::block_on instead of futures_lite::block_on<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20495<li><strong>Author</strong>: james7132<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Dependencies, C-Code-Quality, S-Ready-For-Final-Review, A-Tasks<li><strong>Created</strong>: 2025-08-10T17:38:41Z<li><strong>Merged</strong>: 2025-08-11T07:56:47Z<li><strong>Merged By</strong>: james7132</ul><h3 id=description-translation>Description Translation</h3><h1 id=objective>Objective</h1><p><code>bevy_tasks::block_on</code> is aliased depending on the features enabled on the crate. If a Bevy-specific version of a <code>block_on</code> is implemented, it should be using it as well. The rest of the engine should use the version bevy_tasks exposes.<h2 id=solution>Solution</h2><p>Remove the direct dependencies on <code>futures_lite::block_on</code> and use <code>bevy_tasks::block_on</code> instead.<h2 id=testing>Testing</h2><p>CI should pass.<h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>The core issue addressed in this PR was inconsistent usage of blocking mechanisms across Bevy’s codebase. While Bevy provides its own <code>bevy_tasks::block_on</code> function that abstracts platform-specific implementations, several modules were directly using <code>futures_lite::block_on</code>. This created two problems: First, it introduced unnecessary dependencies on <code>futures_lite</code> in crates that didn’t require it. Second, it bypassed Bevy’s task system which might include optimizations or special handling for different execution environments.<p>The solution was straightforward: replace all direct calls to <code>futures_lite::block_on</code> with <code>bevy_tasks::block_on</code> throughout the codebase. This change centralizes blocking behavior through Bevy’s task system while reducing external dependencies. The implementation required modifications in four key locations across the <code>bevy_render</code> and <code>bevy_tasks</code> crates.<p>In <code>bevy_render</code>, the main initialization logic was updated to use Bevy’s blocking function. This is particularly important for WebAssembly targets where Bevy might implement custom blocking behavior. The render pipeline cache handling saw similar updates in its synchronous pipeline creation paths, ensuring consistent blocking behavior during asset processing.<p>A notable change occurred in <code>bevy_tasks</code> tests, where imports were refactored to access <code>futures_lite</code> functionality through Bevy’s re-exported module. This maintains test functionality while aligning with the new dependency structure.<p>The dependency cleanup in <code>bevy_render</code>’s Cargo.toml removes <code>futures-lite</code> entirely since it’s no longer directly used, reducing compile times and potential version conflicts. This change demonstrates how small, focused updates can improve code consistency and maintainability while reducing external dependencies.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[bevy_render] -->|uses| B[bevy_tasks::block_on]
</span><span>    C[bevy_tasks] -->|provides| B
</span><span>    C -->|may wrap| D[futures_lite]
</span><span>    A -.->|removed direct dependency| D
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><ol><li><p><strong>crates/bevy_render/Cargo.toml</strong><br> Removed unnecessary dependency:</p> <pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-futures-lite = "2.0.1"
</span></code></pre><li><p><strong>crates/bevy_render/src/lib.rs</strong><br> Updated main thread blocking:</p> <pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-                    futures_lite::future::block_on(async_renderer);
</span><span style=color:#86b300>+                    bevy_tasks::block_on(async_renderer);
</span></code></pre><li><p><strong>crates/bevy_render/src/render_resource/pipeline_cache.rs</strong><br> Updated pipeline creation blocking:</p> <pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-    match futures_lite::future::block_on(task) {
</span><span style=color:#86b300>+    match bevy_tasks::block_on(task) {
</span></code></pre> <p>(Two occurrences updated)</p><li><p><strong>crates/bevy_tasks/src/edge_executor.rs</strong><br> Updated test imports:</p> <pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-    use futures_lite::future::{block_on, pending, poll_once};
</span><span style=color:#86b300>+    use bevy_tasks::{block_on, futures_lite::{pending, poll_once}};
</span></code></pre></ol><h3 id=further-reading>Further Reading</h3><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_tasks/latest/bevy_tasks/ target=_blank>Bevy Tasks Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-embedded.github.io/book/async/index.html target=_blank>Async Rust in Embedded Systems</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/async-book/01_getting_started/02_why_async.html target=_blank>Rust Futures Explained</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20495.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>