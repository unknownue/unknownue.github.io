<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20639
        
    </title><meta content=#20639 property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-18</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20639-zh-cn-20250818>中文</a></div></div><div class=pr-content><h2 id=fixing-broken-shader-imports-in-bevy-s-2d-examples>Fixing Broken Shader Imports in Bevy’s 2D Examples</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>When working on the Bevy engine, PR #20587 restructured shader imports by moving sprite-related functionality from <code>bevy_sprite</code> to <code>bevy_sprite_render</code>. While this architectural change improved code organization, it unintentionally broke several 2D examples that relied on custom shaders. The core issue (#20615) manifested as compilation errors in these examples because their shader code still referenced the old import paths. Since examples serve as critical learning resources and reference implementations for Bevy users, keeping them functional is essential for both documentation and user experience.<h3 id=the-solution-approach>The Solution Approach</h3><p>The fix required systematically updating all import statements in affected shaders to reference the new <code>bevy_sprite_render</code> module instead of the old <code>bevy_sprite</code> path. This approach:<ol><li>Maintained consistency with Bevy’s updated rendering architecture<li>Required minimal changes since only import paths needed modification<li>Preserved all shader functionality without altering core logic<li>Covered all broken examples identified in the issue</ol><p>The solution was validated by running the affected examples (<code>custom_gltf_vertex_attribute</code>, <code>shader_material_2d</code>, and <code>mesh2d_manual</code>) to confirm they compiled and rendered correctly.<h3 id=implementation-details>Implementation Details</h3><p>The changes exclusively modify import statements across four files - three shader assets and one Rust example file. Each change follows the same pattern: replacing <code>bevy_sprite::</code> with <code>bevy_sprite_render::</code> in import declarations.<p><strong>Shader import updates</strong><br> For each shader file, the import path was updated to match Bevy’s new module structure:<pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// File: assets/shaders/custom_gltf_2d.wgsl
</span><span>// Before:
</span><span>#import bevy_sprite::{
</span><span>    mesh2d_view_bindings::globals,
</span><span>    mesh2d_functions::{get_world_from_local, mesh2d_position_local_to_clip},
</span><span>}
</span><span>
</span><span>// After:
</span><span>#import bevy_sprite_render::{
</span><span>    mesh2d_view_bindings::globals,
</span><span>    mesh2d_functions::{get_world_from_local, mesh2d_position_local_to_clip},
</span><span>}
</span></code></pre><pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// File: assets/shaders/custom_material_2d.wgsl
</span><span>// Before:
</span><span>#import bevy_sprite::mesh2d_vertex_output::VertexOutput
</span><span>
</span><span>// After:
</span><span>#import bevy_sprite_render::mesh2d_vertex_output::VertexOutput
</span></code></pre><p><strong>Comment correction</strong><br> The custom_vertex_attribute.wgsl shader also received a documentation update to reflect the new import path:<pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// File: assets/shaders/custom_vertex_attribute.wgsl
</span><span>// Before:
</span><span>// For 2d replace `bevy_pbr::mesh_functions` with `bevy_sprite::mesh2d_functions`
</span><span>
</span><span>// After:
</span><span>// For 2d replace `bevy_pbr::mesh_functions` with `bevy_sprite_render::mesh2d_functions`
</span></code></pre><p><strong>Example code fix</strong><br> The mesh2d_manual example was updated to reference the correct import path in its embedded shader code:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: examples/2d/mesh2d_manual.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>COLORED_MESH2D_SHADER</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>r</span><span style=color:#86b300>"
</span><span style=color:#86b300>#import bevy_sprite::mesh2d_functions
</span><span style=color:#86b300>"</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>COLORED_MESH2D_SHADER</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>r</span><span style=color:#86b300>"
</span><span style=color:#86b300>#import bevy_sprite_render::mesh2d_functions
</span><span style=color:#86b300>"</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>This fix demonstrates several important aspects of Bevy’s architecture:<ol><li><strong>Decoupled Rendering Logic</strong>: The move to <code>bevy_sprite_render</code> separates rendering concerns from core sprite functionality<li><strong>WGSL Import System</strong>: Bevy’s shader system uses WGSL’s <code>#import</code> directive for code organization<li><strong>Asset Management</strong>: Shader files are treated as first-class assets that need maintenance like code files<li><strong>Example Validation</strong>: Examples serve as critical test cases for API changes</ol><h3 id=the-impact>The Impact</h3><p>These changes immediately restore functionality to three important 2D rendering examples. For Bevy users, this means:<ul><li>Learning materials remain accurate and functional<li>Custom shader implementations continue to work with current Bevy versions<li>The engine demonstrates commitment to maintaining working examples<li>Future similar refactors will need similar cross-cutting updates</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    PR[PR #20587] -->|Moved functionality| B[bevy_sprite_render]
</span><span>    B -->|Broke imports| C[Shader Examples]
</span><span>    PR20639[This PR #20639] -->|Updates imports| C
</span><span>    C -->|Fixed| E[Working Examples]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><strong><code>assets/shaders/custom_gltf_2d.wgsl</code></strong><br> Updated import path to match new module structure</p> <pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// Change:
</span><span>-#import bevy_sprite::{
</span><span>+#import bevy_sprite_render::{
</span></code></pre><li><p><strong><code>assets/shaders/custom_material_2d.wgsl</code></strong><br> Corrected vertex output import</p> <pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// Change:
</span><span>-#import bevy_sprite::mesh2d_vertex_output::VertexOutput
</span><span>+#import bevy_sprite_render::mesh2d_vertex_output::VertexOutput
</span></code></pre><li><p><strong><code>assets/shaders/custom_vertex_attribute.wgsl</code></strong><br> Fixed documentation comment</p> <pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// Change:
</span><span>-// For 2d replace `bevy_pbr::mesh_functions` with `bevy_sprite::mesh2d_functions`
</span><span>+// For 2d replace `bevy_pbr::mesh_functions` with `bevy_sprite_render::mesh2d_functions`
</span></code></pre><li><p><strong><code>examples/2d/mesh2d_manual.rs</code></strong><br> Updated embedded shader import</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Change:
</span><span style=color:#ed9366>-#</span><span>import bevy_sprite</span><span style=color:#ed9366>::</span><span>mesh2d_functions
</span><span style=color:#ed9366>+#</span><span>import bevy_sprite_render</span><span style=color:#ed9366>::</span><span>mesh2d_functions
</span></code></pre></ol><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/shaders/ target=_blank>Bevy Shader Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/wgsl/#imports target=_blank>WGSL Import Syntax</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/pipeline/ target=_blank>Bevy Render Pipeline Architecture</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20587 target=_blank>Original PR that introduced the break (#20587)</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20639.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>