<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20473 Stop using mesh re-exports in-repo and add bevy_mesh prelude
        
    </title><meta content="#20473 Stop using mesh re-exports in-repo and add bevy_mesh prelude" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20473-zh-cn-20250809>中文</a></div></div><div class=pr-content><h1 id=stop-using-mesh-re-exports-in-repo-and-add-bevy-mesh-prelude>Stop using mesh re-exports in-repo and add bevy_mesh prelude</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Stop using mesh re-exports in-repo and add bevy_mesh prelude<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20473<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Dependencies, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-08-09T09:05:19Z<li><strong>Merged</strong>: 2025-08-09T18:05:04Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>prepare to remove bevy_mesh re-export from bevy_render. This will be done in 0.18, but we might as well prepare for it now.</ul><h2 id=solution>Solution</h2><ul><li>Add a prelude and use bevy_mesh directly. After this pr and #20471, we will be ready.</ul><h2 id=testing>Testing</h2><ul><li>cargo check –examples</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses technical debt in Bevy’s rendering architecture by preparing for the removal of <code>bevy_mesh</code> re-exports from <code>bevy_render</code>. The re-export pattern was causing unnecessary coupling between crates and complicating dependency management. The changes systematically replace all internal uses of <code>bevy_render::mesh</code> with direct imports from <code>bevy_mesh</code>, while establishing a new prelude module to maintain developer ergonomics.<p>The core problem stems from historical design decisions where <code>bevy_render</code> re-exported <code>bevy_mesh</code> types. This created an implicit dependency that made it difficult to modify mesh-related functionality independently. As Bevy’s architecture evolved, this pattern became increasingly problematic for maintenance and clear separation of concerns. The solution involves decoupling these crates by making all internal code use <code>bevy_mesh</code> directly.<p>The implementation required coordinated changes across the codebase. First, <code>bevy_mesh</code> was added as an explicit dependency in several crates’ <code>Cargo.toml</code> files that previously relied on the re-export. For example:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span># crates/bevy_pbr/Cargo.toml
</span><span>[dependencies]
</span><span style=color:#86b300>+ bevy_mesh = { path = "../bevy_mesh", version = "0.17.0-dev" }
</span></code></pre><p>Next, a prelude module was created in <code>bevy_mesh</code> to provide ergonomic access to common types:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_mesh/src/lib.rs
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>prelude </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#61676ccc>::</span><span>{
</span><span>        morph</span><span style=color:#ed9366>::</span><span>MorphWeights</span><span style=color:#61676ccc>, </span><span>primitives</span><span style=color:#ed9366>::</span><span>MeshBuilder</span><span style=color:#61676ccc>, </span><span>primitives</span><span style=color:#ed9366>::</span><span>Meshable</span><span style=color:#61676ccc>,</span><span> Mesh</span><span style=color:#61676ccc>,</span><span> Mesh2d</span><span style=color:#61676ccc>,</span><span> Mesh3d</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>This prelude was then integrated into Bevy’s internal prelude system:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>// crates/bevy_internal/src/prelude.rs
</span><span style=color:#86b300>+#[cfg(feature = "bevy_image")]
</span><span style=color:#86b300>+pub use crate::mesh::prelude::*;
</span></code></pre><p>The bulk of the changes involve updating import paths throughout the codebase. Previously, modules accessed mesh types through <code>bevy_render::mesh</code>. These were systematically replaced with direct imports from <code>bevy_mesh</code>. For example:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>// crates/bevy_pbr/src/decal/forward.rs
</span><span style=color:#f07171>-use bevy_render::mesh::{Mesh, Mesh3d, MeshBuilder, MeshVertexBufferLayoutRef, Meshable};
</span><span style=color:#86b300>+use bevy_mesh::{Mesh, Mesh3d, MeshBuilder, MeshVertexBufferLayoutRef, Meshable};
</span></code></pre><p>Special attention was paid to vertex buffer layouts and mesh traits. The <code>VertexBufferLayout</code> type was moved from <code>bevy_render</code> to <code>bevy_mesh</code>, requiring updates in rendering pipelines:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>// crates/bevy_ui_render/src/pipeline.rs
</span><span style=color:#f07171>-use bevy_render::render_resource::VertexBufferLayout;
</span><span style=color:#86b300>+use bevy_mesh::VertexBufferLayout;
</span></code></pre><p>Mesh processing systems were updated to use the new direct imports. This included skinning systems:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>// crates/bevy_pbr/src/render/skin.rs
</span><span style=color:#f07171>-use bevy_render::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span><span style=color:#86b300>+use bevy_mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span></code></pre><p>Examples and tests were updated to reflect these changes. Custom mesh examples now import directly from <code>bevy_mesh</code>:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>// examples/3d/custom_skinned_mesh.rs
</span><span style=color:#f07171>-use bevy::render::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span><span style=color:#86b300>+use bevy::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span></code></pre><p>The changes maintain identical functionality while improving architectural clarity. By eliminating the re-exports, this PR reduces coupling between <code>bevy_render</code> and <code>bevy_mesh</code>, making it easier to modify mesh handling independently. The prelude module ensures developers can still access common types conveniently.<p>Performance remains unaffected since this is purely an import restructuring. The main impact is on code maintainability - future changes to mesh systems will be easier to implement without navigating indirect dependencies. This work completes the groundwork for fully removing the re-export in Bevy 0.18.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[bevy_pbr] --> B[bevy_render]
</span><span>    A --> C[bevy_mesh]
</span><span>    D[bevy_sprite] --> C
</span><span>    E[bevy_ui] --> C
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><code>crates/bevy_mesh/src/lib.rs</code> <ul><li>Added prelude module for ergonomic imports</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#86b300>+pub mod prelude {
</span><span style=color:#86b300>+    #[doc(hidden)]
</span><span style=color:#86b300>+    pub use crate::{
</span><span style=color:#86b300>+        morph::MorphWeights, primitives::MeshBuilder, primitives::Meshable, Mesh, Mesh2d, Mesh3d,
</span><span style=color:#86b300>+    };
</span><span style=color:#86b300>+}
</span></code></pre><ol start=2><li><code>crates/bevy_pbr/src/prepass/mod.rs</code> <ul><li>Replaced render::mesh imports with bevy_mesh<li>Reorganized imports for clarity</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-use bevy_render::{
</span><span style=color:#f07171>-    mesh::allocator::MeshAllocator,
</span><span style=color:#f07171>-    // ...
</span><span style=color:#f07171>-};
</span><span style=color:#86b300>+use bevy_mesh::{Mesh, Mesh3d, MeshVertexBufferLayoutRef};
</span></code></pre><ol start=3><li><code>crates/bevy_pbr/src/render/mesh.rs</code> <ul><li>Updated skinning and mesh imports<li>Maintained identical functionality</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-use bevy_render::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span><span style=color:#86b300>+use bevy_mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span></code></pre><ol start=4><li><code>tests/3d/test_invalid_skinned_mesh.rs</code> <ul><li>Updated mesh import paths</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-use bevy::render::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span><span style=color:#86b300>+use bevy::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span></code></pre><ol start=5><li><code>examples/animation/custom_skinned_mesh.rs</code> <ul><li>Changed import paths for direct mesh access</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-use bevy::render::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span><span style=color:#86b300>+use bevy::mesh::skinning::{SkinnedMesh, SkinnedMeshInverseBindposes};
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/plugins_guidelines.md#module-organization target=_blank>Bevy’s Module Structure Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/prelude/index.html target=_blank>Rust Prelude Pattern</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/guide/dependencies.html target=_blank>Dependency Management in Cargo</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20473.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>