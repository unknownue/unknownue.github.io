<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20339 Reflect non-callback components and resources in bevy_core_widgets and bevy_feathers
        
    </title><meta content="#20339 Reflect non-callback components and resources in bevy_core_widgets and bevy_feathers" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20339-zh-cn-20250803>中文</a></div></div><div class=pr-content><h2 id=reflect-non-callback-components-and-resources-in-bevy-core-widgets-and-bevy-feathers>Reflect non-callback components and resources in bevy_core_widgets and bevy_feathers</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Reflect non-callback components and resources in bevy_core_widgets and bevy_feathers<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20339<li><strong>Author</strong>: alice-i-cecile<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-UI, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-07-30T22:04:01Z<li><strong>Merged</strong>: 2025-08-03T19:58:32Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><h1 id=objective>Objective</h1><ul><li>Reflecting public components and resources is essential to allow them to be saved to scenes and function properly in inspectors<li>Fixes #20040.</ul><h2 id=solution>Solution</h2><ul><li>Derive reflect for all of the public components and resources that didn’t have it<li>Various components that store a <code>Callback</code>, like <code>CoreButton</code>, are a notable exception <ul><li>Because Callbacks are not type-erased, and the reflect derive only works when all generics are reflect, I could not get this to work nicely<li>If you can get this working, please let me know and we can do this in follow-up!</ul><li>I also slapped a missing Debug derive on the theme resource because it seems extremely useful and I noticed it</ul><h2 id=notes-to-reviewers>Notes to reviewers</h2><ul><li>this is not feature-gated: see #20337 for the steps needed to meaningfully do so. Fixing that is out of scope for the 0.17 release.<li>I’ve opted to separate the Reflect derive from the other derives wherever rustfmt would let me. While this looks dumb right now, it will reduce the diff noise when fixing #20337.<li>I could add reflection to the callback-containing components with an ignore for the callback fields, but I don’t think this is particularly useful</ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>This PR addresses a gap in Bevy’s UI components where many public components and resources lacked reflection support. Without reflection, these types couldn’t be properly serialized to scenes or inspected in tools. The core issue (#20040) prevented UI elements from functioning correctly in common development workflows.<p>The solution approach was methodical: add <code>Reflect</code> derives to all non-callback public components and resources across <code>bevy_core_widgets</code> and <code>bevy_feathers</code>. Components containing <code>Callback</code> fields were excluded due to technical limitations with reflecting generic types. The author deliberately separated <code>Reflect</code> derives from other derives to minimize future diff noise when addressing #20337 (feature-gating).<p>Implementation details:<ol><li>Added <code>bevy_reflect</code> dependency to <code>bevy_core_widgets/Cargo.toml</code><li>Derived <code>Reflect</code> on enums like <code>ControlOrientation</code> and <code>TrackClick</code><li>Added <code>ReflectComponent</code> to struct components like <code>CoreScrollbar</code> and <code>ColorSwatch</code><li>Implemented <code>Reflect</code> for resources including <code>UiTheme</code><li>Added missing <code>Debug</code> derive to <code>UiTheme</code> for better debuggability</ol><p>For callback-containing components, the author explicitly chose not to implement reflection by ignoring callback fields, as this wouldn’t provide meaningful reflection capabilities. The PR focuses on straightforward cases where reflection could be cleanly implemented.<pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Components without Reflection] --> B{Contains Callback?}
</span><span>    B -->|Yes| C[Excluded from PR]
</span><span>    B -->|No| D[Reflect Derived]
</span><span>    E[Resources without Reflection] --> F[Reflect Derived]
</span><span>    D --> G[Serializable in Scenes]
</span><span>    F --> G
</span><span>    D --> H[Visible in Inspectors]
</span><span>    F --> H
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><p><strong>crates/bevy_feathers/src/theme.rs (+14/-3)</strong> Added reflection to theme resources and components. Fixed missing Debug derive.<p>Before:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ThemeProps </span><span>{ ... }
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UiTheme</span><span>(pub ThemeProps)</span><span style=color:#61676ccc>;
</span></code></pre><p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ThemeProps </span><span>{ ... }
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UiTheme</span><span>(pub ThemeProps)</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>crates/bevy_core_widgets/src/core_scrollbar.rs (+10/-3)</strong> Added reflection to scrollbar components and orientation enum.<p>Before:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>ControlOrientation </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CoreScrollbar </span><span>{ ... }
</span></code></pre><p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(PartialEq</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>ControlOrientation </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CoreScrollbar </span><span>{ ... }
</span></code></pre><p><strong>crates/bevy_core_widgets/src/core_slider.rs (+10/-3)</strong> Added reflection to slider components and enums.<p>Before:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy)]
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>TrackClick </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SliderStep</span><span>(pub </span><span style=color:#fa6e32>f32</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>TrackClick </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SliderStep</span><span>(pub </span><span style=color:#fa6e32>f32</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>crates/bevy_feathers/src/controls/checkbox.rs (+8/-3)</strong> Added reflection to checkbox internal components.<p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>CheckboxFrame</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>crates/bevy_feathers/src/controls/color_swatch.rs (+8/-3)</strong> Added reflection to color swatch components.<p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ColorSwatch</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=further-reading>Further Reading</h3><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_reflect/latest/bevy_reflect/ target=_blank>Bevy Reflection Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/scenes/ target=_blank>Scene Serialization Guide</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/20040 target=_blank>Related Issue: #20040</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20337 target=_blank>Follow-up Task: #20337</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20339.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>