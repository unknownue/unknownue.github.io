<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20478 Use bevy_camera in ui, sprite, text instead of bevy_render::camera re-export
        
    </title><meta content="#20478 Use bevy_camera in ui, sprite, text instead of bevy_render::camera re-export" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20478-zh-cn-20250809>中文</a></div></div><div class=pr-content><h2 id=technical-report-refactoring-camera-dependencies-in-bevy-ui-sprite-and-text-modules>Technical Report: Refactoring Camera Dependencies in Bevy UI, Sprite, and Text Modules</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Use bevy_camera in ui, sprite, text instead of bevy_render::camera re-export<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20478<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-08-09T20:29:00Z<li><strong>Merged</strong>: 2025-08-09T21:35:58Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><p><strong>Objective</strong><ul><li>Prepare for removing re-exports</ul><p><strong>Solution</strong><ul><li>Replace <code>bevy_render::camera</code> re-exports with direct <code>bevy_camera</code> imports in UI, sprite, and text modules</ul><p><strong>Testing</strong><ul><li><code>cargo check --examples</code></ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><h4 id=the-problem-and-context>The Problem and Context</h4><p>Bevy’s rendering architecture had a dependency pattern where camera-related functionality was re-exported through <code>bevy_render::camera</code>. This created indirect dependencies between UI/sprite/text systems and the renderer. The architectural goal was to decouple camera systems from the renderer to improve modularity and prepare for future changes where camera functionality might be used independently of rendering.<p>The main challenges were:<ol><li>Tight coupling between camera logic and rendering systems<li>Difficulty in removing deprecated re-exports without breaking dependent crates<li>Inconsistent import patterns across the codebase</ol><h4 id=the-solution-approach>The Solution Approach</h4><p>The solution involved directly importing camera-related types from the <code>bevy_camera</code> crate instead of through <code>bevy_render</code> re-exports. This required:<ol><li>Adding explicit dependencies on <code>bevy_camera</code> to affected crates<li>Updating import paths throughout UI, sprite, and text systems<li>Maintaining identical functionality through type aliases and consistent APIs</ol><p>Key decisions included:<ul><li>Prioritizing mechanical find/replace operations for straightforward path updates<li>Handling more complex cases like <code>ViewVisibility</code> and <code>VisibilitySystems</code> with targeted imports<li>Preserving all existing functionality and behavior during the transition</ul><h4 id=the-implementation>The Implementation</h4><p>The changes were implemented through systematic updates across 24 files in three main crates:<ol><li><p><strong>Dependency Management</strong><br> Added explicit <code>bevy_camera</code> dependencies to <code>Cargo.toml</code> files:</p> <pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># crates/bevy_sprite/Cargo.toml
</span><span style=color:#399ee6>bevy_camera </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_camera"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.17.0-dev" </span><span>}
</span></code></pre><li><p><strong>Import Path Refactoring</strong><br> Updated import paths from <code>bevy_render::camera</code> and <code>bevy_render::view</code> to direct <code>bevy_camera</code> imports:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>camera</span><span style=color:#ed9366>::</span><span>extract_cameras</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>view</span><span style=color:#ed9366>::</span><span>ViewVisibility</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>visibility</span><span style=color:#ed9366>::</span><span>ViewVisibility</span><span style=color:#61676ccc>;
</span></code></pre><li><p><strong>Component System Updates</strong><br> Modified component systems to use directly imported types:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_sprite/src/sprite.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>component</span><span>(on_add </span><span style=color:#ed9366>=</span><span> view::add_visibility_class::&LTSprite>)]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>component</span><span>(on_add </span><span style=color:#ed9366>=</span><span> visibility::add_visibility_class::&LTSprite>)]
</span></code></pre><li><p><strong>Camera System Integration</strong><br> Updated camera-related systems to use <code>bevy_camera</code> primitives:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_text/src/text2d.rs
</span><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>primitives</span><span style=color:#ed9366>::</span><span>Aabb</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>visibility</span><span style=color:#ed9366>::</span><span>{ViewVisibility</span><span style=color:#61676ccc>,</span><span> VisibilityClass}</span><span style=color:#61676ccc>;
</span></code></pre></ol><h4 id=technical-insights>Technical Insights</h4><p>The refactoring demonstrates several important patterns:<ol><li><strong>Dependency Inversion</strong>: By removing renderer-mediated access to camera systems, we achieve cleaner separation of concerns<li><strong>Gradual Deprecation</strong>: Prepares for future removal of re-exports without breaking changes<li><strong>Cross-Crate Consistency</strong>: Establishes a standardized pattern for accessing camera functionality</ol><p>Performance considerations were minimal since this is a compile-time dependency change rather than a runtime logic modification. The changes are primarily structural with no algorithmic impact.<h4 id=the-impact>The Impact</h4><p>The changes provide several concrete benefits:<ol><li><strong>Reduced Coupling</strong>: UI/sprite/text systems now depend directly on camera interfaces rather than through renderer intermediaries<li><strong>Improved Maintainability</strong>: Clearer import paths make the codebase easier to navigate and reason about<li><strong>Preparation for Future Changes</strong>: Enables removal of camera re-exports from <code>bevy_render</code><li><strong>Consistent Architecture</strong>: Aligns with Bevy’s modular design principles</ol><p>The changes affect multiple rendering-adjacent systems but maintain complete backward compatibility with existing APIs and functionality.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    bevy_sprite --> bevy_camera
</span><span>    bevy_text --> bevy_camera
</span><span>    bevy_ui --> bevy_camera
</span></code></pre><p>This diagram shows the new direct dependencies between UI/sprite/text crates and the camera system, eliminating the previous indirect dependency through <code>bevy_render</code>.<h3 id=key-files-changed>Key Files Changed</h3><ol><li><p><strong><code>crates/bevy_sprite/src/mesh2d/material.rs</code> (+9/-12)</strong><br> Updated camera and visibility imports to use <code>bevy_camera</code> directly:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>camera</span><span style=color:#ed9366>::</span><span>extract_cameras</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>view</span><span style=color:#ed9366>::</span><span>ViewVisibility</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>visibility</span><span style=color:#ed9366>::</span><span>ViewVisibility</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>{
</span><span>    camera</span><span style=color:#ed9366>::</span><span>extract_cameras</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other render-specific imports
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre> <p>This centralizes camera-related functionality while keeping render-specific logic separate.</p><li><p><strong><code>crates/bevy_sprite/src/lib.rs</code> (+7/-7)</strong><br> Replaced renderer camera primitives with direct camera imports:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>primitives</span><span style=color:#ed9366>::</span><span>{Aabb</span><span style=color:#61676ccc>,</span><span> MeshAabb}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>primitives</span><span style=color:#ed9366>::</span><span>{Aabb</span><span style=color:#61676ccc>,</span><span> MeshAabb </span><span style=color:#ed9366>as _</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre> <p>The <code>MeshAabb as _</code> rename maintains compatibility while using the camera version.</p><li><p><strong><code>crates/bevy_text/src/text2d.rs</code> (+6/-7)</strong><br> Updated text rendering to use camera visibility systems:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>view</span><span style=color:#ed9366>::</span><span>{Visibility</span><span style=color:#61676ccc>,</span><span> VisibilityClass}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>visibility</span><span style=color:#ed9366>::</span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#61676ccc>,</span><span> ViewVisibility</span><span style=color:#61676ccc>,</span><span> Visibility</span><span style=color:#61676ccc>,</span><span> VisibilityClass
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre> <p>Ensures text rendering properly integrates with camera visibility calculations.</p><li><p><strong><code>crates/bevy_ui/src/ui_node.rs</code> (+3/-6)</strong><br> Modified camera target specification:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_render</span><span style=color:#ed9366>::</span><span>camera</span><span style=color:#ed9366>::</span><span>{Camera</span><span style=color:#61676ccc>,</span><span> RenderTarget}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_camera</span><span style=color:#ed9366>::</span><span>{Camera</span><span style=color:#61676ccc>,</span><span> RenderTarget}</span><span style=color:#61676ccc>;
</span></code></pre> <p>Maintains identical functionality with clearer dependency structure.</p></ol><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_camera/latest/bevy_camera/ target=_blank>Bevy Camera Crate Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/rfcs/blob/main/rfcs/1-render-modularization.md target=_blank>Bevy Modular Architecture RFC</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/visibility-and-privacy.html target=_blank>Rust Visibility and Privacy System</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20478.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>