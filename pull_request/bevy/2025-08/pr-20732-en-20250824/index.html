<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20732 Constify math/dim2
        
    </title><meta content="#20732 Constify math/dim2" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20732-zh-cn-20250824>中文</a></div></div><div class=pr-content><h1 id=constify-math-dim2>Constify math/dim2</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Constify math/dim2<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20732<li><strong>Author</strong>: exoego<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Usability, S-Ready-For-Final-Review, A-Math<li><strong>Created</strong>: 2025-08-24T02:53:00Z<li><strong>Merged</strong>: 2025-08-24T20:58:29Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Part of https://github.com/bevyengine/bevy/issues/16124<h2 id=solution>Solution</h2><ul><li>Constify where seems legit and easy to maintain <ul><li>Many places are untouched, where non-const operations such as Vec2::length are used</ul><li>Not only floating ops, but also bool os and constructors are constified, as same as other existing codes</ul><h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? <ul><li><code>cargo test --manifest-path /Users/tatsuno/IdeaProjects/bevy/crates/bevy_math/Cargo.toml</code></ul><li>Are there any parts that need more testing?<li>How can other people (reviewers) test your changes? Is there anything specific they need to know?<li>If relevant, what platforms did you test these changes on, and are there any important ones you can’t test?</ul><hr><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important optimization in Bevy’s math library: making 2D primitive methods const where possible. The changes are part of a larger initiative to constify math operations throughout the engine (issue #16124), which enables compile-time computation of mathematical expressions and improves performance for constant values.<p>The implementation follows a consistent pattern across multiple 2D primitives: adding the <code>const</code> keyword to methods that perform simple arithmetic operations, boolean checks, or constructor calls. The developer carefully identified methods that could be safely made const without requiring non-const operations like vector length calculations or complex floating-point operations.<p>Key changes include:<ul><li>Making diameter calculations const for circles and annuli<li>Constifying arc constructors and simple geometric properties<li>Ensuring boolean checks for arc types (major/minor) are const<li>Converting geometric constructors to use const arithmetic operations</ul><p>The approach maintains backward compatibility while enabling new compile-time optimization opportunities. The changes are minimal and focused, affecting only function signatures without altering any implementation logic.<pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[2D Primitives] --> B[Circle]
</span><span>    A --> C[Arc2d]
</span><span>    A --> D[CircularSector]
</span><span>    A --> E[CircularSegment]
</span><span>    A --> F[Ellipse]
</span><span>    A --> G[Annulus]
</span><span>    A --> H[Rhombus]
</span><span>    A --> I[Segment2d]
</span><span>    A --> J[Rectangle]
</span><span>    A --> K[RegularPolygon]
</span><span>    A --> L[Capsule2d]
</span><span>    
</span><span>    B --> B1[const diameter]
</span><span>    C --> C1[const constructors]
</span><span>    C --> C2[const properties]
</span><span>    D --> D1[const constructors]
</span><span>    E --> E1[const constructors]
</span><span>    F --> F1[const from_size]
</span><span>    G --> G1[const diameter]
</span><span>    G --> G2[const thickness]
</span><span>    H --> H1[const new]
</span><span>    H --> H2[const circumradius]
</span><span>    I --> I1[const point accessors]
</span><span>    J --> J1[const constructors]
</span><span>    K --> K1[const new]
</span><span>    K --> K2[const angle methods]
</span><span>    L --> L1[const new]
</span><span>    L --> L2[const to_inner_rectangle]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-math-src-primitives-dim2-rs-71-55><code>crates/bevy_math/src/primitives/dim2.rs</code> (+71/-55)</h3><p>This file contains the core implementation of 2D geometric primitives in Bevy. The changes convert appropriate methods to const functions across multiple primitive types.<p><strong>Circle changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>diameter</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>f32 </span><span>{
</span><span>    </span><span style=color:#ff8f40>2.0 </span><span style=color:#ed9366>* </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>radius
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub const fn </span><span style=color:#f29718>diameter</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>f32 </span><span>{
</span><span>    </span><span style=color:#ff8f40>2.0 </span><span style=color:#ed9366>* </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>radius
</span><span>}
</span></code></pre><p><strong>Arc2d changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Multiple constructors and methods made const
</span><span style=color:#fa6e32>pub const fn </span><span style=color:#f29718>new</span><span>(</span><span style=color:#ff8f40>radius</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#ff8f40>half_angle</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#fa6e32>Self </span><span>{ radius</span><span style=color:#61676ccc>,</span><span> half_angle }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub const fn </span><span style=color:#f29718>is_minor</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>half_angle </span><span style=color:#ed9366><= </span><span style=color:#ff8f40>FRAC_PI_2
</span><span>}
</span></code></pre><p><strong>Ellipse changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>from_size</span><span>(</span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> Vec2) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        half_size</span><span style=color:#61676ccc>:</span><span> size </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>,
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub const fn </span><span style=color:#f29718>from_size</span><span>(</span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> Vec2) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        half_size</span><span style=color:#61676ccc>: </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(size</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>,</span><span> size</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    }
</span><span>}
</span></code></pre><p><strong>Rectangle changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>from_size</span><span>(</span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> Vec2) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        half_size</span><span style=color:#61676ccc>:</span><span> size </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>,
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub const fn </span><span style=color:#f29718>from_size</span><span>(</span><span style=color:#ff8f40>size</span><span style=color:#61676ccc>:</span><span> Vec2) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        half_size</span><span style=color:#61676ccc>: </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(size</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span style=color:#61676ccc>,</span><span> size</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>    }
</span><span>}
</span></code></pre><p>The changes follow a consistent pattern: replacing division operations with explicit const arithmetic and using <code>Vec2::new()</code> instead of vector division to maintain const correctness.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/const_eval.html#const-functions target=_blank>Rust Reference: Const Functions</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_math/latest/bevy_math/ target=_blank>Bevy Math Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/16124 target=_blank>Issue #16124: Constify more math ops</a></ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_math/src/primitives/dim2.rs b/crates/bevy_math/src/primitives/dim2.rs
</span><span>index 29e60cb844697..0f3b4bcc26153 100644
</span><span style=color:#c594c5>--- a/crates/bevy_math/src/primitives/dim2.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_math/src/primitives/dim2.rs
</span><span style=color:#c594c5>@@ -55,7 +55,7 @@ </span><span style=color:#399ee6>impl Circle {
</span><span> 
</span><span>     /// Get the diameter of the circle
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn diameter(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn diameter(&self) -> f32 {
</span><span>         2.0 * self.radius
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -142,13 +142,13 @@ </span><span style=color:#399ee6>impl Default for Arc2d {
</span><span> impl Arc2d {
</span><span>     /// Create a new [`Arc2d`] from a `radius` and a `half_angle`
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn new(radius: f32, half_angle: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn new(radius: f32, half_angle: f32) -> Self {
</span><span>         Self { radius, half_angle }
</span><span>     }
</span><span> 
</span><span>     /// Create a new [`Arc2d`] from a `radius` and an `angle` in radians
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_radians(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn from_radians(radius: f32, angle: f32) -> Self {
</span><span>         Self {
</span><span>             radius,
</span><span>             half_angle: angle / 2.0,
</span><span style=color:#c594c5>@@ -157,7 +157,7 @@ </span><span style=color:#399ee6>impl Arc2d {
</span><span> 
</span><span>     /// Create a new [`Arc2d`] from a `radius` and an `angle` in degrees.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_degrees(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn from_degrees(radius: f32, angle: f32) -> Self {
</span><span>         Self {
</span><span>             radius,
</span><span>             half_angle: angle.to_radians() / 2.0,
</span><span style=color:#c594c5>@@ -168,7 +168,7 @@ </span><span style=color:#399ee6>impl Arc2d {
</span><span>     ///
</span><span>     /// For instance, `0.5` turns is a semicircle.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_turns(radius: f32, fraction: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn from_turns(radius: f32, fraction: f32) -> Self {
</span><span>         Self {
</span><span>             radius,
</span><span>             half_angle: fraction * PI,
</span><span style=color:#c594c5>@@ -177,13 +177,13 @@ </span><span style=color:#399ee6>impl Arc2d {
</span><span> 
</span><span>     /// Get the angle of the arc
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn angle(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn angle(&self) -> f32 {
</span><span>         self.half_angle * 2.0
</span><span>     }
</span><span> 
</span><span>     /// Get the length of the arc
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn length(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn length(&self) -> f32 {
</span><span>         self.angle() * self.radius
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -256,7 +256,7 @@ </span><span style=color:#399ee6>impl Arc2d {
</span><span>     ///
</span><span>     /// **Note:** This is not the negation of [`is_major`](Self::is_major): an exact semicircle is both major and minor.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn is_minor(&self) -> bool {
</span><span style=color:#86b300>+    pub const fn is_minor(&self) -> bool {
</span><span>         self.half_angle <= FRAC_PI_2
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -264,7 +264,7 @@ </span><span style=color:#399ee6>impl Arc2d {
</span><span>     ///
</span><span>     /// **Note:** This is not the negation of [`is_minor`](Self::is_minor): an exact semicircle is both major and minor.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn is_major(&self) -> bool {
</span><span style=color:#86b300>+    pub const fn is_major(&self) -> bool {
</span><span>         self.half_angle >= FRAC_PI_2
</span><span>     }
</span><span> }
</span><span style=color:#c594c5>@@ -322,51 +322,59 @@ </span><span style=color:#399ee6>impl Measured2d for CircularSector {
</span><span> impl CircularSector {
</span><span>     /// Create a new [`CircularSector`] from a `radius` and an `angle`
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn new(radius: f32, angle: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::new(radius, angle))
</span><span style=color:#86b300>+    pub const fn new(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::new(radius, angle),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Create a new [`CircularSector`] from a `radius` and an `angle` in radians.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_radians(radius: f32, angle: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::from_radians(radius, angle))
</span><span style=color:#86b300>+    pub const fn from_radians(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::from_radians(radius, angle),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Create a new [`CircularSector`] from a `radius` and an `angle` in degrees.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_degrees(radius: f32, angle: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::from_degrees(radius, angle))
</span><span style=color:#86b300>+    pub const fn from_degrees(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::from_degrees(radius, angle),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Create a new [`CircularSector`] from a `radius` and a number of `turns` of a circle.
</span><span>     ///
</span><span>     /// For instance, `0.5` turns is a semicircle.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_turns(radius: f32, fraction: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::from_turns(radius, fraction))
</span><span style=color:#86b300>+    pub const fn from_turns(radius: f32, fraction: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::from_turns(radius, fraction),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Get half the angle of the sector
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn half_angle(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn half_angle(&self) -> f32 {
</span><span>         self.arc.half_angle
</span><span>     }
</span><span> 
</span><span>     /// Get the angle of the sector
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn angle(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn angle(&self) -> f32 {
</span><span>         self.arc.angle()
</span><span>     }
</span><span> 
</span><span>     /// Get the radius of the sector
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn radius(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn radius(&self) -> f32 {
</span><span>         self.arc.radius
</span><span>     }
</span><span> 
</span><span>     /// Get the length of the arc defining the sector
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn arc_length(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn arc_length(&self) -> f32 {
</span><span>         self.arc.length()
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -462,51 +470,59 @@ </span><span style=color:#399ee6>impl Measured2d for CircularSegment {
</span><span> impl CircularSegment {
</span><span>     /// Create a new [`CircularSegment`] from a `radius`, and an `angle`
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn new(radius: f32, angle: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::new(radius, angle))
</span><span style=color:#86b300>+    pub const fn new(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::new(radius, angle),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Create a new [`CircularSegment`] from a `radius` and an `angle` in radians.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_radians(radius: f32, angle: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::from_radians(radius, angle))
</span><span style=color:#86b300>+    pub const fn from_radians(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::from_radians(radius, angle),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Create a new [`CircularSegment`] from a `radius` and an `angle` in degrees.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_degrees(radius: f32, angle: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::from_degrees(radius, angle))
</span><span style=color:#86b300>+    pub const fn from_degrees(radius: f32, angle: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::from_degrees(radius, angle),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Create a new [`CircularSegment`] from a `radius` and a number of `turns` of a circle.
</span><span>     ///
</span><span>     /// For instance, `0.5` turns is a semicircle.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_turns(radius: f32, fraction: f32) -> Self {
</span><span style=color:#f07171>-        Self::from(Arc2d::from_turns(radius, fraction))
</span><span style=color:#86b300>+    pub const fn from_turns(radius: f32, fraction: f32) -> Self {
</span><span style=color:#86b300>+        Self {
</span><span style=color:#86b300>+            arc: Arc2d::from_turns(radius, fraction),
</span><span style=color:#86b300>+        }
</span><span>     }
</span><span> 
</span><span>     /// Get the half-angle of the segment
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn half_angle(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn half_angle(&self) -> f32 {
</span><span>         self.arc.half_angle
</span><span>     }
</span><span> 
</span><span>     /// Get the angle of the segment
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn angle(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn angle(&self) -> f32 {
</span><span>         self.arc.angle()
</span><span>     }
</span><span> 
</span><span>     /// Get the radius of the segment
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn radius(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn radius(&self) -> f32 {
</span><span>         self.arc.radius
</span><span>     }
</span><span> 
</span><span>     /// Get the length of the arc defining the segment
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn arc_length(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn arc_length(&self) -> f32 {
</span><span>         self.arc.length()
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -821,9 +837,9 @@ </span><span style=color:#399ee6>impl Ellipse {
</span><span>     ///
</span><span>     /// `size.x` is the diameter along the X axis, and `size.y` is the diameter along the Y axis.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_size(size: Vec2) -> Self {
</span><span style=color:#86b300>+    pub const fn from_size(size: Vec2) -> Self {
</span><span>         Self {
</span><span style=color:#f07171>-            half_size: size / 2.0,
</span><span style=color:#86b300>+            half_size: Vec2::new(size.x / 2.0, size.y / 2.0),
</span><span>         }
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -971,13 +987,13 @@ </span><span style=color:#399ee6>impl Annulus {
</span><span> 
</span><span>     /// Get the diameter of the annulus
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn diameter(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn diameter(&self) -> f32 {
</span><span>         self.outer_circle.diameter()
</span><span>     }
</span><span> 
</span><span>     /// Get the thickness of the annulus
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn thickness(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn thickness(&self) -> f32 {
</span><span>         self.outer_circle.radius - self.inner_circle.radius
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1059,7 +1075,7 @@ </span><span style=color:#399ee6>impl Default for Rhombus {
</span><span> impl Rhombus {
</span><span>     /// Create a new `Rhombus` from a vertical and horizontal diagonal sizes.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn new(horizontal_diagonal: f32, vertical_diagonal: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn new(horizontal_diagonal: f32, vertical_diagonal: f32) -> Self {
</span><span>         Self {
</span><span>             half_diagonals: Vec2::new(horizontal_diagonal / 2.0, vertical_diagonal / 2.0),
</span><span>         }
</span><span style=color:#c594c5>@@ -1067,7 +1083,7 @@ </span><span style=color:#399ee6>impl Rhombus {
</span><span> 
</span><span>     /// Create a new `Rhombus` from a side length with all inner angles equal.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_side(side: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn from_side(side: f32) -> Self {
</span><span>         Self {
</span><span>             half_diagonals: Vec2::splat(side * FRAC_1_SQRT_2),
</span><span>         }
</span><span style=color:#c594c5>@@ -1075,7 +1091,7 @@ </span><span style=color:#399ee6>impl Rhombus {
</span><span> 
</span><span>     /// Create a new `Rhombus` from a given inradius with all inner angles equal.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_inradius(inradius: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn from_inradius(inradius: f32) -> Self {
</span><span>         let half_diagonal = inradius * 2.0 / core::f32::consts::SQRT_2;
</span><span>         Self {
</span><span>             half_diagonals: Vec2::new(half_diagonal, half_diagonal),
</span><span style=color:#c594c5>@@ -1091,7 +1107,7 @@ </span><span style=color:#399ee6>impl Rhombus {
</span><span>     /// Get the radius of the circumcircle on which all vertices
</span><span>     /// of the rhombus lie
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn circumradius(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn circumradius(&self) -> f32 {
</span><span>         self.half_diagonals.x.max(self.half_diagonals.y)
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1299,13 +1315,13 @@ </span><span style=color:#399ee6>impl Segment2d {
</span><span> 
</span><span>     /// Get the position of the first endpoint of the line segment.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn point1(&self) -> Vec2 {
</span><span style=color:#86b300>+    pub const fn point1(&self) -> Vec2 {
</span><span>         self.vertices[0]
</span><span>     }
</span><span> 
</span><span>     /// Get the position of the second endpoint of the line segment.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn point2(&self) -> Vec2 {
</span><span style=color:#86b300>+    pub const fn point2(&self) -> Vec2 {
</span><span>         self.vertices[1]
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1803,15 +1819,15 @@ </span><span style=color:#399ee6>impl Default for Rectangle {
</span><span> impl Rectangle {
</span><span>     /// Create a new `Rectangle` from a full width and height
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn new(width: f32, height: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn new(width: f32, height: f32) -> Self {
</span><span>         Self::from_size(Vec2::new(width, height))
</span><span>     }
</span><span> 
</span><span>     /// Create a new `Rectangle` from a given full size
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_size(size: Vec2) -> Self {
</span><span style=color:#86b300>+    pub const fn from_size(size: Vec2) -> Self {
</span><span>         Self {
</span><span style=color:#f07171>-            half_size: size / 2.0,
</span><span style=color:#86b300>+            half_size: Vec2::new(size.x / 2.0, size.y / 2.0),
</span><span>         }
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1826,7 +1842,7 @@ </span><span style=color:#399ee6>impl Rectangle {
</span><span>     /// Create a `Rectangle` from a single length.
</span><span>     /// The resulting `Rectangle` will be the same size in every direction.
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn from_length(length: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn from_length(length: f32) -> Self {
</span><span>         Self {
</span><span>             half_size: Vec2::splat(length / 2.0),
</span><span>         }
</span><span style=color:#c594c5>@@ -2045,7 +2061,7 @@ </span><span style=color:#399ee6>impl RegularPolygon {
</span><span>     ///
</span><span>     /// Panics if `circumradius` is negative
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn new(circumradius: f32, sides: u32) -> Self {
</span><span style=color:#86b300>+    pub const fn new(circumradius: f32, sides: u32) -> Self {
</span><span>         assert!(
</span><span>             circumradius.is_sign_positive(),
</span><span>             "polygon has a negative radius"
</span><span style=color:#c594c5>@@ -2063,7 +2079,7 @@ </span><span style=color:#399ee6>impl RegularPolygon {
</span><span>     /// Get the radius of the circumcircle on which all vertices
</span><span>     /// of the regular polygon lie
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn circumradius(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn circumradius(&self) -> f32 {
</span><span>         self.circumcircle.radius
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -2087,7 +2103,7 @@ </span><span style=color:#399ee6>impl RegularPolygon {
</span><span>     /// This is the angle formed by two adjacent sides with points
</span><span>     /// within the angle being in the interior of the polygon
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn internal_angle_degrees(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn internal_angle_degrees(&self) -> f32 {
</span><span>         (self.sides - 2) as f32 / self.sides as f32 * 180.0
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -2096,7 +2112,7 @@ </span><span style=color:#399ee6>impl RegularPolygon {
</span><span>     /// This is the angle formed by two adjacent sides with points
</span><span>     /// within the angle being in the interior of the polygon
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn internal_angle_radians(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn internal_angle_radians(&self) -> f32 {
</span><span>         (self.sides - 2) as f32 * PI / self.sides as f32
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -2105,7 +2121,7 @@ </span><span style=color:#399ee6>impl RegularPolygon {
</span><span>     /// This is the angle formed by two adjacent sides with points
</span><span>     /// within the angle being in the exterior of the polygon
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn external_angle_degrees(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn external_angle_degrees(&self) -> f32 {
</span><span>         360.0 / self.sides as f32
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -2114,7 +2130,7 @@ </span><span style=color:#399ee6>impl RegularPolygon {
</span><span>     /// This is the angle formed by two adjacent sides with points
</span><span>     /// within the angle being in the exterior of the polygon
</span><span>     #[inline(always)]
</span><span style=color:#f07171>-    pub fn external_angle_radians(&self) -> f32 {
</span><span style=color:#86b300>+    pub const fn external_angle_radians(&self) -> f32 {
</span><span>         2.0 * PI / self.sides as f32
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -2188,7 +2204,7 @@ </span><span style=color:#399ee6>impl Default for Capsule2d {
</span><span> 
</span><span> impl Capsule2d {
</span><span>     /// Create a new `Capsule2d` from a radius and length
</span><span style=color:#f07171>-    pub fn new(radius: f32, length: f32) -> Self {
</span><span style=color:#86b300>+    pub const fn new(radius: f32, length: f32) -> Self {
</span><span>         Self {
</span><span>             radius,
</span><span>             half_length: length / 2.0,
</span><span style=color:#c594c5>@@ -2197,7 +2213,7 @@ </span><span style=color:#399ee6>impl Capsule2d {
</span><span> 
</span><span>     /// Get the part connecting the semicircular ends of the capsule as a [`Rectangle`]
</span><span>     #[inline]
</span><span style=color:#f07171>-    pub fn to_inner_rectangle(&self) -> Rectangle {
</span><span style=color:#86b300>+    pub const fn to_inner_rectangle(&self) -> Rectangle {
</span><span>         Rectangle::new(self.radius * 2.0, self.half_length * 2.0)
</span><span>     }
</span><span> }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20732.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>