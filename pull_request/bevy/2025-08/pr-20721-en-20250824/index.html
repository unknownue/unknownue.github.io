<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20721 Re-enable the workspace wide dead_code lint
        
    </title><meta content="#20721 Re-enable the workspace wide dead_code lint" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20721-zh-cn-20250824>中文</a></div></div><div class=pr-content><h1 id=re-enable-the-workspace-wide-dead-code-lint>Re-enable the workspace wide dead_code lint</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Re-enable the workspace wide dead_code lint<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20721<li><strong>Author</strong>: james7132<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-08-23T01:09:59Z<li><strong>Merged</strong>: 2025-08-24T21:11:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>The <code>dead_code</code> lint was disabled in #20462 due to the encase errors, but that should be fixed as of #18047.<h2 id=solution>Solution</h2><p>Re-enabled the lint.<h2 id=testing>Testing</h2><p>Ran <code>cargo check --workspace --all-features</code> locally.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a temporary workaround that was implemented in PR #20462, where the <code>dead_code</code> lint was disabled across the entire Bevy workspace due to false positive warnings generated by the <code>encase</code> crate’s macros. These macros were producing code that appeared unused to the Rust compiler but was actually essential for the shader type system.<p>With the fix in PR #18047 resolving the underlying <code>encase</code> issues, this PR removes the temporary allowance and re-enables the <code>dead_code</code> lint. This restoration helps maintain code quality by identifying truly unused code while avoiding the previous false positives.<p>The implementation involved two main changes:<ol><li><p><strong>Removing the global allowance</strong>: The <code>dead_code = "allow"</code> entries were removed from both the workspace and package lint configurations in <code>Cargo.toml</code>, restoring the lint to its default behavior.</p><li><p><strong>Targeted suppressions</strong>: Several test structs used exclusively for derive macro compilation tests were annotated with <code>#[expect(dead_code)]</code> attributes. These structs are intentionally never constructed but must exist to verify that the derive macros compile correctly. The attributes suppress warnings for these specific cases while maintaining the lint’s effectiveness elsewhere.</p></ol><p>The changes also included some minor cleanup:<ul><li>Removal of an unused error variant in <code>raw_vulkan_init.rs</code><li>Removal of an unused component in test code<li>Consistency improvements in expect attribute formatting</ul><p>This approach balances code quality maintenance with practical considerations for test code, ensuring the lint catches actual dead code without generating noise for intentional test patterns.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Cargo.toml - Remove dead_code allow] --> B[bevy_app - Add expect dead_code]
</span><span>    A --> C[bevy_asset - Add expect dead_code]
</span><span>    A --> D[bevy_ecs - Add expect dead_code]
</span><span>    A --> E[bevy_render - Add expect dead_code]
</span><span>    A --> F[bevy_state - Add expect dead_code]
</span><span>    A --> G[bevy_ecs/schedule/set - Add expect dead_code]
</span><span>    A --> H[bevy_ecs/world/entity_ref - Remove unused component]
</span><span>    A --> I[bevy_render/raw_vulkan_init - Remove unused error variant]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=cargo-toml-0-4><code>Cargo.toml</code> (+0/-4)</h3><p>Removed the temporary allowance for dead_code lint that was added as a workaround for encase issues.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>lints</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>rust</span><span>]
</span><span style=color:#abb0b6;font-style:italic># Strictly temporary until encase fixes dead code generation from ShaderType macros
</span><span style=color:#399ee6>dead_code </span><span>= </span><span style=color:#86b300>"allow"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>lints</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>rust</span><span>]
</span><span style=color:#399ee6>missing_docs </span><span>= </span><span style=color:#86b300>"warn"
</span></code></pre><h3 id=crates-bevy-ecs-src-lib-rs-32-4><code>crates/bevy_ecs/src/lib.rs</code> (+32/-4)</h3><p>Added expect attributes to test structs used for derive macro compilation tests and removed an unused field attribute.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Bundle)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Tuple</span><span>(Simple, ComponentB)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>expect</span><span>(
</span><span>    dead_code</span><span style=color:#61676ccc>,
</span><span>    reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"This struct is used as a compilation test to test the derive macros, and as such is intentionally never constructed."
</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Bundle)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Tuple</span><span>(Simple, ComponentB)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-app-src-app-rs-8-0><code>crates/bevy_app/src/app.rs</code> (+8/-0)</h3><p>Added expect attributes to test label structs used for derive macro compilation.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>expect</span><span>(
</span><span>    dead_code</span><span style=color:#61676ccc>,
</span><span>    reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"This struct is used as a compilation test to test the derive macros, and as such is intentionally never constructed."
</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(AppLabel</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> Hash)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>EmptyTupleLabel</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-asset-src-lib-rs-8-0><code>crates/bevy_asset/src/lib.rs</code> (+8/-0)</h3><p>Added expect attributes to test asset structs used for derive macro compilation.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>expect</span><span>(
</span><span>    dead_code</span><span style=color:#61676ccc>,
</span><span>    reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"This struct is used as a compilation test to test the derive macros, and as such is intentionally never constructed."
</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Asset</span><span style=color:#61676ccc>,</span><span> TypePath)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>StructTestAsset </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>dependency</span><span>]
</span><span>    field</span><span style=color:#61676ccc>: </span><span>Handle&LTTestAsset>,
</span><span>    embedded</span><span style=color:#61676ccc>:</span><span> TestAsset,
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-schedule-set-rs-16-0><code>crates/bevy_ecs/src/schedule/set.rs</code> (+16/-0)</h3><p>Added expect attributes to test label and set structs used for derive macro compilation.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>expect</span><span>(
</span><span>    dead_code</span><span style=color:#61676ccc>,
</span><span>    reason </span><span style=color:#ed9366>= </span><span style=color:#86b300>"This is a derive macro compilation test. It won't be constructed."
</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(ScheduleLabel</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> Hash)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>EmptyTupleLabel</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustc/lints/levels.html target=_blank>Rust Lint Attributes</a> - Official documentation on Rust’s lint system<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch09-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait target=_blank>The Rust Programming Language - Unused Code</a> - Understanding dead code detection in Rust<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/CONTRIBUTING.md target=_blank>Bevy’s Contribution Guidelines</a> - Best practices for contributing to Bevy<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/18047 target=_blank>PR #18047</a> - The fix that resolved the encase issues<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20462 target=_blank>PR #20462</a> - The original PR that temporarily disabled the lint</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20721.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>