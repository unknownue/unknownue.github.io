<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20434 Add bevy_light::SunDisk
        
    </title><meta content="#20434 Add bevy_light::SunDisk" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>‚Üê Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20434-zh-cn-20250816>‰∏≠Êñá</a></div></div><div class=pr-content><h1 id=analysis-of-pr-20434-add-bevy-light-sundisk>Analysis of PR #20434: Add bevy_light::SunDisk</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add bevy_light::SunDisk<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20434<li><strong>Author</strong>: defuz<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Usability, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-08-05T21:58:56Z<li><strong>Merged</strong>: 2025-08-16T22:31:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes <strong>#20425</strong> (GI probes capture the sun disk while a <code>DirectionalLight</code> also lights the scene, so we need a way to skip the disk during probe baking).<li><del><strong>Add <code>sun_disk_intensity: f32</code> to <code>AtmosphereSettings</code></strong> so you can smoothly hide, dim, or over‚Äëbrighten the sun disk without affecting the visible illumination of scene objects, while still allowing the sun‚Äôs radiance to scatter into the atmosphere even when the disk itself is hidden.</del><li>Add a bevy_light::SunDisk component that acts as an add‚Äëon to DirectionalLight. https://github.com/bevyengine/bevy/pull/20434#issuecomment-3190804227</ul><h2 id=testing>Testing</h2><ul><li>Ran the official <code>atmosphere</code> example on a MacBook‚ÄØM1 (see showcase below).<li>Toggled bloom on/off and tried intensities 0, 0.01, 1, and 10 ‚Äî the sky looks correct and no warnings appear.<li>Noticed a small dark ‚Äúhole‚Äù in the center of the sun disk under some settings; this artifact was present before these changes (often hidden by bloom) and probably deserves further investigation. (FIXED IN THIS PR)</ul><p>I‚Äôm new to WGSL/shader code ‚Äî please point out anything silly! üôÇ<hr><h2 id=showcase>Showcase</h2><ul><li>Scene brightness changes with intensity only because bloom amplifies the bright disk; sky illumination stays unchanged.<li>With bloom disabled, the disk is the only thing that changes ‚Äî the rest of the scene looks identical.<li>Raising intensity above 1.0 doesn‚Äôt affect the scene without bloom (the disk is already 100‚ÄØ% white) but boosts the bloom halo when bloom is enabled.<li>Lowering intensity reduces the bloom halo; drop it far enough and the disk blends into the sky, which is physically plausible for very dim suns.</ul><details><summary><strong>1.0</strong> (bloom on) ‚Äî normal</summary> <img alt="default 1 0" height=1050 src=https://github.com/user-attachments/assets/89144e52-1159-42c6-9325-f80f986349ec width=1680></details><details><summary><strong>0.0</strong> (bloom on) ‚Äî no disk</summary> <img alt="no sun 0 0" height=1050 src=https://github.com/user-attachments/assets/2b3842ae-26ed-45bf-9266-20189bc487a7 width=1680></details><details><summary><strong>0.01</strong> (bloom on) ‚Äî low brightness, tiny bloom effect</summary> <img alt="0 21" height=1050 src=https://github.com/user-attachments/assets/8c3943df-74b6-4422-8c9b-061e56ee33f8 width=1680></details><details><summary><strong>0.00001</strong> (bloom on) ‚Äî disk blends into the sky</summary> <img alt="0 00001" height=1050 src=https://github.com/user-attachments/assets/e1228131-41b2-4f30-b50d-ebceebc8cabb width=1680></details><details><summary><strong>10.0</strong> (bloom on) ‚Äî blinding glare</summary> <img alt=10 height=1050 src=https://github.com/user-attachments/assets/3527c6d6-27ec-4e6f-9e9f-564a6b246bba width=1680></details><details><summary><strong>1.0</strong> (bloom off) ‚Äî normal sun with no bloom</summary> <img alt="1 no bloom" height=1050 src=https://github.com/user-attachments/assets/b62ce660-cb65-46b1-b211-a5d330b08719 width=1680></details><details><summary><strong>10.0</strong> (bloom off) ‚Äî indistinguishable from 1.0 when bloom is off</summary> <img alt="10 no bloom" height=1050 src=https://github.com/user-attachments/assets/17ea20dd-3de7-4bb9-82a1-16f7df9a9994 width=1680></details><p>Quick question for reviewers: (not part of this PR) I‚Äôve already experimented with parameterizing the <strong>sun angular size</strong> and it works well. It could serve as a cool artistic control or let you match skies for planets that aren‚Äôt Earth. Would folks be interested in a follow‚Äëup PR?<details><summary>4√ó sun size</summary> <img alt="4x sun" height=1050 src=https://github.com/user-attachments/assets/5c39ef98-0376-48b7-b845-bfad6d87c09b width=1680></details><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses issue #20425 where Global Illumination (GI) probes were capturing the sun disk while a DirectionalLight simultaneously illuminated the scene. This double contribution caused incorrect lighting. The solution required decoupling the sun disk‚Äôs visual representation from its lighting contribution, enabling selective exclusion during probe baking.<p>The original approach considered adding a <code>sun_disk_intensity</code> field to <code>AtmosphereSettings</code>. However, based on feedback, the implementation shifted to a more flexible component-based design. The final solution introduces a new <code>SunDisk</code> component that attaches to <code>DirectionalLight</code> entities. This separation allows independent control of the sun disk‚Äôs appearance without affecting the light‚Äôs illuminance.<p>The implementation centers on three key changes:<ol><li><strong>New SunDisk Component</strong>: Added to the <code>bevy_light</code> crate, this component contains <code>angular_size</code> and <code>intensity</code> parameters. It defaults to Earth-like values but can be disabled completely using <code>SunDisk::OFF</code>. This solves the GI probe issue by allowing the disk to be hidden while preserving atmospheric scattering.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_light/src/directional_light.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>require</span><span>(DirectionalLight)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SunDisk </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>angular_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>intensity</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>SunDisk </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>EARTH</span><span style=color:#61676ccc>:</span><span> SunDisk </span><span style=color:#ed9366>=</span><span> SunDisk {
</span><span>        angular_size</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.00930842</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// ~32 arcminutes
</span><span>        intensity</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>OFF</span><span style=color:#61676ccc>:</span><span> SunDisk </span><span style=color:#ed9366>=</span><span> SunDisk {
</span><span>        angular_size</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,
</span><span>        intensity</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=2><li><strong>Shader Modifications</strong>: The atmosphere shader in <code>functions.wgsl</code> was refactored to use the new component‚Äôs data. The previous hardcoded sun size was replaced with dynamic values from the directional light. The shader now: <ul><li>Uses smoothstep with derivative-based anti-aliasing for cleaner edges<li>Properly clamps the dot product to avoid NaN values<li>Calculates solid angle using physically based formulas<li>Conditionally skips rendering when intensity is zero</ul></ol><pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// crates/bevy_pbr/src/atmosphere/functions.wgsl
</span><span>fn sample_sun_radiance(ray_dir_ws: vec3&LTf32>) -> vec3&LTf32> {
</span><span>    // ...
</span><span>    let sun_angular_size = (*light).sun_disk_angular_size;
</span><span>    let sun_intensity = (*light).sun_disk_intensity;
</span><span>    if sun_angular_size > 0.0 && sun_intensity > 0.0 {
</span><span>        let factor = 1 - smoothstep(sun_angular_size * 0.5 - w, 
</span><span>                                   sun_angular_size * 0.5 + w, 
</span><span>                                   angle_to_sun);
</span><span>        let sun_solid_angle = (sun_angular_size * sun_angular_size) * 0.25 * PI;
</span><span>        sun_radiance += ((*light).color.rgb / sun_solid_angle) * sun_intensity * factor * shadow_factor;
</span><span>    }
</span><span>    // ...
</span><span>}
</span></code></pre><ol start=3><li><strong>Rendering Pipeline Integration</strong>: The directional light extraction and preparation systems were extended to include the sun disk parameters. The <code>ExtractedDirectionalLight</code> and <code>GpuDirectionalLight</code> structs gained new fields to transport the data to the GPU:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_pbr/src/render/light.rs
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ExtractedDirectionalLight </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>pub </span><span>sun_disk_angular_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>sun_disk_intensity</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GpuDirectionalLight </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>pub </span><span>sun_disk_angular_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>sun_disk_intensity</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>}
</span></code></pre><p>The shader struct in <code>mesh_view_types.wgsl</code> was updated to match:<pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>struct DirectionalLight {
</span><span>    // ...
</span><span>    sun_disk_angular_size: f32,
</span><span>    sun_disk_intensity: f32,
</span><span>};
</span></code></pre><p>These changes fixed a pre-existing rendering artifact (a dark center in the sun disk) by clamping the dot product and using proper smoothstep boundaries. The solution maintains backward compatibility through default Earth-like values when the component is absent.<p>The PR demonstrates good practice in maintaining separation between visual representation and physical lighting properties. It also shows how to extend Bevy‚Äôs lighting system with artist-controllable parameters without breaking existing functionality. The component-based approach offers flexibility for future extensions, like the proposed sun size parameterization.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[DirectionalLight] --> B[SunDisk Component]
</span><span>    B --> C{Extraction System}
</span><span>    C --> D[ExtractedDirectionalLight]
</span><span>    D --> E[Preparation System]
</span><span>    E --> F[GpuDirectionalLight]
</span><span>    F --> G[Atmosphere Shader]
</span><span>    G --> H[Sun Disk Rendering]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-light-src-directional-light-rs><code>crates/bevy_light/src/directional_light.rs</code></h3><p>Added the <code>SunDisk</code> component with Earth-like defaults and OFF preset. This provides the user-facing API for sun disk control.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// Add to a [`DirectionalLight`] to control rendering of the visible solar disk...
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>require</span><span>(DirectionalLight)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SunDisk </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>angular_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>intensity</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>SunDisk </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>EARTH</span><span style=color:#61676ccc>:</span><span> SunDisk </span><span style=color:#ed9366>=</span><span> SunDisk { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>OFF</span><span style=color:#61676ccc>:</span><span> SunDisk </span><span style=color:#ed9366>=</span><span> SunDisk { </span><span style=color:#ed9366>... </span><span>}</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=crates-bevy-pbr-src-atmosphere-functions-wgsl><code>crates/bevy_pbr/src/atmosphere/functions.wgsl</code></h3><p>Refactored sun disk rendering to use component-driven parameters instead of hardcoded values. Added anti-aliasing and NaN protection.<pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// Before:
</span><span>const SUN_ANGULAR_SIZE: f32 = 0.0174533;
</span><span>let angle_to_sun = fast_acos(neg_LdotV);
</span><span>// ...
</span><span>
</span><span>// After:
</span><span>let angle_to_sun = fast_acos(clamp(neg_LdotV, -1.0, 1.0));
</span><span>let w = max(0.5 * fwidth(angle_to_sun), 1e-6);
</span><span>let sun_angular_size = (*light).sun_disk_angular_size;
</span><span>let sun_intensity = (*light).sun_disk_intensity;
</span><span>if sun_angular_size > 0.0 && sun_intensity > 0.0 {
</span><span>    // ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-pbr-src-render-light-rs><code>crates/bevy_pbr/src/render/light.rs</code></h3><p>Extended light extraction and preparation to handle sun disk parameters.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added to ExtractedDirectionalLight
</span><span style=color:#fa6e32>pub</span><span> sun_disk_angular_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span style=color:#61676ccc>,
</span><span style=color:#fa6e32>pub</span><span> sun_disk_intensity</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In extraction system:
</span><span>sun_disk_angular_size</span><span style=color:#61676ccc>:</span><span> sun_disk</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or_default</span><span>()</span><span style=color:#ed9366>.</span><span>angular_size</span><span style=color:#61676ccc>,
</span><span>sun_disk_intensity</span><span style=color:#61676ccc>:</span><span> sun_disk</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or_default</span><span>()</span><span style=color:#ed9366>.</span><span>intensity</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added to GpuDirectionalLight
</span><span>sun_disk_angular_size</span><span style=color:#61676ccc>:</span><span> light</span><span style=color:#ed9366>.</span><span>sun_disk_angular_size</span><span style=color:#61676ccc>,
</span><span>sun_disk_intensity</span><span style=color:#61676ccc>:</span><span> light</span><span style=color:#ed9366>.</span><span>sun_disk_intensity</span><span style=color:#61676ccc>,
</span></code></pre><h3 id=crates-bevy-solari-src-scene-binder-rs><code>crates/bevy_solari/src/scene/binder.rs</code></h3><p>Updated to use component-driven sun size instead of hardcoded constant.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>SUN_ANGULAR_DIAMETER_RADIANS</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0.00930842</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> cos_theta_max </span><span style=color:#ed9366>= </span><span style=color:#f07171>cos</span><span>(</span><span style=color:#ff8f40>SUN_ANGULAR_DIAMETER_RADIANS </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> cos_theta_max </span><span style=color:#ed9366>= </span><span style=color:#f07171>cos</span><span>(directional_light</span><span style=color:#ed9366>.</span><span>sun_disk_angular_size </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>2.0</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-light-src-lib-rs><code>crates/bevy_light/src/lib.rs</code></h3><p>Exported the new component for public use.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub use </span><span>directional_light</span><span style=color:#ed9366>::</span><span>{ </span><span style=color:#ed9366>...</span><span style=color:#61676ccc>,</span><span> SunDisk }</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Angular_diameter target=_blank>Angular Diameter Concept</a> - Background on sun size calculation<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/pbr target=_blank>Bevy Lighting Documentation</a> - Bevy‚Äôs physical-based rendering<li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/wgsl/#smoothstep-builtin target=_blank>WGSL Smoothstep</a> - Shader interpolation function<li><a rel="noopener nofollow noreferrer" href=https://developer.nvidia.com/rtx/gi target=_blank>GI Probe Baking</a> - Global illumination fundamentals</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20434.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>