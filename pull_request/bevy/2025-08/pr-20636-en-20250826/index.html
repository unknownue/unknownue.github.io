<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20636 Disable button labels for the `many_buttons` stress test by default
        
    </title><meta content="#20636 Disable button labels for the `many_buttons` stress test by default" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-26</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20636-zh-cn-20250826>中文</a></div></div><div class=pr-content><h1 id=disable-button-labels-for-the-many-buttons-stress-test-by-default>Disable button labels for the <code>many_buttons</code> stress test by default</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Disable button labels for the <code>many_buttons</code> stress test by default<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20636<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-UI, S-Ready-For-Final-Review, C-Benchmarks, D-Straightforward, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2025-08-18T11:03:41Z<li><strong>Merged</strong>: 2025-08-26T03:26:48Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The <code>many_buttons</code> benchmark isn’t a good measure of UI performance because it’s dominated by the text layout and rendering for the button labels. The button labels should be disabled by default, we have other text specific stress tests.<h2 id=solution>Solution</h2><ol><li>Rename the <code>no_text</code> commandline parameter to <code>text</code>. The buttons are no longer shown by default, to run the example with labels you need to use:</ol><pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example many_buttons --release -- --text
</span></code></pre><ol start=2><li>Add a second button icon image, this is to break up the batches during rendering without text.<li>Spawn every button with an icon.</ol><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The <code>many_buttons</code> stress test was designed to benchmark UI performance under heavy load, but it had a fundamental measurement problem. The text rendering and layout operations for button labels were dominating the performance profile, making it difficult to isolate and measure pure UI rendering and layout performance. This PR addresses that issue by making several strategic changes to refocus the benchmark on core UI performance metrics.<p>The core problem was straightforward: text rendering is computationally expensive and was skewing the benchmark results. When developers ran <code>many_buttons</code> to test UI performance improvements, they were primarily measuring text performance rather than the UI system itself. The solution needed to maintain the stress test’s value while providing clearer separation between text and non-text performance measurements.<p>The implementation took a three-pronged approach. First, the command-line interface was reworked to make text rendering opt-in rather than opt-out. The <code>no_text</code> parameter was renamed to <code>text</code> and its logic inverted. This change makes the default behavior (no text) better aligned with the benchmark’s purpose of testing UI performance without text overhead:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>argh</span><span>(switch)]
</span><span>no_text</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:  
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>argh</span><span>(switch)]
</span><span>text</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span></code></pre><p>Second, to maintain rendering complexity without text, the PR adds a second icon image and ensures every button receives an icon. This prevents the renderer from batching all buttons into a single draw call, which would not represent real-world UI rendering patterns:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> image </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#ff8f40>0 </span><span style=color:#ed9366><</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"branding/icon.png"</span><span>))
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> images </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#ff8f40>0 </span><span style=color:#ed9366><</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#f07171>vec!</span><span>[
</span><span>        asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"branding/icon.png"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"textures/Game Icons/wrench.png"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    ])
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>Third, the image distribution logic was improved to use both images in a round-robin fashion based on button position, creating more realistic rendering batches:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>image</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>filter</span><span>(|_| (column </span><span style=color:#ed9366>+</span><span> row) </span><span style=color:#ed9366>%</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq </span><span style=color:#ed9366>== </span><span style=color:#ff8f40>0</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>cloned</span><span>()</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>images</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>images</span><span>| {
</span><span>    images[((column </span><span style=color:#ed9366>+</span><span> row) </span><span style=color:#ed9366>/</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq) </span><span style=color:#ed9366>%</span><span> images</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()]</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()
</span><span>})</span><span style=color:#61676ccc>,
</span></code></pre><p>These changes work together to create a more meaningful stress test. Without text by default, the benchmark now accurately measures UI layout and rendering performance. The addition of multiple icons maintains rendering complexity and prevents unrealistic batching optimizations. When text performance needs to be measured, developers can still use the <code>--text</code> flag to enable labels.<p>The impact is significant for Bevy’s benchmarking suite. UI performance improvements can now be measured more accurately, and the benchmark better represents real-world UI rendering scenarios. The changes also make the benchmark more flexible - teams can test pure UI performance, text performance, or both depending on their needs.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[many_buttons benchmark] --> B[Command-line arguments]
</span><span>    B --> C[Text rendering disabled by default]
</span><span>    B --> D[Multiple icons for better batching]
</span><span>    C --> E[Improved UI performance measurement]
</span><span>    D --> F[More realistic rendering patterns]
</span><span>    E --> G[Better benchmarking accuracy]
</span><span>    F --> G
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-stress-tests-many-buttons-rs-32-25><code>examples/stress_tests/many_buttons.rs</code> (+32/-25)</h3><p>This is the main stress test example that spawns large numbers of buttons to test UI performance. The changes focus on making text rendering optional and improving the rendering characteristics without text.<p><strong>Key changes:</strong><ol><li>Renamed and inverted the text parameter logic<li>Added support for multiple button icons<li>Modified image distribution logic</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before argument parsing:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>argh</span><span>(switch)]
</span><span>no_text</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After argument parsing:  
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>argh</span><span>(switch)]
</span><span>text</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before image loading:
</span><span style=color:#fa6e32>let</span><span> image </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#ff8f40>0 </span><span style=color:#ed9366><</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"branding/icon.png"</span><span>))
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After image loading:
</span><span style=color:#fa6e32>let</span><span> images </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if </span><span style=color:#ff8f40>0 </span><span style=color:#ed9366><</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#f07171>vec!</span><span>[
</span><span>        asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"branding/icon.png"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"textures/Game Icons/wrench.png"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    ])
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before image assignment:
</span><span>image</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>filter</span><span>(|_| (column </span><span style=color:#ed9366>+</span><span> row) </span><span style=color:#ed9366>%</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq </span><span style=color:#ed9366>== </span><span style=color:#ff8f40>0</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>cloned</span><span>()</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After image assignment:
</span><span>images</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>images</span><span>| {
</span><span>    images[((column </span><span style=color:#ed9366>+</span><span> row) </span><span style=color:#ed9366>/</span><span> args</span><span style=color:#ed9366>.</span><span>image_freq) </span><span style=color:#ed9366>%</span><span> images</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()]</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()
</span><span>})</span><span style=color:#61676ccc>,
</span></code></pre><p>These changes ensure the benchmark provides more accurate UI performance measurements by default while maintaining the ability to test text rendering when needed.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ui/ target=_blank>Bevy UI System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/benchmarking/ target=_blank>Bevy Benchmarking Guide</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/text-rendering/ target=_blank>Text Rendering Performance Considerations</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/rendering/ui-batching target=_blank>UI Batching and Draw Call Optimization</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20636.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>