<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20448 Add VERBOSE_SHADER_ERROR
        
    </title><meta content="#20448 Add VERBOSE_SHADER_ERROR" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20448-zh-cn-20250809>中文</a></div></div><div class=pr-content><h1 id=pr-analysis-add-verbose-shader-error>PR Analysis: Add VERBOSE_SHADER_ERROR</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add VERBOSE_SHADER_ERROR<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20448<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, S-Ready-For-Final-Review, A-Diagnostics<li><strong>Created</strong>: 2025-08-07T02:11:38Z<li><strong>Merged</strong>: 2025-08-09T06:43:31Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Make it easier to debug shader def problems in shader libraries</ul><h2 id=solution>Solution</h2><ul><li>print context of where the shader module’s entry point is and what the shader defs are</ul><h2 id=testing>Testing</h2><ul><li>intentionally broke a shader and ran 3d_scene, logs are added when env var is set. <img alt={9D77F6EF-9813-4C18-90A9-51E81388D681} height=259 src=https://github.com/user-attachments/assets/7ae42479-e548-40bf-8d26-ee61bab7c279 width=917></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Debugging shader compilation errors in Bevy can be challenging when working with complex shader libraries. When shader processing fails, the error messages lacked sufficient context about which specific shader module and shader definitions were involved. This made it difficult to pinpoint the root cause of failures, especially in projects with multiple shaders and conditional compilation via shader defs. The existing error logging provided the technical error details but didn’t surface the critical context needed to map errors back to specific shader assets and their configurations.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution introduces an opt-in verbose error reporting mechanism controlled by an environment variable. When <code>VERBOSE_SHADER_ERROR</code> is enabled, the system will log additional contextual information about the shader module when processing errors occur. The implementation needed to:<ol><li>Add environment variable checking with flexible truthy values<li>Collect relevant shader context data (source path, entry point, shader defs)<li>Format this information for both render and compute pipelines<li>Integrate this context logging into the existing error handling flow</ol><p>The approach maintains zero overhead for normal operation since the context collection only executes when the environment variable is set and a shader error occurs.<h3 id=the-implementation>The Implementation</h3><p>The core changes are in the pipeline error handling logic and the new context formatting function:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In process_pipeline_queue_system error handling:
</span><span style=color:#fa6e32>if </span><span>std</span><span style=color:#ed9366>::</span><span>env</span><span style=color:#ed9366>::</span><span>var(</span><span style=color:#86b300>"VERBOSE_SHADER_ERROR"</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ok_and</span><span>(|</span><span style=color:#ff8f40>v</span><span>| </span><span style=color:#ed9366>!</span><span>(v</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_empty</span><span>() </span><span style=color:#ed9366>||</span><span> v </span><span style=color:#ed9366>== </span><span style=color:#86b300>"0" </span><span style=color:#ed9366>||</span><span> v </span><span style=color:#ed9366>== </span><span style=color:#86b300>"false"</span><span>))
</span><span>{
</span><span>    </span><span style=color:#f07171>error!</span><span>(</span><span style=color:#86b300>"{}"</span><span style=color:#61676ccc>, </span><span style=color:#f07171>pipeline_error_context</span><span>(cached_pipeline))</span><span style=color:#61676ccc>;
</span><span>}
</span><span style=color:#f07171>error!</span><span>(</span><span style=color:#86b300>"failed to process shader error:</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>{}"</span><span style=color:#61676ccc>,</span><span> error_detail)</span><span style=color:#61676ccc>;
</span></code></pre><p>The new <code>pipeline_error_context</code> function handles the contextual data formatting:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>pipeline_error_context</span><span>(</span><span style=color:#ff8f40>cached_pipeline</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>CachedPipeline) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>format</span><span>(
</span><span>        </span><span style=color:#ff8f40>shader</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Handle&LTShader>,
</span><span>        </span><span style=color:#ff8f40>entry</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTCow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>>,
</span><span>        </span><span style=color:#ff8f40>shader_defs</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[ShaderDefVal],
</span><span>    ) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>        </span><span style=color:#fa6e32>let</span><span> source </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>match</span><span> shader</span><span style=color:#ed9366>.</span><span style=color:#f07171>path</span><span>() {
</span><span>            </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(path) </span><span style=color:#ed9366>=></span><span> path</span><span style=color:#ed9366>.</span><span style=color:#f07171>path</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string_lossy</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>()</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#55b4d4;font-style:italic>None </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>,
</span><span>        }</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> entry </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>match</span><span> entry {
</span><span>            </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(entry) </span><span style=color:#ed9366>=></span><span> entry</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>()</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#55b4d4;font-style:italic>None </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>,
</span><span>        }</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> shader_defs </span><span style=color:#ed9366>=</span><span> shader_defs
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>flat_map</span><span>(|</span><span style=color:#ff8f40>def</span><span>| </span><span style=color:#fa6e32>match</span><span> def {
</span><span>                ShaderDefVal</span><span style=color:#ed9366>::</span><span>Bool(k</span><span style=color:#61676ccc>,</span><span> v) </span><span style=color:#fa6e32>if </span><span style=color:#ed9366>*</span><span>v </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(k</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>())</span><span style=color:#61676ccc>,
</span><span>                ShaderDefVal</span><span style=color:#ed9366>::</span><span>Int(k</span><span style=color:#61676ccc>,</span><span> v) </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{k}</span><span style=color:#86b300> = </span><span style=color:#ff8f40>{v}</span><span style=color:#86b300>"</span><span>))</span><span style=color:#61676ccc>,
</span><span>                ShaderDefVal</span><span style=color:#ed9366>::</span><span>UInt(k</span><span style=color:#61676ccc>,</span><span> v) </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{k}</span><span style=color:#86b300> = </span><span style=color:#ff8f40>{v}</span><span style=color:#86b300>"</span><span>))</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#ed9366>_ => </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>,
</span><span>            })
</span><span>            </span><span style=color:#ed9366>.</span><span>collect</span><span style=color:#ed9366>::</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#ed9366>_</span><span>>>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>join</span><span>(</span><span style=color:#86b300>", "</span><span>)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{source}</span><span style=color:#86b300>:</span><span style=color:#ff8f40>{entry}</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>shader defs: </span><span style=color:#ff8f40>{shader_defs}</span><span style=color:#86b300>"</span><span>)
</span><span>    }
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#ed9366>&</span><span>cached_pipeline</span><span style=color:#ed9366>.</span><span>descriptor {
</span><span>        PipelineDescriptor</span><span style=color:#ed9366>::</span><span>RenderPipelineDescriptor(desc) </span><span style=color:#ed9366>=> </span><span>{
</span><span>            </span><span style=color:#fa6e32>let</span><span> vert </span><span style=color:#ed9366>= &</span><span>desc</span><span style=color:#ed9366>.</span><span>vertex</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>let</span><span> vert_str </span><span style=color:#ed9366>= </span><span style=color:#f07171>format</span><span>(</span><span style=color:#ed9366>&</span><span>vert</span><span style=color:#ed9366>.</span><span>shader</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>vert</span><span style=color:#ed9366>.</span><span>entry_point</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>vert</span><span style=color:#ed9366>.</span><span>shader_defs)</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(frag) </span><span style=color:#ed9366>=</span><span> desc</span><span style=color:#ed9366>.</span><span>fragment</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>() </span><span style=color:#fa6e32>else </span><span>{
</span><span>                </span><span style=color:#fa6e32>return</span><span> vert_str</span><span style=color:#61676ccc>;
</span><span>            }</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>let</span><span> frag_str </span><span style=color:#ed9366>= </span><span style=color:#f07171>format</span><span>(</span><span style=color:#ed9366>&</span><span>frag</span><span style=color:#ed9366>.</span><span>shader</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>frag</span><span style=color:#ed9366>.</span><span>entry_point</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>frag</span><span style=color:#ed9366>.</span><span>shader_defs)</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"vertex </span><span style=color:#ff8f40>{vert_str}</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>fragment </span><span style=color:#ff8f40>{frag_str}</span><span style=color:#86b300>"</span><span>)
</span><span>        }
</span><span>        PipelineDescriptor</span><span style=color:#ed9366>::</span><span>ComputePipelineDescriptor(desc) </span><span style=color:#ed9366>=> </span><span>{
</span><span>            </span><span style=color:#f07171>format</span><span>(</span><span style=color:#ed9366>&</span><span>desc</span><span style=color:#ed9366>.</span><span>shader</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>desc</span><span style=color:#ed9366>.</span><span>entry_point</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>desc</span><span style=color:#ed9366>.</span><span>shader_defs)
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The implementation handles both render pipelines (vertex/fragment shaders) and compute pipelines. For shader definitions, it:<ul><li>Includes boolean definitions only when true<li>Formats numeric definitions as key-value pairs<li>Omits unused definition variants</ul><h3 id=technical-insights>Technical Insights</h3><p>Key technical aspects include:<ol><li><strong>Environment Variable Handling</strong>: The condition <code>! (v.is_empty() || v == "0" || v == "false")</code> follows common truthy-check patterns, supporting values like “1”, “true”, or any non-empty string.<li><strong>Shader Definition Filtering</strong>: By omitting false boolean flags and unused definition types, the output remains focused on relevant configuration.<li><strong>Pipeline Type Handling</strong>: The match statement cleanly separates rendering and compute pipeline contexts.<li><strong>Path Extraction</strong>: Using <code>shader.path()</code> provides asset source information when available.<li><strong>Error Message Clarity</strong>: The log message was updated to “failed to process shader error” for better accuracy.</ol><h3 id=the-impact>The Impact</h3><p>This change significantly improves shader debugging workflow:<ul><li>Developers can immediately see which shader asset and entry point caused the failure<li>Active shader definitions are clearly listed, helping identify missing or incorrect feature flags<li>The opt-in nature ensures no performance impact for normal operation<li>Debugging time for shader issues is reduced by providing immediate context</ul><p>The solution addresses a specific pain point in the shader development workflow with minimal code changes and no runtime overhead when not enabled.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Shader Processing Error] --> B{VERBOSE_SHADER_ERROR set?}
</span><span>    B -->|Yes| C[Collect Shader Context]
</span><span>    B -->|No| D[Standard Error Log]
</span><span>    C --> E[Format Pipeline Context]
</span><span>    E --> F[Log Context + Error]
</span><span>    D --> G[Log Error Only]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-src-render-resource-pipeline-cache-rs><code>crates/bevy_render/src/render_resource/pipeline_cache.rs</code></h3><p>This file handles pipeline compilation and caching. The changes enhance error reporting when shader processing fails.<p><strong>Key modifications:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before error handling:
</span><span style=color:#f07171>error!</span><span>(</span><span style=color:#86b300>"failed to process shader:</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>{}"</span><span style=color:#61676ccc>,</span><span> error_detail)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After error handling:
</span><span style=color:#fa6e32>if </span><span>std</span><span style=color:#ed9366>::</span><span>env</span><span style=color:#ed9366>::</span><span>var(</span><span style=color:#86b300>"VERBOSE_SHADER_ERROR"</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ok_and</span><span>(|</span><span style=color:#ff8f40>v</span><span>| </span><span style=color:#ed9366>!</span><span>(v</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_empty</span><span>() </span><span style=color:#ed9366>||</span><span> v </span><span style=color:#ed9366>== </span><span style=color:#86b300>"0" </span><span style=color:#ed9366>||</span><span> v </span><span style=color:#ed9366>== </span><span style=color:#86b300>"false"</span><span>))
</span><span>{
</span><span>    </span><span style=color:#f07171>error!</span><span>(</span><span style=color:#86b300>"{}"</span><span style=color:#61676ccc>, </span><span style=color:#f07171>pipeline_error_context</span><span>(cached_pipeline))</span><span style=color:#61676ccc>;
</span><span>}
</span><span style=color:#f07171>error!</span><span>(</span><span style=color:#86b300>"failed to process shader error:</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>{}"</span><span style=color:#61676ccc>,</span><span> error_detail)</span><span style=color:#61676ccc>;
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New context formatting function:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>pipeline_error_context</span><span>(</span><span style=color:#ff8f40>cached_pipeline</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>CachedPipeline) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Inner formatting function
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>format</span><span>(</span><span style=color:#ff8f40>shader</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Handle&LTShader>, ...) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Extracts source path, entry point, and shader defs
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Handles different pipeline types
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#ed9366>&</span><span>cached_pipeline</span><span style=color:#ed9366>.</span><span>descriptor {
</span><span>        PipelineDescriptor</span><span style=color:#ed9366>::</span><span>RenderPipelineDescriptor(desc) </span><span style=color:#ed9366>=> </span><span>{
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// Formats vertex and fragment shaders
</span><span>        }
</span><span>        PipelineDescriptor</span><span style=color:#ed9366>::</span><span>ComputePipelineDescriptor(desc) </span><span style=color:#ed9366>=> </span><span>{
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// Formats compute shader
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>These changes directly support the PR’s objective by adding contextual shader information to error logs when the environment variable is enabled.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/shaders/ target=_blank>Bevy Shader System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/wgsl/ target=_blank>WGSL Shader Language Specification</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/env/fn.var.html target=_blank>Rust Environment Variable Handling</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/examples/shader/shader_defs.wgsl target=_blank>Conditional Compilation with Shader Defs</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20448.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>