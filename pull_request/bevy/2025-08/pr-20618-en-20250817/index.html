<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20618 Work around ambiguous `From` error in nightly
        
    </title><meta content="#20618 Work around ambiguous `From` error in nightly" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20618-zh-cn-20250817>中文</a></div></div><div class=pr-content><h2 id=work-around-ambiguous-from-error-in-nightly>Work around ambiguous <code>From</code> error in nightly</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Work around ambiguous <code>From</code> error in nightly<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20618<li><strong>Author</strong>: greeble-dev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, A-ECS, A-Build-System, S-Ready-For-Final-Review, P-Compile-Failure<li><strong>Created</strong>: 2025-08-17T10:25:48Z<li><strong>Merged</strong>: 2025-08-17T16:11:10Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><p>A new <code>From</code> built-in macro in nightly Rust caused a compilation error due to ambiguous name resolution in a glob import:<pre style=color:#61676c;background-color:#fafafa><code><span>Compiling bevy_ecs v0.17.0-dev (/Users/runner/work/bevy/bevy/crates/bevy_ecs)
</span><span>error[E0659]: `From` is ambiguous
</span><span>    --> crates/bevy_ecs/src/entity/clone_entities.rs:1391:14
</span><span>     |
</span><span>1391 |     #[derive(From)]
</span><span>     |              ^^^^ ambiguous name
</span><span>     |
</span><span>     = note: ambiguous because of a conflict between a name from a glob import and an outer scope during import or macro resolution
</span><span>note: `From` could refer to the derive macro imported here
</span><span>    --> crates/bevy_ecs/src/entity/clone_entities.rs:1379:9
</span><span>     |
</span><span>1379 |     use super::*;
</span><span>     |         ^^^^^^^^
</span><span>     = help: consider adding an explicit import of `From` to disambiguate
</span><span>     = help: or use `self::From` to refer to this derive macro unambiguously
</span><span>note: `From` could also refer to the derive macro defined here
</span><span>    --> /Users/runner/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/prelude/mod.rs:59:13
</span><span>     |
</span><span>  59 |     pub use super::v1::*;
</span><span>     |             ^^^^^^^^^
</span></code></pre><p>This ambiguity arose between the derive macro imported via a glob and Rust’s new built-in <code>From</code> macro. The fix implements a simple workaround to unblock CI, though it’s unclear whether this is a Rust bug or Bevy issue.<p>Compiler version: <code>rustc 1.91.0-nightly (2e2642e64 2025-08-16)</code><br> Related issues:<ul><li><code>From</code> built-in macro tracking: https://github.com/rust-lang/rust/issues/144889<li>Regression report: https://github.com/rust-lang/rust/issues/145524</ul><h4 id=testing>Testing</h4><pre style=color:#61676c;background-color:#fafafa><code><span>cargo +nightly check -p bevy_ecs
</span></code></pre><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><h4 id=the-problem-and-context>The Problem and Context</h4><p>Nightly Rust introduced a new built-in <code>From</code> macro through its prelude, causing a name conflict in Bevy’s entity cloning implementation. The <code>clone_entities.rs</code> file contained a module using a glob import (<code>use super::*;</code>) alongside a <code>#[derive(From)]</code> attribute. This created ambiguity between the derive_macro’s <code>From</code> and Rust’s new built-in <code>From</code> macro. Since Bevy’s CI uses nightly Rust, this became a blocking issue requiring immediate resolution.<p>The error manifested specifically in the <code>private</code> module where a <code>FilterableId</code> enum derived <code>From</code> implementations. The glob import brought multiple <code>From</code> identifiers into scope, conflicting with the new language feature. This is a classic namespace collision issue exacerbated by Rust’s evolving standard library.<h4 id=the-solution-approach>The Solution Approach</h4><p>The solution replaces the problematic glob import with explicit imports. Instead of bringing all parent module items into scope, we selectively import only the required types and traits:<ol><li>Explicitly import <code>BundleId</code> and <code>ComponentId</code> from their respective modules<li>Import <code>TypeId</code> from <code>core::any</code><li>Explicitly import <code>derive_more::From</code></ol><p>This eliminates the ambiguity by ensuring only one <code>From</code> identifier (the derive macro) is in scope. The approach maintains identical functionality while resolving the name conflict. Alternatives like renaming the import (<code>use derive_more::From as DeriveFrom</code>) were considered but rejected as less readable compared to explicit imports.<h4 id=the-implementation>The Implementation</h4><p>The key change occurs in the <code>private</code> module. Originally, it used a glob import that unintentionally captured multiple <code>From</code> identifiers:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>mod </span><span style=color:#399ee6>private </span><span>{
</span><span>    </span><span style=color:#fa6e32>use super</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>;
</span></code></pre><p>This was replaced with targeted imports:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>mod </span><span style=color:#399ee6>private </span><span>{
</span><span>    </span><span style=color:#fa6e32>use crate</span><span style=color:#61676ccc>::</span><span>{bundle</span><span style=color:#ed9366>::</span><span>BundleId</span><span style=color:#61676ccc>, </span><span>component</span><span style=color:#ed9366>::</span><span>ComponentId}</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>use </span><span>core</span><span style=color:#ed9366>::</span><span>any</span><span style=color:#ed9366>::</span><span>TypeId</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>use </span><span>derive_more</span><span style=color:#ed9366>::</span><span>From</span><span style=color:#61676ccc>;
</span></code></pre><p>The explicit imports ensure only the intended <code>From</code> derive macro is available. Several documentation links were also fixed to use absolute paths (<code>crate::bundle::BundleId</code>) instead of relative paths, though these were unrelated to the core issue.<h4 id=technical-insights>Technical Insights</h4><p>This fix demonstrates an important principle: glob imports (<code>use ...::*;</code>) increase collision risks as dependencies evolve. They’re especially problematic with standard library additions. The solution shows how explicit imports can resolve macro ambiguities without changing functionality. The <code>derive_more</code> crate’s <code>From</code> derive remains essential for the <code>FilterableId</code> enum’s automatic trait implementations.<h4 id=the-impact>The Impact</h4><p>The change resolves the immediate compilation error in nightly Rust without affecting functionality. It unblocks Bevy’s CI pipeline and maintains compatibility with Rust’s evolving toolchain. The documentation fixes improve clarity but don’t change behavior. Future-proofing considerations: this workaround may become unnecessary if Rust stabilizes its <code>From</code> macro with different resolution rules.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[Nightly Rust Update] --> B[New built-in `From` macro]
</span><span>    C[Bevy glob import] --> D[`From` ambiguity]
</span><span>    B --> D
</span><span>    E[Solution: Replace glob with explicit imports] --> F[Resolved ambiguity]
</span><span>    D --> E
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><h4 id=crates-bevy-ecs-src-entity-clone-entities-rs-9-7><code>crates/bevy_ecs/src/entity/clone_entities.rs</code> (+9/-7)</h4><p>Resolved the <code>From</code> ambiguity by replacing a glob import with explicit imports and fixed documentation links.<p>Before:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>mod </span><span style=color:#399ee6>private </span><span>{
</span><span>    </span><span style=color:#fa6e32>use super</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Marker trait to allow multiple blanket implementations for [`FilterableIds`].
</span><span>    </span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>Marker </span><span>{}
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Marker type for [`FilterableId`] being a single element.
</span><span>    </span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SingleType </span><span>{}
</span><span>    </span><span style=color:#fa6e32>impl </span><span>Marker </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SingleType </span><span>{}
</span></code></pre><p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>mod </span><span style=color:#399ee6>private </span><span>{
</span><span>    </span><span style=color:#fa6e32>use crate</span><span style=color:#61676ccc>::</span><span>{bundle</span><span style=color:#ed9366>::</span><span>BundleId</span><span style=color:#61676ccc>, </span><span>component</span><span style=color:#ed9366>::</span><span>ComponentId}</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>use </span><span>core</span><span style=color:#ed9366>::</span><span>any</span><span style=color:#ed9366>::</span><span>TypeId</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>use </span><span>derive_more</span><span style=color:#ed9366>::</span><span>From</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Marker trait to allow multiple blanket implementations for [`FilterableIds`].
</span><span>    </span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>Marker </span><span>{}
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Marker type for [`FilterableId`] being a single element.
</span><span>    </span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SingleType </span><span>{}
</span><span>    </span><span style=color:#fa6e32>impl </span><span>Marker </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SingleType </span><span>{}
</span></code></pre><p>Documentation fixes (unrelated but included in same file):<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>/// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`], and [`IntoIterator`]
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`](`crate::bundle::BundleId`), and [`IntoIterator`]
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li>Rust’s <code>From</code> macro tracking issue: https://github.com/rust-lang/rust/issues/144889<li>Derive_more crate documentation: https://github.com/JelteF/derive_more<li>Rust’s namespace management: https://doc.rust-lang.org/reference/names/namespaces.html<li>Glob import considerations: https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports</ol><h3 id=full-code-diff>Full Code Diff</h3><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ecs/src/entity/clone_entities.rs b/crates/bevy_ecs/src/entity/clone_entities.rs
</span><span>index b2e78d79c1084..c8171a251735d 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/entity/clone_entities.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/entity/clone_entities.rs
</span><span style=color:#c594c5>@@ -8,7 +8,7 @@ </span><span style=color:#399ee6>use derive_more::derive::From;
</span><span> 
</span><span> use crate::{
</span><span>     archetype::Archetype,
</span><span style=color:#f07171>-    bundle::{Bundle, BundleId, BundleRemover, InsertMode},
</span><span style=color:#86b300>+    bundle::{Bundle, BundleRemover, InsertMode},
</span><span>     change_detection::MaybeLocation,
</span><span>     component::{Component, ComponentCloneBehavior, ComponentCloneFn, ComponentId, ComponentInfo},
</span><span>     entity::{hash_map::EntityHashMap, Entities, Entity, EntityMapper},
</span><span style=color:#c594c5>@@ -917,7 +917,7 @@ </span><span style=color:#399ee6>impl<'w> EntityClonerBuilder<'w, OptOut> {
</span><span>     }
</span><span> 
</span><span>     /// Extends the list of components that shouldn't be cloned.
</span><span style=color:#f07171>-    /// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`], and [`IntoIterator`] yielding one of these.
</span><span style=color:#86b300>+    /// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`](`crate::bundle::BundleId`), and [`IntoIterator`] yielding one of these.
</span><span>     ///
</span><span>     /// If component `A` is denied here and component `B` requires `A`, then `A`
</span><span>     /// is denied as well. See [`Self::without_required_by_components`] to alter
</span><span style=color:#c594c5>@@ -985,7 +985,7 @@ </span><span style=color:#399ee6>impl<'w> EntityClonerBuilder<'w, OptIn> {
</span><span>     }
</span><span> 
</span><span>     /// Extends the list of components to clone.
</span><span style=color:#f07171>-    /// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`], and [`IntoIterator`] yielding one of these.
</span><span style=color:#86b300>+    /// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`](`crate::bundle::BundleId`), and [`IntoIterator`] yielding one of these.
</span><span>     ///
</span><span>     /// If component `A` is allowed here and requires component `B`, then `B`
</span><span>     /// is allowed as well. See [`Self::without_required_components`]
</span><span style=color:#c594c5>@@ -996,7 +996,7 @@ </span><span style=color:#399ee6>impl<'w> EntityClonerBuilder<'w, OptIn> {
</span><span>     }
</span><span> 
</span><span>     /// Extends the list of components to clone if the target does not contain them.
</span><span style=color:#f07171>-    /// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`], and [`IntoIterator`] yielding one of these.
</span><span style=color:#86b300>+    /// Supports filtering by [`TypeId`], [`ComponentId`], [`BundleId`](`crate::bundle::BundleId`), and [`IntoIterator`] yielding one of these.
</span><span>     ///
</span><span>     /// If component `A` is allowed here and requires component `B`, then `B`
</span><span>     /// is allowed as well. See [`Self::without_required_components`]
</span><span style=color:#c594c5>@@ -1376,7 +1376,9 @@ </span><span style=color:#399ee6>impl Required {
</span><span> }
</span><span> 
</span><span> mod private {
</span><span style=color:#f07171>-    use super::*;
</span><span style=color:#86b300>+    use crate::{bundle::BundleId, component::ComponentId};
</span><span style=color:#86b300>+    use core::any::TypeId;
</span><span style=color:#86b300>+    use derive_more::From;
</span><span> 
</span><span>     /// Marker trait to allow multiple blanket implementations for [`FilterableIds`].
</span><span>     pub trait Marker {}
</span><span style=color:#c594c5>@@ -1387,7 +1389,7 @@ </span><span style=color:#399ee6>mod private {
</span><span>     pub struct VectorType {}
</span><span>     impl Marker for VectorType {}
</span><span> 
</span><span style=color:#f07171>-    /// Defines types of ids that [`EntityClonerBuilder`] can filter components by.
</span><span style=color:#86b300>+    /// Defines types of ids that [`EntityClonerBuilder`](`super::EntityClonerBuilder`) can filter components by.
</span><span>     #[derive(From)]
</span><span>     pub enum FilterableId {
</span><span>         Type(TypeId),
</span><span style=color:#c594c5>@@ -1405,7 +1407,7 @@ </span><span style=color:#399ee6>mod private {
</span><span>         }
</span><span>     }
</span><span> 
</span><span style=color:#f07171>-    /// A trait to allow [`EntityClonerBuilder`] filter by any supported id type and their iterators,
</span><span style=color:#86b300>+    /// A trait to allow [`EntityClonerBuilder`](`super::EntityClonerBuilder`) filter by any supported id type and their iterators,
</span><span>     /// reducing the number of method permutations required for all id types.
</span><span>     ///
</span><span>     /// The supported id types that can be used to filter components are defined by [`FilterableId`], which allows following types: [`TypeId`], [`ComponentId`] and [`BundleId`].
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20618.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>