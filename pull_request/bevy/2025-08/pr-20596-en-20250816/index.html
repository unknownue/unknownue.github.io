<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20596 Optional DLSS-RR support in Solari
        
    </title><meta content="#20596 Optional DLSS-RR support in Solari" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-08/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-08-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-08/pr-20596-zh-cn-20250816>中文</a></div></div><div class=pr-content><h1 id=technical-analysis-of-pr-20596-optional-dlss-rr-support-in-solari>Technical Analysis of PR #20596: Optional DLSS-RR Support in Solari</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Optional DLSS-RR support in Solari<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20596<li><strong>Author</strong>: JMS55<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Rendering, S-Ready-For-Final-Review, M-Needs-Release-Note<li><strong>Created</strong>: 2025-08-15T23:11:33Z<li><strong>Merged</strong>: 2025-08-16T18:17:50Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=problem-and-context>Problem and Context</h3><p>Solari, Bevy’s experimental real-time ray tracing solution, initially lacked built-in denoising and anti-aliasing capabilities. Without these features, ray-traced images exhibited significant noise artifacts that required either computationally expensive sampling techniques or external post-processing to resolve. This limitation hindered both visual quality and performance, particularly on complex scenes. Additionally, Solari didn’t leverage modern upscaling technologies that could reduce rendering costs while maintaining image quality.<h3 id=solution-approach>Solution Approach</h3><p>The implementation adds optional support for NVIDIA’s DLSS Ray Reconstruction (DLSS-RR) as an integrated solution for denoising, anti-aliasing, and upscaling. The approach maintains Solari’s core architecture while conditionally enabling DLSS-RR when both the feature flag is enabled and compatible hardware is detected. Key design decisions include:<ol><li><strong>Optional Integration</strong>: DLSS-RR is gated behind a <code>dlss</code> feature flag to avoid imposing dependencies on all users<li><strong>Minimal API Changes</strong>: Users enable DLSS-RR by simply adding <code>Dlss&LTDlssRayReconstructionFeature></code> to their camera<li><strong>Texture Management</strong>: New intermediate textures are created only when DLSS-RR is active<li><strong>Compute Pass Integration</strong>: A new compute pass prepares required textures before Solari’s main lighting passes</ol><h3 id=implementation-details>Implementation Details</h3><p>The implementation required coordinated changes across Solari’s rendering pipeline:<ol><li><strong>Conditional Pipeline Construction</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In node.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"dlss"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"force_disable_dlss"</span><span>))]
</span><span>let bind_group_layout_resolve_dlss_rr_textures </span><span style=color:#ed9366>=</span><span> render_device.</span><span style=color:#f29718>create_bind_group_layout</span><span>(...);
</span></code></pre><p>The render node now conditionally creates bind group layouts and pipelines for DLSS-RR only when the feature is enabled.<ol start=2><li><strong>Texture Preparation</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In prepare.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"dlss"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"force_disable_dlss"</span><span>))]
</span><span>if has_dlss_rr {
</span><span>    let diffuse_albedo </span><span style=color:#ed9366>=</span><span> render_device.</span><span style=color:#f29718>create_texture</span><span>(&TextureDescriptor {
</span><span>        label: </span><span style=color:#f29718>Some</span><span>(</span><span style=color:#86b300>"solari_lighting_diffuse_albedo"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        size: view_size.</span><span style=color:#f29718>to_extents</span><span>()</span><span style=color:#61676ccc>,
</span><span>        format: TextureFormat::Rgba8Unorm</span><span style=color:#61676ccc>,
</span><span>        // ...
</span><span>    });
</span><span>    // Creates specular_albedo</span><span style=color:#61676ccc>,</span><span> normal_roughness</span><span style=color:#61676ccc>,</span><span> specular_motion_vectors
</span><span>}
</span></code></pre><p>When DLSS-RR is active, four new textures are created at render time to store intermediate data required by DLSS.<ol start=3><li><strong>Compute Pass Execution</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In node.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"dlss"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"force_disable_dlss"</span><span>))]
</span><span>if let </span><span style=color:#f29718>Some</span><span>(bind_group_resolve_dlss_rr_textures) </span><span style=color:#ed9366>=</span><span> bind_group_resolve_dlss_rr_textures {
</span><span>    pass.</span><span style=color:#f29718>set_bind_group</span><span>(2</span><span style=color:#61676ccc>,</span><span> &bind_group_resolve_dlss_rr_textures</span><span style=color:#61676ccc>,</span><span> &[]);
</span><span>    pass.</span><span style=color:#f29718>set_pipeline</span><span>(resolve_dlss_rr_textures_pipeline);
</span><span>    pass.</span><span style=color:#f29718>dispatch_workgroups</span><span>(dx</span><span style=color:#61676ccc>,</span><span> dy</span><span style=color:#61676ccc>,</span><span> 1);
</span><span>}
</span></code></pre><p>The new compute pass runs before Solari’s main lighting passes when DLSS-RR is active, populating the required textures.<ol start=4><li><strong>Shader Implementation</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// resolve_dlss_rr_textures.wgsl
</span><span style=color:#ed9366>@</span><span>compute </span><span style=color:#ed9366>@</span><span style=color:#f07171>workgroup_size</span><span>(</span><span style=color:#ff8f40>8</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>8</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1</span><span>)
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>resolve_dlss_rr_textures</span><span>(@builtin(</span><span style=color:#ff8f40>global_invocation_id</span><span>) </span><span style=color:#ff8f40>global_id</span><span style=color:#61676ccc>: </span><span>vec3<</span><span style=color:#fa6e32>u32</span><span>>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    textureStore(diffuse_albedo</span><span style=color:#61676ccc>,</span><span> pixel_id</span><span style=color:#61676ccc>, </span><span style=color:#f07171>vec4</span><span>(base_color</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>))</span><span style=color:#61676ccc>;
</span><span>    textureStore(normal_roughness</span><span style=color:#61676ccc>,</span><span> pixel_id</span><span style=color:#61676ccc>, </span><span style=color:#f07171>vec4</span><span>(world_normal</span><span style=color:#61676ccc>,</span><span> perceptual_roughness))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><p>The new WGSL shader extracts material properties from the G-buffer and writes them to DLSS-specific textures.<h3 id=technical-insights>Technical Insights</h3><ol><li><strong>Conditional Compilation</strong>: The implementation uses Rust’s <code>#[cfg]</code> attributes extensively to ensure DLSS code only compiles when explicitly enabled<li><strong>Texture Optimization</strong>: Textures are created with minimal mip levels and appropriate formats to reduce memory overhead<li><strong>Pipeline Flexibility</strong>: The render node dynamically adjusts its query based on DLSS feature status<li><strong>Progressive Enhancement</strong>: The example demonstrates how to check for DLSS support at runtime before enabling it</ol><h3 id=impact>Impact</h3><ol><li><strong>Visual Quality</strong>: DLSS-RR provides integrated denoising and anti-aliasing<li><strong>Performance</strong>: Upscaling reduces rendering costs while maintaining output resolution<li><strong>Developer Experience</strong>: Simple API surface (single component addition) enables the feature<li><strong>Future Proofing</strong>: The texture preparation pipeline establishes patterns for integrating other upscalers</ol><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Camera] --> B[DLSS Component]
</span><span>    B --> C[Texture Preparation]
</span><span>    C --> D[DLSS-RR Compute Pass]
</span><span>    D --> E[Solari Lighting Passes]
</span><span>    E --> F[Final Image]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-solari-src-realtime-prepare-rs-101-2>crates/bevy_solari/src/realtime/prepare.rs (+101/-2)</h3><p>Creates required textures when DLSS-RR is enabled<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: No DLSS texture handling
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"dlss"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"force_disable_dlss"</span><span>))]
</span><span>if has_dlss_rr {
</span><span>    // Creates diffuse_albedo</span><span style=color:#61676ccc>,</span><span> specular_albedo</span><span style=color:#61676ccc>, 
</span><span>    // normal_roughness</span><span style=color:#61676ccc>,</span><span> specular_motion_vectors
</span><span>    commands.</span><span style=color:#f29718>entity</span><span>(entity).</span><span style=color:#f29718>insert</span><span>(ViewDlssRayReconstructionTextures { ... });
</span><span>}
</span></code></pre><h3 id=crates-bevy-solari-src-realtime-node-rs-79-1>crates/bevy_solari/src/realtime/node.rs (+79/-1)</h3><p>Integrates DLSS-RR compute pass into rendering pipeline<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Standard Solari passes
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"dlss"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"force_disable_dlss"</span><span>))]
</span><span>if let </span><span style=color:#f29718>Some</span><span>(bind_group) </span><span style=color:#ed9366>=</span><span> bind_group_resolve_dlss_rr_textures {
</span><span>    pass.</span><span style=color:#f29718>set_bind_group</span><span>(2</span><span style=color:#61676ccc>,</span><span> &bind_group</span><span style=color:#61676ccc>,</span><span> &[]);
</span><span>    pass.</span><span style=color:#f29718>set_pipeline</span><span>(resolve_dlss_rr_textures_pipeline);
</span><span>    pass.</span><span style=color:#f29718>dispatch_workgroups</span><span>(dx</span><span style=color:#61676ccc>,</span><span> dy</span><span style=color:#61676ccc>,</span><span> 1);
</span><span>}
</span></code></pre><h3 id=examples-3d-solari-rs-30-1>examples/3d/solari.rs (+30/-1)</h3><p>Demonstrates DLSS-RR usage in example<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Basic camera setup
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"dlss"</span><span style=color:#61676ccc>, </span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"force_disable_dlss"</span><span>))]
</span><span>if dlss_rr_supported.</span><span style=color:#f29718>is_some</span><span>() {
</span><span>    camera.</span><span style=color:#f29718>insert</span><span>(Dlss::&LTDlssRayReconstructionFeature> { ... });
</span><span>}
</span></code></pre><h3 id=crates-bevy-solari-src-realtime-resolve-dlss-rr-textures-wgsl-28-0>crates/bevy_solari/src/realtime/resolve_dlss_rr_textures.wgsl (+28/-0)</h3><p>New shader for DLSS texture preparation<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#ed9366>@</span><span>compute </span><span style=color:#ed9366>@</span><span style=color:#f07171>workgroup_size</span><span>(</span><span style=color:#ff8f40>8</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>8</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1</span><span>)
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>resolve_dlss_rr_textures</span><span>(...) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Extracts material properties from G-buffer
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Writes to DLSS-specific textures
</span><span>}
</span></code></pre><h3 id=release-content-release-notes-bevy-solari-md-20-2>release-content/release-notes/bevy_solari.md (+20/-2)</h3><p>Updates documentation with DLSS-RR information<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#4cbf99>- </span><span>Updated release notes:
</span><span>+## Try it out
</span><span>+</span><span style=color:#ed9366;background-color:#61676c10>`cargo run --example solari --features bevy_solari,dlss`</span><span>
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://www.nvidia.com/en-us/geforce/technologies/dlss/ray-reconstruction/ target=_blank>NVIDIA DLSS Ray Reconstruction Overview</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_anti_aliasing target=_blank>Bevy Anti-Aliasing Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/wgsl/#texture-operations target=_blank>WGSL Texture Operations Specification</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-08/pr_20596.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>