<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22156 Minimal Font Families, Font Queries, Collections, System Fonts, Stretch, and Slant support
        
    </title><meta content="#22156 Minimal Font Families, Font Queries, Collections, System Fonts, Stretch, and Slant support" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22156-zh-cn-20260103>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Minimal Font Families, Font Queries, Collections, System Fonts, Stretch, and Slant support<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22156<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, M-Migration-Guide, A-Text, M-Release-Note<li><strong>Created</strong>: 2025-12-16T22:14:54Z<li><strong>Merged</strong>: 2026-01-03T23:03:06Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Implement support for the remaining missing text features with minimal changes.<h2 id=solution>Solution</h2><p><code>TextFont</code> has been expanded to include new fields:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TextFont </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font</span><span style=color:#61676ccc>:</span><span> FontSource,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>weight</span><span style=color:#61676ccc>:</span><span> FontWeight,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>width</span><span style=color:#61676ccc>:</span><span> FontWidth,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>style</span><span style=color:#61676ccc>:</span><span> FontStyle,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_smoothing</span><span style=color:#61676ccc>:</span><span> FontSmoothing,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_features</span><span style=color:#61676ccc>:</span><span> FontFeatures,
</span><span>}
</span></code></pre><p>FontSource has two variants: Handle, which identifies a font by asset handle, and Family, which selects a font by its family name.<p><code>FontWidth</code> is a newtype struct representing OpenType font stretch classifications ranging from ULTRA_CONDENSED (50%) to ULTRA_EXPANDED (200%).<p><code>FontStyle</code> is an enum used to set the slant style of a font, either <code>Normal</code>, <code>Italic</code>, or <code>Oblique</code>.<p>The system font support is very barebones. You load them using the <code>CosmicFontSystem</code> resource:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>font_system</span><span style=color:#ed9366>.</span><span style=color:#f07171>db_mut</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>load_system_fonts</span><span>()
</span></code></pre><p>Then they are available to be selected by family name using <code>FontSource::Family</code>.<h3 id=other-changes>Other changes</h3><ul><li><p><code>TextPipelines</code>’s <code>glyph_info</code> field has been removed. There is no need to collect the section infos or perform any querys during text layout updates, so that code has been removed as well.</p><li><p><code>update_text_layout_info</code> used some <code>try_for_each</code> with some nested closures which was unnecessarily complicated again. They’ve been replaced with a regular for loop.</p><li><p>After font assets are loaded there’s a new system <code>load_font_assets_into_fontdb_system</code> that automatically adds them to cosmic text’s font database. Then they are available to be looked up by family name as well as by asset handle.</p><li><p>There aren’t are performance motivated changes but layout updates seem to be overall significantly more efficient now, with a slight regression for very large numbers of short, single section text entities.</p><li><p>Font texture atlases are no longer automatically cleared when the font asset they were generated from is removed. There is no way to remove individual fonts from cosmic text’s <code>FontSystem</code>, so the font is still accessible using the family name with <code>FontSource::family</code> and removing the text atlases naively could cause a panic since rendering expects them to be present.</p></ul><h2 id=testing>Testing</h2><pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example font_query
</span></code></pre><hr><h2 id=showcase>Showcase</h2><img alt=font-query height=591 src=https://github.com/user-attachments/assets/23f5aaa2-fdb8-4448-9b4e-9d65d6431107 width=1229><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Bevy’s text system had several limitations in its typographic capabilities. Developers could only reference fonts by their asset handles, which required loading font files as assets. This approach didn’t support common typographic workflows like selecting fonts by family name, using system fonts, or applying font variations like stretch (width) and slant (italic/oblique). These limitations made it difficult to create flexible text rendering systems that could leverage the full capabilities of modern font libraries and operating systems.<p>The existing implementation was also more complex than necessary. The <code>TextPipeline</code> maintained a <code>glyph_info</code> vector and performed redundant queries during layout updates. Additionally, the automatic cleanup of font atlases when font assets were removed created issues because fonts could still be accessible through other means.<h3 id=the-solution-approach>The Solution Approach</h3><p>The developer took a pragmatic approach to implement the missing features with minimal changes to the existing architecture. Rather than redesigning the entire text system, they extended the existing <code>TextFont</code> component to include the new typographic properties and introduced a <code>FontSource</code> enum to allow font selection by either asset handle or family name. This approach maintained backward compatibility while adding the new functionality.<p>The implementation leverages the underlying <code>cosmic-text</code> library’s capabilities for font querying and selection. By integrating more closely with <code>cosmic-text</code>’s font database, Bevy can now support system fonts and font family queries without significant architectural changes.<h3 id=the-implementation>The Implementation</h3><p>The core change is the expansion of the <code>TextFont</code> struct in <code>text.rs</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TextFont </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font</span><span style=color:#61676ccc>: </span><span>Handle&LTFont>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>weight</span><span style=color:#61676ccc>:</span><span> FontWeight,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_smoothing</span><span style=color:#61676ccc>:</span><span> FontSmoothing,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_features</span><span style=color:#61676ccc>:</span><span> FontFeatures,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TextFont </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font</span><span style=color:#61676ccc>:</span><span> FontSource,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>weight</span><span style=color:#61676ccc>:</span><span> FontWeight,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>width</span><span style=color:#61676ccc>:</span><span> FontWidth,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>style</span><span style=color:#61676ccc>:</span><span> FontStyle,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_smoothing</span><span style=color:#61676ccc>:</span><span> FontSmoothing,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_features</span><span style=color:#61676ccc>:</span><span> FontFeatures,
</span><span>}
</span></code></pre><p>The new <code>FontSource</code> enum provides two ways to specify a font:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>FontSource </span><span>{
</span><span>    Handle(Handle&LTFont>)</span><span style=color:#61676ccc>,
</span><span>    Family(SmolStr)</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>This change required updates throughout the codebase. The <code>TextPipeline</code> in <code>pipeline.rs</code> was refactored to handle both font source types. The key simplification was removing the <code>glyph_info</code> vector and the complex querying logic in <code>update_text_layout_info</code>. Instead of collecting font information through queries, the pipeline now extracts the necessary data directly from the layout glyphs provided by <code>cosmic-text</code>.<p>The font loading system was also enhanced. A new system <code>load_font_assets_into_fontdb_system</code> in <code>font.rs</code> automatically adds loaded font assets to <code>cosmic-text</code>’s font database, making them available for lookup by family name:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load_font_assets_into_fontdb_system</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>fonts</span><span style=color:#61676ccc>: </span><span>ResMut&LTAssets&LTFont>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>events</span><span style=color:#61676ccc>: </span><span>MessageReader&LTAssetEvent&LTFont>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>cosmic_font_system</span><span style=color:#61676ccc>: </span><span>ResMut&LTCosmicFontSystem>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>text_block_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComputedTextBlock>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... loads fonts into the font database
</span><span>}
</span></code></pre><p>An important design decision was to stop automatically clearing font texture atlases when font assets are removed. Since <code>cosmic-text</code>’s font database doesn’t provide a way to remove individual fonts, and fonts might still be accessible by family name, removing the atlases could cause panics during rendering when the system tries to access glyphs that are no longer available.<h3 id=technical-insights>Technical Insights</h3><p>The implementation demonstrates several sound engineering practices:<ol><li><p><strong>Progressive Enhancement</strong>: The changes add functionality without breaking existing APIs. The <code>FontSource</code> enum implements <code>From&LTHandle&LTFont>></code>, so existing code that passes a <code>Handle&LTFont></code> to <code>TextFont</code> continues to work.</p><li><p><strong>Simplification through Removal</strong>: The PR removes more code than it adds (234 lines removed vs. 167 added in <code>pipeline.rs</code>). By eliminating the <code>glyph_info</code> vector and simplifying the layout update logic, the code becomes more maintainable and performant.</p><li><p><strong>Leveraging Existing Infrastructure</strong>: The implementation makes better use of <code>cosmic-text</code>’s capabilities, particularly its font database and layout system. This reduces the amount of custom font management code in Bevy.</p><li><p><strong>Performance Considerations</strong>: The developer noted that layout updates are “overall significantly more efficient now” with only a slight regression for edge cases. This suggests the simplifications had a positive impact on performance for typical use cases.</p><li><p><strong>Migration Strategy</strong>: The PR includes a migration guide that clearly explains the change from <code>Handle&LTFont></code> to <code>FontSource</code> and provides simple migration instructions.</p></ol><h3 id=the-impact>The Impact</h3><p>This PR significantly enhances Bevy’s text rendering capabilities while simplifying the underlying implementation. Developers can now:<ul><li>Select fonts by family name in addition to asset handles<li>Use system fonts (after loading them into the font database)<li>Apply font stretch (width) variations from ultra-condensed to ultra-expanded<li>Apply font slant styles (normal, italic, oblique)</ul><p>The changes are backward compatible and come with clear migration instructions. The performance improvements in the layout system are a welcome bonus, and the codebase is now cleaner and more maintainable.<p>The new <code>font_query</code> example demonstrates all the new features in a practical context, showing how to use font weights, widths, and styles together.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[TextFont Component] --> B[FontSource Enum]
</span><span>    B --> C[Handle Variant]
</span><span>    B --> D[Family Variant]
</span><span>    A --> E[FontWidth]
</span><span>    A --> F[FontStyle]
</span><span>    A --> G[FontWeight]
</span><span>    
</span><span>    H[CosmicFontSystem] --> I[Font Database]
</span><span>    I --> J[System Fonts]
</span><span>    I --> K[Loaded Assets]
</span><span>    
</span><span>    C --> K
</span><span>    D --> I
</span><span>    
</span><span>    L[TextPipeline] --> M[update_text_layout_info]
</span><span>    M --> N[Uses cosmic-text layout]
</span><span>    N --> O[Generates PositionedGlyphs]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-text-rs-150-12><code>crates/bevy_text/src/text.rs</code> (+150/-12)</h3><p>This file contains the core type definitions for the text system. The main changes are:<ol><li><strong>New <code>FontSource</code> enum</strong>: Replaces the direct <code>Handle&LTFont></code> in <code>TextFont</code>.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>FontSource </span><span>{
</span><span>    Handle(Handle&LTFont>)</span><span style=color:#61676ccc>,
</span><span>    Family(SmolStr)</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><ol start=2><li><strong>Expanded <code>TextFont</code> struct</strong>: Added <code>width</code> and <code>style</code> fields.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TextFont </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font</span><span style=color:#61676ccc>:</span><span> FontSource,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_size</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>weight</span><span style=color:#61676ccc>:</span><span> FontWeight,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>width</span><span style=color:#61676ccc>:</span><span> FontWidth,      </span><span style=color:#abb0b6;font-style:italic>// New field
</span><span>    </span><span style=color:#fa6e32>pub </span><span>style</span><span style=color:#61676ccc>:</span><span> FontStyle,      </span><span style=color:#abb0b6;font-style:italic>// New field
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_smoothing</span><span style=color:#61676ccc>:</span><span> FontSmoothing,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>font_features</span><span style=color:#61676ccc>:</span><span> FontFeatures,
</span><span>}
</span></code></pre><ol start=3><li><strong>New <code>FontWidth</code> struct</strong>: Represents OpenType font stretch classifications.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>FontWidth</span><span>(</span><span style=color:#fa6e32>u16</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>FontWidth </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>ULTRA_CONDENSED</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>Self </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>Self</span><span>(</span><span style=color:#ff8f40>1</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>EXTRA_CONDENSED</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>Self </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>Self</span><span>(</span><span style=color:#ff8f40>2</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other constants
</span><span>}
</span></code></pre><ol start=4><li><strong>New <code>FontStyle</code> enum</strong>: Represents font slant styles.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>FontStyle </span><span>{
</span><span>    Normal</span><span style=color:#61676ccc>,
</span><span>    Italic</span><span style=color:#61676ccc>,
</span><span>    Oblique</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><h3 id=crates-bevy-text-src-pipeline-rs-167-234><code>crates/bevy_text/src/pipeline.rs</code> (+167/-234)</h3><p>The text pipeline was significantly refactored to support the new font features and simplify the layout logic:<ol><li><strong>Removed <code>glyph_info</code> field</strong>: The pipeline no longer needs to collect glyph information separately.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TextPipeline </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>map_handle_to_font_id</span><span style=color:#61676ccc>: </span><span>HashMap&LTAssetId&LTFont>, (ID, Arc<</span><span style=color:#fa6e32>str</span><span>>)>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>spans_buffer</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#f51818>.</span><span>..>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>glyph_info</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(AssetId&LTFont>, FontSmoothing, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>f32</span><span>, </span><span style=color:#fa6e32>u16</span><span>)>, </span><span style=color:#abb0b6;font-style:italic>// Removed
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TextPipeline </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>map_handle_to_font_id</span><span style=color:#61676ccc>: </span><span>HashMap&LTAssetId&LTFont>, (ID, Arc<</span><span style=color:#fa6e32>str</span><span>>)>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>spans_buffer</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#f51818>.</span><span>..>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// glyph_info removed
</span><span>}
</span></code></pre><ol start=2><li><strong>Simplified <code>update_text_layout_info</code></strong>: The complex nested closure structure was replaced with straightforward for-loops.</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Complex try_for_each with nested closures
</span><span style=color:#fa6e32>let</span><span> result </span><span style=color:#ed9366>=</span><span> buffer</span><span style=color:#ed9366>.</span><span style=color:#f07171>layout_runs</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>try_for_each</span><span>(|</span><span style=color:#ff8f40>run</span><span>| {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... complex logic
</span><span>})</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Simple for loops
</span><span style=color:#fa6e32>for</span><span> run </span><span style=color:#ed9366>in</span><span> buffer</span><span style=color:#ed9366>.</span><span style=color:#f07171>layout_runs</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... clearer logic
</span><span>    </span><span style=color:#fa6e32>for</span><span> layout_glyph </span><span style=color:#ed9366>in</span><span> run</span><span style=color:#ed9366>.</span><span>glyphs {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... process each glyph
</span><span>    }
</span><span>}
</span></code></pre><ol start=3><li><strong>Updated font handling</strong>: The pipeline now handles both <code>FontSource::Handle</code> and <code>FontSource::Family</code> variants.</ol><h3 id=crates-bevy-text-src-font-rs-44-0><code>crates/bevy_text/src/font.rs</code> (+44/-0)</h3><p>Added a new system to load font assets into the font database:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>load_font_assets_into_fontdb_system</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>fonts</span><span style=color:#61676ccc>: </span><span>ResMut&LTAssets&LTFont>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>events</span><span style=color:#61676ccc>: </span><span>MessageReader&LTAssetEvent&LTFont>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>cosmic_font_system</span><span style=color:#61676ccc>: </span><span>ResMut&LTCosmicFontSystem>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>text_block_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComputedTextBlock>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Loads font assets into cosmic-text's font database
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Marks text blocks for rerender when new fonts are added
</span><span>}
</span></code></pre><h3 id=examples-ui-font-query-rs-251-0><code>examples/ui/font_query.rs</code> (+251/-0)</h3><p>A new example demonstrating all the font features:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>setup</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands, </span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> family </span><span style=color:#ed9366>= </span><span>FontSource</span><span style=color:#ed9366>::</span><span>from(asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"fonts/MonaSans-VariableFont.ttf"</span><span>))</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... UI structure
</span><span>        </span><span style=color:#f07171>children!</span><span>[
</span><span>            (
</span><span>                Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>"Font Weights, Widths & Styles"</span><span>)</span><span style=color:#61676ccc>,
</span><span>                TextFont {
</span><span>                    font</span><span style=color:#61676ccc>:</span><span> family</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>                    font_size</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>32.0</span><span style=color:#61676ccc>,
</span><span>                    </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>                }</span><span style=color:#61676ccc>,
</span><span>                Underline</span><span style=color:#61676ccc>,
</span><span>            )</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... examples of weights, widths, and styles
</span><span>        ]
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=crates-bevy-text-src-font-atlas-set-rs-0-27><code>crates/bevy_text/src/font_atlas_set.rs</code> (+0/-27)</h3><p>Removed the system that automatically freed unused font atlases:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// This system was removed:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>free_unused_font_atlases_system</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>font_atlas_sets</span><span style=color:#61676ccc>: </span><span>ResMut&LTFontAtlasSet>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>font_events</span><span style=color:#61676ccc>: </span><span>MessageReader&LTAssetEvent&LTFont>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... cleaned up atlases when fonts were removed
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><p><strong>OpenType Font Specifications</strong>: The font stretch classifications follow the OpenType specification’s <code>usWidthClass</code> values (https://docs.microsoft.com/en-us/typography/opentype/spec/os2#uswidthclass)</p><li><p><strong>Cosmic Text Documentation</strong>: The underlying text layout library used by Bevy (https://github.com/pop-os/cosmic-text)</p><li><p><strong>Bevy Text Migration Guide</strong>: For updating existing code to use the new <code>FontSource</code> type (included in the PR as <code>TextFont_font_is_now_a_FontSource.md</code>)</p><li><p><strong>Variable Fonts</strong>: Understanding variable fonts and their axes (weight, width, slant) can help make the most of the new features (https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_fonts/Variable_fonts_guide)</p></ol><h2 id=full-code-diff>Full Code Diff</h2></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22156.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>