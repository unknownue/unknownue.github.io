<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22642 Emit a `warn_once` if a font size is larger than 1000
        
    </title><meta content="#22642 Emit a `warn_once` if a font size is larger than 1000" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22642-zh-cn-20260124>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Emit a <code>warn_once</code> if a font size is larger than 1000<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22642<li><strong>Author</strong>: WaterWhisperer<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Usability, S-Ready-For-Final-Review, A-Text, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2026-01-22T05:46:58Z<li><strong>Merged</strong>: 2026-01-24T19:38:56Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><ul><li>Fixes #22625</ul><p><strong>Solution</strong><ul><li>Add a WARN_FONT_SIZE const and emit a <code>warn_once</code> when font size larger than it<li>Change some <code>once!(warn!())</code> to <code>warn_once!()</code></ul><p><strong>Testing</strong><ul><li>Did you test these changes? If so, how? <code>cargo check</code></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a usability issue in Bevy’s text rendering system where developers could accidentally set font sizes that cause performance problems without any warning. The issue (#22625) was that extremely large font sizes would lead to excessive memory usage and slow font atlas generation, but the system provided no feedback to developers about this potentially problematic configuration.<p>The core problem was straightforward: when developers set font sizes that are too large (especially when combined with scale factors), the text rendering pipeline would generate massive font atlases, consuming significant memory and CPU resources during atlas generation. This could happen unintentionally when developers are experimenting with text scaling or when they misinterpret units.<p>The solution implemented takes a pragmatic approach. Rather than preventing large font sizes (which might be intentionally needed in some cases), the PR adds a warning system that alerts developers when they’ve configured a font size that exceeds a reasonable threshold. The threshold is set at 1000 points (after applying scale factor), which is large enough that legitimate use cases are unlikely to hit it, but small enough to catch most accidental misconfigurations.<p>The implementation leverages Bevy’s existing <code>warn_once!</code> macro, which ensures that the warning message is only logged once per unique condition during the application’s lifetime. This prevents log spam while still providing the necessary feedback. The PR also includes some minor cleanup by converting existing <code>once!(warn!(...))</code> patterns to use the more concise <code>warn_once!</code> macro, which serves the same purpose but with cleaner syntax.<p>Looking at the code changes, the implementation adds a <code>WARN_FONT_SIZE</code> constant (1000.0) and checks whether the scaled font size exceeds this value. The warning message clearly explains the consequences: “Extremely large font sizes will cause performance issues with font atlas generation and high memory usage.” This gives developers immediate feedback about why their configuration might be problematic.<p>The choice to use a constant rather than a magic number inline follows good engineering practices, making the threshold easily discoverable and modifiable if needed. The warning only triggers when the scaled font size (original size multiplied by scale factor) exceeds the threshold, which correctly accounts for the actual size that will be rendered.<p>This change fits well into the existing text pipeline architecture. The check occurs in the <code>queue_text</code> method of <code>TextPipeline</code>, which is responsible for processing text components and preparing them for rendering. This is the appropriate place for such validation because it has access to both the font size and the scale factor, and it runs whenever text needs to be re-rendered.<p>The PR doesn’t attempt to solve the performance issues themselves - that would require more complex changes to the font atlas generation system. Instead, it provides a practical, low-cost solution that helps developers avoid the problem in the first place. This is a good example of defensive programming and improving developer experience through better feedback mechanisms.<p>From an engineering perspective, this change has minimal performance impact. The additional check is a simple floating-point comparison that happens once per text span when the text needs rerendering. The memory overhead is negligible since it only adds a single constant to the binary.<p>One interesting aspect is the use of <code>warn_once!</code> versus <code>once!(warn!(...))</code>. The PR standardizes on the former, which is a newer, more ergonomic macro that achieves the same goal. This is a minor cleanup but contributes to code consistency across the codebase.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Text Component Created/Modified] --> B[TextPipeline.queue_text]
</span><span>    B --> C{Check font size > 0}
</span><span>    C -->|No| D[warn_once: "font size <= 0"]
</span><span>    C -->|Yes| E{Check scaled font size > 1000}
</span><span>    E -->|Yes| F[warn_once: "excessively large font size"]
</span><span>    E -->|No| G[Proceed with text rendering]
</span><span>    D --> H[Skip this text span]
</span><span>    F --> G
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_text/src/pipeline.rs</code> (+15/-6)</strong><p>This is the only file modified in the PR. It contains the text rendering pipeline logic that processes text components and prepares them for rendering.<p><strong>Key changes:</strong><ol><li><strong>Import statement update:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_log</span><span style=color:#ed9366>::</span><span>{once</span><span style=color:#61676ccc>,</span><span> warn}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_log</span><span style=color:#ed9366>::</span><span>warn_once</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><strong>Replacement of <code>once!(warn!(...))</code> patterns with <code>warn_once!(...)</code>:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (line ~169):
</span><span style=color:#f07171>once!</span><span>(</span><span style=color:#f07171>warn!</span><span>(
</span><span>    </span><span style=color:#86b300>"Text scale factor is <= 0.0. No text will be displayed."</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (line ~169):
</span><span style=color:#f07171>warn_once!</span><span>(</span><span style=color:#86b300>"Text scale factor is <= 0.0. No text will be displayed."</span><span style=color:#61676ccc>,</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (line ~213):
</span><span style=color:#f07171>once!</span><span>(</span><span style=color:#f07171>warn!</span><span>(
</span><span>    </span><span style=color:#86b300>"Text span {entity} has a font size <= 0.0. Nothing will be displayed."</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (line ~213):
</span><span style=color:#f07171>warn_once!</span><span>(
</span><span>    </span><span style=color:#86b300>"Text span {entity} has a font size <= 0.0. Nothing will be displayed."</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Addition of font size warning check:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added after the check for font size <= 0.0 (lines 220-229):
</span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>WARN_FONT_SIZE</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>1000.0</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>if</span><span> text_font</span><span style=color:#ed9366>.</span><span>font_size </span><span style=color:#ed9366>*</span><span> scale_factor </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>> </span><span style=color:#ff8f40>WARN_FONT_SIZE </span><span>{
</span><span>    </span><span style=color:#f07171>warn_once!</span><span>(
</span><span>        </span><span style=color:#86b300>"Text span {entity} has an excessively large font size ({} with scale factor {}). </span><span style=color:#61676ccc>\
</span><span style=color:#86b300>        Extremely large font sizes will cause performance issues with font atlas </span><span style=color:#61676ccc>\
</span><span style=color:#86b300>        generation and high memory usage."</span><span style=color:#61676ccc>,
</span><span>        text_font</span><span style=color:#ed9366>.</span><span>font_size</span><span style=color:#61676ccc>,
</span><span>        scale_factor</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The changes are straightforward and focused:<ul><li>The import change removes the unused <code>once</code> and <code>warn</code> imports in favor of <code>warn_once</code><li>Two existing warning patterns are updated to use the more concise <code>warn_once!</code> macro<li>A new warning is added for excessively large font sizes with a clear explanation of the potential performance impact</ul><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Logging System</strong>: Understanding Bevy’s logging macros (<code>warn!</code>, <code>warn_once!</code>, <code>info!</code>, etc.) and how they work with Bevy’s scheduling system.<li><strong>Text Rendering Pipeline</strong>: How Bevy processes text components, generates font atlases, and renders text to the screen.<li><strong>Font Atlas Generation</strong>: The process of creating texture atlases for fonts, including performance considerations for large glyph sizes.<li><strong>Defensive Programming</strong>: Techniques for writing code that detects and handles improper usage, providing better developer feedback.<li><strong>Bevy ECS System Ordering</strong>: How systems like <code>TextPipeline::queue_text</code> fit into Bevy’s ECS architecture and when they execute relative to other systems.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22642.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>