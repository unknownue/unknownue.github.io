<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22393 new 2d rotation example
        
    </title><meta content="#22393 new 2d rotation example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-05</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-01/pr-22393-en-20260105>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: new 2d rotation example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22393<li><strong>Author</strong>: ChristopherBiscardi<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, S-Ready-For-Final-Review, A-Transform, D-Straightforward<li><strong>Created</strong>: 2026-01-05T19:48:21Z<li><strong>Merged</strong>: 2026-01-05T23:18:20Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>以最少的代码解决2D场景下旋转实体使其面向光标的用例。<h2 id=solution>Solution</h2><p>新增示例。<h2 id=testing>Testing</h2><pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example rotate_to_cursor
</span></code></pre><hr><h2 id=showcase>Showcase</h2><p>https://github.com/user-attachments/assets/2f3aeade-5def-4fa3-a343-93985be55e57<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这个Pull Request源于一个常见的游戏开发需求：在2D场景中，让一个实体（例如一个角色或炮塔）能够旋转并始终面向鼠标光标的位置。虽然Bevy引擎的示例库中已经存在一个展示2D旋转的示例（<code>rotation.rs</code>），但它主要演示的是使用四元数进行通用旋转，并没有专门展示如何根据外部输入（如光标位置）进行动态旋转。对于初次接触游戏开发或Bevy坐标系统的开发者来说，实现“面向光标”这个看似简单的功能，可能需要拼接多个概念：坐标系统转换、向量运算以及旋转变换的应用。这个PR的目标就是提供一个最小化、专注的代码示例，直接解决这个具体问题。<p>开发者采取的解决方案非常直接：创建一个全新的示例。这个决策基于示例代码库的组织原则——每个示例应聚焦于演示一个特定的功能或模式。与其扩充现有的通用旋转示例，不如创建一个名为<code>rotate_to_cursor</code>的独立示例，这样意图更清晰，也更方便其他开发者查找和参考。<p>从实现上看，这个示例的代码结构简洁明了，遵循了Bevy应用的典型模式。它定义了一个<code>Player</code>组件标签来标识玩家控制的实体。在<code>setup</code>系统中，加载一个飞船纹理并生成精灵实体和2D摄像机。核心逻辑位于<code>player_movement_system</code>系统中，这个系统被注册到<code>FixedUpdate</code>阶段，确保旋转逻辑以固定的时间步长运行。<p>该系统的技术实现揭示了几个关键点。首先，它使用了Bevy的<code>Single</code>查询，这是一种便捷的语法，用于查询预期只有一个实体的组件，在这里是玩家的<code>Transform</code>和摄像机的<code>Camera</code>与<code>GlobalTransform</code>。其次，它演示了如何将屏幕空间的光标坐标转换为世界坐标：通过<code>window.cursor_position()</code>获取光标在窗口中的像素位置，然后使用<code>camera.viewport_to_world_2d(camera_transform, cursor_position)</code>方法将其转换为游戏世界中的2D坐标。这是实现“面向光标”功能的核心步骤。<p>获得光标的世界坐标后，计算旋转角度的逻辑基于基础的向量数学。方向向量通过<code>光标世界坐标 - 实体当前位置</code>得到。<code>Vec2</code>类型的<code>to_angle()</code>方法将这个向量转换为其与正X轴（向右）之间的弧度角。这里有一个重要的细节调整：示例中使用的飞船精灵默认是“朝上”的（即朝向正Y轴），而计算出的角度是基于正X轴的。因此，需要将计算结果减去<code>FRAC_PI_2</code>（即π/2，90度），才能使飞船正确地朝向光标。最终，使用<code>Quat::from_rotation_z(angle)</code>来设置实体的Z轴旋转。<p>这个PR的影响非常具体且积极。它为Bevy的学习者和使用者添加了一个实用的、即拿即用的代码示例。它清晰地串联了输入处理、坐标转换和实体变换这几个模块，降低了实现此类交互功能的认知门槛。同时，为了保持示例分类的清晰，PR作者还更新了现有<code>rotation</code>示例在<code>Cargo.toml</code>中的元数据名称，将其从“2D Rotation”改为“Generic 2D Rotation”，以区别于新的“2D Rotation to Cursor”示例，这体现了对代码库文档维护的细致考虑。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    App[App] --> Setup[setup System]
</span><span>    App --> PlayerSystem[player_movement_system System]
</span><span>    
</span><span>    Setup --> Spawns[Spawns Entities]
</span><span>    Spawns --> Camera[Camera2d Bundle]
</span><span>    Spawns --> Player[Player Sprite Bundle]
</span><span>    
</span><span>    PlayerSystem --> Queries[Queries Components]
</span><span>    Queries --> PlayerTransform[Player Transform]
</span><span>    Queries --> CameraQuery[Camera, GlobalTransform]
</span><span>    Queries --> Window[Window]
</span><span>    
</span><span>    Window --> CursorPos[Provides cursor_position]
</span><span>    CameraQuery --> ViewportConvert[viewport_to_world_2d]
</span><span>    CursorPos --> ViewportConvert
</span><span>    
</span><span>    ViewportConvert --> WorldPos[cursor_world_pos]
</span><span>    WorldPos --> VecMath[Vector Subtraction: cursor_world_pos - player.translation.xy]
</span><span>    VecMath --> DirectionVec[Direction Vector]
</span><span>    DirectionVec --> ToAngle[.to_angle() -> Radians]
</span><span>    ToAngle --> AdjustAngle[Subtract FRAC_PI_2]
</span><span>    AdjustAngle --> ApplyRotation[Quat::from_rotation_z]
</span><span>    ApplyRotation --> PlayerTransform
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><strong><code>examples/2d/rotate_to_cursor.rs</code></strong> (新增文件，+59行)</p> <ul><li><strong>描述</strong>：这是此次PR新增的核心示例文件。它完整实现了一个让飞船精灵旋转并跟随鼠标光标的Bevy应用。<li><strong>代码片段</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>//! Demonstrates rotating sprites to face the cursor.
</span><span>
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>prelude</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>f32</span><span style=color:#ed9366>::</span><span>consts</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FRAC_PI_2</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    App</span><span style=color:#ed9366>::</span><span>new()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(DefaultPlugins)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Startup</span><span style=color:#61676ccc>,</span><span> setup)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(FixedUpdate</span><span style=color:#61676ccc>,</span><span> player_movement_system)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span style=color:#ed9366>...
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>player_movement_system</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>player</span><span style=color:#61676ccc>: </span><span>Single<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform, With&LTPlayer>>,
</span><span>    </span><span style=color:#ff8f40>camera_query</span><span style=color:#61676ccc>: </span><span>Single<(</span><span style=color:#ed9366>&</span><span>Camera, </span><span style=color:#ed9366>&</span><span>GlobalTransform)>,
</span><span>    </span><span style=color:#ff8f40>window</span><span style=color:#61676ccc>: </span><span>Single<</span><span style=color:#ed9366>&</span><span>Window>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let </span><span>(camera</span><span style=color:#61676ccc>,</span><span> camera_transform) </span><span style=color:#ed9366>= *</span><span>camera_query</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(cursor_position) </span><span style=color:#ed9366>=</span><span> window</span><span style=color:#ed9366>.</span><span style=color:#f07171>cursor_position</span><span>()
</span><span>        </span><span style=color:#ed9366>&& </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(cursor_world_pos) </span><span style=color:#ed9366>=</span><span> camera</span><span style=color:#ed9366>.</span><span style=color:#f07171>viewport_to_world_2d</span><span>(camera_transform</span><span style=color:#61676ccc>,</span><span> cursor_position)
</span><span>    {
</span><span>        player</span><span style=color:#ed9366>.</span><span>rotation </span><span style=color:#ed9366>= </span><span>Quat</span><span style=color:#ed9366>::</span><span>from_rotation_z(
</span><span>            (cursor_world_pos </span><span style=color:#ed9366>-</span><span> player</span><span style=color:#ed9366>.</span><span>translation</span><span style=color:#ed9366>.</span><span style=color:#f07171>xy</span><span>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_angle</span><span>() </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>FRAC_PI_2</span><span style=color:#61676ccc>,
</span><span>        )</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><li><strong>关系</strong>：此文件直接实现了PR的目标，提供了“旋转面向光标”的完整可运行代码。</ul><li><p><strong><code>Cargo.toml</code></strong> (修改，+13/-1行)</p> <ul><li><strong>描述</strong>：在<code>[example]</code>和<code>[package.metadata.example]</code>部分注册了新示例<code>rotate_to_cursor</code>，并更新了原有<code>rotation</code>示例的名称以作区分。<li><strong>代码片段</strong>：<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># 新增的示例配置块
</span><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"rotate_to_cursor"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"examples/2d/rotate_to_cursor.rs"
</span><span style=color:#abb0b6;font-style:italic># Causes an ICE on docs.rs
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>false
</span><span>
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>example</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>rotate_to_cursor</span><span>]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"2D Rotation to Cursor"
</span><span style=color:#399ee6>description </span><span>= </span><span style=color:#86b300>"Demonstrates rotating entities in 2D to follow the cursor"
</span><span style=color:#399ee6>category </span><span>= </span><span style=color:#86b300>"2D Rendering"
</span><span style=color:#399ee6>wasm </span><span>= </span><span style=color:#ff8f40>true
</span><span>
</span><span style=color:#abb0b6;font-style:italic># 被修改的原有示例配置块（名称从“2D Rotation”改为“Generic 2D Rotation”）
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>example</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>rotation</span><span>]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"Generic 2D Rotation"
</span><span style=color:#399ee6>description </span><span>= </span><span style=color:#86b300>"Demonstrates rotating entities in 2D with quaternions"
</span><span style=color:#399ee6>category </span><span>= </span><span style=color:#86b300>"2D Rendering"
</span><span style=color:#399ee6>wasm </span><span>= </span><span style=color:#ff8f40>true
</span></code></pre><li><strong>关系</strong>：此修改使得新示例能够通过<code>cargo run --example rotate_to_cursor</code>命令运行，并确保其在文档和示例列表中被正确分类和描述。</ul><li><p><strong><code>examples/README.md</code></strong> (修改，+2/-1行)</p> <ul><li><strong>描述</strong>：更新了示例目录的说明文件，在列表中新增了<code>2D Rotation to Cursor</code>示例，并将原有的<code>2D Rotation</code>条目替换为<code>Generic 2D Rotation</code>，保持了列表的排序。<li><strong>关系</strong>：确保开发者通过README文件浏览示例时，能够找到并理解这个新示例的用途。</ul></ol><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy 官方文档 - 变换 (Transform)</strong>: 深入了解<code>Transform</code>组件，以及平移、旋转、缩放的详细API。<li><strong>Bevy 官方示例 - <code>2d_viewport_to_world.rs</code></strong>: 此示例更深入地讲解了<code>Camera::viewport_to_world_2d</code>方法及其在不同场景下的应用，可作为本示例中坐标转换部分的补充学习材料。<li><strong>《游戏编程模式》 - “面向组件编程”章节</strong>: 有助于理解Bevy ECS架构的设计哲学，以及如何像本示例中一样通过组合组件和系统来构建游戏逻辑。<li><strong>线性代数基础，特别是向量运算</strong>: 理解向量减法、点积、叉积以及如何从向量导出角度，是掌握2D/3D游戏旋转、朝向等概念的关键。可以复习二维向量相关的数学知识。</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22393.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>