<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22308 Update cosmic-text to 0.16
        
    </title><meta content="#22308 Update cosmic-text to 0.16" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-01</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22308-zh-cn-20260101>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update cosmic-text to 0.16<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22308<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, S-Ready-For-Final-Review, A-Text, D-Straightforward, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2025-12-29T23:05:41Z<li><strong>Merged</strong>: 2026-01-01T04:06:28Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><p>Update the Cosmic Text dependency to 0.16.<p>Fixes #22191<p><strong>Solution</strong><p>There aren’t any breaking changes with Cosmic Text version 0.16, but it does add font-hinting support. This is controlled in Bevy with a new component <code>FontHinting</code>. The <code>Text</code> component, which is normally used with physical pixel aligned text, now requires <code>FontHinting::Enabled</code>, and <code>Text2d</code>, which normally isn’t pixel aligned, now requires <code>FontHinting::Disabled</code>. Hinting needs to be set per text block, not per text span entity, so it wouldn’t be appropriate to add it as a field on <code>TextFont</code>.<p><strong>Testing</strong><p><code>testbed_ui</code>’s text scene in main with cosmic-text 15: <img alt=cosmic-15 height=1127 src=https://github.com/user-attachments/assets/0ee44e38-07b0-411b-9102-b7d28de0ffcd width=1924><p>The font names are meant to be rendered in their corresponding fonts but, as you can see, some names are rendered using the incorrect font. This is due to the ascii fastpath bug in cosmic-text 15, which is fixed in 16.<p><code>testbed_ui</code>’s text scene on this branch with cosmic-text 16: <img alt=cosmic-16 height=1127 src=https://github.com/user-attachments/assets/549f9a21-e24d-422d-a9e2-eac902b2e054 width=1924><p>Now each font’s name is rendered using the correct font.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses two related issues: updating the cosmic-text dependency to version 0.16 to fix a font rendering bug, and integrating the new font hinting feature introduced in that version. The problem was that cosmic-text 0.15 contained an ASCII fastpath bug that caused incorrect font selection in certain scenarios, particularly noticeable in test scenes where font names should render using their corresponding fonts.<p>The approach taken is straightforward: update the dependency and expose the new font hinting capability through a new Bevy component. Font hinting is a technique that adjusts glyph outlines to align with pixel grids, improving readability on lower-resolution displays. The cosmic-text 0.16 library introduces this feature, and Bevy needs to provide a way to control it.<p>The implementation required changes across multiple text-rendering systems. The core addition is the <code>FontHinting</code> component, an enum with <code>Disabled</code> and <code>Enabled</code> variants that maps directly to cosmic-text’s <code>Hinting</code> enum. This component is added as a required component for both UI text (<code>Text</code>) and 2D sprite text (<code>Text2d</code>) entities, with different default values based on their typical use cases.<p>For UI text, which is usually pixel-aligned in screen space, hinting is enabled by default (<code>FontHinting::Enabled</code>). For 2D sprite text, which often undergoes transformations and may not align to the pixel grid, hinting is disabled by default (<code>FontHinting::Disabled</code>). This distinction is important because enabling hinting on non-pixel-aligned text can cause visual artifacts.<p>The hinting setting needs to be applied at the text block level rather than per text span because it affects the entire text layout process. This is why it’s implemented as a component on the text entity rather than a field on <code>TextFont</code>. The text pipeline functions that create text layouts and measurements now accept a <code>hinting</code> parameter, which is passed through to the cosmic-text buffer’s <code>set_hinting</code> method.<p>The changes are minimal and focused. In the text pipeline, when processing text layout, the hinting setting is applied to the cosmic-text buffer before shaping and layout occur. The systems that handle text updates now also check if the <code>FontHinting</code> component has changed to trigger re-layout when necessary.<p>The impact is twofold: the ASCII fastpath bug is fixed, ensuring correct font selection, and users now have control over font hinting behavior. The implementation maintains backward compatibility by providing sensible defaults for different text types.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[cosmic-text 0.16] --> B[Adds font hinting feature]
</span><span>    B --> C[New FontHinting component]
</span><span>    C --> D[UI Text: Enabled by default]
</span><span>    C --> E[Text2d: Disabled by default]
</span><span>    D --> F[Text pipeline applies hinting]
</span><span>    E --> F
</span><span>    F --> G[cosmic-text buffer.set_hinting()]
</span><span>    H[Fixes ASCII fastpath bug] --> I[Correct font rendering]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-text-rs-22-0><code>crates/bevy_text/src/text.rs</code> (+22/-0)</h3><p>This file adds the new <code>FontHinting</code> component enum and its conversion to cosmic-text’s <code>Hinting</code> type.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#abb0b6;font-style:italic>/// Font hinting strategy.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// &LThttps://docs.rs/cosmic-text/latest/cosmic_text/enum.Hinting.html>
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>FontHinting </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>default</span><span>]
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Glyphs will have subpixel coordinates.
</span><span>    Disabled</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Glyphs will be snapped to integral coordinates in the X-axis during layout.
</span><span>    Enabled</span><span style=color:#61676ccc>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#55b4d4;font-style:italic>From</span><span>&LTFontHinting> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>cosmic_text</span><span>::</span><span style=color:#399ee6>Hinting </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from</span><span>(</span><span style=color:#ff8f40>value</span><span style=color:#61676ccc>:</span><span> FontHinting) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>match</span><span> value {
</span><span>            FontHinting</span><span style=color:#ed9366>::</span><span>Disabled </span><span style=color:#ed9366>=> </span><span>cosmic_text</span><span style=color:#ed9366>::</span><span>Hinting</span><span style=color:#ed9366>::</span><span>Disabled</span><span style=color:#61676ccc>,
</span><span>            FontHinting</span><span style=color:#ed9366>::</span><span>Enabled </span><span style=color:#ed9366>=> </span><span>cosmic_text</span><span style=color:#ed9366>::</span><span>Hinting</span><span style=color:#ed9366>::</span><span>Enabled</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-src-widget-text-rs-11-5><code>crates/bevy_ui/src/widget/text.rs</code> (+11/-5)</h3><p>Adds <code>FontHinting</code> as a required component for UI text with <code>Enabled</code> as the default, and updates the measurement system to check for hinting changes.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>bundle</span><span>]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>TextBundle </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Enable hinting as UI text is normally pixel-aligned.
</span><span>    FontHinting</span><span style=color:#61676ccc>::</span><span>Enabled
</span><span>)}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In measure_text_system:
</span><span style=color:#fa6e32>if</span><span> hinting</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_changed</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Trigger re-measurement
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Pass hinting to create_text_measure:
</span><span style=color:#fa6e32>let</span><span> measure </span><span style=color:#ed9366>=</span><span> text_pipeline</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_text_measure</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other parameters
</span><span>    </span><span style=color:#ed9366>*</span><span>hinting</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-sprite-src-text2d-rs-10-5><code>crates/bevy_sprite/src/text2d.rs</code> (+10/-5)</h3><p>Adds <code>FontHinting</code> as a required component for Text2d with <code>Disabled</code> as the default, and updates the layout system to check for hinting changes.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>bundle</span><span>]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Text2dBundle </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Disable hinting as `Text2d` text is not always pixel-aligned
</span><span>    FontHinting</span><span style=color:#61676ccc>::</span><span>Disabled
</span><span>)}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In update_text2d_layout system:
</span><span style=color:#fa6e32>let</span><span> text_changed </span><span style=color:#ed9366>= </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span style=color:#ed9366>||</span><span> hinting</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_changed</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Pass hinting to create_text_layout:
</span><span>text_pipeline</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_text_layout</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other parameters  
</span><span>    </span><span style=color:#ed9366>*</span><span>hinting</span><span style=color:#61676ccc>,
</span><span>)
</span></code></pre><h3 id=crates-bevy-text-src-pipeline-rs-9-4><code>crates/bevy_text/src/pipeline.rs</code> (+9/-4)</h3><p>Updates the text pipeline functions to accept and apply the hinting parameter to the cosmic-text buffer.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>create_text_layout</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other parameters
</span><span>    </span><span style=color:#ff8f40>hinting</span><span style=color:#61676ccc>:</span><span> FontHinting,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), TextError> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Set the metrics hinting strategy
</span><span>    buffer</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_hinting</span><span>(font_system</span><span style=color:#61676ccc>,</span><span> hinting</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Similar change in create_text_measure function
</span></code></pre><h3 id=crates-bevy-text-cargo-toml-1-1><code>crates/bevy_text/Cargo.toml</code> (+1/-1)</h3><p>Updates the cosmic-text dependency version from 0.15 to 0.16.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#399ee6>cosmic-text </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.16"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"shape-run-cache"</span><span>] }
</span></code></pre><h3 id=crates-bevy-text-src-lib-rs-2-2><code>crates/bevy_text/src/lib.rs</code> (+2/-2)</h3><p>Exports <code>FontHinting</code> in the public prelude for accessibility.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>prelude </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>doc</span><span>(hidden)]
</span><span>    </span><span style=color:#fa6e32>pub use crate</span><span style=color:#61676ccc>::</span><span>{
</span><span>        Font</span><span style=color:#61676ccc>,</span><span> FontHinting</span><span style=color:#61676ccc>,</span><span> FontWeight</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>/* ... */
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>cosmic-text documentation</strong>: https://docs.rs/cosmic-text/latest/cosmic_text/<li><strong>Font hinting explained</strong>: https://en.wikipedia.org/wiki/Font_hinting<li><strong>Bevy Text documentation</strong>: https://docs.rs/bevy_text/latest/bevy_text/<li><strong>ASCII fastpath bug discussion</strong>: The cosmic-text 0.16 release notes likely detail the fix for this rendering issue</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22308.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>