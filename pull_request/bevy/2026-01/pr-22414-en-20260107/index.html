<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22414 Add warning log for sprite picking failure on compressed textures
        
    </title><meta content="#22414 Add warning log for sprite picking failure on compressed textures" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22414-zh-cn-20260107>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=add-warning-log-for-sprite-picking-failure-on-compressed-textures>Add warning log for sprite picking failure on compressed textures</h2><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add warning log for sprite picking failure on compressed textures<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22414<li><strong>Author</strong>: mirsella<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Usability, S-Ready-For-Final-Review, A-Picking<li><strong>Created</strong>: 2026-01-07T09:49:02Z<li><strong>Merged</strong>: 2026-01-07T20:52:09Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>fixes https://github.com/bevyengine/bevy/issues/22413 from this issue:<blockquote><p>currently, with SpritePickingMode::AlphaThreshold sprite picking silently fail on image format like bc7, uastc, etc, since its not possible to get the pixel alpha value at a specific location, as the image is compressed in memory. currently the code break the loop and silently skip picking for the sprite. https://github.com/bevyengine/bevy/pull/20574 made it not panic anymore</blockquote><p>its very hard to debug why a sprite picking doesn’t work when encountering this issue, i think a warn is really useful.<h2 id=solution>Solution</h2><p>add a warn! log<h2 id=testing>Testing</h2><p>tested on my own project<p>is the log message adapted ?<p>thanks<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The issue originated from a developer trying to use sprite picking with compressed texture formats. When <code>SpritePickingMode::AlphaThreshold</code> is configured, the system needs to sample individual pixels to check their alpha values against a threshold. This works fine for uncompressed formats, but fails silently for compressed formats like BC7 and UASTC because these formats cannot be directly sampled at the pixel level - they’re stored in memory in a compressed block format that requires decoding before individual pixel access is possible.<p>Prior to PR #20574, this situation would cause a panic. That earlier PR changed the behavior to silently skip picking by breaking out of the loop without any indication, which fixed the crash but created a new problem: developers had no way to know why their sprite picking wasn’t working. The silent failure made debugging difficult because there was no feedback in the console or logs.<p>The solution implemented in this PR is straightforward but important: add a warning log when the system encounters a compressed texture format that prevents pixel sampling. The key insight here is that the <code>TextureAccessError</code> enum has a specific variant <code>UnsupportedTextureFormat</code> that gets returned when <code>get_color_at()</code> is called on a compressed texture. By pattern matching on this specific error type, the code can provide targeted feedback to developers.<p>The warning message serves three purposes:<ol><li>It clearly identifies which entity is affected<li>It specifies the problematic texture format<li>It suggests a practical workaround: switching to <code>SpritePickingMode::BoundingBox</code></ol><p>This change follows the principle of “fail noisily” - when something goes wrong in a way that’s expected (not a bug, but a limitation of the system), provide clear feedback to the developer about what happened and why. This is especially important for game engines where developers may be loading various texture formats without realizing the implications for different systems.<p>The implementation required adding a new dependency (<code>bevy_log</code>) to the <code>bevy_sprite</code> crate, which is a small but necessary change since logging functionality wasn’t previously available in this module. The warning is emitted only when the specific unsupported format error occurs, not for other texture access errors, which maintains the existing behavior for other failure modes.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[SpritePickingMode::AlphaThreshold] --> B{Try get_color_at()}
</span><span>    B -->|Success| C[Check alpha threshold]
</span><span>    B -->|Error: UnsupportedTextureFormat| D[Emit Warning Log]
</span><span>    D --> E[Skip picking for this sprite]
</span><span>    E --> F[Suggest BoundingBox mode]
</span><span>    B -->|Other Error| G[Silently skip]
</span><span>    
</span><span>    style D fill:#f9f,stroke:#333,stroke-width:2px
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-sprite-cargo-toml-1-0><code>crates/bevy_sprite/Cargo.toml</code> (+1/-0)</h3><p><strong>Change</strong>: Added <code>bevy_log</code> as a dependency <strong>Why</strong>: Needed for the <code>warn!</code> macro to emit warning logs from the sprite picking module<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># File: crates/bevy_sprite/Cargo.toml
</span><span style=color:#abb0b6;font-style:italic># Addition at line 31:
</span><span style=color:#399ee6>bevy_log </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_log"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev" </span><span>}
</span></code></pre><h3 id=crates-bevy-sprite-src-picking-backend-rs-16-5><code>crates/bevy_sprite/src/picking_backend.rs</code> (+16/-5)</h3><p><strong>Change</strong>: Modified the sprite picking function to emit a warning when encountering compressed textures<p>The key change is in how the <code>image.get_color_at()</code> call is handled. Previously it used <code>let Ok(color) = ... else { break ... }</code> which would silently skip any error. Now it uses pattern matching to specifically handle the <code>UnsupportedTextureFormat</code> error variant and emit a helpful warning.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_sprite/src/picking_backend.rs
</span><span style=color:#abb0b6;font-style:italic>// Before (simplified):
</span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(color) </span><span style=color:#ed9366>=</span><span> image</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_color_at</span><span>(
</span><span>    cursor_pixel_space</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>u32</span><span style=color:#61676ccc>,
</span><span>    cursor_pixel_space</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>u32</span><span style=color:#61676ccc>,
</span><span>) </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// We don't know how to interpret the pixel.
</span><span>    </span><span style=color:#fa6e32>break 'valid_pixel </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>;
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> color </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>match</span><span> image</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_color_at</span><span>(
</span><span>    cursor_pixel_space</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>u32</span><span style=color:#61676ccc>,
</span><span>    cursor_pixel_space</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>u32</span><span style=color:#61676ccc>,
</span><span>) {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(color) </span><span style=color:#ed9366>=></span><span> color</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(TextureAccessError</span><span style=color:#ed9366>::</span><span>UnsupportedTextureFormat(format)) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#f07171>warn!</span><span>(
</span><span>            </span><span style=color:#86b300>"Failed to get pixel color for sprite picking on entity {:?}: unsupported texture format {:?}. </span><span style=color:#61676ccc>\
</span><span style=color:#86b300>            This is often caused by the use of a compressed texture format. </span><span style=color:#61676ccc>\
</span><span style=color:#86b300>            Consider using `SpritePickingMode::BoundingBox`."</span><span style=color:#61676ccc>,
</span><span>            entity</span><span style=color:#61676ccc>,
</span><span>            format
</span><span>        )</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>break 'valid_pixel </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(</span><span style=color:#ed9366>_</span><span>) </span><span style=color:#ed9366>=> </span><span style=color:#fa6e32>break 'valid_pixel </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Imports</strong>: The file also added two new imports:<ul><li><code>bevy_image::TextureAccessError</code> to pattern match on the specific error type<li><code>bevy_log::warn</code> to emit the warning log</ul><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Picking System Documentation</strong>: For understanding the overall picking architecture in Bevy<li><strong>Texture Compression Formats</strong>: Information about BC7, UASTC, and other GPU texture formats and their limitations<li><strong>Error Handling Patterns in Rust</strong>: Best practices for matching on specific error variants versus using generic error handling<li><strong>Bevy Logging System</strong>: How to use different log levels (info, warn, error) effectively in Bevy applications</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22414.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>