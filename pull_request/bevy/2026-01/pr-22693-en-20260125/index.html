<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22693 reflect Frustum and HalfSpace
        
    </title><meta content="#22693 reflect Frustum and HalfSpace" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-25</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22693-zh-cn-20260125>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>reflect Frustum and HalfSpace<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: reflect Frustum and HalfSpace<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22693<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, S-Ready-For-Final-Review, A-Reflection<li><strong>Created</strong>: 2026-01-25T04:23:07Z<li><strong>Merged</strong>: 2026-01-25T21:21:23Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><ul><li>reflect it</ul><p><strong>Solution</strong><ul><li>Reflect derive</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important gap in Bevy’s reflection system by adding the <code>Reflect</code> derive to the <code>HalfSpace</code> struct and enabling reflection for fields that were previously excluded from reflection in several camera-related components.<p>The issue was that while Bevy’s reflection system allows for runtime type inspection and dynamic operations, two key types in the camera system weren’t fully compatible with it. The <code>HalfSpace</code> struct, which represents a plane that divides 3D space into two half-spaces, lacked the <code>Reflect</code> derive entirely. Additionally, the <code>Frustum</code>, <code>CubemapFrusta</code>, and <code>CascadesFrusta</code> structs had reflection intentionally disabled for their core fields via the <code>#[reflect(ignore)]</code> attribute.<p>The technical problem here is that without reflection support, these types can’t participate in Bevy’s dynamic systems. For example, they can’t be:<ul><li>Inspected at runtime through reflection tools<li>Used in Bevy’s scene serialization/deserialization<li>Modified dynamically through editor interfaces<li>Included in dynamic queries that rely on reflection</ul><p>The solution is minimal but complete: add <code>Reflect</code> to <code>HalfSpace</code>’s derive macro list and remove the <code>#[reflect(ignore)]</code> attributes from the fields that contain <code>HalfSpace</code> and <code>Frustum</code> instances. This change is consistent with how other geometric primitives in Bevy are handled and follows the established pattern of using derive macros for reflection support.<p>The implementation involves four specific changes in <code>primitives.rs</code>:<ol><li><p><strong>Adding <code>Reflect</code> to <code>HalfSpace</code></strong>: The struct now includes <code>Reflect</code> in its derive attributes, making it fully reflectable like other math primitives in Bevy.</p><li><p><strong>Enabling reflection for <code>Frustum::half_spaces</code></strong>: Previously marked with <code>#[reflect(ignore, clone)]</code>, this field can now be reflected since its element type (<code>HalfSpace</code>) now supports reflection.</p><li><p><strong>Enabling reflection for <code>CubemapFrusta::frusta</code></strong>: Similarly, this array of <code>Frustum</code> instances can now be reflected since <code>Frustum</code> fully supports reflection (including its now-reflectable <code>half_spaces</code> field).</p><li><p><strong>Enabling reflection for <code>CascadesFrusta::frusta</code></strong>: This <code>EntityHashMap&LTVec&LTFrustum>></code> field can now participate in reflection since all nested types in the hierarchy now support reflection.</p></ol><p>The key technical insight here is that reflection in Bevy uses a compositional approach. When a struct contains fields of other types, those types must also support reflection for the containing struct to be fully reflectable. The <code>#[reflect(ignore)]</code> attribute was being used as a workaround when <code>HalfSpace</code> didn’t support reflection, but now that it does, the workaround can be removed.<p>This change doesn’t affect runtime performance for systems that don’t use reflection, since the reflection metadata is only generated at compile time and stored in the type registry. For systems that do use reflection, this enables complete access to camera frustum data at runtime.<p>The impact of this change is that camera-related components can now fully participate in Bevy’s reflection ecosystem. This is particularly useful for:<ul><li>Scene serialization/deserialization (saving and loading camera configurations)<li>Editor tools that need to inspect and modify camera properties<li>Dynamic systems that work with camera geometry<li>Debug visualization tools that rely on reflection</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[HalfSpace] -->|now Reflectable| B[Frustum]
</span><span>    B -->|contains| A
</span><span>    C[CubemapFrusta] -->|contains array of| B
</span><span>    D[CascadesFrusta] -->|contains map of| B
</span><span>    
</span><span>    E[Reflection System] -->|can now inspect| A
</span><span>    E -->|can now inspect| B
</span><span>    E -->|can now inspect| C
</span><span>    E -->|can now inspect| D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-camera-src-primitives-rs><code>crates/bevy_camera/src/primitives.rs</code></h3><ol><li><strong>Added <code>Reflect</code> derive to <code>HalfSpace</code> struct</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>HalfSpace </span><span>{
</span><span>    normal_d</span><span style=color:#61676ccc>:</span><span> Vec4,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>HalfSpace </span><span>{
</span><span>    normal_d</span><span style=color:#61676ccc>:</span><span> Vec4,
</span><span>}
</span></code></pre><ol start=2><li><strong>Removed reflection ignore from <code>Frustum::half_spaces</code></strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Frustum </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(ignore</span><span style=color:#61676ccc>,</span><span> clone)]
</span><span>    </span><span style=color:#fa6e32>pub </span><span>half_spaces</span><span style=color:#61676ccc>:</span><span> [HalfSpace; 6],
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Frustum </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>half_spaces</span><span style=color:#61676ccc>:</span><span> [HalfSpace; 6],
</span><span>}
</span></code></pre><ol start=3><li><strong>Removed reflection ignore from <code>CubemapFrusta::frusta</code></strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CubemapFrusta </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(ignore</span><span style=color:#61676ccc>,</span><span> clone)]
</span><span>    </span><span style=color:#fa6e32>pub </span><span>frusta</span><span style=color:#61676ccc>:</span><span> [Frustum; 6],
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CubemapFrusta </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>frusta</span><span style=color:#61676ccc>:</span><span> [Frustum; 6],
</span><span>}
</span></code></pre><ol start=4><li><strong>Removed reflection ignore from <code>CascadesFrusta::frusta</code></strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CascadesFrusta </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(ignore</span><span style=color:#61676ccc>,</span><span> clone)]
</span><span>    </span><span style=color:#fa6e32>pub </span><span>frusta</span><span style=color:#61676ccc>: </span><span>EntityHashMap<</span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTFrustum>>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CascadesFrusta </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>frusta</span><span style=color:#61676ccc>: </span><span>EntityHashMap<</span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTFrustum>>,
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_reflect/latest/bevy_reflect/ target=_blank>Bevy Reflection Documentation</a> - Comprehensive guide to Bevy’s reflection system<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_reflect/derive/src/lib.rs target=_blank>Derive Macro for Reflection</a> - Implementation details of the Reflect derive macro<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_camera/src/primitives.rs target=_blank>Bevy Camera Primitives</a> - Source file containing the camera geometry types<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/attributes.html target=_blank>Rust Attribute Macros</a> - Reference for Rust attribute syntax used by <code>#[reflect(...)]</code></ul><h2 id=full-code-diff>Full Code Diff</h2><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/crates/bevy_camera/src/primitives.rs b/crates/bevy_camera/src/primitives.rs
</span><span>index 9d2a5203c6669..e03c07ce99bc3 100644
</span><span>--- a/crates/bevy_camera/src/primitives.rs
</span><span>+++ b/crates/bevy_camera/src/primitives.rs
</span><span>@@ -218,7 +218,7 @@ impl Sphere {
</span><span> /// from the plane to the origin is `-8.0` along `NEG_Z`.
</span><span> ///
</span><span> /// It is used to define a [`Frustum`], but is also a useful mathematical primitive for rendering tasks such as  light computation.
</span><span>-#[derive(Clone, Copy, Debug, Default)]
</span><span>+#[derive(Clone, Copy, Reflect, Debug, Default)]
</span><span> pub struct HalfSpace {
</span><span>     normal_d: Vec4,
</span><span> }
</span><span>@@ -285,7 +285,6 @@ impl HalfSpace {
</span><span> #[derive(Component, Clone, Copy, Debug, Default, Reflect)]
</span><span> #[reflect(Component, Default, Debug, Clone)]
</span><span> pub struct Frustum {
</span><span>-    #[reflect(ignore, clone)]
</span><span>     pub half_spaces: [HalfSpace; 6],
</span><span> }
</span><span> 
</span><span>@@ -484,7 +483,6 @@ pub fn face_index_to_name(face_index: usize) -> &'static str {
</span><span> #[derive(Component, Clone, Debug, Default, Reflect)]
</span><span> #[reflect(Component, Default, Debug, Clone)]
</span><span> pub struct CubemapFrusta {
</span><span>-    #[reflect(ignore, clone)]
</span><span>     pub frusta: [Frustum; 6],
</span><span> }
</span><span> 
</span><span>@@ -536,7 +534,6 @@ pub enum CubemapLayout {
</span><span> #[derive(Component, Debug, Default, Reflect, Clone)]
</span><span> #[reflect(Component, Default, Debug, Clone)]
</span><span> pub struct CascadesFrusta {
</span><span>-    #[reflect(ignore, clone)]
</span><span>     pub frusta: EntityHashMap&LTVec&LTFrustum>>,
</span><span> }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22693.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>