<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22722 Add extra padding to font atlases
        
    </title><meta content="#22722 Add extra padding to font atlases" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-31</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22722-zh-cn-20260131>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add extra padding to font atlases<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22722<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Rendering, A-Text, D-Straightforward, S-Needs-Review<li><strong>Created</strong>: 2026-01-27T11:03:32Z<li><strong>Merged</strong>: 2026-01-30T23:11:25Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Text rendered with Text2d sometimes shows visual artifacts:<p>https://cdn.discordapp.com/attachments/885021580353237032/1465484728512675902/screenshot-2026-01-26-at-15.08.45.png?ex=69794682&is=6977f502&hm=e22ced378cafba3d97d77d322c41405e01e1027cdaf8108ff300c0f3f174c0f8&<p>Fixes #22716<h2 id=solution>Solution</h2><p>This is probably because the font atlases are too tightly packed for non-pixel aligned text. Add an extra pixel of padding to the font atlases.<h1></h1><p>Adding extra padding is enough to remove the artifacts as reported, but longer term:<ol><li><p>We should look into better font rendering for Text2d that produces high quality text regardless of scaling and sub pixel coords.</p><li><p>The texture atlas builder should support extrusion.</p></ol><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a specific visual artifact issue in Bevy’s text rendering system. The problem manifested as rendering artifacts when displaying text using the Text2d component, particularly with non-pixel-aligned text positioning. The provided screenshot shows visible artifacts that degrade text quality.<p>The root cause was identified as insufficient padding between glyphs in the font texture atlases. Font atlases in Bevy pack multiple glyphs into a single texture to reduce draw calls. When text isn’t perfectly aligned to pixel boundaries (due to sub-pixel positioning or scaling), neighboring glyphs in the atlas can “bleed” into each other because texture sampling may interpolate across the tight boundaries between glyphs.<p>The fix is straightforward but effective: increasing the padding between glyphs from 1 pixel to 2 pixels in the <code>DynamicTextureAtlasBuilder</code>. This additional space provides a buffer that prevents texture sampling from adjacent glyphs when rendering text at non-integer coordinates or with scaling applied.<p>The implementation changed a single line in the font atlas initialization code. While simple, this change required understanding the relationship between texture atlas packing, texture filtering, and sub-pixel rendering. The one-pixel increase doubles the padding, which is significant because it creates a full pixel of transparent space on all sides of each glyph, ensuring that bilinear filtering won’t sample from neighboring glyphs even with sub-pixel offsets.<p>Looking at the broader context, this fix represents a pragmatic short-term solution. As noted in the PR description, more comprehensive solutions would involve either improved font rendering techniques that handle sub-pixel positioning more gracefully, or implementing texture extrusion in the atlas builder itself. Texture extrusion duplicates border pixels outward, creating natural padding without increasing the actual distance between glyph rectangles in UV coordinates. However, implementing extrusion would require more extensive changes to the texture atlas system.<p>The choice to simply increase padding reflects good engineering judgment: it solves the immediate problem with minimal risk and code changes, while acknowledging that more sophisticated solutions could be implemented later if needed. This approach balances fix delivery speed with technical debt considerations.<p>The change is localized to the font atlas creation process, so it doesn’t affect other systems using texture atlases. The performance impact is minimal - slightly larger texture atlases that may hold fewer glyphs before requiring expansion, but the memory increase is proportional to the padding increase, which for typical font sizes represents a small percentage increase in texture memory usage.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Text2d Rendering] --> B{Text Positioning}
</span><span>    B -->|Pixel-aligned| C[Clean Rendering]
</span><span>    B -->|Non-pixel-aligned| D[Visual Artifacts]
</span><span>    D --> E[Glyph Bleeding]
</span><span>    E --> F{Solution}
</span><span>    F -->|Increase Padding| G[Font Atlas Creation]
</span><span>    G --> H[DynamicTextureAtlasBuilder]
</span><span>    H --> I[Padding: 1 → 2 pixels]
</span><span>    I --> J[Fixed Rendering]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-font-atlas-rs-1-1><code>crates/bevy_text/src/font_atlas.rs</code> (+1/-1)</h3><p>This file contains the <code>FontAtlas</code> struct responsible for managing font texture atlases. The change modifies the padding value when creating a new <code>DynamicTextureAtlasBuilder</code>.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>dynamic_texture_atlas_builder</span><span style=color:#61676ccc>: </span><span>DynamicTextureAtlasBuilder</span><span style=color:#ed9366>::</span><span>new(size</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1</span><span>)</span><span style=color:#61676ccc>,
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>dynamic_texture_atlas_builder</span><span style=color:#61676ccc>: </span><span>DynamicTextureAtlasBuilder</span><span style=color:#ed9366>::</span><span>new(size</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>2</span><span>)</span><span style=color:#61676ccc>,
</span></code></pre><p>The change increases the padding parameter from 1 to 2 pixels. This padding is used when packing glyphs into the texture atlas to prevent texture bleeding between adjacent glyphs during rendering, especially when text is not pixel-aligned.<h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Texture Atlas Techniques</strong>: For understanding advanced texture packing methods including extrusion and rotation</p> <ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/nothings/stb/blob/master/stb_rect_pack.h target=_blank>Texture Packing Algorithms</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/libgdx/libgdx/wiki/Texture-packer target=_blank>Texture Atlas Generation with Extrusion</a></ul><li><p><strong>Font Rendering and Sub-pixel Positioning</strong>:</p> <ul><li><a rel="noopener nofollow noreferrer" href=https://freetype.org/freetype2/docs/glyphs/glyphs-3.html target=_blank>FreeType Glyph Metrics</a><li><a rel="noopener nofollow noreferrer" href=https://developer.apple.com/library/archive/documentation/TextFonts/Conceptual/CocoaTextArchitecture/Art/Subpixel_Antialiasing/subpixel_antialiasing_2x.png target=_blank>Subpixel Rendering Techniques</a></ul><li><p><strong>Bevy Text Rendering</strong>:</p> <ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_text/latest/bevy_text/ target=_blank>Bevy Text Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_text target=_blank>Bevy Render Pipeline for Text</a></ul><li><p><strong>Texture Filtering and Bleeding</strong>:</p> <ul><li><a rel="noopener nofollow noreferrer" href=https://www.khronos.org/opengl/wiki/Texture#Filtering target=_blank>OpenGL Texture Filtering</a><li><a rel="noopener nofollow noreferrer" href=https://learnopengl.com/Advanced-OpenGL/Texturing target=_blank>Mipmapping and Texture Borders</a></ul></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22722.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>