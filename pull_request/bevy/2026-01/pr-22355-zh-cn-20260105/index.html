<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22355 Clarify glTF coordinate conversion documentation
        
    </title><meta content="#22355 Clarify glTF coordinate conversion documentation" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-05</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-01/pr-22355-en-20260105>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><p>Clarify glTF coordinate conversion documentation<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Clarify glTF coordinate conversion documentation<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22355<li><strong>Author</strong>: greeble-dev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, S-Ready-For-Final-Review, A-glTF<li><strong>Created</strong>: 2026-01-02T13:50:14Z<li><strong>Merged</strong>: 2026-01-05T02:31:22Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=mu-biao>目标</h1><p>为glTF坐标转换的文档添加更多信息。这试图解决在 #22209 中提出的问题。<h2 id=jie-jue-fang-an>解决方案</h2><p>新的文档精确覆盖了哪些实体会拥有正确的<code>Transform::forward</code>，假设glTF文件在场景和节点中都一致地使用了标准的glTF坐标系。<p>我还恢复了0.17文档中存在的警告：<blockquote><p><em>警告：这是一个实验性功能。行为可能在未来的版本中改变。</em></blockquote><p>这是因为：<ol><li>我想在0.19中<a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/22354 target=_blank>添加节点转换</a>，这可能会涉及改变场景转换的工作方式。<li>Cart提到过<a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20394#discussion_r2586861990 target=_blank>BSN可能会重组场景</a>，这也可能改变场景转换的工作方式。</ol><p>截图：</p><img alt=image height=1519 src=https://github.com/user-attachments/assets/ca37dd14-81f1-4adb-86fe-d8c593956c27 width=1252><p>如果这个PR被合并，我可能会做另一个PR来更新迁移指南——我无法在这个PR中更新它，因为指南只存在于0.18分支中。<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这个PR始于issue #22209中用户对glTF坐标转换行为的困惑。具体来说，开发者在使用<code>GltfConvertCoordinates</code>选项时，不清楚哪些实体会受到转换影响，以及它们的<code>Transform::forward</code>方向会如何变化。<p>在分析问题时，作者发现现有的文档没有明确说明转换行为的确切范围。用户需要知道：启用转换选项后，场景中哪些实体的前向向量会与Bevy的标准（-Z）对齐，哪些不会。这种不确定性导致了使用错误和困惑。<p>问题的核心在于Bevy的glTF加载器处理坐标系统转换的方式。glTF的标准坐标系是+Y向上，+Z向前，而Bevy使用+Y向上，-Z向前。为了解决这个差异，Bevy提供了<code>GltfConvertCoordinates</code>配置选项，但文档没有清晰说明转换的应用边界。<p>作者采用了直接明了的解决方案：更新文档字符串以提供精确的行为说明。主要的改进包括：<ol><li><p><strong>恢复实验性警告</strong>：重新添加了“CAUTION: This is an experimental feature. Behavior may change in future versions.“的警告。这是必要的，因为作者计划在未来的0.19版本中添加节点转换功能，而且Bevy的场景系统（BSN）可能会进行重构，这两者都可能改变当前的转换行为。</p><li><p><strong>明确转换范围</strong>：文档现在明确指出转换只影响特定类型的实体：</p> <ul><li><code>rotate_scene_entity</code>选项只影响带有<code>SceneInstance</code>组件的实体<li><code>rotate_meshes</code>选项只影响带有<code>Mesh3d</code>组件的实体<li>对应glTF节点的实体不会被转换</ul><li><p><strong>提供行为预测</strong>：文档现在明确说明了在标准glTF文件（遵循glTF坐标系规范）中，哪些实体的<code>Transform::forward</code>会正确对齐。这对于开发者调试和设计场景至关重要。</p></ol><p>技术实现上，这个PR只修改了文档注释，没有改变任何代码逻辑。然而，这种文档改进对于用户体验的影响是显著的。它通过准确描述系统行为来管理用户期望，并预先警告了未来可能的变化，这有助于避免因API变更导致的代码破坏。<p>一个关键的技术细节是：相机和灯光已经是例外情况，它们默认使用Bevy的坐标系。这意味着无论是否启用转换，相机和灯光的<code>Transform::forward</code>都会与Bevy的标准对齐。文档现在明确指出了这一点，解决了用户可能存在的误解。<p>从工程角度看，这个PR展示了良好文档实践的几个原则：<ul><li>明确说明功能的边界条件<li>提前警告潜在的破坏性变更<li>使用具体的示例说明行为<li>区分不同选项的精确影响范围</ul><p>这些改进将帮助开发者更有效地使用glTF坐标转换功能，减少调试时间，并为未来的API变更做好准备。文档现在准确地反映了当前实现的行为，同时为即将到来的功能变更设置了适当的期望。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[glTF Scene File&LTbr>+Z forward] --> B{GltfConvertCoordinates}
</span><span>    B -- rotate_scene_entity --> C[SceneInstance Entity&LTbr>Transform adjusted]
</span><span>    B -- rotate_meshes --> D[Mesh3d Entities&LTbr>Mesh data adjusted]
</span><span>    B -- No conversion --> E[glTF Node Entities&LTbr>No transform change]
</span><span>    F[Cameras & Lights] --> G[Always use Bevy coords&LTbr>-Z forward]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-gltf-src-convert-coordinates-rs-20-14><code>crates/bevy_gltf/src/convert_coordinates.rs</code> (+20/-14)</h3><p>这个文件包含了<code>GltfConvertCoordinates</code>结构体的定义及其文档注释。所有的修改都是文档改进，没有改变代码逻辑。<p><strong>主要修改包括：</strong><ol><li><p><strong>恢复实验性警告</strong>：在文档开头添加了警告，表明这是实验性功能，行为可能在将来改变。</p><li><p><strong>澄清转换行为</strong>：更详细地说明了哪些实体会受到转换影响，哪些不会。特别明确了对应glTF节点的实体不会被转换。</p><li><p><strong>改进选项描述</strong>：使<code>rotate_scene_entity</code>和<code>rotate_meshes</code>的文档更精确，说明它们各自影响哪些实体。</p></ol><p><strong>关键代码片段：</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 在结构体文档中添加的警告和更详细的行为说明
</span><span style=color:#abb0b6;font-style:italic>/// Options for converting scenes and assets from glTF's [standard coordinate system](https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html#coordinate-system-and-units)
</span><span style=color:#abb0b6;font-style:italic>/// (+Z forward) to Bevy's coordinate system (-Z forward).
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// _CAUTION: This is an experimental feature. Behavior may change in future versions._
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// The exact coordinate system conversion is as follows:
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// - glTF:
</span><span style=color:#abb0b6;font-style:italic>///   - forward: +Z
</span><span style=color:#abb0b6;font-style:italic>///   - up: +Y
</span><span style=color:#abb0b6;font-style:italic>///   - right: +X
</span><span style=color:#abb0b6;font-style:italic>/// - Bevy:
</span><span style=color:#abb0b6;font-style:italic>///   - forward: -Z
</span><span style=color:#abb0b6;font-style:italic>///   - up: +Y
</span><span style=color:#abb0b6;font-style:italic>///   - right: +X
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// Cameras and lights are an exception - they already use Bevy's coordinate
</span><span style=color:#abb0b6;font-style:italic>/// system. This means cameras and lights will match Bevy's forward even if
</span><span style=color:#abb0b6;font-style:italic>/// conversion is disabled.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// If a glTF file uses the standard coordinate system, then the conversion
</span><span style=color:#abb0b6;font-style:italic>/// options will behave like so:
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// - `rotate_scene_entity` will make the glTF's scene forward align with the [`Transform::forward`]
</span><span style=color:#abb0b6;font-style:italic>///   of the entity with the [`SceneInstance`](bevy_scene::SceneInstance) component.
</span><span style=color:#abb0b6;font-style:italic>/// - `rotate_meshes` will do the same for entities with a `Mesh3d` component.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// Other entities in the scene are not converted, so their forward may not
</span><span style=color:#abb0b6;font-style:italic>/// match `Transform::forward`. In particular, the entities that correspond to
</span><span style=color:#abb0b6;font-style:italic>/// glTF nodes are not converted.
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// rotate_scene_entity 字段的文档改进
</span><span style=color:#abb0b6;font-style:italic>/// If true, convert scenes by rotating the top-level transform of the scene entity.
</span><span style=color:#abb0b6;font-style:italic>/// This will ensure that [`Transform::forward`] of the "root" entity (the one with [`SceneInstance`](bevy_scene::SceneInstance))
</span><span style=color:#abb0b6;font-style:italic>/// aligns with the "forward" of the glTF scene.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// The scene entity is created by the glTF loader. Its parent is the entity
</span><span style=color:#abb0b6;font-style:italic>/// with the `SceneInstance` component, and its children are the root nodes
</span><span style=color:#abb0b6;font-style:italic>/// of the glTF scene.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// This option only changes the transform of the scene entity. It does not
</span><span style=color:#abb0b6;font-style:italic>/// directly change the transforms of node entities - it only changes them
</span><span style=color:#abb0b6;font-style:italic>/// indirectly through transform inheritance.
</span><span style=color:#fa6e32>pub</span><span> rotate_scene_entity</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// rotate_meshes 字段的文档改进  
</span><span style=color:#abb0b6;font-style:italic>/// If true, convert mesh assets and skinned mesh bind poses.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// This option only changes mesh assets and the transforms of entities that
</span><span style=color:#abb0b6;font-style:italic>/// instance meshes through [`Mesh3d`](bevy_mesh::Mesh3d).
</span><span style=color:#fa6e32>pub</span><span> rotate_meshes</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span></code></pre><p>这些修改直接解决了issue #22209中提出的困惑，通过明确文档来帮助用户理解glTF坐标转换的确切行为。<h2 id=further-reading>Further Reading</h2><ol><li><strong>glTF 2.0规范</strong> - 了解glTF标准坐标系：<a rel="noopener nofollow noreferrer" href=https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html#coordinate-system-and-units target=_blank>Khronos glTF Specification</a><li><strong>Bevy场景系统</strong> - 了解Bevy如何管理场景和实体：<a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_scene/latest/bevy_scene/ target=_blank>Bevy Scene Documentation</a><li><strong>坐标系统转换</strong> - 3D图形中坐标系统转换的基础知识：<a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Transformation_matrix target=_blank>3D Coordinate System Transformations</a><li><strong>相关Issue</strong> - 这个问题起源的讨论：<a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/22209 target=_blank>Issue #22209</a><li><strong>未来计划</strong> - 计划中的节点转换功能：<a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/22354 target=_blank>Issue #22354</a></ol><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/crates/bevy_gltf/src/convert_coordinates.rs b/crates/bevy_gltf/src/convert_coordinates.rs index 3ccb52e95ef7e..eaecbd3aeaca8 100644 — a/crates/bevy_gltf/src/convert_coordinates.rs +++ b/crates/bevy_gltf/src/convert_coordinates.rs @@ -33,7 +33,10 @@ impl ConvertCoordinates for [f32; 4] { /// Options for converting scenes and assets from glTF’s <a rel="noopener nofollow noreferrer" href=https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html#coordinate-system-and-units target=_blank>standard coordinate system</a> /// (+Z forward) to Bevy’s coordinate system (-Z forward). /// +/// <em>CAUTION: This is an experimental feature. Behavior may change in future versions.</em> +/// /// The exact coordinate system conversion is as follows: +/// /// - glTF: /// - forward: +Z /// - up: +Y @@ -43,36 +46,39 @@ impl ConvertCoordinates for [f32; 4] { /// - up: +Y /// - right: +X /// -/// Note that some glTF files may not follow the glTF standard. +/// Cameras and lights are an exception - they already use Bevy’s coordinate +/// system. This means cameras and lights will match Bevy’s forward even if +/// conversion is disabled. /// -/// If your glTF scene is +Z forward and you want it converted to match Bevy’s -/// <code>Transform::forward</code>, enable the <code>rotate_scene_entity</code> option. If you also want <code>Mesh</code> -/// assets to be converted, enable the <code>rotate_meshes</code> option. +/// If a glTF file uses the standard coordinate system, then the conversion +/// options will behave like so: /// -/// Cameras and lights in glTF files are an exception - they already use Bevy’s -/// coordinate system. This means cameras and lights will match -/// <code>Transform::forward</code> even if conversion is disabled. +/// - <code>rotate_scene_entity</code> will make the glTF’s scene forward align with the [<code>Transform::forward</code>] +/// of the entity with the <a href=https://unknownue.github.io/pull_request/bevy/2026-01/pr-22355-zh-cn-20260105/bevy_scene::SceneInstance><code>SceneInstance</code></a> component. +/// - <code>rotate_meshes</code> will do the same for entities with a <code>Mesh3d</code> component. +/// +/// Other entities in the scene are not converted, so their forward may not +/// match <code>Transform::forward</code>. In particular, the entities that correspond to +/// glTF nodes are not converted. #[derive(Copy, Clone, Default, Debug, Serialize, Deserialize)] pub struct GltfConvertCoordinates { /// If true, convert scenes by rotating the top-level transform of the scene entity.<ul><li>/// /// This will ensure that [<code>Transform::forward</code>] of the “root” entity (the one with <a href=https://unknownue.github.io/pull_request/bevy/2026-01/pr-22355-zh-cn-20260105/bevy_scene::SceneInstance><code>SceneInstance</code></a>) /// aligns with the “forward” of the glTF scene. ///<li>/// The glTF loader creates an entity for each glTF scene. Entities are<li>/// then created for each node within the glTF scene. Nodes without a<li>/// parent in the glTF scene become children of the scene entity.</ul><ul><li>/// The scene entity is created by the glTF loader. Its parent is the entity<li>/// with the <code>SceneInstance</code> component, and its children are the root nodes<li>/// of the glTF scene. /// /// This option only changes the transform of the scene entity. It does not /// directly change the transforms of node entities - it only changes them /// indirectly through transform inheritance. pub rotate_scene_entity: bool,</ul><ul><li>/// If true, convert mesh assets. This includes skinned mesh bind poses.</ul><ul><li>/// If true, convert mesh assets and skinned mesh bind poses. /// /// This option only changes mesh assets and the transforms of entities that</ul><ul><li>/// instance meshes. It does not change the transforms of entities that<li>/// correspond to glTF nodes.</ul><ul><li>/// instance meshes through <a href=https://unknownue.github.io/pull_request/bevy/2026-01/pr-22355-zh-cn-20260105/bevy_mesh::Mesh3d><code>Mesh3d</code></a>. pub rotate_meshes: bool, }</ul><pre style=color:#61676c;background-color:#fafafa><code></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22355.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>