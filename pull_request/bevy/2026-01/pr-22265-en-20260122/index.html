<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22265 Upgrade to wgpu 28
        
    </title><meta content="#22265 Upgrade to wgpu 28" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22265-zh-cn-20260122>中文</a></div></div><div class=pr-content><h1 id=upgrade-to-wgpu-28>Upgrade to wgpu 28</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Upgrade to wgpu 28<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22265<li><strong>Author</strong>: ChristopherBiscardi<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Dependencies, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-12-25T01:07:06Z<li><strong>Merged</strong>: 2026-01-22T19:02:13Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>Upgrade to wgpu 28<blockquote><p>[!important] This can’t merge until https://github.com/bevyengine/naga_oil/pull/132 does, and the dependency is updated from my fork to the release.<p>Also requires wgpu 28 in dlss_wgpu: https://github.com/bevyengine/dlss_wgpu/pull/17</blockquote><blockquote><p>[!note] This does not enable mesh shaders, and neither does the naga_oil PR. I chose to do an upgrade first, then go back and see about mesh shaders.</blockquote><p>Here’s a general list of changes and what I did. Commits are grouped by feature except for the last one, which enabled solari when I ran the solari example.<h2 id=mipmapfiltermode-is-split-from-filtermode>MipmapFilterMode is split from FilterMode</h2><ul><li>Split MipmapFilterMode from FilterMode #8314: https://github.com/gfx-rs/wgpu/pull/8314</ul><p>solution: implement From for <code>MipmapFilterMode</code>/<code>ImageFilterMode</code> since the values are the same. The split was because the spec indicates they are different types, even though they have the same values.<h2 id=push-constants-are-now-immediates>Push Constants are now Immediates</h2><ul><li>https://github.com/gfx-rs/wgpu/pull/8724</ul><p>immediate_size is <a rel="noopener nofollow noreferrer" href=https://docs.rs/wgpu/28.0.0/wgpu/struct.PipelineLayoutDescriptor.html#structfield.immediate_size target=_blank>a u32</a> so use that instead of <code>PushConstantRange</code><h2 id=capabilities-name-changes>Capabilities name changes</h2><ul><li>https://github.com/gfx-rs/wgpu/pull/8671</ul><p>Got new list from https://github.com/gfx-rs/wgpu/blob/trunk/wgpu-core/src/device/mod.rs#L449 and copied it in.<h2 id=subgroup-min-max-size-moved-from-limits-to-adapterinfo>subgroup_{min,max}_size moved from Limits to AdapterInfo</h2><ul><li>https://github.com/gfx-rs/wgpu/pull/8609</ul><p>Update the limits to have the fields they have now, mirror the logic from the other limits calls.<h2 id=multiview-mask>multiview_mask</h2><ul><li>https://github.com/gfx-rs/wgpu/pull/8206</ul><p>set to None because we don’t use it currently. Its vaguely for VR.<h2 id=error-scope-is-now-a-guard>error scope is now a guard</h2><ul><li>https://github.com/gfx-rs/wgpu/pull/8685</ul><p>retain guard and then pop() it later<hr><p>I made one mistake during the PR, thinking set_immediates was going to be the size of the immediates and not the offset. I’d like reviewers to take a look at immediates offset and size sites specifically just in case I missed something.<p>Here’s a bunch of examples running</p><img alt="screenshot-2025-12-24-at-16 47 22@2x" height=1040 src=https://github.com/user-attachments/assets/83dcf4c8-69f5-480a-b724-86598530f25a width=1470><img alt="screenshot-2025-12-24-at-16 48 44@2x" height=1040 src=https://github.com/user-attachments/assets/46d897fa-1ab2-44ef-8055-fe2fce740dbc width=1470><img alt="screenshot-2025-12-24-at-16 49 10@2x" height=1040 src=https://github.com/user-attachments/assets/6ae7a9bf-0473-4800-8dfc-233a6a41d6df width=1470><img alt="screenshot-2025-12-24-at-16 49 31@2x" height=1040 src=https://github.com/user-attachments/assets/89f84a26-cfbd-4196-bca8-111c3d20ba7b width=1470><h2 id=known-issues>Known Issues</h2><blockquote><p>[!NOTE]<p>There are no current known issues. Everything previous has been solved.</blockquote><ul><li><input checked disabled type=checkbox> enable extensions can not be written in naga oil in a way that allows them to be used in composed modules.</ul><p>Update: this was fixed by introducing a flag in naga-oil to force shaders to allow ray queries in composed modules when using bevy_solari. This is temporary and will be different in WESL-future.<details><summary>old explanation</summary> This is blocking solari from working on nvidia (solari runs successfully on macos m1) because it needs `enable wgpu_ray_query;`. Putting the declaration before `#define_import_path` means it gets stripped out (afaict), and putting it after results in <pre style=color:#61676c;background-color:#fafafa><code><span>error: expected global declaration, but found a global directive
</span><span>  ┌─ embedded://bevy_solari/scene/raytracing_scene_bindings.wgsl:3:1
</span><span>  │
</span><span>3 │ enable wgpu_ray_query;
</span><span>  │ ^^^^^^ written after first global declaration
</span><span>  │
</span><span>  = expected global declaration, but found a global directive
</span></code></pre></details><ul><li><input checked disabled type=checkbox> dlss_wgpu mixes apis which <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/dlss_wgpu/pull/17#issuecomment-3690847524 target=_blank>causes panics now</a>.</ul><details><summary>Previous notes as dlss_wgpu was being fixed here</summary> <p>The wgpu release notes don’t mention which PR this was introduced in, only saying:</p> <blockquote><p>Using both the wgpu command encoding APIs and CommandEncoder::as_hal_mut on the same encoder will now result in a panic.</blockquote> <p>It was caused by https://github.com/gfx-rs/wgpu/pull/8373 which claimed to not know of any use cases</p> <blockquote><p>With record on finish, the actual ordering on the command buffer is deeply counter intuitive (all as_hal would come first) and I think it additionally was just flat out broken in some ways<ul><li>https://discord.com/channels/691052431525675048/743663924229963868/1453786307099758683</ul></blockquote> <p>Possible path forward is using multiple command buffers: https://discord.com/channels/691052431525675048/743663924229963868/1453795633503670415</p> <h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2> <p>This PR updates Bevy’s rendering engine from wgpu 27 to wgpu 28, which involves adapting to several breaking API changes in the underlying graphics library. The upgrade was necessary to stay current with wgpu development and access new features, but required careful coordination with upstream dependencies like naga_oil and dlss_wgpu.</p> <p>The developer faced multiple distinct API changes that needed to be addressed systematically. Rather than attempting to enable new features like mesh shaders immediately, they chose a pragmatic approach: first complete the base upgrade to establish a working foundation, then consider enabling new features in subsequent PRs. This incremental strategy minimized risk and allowed focused testing of the core changes.</p> <p>The implementation approach involved analyzing each wgpu breaking change individually and applying corresponding fixes throughout Bevy’s codebase. The developer grouped commits by feature to maintain clarity, with each commit addressing a specific wgpu API change. They also noted a specific area where they initially misunderstood the new API (thinking <code>set_immediates</code> expected size instead of offset), and requested additional review attention on that aspect.</p> <p>One of the most significant changes was the rename from “push constants” to “immediates.” While this might seem like a simple terminology change, it actually represents a conceptual shift in how these small, fast constants are handled in the pipeline. The wgpu team made this change to better align with the underlying hardware concepts and WebGPU specification. In practice, this required updating both the pipeline descriptor structures (replacing <code>push_constant_ranges: Vec&LTPushConstantRange></code> with <code>immediate_size: u32</code>) and all usage sites that set these values (changing <code>set_push_constants</code> to <code>set_immediates</code>).</p> <p>The MipmapFilterMode separation from FilterMode was another breaking change that affected many sampler creation calls throughout the codebase. While the enum values remained the same, wgpu now treats these as distinct types for better type safety and specification compliance. The solution implemented bidirectional <code>From</code> conversions between Bevy’s <code>ImageFilterMode</code> and wgpu’s <code>MipmapFilterMode</code>, allowing existing code to work with minimal changes.</p> <p>Several other changes required updates to match wgpu’s evolving API:</p> <ul><li>Capability names in the shader compiler needed updating to match wgpu’s new feature flag naming<li>Subgroup size limits moved from the <code>Limits</code> struct to <code>AdapterInfo</code><li>A new <code>multiview_mask</code> field was added to render pass descriptors (set to <code>None</code> since Bevy doesn’t use VR multiview rendering)<li>Error scope handling changed from a manual push/pop pattern to a guard-based API</ul> <p>The DLSS integration presented a specific challenge due to wgpu’s stricter enforcement against mixing command encoder APIs. The fix involved having DLSS return a separate command buffer that Bevy then adds to the render context, rather than mixing wgpu APIs within the same encoder.</p> <p>Throughout the implementation, the developer maintained backward compatibility where possible while updating to the new API. They ran multiple examples to verify functionality and provided screenshots as evidence of successful execution. The PR also required updating several dependency versions, including naga_oil to 0.21 and dlss_wgpu to version 3, and bumping the minimum Rust version to 1.92.0.</p> <h2 id=visual-representation>Visual Representation</h2> <pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph "wgpu 28 API Changes"
</span><span>        A[Push Constants → Immediates]
</span><span>        B[FilterMode Split]
</span><span>        C[Capability Renames]
</span><span>        D[Subgroup Size Move]
</span><span>        E[Multiview Mask]
</span><span>        F[Error Scope Guard]
</span><span>    end
</span><span>    
</span><span>    subgraph "Bevy Adaptations"
</span><span>        G[Pipeline Descriptors]
</span><span>        H[Sampler Creation]
</span><span>        I[Shader Compilation]
</span><span>        J[Renderer Initialization]
</span><span>        K[Render Pass Setup]
</span><span>        L[Error Handling]
</span><span>    end
</span><span>    
</span><span>    subgraph "Dependency Updates"
</span><span>        M[naga_oil 0.21]
</span><span>        N[dlss_wgpu v3]
</span><span>        O[Rust 1.92.0]
</span><span>    end
</span><span>    
</span><span>    A --> G
</span><span>    B --> H
</span><span>    C --> I
</span><span>    D --> J
</span><span>    E --> K
</span><span>    F --> L
</span><span>    
</span><span>    G --> P[Working Examples]
</span><span>    H --> P
</span><span>    I --> P
</span><span>    J --> P
</span><span>    K --> P
</span><span>    L --> P
</span><span>    
</span><span>    M --> I
</span><span>    N --> P
</span><span>    O --> P
</span></code></pre> <h2 id=key-files-changed>Key Files Changed</h2> <h3 id=crates-bevy-render-src-renderer-mod-rs-48-26><code>crates/bevy_render/src/renderer/mod.rs</code> (+48/-26)</h3> <p>This file handles renderer initialization and needed updates for wgpu’s new API, particularly around adapter enumeration and limits structure.</p> <p><strong>Key Changes:</strong></p> <ul><li>Updated adapter enumeration to use async API on Linux<li>Modified limits structure to match wgpu 28’s new field names and organization<li>Added support for new mesh/task shader limits</ul> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (wgpu 27 limits):
</span><span>max_push_constant_size</span><span style=color:#61676ccc>:</span><span> limits
</span><span>    </span><span style=color:#ed9366>.</span><span>max_push_constant_size
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>min</span><span>(constrained_limits</span><span style=color:#ed9366>.</span><span>max_push_constant_size)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (wgpu 28 limits):
</span><span>max_immediate_size</span><span style=color:#61676ccc>:</span><span> limits
</span><span>    </span><span style=color:#ed9366>.</span><span>max_immediate_size
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>min</span><span>(constrained_limits</span><span style=color:#ed9366>.</span><span>max_immediate_size)</span><span style=color:#61676ccc>,
</span></code></pre> <h3 id=crates-bevy-render-src-render-resource-pipeline-cache-rs-19-28><code>crates/bevy_render/src/render_resource/pipeline_cache.rs</code> (+19/-28)</h3> <p>This file manages pipeline compilation and caching, and needed updates for the push constants → immediates change.</p> <p><strong>Key Changes:</strong></p> <ul><li>Changed pipeline layout caching key from <code>(Vec&LTBindGroupLayoutId>, Vec&LTPushConstantRange>)</code> to <code>(Vec&LTBindGroupLayoutId>, ImmediateSize)</code><li>Updated pipeline descriptor handling to use <code>immediate_size</code> instead of <code>push_constant_ranges</code><li>Modified render pipeline creation to pass <code>multiview_mask: None</code></ul> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>type </span><span style=color:#399ee6>LayoutCacheKey </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTBindGroupLayoutId></span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTPushConstantRange>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>type </span><span style=color:#399ee6>ImmediateSize </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>u32</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>type </span><span style=color:#399ee6>LayoutCacheKey </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTBindGroupLayoutId></span><span style=color:#61676ccc>,</span><span> ImmediateSize)</span><span style=color:#61676ccc>;
</span></code></pre> <h3 id=crates-bevy-render-src-render-phase-draw-state-rs-0-11><code>crates/bevy_render/src/render_phase/draw_state.rs</code> (+0/-11)</h3> <p>This file contains the tracked render pass wrapper, which needed updating for the push constants API change.</p> <p><strong>Key Changes:</strong></p> <ul><li>Renamed <code>set_push_constants</code> to <code>set_immediates</code> and removed the <code>stages</code> parameter<li>Updated documentation to reference <code>Features::IMMEDIATES</code> instead of <code>Features::PUSH_CONSTANTS</code></ul> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>set_push_constants</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>stages</span><span style=color:#61676ccc>:</span><span> ShaderStages, </span><span style=color:#ff8f40>offset</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>, </span><span style=color:#ff8f40>data</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[</span><span style=color:#fa6e32>u8</span><span>]) {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>pass</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_push_constants</span><span>(stages</span><span style=color:#61676ccc>,</span><span> offset</span><span style=color:#61676ccc>,</span><span> data)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>set_immediates</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>offset</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>, </span><span style=color:#ff8f40>data</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[</span><span style=color:#fa6e32>u8</span><span>]) {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>pass</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_immediates</span><span>(offset</span><span style=color:#61676ccc>,</span><span> data)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre> <h3 id=crates-bevy-shader-src-shader-cache-rs-60-31><code>crates/bevy_shader/src/shader_cache.rs</code> (+60/-31)</h3> <p>This file handles shader compilation and needed updates for wgpu’s new capability naming.</p> <p><strong>Key Changes:</strong></p> <ul><li>Completely rewrote the <code>get_capabilities</code> function to map wgpu 28 features to naga capabilities<li>Updated capability names to match wgpu’s new naming scheme (e.g., <code>PUSH_CONSTANT</code> → <code>IMMEDIATES</code>)<li>Added support for new capabilities like mesh shaders and texture atomic operations</ul> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example of updated capability mapping:
</span><span>capabilities</span><span style=color:#ed9366>.</span><span style=color:#f07171>set</span><span>(
</span><span>    Capabilities</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>IMMEDIATES</span><span style=color:#61676ccc>,
</span><span>    features</span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(Features</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>IMMEDIATES</span><span>)</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre> <h3 id=crates-bevy-pbr-src-meshlet-pipelines-rs-18-66><code>crates/bevy_pbr/src/meshlet/pipelines.rs</code> (+18/-66)</h3> <p>This file sets up meshlet rendering pipelines and needed updates for the push constants → immediates change.</p> <p><strong>Key Changes:</strong></p> <ul><li>Replaced <code>push_constant_ranges</code> with <code>immediate_size</code> in all compute pipeline descriptors<li>Updated values from <code>Vec&LTPushConstantRange></code> to simple <code>u32</code> size values</ul> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>push_constant_ranges</span><span style=color:#61676ccc>: </span><span style=color:#f07171>vec!</span><span>[PushConstantRange {
</span><span>    stages</span><span style=color:#61676ccc>: </span><span>ShaderStages</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>COMPUTE</span><span style=color:#61676ccc>,
</span><span>    range</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>4</span><span style=color:#61676ccc>,
</span><span>}]</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>immediate_size</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>4</span><span style=color:#61676ccc>,
</span></code></pre> <h3 id=crates-bevy-solari-src-realtime-node-rs-12-14><code>crates/bevy_solari/src/realtime/node.rs</code> (+12/-14)</h3> <p>This file handles Solari real-time lighting and needed updates for both the push constants change and wgpu_ray_query enabling.</p> <p><strong>Key Changes:</strong></p> <ul><li>Updated compute pipeline descriptors to use <code>immediate_size</code> instead of <code>push_constant_ranges</code><li>Changed <code>set_push_constants</code> calls to <code>set_immediates</code><li>Added <code>enable wgpu_ray_query;</code> declarations to WGSL shaders (handled via naga_oil changes)</ul> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>pass</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_push_constants</span><span>(
</span><span>    </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>    bytemuck</span><span style=color:#ed9366>::</span><span>cast_slice(</span><span style=color:#ed9366>&</span><span>[frame_index</span><span style=color:#61676ccc>,</span><span> solari_lighting</span><span style=color:#ed9366>.</span><span>reset </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>u32</span><span>])</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>pass</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_immediates</span><span>(
</span><span>    </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>    bytemuck</span><span style=color:#ed9366>::</span><span>cast_slice(</span><span style=color:#ed9366>&</span><span>[frame_index</span><span style=color:#61676ccc>,</span><span> solari_lighting</span><span style=color:#ed9366>.</span><span>reset </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>u32</span><span>])</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre> <h2 id=further-reading>Further Reading</h2> <ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/gfx-rs/wgpu/releases/tag/v28.0.0 target=_blank>wgpu 28.0.0 Release Notes</a> - Official changelog for wgpu 28<li><a rel="noopener nofollow noreferrer" href=https://www.w3.org/TR/webgpu/ target=_blank>WebGPU Specification</a> - The standard wgpu implements<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/next/render/ target=_blank>Bevy Rendering Architecture</a> - Bevy’s renderer documentation<li><a rel="noopener nofollow noreferrer" href=https://github.com/gfx-rs/naga target=_blank>Naga Shader Translation</a> - The shader translation library used by wgpu<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_pbr/src/meshlet/README.md target=_blank>GPU-Driven Rendering Techniques</a> - Background on meshlet rendering in Bevy</ol>    <div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22265.patch id=patch-info style=display:none></div>  <div class=bottom-spacer></div>