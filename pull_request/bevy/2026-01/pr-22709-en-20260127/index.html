<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22709 move Atmosphere to bevy_light
        
    </title><meta content="#22709 move Atmosphere to bevy_light" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-27</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22709-zh-cn-20260127>中文</a></div></div><div class=pr-content><h1 id=title-move-atmosphere-to-bevy-light>Title: move Atmosphere to bevy_light</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: move Atmosphere to bevy_light<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22709<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-01-26T00:31:22Z<li><strong>Merged</strong>: 2026-01-27T22:15:53Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><h1 id=objective>Objective</h1><ul><li>Another day, another step towards scene description outside of render crates</ul><h2 id=solution>Solution</h2><ul><li>Move Atmosphere to bevy_light.</ul><h2 id=testing>Testing</h2><ul><li>atmosphere example looks good.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR is part of an ongoing architectural refactoring in the Bevy game engine to separate scene description components from rendering implementation details. The goal is to move scene-related types out of rendering crates and into more appropriate locations, making the engine’s architecture cleaner and more maintainable.<p>The specific task here was to move the <code>Atmosphere</code> component and its related types from <code>bevy_pbr</code> (which handles physically-based rendering) to <code>bevy_light</code> (which contains lighting-related components). This makes architectural sense because atmospheric scattering is fundamentally a lighting effect that describes how light interacts with a planetary atmosphere.<p>The implementation required moving several interconnected components: the main <code>Atmosphere</code> struct, the <code>ScatteringMedium</code> asset, and supporting types like <code>ScatteringTerm</code>, <code>Falloff</code>, and <code>PhaseFunction</code>. These types define how light scatters through different atmospheric layers and are essential for creating realistic sky rendering.<p>One technical challenge emerged due to Rust’s orphan rules. The <code>Atmosphere</code> type needed to implement the <code>ExtractComponent</code> trait (defined in <code>bevy_pbr</code>) for extraction to the render world. However, since <code>Atmosphere</code> was moved to <code>bevy_light</code>, we couldn’t implement a trait from <code>bevy_pbr</code> on a type from <code>bevy_light</code>. The solution was to replace the trait implementation with a custom extraction system that manually extracts <code>Atmosphere</code> components during the render extraction phase.<p>The changes affect multiple parts of the codebase:<ol><li>A new <code>atmosphere.rs</code> module was created in <code>bevy_light</code> containing all the moved types<li>The <code>bevy_pbr::medium</code> module was significantly reduced since most of its content moved<li>Import statements throughout the codebase were updated to reference the new location<li>Plugin initialization was adjusted to register the <code>ScatteringMedium</code> asset in <code>LightPlugin</code> instead of <code>ScatteringMediumPlugin</code></ol><p>This refactoring doesn’t change the functionality but improves the code organization. Atmospheric scattering remains a complex system involving multiple scattering terms, falloff distributions, and phase functions that simulate how light interacts with atmospheric particles. The moved code includes physically-based defaults for Earth-like atmospheres with Rayleigh scattering (for gas molecules), Mie scattering (for aerosols), and ozone absorption layers.<p>The architectural benefit is that scene description components are now better separated from rendering implementation. This makes the codebase more modular and easier to maintain, and sets the stage for future improvements where scene description might be used by multiple rendering backends or for non-rendering purposes like physics simulations.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_pbr] --> B[Move Atmosphere components]
</span><span>    B --> C[bevy_light]
</span><span>    
</span><span>    subgraph "Components Moved"
</span><span>        D[Atmosphere]
</span><span>        E[ScatteringMedium]
</span><span>        F[ScatteringTerm]
</span><span>        G[Falloff]
</span><span>        H[PhaseFunction]
</span><span>    end
</span><span>    
</span><span>    C --> D
</span><span>    C --> E
</span><span>    E --> F
</span><span>    F --> G
</span><span>    F --> H
</span><span>    
</span><span>    I[bevy_pbr rendering] --> J[Extract Atmosphere via custom system]
</span><span>    J --> K[Render World]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-light-src-atmosphere-rs-400-0>1. <code>crates/bevy_light/src/atmosphere.rs</code> (+400/-0)</h3><p>This is a new file containing all the atmosphere-related types moved from <code>bevy_pbr</code>. It includes the <code>Atmosphere</code> component, <code>ScatteringMedium</code> asset, and supporting enums and structs.<p>Key code snippets:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// The main Atmosphere component that enables atmospheric scattering
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Component)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>require</span><span>(Hdr)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Atmosphere </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>bottom_radius</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>top_radius</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>ground_albedo</span><span style=color:#61676ccc>:</span><span> Vec3,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>medium</span><span style=color:#61676ccc>: </span><span>Handle&LTScatteringMedium>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// The ScatteringMedium asset defining how light interacts with the atmosphere
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(TypePath</span><span style=color:#61676ccc>,</span><span> Asset</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ScatteringMedium </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTCow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>falloff_resolution</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>phase_resolution</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>terms</span><span style=color:#61676ccc>: </span><span>SmallVec<[ScatteringTerm</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>1</span><span>]>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Default Earth-like atmosphere configuration
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ScatteringMedium </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>earthlike</span><span>(</span><span style=color:#ff8f40>falloff_resolution</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>, </span><span style=color:#ff8f40>phase_resolution</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>new(
</span><span>            falloff_resolution</span><span style=color:#61676ccc>,
</span><span>            phase_resolution</span><span style=color:#61676ccc>,
</span><span>            [
</span><span>                </span><span style=color:#abb0b6;font-style:italic>// Rayleigh scattering Term (atmospheric gases)
</span><span>                ScatteringTerm {
</span><span>                    absorption</span><span style=color:#61676ccc>: </span><span>Vec3</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#61676ccc>,
</span><span>                    scattering</span><span style=color:#61676ccc>: </span><span>Vec3</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>5.802e-6</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>13.558e-6</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>33.100e-6</span><span>)</span><span style=color:#61676ccc>,
</span><span>                    falloff</span><span style=color:#61676ccc>: </span><span>Falloff</span><span style=color:#ed9366>::</span><span>Exponential { scale</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>8.0 </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>60.0 </span><span>}</span><span style=color:#61676ccc>,
</span><span>                    phase</span><span style=color:#61676ccc>: </span><span>PhaseFunction</span><span style=color:#ed9366>::</span><span>Rayleigh</span><span style=color:#61676ccc>,
</span><span>                }</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#abb0b6;font-style:italic>// Mie scattering Term (aerosols/dust)
</span><span>                ScatteringTerm {
</span><span>                    absorption</span><span style=color:#61676ccc>: </span><span>Vec3</span><span style=color:#ed9366>::</span><span>splat(</span><span style=color:#ff8f40>3.996e-6</span><span>)</span><span style=color:#61676ccc>,
</span><span>                    scattering</span><span style=color:#61676ccc>: </span><span>Vec3</span><span style=color:#ed9366>::</span><span>splat(</span><span style=color:#ff8f40>0.444e-6</span><span>)</span><span style=color:#61676ccc>,
</span><span>                    falloff</span><span style=color:#61676ccc>: </span><span>Falloff</span><span style=color:#ed9366>::</span><span>Exponential { scale</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>1.2 </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>60.0 </span><span>}</span><span style=color:#61676ccc>,
</span><span>                    phase</span><span style=color:#61676ccc>: </span><span>PhaseFunction</span><span style=color:#ed9366>::</span><span>Mie { asymmetry</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.8 </span><span>}</span><span style=color:#61676ccc>,
</span><span>                }</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#abb0b6;font-style:italic>// Ozone absorption Term
</span><span>                ScatteringTerm {
</span><span>                    absorption</span><span style=color:#61676ccc>: </span><span>Vec3</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>0.650e-6</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.881e-6</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.085e-6</span><span>)</span><span style=color:#61676ccc>,
</span><span>                    scattering</span><span style=color:#61676ccc>: </span><span>Vec3</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#61676ccc>,
</span><span>                    falloff</span><span style=color:#61676ccc>: </span><span>Falloff</span><span style=color:#ed9366>::</span><span>Tent {
</span><span>                        center</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.75</span><span style=color:#61676ccc>,
</span><span>                        width</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.3</span><span style=color:#61676ccc>,
</span><span>                    }</span><span style=color:#61676ccc>,
</span><span>                    phase</span><span style=color:#61676ccc>: </span><span>PhaseFunction</span><span style=color:#ed9366>::</span><span>Isotropic</span><span style=color:#61676ccc>,
</span><span>                }</span><span style=color:#61676ccc>,
</span><span>            ]</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_label</span><span>(</span><span style=color:#86b300>"earthlike_atmosphere"</span><span>)
</span><span>    }
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-pbr-src-medium-rs-4-359>2. <code>crates/bevy_pbr/src/medium.rs</code> (+4/-359)</h3><p>This file was significantly reduced as most of its content moved to <code>bevy_light</code>. It now only contains the GPU representation of scattering media and the plugin setup.<p>Key changes:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Contained full ScatteringMedium, ScatteringTerm, Falloff, PhaseFunction definitions
</span><span style=color:#abb0b6;font-style:italic>// After: Only contains GpuScatteringMedium and plugin initialization
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ScatteringMediumPlugin</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ScatteringMediumPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Removed: app.init_asset::&LTScatteringMedium>()
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(RenderAssetPlugin</span><span style=color:#ed9366>::</span><span>&LTGpuScatteringMedium></span><span style=color:#ed9366>::</span><span>default())</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_app) </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_app_mut</span><span>(RenderApp) {
</span><span>            render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_scattering_medium_sampler)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=3-crates-bevy-pbr-src-atmosphere-mod-rs-32-63>3. <code>crates/bevy_pbr/src/atmosphere/mod.rs</code> (+32/-63)</h3><p>Updated to handle the moved <code>Atmosphere</code> component with a custom extraction system instead of using the <code>ExtractComponent</code> trait.<p>Key changes:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Replaced ExtractComponent implementation with custom extraction system
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>extract_atmosphere</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>previous_len</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>,
</span><span>    </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Extract&LTQuery<(RenderEntity, </span><span style=color:#ed9366>&</span><span>Atmosphere), With&LTCamera3d>>>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> values </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Vec</span><span style=color:#ed9366>::</span><span>with_capacity(</span><span style=color:#ed9366>*</span><span>previous_len)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>for </span><span>(entity</span><span style=color:#61676ccc>,</span><span> item) </span><span style=color:#ed9366>in &</span><span>query {
</span><span>        values</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>((
</span><span>            entity</span><span style=color:#61676ccc>,
</span><span>            ExtractedAtmosphere {
</span><span>                bottom_radius</span><span style=color:#61676ccc>:</span><span> item</span><span style=color:#ed9366>.</span><span>bottom_radius</span><span style=color:#61676ccc>,
</span><span>                top_radius</span><span style=color:#61676ccc>:</span><span> item</span><span style=color:#ed9366>.</span><span>top_radius</span><span style=color:#61676ccc>,
</span><span>                ground_albedo</span><span style=color:#61676ccc>:</span><span> item</span><span style=color:#ed9366>.</span><span>ground_albedo</span><span style=color:#61676ccc>,
</span><span>                medium</span><span style=color:#61676ccc>:</span><span> item</span><span style=color:#ed9366>.</span><span>medium</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>,
</span><span>            }</span><span style=color:#61676ccc>,
</span><span>        ))</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#ed9366>*</span><span>previous_len </span><span style=color:#ed9366>=</span><span> values</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()</span><span style=color:#61676ccc>;
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>try_insert_batch</span><span>(values)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Updated plugin to use the custom extraction system
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>AtmospherePlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other setup ...
</span><span>        
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_app) </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_app_mut</span><span>(RenderApp) {
</span><span>            render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(ExtractSchedule</span><span style=color:#61676ccc>,</span><span> extract_atmosphere)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=4-crates-bevy-light-src-lib-rs-7-1>4. <code>crates/bevy_light/src/lib.rs</code> (+7/-1)</h3><p>Updated to include the new atmosphere module and register the <code>ScatteringMedium</code> asset.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added module declaration and re-export
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>atmosphere</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>atmosphere</span><span style=color:#ed9366>::</span><span>Atmosphere</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Updated LightPlugin to initialize ScatteringMedium asset
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>LightPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other initialization ...
</span><span>        app</span><span style=color:#ed9366>.</span><span>init_asset</span><span style=color:#ed9366>::</span><span>&LTScatteringMedium>()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... rest of plugin setup ...
</span><span>    }
</span><span>}
</span></code></pre><h3 id=5-examples-3d-atmosphere-rs-4-4>5. <code>examples/3d/atmosphere.rs</code> (+4/-4)</h3><p>Updated import statements to use the new location of <code>Atmosphere</code> and <code>ScatteringMedium</code>.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>pbr</span><span style=color:#ed9366>::</span><span>{Atmosphere</span><span style=color:#61676ccc>,</span><span> ScatteringMedium}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>light</span><span style=color:#ed9366>::</span><span>{atmosphere</span><span style=color:#ed9366>::</span><span>ScatteringMedium</span><span style=color:#61676ccc>,</span><span> Atmosphere}</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy Engine Architecture</strong>: For understanding the separation between scene description and rendering systems in Bevy.<li><strong>Atmospheric Scattering Theory</strong>: The “Physically Based Rendering” book has excellent sections on volume scattering and phase functions.<li><strong>Rust Orphan Rules</strong>: Understanding Rust’s coherence rules helps explain why the custom extraction system was necessary.<li><strong>Game Engine Design Patterns</strong>: For insights into modular architecture and component organization in large codebases.<li><strong>Computer Graphics References</strong>: For deeper understanding of Rayleigh and Mie scattering models used in the atmosphere system.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22709.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>