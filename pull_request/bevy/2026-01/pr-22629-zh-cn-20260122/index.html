<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22629 Fix FPS overlay system ordering ambiguity
        
    </title><meta content="#22629 Fix FPS overlay system ordering ambiguity" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-22</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2026-01/pr-22629-en-20260122>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix FPS overlay system ordering ambiguity<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22629<li><strong>Author</strong>: JWSong<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Diagnostics, X-Uncontroversial, D-Straightforward, S-Needs-Review<li><strong>Created</strong>: 2026-01-21T17:33:58Z<li><strong>Merged</strong>: 2026-01-22T19:01:23Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>修复问题 #22571<h2 id=jie-jue-fang-an>解决方案</h2><p>添加了 <code>FpsOverlaySystems</code> 系统集，并明确指定 <code>customize_overlay</code> 在 <code>update_text</code> 之前运行。这消除了内部的歧义性警告，并为用户提供了将其自身系统与overlay系统排序的方法。<h2 id=ce-shi>测试</h2><p>在本地运行并启用歧义性警告——不再出现与overlay相关的内部警告。没有添加单元测试，因为在隔离环境中测试调度顺序较为困难。 验证方法：<ul><li>启用 <code>ScheduleBuildSettings</code> 的歧义性警告。<li>添加一个使用 <code>TextUiWriter</code> 的用户系统。<li>运行一个包含 <code>FpsOverlayPlugin</code> 的应用，并确认没有出现与overlay相关的歧义性警告。</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>这个PR始于一个运行时警告。在Bevy中，当引擎无法确定两个系统（system）之间的执行顺序，而这两个系统又访问了相同的资源时，调度器（scheduler）会检测到潜在的“歧义性”（ambiguity）并发出警告。这是一个重要的安全机制，旨在防止数据竞争和不一致的状态。在PR #22629中，问题是<code>FpsOverlayPlugin</code>内部的两个系统——<code>customize_overlay</code>和<code>update_text</code>——都写入了<code>TextUiWriter</code>资源，但它们之间的执行顺序未被明确定义。这触发了引擎的歧义性检测，虽然在当前实现中可能不会导致实际的bug（因为两个系统在不同条件下运行），但警告本身会干扰开发，并且从架构上看，这是一种不良的模式。<p>问题的核心在于缺乏明确的排序契约。<code>customize_overlay</code>系统负责根据<code>FpsOverlayConfig</code>的变更来调整overlay的UI样式（如位置、颜色），而<code>update_text</code>系统则以固定间隔更新overlay上显示的FPS数值文本。虽然它们理论上可以通过运行条件（run condition）错开执行（一个响应配置变化，一个响应定时器），但从调度器的角度看，它们都被注册在<code>Update</code>阶段，且都修改<code>TextUiWriter</code>，因此必须定义明确的先后关系，否则调度器无法保证哪个系统先执行其写入操作，这理论上可能导致文本的短暂不一致。<p>开发者JWSong采用的解决方案直接且符合Bevy的最佳实践：引入一个系统集（SystemSet）。系统集是Bevy中用于分组和排序系统的主要抽象。在<code>crates/bevy_dev_tools/src/fps_overlay.rs</code>中，他定义了一个新的公共枚举<code>FpsOverlaySystems</code>，包含两个变体：<code>Customize</code>和<code>UpdateText</code>。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// System sets for FPS overlay updates.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(SystemSet</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Hash</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>FpsOverlaySystems </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Applies config changes to the overlay UI.
</span><span>    Customize</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Updates the overlay contents.
</span><span>    UpdateText</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>这个定义不仅仅是添加了两个标签；它创建了一个正式的、可供其他系统引用的排序锚点。紧接着，在插件构建方法中，他使用<code>configure_sets</code>来建立这两个集合之间的顺序关系：<code>Customize</code>在<code>UpdateText</code>之前运行。这是解决歧义的关键一步，它为调度器提供了明确的排序指令。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>config</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>configure_sets</span><span>(
</span><span>        Update</span><span style=color:#61676ccc>,
</span><span>        FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>Customize</span><span style=color:#ed9366>.</span><span style=color:#f07171>before</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>UpdateText)</span><span style=color:#61676ccc>,
</span><span>    )
</span></code></pre><p>然后，开发者将原有的系统分别放入对应的集合中。<code>customize_overlay</code>系统（以及与其链在一起的<code>toggle_display</code>）被放入<code>FpsOverlaySystems::Customize</code>集，而<code>update_text</code>系统被放入<code>FpsOverlaySystems::UpdateText</code>集。这一步将系统与已定义好顺序的集合绑定，从而继承了<code>Customize</code>在<code>UpdateText</code>之前运行的约束。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>    Update</span><span style=color:#61676ccc>,
</span><span>    (
</span><span>        (toggle_display</span><span style=color:#61676ccc>,</span><span> customize_overlay)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(resource_changed</span><span style=color:#ed9366>::</span><span>&LTFpsOverlayConfig>())
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>Customize)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 分配到Customize集
</span><span>        update_text
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(</span><span style=color:#f07171>on_timer</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>config</span><span style=color:#ed9366>.</span><span>refresh_interval))
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>UpdateText)</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 分配到UpdateText集
</span><span>    )</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>值得注意的是，这个修复的影响范围超出了<code>fps_overlay.rs</code>文件本身。在<code>crates/bevy_dev_tools/src/frame_time_graph/mod.rs</code>中，<code>FrameTimeGraphPlugin</code>也有一个系统<code>update_frame_time_values</code>，它同样需要更新UI来显示帧时间图表。为了确保这个系统的更新不会与FPS文本更新产生新的歧义，开发者也将这个系统加入了<code>FpsOverlaySystems::UpdateText</code>集合。这体现了良好的设计思维：扩展了新建的系统集的使用范围，确保了整个<code>bevy_dev_tools</code>模块内部UI更新逻辑的一致性。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>    Update</span><span style=color:#61676ccc>,
</span><span>    update_frame_time_values</span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>UpdateText)</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>从技术角度看，这个解决方案有几个优点：<ol><li><strong>消除警告</strong>：最直接的效果是消除了恼人的歧义性警告，使开发输出更清晰。<li><strong>定义明确契约</strong>：它在代码中清晰地记录了“配置变更应用”必须在“内容更新”之前执行的逻辑依赖关系，提高了代码的可读性和可维护性。<li><strong>提供扩展点</strong>：通过将系统集（<code>FpsOverlaySystems</code>）定义为<code>pub</code>，这个PR为插件的使用者提供了一个官方“挂钩”。如果用户有自定义系统也需要与FPS Overlay交互（例如，在特定事件后修改overlay），他们现在可以明确地使用<code>before(FpsOverlaySystems::UpdateText)</code>或<code>after(FpsOverlaySystems::Customize)</code>来排序自己的系统，从而避免引入新的歧义。这是一个典型的面向接口而非实现的改进。</ol><p>总之，这个PR是一个教科书式的“消除歧义性警告”的修复。它没有改变任何功能逻辑，但通过引入一个简单的、结构化的排序抽象（系统集），解决了潜在的调度问题，并提升了相关代码的API设计质量。这是一种低成本、高收益的维护性改进。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    subgraph Update Schedule
</span><span>        A[FpsOverlaySystems::Customize] --> B[FpsOverlaySystems::UpdateText]
</span><span>        C[toggle_display] -.-> A
</span><span>        D[customize_overlay] -.-> A
</span><span>        E[update_text] -.-> B
</span><span>        F[update_frame_time_values] -.-> B
</span><span>    end
</span><span>
</span><span>    G[FpsOverlayConfig Resource] --> D
</span><span>    H[Timer Condition] --> E
</span><span>    I[DiagnosticsStore Resource] --> F
</span></code></pre><p><em>图示说明</em>：在<code>Update</code>调度阶段，<code>FpsOverlaySystems::Customize</code>集被明确安排在<code>FpsOverlaySystems::UpdateText</code>集之前执行。<code>toggle_display</code>和<code>customize_overlay</code>系统属于<code>Customize</code>集，<code>update_text</code>和<code>update_frame_time_values</code>系统属于<code>UpdateText</code>集。虚线表示系统与集合的归属关系，实线表示集合间的执行顺序。下方的资源箭头表示系统所依赖的外部条件或数据。<h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-dev-tools-src-fps-overlay-rs-19-3>1. <code>crates/bevy_dev_tools/src/fps_overlay.rs</code> (+19/-3)</h3><p><strong>修改目的</strong>：定义FPS Overlay专用的系统集，并配置系统间的明确顺序以消除歧义。<p><strong>关键修改</strong>：<ol><li>引入新的公共系统集<code>FpsOverlaySystems</code>。</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After (新增部分):
</span><span style=color:#abb0b6;font-style:italic>/// System sets for FPS overlay updates.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(SystemSet</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Hash</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>FpsOverlaySystems </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Applies config changes to the overlay UI.
</span><span>    Customize</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Updates the overlay contents.
</span><span>    UpdateText</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><ol start=2><li>配置系统集顺序，并将现有系统分配到对应集合。</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (相关部分):
</span><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>config</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Startup</span><span style=color:#61676ccc>,</span><span> setup)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>        Update</span><span style=color:#61676ccc>,
</span><span>        (
</span><span>            (toggle_display</span><span style=color:#61676ccc>,</span><span> customize_overlay)
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(resource_changed</span><span style=color:#ed9366>::</span><span>&LTFpsOverlayConfig>)</span><span style=color:#61676ccc>,
</span><span>            update_text</span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(</span><span style=color:#f07171>on_timer</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>config</span><span style=color:#ed9366>.</span><span>refresh_interval))</span><span style=color:#61676ccc>,
</span><span>        )</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (相关部分):
</span><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>config</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>configure_sets</span><span>(
</span><span>        Update</span><span style=color:#61676ccc>,
</span><span>        FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>Customize</span><span style=color:#ed9366>.</span><span style=color:#f07171>before</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>UpdateText)</span><span style=color:#61676ccc>,
</span><span>    )
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Startup</span><span style=color:#61676ccc>,</span><span> setup)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>        Update</span><span style=color:#61676ccc>,
</span><span>        (
</span><span>            (toggle_display</span><span style=color:#61676ccc>,</span><span> customize_overlay)
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(resource_changed</span><span style=color:#ed9366>::</span><span>&LTFpsOverlayConfig>)
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>Customize)</span><span style=color:#61676ccc>,
</span><span>            update_text
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(</span><span style=color:#f07171>on_timer</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>config</span><span style=color:#ed9366>.</span><span>refresh_interval))
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>UpdateText)</span><span style=color:#61676ccc>,
</span><span>        )</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=2-crates-bevy-dev-tools-src-frame-time-graph-mod-rs-9-3>2. <code>crates/bevy_dev_tools/src/frame_time_graph/mod.rs</code> (+9/-3)</h3><p><strong>修改目的</strong>：将帧时间图表的更新系统与FPS文本更新系统置于同一有序集合中，以保持整个调试工具UI更新逻辑的一致性，避免新的歧义。<p><strong>关键修改</strong>：<ol><li>调整导入，以使用<code>IntoScheduleConfigs</code> trait（用于<code>.in_set()</code>方法）。</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>system</span><span style=color:#ed9366>::</span><span>{Res</span><span style=color:#61676ccc>,</span><span> ResMut}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>{
</span><span>    schedule</span><span style=color:#ed9366>::</span><span>IntoScheduleConfigs</span><span style=color:#61676ccc>,
</span><span>    system</span><span style=color:#ed9366>::</span><span>{Res</span><span style=color:#61676ccc>,</span><span> ResMut}</span><span style=color:#61676ccc>,
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li>导入<code>FpsOverlaySystems</code>系统集，并将<code>update_frame_time_values</code>系统加入<code>UpdateText</code>集。</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use crate</span><span style=color:#ed9366>::</span><span>fps_overlay</span><span style=color:#ed9366>::</span><span>FpsOverlayConfig</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use crate</span><span style=color:#ed9366>::</span><span>fps_overlay</span><span style=color:#ed9366>::</span><span>{FpsOverlayConfig</span><span style=color:#61676ccc>,</span><span> FpsOverlaySystems}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// ... 在 Plugin 实现中 ...
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(UiMaterialPlugin</span><span style=color:#ed9366>::</span><span>&LTFrametimeGraphMaterial></span><span style=color:#ed9366>::</span><span>default())
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>,</span><span> update_frame_time_values)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(UiMaterialPlugin</span><span style=color:#ed9366>::</span><span>&LTFrametimeGraphMaterial></span><span style=color:#ed9366>::</span><span>default())
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>        Update</span><span style=color:#61676ccc>,
</span><span>        update_frame_time_values</span><span style=color:#ed9366>.</span><span style=color:#f07171>in_set</span><span>(FpsOverlaySystems</span><span style=color:#ed9366>::</span><span>UpdateText)</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy官方文档 - 系统排序 (System Ordering)</strong>: 了解Bevy中系统执行顺序的不同控制方法，如<code>.before()</code>、<code>.after()</code>以及系统集（SystemSet）。<li><strong>Bevy官方文档 - 歧义性检测 (Ambiguity Detection)</strong>: 深入理解歧义性检测的工作原理、何时会触发警告以及解决策略。<li><strong>Entity Component System (ECS) 模式</strong>: 了解ECS架构的基本原理，理解系统如何通过查询和修改组件/资源来协作，以及为什么明确的执行顺序对数据一致性至关重要。</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22629.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>