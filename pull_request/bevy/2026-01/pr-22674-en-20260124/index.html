<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22674 example image_node_resizing crash: duplicate component
        
    </title><meta content="#22674 example image_node_resizing crash: duplicate component" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22674-zh-cn-20260124>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>example image_node_resizing crash: duplicate component<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: example image_node_resizing crash: duplicate component<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22674<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Examples, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-01-24T01:04:29Z<li><strong>Merged</strong>: 2026-01-24T15:33:28Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>New example added in https://github.com/bevyengine/bevy/pull/22606 doesn’t work</ul><pre style=color:#61676c;background-color:#fafafa><code><span>thread 'main' (16547671) panicked at crates/bevy_ecs/src/bundle/info.rs:118:13:
</span><span>Bundle (image_node_resizing::TextData, bevy_ui::widget::text::Text, bevy_text::text::TextColor, bevy_ui::ui_node::Node, bevy_ui_render::debug_overlay::UiDebugOptions, bevy_ui_render::debug_overlay::UiDebugOptions, bevy_ecs::hierarchy::ChildOf) has duplicate components: ["bevy_ui_render::debug_overlay::UiDebugOptions"]
</span><span>note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</span><span>Encountered a panic when applying buffers for system `image_node_resizing::setup`!
</span></code></pre><h2 id=solution>Solution</h2><ul><li>Remove the duplicate component</ul><h2 id=testing>Testing</h2><ul><li><code>cargo run --example image_node_resizing</code></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important issue that surfaced after merging a new example into the Bevy engine. The problem was a compilation-time bug that caused a runtime panic when the <code>image_node_resizing</code> example was executed. The core issue was a duplicate component in a bundle, which violates ECS (Entity Component System) constraints where each component type can appear only once per entity.<p>The context here involves a recently added UI example (#22606) designed to demonstrate image node resizing functionality. During the example’s setup phase, a bundle was constructed with multiple components, including <code>UiDebugOptions</code>. The problem occurred because this component was accidentally included twice in the same bundle. When Bevy’s ECS system processes bundles, it performs validation to ensure no duplicate components exist - a check that triggers a panic if violated.<p>The solution approach was minimal and direct: identify and remove the duplicate <code>UiDebugOptions</code> component. This is a textbook example of a simple oversight in code review that leads to a runtime failure. The fix required examining the bundle construction in the <code>setup</code> function and recognizing the duplicate entry.<p>Looking at the implementation details, the issue was in how the bundle was constructed using Bevy’s commands API. The bundle was being built with multiple components chained together, and the duplicate slipped through because both instances had identical configurations (<code>enabled: false</code>). This made the duplicate less visually obvious during code review.<p>From a technical perspective, this PR highlights several important aspects of working with ECS systems:<ol><li><p><strong>Bundle Validation</strong>: Bevy’s bundle system performs compile-time and runtime checks to prevent invalid entity configurations. The panic message clearly indicates which component was duplicated, making debugging straightforward.</p><li><p><strong>Error Messages</strong>: The error message from the panic provides clear information: it shows the entire bundle structure and explicitly calls out the duplicate component. This is good design in Bevy’s error reporting.</p><li><p><strong>Component Uniqueness Constraint</strong>: In ECS patterns, each component type must be unique per entity. This constraint ensures predictable behavior when querying for components and prevents ambiguity in component access.</p></ol><p>The impact of this fix is immediate: the example now runs without crashing, allowing developers to test and learn from the image node resizing functionality. While this is a trivial change from a code perspective, it’s important for maintaining the quality and reliability of Bevy’s examples, which serve as both documentation and test cases for the engine.<p>This type of issue is common in codebases that use builder patterns or fluent interfaces for constructing complex objects. The lesson here is to pay careful attention when constructing bundles with multiple similar-looking components, especially when copying and pasting code blocks.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[image_node_resizing Example Setup] --> B[Construct Entity Bundle]
</span><span>    B --> C[Add Text Component]
</span><span>    B --> D[Add Node Component]
</span><span>    B --> E[Add UiDebugOptions Component]
</span><span>    B --> F[Add ChildOf Component]
</span><span>    B --> G[ERROR: Duplicate UiDebugOptions Component]
</span><span>    G --> H[ECS Validation Panic]
</span><span>    E --> I[Fix: Remove Duplicate Component]
</span><span>    I --> J[Example Runs Successfully]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File:</strong> <code>examples/ui/image_node_resizing.rs</code><ol><li><p><strong>Description of Change:</strong> The fix removes a duplicate <code>UiDebugOptions</code> component from the bundle being spawned in the <code>setup</code> function. This resolves the runtime panic that occurred when the ECS system validated the bundle and found duplicate components.</p><li><p><strong>Code Snippets:</strong></p></ol><p>Before the fix (lines 99-106):<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>            UiDebugOptions {
</span><span>                enabled</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>            }</span><span style=color:#61676ccc>,
</span><span>            UiDebugOptions {
</span><span>                enabled</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>            }</span><span style=color:#61676ccc>,
</span><span>            ChildOf(container)</span><span style=color:#61676ccc>,
</span></code></pre><p>After the fix:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>            UiDebugOptions {
</span><span>                enabled</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>            }</span><span style=color:#61676ccc>,
</span><span>            ChildOf(container)</span><span style=color:#61676ccc>,
</span></code></pre><ol start=3><li><strong>Relationship to Overall Purpose:</strong> This change directly addresses the crash mentioned in the PR description. By removing the duplicate component, the bundle becomes valid according to ECS rules, allowing the example to run without panicking.</ol><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy ECS Documentation:</strong> https://bevyengine.org/learn/ecs-introduction/<li><strong>Bevy UI System:</strong> https://bevyengine.org/examples/ui/ui/<li><strong>Understanding Rust Panics:</strong> https://doc.rust-lang.org/book/ch09-01-unrecoverable-errors-with-panic.html<li><strong>Bevy Bundle System:</strong> https://docs.rs/bevy_ecs/latest/bevy_ecs/bundle/trait.Bundle.html<li><strong>Common ECS Anti-patterns:</strong> https://github.com/bevyengine/bevy/discussions/89</ol><h1 id=full-code-diff>Full Code Diff</h1><pre style=color:#61676c;background-color:#fafafa><code><span>diff --git a/examples/ui/image_node_resizing.rs b/examples/ui/image_node_resizing.rs
</span><span>index c07ce02579acb..5103c6ee6b16d 100644
</span><span>--- a/examples/ui/image_node_resizing.rs
</span><span>+++ b/examples/ui/image_node_resizing.rs
</span><span>@@ -99,10 +99,6 @@ fn setup(mut commands: Commands, asset_server: Res&LTAssetServer>) {
</span><span>                 enabled: false,
</span><span>                 ..default()
</span><span>             },
</span><span>-            UiDebugOptions {
</span><span>-                enabled: false,
</span><span>-                ..default()
</span><span>-            },
</span><span>             ChildOf(container),
</span><span>         ))
</span><span>         .observe(update_text);
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22674.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>