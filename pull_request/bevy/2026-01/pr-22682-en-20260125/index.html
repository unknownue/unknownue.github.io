<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22682 move Skybox to bevy_light
        
    </title><meta content="#22682 move Skybox to bevy_light" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-25</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22682-zh-cn-20260125>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>move Skybox to bevy_light<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: move Skybox to bevy_light<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22682<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review, M-Migration-Guide, D-Straightforward<li><strong>Created</strong>: 2026-01-24T16:42:35Z<li><strong>Merged</strong>: 2026-01-25T01:45:00Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Skybox is a main world component for scene definition, it shouldnt be in a rendering crate</ul><h2 id=solution>Solution</h2><ul><li>Move it to bevy_light, alongside EnvironmentMapLight component sibling which lets it influence lighting.</ul><h2 id=testing>Testing</h2><ul><li>skybox example works</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a code organization issue in the Bevy engine where the <code>Skybox</code> component was located in the wrong module from an architectural perspective. The core problem was that <code>Skybox</code> is fundamentally a scene definition component - it defines part of the visual environment - but it was placed in <code>bevy_core_pipeline</code>, which is focused on rendering implementation details rather than scene composition.<p>The developer recognized that <code>Skybox</code> logically belongs with other lighting and environment components, specifically alongside <code>EnvironmentMapLight</code> in the <code>bevy_light</code> crate. This is because both components define environmental visual properties, with <code>EnvironmentMapLight</code> affecting scene lighting and <code>Skybox</code> providing background rendering. Having them in the same crate creates better conceptual grouping and makes the API more intuitive for users.<p>The implementation approach was straightforward but required careful handling of cross-crate dependencies and trait implementations. The main technical challenge arose from Rust’s orphan rules when moving the <code>Skybox</code> component to a different crate. Previously, <code>Skybox</code> implemented the <code>ExtractComponent</code> trait from <code>bevy_core_pipeline</code>, but after moving it to <code>bevy_light</code>, this implementation would violate Rust’s orphan rule (cannot implement a foreign trait for a foreign type).<p>To solve this, the developer replaced the <code>ExtractComponent</code> trait implementation with a custom extraction system. Instead of using the automatic extraction provided by <code>ExtractComponentPlugin</code>, they created a manual extraction function <code>extract_skybox</code> that performs the same logic:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>extract_skybox</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>previous_len</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>,
</span><span>    </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Extract&LTQuery<(RenderEntity, </span><span style=color:#ed9366>&</span><span>Skybox, </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>Exposure>)>>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> values </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Vec</span><span style=color:#ed9366>::</span><span>with_capacity(</span><span style=color:#ed9366>*</span><span>previous_len)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>for </span><span>(entity</span><span style=color:#61676ccc>,</span><span> skybox</span><span style=color:#61676ccc>,</span><span> exposure) </span><span style=color:#ed9366>in &</span><span>query {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... extraction logic
</span><span>        values</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>((entity</span><span style=color:#61676ccc>, </span><span>(skybox</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,</span><span> uniforms)))</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#ed9366>*</span><span>previous_len </span><span style=color:#ed9366>=</span><span> values</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()</span><span style=color:#61676ccc>;
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>try_insert_batch</span><span>(values)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>This function is then registered in the render app’s <code>ExtractSchedule</code> system set. The approach maintains the same functionality while working around the orphan rule limitation.<p>The move also required updating the crate dependencies. <code>bevy_core_pipeline</code> now depends on <code>bevy_light</code> since it still needs to process <code>Skybox</code> components during rendering. This dependency direction makes sense because rendering systems need to understand scene components, but scene components shouldn’t depend on rendering implementation details.<p>From a code architecture perspective, this change improves separation of concerns. <code>bevy_light</code> now contains all environment-related components (<code>Skybox</code>, <code>EnvironmentMapLight</code>, <code>IrradianceVolume</code>, etc.), while <code>bevy_core_pipeline</code> focuses on the rendering pipeline implementation. This makes the codebase more maintainable and easier for new contributors to navigate.<p>The impact of this change is primarily organizational rather than functional. All existing functionality is preserved, but users need to update their import statements from <code>bevy::core_pipeline::Skybox</code> to <code>bevy::light::Skybox</code>. The PR includes a migration guide to help users with this transition.<p>The technical lesson here is about managing Rust’s orphan rules when refactoring code across crate boundaries. The solution demonstrates a pattern for replacing trait implementations with manual systems when automatic derivation isn’t possible due to crate separation.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_core_pipeline] -->|depends on| B[bevy_light]
</span><span>    B -->|contains| C[Skybox Component]
</span><span>    B -->|contains| D[EnvironmentMapLight Component]
</span><span>    B -->|contains| E[Other Light Components]
</span><span>    A -->|renders| C
</span><span>    A -->|processes| D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><strong><code>crates/bevy_core_pipeline/src/skybox/mod.rs</code></strong> (+32/-68) <ul><li>Removed the <code>Skybox</code> component definition and <code>ExtractComponent</code> implementation<li>Added <code>extract_skybox</code> function to manually extract skybox data<li>Added import for <code>Skybox</code> from <code>bevy_light</code><li>Updated plugin to use manual extraction instead of <code>ExtractComponentPlugin</code></ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before (in bevy_core_pipeline):
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Skybox </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>image</span><span style=color:#61676ccc>: </span><span>Handle&LTImage>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>brightness</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>rotation</span><span style=color:#61676ccc>:</span><span> Quat,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span>ExtractComponent </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>Skybox </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Trait implementation for automatic extraction
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After (in bevy_light):
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Skybox </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>image</span><span style=color:#61676ccc>: </span><span>Handle&LTImage>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>brightness</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>rotation</span><span style=color:#61676ccc>:</span><span> Quat,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In bevy_core_pipeline:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>extract_skybox</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>previous_len</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>,
</span><span>    </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Extract&LTQuery<(RenderEntity, </span><span style=color:#ed9366>&</span><span>Skybox, </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>Exposure>)>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Manual extraction logic
</span><span>}
</span></code></pre><ol start=2><li><p><strong><code>crates/bevy_light/src/probe.rs</code></strong> (+31/-0)</p> <ul><li>Added the <code>Skybox</code> component definition to this file<li>Now contains both <code>Skybox</code> and <code>EnvironmentMapLight</code> in the same module</ul><li><p><strong><code>crates/bevy_core_pipeline/Cargo.toml</code></strong> (+1/-0)</p> <ul><li>Added dependency on <code>bevy_light</code> crate<li>Necessary because rendering systems need to access <code>Skybox</code> component</ul><li><p><strong><code>examples/3d/skybox.rs</code></strong> and 11 other example files</p> <ul><li>Updated import statements from <code>bevy::core_pipeline::Skybox</code> to <code>bevy::light::Skybox</code><li>Ensures examples compile and work correctly after the move</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before in examples:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>core_pipeline</span><span style=color:#ed9366>::</span><span>Skybox</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After in examples:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>light</span><span style=color:#ed9366>::</span><span>Skybox</span><span style=color:#61676ccc>;
</span></code></pre><ol start=5><li><strong><code>release-content/migration-guides/skybox.md</code></strong> (+6/-0) <ul><li>Created migration guide documenting the change<li>Helps users update their code when upgrading Bevy versions</ul></ol><h2 id=further-reading>Further Reading</h2><ol><li><strong>Rust Orphan Rules</strong>: Understanding Rust’s coherence rules and orphan rules is essential when working with traits across crate boundaries.<li><strong>Bevy ECS Extraction</strong>: The Bevy renderer uses an extraction phase to copy data from the main world to the render world. The <code>ExtractComponent</code> trait automates this process.<li><strong>Bevy Module Organization</strong>: Bevy’s architecture separates scene definition (components, systems) from rendering implementation (pipelines, shaders).<li><strong>Environment Mapping Techniques</strong>: Both skyboxes and environment maps are techniques for rendering distant environments; understanding their relationship helps appreciate why these components belong together.</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22682.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>