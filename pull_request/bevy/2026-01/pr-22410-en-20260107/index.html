<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22410 Update `Combine` trait example to use `unwrap_or(false)`
        
    </title><meta content="#22410 Update `Combine` trait example to use `unwrap_or(false)`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22410-zh-cn-20260107>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Update <code>Combine</code> trait example to use <code>unwrap_or(false)</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update <code>Combine</code> trait example to use <code>unwrap_or(false)</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22410<li><strong>Author</strong>: WaterWhisperer<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, D-Trivial, A-ECS, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-01-07T05:33:42Z<li><strong>Merged</strong>: 2026-01-07T06:19:42Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The PR description is already in English, so it’s included as-is:<h1 id=objective>Objective</h1><ul><li>Fixes #22363</ul><h2 id=solution>Solution</h2><ul><li>Replace <code>Ok(a((), data)? ^ b((), data)?)</code> with <code>Ok(a((), data).unwrap_or(false) ^ b((), data).unwrap_or(false))</code></ul><h2 id=testing>Testing</h2><ul><li>Doc test</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a documentation issue in the Bevy game engine’s ECS (Entity Component System) module. The problem was relatively straightforward but highlights an important aspect of Rust error handling in the context of Bevy’s system combinators.<p>The issue originated in the <code>Combine</code> trait documentation within <code>combinator.rs</code>. The trait is part of Bevy’s ECS framework and provides a way to combine multiple systems. In this specific example, the documentation showed how to combine two systems that return <code>Result&LTbool, RunSystemError></code>. The original code attempted to use the <code>?</code> operator to propagate errors, but this approach didn’t compile because of type inference issues with the XOR operation.<p>The core problem was that the <code>?</code> operator returns early when it encounters an error, which doesn’t work well in this context where we want to combine boolean results even when individual systems might fail. The original code would have compiled if we were just returning the boolean values directly, but the <code>^</code> (XOR) operator expects boolean operands, and the <code>?</code> operator yields a <code>bool</code> only when the result is <code>Ok</code>. When there’s an error, the function returns early, so the XOR operation never happens in that case.<p>The solution replaces the <code>?</code> operator with <code>.unwrap_or(false)</code>. This change has two important effects:<ol><li>It ensures the code compiles by providing concrete boolean values to the XOR operator<li>It defines explicit error handling behavior: when a system returns an error, it’s treated as <code>false</code> for the purpose of the combination</ol><p>This approach is more appropriate for this example because it demonstrates a practical way to handle errors in system combinations. Using <code>.unwrap_or(false)</code> means that when a system fails, we treat it as returning <code>false</code> and continue with the combination logic, rather than aborting the entire operation.<p>The change is minimal but significant because documentation examples serve as templates for developers. By showing <code>unwrap_or(false)</code> instead of <code>?</code>, the example now provides a working pattern for combining systems that might fail, while also being explicit about error handling. This is particularly important in game development contexts where you might want to continue execution with default values even when some systems encounter recoverable errors.<p>From an engineering perspective, this change demonstrates the trade-off between error propagation and fault tolerance. The <code>?</code> operator is great for propagating errors up the call stack when you want to abort on failure. However, in a combinator context where you’re merging results from multiple systems, you often want to handle errors locally and continue with some default behavior. The <code>unwrap_or()</code> pattern provides that flexibility while maintaining type safety.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Combine Trait Example] --> B[System A returns Result&LTbool, RunSystemError>]
</span><span>    A --> C[System B returns Result&LTbool, RunSystemError>]
</span><span>    B --> D[Original: a((), data)?]
</span><span>    C --> E[Original: b((), data)?]
</span><span>    D --> F[XOR Operation]
</span><span>    E --> F
</span><span>    F --> G[Compilation Error]
</span><span>    
</span><span>    B --> H[Fixed: a((), data).unwrap_or(false)]
</span><span>    C --> I[Fixed: b((), data).unwrap_or(false)]
</span><span>    H --> J[XOR Operation]
</span><span>    I --> J
</span><span>    J --> K[Successful Compilation]
</span><span>    J --> L[Error Handling: Errors treated as false]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File:</strong> <code>crates/bevy_ecs/src/system/combinator.rs</code><p><strong>Change Description:</strong> Updated the documentation example for the <code>Combine</code> trait to use <code>unwrap_or(false)</code> instead of the <code>?</code> operator. This fixes a compilation error and provides more explicit error handling in the example.<p><strong>Code Change:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_ecs/src/system/combinator.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use super</span><span style=color:#ed9366>::</span><span>{IntoSystem</span><span style=color:#61676ccc>,</span><span> ReadOnlySystem</span><span style=color:#61676ccc>,</span><span> RunSystemError</span><span style=color:#61676ccc>,</span><span> System}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Combine two systems that return `Result&LTbool, RunSystemError>` using XOR.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// # Examples
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// ```
</span><span style=color:#abb0b6;font-style:italic>/// # use bevy_ecs::system::{RunSystemError, Combine};
</span><span style=color:#abb0b6;font-style:italic>/// #
</span><span style=color:#abb0b6;font-style:italic>/// impl Combine&LTSelf> for bool {
</span><span style=color:#abb0b6;font-style:italic>///     type In = ();
</span><span style=color:#abb0b6;font-style:italic>///     type Out = bool;
</span><span style=color:#abb0b6;font-style:italic>/// 
</span><span style=color:#abb0b6;font-style:italic>///     fn combine(
</span><span style=color:#abb0b6;font-style:italic>///         a: impl FnOnce(A::In, &mut T) -> Result&LTA::Out, RunSystemError>,
</span><span style=color:#abb0b6;font-style:italic>///         b: impl FnOnce(B::In, &mut T) -> Result&LTB::Out, RunSystemError>,
</span><span style=color:#abb0b6;font-style:italic>///     ) -> Result&LTSelf::Out, RunSystemError> {
</span><span style=color:#abb0b6;font-style:italic>///         Ok(a((), data)? ^ b((), data)?)
</span><span style=color:#abb0b6;font-style:italic>///     }
</span><span style=color:#abb0b6;font-style:italic>/// }
</span><span style=color:#abb0b6;font-style:italic>/// ```
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use super</span><span style=color:#ed9366>::</span><span>{IntoSystem</span><span style=color:#61676ccc>,</span><span> ReadOnlySystem</span><span style=color:#61676ccc>,</span><span> RunSystemError</span><span style=color:#61676ccc>,</span><span> System}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Combine two systems that return `Result&LTbool, RunSystemError>` using XOR.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// # Examples
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// ```
</span><span style=color:#abb0b6;font-style:italic>/// # use bevy_ecs::system::{RunSystemError, Combine};
</span><span style=color:#abb0b6;font-style:italic>/// #
</span><span style=color:#abb0b6;font-style:italic>/// impl Combine&LTSelf> for bool {
</span><span style=color:#abb0b6;font-style:italic>///     type In = ();
</span><span style=color:#abb0b6;font-style:italic>///     type Out = bool;
</span><span style=color:#abb0b6;font-style:italic>/// 
</span><span style=color:#abb0b6;font-style:italic>///     fn combine(
</span><span style=color:#abb0b6;font-style:italic>///         a: impl FnOnce(A::In, &mut T) -> Result&LTA::Out, RunSystemError>,
</span><span style=color:#abb0b6;font-style:italic>///         b: impl FnOnce(B::In, &mut T) -> Result&LTB::Out, RunSystemError>,
</span><span style=color:#abb0b6;font-style:italic>///     ) -> Result&LTSelf::Out, RunSystemError> {
</span><span style=color:#abb0b6;font-style:italic>///         Ok(a((), data).unwrap_or(false) ^ b((), data).unwrap_or(false))
</span><span style=color:#abb0b6;font-style:italic>///     }
</span><span style=color:#abb0b6;font-style:italic>/// }
</span><span style=color:#abb0b6;font-style:italic>/// ```
</span><span>
</span><span style=color:#ed9366>**</span><span>How this relates to the overall purpose</span><span style=color:#61676ccc>:</span><span style=color:#ed9366>**</span><span> This change fixes issue </span><span style=color:#ed9366>#</span><span style=color:#ff8f40>22363</span><span> by correcting a documentation example that didn</span><span style=color:#fa6e32>'t</span><span> compile</span><span style=color:#ed9366>.</span><span> The fix demonstrates proper error handling </span><span style=color:#ed9366>in</span><span> system combinations and provides developers with a working pattern to follow</span><span style=color:#ed9366>.
</span><span>
</span><span style=color:#ed9366>##</span><span> Further Reading
</span><span>
</span><span style=color:#ff8f40>1. </span><span style=color:#ed9366>**</span><span>Rust Error Handling</span><span style=color:#61676ccc>:</span><span style=color:#ed9366>**</span><span> The Rust Book</span><span style=color:#fa6e32>'s</span><span> chapter on error handling provides foundational knowledge about `</span><span style=color:#55b4d4;font-style:italic>Result</span><span>`</span><span style=color:#61676ccc>,</span><span> `</span><span style=color:#ed9366>?</span><span>` operator</span><span style=color:#61676ccc>,</span><span> and `</span><span style=color:#f07171>unwrap_or</span><span>()`</span><span style=color:#61676ccc>:</span><span> https</span><span style=color:#61676ccc>:</span><span style=color:#abb0b6;font-style:italic>//doc.rust-lang.org/book/ch09-00-error-handling.html
</span><span>
</span><span style=color:#ff8f40>2. </span><span style=color:#ed9366>**</span><span>Bevy </span><span style=color:#ff8f40>ECS</span><span> System Combinators</span><span style=color:#61676ccc>:</span><span style=color:#ed9366>**</span><span> Bevy</span><span style=color:#fa6e32>'s</span><span> documentation on system combinators explains how to combine multiple systems</span><span style=color:#61676ccc>:</span><span> https</span><span style=color:#61676ccc>:</span><span style=color:#abb0b6;font-style:italic>//bevyengine.org/learn/book/next/ecs/system-combinators/
</span><span>
</span><span style=color:#ff8f40>3. </span><span style=color:#ed9366>**</span><span>Rust</span><span style=color:#fa6e32>'s</span><span> `</span><span style=color:#55b4d4;font-style:italic>Option</span><span>` and `</span><span style=color:#55b4d4;font-style:italic>Result</span><span>` Types</span><span style=color:#61676ccc>:</span><span style=color:#ed9366>**</span><span> Understanding the difference between `</span><span style=color:#f07171>unwrap</span><span>()`</span><span style=color:#61676ccc>,</span><span> `</span><span style=color:#f07171>expect</span><span>()`</span><span style=color:#61676ccc>,</span><span> `</span><span style=color:#f07171>unwrap_or</span><span>()`</span><span style=color:#61676ccc>,</span><span> and `</span><span style=color:#ed9366>?</span><span>` operator is crucial </span><span style=color:#fa6e32>for</span><span> effective Rust programming</span><span style=color:#ed9366>.
</span><span>
</span><span style=color:#ff8f40>4. </span><span style=color:#ed9366>**</span><span>Bevy GitHub Issues</span><span style=color:#61676ccc>:</span><span style=color:#ed9366>**</span><span> The original issue </span><span style=color:#ed9366>#</span><span style=color:#ff8f40>22363</span><span> that this </span><span style=color:#ff8f40>PR</span><span> fixes provides additional context about the problem and discussion around the solution</span><span style=color:#ed9366>.</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22410.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>