<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22340 Remove `bevy_camera` and `bevy_ui` deps from `bevy_input_focus`, no feature flag needed
        
    </title><meta content="#22340 Remove `bevy_camera` and `bevy_ui` deps from `bevy_input_focus`, no feature flag needed" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-06</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22340-zh-cn-20260106>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Remove <code>bevy_camera</code> and <code>bevy_ui</code> deps from <code>bevy_input_focus</code>, no feature flag needed<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22340<li><strong>Author</strong>: kfc35<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-UI, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2026-01-01T18:04:11Z<li><strong>Merged</strong>: 2026-01-06T20:37:48Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><ul><li>Fixes #22305<li>Avoid feature flagging</ul><p><strong>Solution</strong><p>Taking inspiration from #22309 and building off of #22333, this moves the auto directional navigation to <code>bevy_ui</code> and creates a new system parameter to be used when including automatic navigation.<ul><li>directional_navigation.rs of <code>bevy_input_focus</code> still contains the <code>DirectionalNavigation</code> system parameter, but it now only contains logic to do manual navigation. The <code>DirectionalNavigationPlugin</code> is still there, as well as the manual edge map.<li>I separated out some code from directional_navigation.rs into two separate files:</ul><ol><li>directional_navigation.rs in <code>bevy_ui</code> which contains the automatic navigation code. There is a new system parameter now, <code>AutoDirectionalNavigator</code>, that wraps the <code>DirectionalNavigation</code> system parameter and does automatic navigation if manual navigation fails.<li>navigator.rs which contains some structs and functions that are used by both the automatic navigation system and the manual navigation code in directional_navigation.rs. This particular refactoring wasn’t particularly necessary, but I feel like the code is little more cleaner for it… I can revert this change if desired</ol><p>If you think a feature is better for this, then let me know whether #22333 should be considered instead.<p>If this gets merged, I’ll open up a pull request against <code>release-0.18</code> to update the release notes, basically saying that users who want to leverage <code>AutoDirectionalNavigation</code> need to use the <code>AutoDirectionalNavigator</code> instead of the existing <code>DirectionalNavigation</code> system param.<p><strong>Testing</strong><p>To ensure no regressions, I tested the directional navigation examples and both work as they did before. <code>cargo run --example directional_navigation</code> - uses the existing <code>DirectionalNavigation</code> system parameter <code>cargo run --example auto_directional_navigation</code> - uses the new <code>AutoDirectionalNavigator</code> system parameter<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a dependency issue in the Bevy engine’s input focus system. The problem was that <code>bevy_input_focus</code> had unnecessary dependencies on <code>bevy_camera</code> and <code>bevy_ui</code>, which caused compilation bloat for users who only needed manual navigation functionality. The issue #22305 highlighted this problem, and while a previous solution (#22333) proposed using feature flags, this PR takes a different approach by restructuring the codebase to eliminate the dependencies entirely.<p>The core insight driving this change is that automatic directional navigation - which requires UI-specific components like <code>ComputedNode</code> and <code>UiGlobalTransform</code> - logically belongs in the <code>bevy_ui</code> crate rather than the more general <code>bevy_input_focus</code> crate. The <code>bevy_input_focus</code> crate should handle the foundational manual navigation logic, while UI-specific automatic navigation should live where the UI components are defined.<p>The implementation follows a clear separation of concerns. First, the PR removes the <code>bevy_camera</code> and <code>bevy_ui</code> dependencies from <code>bevy_input_focus/Cargo.toml</code>, reducing the crate’s footprint. Then, it refactors the directional navigation system into three logical components:<ol><li><strong>Core manual navigation</strong> remains in <code>bevy_input_focus/src/directional_navigation.rs</code><li><strong>Shared navigation algorithms</strong> move to a new <code>bevy_input_focus/src/navigator.rs</code><li><strong>UI-specific automatic navigation</strong> moves to a new <code>bevy_ui/src/auto_directional_navigation.rs</code></ol><p>The key technical decision was to create a new system parameter <code>AutoDirectionalNavigator</code> in <code>bevy_ui</code> that wraps the existing <code>DirectionalNavigation</code> parameter. This wrapper follows the pattern of first checking for manually defined navigation edges, then falling back to automatic navigation if no manual edge exists. This preserves backward compatibility while clearly separating the concerns.<p>The refactoring involved extracting the <code>FocusableArea</code> struct and navigation scoring algorithms into the shared <code>navigator.rs</code> module. This allows both crates to use the same scoring logic without creating circular dependencies. The scoring algorithm itself uses spatial calculations to determine the “best” candidate for navigation based on distance, alignment, and overlap factors.<p>One notable aspect of this implementation is how it handles the system parameter queries. The original <code>DirectionalNavigation</code> parameter had complex queries that depended on UI components. By moving these queries to the UI crate, we eliminate the dependency chain. The new <code>AutoDirectionalNavigator</code> has access to UI-specific queries while the base <code>DirectionalNavigation</code> remains UI-agnostic.<p>The example updates demonstrate the migration path: users who previously used <code>DirectionalNavigation</code> for automatic navigation now need to use <code>AutoDirectionalNavigator</code> from the <code>bevy_ui</code> crate. This is a breaking change but one that improves the overall architecture.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_input_focus] --> B[DirectionalNavigation&LTbr/>manual only]
</span><span>    A --> C[navigator.rs&LTbr/>shared algorithms]
</span><span>    D[bevy_ui] --> E[AutoDirectionalNavigator&LTbr/>manual + auto]
</span><span>    D --> F[AutoDirectionalNavigation component]
</span><span>    E --> B[uses manual navigation]
</span><span>    E --> C[uses shared algorithms]
</span><span>    F --> E[provides auto-navigation data]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><strong><code>crates/bevy_input_focus/src/directional_navigation.rs</code></strong> (+13/-498)</p> <ul><li>Removed all automatic navigation logic and UI-specific queries<li>Simplified <code>DirectionalNavigation</code> system parameter to handle only manual navigation<li>Updated documentation to direct users to <code>bevy_ui</code> for automatic navigation</ul> <p>Before:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DirectionalNavigation</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub </span><span>focus</span><span style=color:#61676ccc>: </span><span>ResMut<</span><span style=color:#fa6e32>'w</span><span>, InputFocus>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>map</span><span style=color:#61676ccc>: </span><span>Res<</span><span style=color:#fa6e32>'w</span><span>, DirectionalNavigationMap>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>config</span><span style=color:#61676ccc>: </span><span>Res<</span><span style=color:#fa6e32>'w</span><span>, AutoNavigationConfig>,
</span><span>    navigable_entities_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#f51818>.</span><span>..>,
</span><span>    camera_and_focusable_area_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#f51818>.</span><span>..>,
</span><span>}
</span></code></pre> <p>After:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DirectionalNavigation</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub </span><span>focus</span><span style=color:#61676ccc>: </span><span>ResMut<</span><span style=color:#fa6e32>'w</span><span>, InputFocus>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>map</span><span style=color:#61676ccc>: </span><span>Res<</span><span style=color:#fa6e32>'w</span><span>, DirectionalNavigationMap>,
</span><span>}
</span></code></pre><li><p><strong><code>crates/bevy_input_focus/src/navigator.rs</code></strong> (+302/-0)</p> <ul><li>New file containing shared navigation algorithms<li>Includes <code>find_best_candidate</code>, <code>score_candidate</code>, and helper functions<li>Used by both <code>bevy_input_focus</code> and <code>bevy_ui</code></ul> <p>Key function:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>find_best_candidate</span><span>(
</span><span>    </span><span style=color:#ff8f40>origin</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>FocusableArea,
</span><span>    </span><span style=color:#ff8f40>direction</span><span style=color:#61676ccc>:</span><span> CompassOctant,
</span><span>    </span><span style=color:#ff8f40>candidates</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[FocusableArea],
</span><span>    </span><span style=color:#ff8f40>config</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>AutoNavigationConfig,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTEntity> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Scoring logic to find best navigation target
</span><span>}
</span></code></pre><li><p><strong><code>crates/bevy_ui/src/auto_directional_navigation.rs</code></strong> (+230/-0)</p> <ul><li>New module containing automatic navigation logic<li>Defines <code>AutoDirectionalNavigation</code> component and <code>AutoDirectionalNavigator</code> system parameter<li>Wraps manual navigation and adds automatic fallback</ul> <p>Key structure:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>AutoDirectionalNavigator</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub </span><span>manual_directional_navigation</span><span style=color:#61676ccc>: </span><span>DirectionalNavigation<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>config</span><span style=color:#61676ccc>: </span><span>Res<</span><span style=color:#fa6e32>'w</span><span>, AutoNavigationConfig>,
</span><span>    navigable_entities_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#f51818>.</span><span>..>,
</span><span>    camera_and_focusable_area_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#f51818>.</span><span>..>,
</span><span>}
</span></code></pre><li><p><strong><code>examples/ui/auto_directional_navigation.rs</code></strong> (+7/-6)</p> <ul><li>Updated to use <code>AutoDirectionalNavigator</code> from <code>bevy_ui</code> instead of <code>DirectionalNavigation</code></ul> <p>Before:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>bevy_input_focus</span><span style=color:#ed9366>::</span><span>directional_navigation</span><span style=color:#ed9366>::</span><span>DirectionalNavigation</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>navigate</span><span>(</span><span style=color:#ff8f40>action_state</span><span style=color:#61676ccc>: </span><span>Res&LTActionState>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>directional_navigation</span><span style=color:#61676ccc>:</span><span> DirectionalNavigation) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre> <p>After:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>ui</span><span style=color:#ed9366>::</span><span>auto_directional_navigation</span><span style=color:#ed9366>::</span><span>AutoDirectionalNavigator</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>navigate</span><span>(</span><span style=color:#ff8f40>action_state</span><span style=color:#61676ccc>: </span><span>Res&LTActionState>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>auto_directional_navigator</span><span style=color:#61676ccc>:</span><span> AutoDirectionalNavigator) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><li><p><strong><code>crates/bevy_input_focus/Cargo.toml</code></strong> (+0/-2)</p> <ul><li>Removed <code>bevy_camera</code> and <code>bevy_ui</code> dependencies<li>Reduced crate footprint and compilation dependencies</ul></ol><h2 id=further-reading>Further Reading</h2><ul><li><strong>Bevy ECS System Parameters</strong>: The PR demonstrates advanced use of Bevy’s system parameters for dependency injection<li><strong>Crate Dependency Management</strong>: Shows techniques for reducing crate dependencies through architectural refactoring<li><strong>Navigation Algorithms</strong>: The scoring functions implement spatial navigation algorithms similar to those used in accessibility tools and game UI systems<li><strong>Component-Based Architecture</strong>: Illustrates Bevy’s component-based design and how to separate concerns between crates</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22340.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>