<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22353 systemstate support commands track location
        
    </title><meta content="#22353 systemstate support commands track location" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-08</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22353-zh-cn-20260108>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: systemstate support commands track location<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22353<li><strong>Author</strong>: MushineLament<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-ECS, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2026-01-02T12:28:34Z<li><strong>Merged</strong>: 2026-01-08T20:47:55Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><p>When acquiring Commands within SystemState, it causes incorrect tracking of MaybeLocation in CommandQueue, mistakenly pointing to the FromWorld trait implementation.<p><strong>Solution</strong><p>Add track_caller support for the Commands SystemParam.<p><strong>Testing</strong><p>I only verified whether tracking is present, but did not perform any tests.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a bug in Bevy’s Entity Component System (ECS) where error location tracking was incorrectly pointing to the wrong place in the codebase. When developers used <code>SystemState</code> to acquire <code>Commands</code> and an error occurred, the stack trace would incorrectly point to the <code>FromWorld</code> trait implementation instead of the actual calling code. This made debugging significantly more difficult because developers couldn’t easily identify which part of their code was causing the issue.<p>The problem stemmed from how Bevy’s system parameters, particularly <code>Commands</code>, track their calling location. When <code>SystemState</code> is used to manually manage system execution outside the normal scheduler flow, the location tracking mechanism loses context about where the commands are being issued from. Instead of pointing to the developer’s code, it defaults to pointing at the <code>FromWorld::from_world</code> implementation, which provides default values for types.<p>The solution implemented in this PR is straightforward but systematic: add the <code>#[track_caller]</code> attribute to key methods in the system parameter pipeline. This Rust attribute ensures that when a panic occurs, the location information preserved points to the actual caller of the function rather than the function itself. The PR adds this attribute to four main areas: the <code>Commands</code> system parameter implementation, the <code>Deferred</code> system parameter, tuple system parameters, and the <code>SystemState</code> methods that retrieve parameters.<p>The implementation required careful consideration of which functions needed the attribute. The developer added <code>#[track_caller]</code> to:<ol><li><code>init_state</code> and <code>get_param</code> methods for the <code>Commands</code> system parameter<li><code>init_state</code> for the <code>Deferred</code> system parameter<li><code>init_state</code> and <code>get_param</code> in the macro that generates tuple system parameter implementations<li>Several methods on <code>SystemState</code>: <code>new</code>, <code>get_mut</code>, and the internal <code>fetch</code> method<li>The blanket <code>FromWorld</code> implementation for default types</ol><p>This approach ensures that when <code>SystemState</code> is used to acquire <code>Commands</code> (or any other system parameter), any panic that occurs during parameter initialization or retrieval will correctly point to the developer’s code that called <code>SystemState::get_mut()</code> or similar methods, rather than the internal implementation details.<p>The changes are minimal - just adding the <code>#[track_caller]</code> attribute - but they significantly improve the debugging experience. Each addition follows the same pattern: identifying functions in the system parameter pipeline that could lose caller context and ensuring they preserve it. The PR maintains consistency with existing code that already uses <code>#[track_caller]</code> in similar contexts elsewhere in the codebase.<p>One technical consideration is performance. The <code>#[track_caller]</code> attribute has minimal runtime overhead - it primarily affects compilation by preserving location information that would otherwise be lost. In exchange for this small cost, developers get much better error messages when debugging system state interactions.<p>The impact of this fix is primarily on developer experience rather than runtime behavior. Developers using <code>SystemState</code> for advanced ECS patterns will now get accurate error locations when something goes wrong with command queue operations. This aligns with Rust’s philosophy of providing helpful compiler errors and stack traces.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Developer Code] --> B[SystemState::get_mut]
</span><span>    B --> C[SystemParam::get_param]
</span><span>    C --> D[Commands Implementation]
</span><span>    D --> E[CommandQueue Operations]
</span><span>    
</span><span>    F[Before Fix: Error points here] --> G[FromWorld::from_world]
</span><span>    H[After Fix: Error points here] --> A
</span><span>    
</span><span>    B -.->|track_caller| H
</span><span>    C -.->|track_caller| H
</span><span>    D -.->|track_caller| H
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-system-commands-mod-rs><code>crates/bevy_ecs/src/system/commands/mod.rs</code></h3><p>This file contains the <code>SystemParam</code> implementation for <code>Commands</code>. The changes add <code>#[track_caller]</code> to the <code>init_state</code> and <code>get_param</code> methods, ensuring that any panics during command acquisition point to the caller’s code.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_state</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>State {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>get_param</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>>(
</span><span>    </span><span style=color:#ff8f40>state</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'s mut Self</span><span style=color:#ed9366>::</span><span>State,
</span><span>    </span><span style=color:#ff8f40>system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>system</span><span style=color:#ed9366>::</span><span>SystemMeta,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>world</span><span style=color:#ed9366>::</span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>    </span><span style=color:#ff8f40>change_tick</span><span style=color:#61676ccc>: </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>Tick,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Item<</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_state</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>State {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>get_param</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>>(
</span><span>    </span><span style=color:#ff8f40>state</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'s mut Self</span><span style=color:#ed9366>::</span><span>State,
</span><span>    </span><span style=color:#ff8f40>system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>system</span><span style=color:#ed9366>::</span><span>SystemMeta,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>world</span><span style=color:#ed9366>::</span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>    </span><span style=color:#ff8f40>change_tick</span><span style=color:#61676ccc>: </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>Tick,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Item<</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-system-function-system-rs><code>crates/bevy_ecs/src/system/function_system.rs</code></h3><p>This file manages <code>SystemState</code>, which allows systems to be executed manually. The changes add <code>#[track_caller]</code> to methods that retrieve system parameters, ensuring error locations point to where <code>SystemState</code> is used.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added #[track_caller] to these methods:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_mut</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'s mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'w mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span>SystemParamItem<</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>, Param> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>get_unchecked</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'s mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span>SystemParamItem<</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>, Param> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>fetch</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'s mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>) </span><span style=color:#61676ccc>-> </span><span>SystemParamItem<</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>, Param> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-system-system-param-rs><code>crates/bevy_ecs/src/system/system_param.rs</code></h3><p>This file contains system parameter implementations. The changes add <code>#[track_caller]</code> to <code>Deferred</code>’s <code>init_state</code> and to the tuple system parameter macro, ensuring consistent location tracking across all system parameter types.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// For Deferred system parameter:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_state</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>State {
</span><span>    SyncCell</span><span style=color:#ed9366>::</span><span>new(T</span><span style=color:#ed9366>::</span><span>from_world(world))
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// In the impl_system_param_tuple macro:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_state</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>State {
</span><span>    (</span><span style=color:#ed9366>$</span><span>($param</span><span style=color:#ed9366>::</span><span>init_state(world)</span><span style=color:#61676ccc>,</span><span>)</span><span style=color:#ed9366>*</span><span>)
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>inline</span><span>]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>get_param</span><span><</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>>(
</span><span>    </span><span style=color:#ff8f40>state</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'s mut Self</span><span style=color:#ed9366>::</span><span>State,
</span><span>    </span><span style=color:#ff8f40>system_meta</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>SystemMeta,
</span><span>    </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>    </span><span style=color:#ff8f40>change_tick</span><span style=color:#61676ccc>:</span><span> Tick,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Item<</span><span style=color:#fa6e32>'w</span><span>, </span><span style=color:#fa6e32>'s</span><span>> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-world-mod-rs><code>crates/bevy_ecs/src/world/mod.rs</code></h3><p>This file contains the <code>FromWorld</code> trait implementation. The change adds <code>#[track_caller]</code> to the blanket implementation for default types, which was previously the incorrect location being reported in error messages.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_world</span><span>(</span><span style=color:#ff8f40>_world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    T</span><span style=color:#ed9366>::</span><span>default()
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>track_caller</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_world</span><span>(</span><span style=color:#ff8f40>_world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    T</span><span style=color:#ed9366>::</span><span>default()
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><p><strong>Rust’s <code>#[track_caller]</code> attribute</strong>: The official Rust documentation explains how this attribute works and when to use it: https://doc.rust-lang.org/std/panic/track_caller/index.html</p><li><p><strong>Bevy ECS SystemParam documentation</strong>: For understanding how system parameters work in Bevy: https://bevyengine.org/learn/quick-start/ecs/system-params/</p><li><p><strong>Bevy’s SystemState API</strong>: Documentation on manually managing system execution with SystemState: https://docs.rs/bevy_ecs/latest/bevy_ecs/system/struct.SystemState.html</p><li><p><strong>Error Handling in Bevy</strong>: General patterns for error handling in Bevy systems and how to get useful debug information: https://bevy-cheatbook.github.io/programming/errors.html</p><li><p><strong>Rust’s Panic Hook Mechanism</strong>: Understanding how Rust captures and reports panic locations: https://doc.rust-lang.org/std/panic/fn.set_hook.html</p></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22353.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>