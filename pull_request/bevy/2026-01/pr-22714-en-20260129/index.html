<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22714 RenderCreation refactor
        
    </title><meta content="#22714 RenderCreation refactor" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22714-zh-cn-20260129>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>RenderCreation refactor<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: RenderCreation refactor<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22714<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Code-Quality, S-Ready-For-Final-Review, D-Modest<li><strong>Created</strong>: 2026-01-26T14:56:49Z<li><strong>Merged</strong>: 2026-01-29T22:50:29Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><ul><li>work towards renderer recovery</ul><p><strong>Solution</strong><ul><li>make render creation reusable<li>document weird stuff thats going</ul><p><strong>Testing</strong><ul><li>ci</ul><p>note: reviewing by commit is easier. when a big block moves its just a copy paste, the minor tweaks are separated into other commits<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request refactors the render creation logic in Bevy’s renderer to improve code organization and prepare for renderer recovery scenarios. The main goal was to extract the complex render initialization logic into a reusable method and clean up the implementation while maintaining the same functionality.<p>The problem centered around the <code>RenderPlugin::build</code> method, which contained a substantial amount of inline logic for handling two different render creation modes: manual and automatic. This code was difficult to reuse and made the plugin’s build method overly complex. The automatic creation path involved asynchronous renderer initialization with different behavior for WebAssembly vs native targets, while the manual path simply used pre-created resources.<p>The developer took a straightforward approach by moving the render creation logic into a new <code>create_render</code> method on the <code>RenderCreation</code> enum. This extraction follows standard refactoring practices where complex conditional logic is moved to dedicated methods on the types that control that logic. The solution maintains all existing functionality while making the code more modular and easier to understand.<p>Looking at the implementation, the key change was extracting 50+ lines of render initialization code from <code>RenderPlugin::build</code> and moving it to <code>RenderCreation::create_render</code>. This method now handles both creation modes and returns a boolean indicating whether creation was successful. The signature includes parameters for the future resources container, primary window handle, and Vulkan initialization settings (when the feature is enabled).<p>An important aspect of this refactor is how it handles the <code>FutureRenderResources</code> type. This resource acts as a synchronization point between the main thread and potential asynchronous render initialization. The PR makes this type <code>pub(crate)</code> and adds <code>Default</code> and <code>Clone</code> derives, which simplifies its usage. The <code>MainWorld</code> type also benefits from using the <code>Deref</code> and <code>DerefMut</code> derives from <code>bevy_derive</code> instead of manual implementations, reducing boilerplate code.<p>The <code>RenderPlugin::ready</code> method received significant documentation improvements. The original implementation had complex logic for checking if render resources were ready, but the reasoning behind this logic wasn’t clearly documented. The PR adds a detailed comment explaining the synchronization behavior: <code>FutureRenderResources</code> is added in <code>build</code> before <code>ready</code> runs, and the lock behavior indicates whether resources are being populated or are already available. This documentation is crucial because the pattern of checking a mutex-protected option is non-obvious and could lead to bugs if misunderstood.<p>From an architectural perspective, this refactor improves separation of concerns. The <code>RenderCreation</code> enum now encapsulates all logic related to creating render resources, while <code>RenderPlugin</code> focuses on coordinating plugin initialization. This makes the codebase easier to maintain and sets the stage for future renderer recovery features where render resources might need to be recreated at runtime.<p>The changes also include minor improvements like using <code>renderer::</code> prefix consistently instead of <code>crate::renderer::</code> in type paths, which improves code readability. The conditional compilation for the <code>raw_vulkan_init</code> feature is also cleaned up in the <code>RenderResources</code> tuple struct definition.<p>Overall, this PR demonstrates effective incremental refactoring: extracting complex logic into dedicated methods, improving documentation for tricky synchronization patterns, and standardizing type implementations with derive macros. While the functional behavior remains unchanged, the code quality improvements make the render initialization system more maintainable and better documented for future development.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[RenderPlugin.build] --> B{Which RenderCreation mode?}
</span><span>    B -->|Manual| C[Use pre-existing RenderResources]
</span><span>    B -->|Automatic| D[Initialize renderer asynchronously]
</span><span>    C --> E[Store in FutureRenderResources]
</span><span>    D --> E
</span><span>    E --> F[Initialize render app]
</span><span>    
</span><span>    G[RenderCreation enum] --> H[Manual variant]
</span><span>    G --> I[Automatic variant]
</span><span>    I --> J[create_render method]
</span><span>    J --> K{Has backends?}
</span><span>    K -->|Yes| L[Async renderer initialization]
</span><span>    K -->|No| M[Return false]
</span><span>    
</span><span>    L -->|WASM| N[Spawn local task]
</span><span>    L -->|Native| O[Block on completion]
</span><span>    N --> P[Populate FutureRenderResources]
</span><span>    O --> P
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-src-lib-rs-38-77><code>crates/bevy_render/src/lib.rs</code> (+38/-77)</h3><p><strong>What changed</strong>: This file contains the main refactoring of the <code>RenderPlugin</code> to use the new <code>create_render</code> method and improvements to the <code>MainWorld</code> and <code>FutureRenderResources</code> types.<p><strong>Key modifications</strong>:<ol><li><code>MainWorld</code> now uses derive macros for <code>Deref</code> and <code>DerefMut</code> instead of manual implementations:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MainWorld</span><span>(World)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Deref </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>MainWorld </span><span>{
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Target </span><span style=color:#ed9366>=</span><span> World</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>deref</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Target { </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>}
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span>DerefMut </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>MainWorld </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>deref_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut Self</span><span style=color:#ed9366>::</span><span>Target { </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>}
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Deref</span><span style=color:#61676ccc>,</span><span> DerefMut)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MainWorld</span><span>(World)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><code>FutureRenderResources</code> is now <code>pub(crate)</code> with additional derives:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>FutureRenderResources</span><span>(Arc&LTMutex<</span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTRenderResources>>>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Deref)]
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>FutureRenderResources</span><span>(Arc&LTMutex<</span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTRenderResources>>>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li>Simplified <code>RenderPlugin::build</code> method that delegates to <code>RenderCreation::create_render</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> future_resources </span><span style=color:#ed9366>= </span><span>FutureRenderResources</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>render_creation</span><span style=color:#ed9366>.</span><span style=color:#f07171>create_render</span><span>(
</span><span>    future_resources</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>    primary_window</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span>    raw_vulkan_init_settings</span><span style=color:#61676ccc>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Note that `future_resources` is not necessarily populated here yet.
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(future_resources)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// SAFETY: Plugins should be set up on the main thread.
</span><span>    </span><span style=color:#fa6e32>unsafe </span><span>{ </span><span style=color:#f07171>initialize_render_app</span><span>(app) }</span><span style=color:#61676ccc>;
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><ol start=4><li>Improved documentation in <code>RenderPlugin::ready</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added detailed comment explaining the synchronization logic:
</span><span style=color:#abb0b6;font-style:italic>// This is a little tricky. `FutureRenderResources` is added in `build`, which runs synchronously before `ready`.
</span><span style=color:#abb0b6;font-style:italic>// It is only added if there is a wgpu backend and thus the renderer can be created.
</span><span style=color:#abb0b6;font-style:italic>// Hence, if we try and get the resource and it is not present, that means we are ready, because we dont need it.
</span><span style=color:#abb0b6;font-style:italic>// On the other hand, if the resource is present, then we try and lock on it. The lock can fail, in which case
</span><span style=color:#abb0b6;font-style:italic>// we currently can assume that means the `FutureRenderResources` is in the act of being populated, because
</span><span style=color:#abb0b6;font-style:italic>// that is the only other place the lock may be held. If it is being populated, we can assume we're ready. This
</span><span style=color:#abb0b6;font-style:italic>// happens via the `and_then` falling through to the same `unwrap_or(true)` case as when there's no resource.
</span><span style=color:#abb0b6;font-style:italic>// If the lock succeeds, we can straightforwardly check if it is populated. If it is not, then we're not ready.
</span></code></pre><h3 id=crates-bevy-render-src-settings-rs-55-5><code>crates/bevy_render/src/settings.rs</code> (+55/-5)</h3><p><strong>What changed</strong>: This file adds the new <code>create_render</code> method to the <code>RenderCreation</code> enum and cleans up some type references.<p><strong>Key modifications</strong>:<ol><li>Added the <code>create_render</code> method to handle both manual and automatic render creation:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>create_render</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>future_resources</span><span style=color:#61676ccc>:</span><span> FutureRenderResources,
</span><span>    </span><span style=color:#ff8f40>primary_window</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTRawHandleWrapperHolder>,
</span><span>    #[cfg(</span><span style=color:#ff8f40>feature</span><span> = "</span><span style=color:#ff8f40>raw_vulkan_init</span><span>")]
</span><span>    </span><span style=color:#ff8f40>raw_vulkan_init_settings</span><span style=color:#61676ccc>: </span><span>renderer</span><span style=color:#ed9366>::</span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>RawVulkanInitSettings,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self </span><span>{
</span><span>        RenderCreation</span><span style=color:#ed9366>::</span><span>Manual(resources) </span><span style=color:#ed9366>=> </span><span>{
</span><span>            </span><span style=color:#ed9366>*</span><span>future_resources</span><span style=color:#ed9366>.</span><span style=color:#f07171>lock</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>() </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(resources</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>        RenderCreation</span><span style=color:#ed9366>::</span><span>Automatic(render_creation) </span><span style=color:#ed9366>=> </span><span>{
</span><span>            </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(backends) </span><span style=color:#ed9366>=</span><span> render_creation</span><span style=color:#ed9366>.</span><span>backends </span><span style=color:#fa6e32>else </span><span>{
</span><span>                </span><span style=color:#fa6e32>return </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>;
</span><span>            }</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>let</span><span> settings </span><span style=color:#ed9366>=</span><span> render_creation</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>            </span><span style=color:#fa6e32>let</span><span> async_renderer </span><span style=color:#ed9366>=</span><span> async </span><span style=color:#fa6e32>move </span><span>{
</span><span>                </span><span style=color:#fa6e32>let</span><span> render_resources </span><span style=color:#ed9366>= </span><span>renderer</span><span style=color:#ed9366>::</span><span>initialize_renderer(
</span><span>                    backends</span><span style=color:#61676ccc>,
</span><span>                    primary_window</span><span style=color:#61676ccc>,
</span><span>                    </span><span style=color:#ed9366>&</span><span>settings</span><span style=color:#61676ccc>,
</span><span>                    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span>                    raw_vulkan_init_settings</span><span style=color:#61676ccc>,
</span><span>                )
</span><span>                </span><span style=color:#ed9366>.</span><span>await</span><span style=color:#61676ccc>;
</span><span>
</span><span>                </span><span style=color:#ed9366>*</span><span>future_resources</span><span style=color:#ed9366>.</span><span style=color:#f07171>lock</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>() </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_resources)</span><span style=color:#61676ccc>;
</span><span>            }</span><span style=color:#61676ccc>;
</span><span>
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// In wasm, spawn a task and detach it for execution
</span><span>            </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span>)]
</span><span>            bevy_tasks</span><span style=color:#ed9366>::</span><span>IoTaskPool</span><span style=color:#ed9366>::</span><span>get()
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn_local</span><span>(async_renderer)
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>detach</span><span>()</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// Otherwise, just block for it to complete
</span><span>            </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(target_arch </span><span style=color:#ed9366>= </span><span style=color:#86b300>"wasm32"</span><span>))]
</span><span>            bevy_tasks</span><span style=color:#ed9366>::</span><span>block_on(async_renderer)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>    </span><span style=color:#ff8f40>true
</span><span>}
</span></code></pre><ol start=2><li>Cleaned up type references in <code>RenderResources</code> tuple struct:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)]
</span><span style=color:#fa6e32>pub  crate</span><span style=color:#ed9366>::</span><span>renderer</span><span style=color:#ed9366>::</span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>AdditionalVulkanFeatures</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"raw_vulkan_init"</span><span>)] </span><span style=color:#fa6e32>pub </span><span>renderer</span><span style=color:#ed9366>::</span><span>raw_vulkan_init</span><span style=color:#ed9366>::</span><span>AdditionalVulkanFeatures</span><span style=color:#61676ccc>,
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><strong>Bevy’s Renderer Architecture</strong>: For understanding how Bevy’s renderer works, check the <a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/render.html target=_blank>Bevy Render Book</a><li><strong>wgpu and Async Rendering</strong>: The <a rel="noopener nofollow noreferrer" href=https://wgpu.rs/ target=_blank>wgpu documentation</a> provides details on the graphics abstraction layer used by Bevy<li><strong>Rust Synchronization Patterns</strong>: The <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch16-00-concurrency.html target=_blank>Rust Book chapter on concurrency</a> covers Arc, Mutex, and other synchronization primitives used in this PR<li><strong>Bevy Plugin System</strong>: The <a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/plugins.html target=_blank>Bevy Plugin guide</a> explains how plugins like <code>RenderPlugin</code> work<li><strong>Refactoring Techniques</strong>: Martin Fowler’s <a rel="noopener nofollow noreferrer" href=https://refactoring.com/ target=_blank>Refactoring: Improving the Design of Existing Code</a> provides general principles for code restructuring</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22714.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>