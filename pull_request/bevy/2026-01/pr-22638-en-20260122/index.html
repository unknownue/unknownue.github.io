<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #22638 Rename world.entities_allocator to entity_allocator
        
    </title><meta content="#22638 Rename world.entities_allocator to entity_allocator" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2026-01/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2026-01-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2026-01/pr-22638-zh-cn-20260122>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Rename world.entities_allocator to entity_allocator<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/22638<li><strong>Author</strong>: cart<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Code-Quality, C-Usability, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2026-01-21T23:45:08Z<li><strong>Merged</strong>: 2026-01-22T01:14:01Z<li><strong>Merged By</strong>: cart</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>We missed this when we renamed <code>EntitiesAllocator</code> to <code>EntityAllocator</code><h2 id=solution>Solution</h2><p>Rename it<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a naming inconsistency in Bevy’s Entity Component System (ECS) that occurred during a previous refactoring. The core issue is straightforward: when the type <code>EntitiesAllocator</code> was renamed to <code>EntityAllocator</code> in an earlier change, several related field and method names in the <code>World</code> struct weren’t updated to match. This PR systematically corrects that oversight to maintain consistency across the codebase.<p>The problem manifested as a mismatch between type names and their associated accessor methods. While the type had been updated from <code>EntitiesAllocator</code> to <code>EntityAllocator</code>, the corresponding field in the <code>World</code> struct remained named <code>allocator</code>, and the public accessor methods were still named <code>entities_allocator()</code> and <code>entities_allocator_mut()</code>. This inconsistency could confuse developers reading the code and create unnecessary mental overhead when working with the entity allocation system.<p>The solution approach is a straightforward rename operation that touches multiple files in the <code>bevy_ecs</code> crate. The developer methodically updated:<ol><li>The field name in the <code>World</code> struct from <code>allocator</code> to <code>entity_allocator</code><li>The public accessor methods from <code>entities_allocator()</code> and <code>entities_allocator_mut()</code> to <code>entity_allocator()</code> and <code>entity_allocator_mut()</code><li>All internal references to these fields and methods throughout the codebase<li>The corresponding method in <code>UnsafeWorldCell</code> from <code>entities_allocator()</code> to <code>entity_allocator()</code></ol><p>This change is primarily about code quality and developer experience rather than functional behavior. By aligning method names with the type they return (<code>EntityAllocator</code>), the API becomes more intuitive and consistent. The naming follows the pattern established by other World methods like <code>entity()</code> and <code>entities()</code>, which return single entities and the entities collection respectively.<p>From a technical perspective, this change required updates across 11 files in the <code>crates/bevy_ecs</code> directory, demonstrating how a core type rename can ripple through a codebase. Each update is mechanical but necessary for consistency. The PR also adds a migration guide to help users update their code, showing that this is considered a breaking change that requires documentation.<p>The implementation reveals several interesting aspects of Bevy’s ECS architecture. The <code>EntityAllocator</code> is responsible for managing entity IDs and tracking which ones are available for reuse. It’s a critical component of Bevy’s entity management system, and references to it appear in many places including spawning systems, command processing, and entity mapping utilities. The fact that so many files needed updating underscores how central the World struct and its entity allocation capabilities are to the ECS framework.<p>One notable technical insight is how this change affects both safe and unsafe world access. The <code>UnsafeWorldCell</code> type, which provides low-level access to world data, also needed its method name updated. This ensures consistency across the entire API surface, whether developers are using safe or unsafe world access patterns.<p>The impact of this change is primarily on code readability and maintainability. Developers working with entity allocation will now encounter consistent naming that matches the type system. This reduces cognitive load and makes the codebase easier to navigate. The migration guide helps ensure existing code can be updated with minimal disruption.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    World --> EntityAllocator
</span><span>    World --> UnsafeWorldCell
</span><span>    EntityAllocator --> EntityManagement
</span><span>    UnsafeWorldCell --> LowLevelAccess
</span><span>    
</span><span>    subgraph "Renamed Methods"
</span><span>        World_entities_allocator[World::entities_allocator] --> World_entity_allocator[World::entity_allocator]
</span><span>        World_entities_allocator_mut[World::entities_allocator_mut] --> World_entity_allocator_mut[World::entity_allocator_mut]
</span><span>        UnsafeWorldCell_entities_allocator[UnsafeWorldCell::entities_allocator] --> UnsafeWorldCell_entity_allocator[UnsafeWorldCell::entity_allocator]
</span><span>    end
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-world-mod-rs><code>crates/bevy_ecs/src/world/mod.rs</code></h3><p>This file contains the definition of the <code>World</code> struct and its public API. The field and method names were updated to use <code>entity_allocator</code> instead of <code>entities_allocator</code>.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_ecs/src/world/mod.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) allocator</span><span style=color:#61676ccc>:</span><span> EntityAllocator,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>entities_allocator</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>EntityAllocator {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>allocator
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>entities_allocator_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityAllocator {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>allocator
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) entity_allocator</span><span style=color:#61676ccc>:</span><span> EntityAllocator,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>entity_allocator</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>EntityAllocator {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>entity_allocator
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>entity_allocator_mut</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> EntityAllocator {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>entity_allocator
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-world-unsafe-world-cell-rs><code>crates/bevy_ecs/src/world/unsafe_world_cell.rs</code></h3><p>This file contains the unsafe world access API. The method name was updated to match the change in the main World struct.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_ecs/src/world/unsafe_world_cell.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>'w</span><span>> </span><span style=color:#399ee6>UnsafeWorldCell</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>entities_allocator</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'w</span><span> EntityAllocator {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>unsafe </span><span>{ </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_metadata</span><span>() }</span><span style=color:#ed9366>.</span><span>allocator
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>'w</span><span>> </span><span style=color:#399ee6>UnsafeWorldCell</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>entity_allocator</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'w</span><span> EntityAllocator {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>unsafe </span><span>{ </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_metadata</span><span>() }</span><span style=color:#ed9366>.</span><span>entity_allocator
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-entity-mod-rs><code>crates/bevy_ecs/src/entity/mod.rs</code></h3><p>This file contains documentation examples that needed updating to use the new method names.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_ecs/src/entity/mod.rs
</span><span style=color:#abb0b6;font-style:italic>// Before (in documentation example):
</span><span style=color:#abb0b6;font-style:italic>// let entity = world.entities_allocator().alloc();
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// let entity = world.entity_allocator().alloc();
</span></code></pre><h3 id=crates-bevy-ecs-src-lib-rs><code>crates/bevy_ecs/src/lib.rs</code></h3><p>This file contains test code that was updated to use the new method names.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_ecs/src/lib.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>// let e1 = world.entities_allocator_mut().alloc();
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// let e1 = world.entity_allocator_mut().alloc();
</span></code></pre><h3 id=release-content-migration-guides-entity-allocator-md><code>release-content/migration-guides/entity_allocator.md</code></h3><p>This is a new migration guide added to help users update their code.<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#abb0b6;background-color:#61676c10;font-weight:700>---
</span><span>title: "</span><span style=color:#ed9366;background-color:#61676c10>`World::entities_allocator`</span><span> is now </span><span style=color:#ed9366;background-color:#61676c10>`World::entity_allocator`</span><span>"
</span><span>pull_requests: [22638]
</span><span style=color:#fa6e32;font-weight:700>---
</span><span>
</span><span style=color:#ed9366;background-color:#61676c10>`World::entities_allocator()`</span><span> has been renamed to </span><span style=color:#ed9366;background-color:#61676c10>`World::entity_allocator()`</span><span> to match the type returned (</span><span style=color:#ed9366;background-color:#61676c10>`EntityAllocator`</span><span>). Likewise, </span><span style=color:#ed9366;background-color:#61676c10>`World::entities_allocator_mut()`</span><span> has been renamed to </span><span style=color:#ed9366;background-color:#61676c10>`World::entity_allocator_mut()`</span><span>.
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/world/struct.World.html target=_blank>Bevy ECS World Documentation</a> - Official documentation for the World struct and its methods<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/entity/struct.EntityAllocator.html target=_blank>EntityAllocator Type Documentation</a> - Documentation for the EntityAllocator type<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/migration-guides/ target=_blank>Bevy Migration Guides</a> - Other migration guides for updating Bevy code<li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/naming.html target=_blank>Rust API Guidelines: Naming</a> - Rust conventions for naming types and methods</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2026-01/pr_22638.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>