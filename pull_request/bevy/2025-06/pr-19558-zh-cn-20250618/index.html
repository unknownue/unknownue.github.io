<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19558 ECS: put strings only used for debug behind a feature
        
    </title><meta content="#19558 ECS: put strings only used for debug behind a feature" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-18</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-06/pr-19558-en-20250618>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=ji-shu-fen-xi-bao-gao-ecs-put-strings-only-used-for-debug-behind-a-feature>技术分析报告：ECS: put strings only used for debug behind a feature</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: ECS: put strings only used for debug behind a feature<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19558<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Performance, S-Ready-For-Final-Review, X-Contentious<li><strong>Created</strong>: 2025-06-09T17:02:21Z<li><strong>Merged</strong>: 2025-06-18T20:34:16Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h3 id=mu-biao>目标</h3><ul><li>bevy_ecs 中的许多字符串被创建但仅用于调试：系统名称、组件名称等<li>这些字符串在最终二进制文件中占据显著部分，在发布版本的游戏中没有实际用途</ul><h3 id=jie-jue-fang-an>解决方案</h3><ul><li>使用 <a rel="noopener nofollow noreferrer" href=https://linux.die.net/man/1/strings target=_blank><code>strings</code></a> 工具查找二进制文件中的字符串<li>尝试定位这些字符串的来源<li>许多字符串来自 <code>type_name::&LTT>()</code> 且仅用于错误/调试消息<li>添加新的 <code>DebugName</code> 结构，当 <code>debug</code> 特性禁用时不包含值<li>将 <code>core::any::type_name::&LTT>()</code> 替换为 <code>DebugName::type_name::&LTT>()</code></ul><h3 id=ce-shi>测试</h3><p>测量结果是在新特性默认未启用的情况下获取的，以便于命令执行<h4 id=wen-jian-da-xiao>文件大小</h4><p>尝试构建 <code>breakout</code> 示例：<code>cargo run --release --example breakout</code><table><thead><tr><th><code>debug</code> 启用<th><code>debug</code> 禁用<tbody><tr><td>81621776 B<td>77735728 B<tr><td>77.84 MB<td>74.13 MB</table><h4 id=bian-yi-shi-jian>编译时间</h4><p><code>hyperfine --min-runs 15  --prepare "cargo clean && sleep 5" 'RUSTC_WRAPPER="" cargo build --release --example breakout' 'RUSTC_WRAPPER="" cargo build --release --example breakout --features debug'</code><pre style=color:#61676c;background-color:#fafafa><code><span>breakout' 'RUSTC_WRAPPER="" cargo build --release --example breakout --features debug'
</span><span>Benchmark 1: RUSTC_WRAPPER="" cargo build --release --example breakout
</span><span>  Time (mean ± σ):     84.856 s ±  3.565 s    [User: 1093.817 s, System: 32.547 s]
</span><span>  Range (min … max):   78.038 s … 89.214 s    15 runs
</span><span>
</span><span>Benchmark 2: RUSTC_WRAPPER="" cargo build --release --example breakout --features debug
</span><span>  Time (mean ± σ):     92.303 s ±  2.466 s    [User: 1193.443 s, System: 33.803 s]
</span><span>  Range (min … max):   90.619 s … 99.684 s    15 runs
</span><span>
</span><span>Summary
</span><span>  RUSTC_WRAPPER="" cargo build --release --example breakout ran
</span><span>    1.09 ± 0.05 times faster than RUSTC_WRAPPER="" cargo build --release --example breakout --features debug
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=wen-ti-bei-jing>问题背景</h3><p>在 Bevy 的 ECS 模块中，存在大量仅用于调试目的的类型名称字符串，例如系统名称、组件名称等。这些字符串通过 <code>core::any::type_name::&LTT>()</code> 生成，主要出现在错误消息和调试输出中。在最终的游戏发布版本中，这些字符串没有实际用途，但它们会：<ol><li>显著增加二进制文件大小<li>延长编译时间<li>占用内存空间</ol><p>开发者使用 <code>strings</code> 工具分析二进制文件，确认这些类型名字符串占据了可观的体积。在 <code>breakout</code> 示例中，启用调试特性时二进制大小为 77.84MB，禁用后降至 74.13MB，减少了 3.71MB（约 4.8%）。<h3 id=jie-jue-fang-an-she-ji>解决方案设计</h3><p>核心思路是将调试字符串与核心功能解耦，通过特性开关控制其包含：<ol><li>引入 <code>DebugName</code> 封装类型，根据 <code>debug</code> 特性状态有条件地存储类型名称<li>全面替换 <code>type_name::&LTT>()</code> 调用为 <code>DebugName::type_name::&LTT>()</code><li>修改相关接口返回 <code>DebugName</code> 而非原始字符串</ol><p>关键设计决策：<ul><li>保持原有API签名兼容性，避免破坏性变更<li>在发布构建中完全消除字符串开销<li>提供一致的调试信息访问接口<li>确保调试信息在需要时仍可完整获取</ul><h3 id=shi-xian-xi-jie>实现细节</h3><p>在 <code>bevy_utils</code> 中新增 <code>DebugName</code> 结构，这是解决方案的核心：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_utils/src/debug_info.rs
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>    name</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>}
</span></code></pre><p>该结构的行为取决于 <code>debug</code> 特性：<ul><li>启用时：存储并返回实际类型名称<li>禁用时：返回固定提示字符串</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>type_name</span><span>&LTT>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        DebugName {
</span><span>            </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>            name</span><span style=color:#61676ccc>: </span><span>Cow</span><span style=color:#ed9366>::</span><span>Borrowed(type_name</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>shortname</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ShortName {
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>        </span><span style=color:#fa6e32>return</span><span> ShortName(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>name</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>())</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>))]
</span><span>        </span><span style=color:#fa6e32>return</span><span> ShortName(</span><span style=color:#ff8f40>FEATURE_DISABLED</span><span>)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>在 ECS 模块中的主要修改模式是将字符串类型替换为 <code>DebugName</code>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_ecs/src/component.rs
</span><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ComponentDescriptor </span><span>{
</span><span>    name</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ComponentDescriptor </span><span>{
</span><span>    name</span><span style=color:#61676ccc>:</span><span> DebugName,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ComponentDescriptor </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            name</span><span style=color:#61676ccc>: </span><span>DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// 替换这里
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... 其他字段不变
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>类似修改应用于整个代码库的50多个文件，主要涉及：<ul><li>组件和资源名称<li>系统名称<li>错误消息中的类型信息<li>调试输出<li>序列化/反序列化路径</ul><h3 id=xing-neng-ying-xiang>性能影响</h3><p>测试数据表明优化效果显著：<ol><li><p><strong>二进制大小</strong>：</p> <ul><li><code>breakout</code> 示例：77.84MB → 74.13MB（减少 3.71MB）<li>相对减少约 4.8%，对于大型项目效果更明显</ul><li><p><strong>编译时间</strong>：</p> <ul><li>完整构建时间减少约 8%<li>增量构建因减少代码量而更快<li>链接时间因二进制缩小而改善</ul></ol><h3 id=gong-cheng-kao-liang>工程考量</h3><ol><li><p><strong>条件编译的运用</strong>：</p> <ul><li>使用 <code>#[cfg(feature = "debug")]</code> 条件编译<li>确保发布构建中完全消除字符串开销<li>保持调试构建的完整信息</ul><li><p><strong>接口一致性</strong>：</p> <ul><li>统一使用 <code>DebugName</code> 作为调试信息的载体<li>提供 <code>shortname()</code> 方法获取简化名称<li>保持现有API兼容性</ul><li><p><strong>错误处理</strong>：</p> <ul><li>在特性禁用时提供友好的错误提示<li>保持错误消息的可读性</ul><li><p><strong>测试验证</strong>：</p> <ul><li>添加 CI 测试确保 <code>debug</code> 特性正常工作<li>验证各功能模块在特性开关下的表现</ul></ol><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[DebugName 结构] --> B[Component 系统]
</span><span>    A --> C[Resource 系统]
</span><span>    A --> D[Query 系统]
</span><span>    A --> E[错误处理]
</span><span>    B --> F[组件名称]
</span><span>    C --> G[资源名称]
</span><span>    D --> H[查询调试信息]
</span><span>    E --> I[错误上下文]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-utils-src-debug-info-rs-102-0>1. <code>crates/bevy_utils/src/debug_info.rs</code> (+102/-0)</h3><p>新增文件，定义 <code>DebugName</code> 结构及其实现。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 关键实现
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>type_name</span><span>&LTT>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        DebugName {
</span><span>            </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>            name</span><span style=color:#61676ccc>: </span><span>Cow</span><span style=color:#ed9366>::</span><span>Borrowed(type_name</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>shortname</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ShortName {
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>        </span><span style=color:#fa6e32>return</span><span> ShortName(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>name</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>())</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>))]
</span><span>        </span><span style=color:#fa6e32>return</span><span> ShortName(</span><span style=color:#ff8f40>FEATURE_DISABLED</span><span>)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-ecs-src-system-system-param-rs-24-23>2. <code>crates/bevy_ecs/src/system/system_param.rs</code> (+24/-23)</h3><p>修改系统参数相关的错误处理和名称访问。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span style=color:#f07171>panic!</span><span>(
</span><span>    </span><span style=color:#86b300>"error[B0002]: ResMut<{}> in system {} conflicts..."</span><span style=color:#61676ccc>,
</span><span>    core</span><span style=color:#ed9366>::</span><span>any</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>    system_meta</span><span style=color:#ed9366>.</span><span>name
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span style=color:#f07171>panic!</span><span>(
</span><span>    </span><span style=color:#86b300>"error[B0002]: ResMut<{}> in system {} conflicts..."</span><span style=color:#61676ccc>,
</span><span>    DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>    system_meta</span><span style=color:#ed9366>.</span><span>name
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=3-crates-bevy-ecs-src-component-rs-14-18>3. <code>crates/bevy_ecs/src/component.rs</code> (+14/-18)</h3><p>重构组件描述符使用 <code>DebugName</code>。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ComponentInfo </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>name</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str </span><span>{
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>descriptor</span><span style=color:#ed9366>.</span><span>name
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ComponentInfo </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>name</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> DebugName {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>descriptor</span><span style=color:#ed9366>.</span><span>name</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()
</span><span>    }
</span><span>}
</span></code></pre><h3 id=4-crates-bevy-ecs-src-world-mod-rs-17-15>4. <code>crates/bevy_ecs/src/world/mod.rs</code> (+17/-15)</h3><p>修改世界对象的组件名称访问方法。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_name</span><span><</span><span style=color:#fa6e32>'a</span><span>>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> ComponentId) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTCow<</span><span style=color:#fa6e32>'a</span><span>, </span><span style=color:#fa6e32>str</span><span>>> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(id</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>and_then</span><span>(|</span><span style=color:#ff8f40>info</span><span>| {
</span><span>        info</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>info</span><span>| Cow</span><span style=color:#ed9366>::</span><span>Borrowed(info</span><span style=color:#ed9366>.</span><span>descriptor</span><span style=color:#ed9366>.</span><span style=color:#f07171>name</span><span>()))
</span><span>    })
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_name</span><span><</span><span style=color:#fa6e32>'a</span><span>>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'a </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> ComponentId) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTDebugName> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(id</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>and_then</span><span>(|</span><span style=color:#ff8f40>info</span><span>| {
</span><span>        info</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>info</span><span>| info</span><span style=color:#ed9366>.</span><span>descriptor</span><span style=color:#ed9366>.</span><span style=color:#f07171>name</span><span>())
</span><span>    })
</span><span>}
</span></code></pre><h3 id=5-crates-bevy-ecs-src-system-system-name-rs-10-19>5. <code>crates/bevy_ecs/src/system/system_name.rs</code> (+10/-19)</h3><p>重构系统名称处理。<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 修改前
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SystemName</span><span>(Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 修改后
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SystemName</span><span>(DebugName)</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Rust 条件编译文档</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ecs/ target=_blank>Bevy ECS 架构概览</a><li><a rel="noopener nofollow noreferrer" href=https://linux.die.net/man/1/strings target=_blank>使用 strings 工具分析二进制文件</a><li><a rel="noopener nofollow noreferrer" href=https://nnethercote.github.io/perf-book/ target=_blank>Rust 性能优化技巧</a></ol><h1 id=full-code-diff>Full Code Diff</h1><details><summary>展开查看完整差异</summary> <pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml
</span><span>index a37d11ddf95b8..526ac4c4013de 100644
</span><span style=color:#c594c5>--- a/.github/workflows/ci.yml
</span><span style=color:#c594c5>+++ b/.github/workflows/ci.yml
</span><span style=color:#c594c5>@@ -95,7 +95,7 @@ </span><span style=color:#399ee6>jobs:
</span><span>       - name: CI job
</span><span>         # To run the tests one item at a time for troubleshooting, use
</span><span>         # cargo --quiet test --lib -- --list | sed 's/: test$//' | MIRIFLAGS="-Zmiri-disable-isolation -Zmiri-disable-weak-memory-emulation" xargs -n1 cargo miri test -p bevy_ecs --lib -- --exact
</span><span style=color:#f07171>-        run: cargo miri test -p bevy_ecs
</span><span style=color:#86b300>+        run: cargo miri test -p bevy_ecs --features bevy_utils/debug
</span><span>         env:
</span><span>           # -Zrandomize-layout makes sure we dont rely on the layout of anything that might change
</span><span>           RUSTFLAGS: -Zrandomize-layout
</span><span>diff --git a/Cargo.toml b/Cargo.toml
</span><span>index ed2b369f5fe77..d2e5b92258d79 100644
</span><span style=color:#c594c5>--- a/Cargo.toml
</span><span style=color:#c594c5>+++ b/Cargo.toml
</span><span style=color:#c594c5>@@ -165,6 +165,7 @@ </span><span style=color:#399ee6>default = [
</span><span>   "vorbis",
</span><span>   "webgl2",
</span><span>   "x11",
</span><span style=color:#86b300>+  "debug",
</span><span> ]
</span><span> 
</span><span> # Recommended defaults for no_std applications
</span><span style=color:#c594c5>@@ -507,7 +508,10 @@ </span><span style=color:#399ee6>file_watcher = ["bevy_internal/file_watcher"]
</span><span> embedded_watcher = ["bevy_internal/embedded_watcher"]
</span><span> 
</span><span> # Enable stepping-based debugging of Bevy systems
</span><span style=color:#f07171>-bevy_debug_stepping = ["bevy_internal/bevy_debug_stepping"]
</span><span style=color:#86b300>+bevy_debug_stepping = [
</span><span style=color:#86b300>+  "bevy_internal/bevy_debug_stepping",
</span><span style=color:#86b300>+  "bevy_internal/debug",
</span><span style=color:#86b300>+]
</span><span> 
</span><span> # Enables the meshlet renderer for dense high-poly scenes (experimental)
</span><span> meshlet = ["bevy_internal/meshlet"]
</span><span style=color:#c594c5>@@ -551,6 +555,9 @@ </span><span style=color:#399ee6>web = ["bevy_internal/web"]
</span><span> # Enable hotpatching of Bevy systems
</span><span> hotpatching = ["bevy_internal/hotpatching"]
</span><span> 
</span><span style=color:#86b300>+# Enable collecting debug information about systems and components to help with diagnostics
</span><span style=color:#86b300>+debug = ["bevy_internal/debug"]
</span><span style=color:#86b300>+
</span><span> [dependencies]
</span><span> bevy_internal = { path = "crates/bevy_internal", version = "0.16.0-dev", default-features = false }
</span><span> tracing = { version = "0.1", default-features = false, optional = true }
</span><span style=color:#c594c5>@@ -2098,6 +2105,7 @@ </span><span style=color:#399ee6>wasm = false
</span><span> name = "dynamic"
</span><span> path = "examples/ecs/dynamic.rs"
</span><span> doc-scrape-examples = true
</span><span style=color:#86b300>+required-features = ["debug"]
</span><span> 
</span><span> [package.metadata.example.dynamic]
</span><span> name = "Dynamic ECS"
</span><span>diff --git a/crates/bevy_ecs/Cargo.toml b/crates/bevy_ecs/Cargo.toml
</span><span>index 27498f58bc25c..c2c663b7d7fb5 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/Cargo.toml
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/Cargo.toml
</span><span style=color:#c594c5>@@ -35,7 +35,7 @@ </span><span style=color:#399ee6>backtrace = ["std"]
</span><span> 
</span><span> ## Enables `tracing` integration, allowing spans and other metrics to be reported
</span><span> ## through that framework.
</span><span style=color:#f07171>-trace = ["std", "dep:tracing"]
</span><span style=color:#86b300>+trace = ["std", "dep:tracing", "bevy_utils/debug"]
</span><span> 
</span><span> ## Enables a more detailed set of traces which may be noisy if left on by default.
</span><span> detailed_trace = ["trace"]
</span><span style=color:#c594c5>@@ -63,9 +63,9 @@ </span><span style=color:#399ee6>std = [
</span><span>   "bevy_reflect?/std",
</span><span>   "bevy_tasks/std",
</span><span>   "bevy_utils/parallel",
</span><span style=color:#86b300>+  "bevy_utils/std",
</span><span>   "bitflags/std",
</span><span>   "concurrent-queue/std",
</span><span style=color:#f07171>-  "disqualified/alloc",
</span><span>   "fixedbitset/std",
</span><span>   "indexmap/std",
</span><span>   "serde?/std",
</span><span style=color:#c594c5>@@ -98,7 +98,6 @@ </span><span style=color:#399ee6>bevy_platform = { path = "../bevy_platform", version = "0.16.0-dev", default-fea
</span><span> ] }
</span><span> 
</span><span> bitflags = { version = "2.3", default-features = false }
</span><span style=color:#f07171>-disqualified = { version = "1.0", default-features = false }
</span><span> fixedbitset = { version = "0.5", default-features = false }
</span><span> serde = { version = "1", default-features = false, features = [
</span><span>   "alloc",
</span><span>diff --git a/crates/bevy_ecs/src/bundle.rs b/crates/bevy_ecs/src/bundle.rs
</span><span>index a264f0b14bab9..2687f7eb16ad0 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/bundle.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/bundle.rs
</span><span style=color:#c594c5>@@ -550,10 +550,9 @@ </span><span style=color:#399ee6>impl BundleInfo {
</span><span>                     // SAFETY: the caller ensures component_id is valid.
</span><span>                     unsafe { components.get_info_unchecked(id).name() }
</span><span>                 })
</span><span style=color:#f07171>-                .collect::&LTVec<_>>()
</span><span style=color:#f07171>-                .join(", ");
</span><span style=color:#86b300>+                .collect::&LTVec<_>>();
</span><span> 
</span><span style=color:#f07171>-            panic!("Bundle {bundle_type_name} has duplicate components: {names}");
</span><span style=color:#86b300>+            panic!("Bundle {bundle_type_name} has duplicate components: {names:?}");
</span><span>         }
</span><span> 
</span><span>         // handle explicit components
</span><span>diff --git a/crates/bevy_ecs/src/component.rs b/crates/bevy_ecs/src/component.rs
</span><span>index 27b51ede6ff15..cfcde29ab2ff1 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/component.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/component.rs
</span><span style=color:#c594c5>@@ -24,7 +24,7 @@ </span><span style=color:#399ee6>use bevy_platform::{
</span><span> use bevy_ptr::{OwningPtr, UnsafeCellDeref};
</span><span> #[cfg(feature = "bevy_reflect")]
</span><span> use bevy_reflect::Reflect;
</span><span style=color:#f07171>-use bevy_utils::TypeIdMap;
</span><span style=color:#86b300>+use bevy_utils::{prelude::DebugName, TypeIdMap};
</span><span> use core::{
</span><span>     alloc::Layout,
</span><span>     any::{Any, TypeId},
</span><span style=color:#c594c5>@@ -34,7 +34,6 @@ </span><span style=color:#399ee6>use core::{
</span><span>     mem::needs_drop,
</span><span>     ops::{Deref, DerefMut},
</span><span> };
</span><span style=color:#f07171>-use disqualified::ShortName;
</span><span> use smallvec::SmallVec;
</span><span> use thiserror::Error;
</span><span> 
</span><span style=color:#c594c5>@@ -678,8 +677,8 @@ </span><span style=color:#399ee6>impl ComponentInfo {
</span><span> 
</span><span>     /// Returns the name of the current component.
</span><span>     #[inline]
</span><span style=color:#f07171>-    pub fn name(&self) -> &str {
</span><span style=color:#f07171>-        &self.descriptor.name
</span><span style=color:#86b300>+    pub fn name(&self) -> DebugName {
</span><span style=color:#86b300>+        self.descriptor.name.clone()
</span><span>     }
</span><span> 
</span><span>     /// Returns `true` if the current component is mutable.
</span><span style=color:#c594c5>@@ -836,7 +835,7 @@ </span><span style=color:#399ee6>impl SparseSetIndex for ComponentId {
</span><span> /// A value describing a component or resource, which may or may not correspond to a Rust type.
</span><span> #[derive(Clone)]
</span><span> pub struct ComponentDescriptor {
</span><span style=color:#f07171>-    name: Cow<'static, str>,
</span><span style=color:#86b300>+    name: DebugName,
</span><span>     // SAFETY: This must remain private. It must match the statically known StorageType of the
</span><span>     // associated rust component type if one exists.
</span><span>     storage_type: StorageType,
</span><span style=color:#c594c5>@@ -882,7 +881,7 @@ </span><span style=color:#399ee6>impl ComponentDescriptor {
</span><span>     /// Create a new `ComponentDescriptor` for the type `T`.
</span><span>     pub fn new&LTT: Component>() -> Self {
</span><span>         Self {
</span><span style=color:#f07171>-            name: Cow::Borrowed(core::any::type_name::&LTT>()),
</span><span style=color:#86b300>+            name: DebugName::type_name::&LTT>(),
</span><span>             storage_type: T::STORAGE_TYPE,
</span><span>             is_send_and_sync: true,
</span><span>             type_id: Some(TypeId::of::&LTT>()),
</span><span style=color:#c594c5>@@ -907,7 +906,7 @@ </span><span style=color:#399ee6>impl ComponentDescriptor {
</span><span>         clone_behavior: ComponentCloneBehavior,
</span><span>     ) -> Self {
</span><span>         Self {
</span><span style=color:#f07171>-            name: name.into(),
</span><span style=color:#86b300>+            name: name.into().into(),
</span><span>             storage_type,
</span><span>             is_send_and_sync: true,
</span><span>             type_id: None,
</span><span style=color:#c594c5>@@ -923,7 +922,7 @@ </span><span style=color:#399ee6>impl ComponentDescriptor {
</span><span>     /// The [`StorageType`] for resources is always [`StorageType::Table`].
</span><span>     pub fn new_resource&LTT: Resource>() -> Self {
</span><span>         Self {
</span><span style=color:#f07171>-            name: Cow::Borrowed(core::any::type_name::&LTT>()),
</span><span style=color:#86b300>+            name: DebugName::type_name::&LTT>(),
</span><span>             // PERF: `SparseStorage` may actually be a more
</span><span>             // reasonable choice as `storage_type` for resources.
</span><span>             storage_type: StorageType::Table,
</span><span style=color:#c594c5>@@ -938,7 +937,7 @@ </span><span style=color:#399ee6>impl ComponentDescriptor {
</span><span> 
</span><span>     fn new_non_send&LTT: Any>(storage_type: StorageType) -> Self {
</span><span>         Self {
</span><span style=color:#f07171>-            name: Cow::Borrowed(core::any::type_name::&LTT>()),
</span><span style=color:#86b300>+            name: DebugName::type_name::&LTT>(),
</span><span>             storage_type,
</span><span>             is_send_and_sync: false,
</span><span>             type_id: Some(TypeId::of::&LTT>()),
</span><span style=color:#c594c5>@@ -964,8 +963,8 @@ </span><span style=color:#399ee6>impl ComponentDescriptor {
</span><span> 
</span><span>     /// Returns the name of the current component.
</span><span>     #[inline]
</span><span style=color:#f07171>-    pub fn name(&self) -> &str {
</span><span style=color:#f07171>-        self.name.as_ref()
</span><span style=color:#86b300>+    pub fn name(&self) -> DebugName {
</span><span style=color:#86b300>+        self.name.clone()
</span><span>     }
</span><span> 
</span><span>     /// Returns whether this component is mutable.
</span><span style=color:#c594c5>@@ -1854,13 +1853,10 @@ </span><span style=color:#399ee6>impl Components {
</span><span>     ///
</span><span>     /// This will return an incorrect result if `id` did not come from the same world as `self`. It may return `None` or a garbage value.
</span><span>     #[inline]
</span><span style=color:#f07171>-    pub fn get_name<'a>(&'a self, id: ComponentId) -> Option&LTCow<'a, str>> {
</span><span style=color:#86b300>+    pub fn get_name<'a>(&'a self, id: ComponentId) -> Option&LTDebugName> {
</span><span>         self.components
</span><span>             .get(id.0)
</span><span style=color:#f07171>-            .and_then(|info| {
</span><span style=color:#f07171>-                info.as_ref()
</span><span style=color:#f07171>-                    .map(|info| Cow::Borrowed(info.descriptor.name()))
</span><span style=color:#f07171>-            })
</span><span style=color:#86b300>+            .and_then(|info| info.as_ref().map(|info| info.descriptor.name()))
</span><span>             .or_else(|| {
</span><span>                 let queued = self.queued.read().unwrap_or_else(PoisonError::into_inner);
</span><span>                 // first check components, then resources, then dynamic
</span><span style=color:#c594c5>@@ -2813,13 +2809,13 @@ </span><span style=color:#399ee6>pub fn enforce_no_required_components_recursion(
</span><span>                 "Recursive required components detected: {}\nhelp: {}",
</span><span>                 recursion_check_stack
</span><span>                     .iter()
</span><span style=color:#f07171>-                    .map(|id| format!("{}", ShortName(&components.get_name(*id).unwrap()))
</span><span style=color:#86b300>+                    .map(|id| format!("{}", components.get_name(*id).unwrap().shortname()))
</span><span>                     .collect::&LTVec<_>>()
</span><span>                     .join(" → "),
</span><span>                 if direct_recursion {
</span><span>                     format!(
</span><span>                         "Remove require({}).",
</span><span style=color:#f07171>-                        ShortName(&components.get_name(requiree).unwrap())
</span><span style=color:#86b300>+                        components.get_name(requiree).unwrap().shortname()
</span><span>                     )
</span><span>                 } else {
</span><span>                     "If this is intentional, consider merging the components.".into()
</span><span>diff --git a/crates/bevy_ecs/src/entity/clone_entities.rs b/crates/bevy_ecs/src/entity/clone_entities.rs
</span><span>index b124055d16ac6..02d2491b7a6c3 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/entity/clone_entities.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/entity/clone_entities.rs
</span><span style=color:#c594c5>@@ -1,6 +1,7 @@
</span><span> use alloc::{borrow::ToOwned, boxed::Box, collections::VecDeque, vec::Vec};
</span><span> use bevy_platform::collections::{HashMap, HashSet};
</span><span> use bevy_ptr::{Ptr, PtrMut};
</span><span style=color:#86b300>+use bevy_utils::prelude::DebugName;
</span><span> use bumpalo::Bump;
</span><span> use core::any::TypeId;
</span><span> 
</span><span style=color:#c594c5>@@ -171,7 +172,8 @@ </span><span style=color:#399ee6>impl<'a, 'b> ComponentCloneCtx<'a, 'b> {
</span><span>     /// - `ComponentId` of component being written does not match expected `ComponentId`.
</span><span>     pub fn write_target_component&LTC: Component>(&mut self, mut component: C) {
</span><span>         C::map_entities(&mut component, &mut self.mapper);
</span><span style=color:#f07171>-        let short_name = disqualified::ShortName::of::&LTC>();
</span><span style=color:#86b300>+        let debug_name = DebugName::type_name::&LTC>();
</span><span style=color:#86b300>+        let short_name = debug_name.shortname();
</span><span>         if self.target_component_written {
</span><span>             panic!("Trying to write component '{short_name}' multiple times")
</span><span>         }
</span><span>diff --git a/crates/bevy_ecs/src/error/command_handling.rs b/crates/bevy_ecs/src/error/command_handling.rs
</span><span>index bf2741d3766e5..c303b76d170b2 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/error/command_handling.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/error/command_handling.rs
</span><span style=color:#c594c5>@@ -1,4 +1,6 @@
</span><span style=color:#f07171>-use core::{any::type_name, fmt};
</span><span style=color:#86b300>+use core::fmt;
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+use bevy_utils::prelude::DebugName;
</span><span> 
</span><span> use crate::{
</span><span>     entity::Entity,
</span><span style=color:#c594c5>@@ -31,7 +33,7 @@ </span><span style=color:#399ee6>where
</span><span>             Err(err) => (error_handler)(
</span><span>                 err.into(),
</span><span>                 ErrorContext::Command {
</span><span style=color:#f07171>-                    name: type_name::&LTC>().into(),
</span><span style=color:#86b300>+                    name: DebugName::type_name::&LTC>(),
</span><span>                 },
</span><span>             ),
</span><span>         }
</span><span style=color:#c594c5>@@ -43,7 +45,7 @@ </span><span style=color:#399ee6>where
</span><span>             Err(err) => world.default_error_handler()(
</span><span>                 err.into(),
</span><span>                 ErrorContext::Command {
</span><span style=color:#f07171>-                    name: type_name::&LTC>().into(),
</span><span style=color:#86b300>+                    name: DebugName::type_name::&LTC>(),
</span><span>                 },
</span><span>             ),
</span><span>         }
</span><span>diff --git a/crates/bevy_ecs/src/error/handler.rs b/crates/bevy_ecs/src/error/handler.rs
</span><span>index c89408b2505c2..85a5a13297d22 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/error/handler.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/error/handler.rs
</span><span style=color:#c594c5>@@ -1,7 +1,7 @@
</span><span> use core::fmt::Display;
</span><span> 
</span><span> use crate::{component::Tick, error::BevyError, prelude::Resource};
</span><span style=color:#f07171>-use alloc::borrow::Cow;
</span><span style=color:#86b300>+use bevy_utils::prelude::DebugName;
</span><span> use derive_more::derive::{Deref, DerefMut};
</span><span> 
</span><span> /// Context for a [`BevyError`] to aid in debugging.
</span><span style=color:#c594c5>@@ -10,26 +10,26 @@ </span><span style=color:#399ee6>pub enum ErrorContext {
</span><span>     /// The error occurred in a system.
</span><span>     System {
</span><span>         /// The name of the system that failed.
</span><span style=color:#f07171>-        name: Cow<'static, str>,
</span><span style=color:#86b300>+        name: DebugName,
</span><span>         /// The last tick that the system was run.
</span><span>         last_run: Tick,
</span><span>     },
</span><span>     /// The error occurred in a run condition.
</span><span>     RunCondition {
</span><span>         /// The name of the run condition that failed.
</span><span style=color:#f07171>-        name: Cow<'static, str>,
</span><span style=color:#86b300>+        name: DebugName,
</span><span>         /// The last tick that the run condition was evaluated.
</span><span>         last_run: Tick,
</span><span>     },
</span><span>     /// The error occurred in a command.
</span><span>     Command {
</span><span>         /// The name of the command that failed.
</span><span style=color:#f07171>-        name: Cow<'static, str>,
</span><span style=color:#86b300>+        name: DebugName,
</span><span>     },
</span><span>     /// The error occurred in an observer.
</span><span>     Observer {
</span><span>         /// The name of the observer that failed.
</span><span style=color:#f07171>-        name: Cow<'static, str>,
</span><span style=color:#86b300>+        name: DebugName,
</span><span>         /// The last tick that the observer was run.
</span><span>         last_run: Tick,
</span><span>     },
</span><span style=color:#c594c5>@@ -54,12 +54,12 @@ </span><span style=color:#399ee6>impl Display for ErrorContext {
</span><span> 
</span><span> impl ErrorContext {
</span><span>     /// The name of the ECS construct that failed.
</span><span style=color:#f07171>-    pub fn name(&self) -> &str {
</span><span style=color:#86b300>+    pub fn name(&self) -> DebugName {
</span><span>         match self {
</span><span>             Self::System { name, .. }
</span><span>             | Self::Command { name, .. }
</span><span>             | Self::Observer { name, .. }
</span><span style=color:#f07171>-            | Self::RunCondition { name, .. } => name,
</span><span style=color:#86b300>+            | Self::RunCondition { name, .. } => name.clone(),
</span><span>         }
</span><span>     }
</span><span> 
</span><span>diff --git a/crates/bevy_ecs/src/hierarchy.rs b/crates/bevy_ecs/src/hierarchy.rs
</span><span>index 31c7b5e65aa87..d99e89b355e7e 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/hierarchy.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/hierarchy.rs
</span><span style=color:#c594c5>@@ -22,9 +22,9 @@ </span><span style=color:#399ee6>use alloc::{format, string::String, vec::Vec};
</span><span> use bevy_reflect::std_traits::ReflectDefault;
</span><span> #[cfg(all(feature = "serialize", feature = "bevy_reflect"))]
</span><span> use bevy_reflect::{ReflectDeserialize, ReflectSerialize};
</span><span style=color:#86b300>+use bevy_utils::prelude::DebugName;
</span><span> use core::ops::Deref;
</span><span> use core::slice;
</span><span style=color:#f07171>-use disqualified::ShortName;
</span><span> use log::warn;
</span><span> 
</span><span> /// Stores the parent entity of this child entity with this component.
</span><span style=color:#c594c5>@@ -461,11 +461,12 @@ </span><span style=color:#399ee6>pub fn validate_parent_has_component&LTC: Component>(
</span><span>     {
</span><span>         // TODO: print name here once Name lives in bevy_ecs
</span><span>         let name: Option&LTString> = None;
</span><span style=color:#86b300>+        let debug_name = DebugName::type_name::&LTC>();
</span><span>         warn!(
</span><span>             "warning[B0004]: {}{name} with</span></code></pre>    <div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19558.patch id=patch-info style=display:none></div>  <div class=bottom-spacer></div>