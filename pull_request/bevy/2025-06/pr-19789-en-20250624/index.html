<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19789 Split overloaded basis-universal feature into compressed_image_saver
        
    </title><meta content="#19789 Split overloaded basis-universal feature into compressed_image_saver" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19789-zh-cn-20250624>中文</a></div></div><div class=pr-content><h1 id=technical-analysis-of-pr-19789-split-overloaded-basis-universal-feature-into-compressed-image-saver>Technical Analysis of PR #19789: Split overloaded basis-universal feature into compressed_image_saver</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Split overloaded basis-universal feature into compressed_image_saver<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19789<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, D-Straightforward, S-Needs-Review<li><strong>Created</strong>: 2025-06-24T01:46:38Z<li><strong>Merged</strong>: 2025-06-24T03:32:09Z<li><strong>Merged By</strong>: superdump</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>basis-universal feature is overloaded, you might not want the compressed_image_saver but you may want basis-universal</ul><h2 id=solution>Solution</h2><ul><li>split out compressed_image_saver</ul><h2 id=testing>Testing</h2><ul><li>cargo clippy</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>The <code>basis-universal</code> feature in Bevy had become overloaded with two distinct responsibilities: enabling Basis Universal texture support and enabling compressed image saving functionality. This coupling created an unnecessary dependency where users who wanted Basis Universal texture support were forced to include the compressed image saver functionality as well. In practice, these are separate concerns - a project might need to read Basis Universal textures without requiring the asset processor to save compressed KTX2 UASTC textures. The current implementation didn’t allow this separation, limiting configuration flexibility.<h3 id=the-solution-approach>The Solution Approach</h3><p>The straightforward solution was to decouple these features by creating a new dedicated <code>compressed_image_saver</code> feature. This maintains the existing functionality while allowing users to choose whether to include the compressed image saving capability. The implementation required:<ol><li>Creating a new feature flag for compressed image saving<li>Updating all conditional compilation attributes to use the new feature where appropriate<li>Maintaining the dependency chain where compressed image saving requires Basis Universal support<li>Documenting the new feature for users</ol><p>The approach preserves backward compatibility while providing more granular control over dependencies. No alternatives were considered since the change is a clean separation of existing functionality.<h3 id=the-implementation>The Implementation</h3><p>The implementation involved coordinated changes across multiple files. First, the new <code>compressed_image_saver</code> feature was added to the root Cargo.toml:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span># File: Cargo.toml
</span><span># Before:
</span><span># (No separate compressed_image_saver feature)
</span><span>
</span><span># After:
</span><span style=color:#86b300>+ # Enables compressed KTX2 UASTC texture output on the asset processor
</span><span style=color:#86b300>+ compressed_image_saver = ["bevy_internal/compressed_image_saver"]
</span></code></pre><p>The bevy_image crate was updated to conditionally include the compressed image saver module only when the new feature is enabled:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span># File: crates/bevy_image/src/lib.rs
</span><span># Before:
</span><span>#[cfg(feature = "basis-universal")]
</span><span>mod compressed_image_saver;
</span><span>
</span><span>#[cfg(feature = "basis-universal")]
</span><span>pub use compressed_image_saver::*;
</span><span>
</span><span># After:
</span><span>#[cfg(feature = "compressed_image_saver")]
</span><span>mod compressed_image_saver;
</span><span>
</span><span>#[cfg(feature = "compressed_image_saver")]
</span><span>pub use compressed_image_saver::*;
</span></code></pre><p>Dependency relationships were established in the bevy_internal crate’s Cargo.toml:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span># File: crates/bevy_internal/Cargo.toml
</span><span># After:
</span><span style=color:#86b300>+ compressed_image_saver = [
</span><span style=color:#86b300>+   "bevy_image/compressed_image_saver",
</span><span style=color:#86b300>+   "bevy_render/compressed_image_saver",
</span><span style=color:#86b300>+ ]
</span></code></pre><p>The bevy_render crate was updated to only initialize the compressed image saver when the new feature is active:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span># File: crates/bevy_render/src/texture/mod.rs
</span><span># Before:
</span><span>#[cfg(feature = "basis-universal")]
</span><span>use bevy_image::CompressedImageSaver;
</span><span>
</span><span>if let Some(processor) = ... {
</span><span>    #[cfg(feature = "basis-universal")]
</span><span>    processor.register_asset_saver(CompressedImageSaver);
</span><span>}
</span><span>
</span><span># After:
</span><span>#[cfg(feature = "compressed_image_saver")]
</span><span>use bevy_image::CompressedImageSaver;
</span><span>
</span><span>if let Some(processor) = ... {
</span><span>    #[cfg(feature = "compressed_image_saver")]
</span><span>    processor.register_asset_saver(CompressedImageSaver);
</span><span>}
</span></code></pre><p>Finally, documentation was updated to reflect the new feature:<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span># File: docs/cargo_features.md
</span><span style=color:#86b300>+ |compressed_image_saver|Enables compressed KTX2 UASTC texture output on the asset processor|
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>This change demonstrates good feature flag management by:<ol><li>Keeping features focused on single responsibilities<li>Maintaining clear dependency relationships between features<li>Using conditional compilation effectively<li>Providing backward compatibility</ol><p>The compressed image saver remains dependent on Basis Universal through the crate dependency chain, but this dependency is now explicit rather than implicit through a shared feature flag.<h3 id=the-impact>The Impact</h3><p>These changes provide tangible benefits:<ol><li>Reduced binary size for users who don’t need compressed texture saving<li>Cleaner separation of concerns in the codebase<li>More flexible configuration options<li>Maintained functionality for existing users who enable both features</ol><p>The changes affect multiple crates but are localized to feature configuration and conditional compilation. The implementation is straightforward with minimal risk of regressions.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[basis-universal feature] -->|Provides| B[Basis Universal texture support]
</span><span>    C[compressed_image_saver feature] -->|Requires| A
</span><span>    C -->|Provides| D[Compressed texture saving]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><code>crates/bevy_internal/Cargo.toml</code> (+6/-0)<br> Added the new <code>compressed_image_saver</code> feature with dependencies on the image and render crate implementations.</ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#86b300>+ compressed_image_saver = [
</span><span style=color:#86b300>+   "bevy_image/compressed_image_saver",
</span><span style=color:#86b300>+   "bevy_render/compressed_image_saver",
</span><span style=color:#86b300>+ ]
</span></code></pre><ol start=2><li><code>crates/bevy_image/src/lib.rs</code> (+2/-2)<br> Changed feature gates for compressed image saver from <code>basis-universal</code> to the new <code>compressed_image_saver</code>.</ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>- #[cfg(feature = "basis-universal")]
</span><span style=color:#86b300>+ #[cfg(feature = "compressed_image_saver")]
</span></code></pre><ol start=3><li><code>crates/bevy_render/src/texture/mod.rs</code> (+2/-2)<br> Updated conditions for using the compressed image saver to match the new feature.</ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>- #[cfg(feature = "basis-universal")]
</span><span style=color:#86b300>+ #[cfg(feature = "compressed_image_saver")]
</span></code></pre><ol start=4><li><code>Cargo.toml</code> (+3/-0)<br> Added root-level feature definition for <code>compressed_image_saver</code>.</ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#86b300>+ # Enables compressed KTX2 UASTC texture output on the asset processor
</span><span style=color:#86b300>+ compressed_image_saver = ["bevy_internal/compressed_image_saver"]
</span></code></pre><ol start=5><li><code>crates/bevy_image/Cargo.toml</code> (+3/-0)<br> Added crate-level feature definition linking to basis-universal dependency.</ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#86b300>+ # Enables compressed KTX2 UASTC texture output on the asset processor
</span><span style=color:#86b300>+ compressed_image_saver = ["basis-universal"]
</span></code></pre><ol start=6><li><code>docs/cargo_features.md</code> (+1/-0)<br> Documented the new feature for users.</ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#86b300>+ |compressed_image_saver|Enables compressed KTX2 UASTC texture output on the asset processor|
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/cargo_features.md target=_blank>Bevy Engine Features Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>The Cargo Book: Features</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation in Rust</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/BinomialLLC/basis_universal target=_blank>Basis Universal Texture Format</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19789.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>