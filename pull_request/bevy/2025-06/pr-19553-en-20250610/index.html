<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19553 Implement SystemCondition for systems returning Result<bool, BevyError> and Result<(), BevyError>
        
    </title><meta content="#19553 Implement SystemCondition for systems returning Result<bool, BevyError> and Result<(), BevyError>" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19553-zh-cn-20250610>中文</a></div></div><div class=pr-content><h1 id=technical-report-implementing-systemcondition-for-result-types>Technical Report: Implementing <code>SystemCondition</code> for <code>Result</code> Types</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Implement SystemCondition for systems returning Result&LTbool, BevyError> and Result<(), BevyError><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19553<li><strong>Author</strong>: gwafotapa<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-ECS, S-Ready-For-Final-Review, D-Modest<li><strong>Created</strong>: 2025-06-09T10:35:22Z<li><strong>Merged</strong>: 2025-06-10T00:24:23Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #19403 As described in the issue, the objective is to support the use of systems returning <code>Result<(), BevyError></code> and <code>Result&LTbool, BevyError></code> as run conditions. In these cases, the run condition would hold on <code>Ok(())</code> and <code>Ok(true)</code> respectively.<h2 id=solution>Solution</h2><p><code>IntoSystem&LTIn, bool, M></code> cannot be implemented for systems returning <code>Result<(), BevyError></code> and <code>Result&LTbool, BevyError></code> as that would conflict with their trivial implementation of the trait. That led me to add a method to the sealed trait <code>SystemCondition</code> that does the conversion. In the original case of a system returning <code>bool</code>, the system is returned as is. With the new types, the system is combined with <code>map()</code> to obtain a <code>bool</code>.<p>By the way, I’m confused as to why <code>SystemCondition</code> has a generic <code>In</code> parameter as it is only ever used with <code>In = ()</code> as far as I can tell.<h2 id=testing>Testing</h2><p>I added a simple test for both type of system. That’s minimal but it felt enough. I could not picture the more complicated tests passing for a run condition returning <code>bool</code> and failing for the new types.<h2 id=doc>Doc</h2><p>I documenting the change on the page of the trait. I had trouble wording it right but I’m not sure how to improve it. The phrasing “the condition returns <code>true</code>” which reads naturally is now technically incorrect as the new types return a <code>Result</code>. However, the underlying condition system that the implementing system turns into does indeed return <code>bool</code>. But talking about the implementation details felt too much. Another possibility is to use another turn of phrase like “the condition holds” or “the condition checks out”. I’ve left “the condition returns <code>true</code>” in the documentation of <code>run_if</code> and the provided methods for now.<p>I’m perplexed about the examples. In the first one, why not implement the condition directly instead of having a system returning it? Is it from a time of Bevy where you had to implement your conditions that way? In that case maybe that should be updated. And in the second example I’m missing the point entirely. As I stated above, I’ve only seen conditions used in contexts where they have no input parameter. Here we create a condition with an input parameter (cannot be used by <code>run_if</code>) and we are using it with <code>pipe()</code> which actually doesn’t need our system to implement <code>SystemCondition</code>. Both examples are also calling <code>IntoSystem::into_system</code> which should not be encouraged. What am I missing?<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Bevy’s ECS system conditions (<code>run_if</code>) only supported systems returning <code>bool</code>, which prevented developers from using error-handling patterns with <code>Result</code> types in their condition checks. This limitation became apparent in issue #19403, where users needed to express conditions that might fail and return <code>BevyError</code>. The existing implementation couldn’t accommodate systems returning <code>Result<(), BevyError></code> or <code>Result&LTbool, BevyError></code> because:<ol><li>Implementing <code>IntoSystem&LTIn, bool, M></code> for these <code>Result</code> types would conflict with existing trait implementations<li>The <code>SystemCondition</code> trait was tightly coupled to <code>bool</code> output<li>There was no mechanism to convert <code>Result</code> types to boolean conditions</ol><p>This forced developers to write error-prone workarounds instead of using Bevy’s idiomatic error handling patterns in condition systems.<h3 id=the-solution-approach>The Solution Approach</h3><p>The core solution extends the <code>SystemCondition</code> trait to support multiple output types while maintaining backward compatibility. Instead of modifying the <code>IntoSystem</code> implementation (which would cause conflicts), we add a new method to the sealed <code>SystemCondition</code> trait that converts different output types to a unified <code>bool</code> condition:<ol><li>For existing <code>bool</code> systems: Keep the original system unchanged<li>For <code>Result<(), BevyError></code>: Map to <code>true</code> on <code>Ok(())</code>, <code>false</code> on <code>Err</code><li>For <code>Result&LTbool, BevyError></code>: Map to <code>true</code> on <code>Ok(true)</code>, <code>false</code> otherwise</ol><p>The implementation uses Rust’s trait system to provide specialized handling for each output type while preserving the existing API contracts. The <code>SystemCondition</code> trait was generalized with an <code>Out</code> type parameter to support these different return types.<h3 id=the-implementation>The Implementation</h3><p>The key change introduces a private <code>into_condition_system</code> method in the sealed <code>SystemCondition</code> trait that handles the conversion logic:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Inside sealed mod
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>SystemCondition</span><span>&LTMarker, In: SystemInput, Out>:
</span><span>    IntoSystem&LTIn, Out, Marker, System = Self::ReadOnlySystem>
</span><span>{
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>ReadOnlySystem</span><span style=color:#61676ccc>: </span><span>ReadOnlySystem&LTIn = In, Out = Out></span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>into_condition_system</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> impl ReadOnlySystem&LTIn = In, Out = </span><span style=color:#fa6e32>bool</span><span>></span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>Three implementations handle the different output types:<ol><li><strong>Existing bool systems</strong> pass through unchanged:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl</span><span>&LTMarker, In</span><span style=color:#61676ccc>:</span><span> SystemInput, F> SystemCondition&LTMarker, In, </span><span style=color:#fa6e32>bool</span><span>> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>F
</span><span style=color:#fa6e32>where
</span><span>    F</span><span style=color:#61676ccc>: </span><span>IntoSystem&LTIn, </span><span style=color:#fa6e32>bool</span><span>, Marker>,
</span><span>    </span><span style=color:#fa6e32>F</span><span style=color:#ed9366>::</span><span>System</span><span style=color:#61676ccc>:</span><span> ReadOnlySystem,
</span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>into_condition_system</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> impl ReadOnlySystem&LTIn = In, Out = </span><span style=color:#fa6e32>bool</span><span>> {
</span><span>        IntoSystem</span><span style=color:#ed9366>::</span><span>into_system(</span><span style=color:#55b4d4;font-style:italic>self</span><span>)
</span><span>    }
</span><span>}
</span></code></pre><ol start=2><li><strong>Result<(), BevyError></strong> maps to <code>is_ok()</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl</span><span>&LTMarker, In</span><span style=color:#61676ccc>:</span><span> SystemInput, F> SystemCondition&LTMarker, In, </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), BevyError>> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>F
</span><span style=color:#fa6e32>where
</span><span>    F</span><span style=color:#61676ccc>: </span><span>IntoSystem&LTIn, </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), BevyError>, Marker>,
</span><span>    </span><span style=color:#fa6e32>F</span><span style=color:#ed9366>::</span><span>System</span><span style=color:#61676ccc>:</span><span> ReadOnlySystem,
</span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>into_condition_system</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> impl ReadOnlySystem&LTIn = In, Out = </span><span style=color:#fa6e32>bool</span><span>> {
</span><span>        IntoSystem</span><span style=color:#ed9366>::</span><span>into_system(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>result</span><span>| result</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ok</span><span>()))
</span><span>    }
</span><span>}
</span></code></pre><ol start=3><li><strong>Result&LTbool, BevyError></strong> checks for <code>Ok(true)</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl</span><span>&LTMarker, In</span><span style=color:#61676ccc>:</span><span> SystemInput, F> SystemCondition&LTMarker, In, </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>bool</span><span>, BevyError>> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>F
</span><span style=color:#fa6e32>where
</span><span>    F</span><span style=color:#61676ccc>: </span><span>IntoSystem&LTIn, </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#fa6e32>bool</span><span>, BevyError>, Marker>,
</span><span>    </span><span style=color:#fa6e32>F</span><span style=color:#ed9366>::</span><span>System</span><span style=color:#61676ccc>:</span><span> ReadOnlySystem,
</span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>into_condition_system</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> impl ReadOnlySystem&LTIn = In, Out = </span><span style=color:#fa6e32>bool</span><span>> {
</span><span>        IntoSystem</span><span style=color:#ed9366>::</span><span>into_system(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>result</span><span>| </span><span style=color:#f07171>matches!</span><span>(result</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(</span><span style=color:#ff8f40>true</span><span>))))
</span><span>    }
</span><span>}
</span></code></pre><p>The public API surface was updated to use this new method instead of directly calling <code>into_system</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> condition_system </span><span style=color:#ed9366>= </span><span>IntoSystem</span><span style=color:#ed9366>::</span><span>into_system(condition)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> condition_system </span><span style=color:#ed9366>=</span><span> condition</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_condition_system</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=testing-and-documentation>Testing and Documentation</h3><p>Comprehensive tests verify all three condition types work correctly with Bevy’s scheduling system:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>system_with_condition_result_unit</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Tests Result<(), BevyError> condition
</span><span>    schedule</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(
</span><span>        </span><span style=color:#f07171>make_function_system</span><span>(</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(|| </span><span style=color:#55b4d4;font-style:italic>Err</span><span style=color:#61676ccc>::</span><span><(), BevyError>(core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Error</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()))</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Verifies system doesn't run on error
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>system_with_condition_result_bool</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Tests Result&LTbool, BevyError> condition
</span><span>    schedule</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>((
</span><span>        </span><span style=color:#f07171>make_function_system</span><span>(</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(|| </span><span style=color:#55b4d4;font-style:italic>Err</span><span style=color:#61676ccc>::</span><span><</span><span style=color:#fa6e32>bool</span><span>, BevyError>(core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Error</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#f07171>make_function_system</span><span>(</span><span style=color:#ff8f40>1</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>run_if</span><span>(|| </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(</span><span style=color:#ff8f40>false</span><span>))</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Verifies only system with Ok(true) runs
</span><span>}
</span></code></pre><p>Documentation was updated to explain the new behavior while maintaining consistency with existing terminology. The trait documentation now explicitly lists all supported output types and their mapping to boolean conditions.<h3 id=technical-insights>Technical Insights</h3><p>The implementation demonstrates several important patterns in Bevy’s ECS:<ol><li><strong>Trait specialization</strong>: Using multiple trait implementations for different types while maintaining a unified interface<li><strong>Sealed trait pattern</strong>: Preventing external implementations while extending functionality<li><strong>System composition</strong>: Leveraging <code>map()</code> to transform system outputs without runtime overhead<li><strong>Backward compatibility</strong>: Maintaining existing behavior for <code>bool</code> systems while adding new capabilities</ol><p>A notable observation is that the <code>In</code> type parameter in <code>SystemCondition</code> appears unused in practice, as conditions are always invoked with <code>()</code> input. This could be simplified in future refactors.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[SystemCondition Trait] --> B[bool Systems]
</span><span>    A --> C[Result<(), BevyError> Systems]
</span><span>    A --> D[Result&LTbool, BevyError> Systems]
</span><span>    B --> E[Direct Use]
</span><span>    C --> F[Map to is_ok()]
</span><span>    D --> G[Map to Ok(true)]
</span><span>    E --> H[bool Condition]
</span><span>    F --> H
</span><span>    G --> H
</span><span>    H --> I[Schedule Execution]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-ecs-src-schedule-condition-rs-78-13>1. <code>crates/bevy_ecs/src/schedule/condition.rs</code> (+78/-13)</h3><p><strong>Purpose</strong>: Implement core logic for new condition types<br> <strong>Key Changes</strong>:<ul><li>Generalized <code>SystemCondition</code> trait to support multiple output types<li>Added implementations for <code>Result</code>-returning systems<li>Updated documentation with examples for new condition types</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>SystemCondition</span><span>&LTMarker, In: SystemInput = ()>:
</span><span>    sealed::SystemCondition&LTMarker, In>
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>pub trait SystemCondition&LTMarker, In: SystemInput = (), Out = bool>:
</span><span>    sealed::SystemCondition&LTMarker, In, Out>
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added implementations:
</span><span style=color:#fa6e32>impl</span><span>&LTMarker, In</span><span style=color:#61676ccc>:</span><span> SystemInput, F> SystemCondition&LTMarker, In, </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), BevyError>> </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>F
</span><span style=color:#fa6e32>where
</span><span>    F</span><span style=color:#61676ccc>: </span><span>IntoSystem&LTIn, </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), BevyError>, Marker>,
</span><span>    </span><span style=color:#fa6e32>F</span><span style=color:#ed9366>::</span><span>System</span><span style=color:#61676ccc>:</span><span> ReadOnlySystem,
</span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>into_condition_system</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> impl ReadOnlySystem&LTIn = In, Out = </span><span style=color:#fa6e32>bool</span><span>> {
</span><span>        IntoSystem</span><span style=color:#ed9366>::</span><span>into_system(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>result</span><span>| result</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_ok</span><span>()))
</span><span>    }
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-ecs-src-schedule-mod-rs-46-3>2. <code>crates/bevy_ecs/src/schedule/mod.rs</code> (+46/-3)</h3><p><strong>Purpose</strong>: Add comprehensive tests for new condition types<br> <strong>Key Changes</strong>:<ul><li>Added test cases for <code>Result<(), BevyError></code> conditions<li>Added test cases for <code>Result&LTbool, BevyError></code> conditions<li>Verified correct scheduling behavior for all condition types</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added tests:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>system_with_condition_result_unit</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Tests Result<(), BevyError> behavior
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>system_with_condition_result_bool</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Tests Result&LTbool, BevyError> behavior
</span><span>}
</span></code></pre><h3 id=3-crates-bevy-ecs-src-schedule-config-rs-4-4>3. <code>crates/bevy_ecs/src/schedule/config.rs</code> (+4/-4)</h3><p><strong>Purpose</strong>: Update condition handling in scheduler configuration<br> <strong>Key Changes</strong>:<ul><li>Modified <code>new_condition</code> to use <code>into_condition_system</code><li>Updated trait bounds to support new output types<li>Maintained identical function signatures for public API</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>new_condition</span><span>&LTM>(</span><span style=color:#ff8f40>condition</span><span style=color:#61676ccc>:</span><span> impl SystemCondition&LTM>) </span><span style=color:#61676ccc>-></span><span> BoxedCondition {
</span><span>    </span><span style=color:#fa6e32>let</span><span> condition_system </span><span style=color:#ed9366>= </span><span>IntoSystem</span><span style=color:#ed9366>::</span><span>into_system(condition)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>new_condition</span><span>&LTM, Out>(</span><span style=color:#ff8f40>condition</span><span style=color:#61676ccc>:</span><span> impl SystemCondition&LTM, (), Out>) </span><span style=color:#61676ccc>-></span><span> BoxedCondition {
</span><span>    </span><span style=color:#fa6e32>let</span><span> condition_system </span><span style=color:#ed9366>=</span><span> condition</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_condition_system</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/schedule/condition/index.html target=_blank>Bevy ECS System Conditions Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch09-00-error-handling.html target=_blank>Rust Error Handling Patterns</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/next/programming/systems/composition/ target=_blank>Bevy System Pipelines and Composition</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/rust-lang/rfcs/blob/master/text/1210-impl-specialization.md target=_blank>Trait Specialization in Rust</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19553.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>