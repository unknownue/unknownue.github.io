<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19604 don't deny warnings on wasm-atomics CI job
        
    </title><meta content="#19604 don't deny warnings on wasm-atomics CI job" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-13</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19604-zh-cn-20250613>中文</a></div></div><div class=pr-content><h1 id=analysis-of-pr-19604-don-t-deny-warnings-on-wasm-atomics-ci-job>Analysis of PR #19604: don’t deny warnings on wasm-atomics CI job</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: don’t deny warnings on wasm-atomics CI job<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19604<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Build-System, P-High, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-06-12T21:51:54Z<li><strong>Merged</strong>: 2025-06-12T23:51:48Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>CI job checking for wasm atomics fails because of an unrelated lint on nightly rust<li>Fixes #19573</ul><h2 id=solution>Solution</h2><ul><li>Don’t deny warning, that’s not what this job is checking anyway</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>The Bevy CI pipeline includes a specialized job to validate WebAssembly atomics support. This job uses Rust’s nightly compiler with specific flags to check compilation against the wasm32-unknown-unknown target. The configuration included <code>-D warnings</code> in RUSTFLAGS, which treats all compiler warnings as errors. This strict setting caused the job to fail when new warnings appeared in the nightly Rust compiler, even though these warnings were unrelated to the actual purpose of the job (verifying wasm atomics support).<p>This problem surfaced in issue #19573, where the CI job started failing due to a new warning introduced in a nightly Rust build. The core issue was that the job’s configuration was overly strict for its intended purpose. Failing on unrelated warnings created maintenance overhead and false positives in the CI pipeline.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution focused on aligning the job’s configuration with its actual purpose. Since the job’s primary function is to validate wasm atomics compatibility - not to enforce a warning-free codebase - the <code>-D warnings</code> flag was removed from the RUSTFLAGS environment variable. This approach maintains the essential atomics validation while eliminating false failures from unrelated lints.<p>This decision considered several factors:<ol><li>The wasm-atomics job runs on nightly Rust, which frequently introduces new lints<li>Fixing new warnings would create ongoing maintenance work unrelated to wasm support<li>The main CI pipeline already enforces warning-free builds on stable Rust</ol><h3 id=the-implementation>The Implementation</h3><p>The implementation involved a single-line change in the CI configuration file. The modification removed <code>-D warnings</code> from the RUSTFLAGS environment variable while preserving the critical atomics-related flags.<h4 id=before>Before:</h4><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#399ee6>env</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>RUSTFLAGS</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"-C target-feature=+atomics,+bulk-memory -D warnings"
</span></code></pre><h4 id=after>After:</h4><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#399ee6>env</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>RUSTFLAGS</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"-C target-feature=+atomics,+bulk-memory"
</span></code></pre><p>This change maintains the essential <code>-C target-feature=+atomics,+bulk-memory</code> flags that enable the wasm atomics verification while removing the unrelated lint enforcement.<h3 id=technical-insights>Technical Insights</h3><p>The key technical consideration was understanding the purpose of each flag:<ul><li><code>-C target-feature=+atomics,+bulk-memory</code>: Essential for enabling WebAssembly thread support and shared memory features<li><code>-D warnings</code>: Global flag that treats warnings as errors, useful for main builds but counterproductive for specialized jobs</ul><p>By removing only the warning-denial flag, the solution:<ul><li>Preserves the critical atomics validation functionality<li>Reduces CI maintenance burden<li>Avoids false positives from nightly compiler changes<li>Maintains the existing workflow structure</ul><h3 id=the-impact>The Impact</h3><p>This change immediately stabilized the wasm-atomics CI job by preventing failures from unrelated warnings. The impact includes:<ul><li>Reduced false positives in CI failures<li>Lower maintenance overhead for Bevy maintainers<li>More reliable signal for actual wasm atomics issues<li>Preservation of the important wasm validation functionality</ul><p>The solution demonstrates good CI pipeline design by ensuring each job focuses on a single responsibility and avoids unnecessary constraints that create maintenance overhead.<h2 id=key-files-changed>Key Files Changed</h2><h3 id=github-workflows-ci-yml>.github/workflows/ci.yml</h3><p><strong>What changed</strong>: Removed <code>-D warnings</code> from RUSTFLAGS in wasm-atomics job<br> <strong>Why changed</strong>: To prevent job failures from unrelated nightly compiler warnings<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>      - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Check wasm
</span><span>        </span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#86b300>cargo check --target wasm32-unknown-unknown -Z build-std=std,panic_abort
</span><span>        </span><span style=color:#399ee6>env</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>RUSTFLAGS</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"-C target-feature=+atomics,+bulk-memory -D warnings"
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>      - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Check wasm
</span><span>        </span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#86b300>cargo check --target wasm32-unknown-unknown -Z build-std=std,panic_abort
</span><span>        </span><span style=color:#399ee6>env</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>RUSTFLAGS</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"-C target-feature=+atomics,+bulk-memory"
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustc/command-line-arguments.html target=_blank>Rust Compiler Flags Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/WebAssembly/threads target=_blank>WebAssembly Atomics Proposal</a><li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions target=_blank>GitHub Actions Workflow Syntax</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/.github/CONTRIBUTING.md#ci target=_blank>Bevy CI Contribution Guide</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19604.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>