<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19558 ECS: put strings only used for debug behind a feature
        
    </title><meta content="#19558 ECS: put strings only used for debug behind a feature" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-18</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19558-zh-cn-20250618>中文</a></div></div><div class=pr-content><h2 id=technical-report-pr-19558-ecs-debug-string-optimization>Technical Report: PR #19558 - ECS Debug String Optimization</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: ECS: put strings only used for debug behind a feature<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19558<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Performance, S-Ready-For-Final-Review, X-Contentious<li><strong>Created</strong>: 2025-06-09T17:02:21Z<li><strong>Merged</strong>: 2025-06-18T20:34:16Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description>Description</h3><p><strong>Objective</strong><ul><li>Many strings in bevy_ecs are created but only used for debug: system name, component name, …<li>Those strings make a significant part of the final binary and are no use in a released game</ul><p><strong>Solution</strong><ul><li>Use <a rel="noopener nofollow noreferrer" href=https://linux.die.net/man/1/strings target=_blank><code>strings</code></a> to find … strings in a binary<li>Try to find where they come from<li>Many are made from <code>type_name::&LTT>()</code> and only used in error / debug messages<li>Add a new structure <code>DebugName</code> that holds no value if <code>debug</code> feature is disabled<li>Replace <code>core::any::type_name::&LTT>()</code> by <code>DebugName::type_name::&LTT>()</code></ul><p><strong>Testing</strong> Measurements were taken without the new feature being enabled by default, to help with commands<p><strong>File Size</strong> I tried building the <code>breakout</code> example with <code>cargo run --release --example breakout</code><table><thead><tr><th><code>debug</code> enabled<th><code>debug</code> disabled<tbody><tr><td>81621776 B<td>77735728B<tr><td>77.84MB<td>74.13MB</table><p><strong>Compilation time</strong> <code>hyperfine --min-runs 15  --prepare "cargo clean && sleep 5" 'RUSTC_WRAPPER="" cargo build --release --example breakout' 'RUSTC_WRAPPER="" cargo build --release --example breakout --features debug'</code><pre style=color:#61676c;background-color:#fafafa><code><span>breakout' 'RUSTC_WRAPPER="" cargo build --release --example breakout --features debug'
</span><span>Benchmark 1: RUSTC_WRAPPER="" cargo build --release --example breakout
</span><span>  Time (mean ± σ):     84.856 s ±  3.565 s    [User: 1093.817 s, System: 32.547 s]
</span><span>  Range (min … max):   78.038 s … 89.214 s    15 runs
</span><span>
</span><span>Benchmark 2: RUSTC_WRAPPER="" cargo build --release --example breakout --features debug
</span><span>  Time (mean ± σ):     92.303 s ±  2.466 s    [User: 1193.443 s, System: 33.803 s]
</span><span>  Range (min … max):   90.619 s … 99.684 s    15 runs
</span><span>
</span><span>Summary
</span><span>  RUSTC_WRAPPER="" cargo build --release --example breakout ran
</span><span>    1.09 ± 0.05 times faster than RUSTC_WRAPPER="" cargo build --release --example breakout --features debug
</span></code></pre><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><h4 id=the-problem-and-context>The Problem and Context</h4><p>Bevy’s ECS system generates numerous strings for debugging purposes, including system names, component names, and type information. These strings are primarily used in error messages, logging, and development diagnostics. However, in release builds for shipped games, these strings serve no purpose yet contribute significantly to binary size. Analysis using the <code>strings</code> utility revealed that type name strings (<code>core::any::type_name::&LTT>()</code>) accounted for a substantial portion of the binary.<p>The key constraints were:<ol><li>Maintaining debuggability during development<li>Minimizing binary size for release builds<li>Avoiding runtime performance penalties<li>Preserving existing debugging capabilities when needed</ol><h4 id=the-solution-approach>The Solution Approach</h4><p>The solution introduces a new <code>DebugName</code> abstraction that conditionally includes string data based on the <code>debug</code> feature flag. This approach provides:<ul><li>Zero-cost abstraction when <code>debug</code> is disabled<li>Full debug information when enabled<li>Minimal changes to existing codebase</ul><p>Key engineering decisions:<ol><li>Created a feature-gated <code>DebugName</code> struct to wrap debug strings<li>Replaced direct <code>type_name::&LTT>()</code> calls with <code>DebugName::type_name::&LTT>()</code><li>Implemented display formatting that shows placeholder text when <code>debug</code> is disabled<li>Maintained short names for error messages using <code>disqualified::ShortName</code></ol><p>The <code>DebugName</code> struct handles all conditional behavior internally, ensuring call sites don’t need feature-gating logic. This design preserves the existing developer experience while optimizing release builds.<h4 id=the-implementation>The Implementation</h4><p>The core implementation centers around the <code>DebugName</code> struct in <code>bevy_utils</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_utils/src/debug_info.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>    name</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)</span><span style=color:#61676ccc>, </span><span style=color:#f29718>expect</span><span>(unused_variables))]
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>borrowed</span><span>(</span><span style=color:#ff8f40>value</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        DebugName {
</span><span>            </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>            name</span><span style=color:#61676ccc>: </span><span>Cow</span><span style=color:#ed9366>::</span><span>Borrowed(value)</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>type_name</span><span>&LTT>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        DebugName {
</span><span>            </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>            name</span><span style=color:#61676ccc>: </span><span>Cow</span><span style=color:#ed9366>::</span><span>Borrowed(type_name</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>shortname</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ShortName {
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>        </span><span style=color:#fa6e32>return</span><span> ShortName(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>name</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>())</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>))]
</span><span>        </span><span style=color:#fa6e32>return</span><span> ShortName(</span><span style=color:#ff8f40>FEATURE_DISABLED</span><span>)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>This struct is then integrated throughout the ECS codebase. For example, in component descriptors:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_ecs/src/component.rs
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ComponentDescriptor </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>new</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self </span><span>{
</span><span>            name</span><span style=color:#61676ccc>: </span><span>DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>            storage_type</span><span style=color:#61676ccc>: </span><span>T</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>STORAGE_TYPE</span><span style=color:#61676ccc>,
</span><span>            is_send_and_sync</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>,
</span><span>            type_id</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#61676ccc>,
</span><span>            layout</span><span style=color:#61676ccc>: </span><span>Layout</span><span style=color:#ed9366>::</span><span>new</span><span style=color:#ed9366>::</span><span>&LTT>()</span><span style=color:#61676ccc>,
</span><span>            drop</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>if </span><span>needs_drop</span><span style=color:#ed9366>::</span><span>&LTT>() {
</span><span>                </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(ComponentDescriptorDrop</span><span style=color:#ed9366>::</span><span>drop_ptr</span><span style=color:#ed9366>::</span><span>&LTT>)
</span><span>            } </span><span style=color:#fa6e32>else </span><span>{
</span><span>                </span><span style=color:#55b4d4;font-style:italic>None
</span><span>            }</span><span style=color:#61676ccc>,
</span><span>            clone_behavior</span><span style=color:#61676ccc>: </span><span>T</span><span style=color:#ed9366>::</span><span>clone_behavior()</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>Error handling was updated to use <code>shortname()</code> for consistent output:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_ecs/src/component.rs
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>enforce_no_required_components_recursion</span><span>(
</span><span>    </span><span style=color:#ff8f40>recursion_check_stack</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[ComponentId],
</span><span>    </span><span style=color:#ff8f40>requiree</span><span style=color:#61676ccc>:</span><span> ComponentId,
</span><span>    </span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Components,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#f07171>panic!</span><span>(
</span><span>        </span><span style=color:#86b300>"Recursive required components detected: {}</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>help: {}"</span><span style=color:#61676ccc>,
</span><span>        recursion_check_stack
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>id</span><span>| </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_name</span><span>(</span><span style=color:#ed9366>*</span><span>id)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>shortname</span><span>()))
</span><span>            </span><span style=color:#ed9366>.</span><span>collect</span><span style=color:#ed9366>::</span><span><</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#ed9366>_</span><span>>>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>join</span><span>(</span><span style=color:#86b300>" → "</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#fa6e32>if</span><span> direct_recursion {
</span><span>            </span><span style=color:#f07171>format!</span><span>(
</span><span>                </span><span style=color:#86b300>"Remove require(</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>)."</span><span style=color:#61676ccc>,
</span><span>                components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_name</span><span>(requiree)</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>shortname</span><span>()
</span><span>            )
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=color:#86b300>"If this is intentional, consider merging the components."</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()
</span><span>        }
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h4 id=technical-insights>Technical Insights</h4><p>The implementation demonstrates several key techniques:<ol><li><strong>Conditional Compilation</strong>: The <code>DebugName</code> struct uses <code>#[cfg(feature = "debug")]</code> to include string data only when needed<li><strong>Zero-Cost Abstraction</strong>: When <code>debug</code> is disabled, <code>DebugName</code> contains no data and compiles to minimal instructions<li><strong>Type Erasure</strong>: <code>DebugName::type_name&LTT>()</code> captures type names at compile time but erases them when not needed<li><strong>API Preservation</strong>: Existing methods like <code>ComponentInfo::name()</code> maintain their signature but return <code>DebugName</code> instead of <code>&str</code></ol><p>The solution balances debug utility with release efficiency:<ul><li>Debug builds retain full type information for diagnostics<li>Release builds eliminate string bloat (3.71MB reduction in breakout example)<li>Compilation time increases slightly (9%) when debug strings are enabled</ul><h4 id=the-impact>The Impact</h4><p>These changes provide significant benefits:<ol><li><strong>Binary Size Reduction</strong>: 4.8% smaller binaries in tested examples<li><strong>Memory Efficiency</strong>: Reduced .rodata segment size<li><strong>Conditional Debugging</strong>: Developers can enable detailed diagnostics when needed<li><strong>Maintainability</strong>: Centralized debug string handling simplifies future optimizations</ol><p>The changes affect multiple ECS subsystems but maintain backward compatibility through careful API design. The feature is opt-in through the <code>debug</code> cargo feature, allowing projects to choose based on their needs.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[DebugName] --> B[Component System]
</span><span>    A --> C[Error Handling]
</span><span>    A --> D[System Names]
</span><span>    B --> E[ComponentDescriptor]
</span><span>    B --> F[ComponentInfo]
</span><span>    C --> G[Recursive Component Errors]
</span><span>    C --> H[Query Conflicts]
</span><span>    D --> I[System Metadata]
</span><span>    D --> J[Observer Systems]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><ol><li><code>crates/bevy_utils/src/debug_info.rs</code> (+102/-0) <ul><li>New module implementing the <code>DebugName</code> abstraction<li>Handles conditional storage of debug strings<li>Provides display formatting and short names</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New file implementation
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>    name</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>type_name</span><span>&LTT>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        DebugName {
</span><span>            </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>            name</span><span style=color:#61676ccc>: </span><span>Cow</span><span style=color:#ed9366>::</span><span>Borrowed(type_name</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>shortname</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> ShortName {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Returns actual name or placeholder
</span><span>    }
</span><span>}
</span></code></pre><ol start=2><li><code>crates/bevy_ecs/src/system/system_param.rs</code> (+24/-23) <ul><li>Updated system parameter validation to use <code>DebugName</code><li>Improved error messages with short names</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>panic!</span><span>(
</span><span>    </span><span style=color:#86b300>"error[B0001]: Query<{}, {}> in system {system_name} accesses..."</span><span style=color:#61676ccc>,
</span><span>    core</span><span style=color:#ed9366>::</span><span>any</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTD>()</span><span style=color:#61676ccc>,
</span><span>    core</span><span style=color:#ed9366>::</span><span>any</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTF>()
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>panic!</span><span>(
</span><span>    </span><span style=color:#86b300>"error[B0001]: Query<{}, {}> in system {system_name} accesses..."</span><span style=color:#61676ccc>,
</span><span>    DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTD>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>shortname</span><span>()</span><span style=color:#61676ccc>,
</span><span>    DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTF>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>shortname</span><span>()
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><code>crates/bevy_ecs/src/component.rs</code> (+14/-18) <ul><li>Migrated component descriptors to use <code>DebugName</code><li>Updated recursive component checks</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ComponentDescriptor </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>name</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str </span><span>{ </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>name }
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>name</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> DebugName { </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>name</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>() }
</span><span>}
</span></code></pre><ol start=4><li><code>crates/bevy_ecs/src/world/mod.rs</code> (+17/-15) <ul><li>Updated resource error messages<li>Improved entity insertion errors</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>panic!</span><span>(</span><span style=color:#86b300>"Resource {} does not exist"</span><span style=color:#61676ccc>, </span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>panic!</span><span>(</span><span style=color:#86b300>"Resource {} does not exist"</span><span style=color:#61676ccc>, </span><span>DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#61676ccc>;
</span></code></pre><ol start=5><li><code>crates/bevy_ecs/src/system/system_name.rs</code> (+10/-19) <ul><li>Updated <code>SystemName</code> to use <code>DebugName</code><li>Preserved system naming API</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SystemName</span><span>(Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>SystemName</span><span>(DebugName)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ecs/ target=_blank>Bevy ECS Architecture</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation in Rust</a><li><a rel="noopener nofollow noreferrer" href=https://llogiq.github.io/2017/06/01/tinylogs.html target=_blank>Type Name Optimization Techniques</a><li><a rel="noopener nofollow noreferrer" href=https://www.worthe-it.co.za/blog/2020-10-31-feature-flags-in-rust.html target=_blank>Rust Feature Flags Best Practices</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/johnthagen/min-sized-rust target=_blank>Binary Size Optimization Patterns</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19558.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>