<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19643 rename GlobalTransform::compute_matrix to to_matrix
        
    </title><meta content="#19643 rename GlobalTransform::compute_matrix to to_matrix" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19643-zh-cn-20250617>中文</a></div></div><div class=pr-content><h1 id=pr-analysis-rename-globaltransform-compute-matrix-to-to-matrix>PR Analysis: rename GlobalTransform::compute_matrix to to_matrix</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: rename GlobalTransform::compute_matrix to to_matrix<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19643<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: S-Ready-For-Final-Review, A-Math, M-Needs-Migration-Guide, D-Straightforward<li><strong>Created</strong>: 2025-06-14T19:23:24Z<li><strong>Merged</strong>: 2025-06-17T18:59:07Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>compute_matrix doesn’t compute anything, it just puts an Affine3A into a Mat4. the name is inaccurate</ul><h2 id=solution>Solution</h2><ul><li>rename it to conform with to_isometry (which, ironically, does compute a decomposition which is rather expensive)</ul><h2 id=testing>Testing</h2><ul><li>Its a rename. If it compiles, its good to go</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The core issue addressed in this PR was a misleading method name in Bevy’s transform API. The <code>GlobalTransform::compute_matrix</code> method implied computational work was being performed when in reality it was simply converting the existing affine transform representation into a matrix format. This naming discrepancy could lead to incorrect assumptions about performance characteristics.<p>The solution implemented was a straightforward rename of <code>compute_matrix</code> to <code>to_matrix</code> throughout the codebase. This change aligns with common Rust conversion naming conventions (like <code>to_string</code> or <code>to_vec</code>) and accurately reflects the method’s purpose as a simple type conversion rather than a computational operation. The new name also creates a clearer contrast with <code>to_isometry</code>, which does perform actual computation.<p>The implementation required updates across 13 files in the codebase where <code>compute_matrix</code> was called. Each change followed the same pattern:<ol><li>Locate all references to <code>compute_matrix</code><li>Replace with <code>to_matrix</code><li>Verify compilation and functionality</ol><p>An important aspect of this change was ensuring consistency across Bevy’s various subsystems that use transforms, including rendering, picking, lighting, and camera systems. The PR also added a migration guide to help users update their code.<p>The key technical insight here is that naming matters for API clarity. While <code>compute_matrix</code> suggested an expensive operation, the actual work is minimal - it’s essentially a zero-cost abstraction over the underlying affine transform data. The new name <code>to_matrix</code> more accurately communicates this behavior.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: misleading name implies computation
</span><span style=color:#fa6e32>let</span><span> matrix </span><span style=color:#ed9366>=</span><span> transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>compute_matrix</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: clear conversion semantics
</span><span style=color:#fa6e32>let</span><span> matrix </span><span style=color:#ed9366>=</span><span> transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_matrix</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><p>This change improves API consistency and reduces cognitive load for developers working with Bevy’s transform system. The migration is straightforward but widespread, affecting multiple engine subsystems that rely on transform data.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[GlobalTransform] --> B[to_matrix]
</span><span>    B --> C[Rendering]
</span><span>    B --> D[Picking]
</span><span>    B --> E[Lighting]
</span><span>    B --> F[Camera]
</span><span>    B --> G[Atmosphere]
</span><span>    B --> H[Volumetric Fog]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-transform-src-components-global-transform-rs>crates/bevy_transform/src/components/global_transform.rs</h3><p><strong>Change</strong>: Renamed method in GlobalTransform implementation<br> <strong>Reason</strong>: Core API change to fix misleading method name<br> <strong>Code</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>compute_matrix</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Mat4 {
</span><span>    Mat4</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>to_matrix</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Mat4 {
</span><span>    Mat4</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)
</span><span>}
</span></code></pre><h3 id=crates-bevy-picking-src-mesh-picking-ray-cast-intersections-rs>crates/bevy_picking/src/mesh_picking/ray_cast/intersections.rs</h3><p><strong>Change</strong>: Updated test cases to use new method name<br> <strong>Reason</strong>: Maintain test functionality after API change<br> <strong>Code</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> mesh_transform </span><span style=color:#ed9366>= </span><span>GlobalTransform</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>IDENTITY</span><span style=color:#ed9366>.</span><span style=color:#f07171>compute_matrix</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> mesh_transform </span><span style=color:#ed9366>= </span><span>GlobalTransform</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>IDENTITY</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_matrix</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-render-src-camera-camera-rs>crates/bevy_render/src/camera/camera.rs</h3><p><strong>Change</strong>: Updated camera projection calculations<br> <strong>Reason</strong>: Camera systems rely on transform matrices<br> <strong>Code</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> ndc_to_world </span><span style=color:#ed9366>=</span><span> camera_transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>compute_matrix</span><span>() </span><span style=color:#ed9366>* </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>computed</span><span style=color:#ed9366>.</span><span>clip_from_view</span><span style=color:#ed9366>.</span><span style=color:#f07171>inverse</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> ndc_to_world </span><span style=color:#ed9366>=</span><span> camera_transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_matrix</span><span>() </span><span style=color:#ed9366>* </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>computed</span><span style=color:#ed9366>.</span><span>clip_from_view</span><span style=color:#ed9366>.</span><span style=color:#f07171>inverse</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=release-content-migration-guides-rename-global-transform-compute-matrix-md>release-content/migration-guides/rename_global_transform_compute_matrix.md</h3><p><strong>Change</strong>: Added migration documentation<br> <strong>Reason</strong>: Document breaking API change for users<br> <strong>Code</strong>:<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#abb0b6;background-color:#61676c10;font-weight:700>---
</span><span>title: GlobalTransform::compute_matrix rename
</span><span>pull_requests: [19643]
</span><span style=color:#fa6e32;font-weight:700>---
</span><span>
</span><span style=color:#ed9366;background-color:#61676c10>`GlobalTransform::compute_matrix`</span><span> has been renamed to </span><span style=color:#ed9366;background-color:#61676c10>`GlobalTransform::to_matrix`</span><span> because it does not compute anything, it simply moves data into a different type.
</span></code></pre><h3 id=crates-bevy-pbr-src-light-mod-rs>crates/bevy_pbr/src/light/mod.rs</h3><p><strong>Change</strong>: Updated directional light cascade calculations<br> <strong>Reason</strong>: Lighting systems depend on transform matrices<br> <strong>Code</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#55b4d4;font-style:italic>Some</span><span>((entity</span><span style=color:#61676ccc>,</span><span> projection</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>compute_matrix</span><span>()))
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#55b4d4;font-style:italic>Some</span><span>((entity</span><span style=color:#61676ccc>,</span><span> projection</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_matrix</span><span>()))
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/transform/ target=_blank>Bevy Transform System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/naming.html target=_blank>Rust API Guidelines on Naming</a><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Affine_transformation target=_blank>Affine Transformations Explained</a><li><a rel="noopener nofollow noreferrer" href=https://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/geometry target=_blank>Matrix vs Affine Representations</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19643.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>