<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19510 Only get valid component ids
        
    </title><meta content="#19510 Only get valid component ids" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-06</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19510-zh-cn-20250606>中文</a></div></div><div class=pr-content><h2 id=analysis-of-pr-19510-only-get-valid-component-ids>Analysis of PR #19510: Only get valid component ids</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Only get valid component ids<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19510<li><strong>Author</strong>: ElliottjPierce<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-ECS, C-Performance, P-High, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-06-06T13:36:38Z<li><strong>Merged</strong>: 2025-06-06T21:18:34Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description>Description</h3><p>This PR addresses an 11x performance regression in component value retrieval for unregistered components identified in #19504. The changes also include cleanup work from #18173. The solution replaces <code>get_*</code> methods with <code>get_valid_*</code> equivalents where component values are expected to exist, ensuring only fully registered components are considered. A bug where <code>valid_*</code> methods didn’t properly forward to <code>get_valid_*</code> was also fixed. CI tests were performed.<hr><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>In Bevy’s ECS implementation, components can exist in two states: fully registered or queued for registration. Issue #19504 revealed an 11x performance regression when retrieving component values for unregistered components. The root cause was that several code paths used <code>get_id</code> and similar methods, which return component IDs even for queued components. When these IDs were used to access component data, unnecessary overhead was incurred when handling unregistered components. This was particularly problematic in hot paths like entity queries and resource access.<h3 id=the-solution-approach>The Solution Approach</h3><p>The core insight was that when a component value is expected to exist, we only care about fully registered components. The solution involves:<ol><li>Replacing <code>get_*</code> methods with <code>get_valid_*</code> equivalents where component values are accessed<li>Fixing incorrect forwarding in <code>valid_component_id</code>/<code>valid_resource_id</code> methods<li>Ensuring consistent use of valid component checks across the codebase</ol><p>The approach maintains existing safety guarantees while eliminating unnecessary checks for unregistered components. No alternatives were seriously considered since this was a clear case of using the wrong accessor method.<h3 id=the-implementation>The Implementation</h3><p>Changes were systematically applied across 9 files in the ECS crate. Key modifications include:<ol><li><strong>Component registry fixes</strong> (<code>component.rs</code>):</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>valid_component_id</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTComponentId> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>valid_component_id</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTComponentId> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())
</span><span>}
</span></code></pre><p>This change ensures the method correctly checks for fully registered components.<ol start=2><li><strong>EntityRef optimization</strong> (<code>entity_ref.rs</code>):</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>world</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>world</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><p>This pattern was repeated across 7 methods in the file, ensuring only valid components are accessed.<ol start=3><li><strong>Resource handling</strong> (<code>world/mod.rs</code>):</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><p>This change affects resource removal, existence checks, and change detection.<ol start=4><li><strong>Unsafe world access</strong> (<code>unsafe_world_cell.rs</code>):</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><p>Ensures unsafe access methods respect component registration status.<h3 id=technical-insights>Technical Insights</h3><p>The key insight is that <code>get_valid_*</code> methods are cheaper than <code>get_*</code> methods because:<ul><li>They avoid checking pending registrations<li>They eliminate unnecessary error handling for unregistered components<li>They reduce branch misprediction in hot loops</ul><p>The fix also resolves a subtle bug where <code>valid_component_id</code> incorrectly used <code>get_id</code> instead of <code>get_valid_id</code>, making it functionally identical to <code>component_id</code>. This violated the principle of least surprise in the API.<h3 id=the-impact>The Impact</h3><p>These changes:<ol><li>Fix the 11x performance regression for unregistered component access<li>Improve performance for all component/resource access patterns<li>Correctly distinguish between “any component” vs “registered component” APIs<li>Maintain all existing safety guarantees<li>Affect core ECS operations including: <ul><li>Entity component access<li>Resource management<li>Change detection<li>Reflection<li>Entity cloning</ul></ol><p>The changes demonstrate the importance of precise API selection in performance-critical systems like ECS. Using the most specific method available (<code>get_valid_*</code> vs <code>get_*</code>) can yield significant performance gains.<hr><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Performance Regression #19504] --> B[Analysis]
</span><span>    B --> C[Identify get_id Misuse]
</span><span>    C --> D[Replace with get_valid_id]
</span><span>    D --> E[Fix valid_* Methods]
</span><span>    E --> F[Apply Across Codebase]
</span><span>    F --> G[Performance Recovery]
</span><span>    G --> H[Cleanup from #18173]
</span></code></pre><hr><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-ecs-src-component-rs>1. <code>crates/bevy_ecs/src/component.rs</code></h3><p>Fixed forwarding in <code>valid_component_id</code> and <code>valid_resource_id</code> to use <code>get_valid_*</code> methods:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>valid_component_id</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTComponentId> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>valid_component_id</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> Component>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTComponentId> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-ecs-src-world-entity-ref-rs>2. <code>crates/bevy_ecs/src/world/entity_ref.rs</code></h3><p>Updated 7 methods to use <code>get_valid_id</code> for component access:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>world</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>entity</span><span style=color:#ed9366>.</span><span style=color:#f07171>world</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTT>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=3-crates-bevy-ecs-src-world-mod-rs>3. <code>crates/bevy_ecs/src/world/mod.rs</code></h3><p>Modified resource handling methods to use valid component checks:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>components</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=4-crates-bevy-ecs-src-world-unsafe-world-cell-rs>4. <code>crates/bevy_ecs/src/world/unsafe_world_cell.rs</code></h3><p>Updated unsafe accessors to respect registration status:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> component_id </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_resource_id</span><span>(TypeId</span><span style=color:#ed9366>::</span><span>of</span><span style=color:#ed9366>::</span><span>&LTR>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=5-crates-bevy-ecs-src-entity-clone-entities-rs>5. <code>crates/bevy_ecs/src/entity/clone_entities.rs</code></h3><p>Ensured entity cloning uses valid components:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(id) </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>world</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_id</span><span>(type_id) {
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(id) </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>world</span><span style=color:#ed9366>.</span><span style=color:#f07171>components</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_valid_id</span><span>(type_id) {
</span></code></pre><hr><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/next/programming/ecs/components#component-registration target=_blank>Bevy ECS Component Registration</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/stable/rust-by-example/optimization.html target=_blank>Rust Performance Optimization Patterns</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/SanderMertens/ecs-faq#design-patterns target=_blank>ECS Design Patterns</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/19504 target=_blank>Original Performance Issue #19504</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19510.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>