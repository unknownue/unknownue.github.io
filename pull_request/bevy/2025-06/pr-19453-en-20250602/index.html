<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19453 Exclude `ctrlc` from `bevy_app` for the Nintendo 3DS
        
    </title><meta content="#19453 Exclude `ctrlc` from `bevy_app` for the Nintendo 3DS" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-02</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19453-zh-cn-20250602>中文</a></div></div><div class=pr-content><h2 id=exclude-ctrlc-from-bevy-app-for-the-nintendo-3ds>Exclude <code>ctrlc</code> from <code>bevy_app</code> for the Nintendo 3DS</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Exclude <code>ctrlc</code> from <code>bevy_app</code> for the Nintendo 3DS<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19453<li><strong>Author</strong>: selvmaya<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, S-Ready-For-Final-Review, D-Straightforward, C-Machine-Specific<li><strong>Created</strong>: 2025-05-31T20:53:31Z<li><strong>Merged</strong>: 2025-06-02T22:39:58Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><h4 id=background-motivation>Background/motivation</h4><p>The Nintendo 3DS is supported by the tier 3 rust target <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustc/platform-support/armv6k-nintendo-3ds.html#armv6k-nintendo-3ds target=_blank>armv6k-nintendo-3ds</a>. Bevy does not officially support the device, but as more of bevy becomes <code>no_std</code> compatible, more targets are being partially supported (e.g. GBA - https://github.com/bevyengine/bevy/discussions/10680, https://github.com/bushrat011899/bevy_mod_gba) officially or not.<p>The Nintendo 3DS runs Horizon as its OS which is <a rel="noopener nofollow noreferrer" href=https://github.com/rust-lang/rust/blob/4d08223c054cf5a56d9761ca925fd46ffebe7115/compiler/rustc_target/src/spec/targets/armv6k_nintendo_3ds.rs#L34 target=_blank>unix-based</a>, and the above target (at least partially) supports rust std. It makes sense that you would want to use it, since the 3DS supports things like filesystem reads and the system clock.<h4 id=problem>Problem</h4><p>Unlike standard unix targets, armv6k-nintendo-3ds is not one that can use/build the the <code>ctrlc</code> dependency in <code>bevy_app</code> which is enabled by the bevy <code>std</code> cargo feature.<p>Without the <code>std</code> feature flag, scheduled systems panic without providing another way for bevy to tick using the <code>Instant</code> type (like you might for a <a rel="noopener nofollow noreferrer" href=https://github.com/bushrat011899/bevy_mod_gba/blob/72d8bbf47b33a0ab2f825d80e9ed0b6e5268bf1e/src/time.rs#L36 target=_blank>GBA</a>).<details><summary>Example</summary> <pre style=color:#61676c;background-color:#fafafa><code><span>    Finished `dev` profile [optimized + debuginfo] target(s) in 1m 39s
</span><span>Building smdh: /home/maya/repos/hyperspace-dj/target/armv6k-nintendo-3ds/debug/hyperspace-dj.smdh
</span><span>Building 3dsx: /home/maya/repos/hyperspace-dj/target/armv6k-nintendo-3ds/debug/hyperspace-dj.3dsx
</span><span>Adding RomFS from /home/maya/repos/hyperspace-dj/romfs
</span><span>Running 3dslink
</span><span>Sending hyperspace-dj.3dsx, 7172344 bytes
</span><span>2777346 sent (38.72%), 233 blocks
</span><span>starting server
</span><span>server active ...
</span><span>hii we'are about the to start the bevy app
</span><span>
</span><span>thread 'main' panicked at /home/maya/repos/bevy/crates/bevy_platform/src/time/fallback.rs:177:13:
</span><span>An elapsed time getter has not been provided to `Instant`. Please use `Instant::set_elapsed(...)` before calling `Instant::now()`
</span><span>note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</span></code></pre></details><h4 id=solution>Solution</h4><p>This PR simply excludes the <code>ctrlc</code> dependency and its uses in <code>bevy_app</code> for the 3DS target (<code>horizon</code>) with an addition to its existing feature flags.<p>After this fix, we can use the <code>std</code> feature, and regular scheduled systems no longer panic because of missing <code>Instant</code> (system clock) support.<h4 id=testing>Testing</h4><p>I compiled and ran a binary with the modified version of bevy, using <code>no_default_features</code> and feature flags <code>default_no_std</code> and <code>std</code> on a physical 3DS (classic) using homebrew and <code>cargo-3ds</code>.<p>Toolchain: <a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustc/platform-support/armv6k-nintendo-3ds.html#armv6k-nintendo-3ds target=_blank>armv6k-nintendo-3ds</a> (nightly-2025-03-31) Project reference: https://codeberg.org/pollyglot/hyperspace-dj/commit/440fc1018468885eed4c10c163f6bf3eefc64cb1<h4 id=considerations>Considerations</h4><p>It could be that we don’t want to add specific exceptions inside bevy to support specific hardware with weird quirks inside general bevy code, but it’s not obvious to me what we should use instead of an exception to (pre-existing) target cfg: every change here is merely an addition to a cfg that already checks for both the target family and the <code>std</code> flag.<p>It is not clear to me if this PR is exhaustive enough to be considered an adequate solution for the larger goal of partially supporting the 3DS, but it seems to be a step in the right direction because it at least lets trivial App::run setups with scheduled systems work.<h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>The Nintendo 3DS presents unique challenges for Bevy due to its Horizon OS, which is Unix-based but lacks full compatibility with standard libraries. This PR addresses a specific build failure that occurs when targeting the <code>armv6k-nintendo-3ds</code> platform. The core issue stems from the <code>ctrlc</code> dependency, which provides Ctrl-C signal handling but fails to build for the 3DS target.<p>Without this fix, Bevy applications using the <code>std</code> feature would panic during initialization due to missing system clock support. The panic occurs because scheduled systems rely on <code>Instant</code> for timing, which requires the <code>std</code> feature. However, enabling <code>std</code> pulls in <code>ctrlc</code>, which doesn’t compile for Horizon OS. This creates a catch-22 where developers can’t use either the <code>std</code> or <code>no_std</code> paths successfully.<p>The solution modifies the conditional compilation flags to exclude <code>ctrlc</code> specifically for the Horizon target while preserving existing behavior for other platforms. This is implemented by adding <code>not(target_os = "horizon")</code> to the existing Unix platform checks. The changes ensure that:<ol><li><code>ctrlc</code> is no longer included in dependencies for 3DS builds<li>The terminal control handler module is excluded from compilation<li>The Ctrl-C handler plugin is not included in default plugins</ol><p>These changes are minimal and surgical, affecting only platform-specific configuration without modifying core functionality. The implementation maintains existing behavior for all other platforms while enabling basic Bevy functionality on the 3DS. Testing confirmed that with these changes, scheduled systems work correctly using the system clock without panics.<p>This approach represents a practical compromise - it enables functionality for a niche platform without significant architectural changes. The solution leverages Rust’s conditional compilation system to target specific platform quirks, demonstrating how to handle platform-specific dependencies in a multi-target codebase.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_app] --> B[Conditional Dependencies]
</span><span>    B --> C[ctrlc]
</span><span>    C -->|Enabled for| D[Windows]
</span><span>    C -->|Enabled for| E[Unix not Horizon]
</span><span>    C -->|Disabled for| F[Horizon OS]
</span><span>    A --> G[TerminalCtrlCHandlerPlugin]
</span><span>    G -->|Conditional inclusion| H[Default Plugins]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><h4 id=crates-bevy-app-cargo-toml><code>crates/bevy_app/Cargo.toml</code></h4><p>Modified the dependency condition to exclude Horizon OS from <code>ctrlc</code> inclusion while preserving existing behavior for other Unix-like systems and Windows.<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>- [target.'cfg(any(unix, windows))'.dependencies]
</span><span style=color:#86b300>+ [target.'cfg(any(all(unix, not(target_os = "horizon")), windows))'.dependencies]
</span><span>ctrlc = { version = "3.4.4", optional = true }
</span></code></pre><h4 id=crates-bevy-app-src-lib-rs><code>crates/bevy_app/src/lib.rs</code></h4><p>Updated conditional compilation guards for the terminal control module to match the new dependency condition.<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>- #[cfg(all(any(unix, windows), feature = "std"))]
</span><span style=color:#86b300>+ #[cfg(all(any(all(unix, not(target_os = "horizon")), windows), feature = "std"))]
</span><span>mod terminal_ctrl_c_handler;
</span></code></pre><h4 id=crates-bevy-internal-src-default-plugins-rs><code>crates/bevy_internal/src/default_plugins.rs</code></h4><p>Modified the plugin inclusion condition to exclude Horizon OS from the Ctrl-C handler plugin.<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>#[custom(cfg(any(unix, windows)))]
</span><span style=color:#86b300>+ #[custom(cfg(any(all(unix, not(target_os = "horizon")), windows)))]
</span><span>bevy_app:::TerminalCtrlCHandlerPlugin,
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustc/platform-support/armv6k-nintendo-3ds.html target=_blank>Rust Platform Support: armv6k-nintendo-3ds</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/discussions/10680 target=_blank>Bevy’s <code>no_std</code> Support Discussion</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation in Rust</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bushrat011899/bevy_mod_gba target=_blank>Bevy on GBA Implementation</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19453.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>