<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19366 Core button widget
        
    </title><meta content="#19366 Core button widget" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19366-zh-cn-20250610>中文</a></div></div><div class=pr-content><h1 id=core-button-widget>Core button widget</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Core button widget<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19366<li><strong>Author</strong>: viridia<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-UI, S-Ready-For-Final-Review, M-Needs-Release-Note, X-Blessed<li><strong>Created</strong>: 2025-05-25T22:40:58Z<li><strong>Merged</strong>: 2025-06-10T16:50:08Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>Part of #19236<h3 id=solution>Solution</h3><p>Adds a new <code>bevy_core_widgets</code> crate containing headless widget implementations. This PR adds a single <code>CoreButton</code> widget, more widgets to be added later once this is approved.<h3 id=testing>Testing</h3><p>There’s an example, ui/core_widgets.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=problem-and-context>Problem and Context</h3><p>Bevy’s existing UI button implementation had several limitations. It didn’t integrate with newer systems like <code>bevy_picking</code>, had limited accessibility support, and wasn’t designed for custom styling. Games often require unique, artistically styled UI elements that match their visual theme, but building custom widgets with proper interaction handling and accessibility is complex.<p>The solution was to create headless widgets - unstyled components that handle interaction logic while allowing complete visual customization. This approach is common in web development (e.g., Headless UI), but was missing in Bevy’s UI system.<h3 id=solution-approach>Solution Approach</h3><p>The implementation introduces a new <code>bevy_core_widgets</code> crate starting with a headless button component. Key design decisions:<ol><li><strong>External state management</strong>: Widgets don’t manage their own visual state - apps control appearance through standard ECS components<li><strong>Event-driven interactions</strong>: Uses Bevy’s observer system to handle pointer/keyboard events<li><strong>One-shot systems</strong>: Allows specifying custom click handlers via <code>SystemId</code><li><strong>Accessibility integration</strong>: Leverages AccessKit for screen reader support</ol><h3 id=implementation>Implementation</h3><p>The <code>CoreButton</code> component handles interaction logic while remaining visually neutral. It tracks pressed state using the <code>Depressed</code> component and disables interaction via <code>InteractionDisabled</code>. The implementation handles:<ol><li>Mouse clicks and touch interactions<li>Keyboard activation (Enter/Space)<li>Visual state changes during press/release<li>Accessibility notifications</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>require</span><span>(</span><span style=color:#f29718>AccessibilityNode</span><span>(accesskit::Node::</span><span style=color:#f29718>new</span><span>(Role::Button))]
</span><span>pub struct CoreButton {
</span><span>    pub on_click: Option&LTSystemId></span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>Event handling uses Bevy’s observer system. This example shows the click handler:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_on_pointer_click</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>trigger</span><span style=color:#61676ccc>: </span><span>Trigger&LTPointer&LTClick>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>q_state</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span>CoreButton, Has&LTDepressed>, Has&LTInteractionDisabled>)>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((bstate</span><span style=color:#61676ccc>,</span><span> pressed</span><span style=color:#61676ccc>,</span><span> disabled)) </span><span style=color:#ed9366>=</span><span> q_state</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(trigger</span><span style=color:#ed9366>.</span><span style=color:#f07171>target</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()) {
</span><span>        trigger</span><span style=color:#ed9366>.</span><span style=color:#f07171>propagate</span><span>(</span><span style=color:#ff8f40>false</span><span>)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>if</span><span> pressed </span><span style=color:#ed9366>&& !</span><span>disabled {
</span><span>            </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(on_click) </span><span style=color:#ed9366>=</span><span> bstate</span><span style=color:#ed9366>.</span><span>on_click {
</span><span>                commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>run_system</span><span>(on_click)</span><span style=color:#61676ccc>;
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>New interaction state components were added to <code>bevy_ui</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Depressed</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InteractionDisabled</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>The implementation demonstrates several advanced Bevy patterns:<ol><li><strong>Observer-based event handling</strong>: Efficiently routes UI events to specific handlers<li><strong>External state management</strong>: Avoids two-way data binding by making apps control visual state<li><strong>Accessibility integration</strong>: Automatically updates AccessKit properties when state changes<li><strong>System parameterization</strong>: Allows custom click handlers via <code>SystemId</code></ol><h3 id=impact>Impact</h3><p>This PR provides:<ol><li>Foundation for a headless widget ecosystem in Bevy<li>More flexible button implementation with better accessibility<li>Clear separation between interaction logic and visual presentation<li>Examples demonstrating custom styling approaches</ol><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[CoreButton] --> B[Pointer Events]
</span><span>    A --> C[Keyboard Events]
</span><span>    A --> D[State Components]
</span><span>    B --> E[Click Handler]
</span><span>    C --> F[Key Press Handler]
</span><span>    D --> G[Depressed]
</span><span>    D --> H[InteractionDisabled]
</span><span>    E --> I[Run on_click System]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-core-widgets-src-core-button-rs-141-0><code>crates/bevy_core_widgets/src/core_button.rs</code> (+141/-0)</h3><p>Implements the headless button component and its interaction handlers.<p><strong>Key implementation:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CoreButton </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>on_click</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTSystemId>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_on_pointer_click</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>trigger</span><span style=color:#61676ccc>: </span><span>Trigger&LTPointer&LTClick>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>q_state</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span>CoreButton, Has&LTDepressed>, Has&LTInteractionDisabled>)>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... event handling logic ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-src-interaction-states-rs-74-0><code>crates/bevy_ui/src/interaction_states.rs</code> (+74/-0)</h3><p>Adds components for tracking UI interaction states.<p><strong>New components:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>InteractionDisabled</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Depressed</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=examples-ui-core-widgets-rs-233-0><code>examples/ui/core_widgets.rs</code> (+233/-0)</h3><p>Demonstrates using CoreButton with custom styling.<p><strong>Styling approach:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>set_button_style</span><span>(
</span><span>    </span><span style=color:#ff8f40>disabled</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#ff8f40>hovered</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#ff8f40>depressed</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#ff8f40>color</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BackgroundColor,
</span><span>    </span><span style=color:#ff8f40>border_color</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BorderColor,
</span><span>    </span><span style=color:#ff8f40>text</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Text,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>match </span><span>(disabled</span><span style=color:#61676ccc>,</span><span> hovered</span><span style=color:#61676ccc>,</span><span> depressed) {
</span><span>        (</span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>_</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>_</span><span>) </span><span style=color:#ed9366>=> </span><span>{ </span><span style=color:#abb0b6;font-style:italic>/* disabled style */ </span><span>}</span><span style=color:#61676ccc>,
</span><span>        (</span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>true</span><span>) </span><span style=color:#ed9366>=> </span><span>{ </span><span style=color:#abb0b6;font-style:italic>/* pressed style */ </span><span>}</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other states ...
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-picking-src-hover-rs-285-1><code>crates/bevy_picking/src/hover.rs</code> (+285/-1)</h3><p>Adds hover detection components.<p><strong>New hover components:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>IsHovered</span><span>(pub </span><span style=color:#fa6e32>bool</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>IsDirectlyHovered</span><span>(pub </span><span style=color:#fa6e32>bool</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=release-content-release-notes-headless-widgets-md-90-0><code>release-content/release-notes/headless-widgets.md</code> (+90/-0)</h3><p>Documents the new headless widgets feature.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/observers/ target=_blank>Bevy Observers Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://accesskit.dev/ target=_blank>AccessKit Accessibility Framework</a><li><a rel="noopener nofollow noreferrer" href=https://headlessui.dev/ target=_blank>Headless UI Concepts</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ui/styling/ target=_blank>Bevy UI Styling Guide</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19366.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>