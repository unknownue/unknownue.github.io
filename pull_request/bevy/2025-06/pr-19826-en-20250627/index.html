<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19826 Opt-out for UI clipping
        
    </title><meta content="#19826 Opt-out for UI clipping" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-27</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19826-zh-cn-20250627>中文</a></div></div><div class=pr-content><h1 id=pr-analysis-opt-out-for-ui-clipping>PR Analysis: Opt-out for UI clipping</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Opt-out for UI clipping<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19826<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Rendering, A-UI, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-06-26T19:16:27Z<li><strong>Merged</strong>: 2025-06-27T17:36:47Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Opt-out for UI clipping, for motivation see issue #19821<h2 id=solution>Solution</h2><p>New zst component <code>OverrideClip</code>. A UI node entity with this component will ignore any inherited clipping rect, so it will never get clipped regardless of the <code>Overflow</code> settings of its ancestors.<h4 id=why-use-a-marker-component-and-not-add-a-new-variant-to-overflow-instead>Why use a marker component and not add a new variant to <code>Overflow</code> instead?</h4><p>A separate marker component allows users to set both <code>Overflow</code> and <code>OverrideClip</code> on the same node.<h2 id=testing>Testing</h2><p>Run the <code>overflow</code> example with the <code>OverrideClip</code> component added to the <code>ImagNode</code>s and you will see that clipping is disabled.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>In Bevy’s UI system, clipping behavior is inherited through the node hierarchy. When a parent node sets <code>Overflow</code> to clip its content, all child nodes are automatically clipped to the parent’s bounds. While this is generally desirable, there are cases where developers need specific UI elements to escape this clipping constraint. Issue #19821 documented scenarios where UI elements like tooltips, dropdown menus, or contextual overlays need to render outside their parent containers. The existing system provided no straightforward way to opt out of inherited clipping, forcing workarounds that complicated the node hierarchy or required manual positioning adjustments.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution introduces a new zero-sized marker component <code>OverrideClip</code> that allows UI nodes to ignore inherited clipping constraints. This approach was chosen over alternatives like adding a new variant to the <code>Overflow</code> enum because:<ol><li>It maintains backward compatibility with existing UI setups<li>It allows independent control of a node’s own overflow behavior (<code>Overflow</code>) and its relationship to ancestor clipping (<code>OverrideClip</code>)<li>It avoids expanding the <code>Overflow</code> enum which already handles multiple axes<li>It provides a clear, self-documenting API through the component name</ol><p>The implementation required modifying the clipping update system to check for this new component during clip inheritance calculations.<h3 id=the-implementation>The Implementation</h3><p>The implementation consists of two main changes:<ol><li><strong>New component definition</strong> in <code>ui_node.rs</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// UI node entities with this component will ignore any clipping rect they inherit,
</span><span style=color:#abb0b6;font-style:italic>/// the node will not be clipped regardless of its ancestors' `Overflow` setting.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>OverrideClip</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li><strong>Clipping system modification</strong> in <code>update.rs</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>update_clipping</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((node</span><span style=color:#61676ccc>,</span><span> computed_node</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#61676ccc>,</span><span> maybe_calculated_clip</span><span style=color:#61676ccc>,</span><span> has_override_clip)) </span><span style=color:#ed9366>=
</span><span>        node_query</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(entity)
</span><span>    </span><span style=color:#fa6e32>else </span><span>{
</span><span>        </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>;
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// If the UI node entity has an `OverrideClip` component, discard any inherited clip rect
</span><span>    </span><span style=color:#fa6e32>if</span><span> has_override_clip {
</span><span>        maybe_inherited_clip </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... existing clipping logic continues ...
</span><span>}
</span></code></pre><p>The key change is adding a <code>Has&LTOverrideClip></code> to the node query and inserting a conditional check that clears any inherited clipping rectangle when the component is present. This occurs early in the clipping calculation process, before any node-specific clipping logic is applied.<h3 id=technical-insights>Technical Insights</h3><p>The implementation demonstrates several sound engineering practices:<ul><li><strong>Minimal API surface</strong>: The solution adds just 17 lines of code while solving a significant use case<li><strong>Zero-cost abstraction</strong>: The marker component has no runtime cost beyond the presence check<li><strong>Orthogonal concerns</strong>: Separating clipping override from overflow behavior keeps responsibilities clear<li><strong>Backward compatibility</strong>: Existing UI systems continue working without modification<li><strong>Recursive system integration</strong>: The clipping system already processes nodes hierarchically, making this a natural extension point</ul><p>The solution maintains existing performance characteristics since the additional check is a simple boolean test on a component that’s already being queried.<h3 id=the-impact>The Impact</h3><p>This change enables new UI patterns that were previously difficult or impossible to implement:<ul><li>Tooltips that extend beyond their container boundaries<li>Dropdown menus that overflow their parent elements<li>Contextual overlays that render on top of other UI<li>Special effects that need to break out of scrollable areas</ul><p>Developers can now selectively disable clipping where needed without restructuring their entire UI hierarchy. The implementation avoids common pitfalls like:<ul><li>Creating special-case code paths for specific UI elements<li>Introducing global configuration options that affect all nodes<li>Breaking existing clipping behavior for nodes without the component</ul><p>The solution demonstrates how marker components can effectively modify system behavior while maintaining API clarity and backward compatibility.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[UI Node Entity] --> B[Has OverrideClip?]
</span><span>    B -->|Yes| C[Discard Inherited Clip]
</span><span>    B -->|No| D[Apply Inherited Clip]
</span><span>    C --> E[Process Node Clipping]
</span><span>    D --> E
</span><span>    E --> F[Recurse to Children]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ui-src-ui-node-rs><code>crates/bevy_ui/src/ui_node.rs</code></h3><p>Added the new marker component definition:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// ... existing code ...
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CalculatedClip </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>clip</span><span style=color:#61676ccc>:</span><span> Rect,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// UI node entities with this component will ignore any clipping rect they inherit,
</span><span style=color:#abb0b6;font-style:italic>/// the node will not be clipped regardless of its ancestors' `Overflow` setting.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>OverrideClip</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>/// Indicates that this [`Node`] entity's front-to-back ordering is not controlled solely
</span><span style=color:#abb0b6;font-style:italic>// ... existing code ...
</span></code></pre><h3 id=crates-bevy-ui-src-update-rs><code>crates/bevy_ui/src/update.rs</code></h3><p>Modified the clipping system to respect the new component:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_clipping_system</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#ff8f40>node_query</span><span style=color:#61676ccc>: </span><span>Query<(
</span><span>        </span><span style=color:#ed9366>&</span><span>Node,
</span><span>        </span><span style=color:#ed9366>&</span><span>ComputedNode,
</span><span>        </span><span style=color:#ed9366>&</span><span>UiGlobalTransform,
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> CalculatedClip>,
</span><span>    )>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>) { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_clipping_system</span><span>(
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    </span><span style=color:#ff8f40>node_query</span><span style=color:#61676ccc>: </span><span>Query<(
</span><span>        </span><span style=color:#ed9366>&</span><span>Node,
</span><span>        </span><span style=color:#ed9366>&</span><span>ComputedNode,
</span><span>        </span><span style=color:#ed9366>&</span><span>UiGlobalTransform,
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> CalculatedClip>,
</span><span>        Has&LTOverrideClip>,  // Added component check
</span><span>    )>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>) { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Inside update_clipping function:
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((node</span><span style=color:#61676ccc>,</span><span> computed_node</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#61676ccc>,</span><span> maybe_calculated_clip)) </span><span style=color:#ed9366>=</span><span> node_query</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(entity)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((node</span><span style=color:#61676ccc>,</span><span> computed_node</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#61676ccc>,</span><span> maybe_calculated_clip</span><span style=color:#61676ccc>,</span><span> has_override_clip)) </span><span style=color:#ed9366>= 
</span><span>    node_query</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(entity)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// New logic added:
</span><span style=color:#fa6e32>if</span><span> has_override_clip {
</span><span>    maybe_inherited_clip </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li>Original issue motivating this change: <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/19821 target=_blank>#19821</a><li>Bevy UI clipping documentation: <a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/ui/clipping target=_blank>Bevy UI Book - Clipping</a><li>Marker component pattern: <a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/about.html target=_blank>Rust API Guidelines - C-FEATURE</a><li>Bevy component system: <a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ecs/components target=_blank>Bevy Components</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19826.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>