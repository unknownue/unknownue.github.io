<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19661 Fix Keyboard observer not updating SliderValue
        
    </title><meta content="#19661 Fix Keyboard observer not updating SliderValue" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19661-zh-cn-20250616>中文</a></div></div><div class=pr-content><h1 id=fix-keyboard-observer-not-updating-slidervalue>Fix Keyboard observer not updating SliderValue</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix Keyboard observer not updating SliderValue<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19661<li><strong>Author</strong>: HippoGamus<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-UI, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-06-15T17:42:47Z<li><strong>Merged</strong>: 2025-06-16T22:23:09Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>When the <code>CoreSlider</code>s <code>on_change</code> is set to None, Keyboard input, like ArrowKeys, does not update the <code>SliderValue</code>.<h2 id=solution>Solution</h2><p>Handle the missing case, like it is done for Pointer.<h2 id=testing>Testing</h2><ul><li><p>Did you test these changes? Yes: core_widgets & core_widgets_observers in both examples one has to remove / comment out the setting of <code>CoreSlider::on_change</code> to test the case of <code>on_change</code> being none.</p><li><p>Are there any parts that need more testing? No not that I am aware of.</p><li><p>How can other people (reviewers) test your changes? Is there anything specific they need to know? Yes: core_widgets & core_widgets_observers in both examples one has to remove / comment out the setting of <code>CoreSlider::on_change</code> to test the case of <code>on_change</code> being none.</p><li><p>If relevant, what platforms did you test these changes on, and are there any important ones you can’t test? I tested on linux + wayland. But it is unlikely that it would effect outcomes.</p></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem originated in Bevy’s UI system where keyboard input wasn’t properly updating slider values in certain configurations. Specifically, when a <code>CoreSlider</code> component had its <code>on_change</code> callback explicitly set to <code>None</code>, arrow key inputs would fail to update the associated <code>SliderValue</code> component. This created an inconsistency where pointer-based input worked as expected, but keyboard navigation didn’t.<p>This bug occurred because the keyboard input handler (<code>slider_on_key_input</code>) only updated the slider value when an <code>on_change</code> callback was present. The relevant code section was:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(on_change) </span><span style=color:#ed9366>=</span><span> slider</span><span style=color:#ed9366>.</span><span>on_change {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>run_system_with</span><span>(on_change</span><span style=color:#61676ccc>,</span><span> new_value)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>Notice the missing branch for handling the case when <code>on_change</code> is <code>None</code>. This meant that when no callback was defined, the keyboard input would trigger the interaction logic but fail to update the actual slider value in the ECS.<p>The solution was straightforward: mirror the pattern already implemented for pointer input handling. We added an <code>else</code> block that directly updates the <code>SliderValue</code> component when no callback exists:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(on_change) </span><span style=color:#ed9366>=</span><span> slider</span><span style=color:#ed9366>.</span><span>on_change {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>run_system_with</span><span>(on_change</span><span style=color:#61676ccc>,</span><span> new_value)</span><span style=color:#61676ccc>;
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    commands
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(trigger</span><span style=color:#ed9366>.</span><span style=color:#f07171>target</span><span>())
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(SliderValue(new_value))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>This change maintains consistency with the pointer input handler while fixing the keyboard behavior. The fix is minimal (4 lines added) but significant because it ensures consistent behavior across input methods.<p>The implementation correctly uses Bevy’s ECS commands to modify the <code>SliderValue</code> component on the target entity. This approach is efficient as it leverages Bevy’s change detection and avoids unnecessary overhead. The solution preserves the existing architecture where callbacks take precedence when present, while falling back to direct component updates when they’re absent.<p>This fix improves accessibility by ensuring keyboard navigation works consistently with mouse interaction. It also prevents potential state desync issues where the visual representation of a slider might not match its underlying value when manipulated via keyboard.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Keyboard Input] --> B{CoreSlider.on_change}
</span><span>    B -->|Set| C[Run callback system]
</span><span>    B -->|None| D[Update SliderValue component]
</span><span>    C --> E[Value updated via callback]
</span><span>    D --> F[Value updated directly]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-core-widgets-src-core-slider-rs><code>crates/bevy_core_widgets/src/core_slider.rs</code></h3><p>This file contains the core logic for slider widgets. The change fixes inconsistent keyboard input handling when no change callback is defined.<p>Code change:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>@@ -</span><span style=color:#ff8f40>394</span><span style=color:#61676ccc>,</span><span style=color:#ff8f40>6 </span><span style=color:#ed9366>+</span><span style=color:#ff8f40>394</span><span style=color:#61676ccc>,</span><span style=color:#ff8f40>10 </span><span style=color:#ed9366>@@ </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>slider_on_key_input</span><span>(
</span><span>             trigger.propagate(</span><span style=color:#ff8f40>false</span><span>);
</span><span>             if let Some(</span><span style=color:#ff8f40>on_change</span><span>) = slider.on_change {
</span><span>                 commands.run_system_with(</span><span style=color:#ff8f40>on_change</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>new_value</span><span>);
</span><span>+            } else {
</span><span>+                commands
</span><span>+                    .entity(</span><span style=color:#ff8f40>trigger</span><span>.</span><span style=color:#ff8f40>target</span><span>())
</span><span style=color:#ed9366>+                    .</span><span style=color:#f07171>insert</span><span>(SliderValue(new_value))</span><span style=color:#61676ccc>;
</span><span>             }
</span><span>         }
</span><span>     }
</span><span> }
</span></code></pre><p>The change adds the missing logic to update the <code>SliderValue</code> component directly when no callback is present, mirroring the existing pointer input behavior.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ui/ target=_blank>Bevy UI System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ecs/#commands target=_blank>Bevy ECS Commands</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/input/ target=_blank>Bevy Input Handling</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19661.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>