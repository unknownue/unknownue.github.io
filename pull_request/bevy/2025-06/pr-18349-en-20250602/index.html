<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18349 Make TAA non-experimental, fixes
        
    </title><meta content="#18349 Make TAA non-experimental, fixes" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-02</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-18349-zh-cn-20250602>中文</a></div></div><div class=pr-content><h1 id=analysis-of-pr-18349-make-taa-non-experimental-fixes>Analysis of PR #18349: Make TAA non-experimental, fixes</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Make TAA non-experimental, fixes<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18349<li><strong>Author</strong>: JMS55<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Rendering, C-Usability, S-Ready-For-Final-Review, M-Needs-Migration-Guide, X-Contentious, D-Modest<li><strong>Created</strong>: 2025-03-17T02:06:42Z<li><strong>Merged</strong>: 2025-06-02T16:23:43Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The first 4 commits are designed to be reviewed independently.<ul><li>Mark TAA non-experimental now that motion vectors are written for skinned and morphed meshes, along with skyboxes, and add it to DefaultPlugins<li>Adjust halton sequence to match what DLSS is going to use, doesn’t really affect anything, but may as well<li>Make MipBias a required component on TAA instead of inserting it in the render world<li>Remove MipBias, TemporalJitter, RenderLayers, etc from the render world if they’re removed from the main world (fixes a retained render world bug)<li>Remove TAA components from the render world properly if TemporalAntiAliasing is removed from the main world (fixes a retained render world bug) <ul><li>extract_taa_settings() now has to query over <code>Option<&mut TemporalAntiAliasing></code>, which will match every single camera, in order to cover cameras that had TemporalAntiAliasing removed this frame. This kind of sucks, but I can’t think of anything better.<li>We probably have the same bug with every other rendering feature component we have.</ul></ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Temporal Anti-Aliasing (TAA) was previously an experimental feature in Bevy’s rendering pipeline. This meant it required explicit plugin registration (<code>TemporalAntiAliasPlugin</code>) and had limited integration with the core rendering systems. Additionally, there were two significant technical issues:<ol><li><p><strong>Component retention bugs</strong>: When rendering components like <code>MipBias</code>, <code>TemporalJitter</code>, or <code>RenderLayers</code> were removed from the main world, they weren’t properly cleaned up in the render world. This led to stale state persisting in the render world.</p><li><p><strong>Automatic component insertion</strong>: TAA would automatically insert a <code>MipBias(-1.0)</code> component in the render world if none existed, creating an implicit dependency that wasn’t clearly visible in the component requirements.</p><li><p><strong>Inconsistent Halton sequence</strong>: The jitter sequence used didn’t match industry standards like DLSS, potentially causing compatibility issues.</p></ol><h3 id=the-solution-approach>The Solution Approach</h3><p>The PR solves these problems through several coordinated changes:<ol><li><strong>Promote TAA to core feature</strong>: Move TAA out of experimental status and include it in <code>AntiAliasingPlugin</code>/<code>DefaultPlugins</code>.<li><strong>Require explicit components</strong>: Make <code>MipBias</code> a required component for TAA instead of implicitly adding it.<li><strong>Fix component cleanup</strong>: Ensure rendering components are properly removed from the render world when removed from main world.<li><strong>Standardize Halton sequence</strong>: Update the jitter sequence to match DLSS standards.</ol><h3 id=the-implementation>The Implementation</h3><p>The implementation required changes across multiple systems:<p><strong>Component cleanup logic</strong> was overhauled in the camera extraction system. Previously, components were only added to the render world. Now, they’re explicitly removed when missing from main world:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In camera extraction system
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(temporal_jitter) </span><span style=color:#ed9366>=</span><span> temporal_jitter {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(temporal_jitter</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    commands</span><span style=color:#ed9366>.</span><span>remove</span><span style=color:#ed9366>::</span><span>&LTTemporalJitter>()</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// New cleanup logic
</span><span>}
</span></code></pre><p><strong>TAA extraction</strong> was modified to handle optional components. The system now queries for <code>Option<&mut TemporalAntiAliasing></code> to detect when TAA has been removed:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let mut</span><span> cameras_3d </span><span style=color:#ed9366>=</span><span> main_world</span><span style=color:#ed9366>.</span><span>query</span><span style=color:#ed9366>::</span><span><(
</span><span>    RenderEntity,
</span><span>    </span><span style=color:#ed9366>&</span><span>Camera,
</span><span>    </span><span style=color:#ed9366>&</span><span>Projection,
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> TemporalAntiAliasing>,  // Now optional
</span><span>)>()</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>MipBias handling</strong> was simplified by making it a required component with a default value:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MipBias</span><span>(pub </span><span style=color:#fa6e32>f32</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Default </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>MipBias </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>default</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span>(</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1.0</span><span>)  </span><span style=color:#abb0b6;font-style:italic>// Default value established
</span><span>    }
</span><span>}
</span></code></pre><p><strong>Jitter sequence</strong> was updated to match DLSS standards by adding a (0,0) entry and removing the last point:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> halton_sequence </span><span style=color:#ed9366>= </span><span>[
</span><span>    </span><span style=color:#f07171>vec2</span><span>(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#61676ccc>,  </span><span style=color:#abb0b6;font-style:italic>// New first entry
</span><span>    </span><span style=color:#f07171>vec2</span><span>(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span style=color:#ff8f40>0.16666666</span><span>)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other entries ...
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// vec2(-0.4375, 0.3888889),  // Removed entry
</span><span>]</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>Key technical decisions include:<ol><li><p><strong>Render world synchronization</strong>: The solution addresses a fundamental problem in ECS rendering - components removed from main world must be explicitly removed from render world. This pattern will likely need to be applied to other rendering features.</p><li><p><strong>Query efficiency tradeoff</strong>: Using <code>Option<&mut TemporalAntiAliasing></code> in the extraction query ensures all cameras are checked for TAA removal, but has performance implications since it matches every camera. The author notes this is not ideal but necessary for correctness.</p><li><p><strong>Explicit component requirements</strong>: Changing TAA to require <code>MipBias</code> makes dependencies clearer and eliminates “magic” behavior where components were automatically added.</p></ol><h3 id=the-impact>The Impact</h3><ol><li><strong>Usability improvement</strong>: TAA is now included in DefaultPlugins, making it accessible without experimental flags.<li><strong>Bug fixes</strong>: Critical rendering world synchronization bugs are resolved.<li><strong>Standardization</strong>: Jitter sequence alignment with DLSS improves compatibility.<li><strong>Migration requirements</strong>: <ul><li>Projects using experimental TAA must remove explicit plugin registration<li>Cameras using TAA must now include <code>MipBias</code> component</ul></ol><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Main World] -->|Extraction| B[Render World]
</span><span>    B --> C[TAA Processing]
</span><span>    A -->|Component Removal| D[Cleanup Trigger]
</span><span>    D -->|Remove Components| B
</span><span>    C --> E[Jitter Sequence]
</span><span>    E --> F[Updated Halton&LTbr>0.0,0.0 added]
</span><span>    C --> G[MipBias Handling]
</span><span>    G --> H[Explicit Component]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><code>crates/bevy_anti_aliasing/src/experimental/mod.rs</code></p> <ul><li><strong>Change</strong>: Entire file removed<li><strong>Why</strong>: TAA is no longer experimental<li><strong>Impact</strong>: Eliminates experimental namespace</ul><li><p><code>crates/bevy_anti_aliasing/src/lib.rs</code></p> <ul><li><strong>Change</strong>: Added TAA to default plugins<li><strong>Code</strong>:</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span> impl Plugin for AntiAliasingPlugin {
</span><span>     fn build(&self, app: &mut bevy_app::App) {
</span><span style=color:#f07171>-        app.add_plugins((FxaaPlugin, CasPlugin, SmaaPlugin));
</span><span style=color:#86b300>+        app.add_plugins((FxaaPlugin, SmaaPlugin, TemporalAntiAliasPlugin, CasPlugin));
</span><span>     }
</span><span> }
</span></code></pre><ol start=3><li><code>crates/bevy_anti_aliasing/src/taa/mod.rs</code> <ul><li><strong>Changes</strong>: <ul><li>Made MipBias required<li>Fixed TAA component cleanup<li>Updated Halton sequence</ul><li><strong>Key Code</strong>:</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-#[require(TemporalJitter, DepthPrepass, MotionVectorPrepass)]
</span><span style=color:#86b300>+#[require(TemporalJitter, MipBias, DepthPrepass, MotionVectorPrepass)]
</span></code></pre><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-        let mut cameras_3d = main_world.query_filtered::<(
</span><span style=color:#86b300>+        let mut cameras_3d = main_world.query::<(
</span><span>             RenderEntity,
</span><span>             &Camera,
</span><span>             &Projection,
</span><span style=color:#f07171>-            &mut TemporalAntiAliasing,
</span><span style=color:#f07171>-        ), (
</span><span style=color:#f07171>-            With&LTCamera3d>,
</span><span style=color:#f07171>-            With&LTTemporalJitter>,
</span><span style=color:#f07171>-            With&LTDepthPrepass>,
</span><span style=color:#f07171>-            With&LTMotionVectorPrepass>,
</span><span style=color:#86b300>+            Option<&mut TemporalAntiAliasing>,
</span><span>         )>();
</span></code></pre><ol start=4><li><code>crates/bevy_render/src/camera/camera.rs</code> <ul><li><strong>Change</strong>: Added component cleanup logic<li><strong>Code</strong>:</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>             if let Some(temporal_jitter) = temporal_jitter {
</span><span>                 commands.insert(temporal_jitter.clone());
</span><span style=color:#86b300>+            } else {
</span><span style=color:#86b300>+                commands.remove::&LTTemporalJitter>();
</span><span>             }
</span></code></pre><ol start=5><li><code>examples/3d/transmission.rs</code> <ul><li><strong>Change</strong>: Updated TAA usage pattern<li><strong>Code</strong>:</ul></ol><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-    app.add_plugins(TemporalAntiAliasPlugin);
</span><span style=color:#86b300>+    // TAA now part of DefaultPlugins
</span></code></pre><ol start=6><li><code>release-content/migration-guides/taa_non_experimental.md</code> <ul><li><strong>Change</strong>: New migration guide added<li><strong>Content</strong>:</ul></ol><pre class=language-md data-lang=md style=color:#61676c;background-color:#fafafa><code class=language-md data-lang=md><span>TAA is no longer experimental.
</span><span>
</span><span style=color:#ed9366;background-color:#61676c10>`TemporalAntiAliasPlugin`</span><span> no longer needs to be added to your app to use TAA. It is now part of DefaultPlugins/AntiAliasingPlugin.
</span><span>
</span><span style=color:#ed9366;background-color:#61676c10>`TemporalAntiAliasing`</span><span> now uses </span><span style=color:#ed9366;background-color:#61676c10>`MipBias`</span><span> as a required component in the main world, instead of overriding it manually in the render world.
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Temporal_anti-aliasing target=_blank>Temporal Anti-Aliasing Explained</a><li><a rel="noopener nofollow noreferrer" href=https://www.pbr-book.org/3ed-2018/Sampling_and_Reconstruction/The_Halton_Sampler target=_blank>Halton Sequence in Rendering</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/migration-guides/0.14-to-0.15/#pipelined-rendering target=_blank>Bevy Render Pipeline Architecture</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/plugins_guidelines.md#rendering-plugins target=_blank>ECS Render World Pattern</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_18349.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>