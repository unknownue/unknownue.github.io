<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19274 Introduce `CheckChangeTicks` event that is triggered by `World::check_change_ticks`
        
    </title><meta content="#19274 Introduce `CheckChangeTicks` event that is triggered by `World::check_change_ticks`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19274-zh-cn-20250609>中文</a></div></div><div class=pr-content><h2 id=analysis-of-pr-19274-introduce-checkchangeticks-event>Analysis of PR #19274: Introduce <code>CheckChangeTicks</code> event</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Introduce <code>CheckChangeTicks</code> event that is triggered by <code>World::check_change_ticks</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19274<li><strong>Author</strong>: urben1680<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, S-Ready-For-Final-Review, A-Time, A-Networking, D-Straightforward<li><strong>Created</strong>: 2025-05-18T10:41:24Z<li><strong>Merged</strong>: 2025-06-09T21:07:05Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><p><strong>Objective</strong><p>In the past I had custom data structures containing <code>Tick</code>s. I learned that these need to be regularly checked to clamp them. But there was no way to hook into that logic so I abandoned storing ticks since then.<p>Another motivation to open this up some more is to be more able to do a correct implementation of <code>System::check_ticks</code>.<p><strong>Solution</strong><p>Add <code>CheckChangeTicks</code> and trigger it in <code>World::check_change_ticks</code>. Make <code>Tick::check_tick</code> public.<p>This event makes it possible to store ticks in components or resources and have them checked.<p>I also made <code>Schedules::check_change_ticks</code> public so users can store schedules in custom resources/components for whatever reasons.<p><strong>Testing</strong><p>The logic boils down to a single <code>World::trigger</code> call and I don’t think this needs more tests.<p><strong>Alternatives</strong><p>Making this obsolete like with #15683.<hr><p><strong>Showcase</strong><p>From the added docs:<pre class=language-rs data-lang=rs style=color:#61676c;background-color:#fafafa><code class=language-rs data-lang=rs><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>prelude</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>CheckChangeTicks</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>CustomSchedule</span><span>(Schedule)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let mut</span><span> world </span><span style=color:#ed9366>= </span><span>World</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>world</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_observer</span><span>(|</span><span style=color:#ff8f40>tick</span><span style=color:#61676ccc>: </span><span>Trigger&LTCheckChangeTicks></span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>schedule</span><span style=color:#61676ccc>: </span><span>ResMut&LTCustomSchedule>| {
</span><span>    schedule</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>check_change_ticks</span><span>(tick</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>())</span><span style=color:#61676ccc>;
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p><strong>The Problem and Context</strong><br> Bevy’s ECS uses <code>Tick</code> values for change detection, which must be periodically clamped to prevent overflow. Previously, this clamping only occurred internally for Bevy-managed components and systems. Developers couldn’t extend this protection to custom data structures containing <code>Tick</code> values, leading to potential bugs and abandonment of tick-based solutions. This limitation was particularly problematic for custom schedule implementations stored in resources, which didn’t benefit from automatic tick maintenance.<p><strong>The Solution Approach</strong><br> The solution introduces an event-based mechanism that exposes Bevy’s internal tick clamping logic. By adding a <code>CheckChangeTicks</code> event and triggering it during <code>World::check_change_ticks</code>, developers can now maintain tick validity in their own data structures. Two key changes enable this:<ol><li>Making <code>Tick::check_tick</code> public allows manual tick validation<li>Making <code>Schedule::check_change_ticks</code> public enables custom schedule maintenance</ol><p>This approach maintains Bevy’s existing change detection architecture while providing extension points without significant overhead.<p><strong>The Implementation</strong><br> The implementation adds the <code>CheckChangeTicks</code> event and triggers it in the world’s tick update loop:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_ecs/src/world/mod.rs
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_change_ticks</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) {
</span><span>        </span><span style=color:#fa6e32>let</span><span> change_tick </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>change_tick</span><span>()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... existing logic ...
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>trigger</span><span>(CheckChangeTicks(change_tick))</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// New event trigger
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>last_check_tick </span><span style=color:#ed9366>=</span><span> change_tick</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>The new event provides access to the current change tick:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_ecs/src/component.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Event)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CheckChangeTicks</span><span>(pub(crate) Tick)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>CheckChangeTicks </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Tick {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0
</span><span>    }
</span><span>}
</span></code></pre><p>Visibility changes enable external tick maintenance:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// crates/bevy_ecs/src/component.rs
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Tick </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_tick</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>tick</span><span style=color:#61676ccc>:</span><span> Tick) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{ </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// crates/bevy_ecs/src/schedule/schedule.rs
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Schedule </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_change_ticks</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>change_tick</span><span style=color:#61676ccc>:</span><span> Tick) { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}
</span><span>}
</span></code></pre><p><strong>Technical Insights</strong><br> This solution addresses a specific gap in Bevy’s change detection API. The event-based approach keeps concerns separated while providing necessary extension points. Performance impact is minimal since the event triggers unconditionally but only actual observers will process it. The implementation avoids breaking changes while solving a real-world problem encountered by the author and others in the community.<p><strong>The Impact</strong><br> This change enables several new patterns:<ol><li>Custom components/resources with tick-based change detection<li>External schedule management (e.g., for modding systems)<li>Safer long-running applications by preventing tick overflow<li>More robust implementations of <code>System::check_ticks</code></ol><p>Developers no longer need to abandon tick-based solutions due to maintenance concerns. The solution also provides a pattern for extending other internal ECS processes through events.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[World::check_change_ticks] --> B[Trigger CheckChangeTicks]
</span><span>    B --> C[Observer: Custom Tick Maintenance]
</span><span>    B --> D[Observer: Schedule Maintenance]
</span><span>    C --> E[Component.check_tick]
</span><span>    D --> F[Schedule.check_change_ticks]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><ol><li><strong>crates/bevy_ecs/src/component.rs</strong> (+37/-1)<br> Added the <code>CheckChangeTicks</code> event and made <code>Tick::check_tick</code> public:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Tick </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>check_tick</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>tick</span><span style=color:#61676ccc>:</span><span> Tick) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Tick </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_tick</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>tick</span><span style=color:#61676ccc>:</span><span> Tick) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Event)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>CheckChangeTicks</span><span>(pub(crate) Tick)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>CheckChangeTicks </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get</span><span>(</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Tick {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0
</span><span>    }
</span><span>}
</span></code></pre><ol start=2><li><strong>crates/bevy_ecs/src/schedule/schedule.rs</strong> (+1/-1)<br> Made schedule tick checking public:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Schedule </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>check_change_ticks</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>change_tick</span><span style=color:#61676ccc>:</span><span> Tick) { </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Schedule </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_change_ticks</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>change_tick</span><span style=color:#61676ccc>:</span><span> Tick) { </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span></code></pre><ol start=3><li><strong>crates/bevy_ecs/src/world/mod.rs</strong> (+5/-3)<br> Added event triggering to the world’s tick update:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_change_ticks</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...existing logic...
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>last_check_tick </span><span style=color:#ed9366>=</span><span> change_tick</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>World </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_change_ticks</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...existing logic...
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>trigger</span><span>(CheckChangeTicks(change_tick))</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// New
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>last_check_tick </span><span style=color:#ed9366>=</span><span> change_tick</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/change-detection/ target=_blank>Bevy Change Detection Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Entity_component_system target=_blank>Entity Component System Pattern</a><li><a rel="noopener nofollow noreferrer" href=https://learn.microsoft.com/en-us/azure/architecture/guide/architecture-styles/event-driven target=_blank>Event-Driven Architecture</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19274.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>