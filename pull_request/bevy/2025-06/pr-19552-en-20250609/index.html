<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19552 Adding PartialEq to some UI and Text types
        
    </title><meta content="#19552 Adding PartialEq to some UI and Text types" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-06/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-06-09</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-06/pr-19552-zh-cn-20250609>中文</a></div></div><div class=pr-content><h1 id=adding-partialeq-to-some-ui-and-text-types>Adding PartialEq to some UI and Text types</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Adding PartialEq to some UI and Text types<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19552<li><strong>Author</strong>: eckz<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Usability, S-Ready-For-Final-Review, A-Text, X-Uncontroversial<li><strong>Created</strong>: 2025-06-09T08:48:33Z<li><strong>Merged</strong>: 2025-06-09T20:33:39Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>During the development of <a rel="noopener nofollow noreferrer" href=https://github.com/eckz/bevy_flair target=_blank><code>bevy_flair</code></a> I found <a href="https://github.com/search?q=repo%3Aeckz%2Fbevy_flair%20%20%22Try%20to%20upstream%20it%20to%20bevy%22&type=code" rel="noopener nofollow noreferrer" target=_blank>some types lacking <code>PartialEq</code></a> which made the unit testing a little bit inconvinient.</ul><h2 id=solution>Solution</h2><ul><li>Adding <code>PartialEq</code> for the following types: <ul><li><code>LineHeight </code><li><code>TextShadow</code><li><code>NodeImageMode</code></ul></ul><h2 id=testing>Testing</h2><ul><li>Letting github actions do the testing, this is not an invasive change and <code>cargo run --bin ci</code> doesn’t seem to work in <code>main</code> at the moment.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>While developing <a rel="noopener nofollow noreferrer" href=https://github.com/eckz/bevy_flair target=_blank><code>bevy_flair</code></a>, the author encountered practical difficulties with unit testing due to several Bevy UI and text types lacking <code>PartialEq</code> implementations. These types - <code>LineHeight</code>, <code>TextShadow</code>, and <code>NodeImageMode</code> - are fundamental building blocks in UI systems but couldn’t be directly compared in test assertions.<p>The solution implemented is straightforward: derive <code>PartialEq</code> for these types. This approach was chosen because:<ol><li>All these types contain only primitive fields that already implement <code>PartialEq</code><li>Deriving <code>PartialEq</code> maintains consistency with other similar types in the codebase<li>The change is non-invasive and backward-compatible</ol><p>The implementation required two modifications per type:<ol><li>Adding <code>PartialEq</code> to the <code>#[derive(...)]</code> attribute<li>Adding <code>PartialEq</code> to the <code>#[reflect(...)]</code> attribute to ensure reflection metadata stays consistent</ol><p>These changes enable developers to write more expressive unit tests by allowing direct value comparisons. For example:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Now possible with PartialEq implemented
</span><span style=color:#f07171>assert_eq!</span><span>(text</span><span style=color:#ed9366>.</span><span>line_height</span><span style=color:#61676ccc>, </span><span>LineHeight</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>20.0</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><p>The modifications are safe because:<ul><li>All field types already implement <code>PartialEq</code><li>No existing behavior is modified - only comparison capability is added<li>The changes are purely additive with no breaking API modifications</ul><p>The PR was tested through GitHub Actions CI pipelines since the changes didn’t require special local testing. The implementation follows established patterns in the Bevy codebase where many similar UI types already implement <code>PartialEq</code>.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    Problem[Testing Limitations in bevy_flair] --> Solution
</span><span>    Solution[Add PartialEq Implementations] --> Types
</span><span>    Types --> LineHeight
</span><span>    Types --> TextShadow
</span><span>    Types --> NodeImageMode
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-text-rs>crates/bevy_text/src/text.rs</h3><p>Added <code>PartialEq</code> to <code>LineHeight</code> enum for text line height configuration<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-#[derive(Debug, Clone, Copy, Reflect)]
</span><span style=color:#f07171>-#[reflect(Debug, Clone)]
</span><span style=color:#86b300>+#[derive(Debug, Clone, Copy, PartialEq, Reflect)]
</span><span style=color:#86b300>+#[reflect(Debug, Clone, PartialEq)]
</span><span> pub enum LineHeight {
</span><span>     /// Set line height to a specific number of pixels
</span><span>     Px(f32),
</span></code></pre><h3 id=crates-bevy-ui-src-ui-node-rs>crates/bevy_ui/src/ui_node.rs</h3><p>Added <code>PartialEq</code> to <code>TextShadow</code> component for text shadow effects<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-#[derive(Component, Copy, Clone, Debug, Reflect)]
</span><span style=color:#f07171>-#[reflect(Component, Default, Debug, Clone)]
</span><span style=color:#86b300>+#[derive(Component, Copy, Clone, Debug, PartialEq, Reflect)]
</span><span style=color:#86b300>+#[reflect(Component, Default, Debug, Clone, PartialEq)]
</span><span> pub struct TextShadow {
</span><span>     /// Shadow displacement in logical pixels
</span><span>     /// With a value of zero the shadow will be hidden directly behind the text
</span></code></pre><h3 id=crates-bevy-ui-src-widget-image-rs>crates/bevy_ui/src/widget/image.rs</h3><p>Added <code>PartialEq</code> to <code>NodeImageMode</code> enum for image sizing behavior<pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-#[derive(Default, Debug, Clone, Reflect)]
</span><span style=color:#f07171>-#[reflect(Clone, Default)]
</span><span style=color:#86b300>+#[derive(Default, Debug, Clone, PartialEq, Reflect)]
</span><span style=color:#86b300>+#[reflect(Clone, Default, PartialEq)]
</span><span> pub enum NodeImageMode {
</span><span>     /// The image will be sized automatically by taking the size of the source image and applying any layout constraints.
</span><span>     #[default]
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/cmp/trait.PartialEq.html target=_blank>Rust PartialEq documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/migration-guides/0.12-to-0.13/#reflect-changes target=_blank>Bevy Reflection System</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch11-01-writing-tests.html target=_blank>Unit Testing Best Practices in Rust</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-06/pr_19552.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>