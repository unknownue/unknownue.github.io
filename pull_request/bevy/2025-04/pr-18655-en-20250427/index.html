<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18655 Dependency Maintenance in Bevy: Upgrading spin to 0.10.0
        
    </title><meta content="#18655 Dependency Maintenance in Bevy: Upgrading spin to 0.10.0" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-04/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-04-27</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-04/pr-18655-zh-cn-20250427>中文</a></div></div><div class=pr-content><h1 id=title-dependency-maintenance-in-bevy-upgrading-spin-to-0-10-0>Title: Dependency Maintenance in Bevy: Upgrading spin to 0.10.0</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update spin requirement from 0.9.8 to 0.10.0<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18655<li><strong>Author</strong>: mnmaita<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Dependencies, S-Ready-For-Final-Review, A-Utils, O-Embedded<li><strong>Created</strong>: 2025-04-01T07:24:59Z<li><strong>Merged</strong>: 2025-04-27T06:42:33Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Closes #18643</ul><h2 id=solution>Solution</h2><ul><li>Updated spin requirement from 0.9.8 to 0.10.0.<li>Renamed <code>spin/portable_atomic</code> feature to <code>spin/portable-atomic</code>.</ul><h2 id=testing>Testing</h2><ul><li>CI checks (already passing in the dependabot PR).</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses routine dependency maintenance in the Bevy engine’s platform support layer. The primary goal was to keep dependencies current while maintaining compatibility with embedded systems and multi-threaded synchronization primitives.<p>The spin crate, a lightweight Rust implementation of synchronization primitives, had released version 0.10.0. This update introduced a minor but breaking change: the <code>portable_atomic</code> feature was renamed to <code>portable-atomic</code> to follow Rust’s feature naming conventions. Bevy’s platform abstraction layer needed adjustment to maintain compatibility with this updated version.<p>The implementation required two precise modifications in the Cargo.toml manifest:<ol><li>Version specification updates in two dependency declarations<li>Feature flag renaming in the spin dependency configuration</ol><p>These changes ensure Bevy continues to leverage spin’s synchronization primitives while maintaining compatibility with platforms requiring portable atomic operations. The CI pipeline validated the changes through existing test suites, confirming no regressions in platform support or synchronization behavior.<p>The update demonstrates effective dependency management practices:<ul><li>Timely adoption of upstream improvements<li>Attention to semantic versioning changes<li>Compatibility maintenance for embedded targets through proper feature flag configuration</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[spin 0.9.8] --> B[Update Process]
</span><span>    B --> C[Version Bump]
</span><span>    B --> D[Feature Rename]
</span><span>    C --> E[spin 0.10.0]
</span><span>    D --> E
</span><span>    E --> F[CI Validation]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File</strong>: <code>crates/bevy_platform/Cargo.toml</code><ol><li><strong>Version Update</strong>:</ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>spin </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.9.8"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"mutex"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"spin_mutex"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"rwlock"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"once"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"barrier"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"portable_atomic"
</span><span>] }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>spin </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.10.0"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"mutex"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"spin_mutex"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"rwlock"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"once"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"barrier"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"portable-atomic"
</span><span>] }
</span></code></pre><ol start=2><li><strong>Feature Flag Adjustment</strong>:</ol><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>spin </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.9.8"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"portable_atomic"</span><span style=color:#61676ccc>,
</span><span>] }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>spin </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.10.0"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"portable-atomic"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><p>These changes ensure:<ul><li>Compatibility with spin’s latest API surface<li>Continued support for portable atomic operations through the renamed feature<li>Consistent dependency versioning across the platform abstraction layer</ul><h2 id=further-reading>Further Reading</h2><ol><li>spin crate documentation: https://docs.rs/spin/0.10.0/spin/<li>Rust feature naming conventions: https://doc.rust-lang.org/cargo/reference/features.html<li>Semantic Versioning in Rust: https://doc.rust-lang.org/cargo/reference/semver.html</ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_platform/Cargo.toml b/crates/bevy_platform/Cargo.toml
</span><span>index bd6402b36a96b..3dc04396b2c5f 100644
</span><span style=color:#c594c5>--- a/crates/bevy_platform/Cargo.toml
</span><span style=color:#c594c5>+++ b/crates/bevy_platform/Cargo.toml
</span><span style=color:#c594c5>@@ -48,7 +48,7 @@ </span><span style=color:#399ee6>web = ["dep:web-time", "dep:getrandom"]
</span><span> [dependencies]
</span><span> cfg-if = "1.0.0"
</span><span> critical-section = { version = "1.2.0", default-features = false, optional = true }
</span><span style=color:#f07171>-spin = { version = "0.9.8", default-features = false, features = [
</span><span style=color:#86b300>+spin = { version = "0.10.0", default-features = false, features = [
</span><span>   "mutex",
</span><span>   "spin_mutex",
</span><span>   "rwlock",
</span><span style=color:#c594c5>@@ -74,8 +74,8 @@ </span><span style=color:#399ee6>getrandom = { version = "0.2.0", default-features = false, optional = true, feat
</span><span> portable-atomic = { version = "1", default-features = false, features = [
</span><span>   "fallback",
</span><span> ] }
</span><span style=color:#f07171>-spin = { version = "0.9.8", default-features = false, features = [
</span><span style=color:#f07171>-  "portable_atomic",
</span><span style=color:#86b300>+spin = { version = "0.10.0", default-features = false, features = [
</span><span style=color:#86b300>+  "portable-atomic",
</span><span> ] }
</span><span> 
</span><span> [target.'cfg(not(target_has_atomic = "ptr"))'.dependencies]
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-04/pr_18655.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>