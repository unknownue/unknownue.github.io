<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18695 use entity set collections type aliases instead of defaults
        
    </title><meta content="#18695 use entity set collections type aliases instead of defaults" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-04/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-04-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-04/pr-18695-zh-cn-20250403>中文</a></div></div><div class=pr-content><h1 id=18695-use-entity-set-collections-type-aliases-instead-of-defaults>#18695 use entity set collections type aliases instead of defaults</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: use entity set collections type aliases instead of defaults<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18695<li><strong>Author</strong>: Victoronz<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: <code>A-ECS</code>, <code>C-Usability</code>, <code>S-Ready-For-Final-Review</code>, <code>D-Straightforward</code><li><strong>Created</strong>: 2025-04-03T01:20:50Z<li><strong>Merged</strong>: Not merged<li><strong>Merged By</strong>: N/A</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Newest installment of the #16547 series.<p>In #18319 we introduced <code>Entity</code> defaults to accomodate the most common use case for these types, however that resulted in the switch of the <code>T</code> and <code>N</code> generics of <code>UniqueEntityArray</code>. Swapping generics might be somewhat acceptable for <code>UniqueEntityArray</code>, it is not at all acceptable for map and set types, which we would make generic over <code>T: EntityEquivalent</code> in #18408.<p>Leaving these defaults in place would result in a glaring inconsistency between these set collections and the others.<p>Additionally, the current standard in the engine is for “entity” to mean <code>Entity</code>. APIs could be changed to accept <code>EntityEquivalent</code>, however that is a separate and contentious discussion.<h2 id=solution>Solution</h2><p>Name these set collections <code>UniqueEntityEquivalent*</code>, and retain the <code>UniqueEntity*</code> name for an alias of the <code>Entity</code> case. While more verbose, this allows for all generics to be in proper order, full consistency between all set types*, and the “entity” name to be restricted to <code>Entity</code>. On top of that, <code>UniqueEntity*</code> now always have 1 generic less, when previously this was not enforced for the default case.<p>*<code>UniqueEntityIter&LTI: Iterator&LTT: EntityEquivalent>></code> is the sole exception to this. Aliases are unable to enforce bounds (<code>lazy_type_alias</code> is needed for this), so for this type, doing this split would be a mere suggestion, and in no way enforced. Iterator types are rarely ever named, and this specific one is intended to be aliased when it sees more use, like we do for the corresponding set collection iterators. Furthermore, the <code>EntityEquivalent</code> precursor <code>Borrow&LTEntity></code> was used exactly because of such iterator bounds! Because of that, we leave it as is.<p>While no migration guide for 0.15 users, for those that upgrade from main: <code>UniqueEntityVec&LTT></code> -> <code>UniqueEntityEquivalentVec&LTT></code> <code>UniqueEntitySlice&LTT></code> -> <code>UniqueEntityEquivalentSlice&LTT></code> <code>UniqueEntityArray&LTN, T></code> -> <code>UniqueEntityEquivalentArray&LTT, N></code><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a naming inconsistency in Bevy’s ECS entity collection types that emerged from previous changes to generic parameters. The core issue stemmed from how generic type parameters were ordered in collection types like <code>UniqueEntityArray</code>, which became problematic when preparing to introduce more generic entity-equivalent types.<p>Previously, #18319 adjusted <code>UniqueEntityArray</code> to use <code>Entity</code> as a default type parameter, swapping the order of its generics from <code>&LTN, T></code> to <code>&LTT, N></code>. While this worked for arrays, it created an inconsistency pattern that would become untenable when introducing similar collection types (like maps and sets) that needed to support generic <code>EntityEquivalent</code> types. The team recognized that maintaining consistent generics ordering across all collection types was crucial for API clarity and developer ergonomics.<p>The solution restructures the naming scheme to clearly separate the common <code>Entity</code> case from generic <code>EntityEquivalent</code> scenarios. By renaming the base types to <code>UniqueEntityEquivalent*</code> and creating type aliases for the <code>Entity</code> specialization, the PR achieves three key goals:<ol><li>Preserves natural generics ordering (<code>&LTT, N></code> instead of <code>&LTN, T></code>)<li>Maintains consistent naming across all entity collection types<li>Reduces cognitive load by keeping the common <code>Entity</code> case shorter</ol><p>For example, the base array type becomes:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UniqueEntityEquivalentArray</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> EntityEquivalent, </span><span style=color:#fa6e32>const</span><span> N</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>>([T; N])</span><span style=color:#61676ccc>;
</span></code></pre><p>With a type alias for the common case:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub type </span><span style=color:#399ee6>UniqueEntityArray</span><span style=color:#ed9366><</span><span style=color:#fa6e32>const</span><span> N</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span style=color:#ed9366>> = </span><span>UniqueEntityEquivalentArray&LTEntity, N></span><span style=color:#61676ccc>;
</span></code></pre><p>This approach required updating 25+ type references across the codebase while maintaining backward compatibility through type aliases. The exception was <code>UniqueEntityIter</code>, which couldn’t be properly aliased due to Rust’s type system limitations around iterator bounds.<p>The changes particularly impacted three core areas:<ol><li><strong>Collection Definitions</strong>: Renamed structs and adjusted generics in array/slice/vec implementations<li><strong>Type Aliases</strong>: Added clear aliases for the common <code>Entity</code> case<li><strong>API Surface</strong>: Updated method signatures in query systems to use new types</ol><p>A key technical decision was maintaining the <code>UniqueEntity*</code> prefix for the type aliases rather than creating completely new names. This preserves discoverability while making the more flexible <code>EntityEquivalent</code> variants explicitly opt-in through their longer names.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Entity Collections] --> B[UniqueEntityEquivalentArray&LTT,N>]
</span><span>    A --> C[UniqueEntityEquivalentSlice&LTT>]
</span><span>    A --> D[UniqueEntityEquivalentVec&LTT>]
</span><span>    B --> E[UniqueEntityArray&LTN>]
</span><span>    C --> F[UniqueEntitySlice]
</span><span>    D --> G[UniqueEntityVec]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-entity-unique-array-rs><code>crates/bevy_ecs/src/entity/unique_array.rs</code></h3><p><strong>Change</strong>: Renamed base type and adjusted generics order<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UniqueEntityArray</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> EntityEquivalent, </span><span style=color:#fa6e32>const</span><span> N</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>>([T; N])</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UniqueEntityEquivalentArray</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> EntityEquivalent, </span><span style=color:#fa6e32>const</span><span> N</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>>([T; N])</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub type </span><span style=color:#399ee6>UniqueEntityArray</span><span style=color:#ed9366><</span><span style=color:#fa6e32>const</span><span> N</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span style=color:#ed9366>> = </span><span>UniqueEntityEquivalentArray&LTEntity, N></span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Purpose</strong>: Establishes proper generics ordering for arrays while maintaining common case<h3 id=crates-bevy-ecs-src-entity-unique-slice-rs><code>crates/bevy_ecs/src/entity/unique_slice.rs</code></h3><p><strong>Change</strong>: Restructured slice type hierarchy<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UniqueEntitySlice</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> EntityEquivalent>([T])</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UniqueEntityEquivalentSlice</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> EntityEquivalent>([T])</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub type </span><span style=color:#399ee6>UniqueEntitySlice </span><span style=color:#ed9366>= </span><span>UniqueEntityEquivalentSlice&LTEntity></span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Impact</strong>: Aligns slice types with new naming convention<h3 id=crates-bevy-ecs-src-query-par-iter-rs><code>crates/bevy_ecs/src/query/par_iter.rs</code></h3><p><strong>Change</strong>: Updated type references in parallel iteration<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use super</span><span style=color:#ed9366>::</span><span>{Entity</span><span style=color:#61676ccc>,</span><span> UniqueEntityVec}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use super</span><span style=color:#ed9366>::</span><span>{Entity</span><span style=color:#61676ccc>,</span><span> UniqueEntityEquivalentVec}</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Reason</strong>: Maintains type consistency across query systems<h3 id=crates-bevy-ecs-src-entity-mod-rs><code>crates/bevy_ecs/src/entity/mod.rs</code></h3><p><strong>Change</strong>: Re-exported aliases<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added exports:
</span><span style=color:#fa6e32>pub use </span><span>unique_array</span><span style=color:#ed9366>::</span><span>UniqueEntityArray</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>unique_slice</span><span style=color:#ed9366>::</span><span>UniqueEntitySlice</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub use </span><span>unique_vec</span><span style=color:#ed9366>::</span><span>UniqueEntityVec</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Purpose</strong>: Preserves existing public API while exposing new types<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/rust-lang/rfcs/blob/master/text/2338-type-alias-enum-variants.md target=_blank>Rust Type Aliases RFC</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/next/ecs/entities/ target=_blank>Bevy ECS Entities Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/naming.html#generic-type-parameters-are-ordered-by-increasing-restriction-c-generic target=_blank>Generic Type Parameter Ordering Best Practices</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-04/pr_18695.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>