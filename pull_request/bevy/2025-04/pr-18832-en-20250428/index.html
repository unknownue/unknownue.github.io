<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18832 Fixes #15389, added docs to RawHandleWrapper::_window field
        
    </title><meta content="#18832 Fixes #15389, added docs to RawHandleWrapper::_window field" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-04/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-04-28</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-04/pr-18832-zh-cn-20250428>中文</a></div></div><div class=pr-content><h1 id=fixes-15389-added-docs-to-rawhandlewrapper-window-field>Fixes #15389, added docs to RawHandleWrapper::_window field</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fixes #15389, added docs to RawHandleWrapper::_window field<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18832<li><strong>Author</strong>: mhsalem36<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-Windowing, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-04-13T20:12:41Z<li><strong>Merged</strong>: 2025-04-28T22:06:04Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes https://github.com/bevyengine/bevy/issues/15389.<li>Add documentation for RawHandleWrapper::_window field since It’s needed to drop the window at the correct time.</ul><h2 id=solution>Solution</h2><ul><li>Added documentation to RawHandleWrapper::_window field as same as WindowWrapper documentation.</ul><h2 id=testing>Testing</h2><ul><li>No testing needed since it is documentation.</ul><hr><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a documentation gap in Bevy’s window handling system. The core issue (#15389) stemmed from missing documentation for the <code>RawHandleWrapper::_window</code> field, which could lead to maintenance challenges and potential misuse of the API.<p>In Bevy’s architecture, <code>RawHandleWrapper</code> serves as a critical bridge between platform-specific window handles and Bevy’s cross-platform rendering system. The <code>_window</code> field uses an <code>Arc&LTdyn Any + Send + Sync></code> to maintain a reference-counted pointer to the underlying window object. This ensures the window remains alive while any rendering frames might still be using it, particularly important in pipelined rendering scenarios where multiple frames can be in flight simultaneously.<p>Before this change, the field’s purpose was unclear:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RawHandleWrapper </span><span>{
</span><span>    _window</span><span style=color:#61676ccc>: </span><span>Arc&LTdyn Any </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Sync</span><span>>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><p>The lack of documentation created several risks:<ol><li>Developers might remove the field thinking it’s unused<li>Future modifications could break implicit lifetime dependencies<li>New contributors would lack context about its role in resource management</ol><p>The solution adopted the documentation pattern from the related <code>WindowWrapper</code> struct, ensuring consistency across similar components. The added comments explicitly state:<ul><li>The field’s purpose in lifetime management<li>Its critical role in pipelined rendering<li>The consequences of premature window dropping</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RawHandleWrapper </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// A shared reference to the window.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// This allows us to extend the lifetime of the window,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// so it doesn’t get eagerly dropped while a pipelined
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// renderer still has frames in flight that need to draw to it.
</span><span>    _window</span><span style=color:#61676ccc>: </span><span>Arc&LTdyn Any </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Sync</span><span>>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><p>This change improves the codebase by:<ol><li>Making implicit lifetime management explicit<li>Documenting thread safety considerations (Send + Sync)<li>Clarifying the relationship between window handles and rendering pipelines</ol><p>The choice to mirror <code>WindowWrapper</code>’s documentation ensures architectural consistency and reduces cognitive load for developers working with both components.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[RawHandleWrapper] --> B[Arc&LTWindow>]
</span><span>    B --> C[Window Resources]
</span><span>    A --> D[RawWindowHandle]
</span><span>    D --> E[Platform-Specific Implementation]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-window-src-raw-handle-rs-4-0><code>crates/bevy_window/src/raw_handle.rs</code> (+4/-0)</h3><p><strong>Change:</strong> Added documentation to <code>_window</code> field in <code>RawHandleWrapper</code> struct<p>Before:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RawHandleWrapper </span><span>{
</span><span>    _window</span><span style=color:#61676ccc>: </span><span>Arc&LTdyn Any </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Sync</span><span>>,
</span><span>    window_handle</span><span style=color:#61676ccc>:</span><span> RawWindowHandle,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><p>After:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RawHandleWrapper </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// A shared reference to the window.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// This allows us to extend the lifetime of the window,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// so it doesn’t get eagerly dropped while a pipelined
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// renderer still has frames in flight that need to draw to it.
</span><span>    _window</span><span style=color:#61676ccc>: </span><span>Arc&LTdyn Any </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Sync</span><span>>,
</span><span>    window_handle</span><span style=color:#61676ccc>:</span><span> RawWindowHandle,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><p>This change directly addresses the documentation gap while maintaining existing functionality. The comments explain:<ul><li>The use of <code>Arc</code> for lifetime management<li>Coordination with the rendering pipeline<li>Safety implications of the <code>Send + Sync</code> bounds</ul><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/sync/struct.Arc.html target=_blank>Rust Arc Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/rfcs/blob/main/rfcs/45-rendering-pipelines.md target=_blank>Bevy Pipelined Rendering RFC</a><li><a rel="noopener nofollow noreferrer" href=https://gamedev.stackexchange.com/questions/200279/windowing-abstraction-layer-design target=_blank>Cross-Platform Window Handling in Game Engines</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-04/pr_18832.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>