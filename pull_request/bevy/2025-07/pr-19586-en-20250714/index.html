<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19586 Robust Scrolling Example
        
    </title><meta content="#19586 Robust Scrolling Example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-14</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-19586-zh-cn-20250714>中文</a></div></div><div class=pr-content><h2 id=robust-scrolling-example-technical-analysis>Robust Scrolling Example: Technical Analysis</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Robust Scrolling Example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19586<li><strong>Author</strong>: tim-blackbird<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, A-UI, S-Ready-For-Final-Review, X-Uncontroversial<li><strong>Created</strong>: 2025-06-11T18:33:11Z<li><strong>Merged</strong>: 2025-07-14T20:43:01Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><p><strong>Objective</strong><br> A more robust scrolling example that doesn’t require <code>Pickable { should_block_lower: false, .. }</code> or <code>Pickable::IGNORE</code>, and properly handles nested scrolling nodes.<p>The current example shows nested scrolling, but this is only functional because the parent scrolls along a different axis than the children.<p><strong>Solution</strong><br> Instead of only scrolling the top node that is found in the <code>HoverMap</code> we trigger the <code>OnScroll</code> event on it.<br> This event then propagates up the hierarchy until any scrolling node that has room to scroll along that axis consumes the event.<p>The now redundant <code>Pickable</code> components were removed from the example.<br> The “Nested Scrolling Lists” portion was adjusted to show the new reliable nested scrolling.<p><strong>Testing</strong><br> Check out the example. It should work just as it did before.<hr><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><h4 id=the-problem-and-context>The Problem and Context</h4><p>The existing scrolling example had two significant limitations in its UI scrolling implementation. First, it required manual configuration of <code>Pickable</code> components with <code>should_block_lower: false</code> to enable nested scrolling behavior. This workaround was necessary because the original implementation directly modified scroll positions without proper event propagation. Second, the nested scrolling demonstration only functioned correctly when parent and child containers scrolled along different axes (horizontal vs vertical), failing to demonstrate true bidirectional nested scrolling.<p>These limitations stemmed from the direct modification approach in <code>update_scroll_position</code>, which:<ol><li>Applied scroll delta to all hovered entities simultaneously<li>Lacked hierarchical propagation logic<li>Didn’t respect scroll boundaries or overflow constraints</ol><h4 id=the-solution-approach>The Solution Approach</h4><p>The PR introduces an event-driven approach using a custom <code>Scroll</code> event with automatic propagation. Key design decisions:<ol><li>Replace direct component modification with event propagation<li>Implement scroll delta consumption at each node<li>Remove all <code>Pickable</code> workarounds from the example<li>Demonstrate true bidirectional nested scrolling</ol><p>The solution leverages Bevy’s entity event system with <code>auto_propagate</code> and <code>traversal = &'static ChildOf</code> to automatically propagate scroll events through the UI hierarchy.<h4 id=the-implementation>The Implementation</h4><p>The core changes involve:<ol><li>Creating a new <code>Scroll</code> event type<li>Implementing event propagation logic<li>Replacing the direct modification system with event handlers</ol><p>The <code>on_scroll_handler</code> system contains the scroll logic:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_scroll_handler</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>trigger</span><span style=color:#61676ccc>: </span><span>On&LTScroll>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ScrollPosition, </span><span style=color:#ed9366>&</span><span>Node, </span><span style=color:#ed9366>&</span><span>ComputedNode)>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> target </span><span style=color:#ed9366>=</span><span> trigger</span><span style=color:#ed9366>.</span><span style=color:#f07171>target</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> delta </span><span style=color:#ed9366>= &</span><span style=color:#fa6e32>mut</span><span> trigger</span><span style=color:#ed9366>.</span><span style=color:#f07171>event_mut</span><span>()</span><span style=color:#ed9366>.</span><span>delta</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((</span><span style=color:#fa6e32>mut</span><span> scroll_position</span><span style=color:#61676ccc>,</span><span> node</span><span style=color:#61676ccc>,</span><span> computed)) </span><span style=color:#ed9366>=</span><span> query</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(target) </span><span style=color:#fa6e32>else </span><span>{
</span><span>        </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>;
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let</span><span> max_offset </span><span style=color:#ed9366>= </span><span>(computed</span><span style=color:#ed9366>.</span><span style=color:#f07171>content_size</span><span>() </span><span style=color:#ed9366>-</span><span> computed</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()) </span><span style=color:#ed9366>*</span><span> computed</span><span style=color:#ed9366>.</span><span style=color:#f07171>inverse_scale_factor</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>if</span><span> node</span><span style=color:#ed9366>.</span><span>overflow</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>== </span><span>OverflowAxis</span><span style=color:#ed9366>::</span><span>Scroll </span><span style=color:#ed9366>&&</span><span> delta</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>!= </span><span style=color:#ff8f40>0. </span><span>{
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Scroll logic for X axis
</span><span>        </span><span style=color:#fa6e32>let</span><span> max </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> delta</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>> </span><span style=color:#ff8f40>0. </span><span>{
</span><span>            scroll_position</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>>=</span><span> max_offset</span><span style=color:#ed9366>.</span><span>x
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            scroll_position</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366><= </span><span style=color:#ff8f40>0.
</span><span>        }</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#ed9366>!</span><span>max {
</span><span>            scroll_position</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>+=</span><span> delta</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>;
</span><span>            delta</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0.</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Consume X delta
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Similar logic for Y axis
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><p>Key aspects:<ol><li>Calculates maximum scroll offset based on content size<li>Checks scroll boundaries before applying delta<li>Consumes scroll delta when applied<li>Stops propagation when delta is fully consumed</ol><h4 id=technical-insights>Technical Insights</h4><p>The propagation mechanism uses Bevy’s entity event system with <code>auto_propagate</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Event</span><span style=color:#61676ccc>,</span><span> EntityEvent</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>entity_event</span><span>(auto_propagate</span><span style=color:#61676ccc>,</span><span> traversal </span><span style=color:#ed9366>=</span><span> &'static ChildOf)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Scroll </span><span>{
</span><span>    delta</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>}
</span></code></pre><p>This configuration automatically propagates the event from child to parent entities. The handler consumes portions of the scroll delta at each node, allowing:<ol><li>Inner scroll containers to handle scrolling first<li>Unconsumed delta to propagate to parent containers<li>Natural handling of nested scroll areas regardless of axis</ol><h4 id=the-impact>The Impact</h4><p>These changes provide:<ol><li>Proper nested scrolling without workarounds<li>Removal of all <code>Pickable</code> configuration from the example<li>True bidirectional nested scrolling demonstration<li>More robust scrolling behavior respecting boundaries</ol><p>The example now demonstrates proper UI scrolling patterns that can be used as a reference implementation. The event-driven approach aligns better with Bevy’s ECS architecture and provides a foundation for more complex scrolling behaviors.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[MouseWheel Event] --> B[send_scroll_events]
</span><span>    B --> C[Trigger Scroll Event]
</span><span>    C --> D[on_scroll_handler]
</span><span>    D --> E{Can scroll?}
</span><span>    E -->|Yes| F[Update ScrollPosition]
</span><span>    E -->|No| G[Propagate to Parent]
</span><span>    F --> H[Consume Delta]
</span><span>    G --> D
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><h4 id=examples-ui-scroll-rs-98-71><code>examples/ui/scroll.rs</code> (+98/-71)</h4><p>This file contains the scrolling example. Changes include:<ol><li>Replacement of direct scroll modification with event system<li>Removal of all <code>Pickable</code> workarounds<li>Improved nested scrolling demonstration</ol><p>Key modifications:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Direct scroll modification system
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_scroll_position</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>mouse_wheel_events</span><span style=color:#61676ccc>: </span><span>EventReader&LTMouseWheel>,
</span><span>    </span><span style=color:#ff8f40>hover_map</span><span style=color:#61676ccc>: </span><span>Res&LTHoverMap>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>scrolled_node_query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ScrollPosition>,
</span><span>    </span><span style=color:#ff8f40>keyboard_input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKeyCode>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... direct scroll position modification
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Event-driven approach
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>send_scroll_events</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>mouse_wheel_events</span><span style=color:#61676ccc>: </span><span>EventReader&LTMouseWheel>,
</span><span>    </span><span style=color:#ff8f40>hover_map</span><span style=color:#61676ccc>: </span><span>Res&LTHoverMap>,
</span><span>    </span><span style=color:#ff8f40>keyboard_input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKeyCode>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... triggers Scroll events
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Event</span><span style=color:#61676ccc>,</span><span> EntityEvent</span><span style=color:#61676ccc>,</span><span> Debug)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>entity_event</span><span>(auto_propagate</span><span style=color:#61676ccc>,</span><span> traversal </span><span style=color:#ed9366>=</span><span> &'static ChildOf)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Scroll </span><span>{
</span><span>    delta</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>on_scroll_handler</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>trigger</span><span style=color:#61676ccc>: </span><span>On&LTScroll>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ScrollPosition, </span><span style=color:#ed9366>&</span><span>Node, </span><span style=color:#ed9366>&</span><span>ComputedNode)>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... handles scroll with propagation
</span><span>}
</span></code></pre><p>Nested scrolling example improvement:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Different axes with Pickable workaround
</span><span>(
</span><span>    Node {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... 
</span><span>        overflow</span><span style=color:#61676ccc>: </span><span>Overflow</span><span style=color:#ed9366>::</span><span>scroll_x()</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// Different axis
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    Pickable { should_block_lower</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>.. </span><span>}
</span><span>)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Bidirectional with proper propagation
</span><span>(
</span><span>    Node {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        overflow</span><span style=color:#61676ccc>: </span><span>Overflow</span><span style=color:#ed9366>::</span><span>scroll()</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// Same axis
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// No Pickable component
</span><span>)
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/ui/ target=_blank>Bevy UI Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/events/ target=_blank>Bevy Events System</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/rfcs/blob/main/rfcs/45-entity-events.md target=_blank>Entity Events RFC</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_ui/src/overflow.rs target=_blank>UI Overflow Handling</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_19586.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>