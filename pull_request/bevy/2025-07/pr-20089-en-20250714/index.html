<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20089 Port the physics in fixed timestep example to 3D
        
    </title><meta content="#20089 Port the physics in fixed timestep example to 3D" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-14</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20089-zh-cn-20250714>中文</a></div></div><div class=pr-content><h2 id=port-the-physics-in-fixed-timestep-example-to-3d>Port the physics in fixed timestep example to 3D</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Port the physics in fixed timestep example to 3D<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20089<li><strong>Author</strong>: janhohenheim<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Examples, S-Ready-For-Final-Review, A-Physics, A-Time, D-Straightforward, M-Deliberate-Rendering-Change<li><strong>Created</strong>: 2025-07-11T18:43:38Z<li><strong>Merged</strong>: 2025-07-14T22:03:42Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><h1 id=objective>Objective</h1><p>Since I originally wrote this example, many people on Discord have asked me specifically how to handle camera movement in and around fixed timesteps. I had to write that information up maaaany times, so I believe this is an area where the example falls short of.<h2 id=solution>Solution</h2><p>Let’s port the example to 3D, where we can better showcase how to handle the camera. The knowledge is trivially transferable to 2D :) Also, we don’t need to average out continuous input. Just using the last one is fine in practice. Still, we need to keep around the <code>AccumulatedInput</code> resource for things like jumping.<h2 id=testing>Testing</h2><p>https://github.com/user-attachments/assets/c1306d36-1f94-43b6-b8f6-af1cbb622698<h2 id=notes>Notes</h2><ul><li>The current implementation is extremely faithful to how it will look like in practice when writing a 3D game using e.g. Avian. With the exception that Avian does the part with the actual physics of course<li>I’d love to showcase how to map sequences of inputs to fixed updates, but winit does not export timestamps<li>I’d also like to showcase instantaneous inputs like activating a boost or shooting a laser, but that would make the example even bigger<li>Not locking the cursor because doing so correctly on Wasm in the current Bevy version is not trivial at all</ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>This PR addresses a practical gap in Bevy’s fixed timestep example. While the original 2D implementation demonstrated basic physics synchronization, it didn’t adequately show how to handle camera movement within a fixed timestep architecture - a common pain point reported by users. The author recognized that 3D provides a clearer context for demonstrating camera/physics interactions.<p>The solution ports the fixed timestep physics example from 2D to 3D while enhancing the camera implementation. Key changes include:<ol><li><strong>Camera rotation handling</strong>: Added mouse input processing to rotate the camera before physics calculations. This ensures player movement direction aligns with camera orientation:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>rotate_camera</span><span>(
</span><span>    </span><span style=color:#ff8f40>accumulated_mouse_motion</span><span style=color:#61676ccc>: </span><span>Res&LTAccumulatedMouseMotion>,
</span><span>    </span><span style=color:#ff8f40>player</span><span style=color:#61676ccc>: </span><span>Single<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform, </span><span style=color:#ed9366>&</span><span>CameraSensitivity), With&LTCamera>>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let </span><span>(</span><span style=color:#fa6e32>mut</span><span> transform</span><span style=color:#61676ccc>,</span><span> camera_sensitivity) </span><span style=color:#ed9366>=</span><span> player</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_inner</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> delta </span><span style=color:#ed9366>=</span><span> accumulated_mouse_motion</span><span style=color:#ed9366>.</span><span>delta</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>if</span><span> delta </span><span style=color:#ed9366>!= </span><span>Vec2</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO </span><span>{
</span><span>        </span><span style=color:#fa6e32>let</span><span> delta_yaw </span><span style=color:#ed9366>= -</span><span>delta</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>*</span><span> camera_sensitivity</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> delta_pitch </span><span style=color:#ed9366>= -</span><span>delta</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>*</span><span> camera_sensitivity</span><span style=color:#ed9366>.</span><span>y</span><span style=color:#61676ccc>;
</span><span>        
</span><span>        </span><span style=color:#fa6e32>let </span><span>(yaw</span><span style=color:#61676ccc>,</span><span> pitch</span><span style=color:#61676ccc>,</span><span> roll) </span><span style=color:#ed9366>=</span><span> transform</span><span style=color:#ed9366>.</span><span>rotation</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_euler</span><span>(EulerRot</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>YXZ</span><span>)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> yaw </span><span style=color:#ed9366>=</span><span> yaw </span><span style=color:#ed9366>+</span><span> delta_yaw</span><span style=color:#61676ccc>;
</span><span>        
</span><span>        </span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>PITCH_LIMIT</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>FRAC_PI_2 </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>0.01</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> pitch </span><span style=color:#ed9366>= </span><span>(pitch </span><span style=color:#ed9366>+</span><span> delta_pitch)</span><span style=color:#ed9366>.</span><span style=color:#f07171>clamp</span><span>(</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>PITCH_LIMIT</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>PITCH_LIMIT</span><span>)</span><span style=color:#61676ccc>;
</span><span>        
</span><span>        transform</span><span style=color:#ed9366>.</span><span>rotation </span><span style=color:#ed9366>= </span><span>Quat</span><span style=color:#ed9366>::</span><span>from_euler(EulerRot</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>YXZ</span><span style=color:#61676ccc>,</span><span> yaw</span><span style=color:#61676ccc>,</span><span> pitch</span><span style=color:#61676ccc>,</span><span> roll)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><ol start=2><li><strong>Input handling redesign</strong>: Simplified from averaging to last-input sampling and restructured to support 3D movement relative to camera orientation:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>accumulate_input</span><span>(
</span><span>    </span><span style=color:#ff8f40>keyboard_input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKeyCode>>,
</span><span>    </span><span style=color:#ff8f40>player</span><span style=color:#61676ccc>: </span><span>Single<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> AccumulatedInput, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Velocity)>,
</span><span>    </span><span style=color:#ff8f40>camera</span><span style=color:#61676ccc>: </span><span>Single<</span><span style=color:#ed9366>&</span><span>Transform, With&LTCamera>>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>SPEED</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>4.0</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let </span><span>(</span><span style=color:#fa6e32>mut</span><span> input</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut</span><span> velocity) </span><span style=color:#ed9366>=</span><span> player</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_inner</span><span>()</span><span style=color:#61676ccc>;
</span><span>    input</span><span style=color:#ed9366>.</span><span>movement </span><span style=color:#ed9366>= </span><span>Vec2</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Read keyboard input
</span><span>    </span><span style=color:#fa6e32>if</span><span> keyboard_input</span><span style=color:#ed9366>.</span><span style=color:#f07171>pressed</span><span>(KeyCode</span><span style=color:#ed9366>::</span><span>KeyW) { input</span><span style=color:#ed9366>.</span><span>movement</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>+= </span><span style=color:#ff8f40>1.0 </span><span>}
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other keys
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Convert to 3D and rotate by camera
</span><span>    </span><span style=color:#fa6e32>let</span><span> input_3d </span><span style=color:#ed9366>=</span><span> Vec3 { x</span><span style=color:#61676ccc>:</span><span> input</span><span style=color:#ed9366>.</span><span>movement</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>,</span><span> y</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,</span><span> z</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>-</span><span>input</span><span style=color:#ed9366>.</span><span>movement</span><span style=color:#ed9366>.</span><span>y }</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> rotated_input </span><span style=color:#ed9366>=</span><span> camera</span><span style=color:#ed9366>.</span><span>rotation </span><span style=color:#ed9366>*</span><span> input_3d</span><span style=color:#61676ccc>;
</span><span>    velocity</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>=</span><span> rotated_input</span><span style=color:#ed9366>.</span><span style=color:#f07171>clamp_length_max</span><span>(</span><span style=color:#ff8f40>1.0</span><span>) </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>SPEED</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=3><li><p><strong>Schedule reorganization</strong>: Added explicit timing control for camera operations using Bevy’s <code>RunFixedMainLoop</code> schedule:</p> <ul><li>Camera rotation runs in <code>BeforeFixedMainLoop</code> so physics uses current orientation<li>Camera translation runs in <code>AfterFixedMainLoop</code> using interpolated player position</ul><li><p><strong>New timing flag</strong>: Introduced <code>DidFixedTimestepRunThisFrame</code> resource to conditionally clear input only when physics actually executed:</p></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Deref</span><span style=color:#61676ccc>,</span><span> DerefMut</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DidFixedTimestepRunThisFrame</span><span>(</span><span style=color:#fa6e32>bool</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>clear_fixed_timestep_flag</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>flag</span><span style=color:#61676ccc>: </span><span>ResMut&LTDidFixedTimestepRunThisFrame>) {
</span><span>    flag</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>set_fixed_time_step_flag</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>flag</span><span style=color:#61676ccc>: </span><span>ResMut&LTDidFixedTimestepRunThisFrame>) {
</span><span>    flag</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The implementation maintains the core fixed timestep architecture while demonstrating practical patterns:<ul><li>Physics runs exclusively in <code>FixedUpdate</code><li>Camera rotation precedes physics to ensure correct movement direction<li>Camera translation follows physics interpolation for smooth visuals<li>Input handling is decoupled from physics execution timing</ul><p>These changes provide a more realistic reference for game developers implementing camera controls in fixed timestep games. The 3D context better illustrates directional movement relative to camera orientation, and the explicit scheduling demonstrates how to coordinate camera updates with physics simulation.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[PreUpdate] --> B[Clear fixed timestep flag]
</span><span>    B --> C[RunFixedMainLoop]
</span><span>    C --> D[BeforeFixedMainLoop]
</span><span>    D --> E[Rotate Camera]
</span><span>    D --> F[Accumulate Input]
</span><span>    C --> G[FixedUpdate]
</span><span>    G --> H[Advance Physics]
</span><span>    G --> I[Set fixed timestep flag]
</span><span>    C --> J[AfterFixedMainLoop]
</span><span>    J --> K[Clear Input]
</span><span>    J --> L[Interpolate Transform]
</span><span>    J --> M[Translate Camera]
</span><span>    M --> N[Update]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><ul><li><code>examples/movement/physics_in_fixed_timestep.rs</code> (+234/-60)</ul><h4 id=before-partial>Before (partial):</h4><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>handle_input</span><span>(
</span><span>    </span><span style=color:#ff8f40>keyboard_input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKeyCode>>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> AccumulatedInput, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Velocity)>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>SPEED</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>210.0</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>for </span><span>(</span><span style=color:#fa6e32>mut</span><span> input</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut</span><span> velocity) </span><span style=color:#ed9366>in</span><span> query</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter_mut</span><span>() {
</span><span>        </span><span style=color:#fa6e32>if</span><span> keyboard_input</span><span style=color:#ed9366>.</span><span style=color:#f07171>pressed</span><span>(KeyCode</span><span style=color:#ed9366>::</span><span>KeyW) { input</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>+= </span><span style=color:#ff8f40>1.0 </span><span>}
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other keys
</span><span>        velocity</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>=</span><span> input</span><span style=color:#ed9366>.</span><span style=color:#f07171>extend</span><span>(</span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>normalize_or_zero</span><span>() </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>SPEED</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>spawn_player</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands, </span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>) {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Camera2d)</span><span style=color:#61676ccc>;
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Sprite</span><span style=color:#ed9366>::</span><span>from_image(asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"branding/icon.png"</span><span>))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h4 id=after-partial>After (partial):</h4><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>accumulate_input</span><span>(
</span><span>    </span><span style=color:#ff8f40>keyboard_input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKeyCode>>,
</span><span>    </span><span style=color:#ff8f40>player</span><span style=color:#61676ccc>: </span><span>Single<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> AccumulatedInput, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Velocity)>,
</span><span>    </span><span style=color:#ff8f40>camera</span><span style=color:#61676ccc>: </span><span>Single<</span><span style=color:#ed9366>&</span><span>Transform, With&LTCamera>>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>const </span><span style=color:#ff8f40>SPEED</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>4.0</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let </span><span>(</span><span style=color:#fa6e32>mut</span><span> input</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut</span><span> velocity) </span><span style=color:#ed9366>=</span><span> player</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_inner</span><span>()</span><span style=color:#61676ccc>;
</span><span>    input</span><span style=color:#ed9366>.</span><span>movement </span><span style=color:#ed9366>= </span><span>Vec2</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Read keys...
</span><span>    </span><span style=color:#fa6e32>let</span><span> input_3d </span><span style=color:#ed9366>=</span><span> Vec3 { x</span><span style=color:#61676ccc>:</span><span> input</span><span style=color:#ed9366>.</span><span>movement</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>,</span><span> y</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>,</span><span> z</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>-</span><span>input</span><span style=color:#ed9366>.</span><span>movement</span><span style=color:#ed9366>.</span><span>y }</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> rotated_input </span><span style=color:#ed9366>=</span><span> camera</span><span style=color:#ed9366>.</span><span>rotation </span><span style=color:#ed9366>*</span><span> input_3d</span><span style=color:#61676ccc>;
</span><span>    velocity</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>=</span><span> rotated_input</span><span style=color:#ed9366>.</span><span style=color:#f07171>clamp_length_max</span><span>(</span><span style=color:#ff8f40>1.0</span><span>) </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>SPEED</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>spawn_player</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands) {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((Camera3d</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>, </span><span>CameraSensitivity</span><span style=color:#ed9366>::</span><span>default()))</span><span style=color:#61676ccc>;
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Transform</span><span style=color:#ed9366>::</span><span>from_scale(Vec3</span><span style=color:#ed9366>::</span><span>splat(</span><span style=color:#ff8f40>0.3</span><span>))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The changes transform the example from 2D to 3D, add camera controls, and refine the input handling to demonstrate practical fixed timestep implementation patterns. The physics core remains intact while the camera systems demonstrate how to coordinate variable-rate rendering with fixed-rate simulation.<h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/core/struct.FixedTime.html target=_blank>Bevy Fixed Timestep Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://gameprogrammingpatterns.com/game-loop.html target=_blank>Game Loop Patterns</a><li><a rel="noopener nofollow noreferrer" href=https://www.toptal.com/game/video-game-physics-part-ii-collision-detection-for-solid-objects target=_blank>Camera Controls in Game Physics</a><li><a rel="noopener nofollow noreferrer" href=https://gafferongames.com/post/fix_your_timestep/#the-final-touch target=_blank>Input Handling in Fixed Timestep</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20089.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>