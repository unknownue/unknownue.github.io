<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18983 UI render graph setup refactor
        
    </title><meta content="#18983 UI render graph setup refactor" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-21</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-18983-zh-cn-20250721>中文</a></div></div><div class=pr-content><h2 id=ui-render-graph-setup-refactor-optimizing-bevy-s-ui-rendering-initialization>UI render Graph Setup Refactor: Optimizing Bevy’s UI Rendering Initialization</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: UI render graph setup refactor<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18983<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Rendering, A-UI, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-04-29T15:30:07Z<li><strong>Merged</strong>: 2025-07-21T22:38:59Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><p>The original description is in English and remains unchanged:<h1 id=objective>Objective</h1><ul><li>The <code>get_ui_graph</code> function in bevy_ui’s render module is misnamed. It doesn’t get the graph, it creates a new one.<li><code>get_ui_graph</code> shouldn’t be called until after we’ve retrieved each subgraph, otherwise the new UI graph is created for nothing.</ul><h2 id=solution>Solution</h2><ul><li>Rename <code>get_ui_graph</code> to <code>new_ui_graph</code><li>Call <code>new_ui_graph</code> only after each subgraph is successful retrieved from the render graph.</ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p><strong>The Problem and Context</strong><br> In Bevy’s UI rendering system, the <code>get_ui_graph</code> function was poorly named and inefficiently used. Despite its name suggesting it retrieves an existing graph, it actually creates a new UI render graph from scratch. This naming mismatch could confuse developers maintaining the code. More importantly, the function was being called unconditionally before checking if the target subgraphs (Core2d and Core3d) existed in the render graph. This meant UI graphs were always created, even when they wouldn’t be used - a wasteful operation especially in configurations where either 2D or 3D rendering might be disabled.<p><strong>The Solution Approach</strong><br> The solution required two coordinated changes: First, renaming the function to accurately reflect its purpose (creation rather than retrieval). Second, restructuring the render graph initialization logic to only create UI graphs when they’re actually needed. This involved moving the graph creation inside the conditional blocks that check for the existence of the Core2d/Core3d subgraphs. The <code>resource_scope</code> method was leveraged to safely manage mutable access to the render graph resource while creating the UI subgraphs.<p><strong>The Implementation</strong><br> The implementation centered around two key modifications to <code>crates/bevy_ui_render/src/lib.rs</code>:<ol><li><strong>Function Renaming</strong>: The misnamed <code>get_ui_graph</code> was changed to <code>new_ui_graph</code> throughout:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>get_ui_graph</span><span>(</span><span style=color:#ff8f40>render_app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> SubApp) </span><span style=color:#61676ccc>-></span><span> RenderGraph { </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>new_ui_graph</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-></span><span> RenderGraph { </span><span style=color:#ed9366>... </span><span>}
</span></code></pre><ol start=2><li><strong>Conditional Graph Creation</strong>: The render graph setup was refactored to:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>resource_scope</span><span>(|</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>graph</span><span style=color:#61676ccc>: </span><span>Mut&LTRenderGraph>| {
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(graph_2d) </span><span style=color:#ed9366>=</span><span> graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_graph_mut</span><span>(Core2d) {
</span><span>        </span><span style=color:#fa6e32>let</span><span> ui_graph_2d </span><span style=color:#ed9366>= </span><span style=color:#f07171>new_ui_graph</span><span>(world)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Add to Core2d subgraph
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(graph_3d) </span><span style=color:#ed9366>=</span><span> graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_graph_mut</span><span>(Core3d) {
</span><span>        </span><span style=color:#fa6e32>let</span><span> ui_graph_3d </span><span style=color:#ed9366>= </span><span style=color:#f07171>new_ui_graph</span><span>(world)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Add to Core3d subgraph
</span><span>    }
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><p>This restructuring ensures UI graphs are only created after confirming their target subgraphs exist. The parameter type was changed from <code>&mut SubApp</code> to <code>&mut World</code> to match the available context within the resource scope.<p><strong>Technical Insights</strong><br> This change demonstrates several important patterns in Rust game engine development:<ol><li><strong>Resource Scoping</strong>: Using <code>resource_scope</code> ensures proper borrow checking when multiple resources need to be accessed<li><strong>Lazy Initialization</strong>: Creating resources only when they’re needed optimizes startup performance<li><strong>Accurate Naming</strong>: Precise function names (<code>new_ui_graph</code> vs <code>get_ui_graph</code>) prevent misunderstandings about resource ownership and creation</ol><p>The parameter change from <code>SubApp</code> to <code>World</code> reflects a more focused dependency - since only world access was needed, using the narrower interface follows Rust’s principle of requiring only necessary capabilities.<p><strong>The Impact</strong><br> These changes provide concrete benefits:<ol><li><strong>Performance Improvement</strong>: Eliminates unnecessary UI graph creation in configurations where either Core2d or Core3d subgraphs are absent<li><strong>Code Clarity</strong>: The renamed function immediately communicates its purpose to maintainers<li><strong>Resource Efficiency</strong>: Reduces memory allocations and setup time for unused render graphs<li><strong>Architectural Consistency</strong>: Aligns with Bevy’s patterns for conditional resource initialization</ol><h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    Plugin[UiRenderPlugin] --> Setup[Render Graph Setup]
</span><span>    Setup --> ResourceScope[Resource Scope Block]
</span><span>    ResourceScope --> Check2d{Core2d exists?}
</span><span>    Check2d -->|Yes| Create2d[Create UI Graph 2D]
</span><span>    ResourceScope --> Check3d{Core3d exists?}
</span><span>    Check3d -->|Yes| Create3d[Create UI Graph 3D]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><p><strong>File</strong>: <code>crates/bevy_ui_render/src/lib.rs</code><br> Changes focus on optimizing UI render graph initialization:<ol><li>Render graph setup refactored into resource scope block:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> ui_graph_2d </span><span style=color:#ed9366>= </span><span style=color:#f07171>get_ui_graph</span><span>(render_app)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> ui_graph_3d </span><span style=color:#ed9366>= </span><span style=color:#f07171>get_ui_graph</span><span>(render_app)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let mut</span><span> graph </span><span style=color:#ed9366>=</span><span> render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()</span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTRenderGraph>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(graph_2d) </span><span style=color:#ed9366>=</span><span> graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_graph_mut</span><span>(Core2d) {
</span><span>    graph_2d</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_sub_graph</span><span>(SubGraphUi</span><span style=color:#61676ccc>,</span><span> ui_graph_2d)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... rest of setup
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>resource_scope</span><span>(|</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>graph</span><span style=color:#61676ccc>: </span><span>Mut&LTRenderGraph>| {
</span><span>    </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(graph_2d) </span><span style=color:#ed9366>=</span><span> graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_graph_mut</span><span>(Core2d) {
</span><span>        </span><span style=color:#fa6e32>let</span><span> ui_graph_2d </span><span style=color:#ed9366>= </span><span style=color:#f07171>new_ui_graph</span><span>(world)</span><span style=color:#61676ccc>;
</span><span>        graph_2d</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_sub_graph</span><span>(SubGraphUi</span><span style=color:#61676ccc>,</span><span> ui_graph_2d)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... rest of setup
</span><span>    }
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Similar for Core3d
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li>Function renamed and signature updated:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>get_ui_graph</span><span>(</span><span style=color:#ff8f40>render_app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> SubApp) </span><span style=color:#61676ccc>-></span><span> RenderGraph {
</span><span>    </span><span style=color:#fa6e32>let</span><span> ui_pass_node </span><span style=color:#ed9366>= </span><span>UiPassNode</span><span style=color:#ed9366>::</span><span>new(render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>new_ui_graph</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-></span><span> RenderGraph {
</span><span>    </span><span style=color:#fa6e32>let</span><span> ui_pass_node </span><span style=color:#ed9366>= </span><span>UiPassNode</span><span style=color:#ed9366>::</span><span>new(world)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/rendering/#render-graph target=_blank>Bevy Render Graph Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/naming.html target=_blank>Rust API Guidelines on Naming</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/resources/ target=_blank>Resource Management in ECS</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/plugins_guidelines.md#app-vs-subapp target=_blank>Bevy SubApps Architecture</a></ol><h3 id=full-code-diff>Full Code Diff</h3><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ui_render/src/lib.rs b/crates/bevy_ui_render/src/lib.rs
</span><span>index 74617a726919d..f2d03b6f8b7da 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ui_render/src/lib.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ui_render/src/lib.rs
</span><span style=color:#c594c5>@@ -269,25 +269,27 @@ </span><span style=color:#399ee6>impl Plugin for UiRenderPlugin {
</span><span>             );
</span><span> 
</span><span>         // Render graph
</span><span style=color:#f07171>-        let ui_graph_2d = get_ui_graph(render_app);
</span><span style=color:#f07171>-        let ui_graph_3d = get_ui_graph(render_app);
</span><span style=color:#f07171>-        let mut graph = render_app.world_mut().resource_mut::&LTRenderGraph>();
</span><span style=color:#f07171>-
</span><span style=color:#f07171>-        if let Some(graph_2d) = graph.get_sub_graph_mut(Core2d) {
</span><span style=color:#f07171>-            graph_2d.add_sub_graph(SubGraphUi, ui_graph_2d);
</span><span style=color:#f07171>-            graph_2d.add_node(NodeUi::UiPass, RunUiSubgraphOnUiViewNode);
</span><span style=color:#f07171>-            graph_2d.add_node_edge(Node2d::EndMainPass, NodeUi::UiPass);
</span><span style=color:#f07171>-            graph_2d.add_node_edge(Node2d::EndMainPassPostProcessing, NodeUi::UiPass);
</span><span style=color:#f07171>-            graph_2d.add_node_edge(NodeUi::UiPass, Node2d::Upscaling);
</span><span style=color:#f07171>-        }
</span><span style=color:#86b300>+        render_app
</span><span style=color:#86b300>+            .world_mut()
</span><span style=color:#86b300>+            .resource_scope(|world, mut graph: Mut&LTRenderGraph>| {
</span><span style=color:#86b300>+                if let Some(graph_2d) = graph.get_sub_graph_mut(Core2d) {
</span><span style=color:#86b300>+                    let ui_graph_2d = new_ui_graph(world);
</span><span style=color:#86b300>+                    graph_2d.add_sub_graph(SubGraphUi, ui_graph_2d);
</span><span style=color:#86b300>+                    graph_2d.add_node(NodeUi::UiPass, RunUiSubgraphOnUiViewNode);
</span><span style=color:#86b300>+                    graph_2d.add_node_edge(Node2d::EndMainPass, NodeUi::UiPass);
</span><span style=color:#86b300>+                    graph_2d.add_node_edge(Node2d::EndMainPassPostProcessing, NodeUi::UiPass);
</span><span style=color:#86b300>+                    graph_2d.add_node_edge(NodeUi::UiPass, Node2d::Upscaling);
</span><span style=color:#86b300>+                }
</span><span> 
</span><span style=color:#f07171>-        if let Some(graph_3d) = graph.get_sub_graph_mut(Core3d) {
</span><span style=color:#f07171>-            graph_3d.add_sub_graph(SubGraphUi, ui_graph_3d);
</span><span style=color:#f07171>-            graph_3d.add_node(NodeUi::UiPass, RunUiSubgraphOnUiViewNode);
</span><span style=color:#f07171>-            graph_3d.add_node_edge(Node3d::EndMainPass, NodeUi::UiPass);
</span><span style=color:#f07171>-            graph_3d.add_node_edge(Node3d::EndMainPassPostProcessing, NodeUi::UiPass);
</span><span style=color:#f07171>-            graph_3d.add_node_edge(NodeUi::UiPass, Node3d::Upscaling);
</span><span style=color:#f07171>-        }
</span><span style=color:#86b300>+                if let Some(graph_3d) = graph.get_sub_graph_mut(Core3d) {
</span><span style=color:#86b300>+                    let ui_graph_3d = new_ui_graph(world);
</span><span style=color:#86b300>+                    graph_3d.add_sub_graph(SubGraphUi, ui_graph_3d);
</span><span style=color:#86b300>+                    graph_3d.add_node(NodeUi::UiPass, RunUiSubgraphOnUiViewNode);
</span><span style=color:#86b300>+                    graph_3d.add_node_edge(Node3d::EndMainPass, NodeUi::UiPass);
</span><span style=color:#86b300>+                    graph_3d.add_node_edge(Node3d::EndMainPassPostProcessing, NodeUi::UiPass);
</span><span style=color:#86b300>+                    graph_3d.add_node_edge(NodeUi::UiPass, Node3d::Upscaling);
</span><span style=color:#86b300>+                }
</span><span style=color:#86b300>+            });
</span><span> 
</span><span>         app.add_plugins(UiTextureSlicerPlugin);
</span><span>         app.add_plugins(GradientPlugin);
</span><span style=color:#c594c5>@@ -295,8 +297,8 @@ </span><span style=color:#399ee6>impl Plugin for UiRenderPlugin {
</span><span>     }
</span><span> }
</span><span> 
</span><span style=color:#f07171>-fn get_ui_graph(render_app: &mut SubApp) -> RenderGraph {
</span><span style=color:#f07171>-    let ui_pass_node = UiPassNode::new(render_app.world_mut());
</span><span style=color:#86b300>+fn new_ui_graph(world: &mut World) -> RenderGraph {
</span><span style=color:#86b300>+    let ui_pass_node = UiPassNode::new(world);
</span><span>     let mut ui_graph = RenderGraph::default();
</span><span>     ui_graph.add_node(NodeUi::UiPass, ui_pass_node);
</span><span>     ui_graph
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_18983.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>