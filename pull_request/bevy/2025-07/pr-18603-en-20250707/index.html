<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18603 Add comment to custom vertex attribute example to make it easier to convert to 2D
        
    </title><meta content="#18603 Add comment to custom vertex attribute example to make it easier to convert to 2D" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-18603-zh-cn-20250707>中文</a></div></div><div class=pr-content><h1 id=technical-analysis-add-comment-to-custom-vertex-attribute-example-to-make-it-easier-to-convert-to-2d>Technical Analysis: Add comment to custom vertex attribute example to make it easier to convert to 2D</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add comment to custom vertex attribute example to make it easier to convert to 2D<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18603<li><strong>Author</strong>: nickyfahey<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Examples, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-03-29T05:29:47Z<li><strong>Merged</strong>: 2025-07-07T19:47:36Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>It’s not clear what changes are needed to the shader to convert the example to 2D.<li>If you leave the shader unchanged you get a very confusing error (see linked issue).<li>Fixes #14077</ul><h2 id=solution>Solution</h2><p>A separate example probably isn’t needed as there is little difference between 3D and 2D, but a note saying what changes are needed to the shader would make it a lot easier.<p>Let me know if you think it is also worth adding some notes to the rust file, but it is mostly trivial changes such as changing <code>Mesh3d</code> to <code>Mesh2d</code>. I have left the original code in comments next to the changes in the gist linked at the bottom if you wish to compare.<h2 id=testing>Testing</h2><ul><li>I just spent a long time working it out the hard way. This would have made it a lot quicker.<li>I have tested the 2D version of the shader with the changes explained in the suggested comment and it works as expected.<li>For testing purposes <a rel="noopener nofollow noreferrer" href=https://gist.github.com/nickyfahey/647e2a2c45e695f24e288432b811dfc2 target=_blank>here is a complete working 2D example</a>. (note that as per the original example the shader file needs to go in ‘assets/shaders/’)</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a specific documentation gap in Bevy’s rendering examples. When users tried converting the custom vertex attribute example from 3D to 2D, they encountered confusing errors (#14077) because the shader code remained unchanged. The core issue was that Bevy uses different function imports and transformations for 2D versus 3D rendering, but this distinction wasn’t documented in the shader file itself.<p>Instead of duplicating the entire example for 2D, which would create maintenance overhead and code redundancy, the author opted for a minimal but effective solution: adding clear comments directly in the shader file. This approach leverages the fact that the structural differences between 2D and 3D implementations are small but critical. The solution focuses on the exact points where the shader needs modification—specifically, replacing the imported module and the position transformation function.<p>The implementation consists of just two comment lines at the top of the shader file. These comments precisely indicate:<ol><li>The replacement for the 3D module import (<code>bevy_pbr::mesh_functions</code> → <code>bevy_sprite::mesh2d_functions</code>)<li>The replacement for the position transformation function (<code>mesh_position_local_to_clip</code> → <code>mesh2d_position_local_to_clip</code>)</ol><p>This approach is efficient because it:<ul><li>Requires minimal code changes<li>Places documentation exactly where users need it<li>Avoids fragmenting examples<li>Maintains the existing example’s integrity while making adaptation straightforward</ul><p>The author validated the solution by creating a complete working 2D example and testing it end-to-end, confirming that the documented changes produce correct results. The change significantly reduces the trial-and-error process previously required to convert the example, addressing the original issue directly.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Custom Vertex Attribute Example] --> B[3D Version]
</span><span>    A --> C[2D Conversion]
</span><span>    B --> D[Shader with PBR functions]
</span><span>    C --> E[Modified Shader with Sprite2D functions]
</span><span>    D --> F[mesh_position_local_to_clip]
</span><span>    E --> G[mesh2d_position_local_to_clip]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=assets-shaders-custom-vertex-attribute-wgsl><code>assets/shaders/custom_vertex_attribute.wgsl</code></h3><p><strong>What changed</strong>: Added two comment lines at the top of the file<br> <strong>Why</strong>: To provide clear instructions for converting the shader from 3D to 2D<pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>// For 2d replace `bevy_pbr::mesh_functions` with `bevy_sprite::mesh2d_functions`
</span><span>// and `mesh_position_local_to_clip` with `mesh2d_position_local_to_clip`.
</span><span>#import bevy_pbr::mesh_functions::{get_world_from_local, mesh_position_local_to_clip}
</span><span>
</span><span>struct CustomMaterial {
</span></code></pre><p>The comments explicitly state the two required changes:<ol><li>Replace the import path from <code>bevy_pbr::mesh_functions</code> to <code>bevy_sprite::mesh2d_functions</code><li>Replace the function call from <code>mesh_position_local_to_clip</code> to <code>mesh2d_position_local_to_clip</code></ol><p>These two lines directly address the core confusion points when adapting the example, providing immediate guidance without altering the working 3D implementation.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/14077 target=_blank>Original issue #14077: Confusing error when using custom_vertex_attribute example in 2D</a><li><a rel="noopener nofollow noreferrer" href=https://gist.github.com/nickyfahey/647e2a2c45e695f24e288432b811dfc2 target=_blank>Complete working 2D example implementation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/docs/shader.md target=_blank>Bevy’s Shader Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_sprite/src target=_blank>Bevy’s Sprite2D Rendering System</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_18603.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>