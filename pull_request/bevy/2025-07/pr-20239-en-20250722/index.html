<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20239 fix branch name when installing rust in cache update action
        
    </title><meta content="#20239 fix branch name when installing rust in cache update action" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20239-zh-cn-20250722>中文</a></div></div><div class=pr-content><h1 id=analysis-of-pr-20239-fix-branch-name-when-installing-rust-in-cache-update-action>Analysis of PR #20239: fix branch name when installing rust in cache update action</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: fix branch name when installing rust in cache update action<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20239<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Build-System, S-Ready-For-Review<li><strong>Created</strong>: 2025-07-22T02:26:31Z<li><strong>Merged</strong>: 2025-07-22T03:04:13Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>the new cache action (#20144) is currently failing on the install rust step</ul><h2 id=solution>Solution</h2><ul><li>Use the correct branch name</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The GitHub Actions workflow for updating caches was failing during the Rust installation step after the introduction of a new cache action in PR #20144. The root cause was an incorrect branch reference in the workflow configuration.<p>In the workflow file <code>.github/workflows/update-caches.yml</code>, the step for setting up Rust was referencing the <code>dtolnay/rust-toolchain</code> action using the <code>@main</code> branch tag:<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@main
</span></code></pre><p>This was incorrect because the <code>dtolnay/rust-toolchain</code> repository maintains its primary branch as <code>master</code> rather than <code>main</code>. The <code>main</code> branch did not exist in that repository, causing the workflow to fail when attempting to resolve the action reference.<p>The failure manifested as a workflow execution error during the “Setup Rust” step, preventing the cache update process from completing successfully. This was a critical issue because it broke the CI pipeline for cache management shortly after the new cache system was implemented.<p>The fix was straightforward but essential: update the branch reference from <code>main</code> to <code>master</code> to correctly point to the existing branch in the external repository:<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@master
</span></code></pre><p>This single-character change restored the workflow’s ability to locate and execute the Rust toolchain setup action. The modification addressed a common pitfall when integrating third-party GitHub Actions - ensuring branch references match the actual branch names in the target repository.<p>The change demonstrates the importance of verifying external dependencies in CI configurations, especially after introducing new tooling. While small in scope, this fix was crucial for maintaining the stability of Bevy’s build system and ensuring the new cache optimization could function as intended.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[update-caches.yml Workflow] --> B[Setup Rust Step]
</span><span>    B --> C[Action: dtolnay/rust-toolchain]
</span><span>    C --> D{Branch Reference}
</span><span>    D -->|Incorrect| E[main]
</span><span>    D -->|Correct| F[master]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=github-workflows-update-caches-yml>.github/workflows/update-caches.yml</h3><p>This GitHub Actions workflow file manages cache updates for the Bevy project. The modification corrects a branch reference in the Rust installation step.<p><strong>Key modification:</strong><pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>- </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Setup Rust
</span><span>  </span><span style=color:#399ee6>id</span><span style=color:#61676ccc>: </span><span style=color:#86b300>rust
</span><span>  </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@main
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>- </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Setup Rust
</span><span>  </span><span style=color:#399ee6>id</span><span style=color:#61676ccc>: </span><span style=color:#86b300>rust
</span><span>  </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>dtolnay/rust-toolchain@master
</span></code></pre><p>The change replaces <code>@main</code> with <code>@master</code> in the action reference, resolving the failure in the Rust installation step. This fix ensures the workflow can properly set up the Rust toolchain when updating caches.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://github.com/dtolnay/rust-toolchain target=_blank>dtolnay/rust-toolchain GitHub Action</a> - Documentation for the Rust toolchain setup action<li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions target=_blank>GitHub Actions Syntax Reference</a> - Official documentation for workflow configuration<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20144 target=_blank>PR #20144</a> - The original cache implementation that introduced the workflow</ol><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/.github/workflows/update-caches.yml b/.github/workflows/update-caches.yml
</span><span>index e08eb6dedc432..6a4ce6dba9b9a 100644
</span><span style=color:#c594c5>--- a/.github/workflows/update-caches.yml
</span><span style=color:#c594c5>+++ b/.github/workflows/update-caches.yml
</span><span style=color:#c594c5>@@ -97,7 +97,7 @@ </span><span style=color:#399ee6>jobs:
</span><span> 
</span><span>       - name: Setup Rust
</span><span>         id: rust
</span><span style=color:#f07171>-        uses: dtolnay/rust-toolchain@main
</span><span style=color:#86b300>+        uses: dtolnay/rust-toolchain@master
</span><span>         with:
</span><span>           toolchain: ${{ matrix.toolchain }}
</span><span>           target: ${{ matrix.target }}
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20239.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>