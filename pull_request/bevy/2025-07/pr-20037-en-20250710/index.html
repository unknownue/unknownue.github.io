<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20037 StandardMaterial docs: Make clear that lighting won't look correct if `is_srgb` is `true`
        
    </title><meta content="#20037 StandardMaterial docs: Make clear that lighting won't look correct if `is_srgb` is `true`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-10</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20037-zh-cn-20250710>中文</a></div></div><div class=pr-content><h2 id=standardmaterial-documentation-clarifying-normal-map-srgb-usage>StandardMaterial Documentation: Clarifying Normal Map sRGB Usage</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: StandardMaterial docs: Make clear that lighting won’t look correct if <code>is_srgb</code> is <code>true</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20037<li><strong>Author</strong>: 772<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-Rendering, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-07-08T17:20:12Z<li><strong>Merged</strong>: 2025-07-10T19:02:02Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><h1 id=objective>Objective</h1><ul><li>Fix https://github.com/bevyengine/bevy/issues/12123</ul><h2 id=solution>Solution</h2><ul><li>Add a code example found here: https://github.com/bevyengine/bevy/blob/main/examples/3d/parallax_mapping.rs#L209 to https://docs.rs/bevy/latest/bevy/pbr/struct.StandardMaterial.html</ul><h2 id=testing>Testing</h2><ul><li>This pull request if only changing docs. But I tested the formatting via <code>cargo doc --no-deps --open</code>.</ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p><strong>The Problem and Context</strong><br> Users were experiencing incorrect lighting results when using normal maps with Bevy’s PBR materials. The root cause was traced to how normal map textures were being loaded - specifically, the default <code>is_srgb = true</code> setting in the image loader was being applied to normal maps. Normal maps contain vector data rather than color information, and applying sRGB conversion corrupts this data since sRGB is a color space transformation. This led to subtle but significant rendering errors where lighting calculations produced incorrect results.<p><strong>The Solution Approach</strong><br> The straightforward solution was to improve documentation clarity around this common pitfall. Rather than modifying engine behavior (which could break existing projects), the decision was made to add explicit guidance directly in the <code>StandardMaterial</code> documentation. This approach ensures users understand why lighting might appear incorrect and how to fix it without changing default behaviors that might be correct for other texture types.<p><strong>The Implementation</strong><br> A code example was added to the <code>normal_map_texture</code> field documentation in <code>StandardMaterial</code>. This example demonstrates the correct way to load normal map textures by explicitly setting <code>is_srgb = false</code> during asset loading:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added documentation example
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>load_normal_map</span><span>(</span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> normal_handle</span><span style=color:#61676ccc>: </span><span>Handle&LTImage> </span><span style=color:#ed9366>=</span><span> asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load_with_settings</span><span>(
</span><span>        </span><span style=color:#86b300>"textures/parallax_example/cube_normal.png"</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// The normal map texture is in linear color space. Lighting won't look correct
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// if `is_srgb` is `true`, which is the default.
</span><span>        </span><span style=color:#ed9366>|</span><span>settings</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ImageLoaderSettings</span><span style=color:#ed9366>|</span><span> settings</span><span style=color:#ed9366>.</span><span>is_srgb </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The example clearly shows:<ol><li>Using <code>load_with_settings</code> instead of standard asset loading<li>Explicitly disabling sRGB conversion via closure<li>An explanatory comment about the consequences of incorrect settings</ol><p><strong>Technical Insights</strong><br> The key technical distinction here is between color textures (which typically use sRGB space) and data textures (like normal maps) which require linear color space. When <code>is_srgb=true</code>, Bevy applies gamma correction that distorts the vector data in normal maps. This manifests as incorrect lighting because:<ul><li>Normal vectors become non-unit length after transformation<li>Vector directions are altered by the gamma curve<li>The dot products used in lighting calculations produce invalid results</ul><p><strong>The Impact</strong><br> This documentation change directly addresses GitHub issue #12123 by providing clear, in-context guidance. Developers working with normal maps will now immediately see the correct usage pattern when consulting the <code>StandardMaterial</code> documentation. This prevents subtle rendering errors that could otherwise take significant time to debug. The solution maintains backward compatibility while improving the developer experience for Bevy’s PBR system.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[User loads normal map] --> B{is_srgb=true?}
</span><span>    B -->|Yes| C[Incorrect lighting]
</span><span>    B -->|No| D[Correct lighting]
</span><span>    C --> E[Developer consults docs]
</span><span>    E --> F[Discovers code example]
</span><span>    F --> G[Uses load_with_settings]
</span><span>    G --> D
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><p><strong>crates/bevy_pbr/src/pbr_material.rs</strong><br> Added documentation example to clarify normal map loading requirements.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>texture</span><span>(9)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>sampler</span><span>(10)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>dependency</span><span>]
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>texture</span><span>(9)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>sampler</span><span>(10)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>dependency</span><span>]
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// # Usage
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// ```
</span><span style=color:#abb0b6;font-style:italic>/// # use bevy_asset::{AssetServer, Handle};
</span><span style=color:#abb0b6;font-style:italic>/// # use bevy_ecs::change_detection::Res;
</span><span style=color:#abb0b6;font-style:italic>/// # use bevy_image::{Image, ImageLoaderSettings};
</span><span style=color:#abb0b6;font-style:italic>/// #
</span><span style=color:#abb0b6;font-style:italic>/// fn load_normal_map(asset_server: Res&LTAssetServer>) {
</span><span style=color:#abb0b6;font-style:italic>///     let normal_handle: Handle&LTImage> = asset_server.load_with_settings(
</span><span style=color:#abb0b6;font-style:italic>///         "textures/parallax_example/cube_normal.png",
</span><span style=color:#abb0b6;font-style:italic>///         // The normal map texture is in linear color space. Lighting won't look correct
</span><span style=color:#abb0b6;font-style:italic>///         // if `is_srgb` is `true`, which is the default.
</span><span style=color:#abb0b6;font-style:italic>///         |settings: &mut ImageLoaderSettings| settings.is_srgb = false,
</span><span style=color:#abb0b6;font-style:italic>///     );
</span><span style=color:#abb0b6;font-style:italic>/// }
</span><span style=color:#abb0b6;font-style:italic>/// ```
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/pbr/struct.StandardMaterial.html target=_blank>Bevy PBR Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://blog.demofox.org/2018/03/10/dont-convert-srgb-u8-to-linear-u8/ target=_blank>sRGB vs Linear Color Space Explanation</a><li><a rel="noopener nofollow noreferrer" href=https://learnopengl.com/Advanced-Lighting/Normal-Mapping target=_blank>Normal Mapping Theory</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/12123 target=_blank>Original Issue #12123</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20037.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>