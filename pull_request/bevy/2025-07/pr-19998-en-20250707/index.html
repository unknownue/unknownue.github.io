<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19998 remove unused dependencies
        
    </title><meta content="#19998 remove unused dependencies" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-19998-zh-cn-20250707>中文</a></div></div><div class=pr-content><h1 id=analysis-of-pr-19998-remove-unused-dependencies>Analysis of PR #19998: Remove Unused Dependencies</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: remove unused dependencies<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19998<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Dependencies, S-Ready-For-Final-Review, A-Cross-Cutting<li><strong>Created</strong>: 2025-07-07T05:40:26Z<li><strong>Merged</strong>: 2025-07-07T20:46:15Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Dependency management is critical in large Rust projects like Bevy. Unused dependencies increase compile times, bloat binary sizes, and complicate dependency graphs. This PR addresses the problem of unnecessary dependencies that accumulated across multiple Bevy crates. These dependencies were likely introduced during development and not removed when they became obsolete. The goal was straightforward: identify and remove any dependency not actively used by a crate.<h3 id=the-solution-approach>The Solution Approach</h3><p>The developer systematically reviewed each crate’s dependencies against its actual imports and usage patterns. For each crate:<ol><li>Identified dependencies listed in Cargo.toml<li>Verified whether the dependency was actually used in the crate’s code<li>Removed unused dependencies while ensuring the crate still compiled<li>Verified basic functionality with existing test scenes</ol><p>This approach required cross-crate analysis since some dependencies might be used indirectly through other crates. The solution focused on direct dependencies only - if a crate could compile without a dependency and didn’t use it directly, it was removed.<h3 id=the-implementation>The Implementation</h3><p>The changes exclusively modify Cargo.toml files across 20 crates. Each removal follows the same pattern: deleting dependency lines that are no longer needed. The implementation is comprehensive but targeted:<p><strong>Removed dependency categories:</strong><ol><li><strong>Internal Bevy crates</strong> like <code>bevy_derive</code>, <code>bevy_utils</code>, and <code>bevy_log</code> where they weren’t actually used<li><strong>External utilities</strong> like <code>serde</code>, <code>bytemuck</code>, and <code>nonmax</code> when unused<li><strong>Feature-specific dependencies</strong> that weren’t required for core functionality<li><strong>Redundant imports</strong> where functionality was already provided through other dependencies</ol><h3 id=technical-insights>Technical Insights</h3><p>The changes demonstrate several dependency management best practices:<ol><li><strong>Minimal dependency surfaces</strong>: Each crate should only declare dependencies it directly uses<li><strong>Feature trimming</strong>: Optional dependencies should be scoped to the features that require them<li><strong>Build time optimization</strong>: Removing unused dependencies reduces: <ul><li>Compilation units<li>Crate graph complexity<li>Potential version conflicts</ul></ol><p>The PR also revealed opportunities for future improvements:<ol><li>Some crates had unused features enabled on existing dependencies<li>A few optional dependencies could be moved behind feature flags<li>Better tooling integration (like <code>cargo-udeps</code>) could prevent recurrence</ol><h3 id=the-impact>The Impact</h3><p>These changes provide immediate benefits:<ol><li><strong>Reduced compile times</strong>: Fewer dependencies mean less code to compile<li><strong>Smaller disk footprint</strong>: Fewer crates to download and store<li><strong>Simpler dependency graphs</strong>: Easier to audit and maintain<li><strong>Cleaner separation of concerns</strong>: Each crate only depends on what it actually needs</ol><p>The minimal testing approach (“3d_scene runs”) was appropriate since these are dependency removals rather than functional changes. More comprehensive testing would be needed for code modifications, but here it verified that core functionality remained intact.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_animation] -->|Remove| B[bevy_log]
</span><span>    C[bevy_audio] -->|Remove| D[bevy_derive]
</span><span>    E[bevy_core_pipeline] -->|Remove| F[bevy_diagnostic, bytemuck]
</span><span>    G[bevy_core_widgets] -->|Remove| H[bevy_render, bevy_transform]
</span><span>    I[bevy_dev_tools] -->|Remove| J[bevy_input, bevy_utils]
</span><span>    K[bevy_pbr] -->|Remove| L[bevy_window, radsort]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ui-render-cargo-toml><code>crates/bevy_ui_render/Cargo.toml</code></h3><p>Removed unused dependencies including <code>bevy_window</code> and several external crates. Simplified feature flags.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>bevy_window </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_window"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.17.0-dev" </span><span>}
</span><span style=color:#399ee6>serde </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [</span><span style=color:#86b300>"derive"</span><span>]</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span style=color:#399ee6>nonmax </span><span>= </span><span style=color:#86b300>"0.5"
</span><span>
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>serialize </span><span>= [
</span><span>  </span><span style=color:#86b300>"serde"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"smallvec/serde"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_math/serialize"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_platform/serialize"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#abb0b6;font-style:italic># bevy_window removed
</span><span style=color:#abb0b6;font-style:italic># serde removed
</span><span style=color:#abb0b6;font-style:italic># nonmax removed
</span><span>
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>serialize </span><span>= [</span><span style=color:#86b300>"bevy_math/serialize"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_platform/serialize"</span><span>]
</span></code></pre><h3 id=crates-bevy-window-cargo-toml><code>crates/bevy_window/Cargo.toml</code></h3><p>Removed unused <code>smol_str</code> dependency and simplified feature flags.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>smol_str </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.2"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false </span><span>}
</span><span>
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>serialize </span><span>= [
</span><span>  </span><span style=color:#86b300>"serde"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"smol_str/serde"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_ecs/serialize"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_input/serialize"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#abb0b6;font-style:italic># smol_str removed
</span><span>
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>serialize </span><span>= [</span><span style=color:#86b300>"serde"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_ecs/serialize"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"bevy_input/serialize"</span><span>]
</span></code></pre><h3 id=crates-bevy-pbr-cargo-toml><code>crates/bevy_pbr/Cargo.toml</code></h3><p>Removed unused dependencies and simplified meshlet feature requirements.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>bevy_window </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_window"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.17.0-dev" </span><span>}
</span><span style=color:#399ee6>radsort </span><span>= </span><span style=color:#86b300>"0.1"
</span><span>
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>meshlet </span><span>= [</span><span style=color:#86b300>"dep:lz4_flex"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"dep:range-alloc"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"dep:half"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"dep:bevy_tasks"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#abb0b6;font-style:italic># bevy_window removed
</span><span style=color:#abb0b6;font-style:italic># radsort removed
</span><span>
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>meshlet </span><span>= [</span><span style=color:#86b300>"dep:lz4_flex"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"dep:range-alloc"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"dep:bevy_tasks"</span><span>]
</span></code></pre><h3 id=crates-bevy-core-pipeline-cargo-toml><code>crates/bevy_core_pipeline/Cargo.toml</code></h3><p>Removed unused diagnostic dependency and external crates.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#399ee6>bevy_diagnostic </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_diagnostic"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.17.0-dev" </span><span>}
</span><span style=color:#399ee6>bytemuck </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"1" </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>dependencies</span><span>]
</span><span style=color:#abb0b6;font-style:italic># bevy_diagnostic removed
</span><span style=color:#abb0b6;font-style:italic># bytemuck removed
</span></code></pre><h3 id=crates-bevy-winit-cargo-toml><code>crates/bevy_winit/Cargo.toml</code></h3><p>Removed unused serde dependency in feature flags.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>serialize </span><span>= [
</span><span>  </span><span style=color:#86b300>"serde"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_input/serialize"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_window/serialize"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_platform/serialize"</span><span style=color:#61676ccc>,
</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>features</span><span>]
</span><span style=color:#399ee6>serialize </span><span>= [
</span><span>  </span><span style=color:#86b300>"bevy_input/serialize"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_window/serialize"</span><span style=color:#61676ccc>,
</span><span>  </span><span style=color:#86b300>"bevy_platform/serialize"</span><span style=color:#61676ccc>,
</span><span>]
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/guide/dependencies.html target=_blank>Cargo Book: Dependency Management</a><li><a rel="noopener nofollow noreferrer" href=https://nnethercote.github.io/perf-book/compilation.html#minimal-versions target=_blank>Rust Performance: Dependency Optimization</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/est31/cargo-udeps target=_blank>cargo-udeps tool</a> for finding unused dependencies<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/introduction/#how-does-bevy-work target=_blank>Bevy Engine Architecture</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_19998.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>