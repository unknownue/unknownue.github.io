<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20184 RenderStartup for occlusion_culling example
        
    </title><meta content="#20184 RenderStartup for occlusion_culling example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20184-zh-cn-20250722>中文</a></div></div><div class=pr-content><h2 id=renderstartup-for-occlusion-culling-example>RenderStartup for occlusion_culling example</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: RenderStartup for occlusion_culling example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20184<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Code-Quality, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-07-18T07:22:12Z<li><strong>Merged</strong>: 2025-07-21T23:17:30Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description>Description</h3><p><strong>Objective</strong><ul><li>Progress towards #19887<li>This example was non-trivial to port so was done as a separate PR</ul><p><strong>Solution</strong><ul><li>This situation is very weird. We are trying to get features of the renderer back into the main world. We use an ArcMutex to communicate between the two worlds<li>We now insert the resource into both worlds, but only with Option::None<li>The <code>RenderStartup</code> init system initializes the resource with the feature values populated</ul><p>This does result in a “regression” where there is a single frame where the <code>update_status_text</code> system doesn’t react properly, since it doesn’t have the features from the render world yet<p><strong>Testing</strong><ul><li>Ran the <code>occlusion_culling</code> example and it worked!</ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>The occlusion culling example needed to synchronize renderer feature detection between Bevy’s main world and render world. Previously, it used <code>FromWorld</code> to initialize <code>SavedIndirectParameters</code> during app building, but this caused issues because render device features weren’t available yet.<p>The core problem was that GPU feature detection (like occlusion culling support) happens in the render world during startup, but the main world needed this information to display status text. The original implementation tried to initialize too early, before the renderer had determined which features were supported.<p>The solution involves three key changes:<ol><li><strong>Resource initialization</strong>: Instead of using <code>FromWorld</code>, we create <code>SavedIndirectParameters</code> as an <code>Option::None</code> in both worlds during plugin setup<li><strong>Deferred initialization</strong>: A new <code>init_saved_indirect_parameters</code> system runs in <code>RenderStartup</code> to populate the resource with actual feature detection results<li><strong>Safe handling</strong>: Systems that use the resource now check for <code>Option::None</code> and bail early if data isn’t available</ol><p>This approach ensures feature detection occurs at the proper time in the render pipeline. The trade-off is a one-frame delay where status text might be inaccurate, but this is acceptable for an example.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Resource initialization via FromWorld
</span><span style=color:#fa6e32>impl </span><span>FromWorld </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SavedIndirectParameters </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_world</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-></span><span> SavedIndirectParameters {
</span><span>        </span><span style=color:#fa6e32>let</span><span> render_device </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>resource</span><span style=color:#ed9366>::</span><span>&LTRenderDevice>()</span><span style=color:#61676ccc>;
</span><span>        SavedIndirectParameters(Arc</span><span style=color:#ed9366>::</span><span>new(Mutex</span><span style=color:#ed9366>::</span><span>new(SavedIndirectParametersData {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... initialization that requires render device features
</span><span>        })))
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Simple constructor and deferred initialization
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>SavedIndirectParameters </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>new</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span>(Arc</span><span style=color:#ed9366>::</span><span>new(Mutex</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#55b4d4;font-style:italic>None</span><span>)))
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_saved_indirect_parameters</span><span>(
</span><span>    </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span>Res&LTRenderDevice>,
</span><span>    </span><span style=color:#ff8f40>saved_indirect_parameters</span><span style=color:#61676ccc>: </span><span>Res&LTSavedIndirectParameters>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> saved_indirect_parameters </span><span style=color:#ed9366>=</span><span> saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>lock</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#ed9366>*</span><span>saved_indirect_parameters </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(SavedIndirectParametersData {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Proper initialization using render device features
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The resource usage was also updated to handle the new <code>Option</code> wrapper:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Usage site update
</span><span style=color:#fa6e32>let</span><span> saved_indirect_parameters </span><span style=color:#ed9366>=</span><span> saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>lock</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(saved_indirect_parameters) </span><span style=color:#ed9366>=</span><span> saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>() </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Bail out if not initialized
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>The PR also cleaned up unnecessary dependencies by removing:<ul><li>Redundant <code>GpuPreprocessingSupport</code> parameter in <code>readback_indirect_parameters</code><li>Outdated <code>finish()</code> method in the plugin<li>Unused imports like <code>GpuPreprocessingMode</code></ul><p>These changes make the example more robust and demonstrate proper pattern for synchronizing render-world data to the main world.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Main App] -->|Creates| B[SavedIndirectParameters]
</span><span>    B -->|Arc/Mutex| C[None]
</span><span>    D[Render App] -->|Shares| B
</span><span>    E[RenderStartup] -->|Initializes| B
</span><span>    F[Update Systems] -->|Reads| B
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><p><strong>examples/3d/occlusion_culling.rs (+62/-51)</strong> The occlusion culling example was refactored to use RenderStartup for proper resource initialization:<ol><li><p><strong>Resource initialization changed from FromWorld to explicit constructor</strong><br> Before:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span>FromWorld </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SavedIndirectParameters </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_world</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-></span><span> SavedIndirectParameters {
</span><span>        </span><span style=color:#fa6e32>let</span><span> render_device </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>resource</span><span style=color:#ed9366>::</span><span>&LTRenderDevice>()</span><span style=color:#61676ccc>;
</span><span>        SavedIndirectParameters(Arc</span><span style=color:#ed9366>::</span><span>new(Mutex</span><span style=color:#ed9366>::</span><span>new(SavedIndirectParametersData {
</span><span>            data</span><span style=color:#61676ccc>: </span><span style=color:#f07171>vec!</span><span>[]</span><span style=color:#61676ccc>,
</span><span>            count</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>            occlusion_culling_supported</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>,
</span><span>            occlusion_culling_introspection_supported</span><span style=color:#61676ccc>:</span><span> render_device
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>features</span><span>()
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(WgpuFeatures</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MULTI_DRAW_INDIRECT_COUNT</span><span>)</span><span style=color:#61676ccc>,
</span><span>        })))
</span><span>    }
</span><span>}
</span></code></pre> <p>After:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span style=color:#399ee6>SavedIndirectParameters </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>new</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span>(Arc</span><span style=color:#ed9366>::</span><span>new(Mutex</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#55b4d4;font-style:italic>None</span><span>)))
</span><span>    }
</span><span>}
</span></code></pre><li><p><strong>Added RenderStartup initialization system</strong><br> New system that populates the resource when render features are available:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>init_saved_indirect_parameters</span><span>(
</span><span>    </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span>Res&LTRenderDevice>,
</span><span>    </span><span style=color:#ff8f40>gpu_preprocessing_support</span><span style=color:#61676ccc>: </span><span>Res&LTGpuPreprocessingSupport>,
</span><span>    </span><span style=color:#ff8f40>saved_indirect_parameters</span><span style=color:#61676ccc>: </span><span>Res&LTSavedIndirectParameters>,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> saved_indirect_parameters </span><span style=color:#ed9366>=</span><span> saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>lock</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#ed9366>*</span><span>saved_indirect_parameters </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(SavedIndirectParametersData {
</span><span>        data</span><span style=color:#61676ccc>: </span><span style=color:#f07171>vec!</span><span>[]</span><span style=color:#61676ccc>,
</span><span>        count</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>        occlusion_culling_supported</span><span style=color:#61676ccc>:</span><span> gpu_preprocessing_support</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_culling_supported</span><span>()</span><span style=color:#61676ccc>,
</span><span>        occlusion_culling_introspection_supported</span><span style=color:#61676ccc>:</span><span> render_device
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>features</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(WgpuFeatures</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MULTI_DRAW_INDIRECT_COUNT</span><span>)</span><span style=color:#61676ccc>,
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><li><p><strong>Plugin initialization flow simplified</strong><br> Before:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>finish</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> saved_indirect_parameters </span><span style=color:#ed9366>= </span><span>SavedIndirectParameters</span><span style=color:#ed9366>::</span><span>from_world(app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>())</span><span style=color:#61676ccc>;
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... render app setup
</span><span>}
</span></code></pre> <p>After:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> saved_indirect_parameters </span><span style=color:#ed9366>= </span><span>SavedIndirectParameters</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... render app setup
</span><span>    render_app
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(saved_indirect_parameters)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(RenderStartup</span><span style=color:#61676ccc>,</span><span> init_saved_indirect_parameters)
</span><span>}
</span></code></pre><li><p><strong>Usage sites updated to handle Option</strong><br> Before:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> saved_indirect_parameters </span><span style=color:#ed9366>=</span><span> saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>lock</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre> <p>After:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> saved_indirect_parameters </span><span style=color:#ed9366>=</span><span> saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>lock</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(saved_indirect_parameters) </span><span style=color:#ed9366>=</span><span> saved_indirect_parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>() </span><span style=color:#fa6e32>else </span><span>{
</span><span>    </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>;
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre></ol><h3 id=further-reading>Further Reading</h3><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/rendering/ target=_blank>Bevy Render Stages Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/res.html target=_blank>ECS Resource Management Patterns</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch16-03-shared-state.html target=_blank>Arc/Mutex Synchronization Techniques</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20184.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>