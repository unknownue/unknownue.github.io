<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20088 Split `bundle.rs`
        
    </title><meta content="#20088 Split `bundle.rs`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-14</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20088-zh-cn-20250714>中文</a></div></div><div class=pr-content><h2 id=pull-request-analysis-split-bundle-rs>Pull Request Analysis: Split <code>bundle.rs</code></h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Split <code>bundle.rs</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20088<li><strong>Author</strong>: SkiFire13<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Code-Quality, P-High, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-07-11T17:33:03Z<li><strong>Merged</strong>: 2025-07-14T18:36:26Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h3 id=description-translation>Description Translation</h3><p><strong>Objective</strong><ul><li><code>bundle.rs</code> was becoming too large and needed to be split for better maintainability.</ul><p><strong>Solution</strong><ul><li>Split <code>bundle.rs</code> into the following files: <ul><li><code>bundle/mod.rs</code>: Contains main traits and documentation<li><code>bundle/impls.rs</code>: Contains trait implementations for components and tuples<li><code>bundle/info.rs</code>: Contains <code>BundleInfo</code> and related metadata types<li><code>bundle/insert.rs</code>: Contains bundle insertion logic for existing entities<li><code>bundle/remove.rs</code>: Contains bundle removal logic for existing entities<li><code>bundle/spawner.rs</code>: Contains bundle spawning logic for new entities<li><code>bundle/tests.rs</code>: Contains test cases</ul></ul><p><strong>Reviewer Notes</strong><ul><li>Review with <code>--color-moved</code> to verify most changes are file moves rather than modifications.</ul><hr><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>The <code>bundle.rs</code> file in Bevy’s ECS module had grown to over 2,300 lines of code. This size made it difficult to navigate and maintain. Key functionality like bundle insertion, removal, spawning, and metadata management were all contained in a single file, creating cognitive overhead for developers. As Bevy’s ECS system evolves, maintaining a monolithic file would become increasingly problematic for code readability and contributor onboarding.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution was straightforward: split the monolithic <code>bundle.rs</code> into logically separated files based on functionality. This followed Bevy’s existing code organization patterns where related functionality is grouped into modules. The approach preserved all existing functionality while improving code organization. Each new file received a focused responsibility:<ol><li><strong>Core Traits</strong> (<code>mod.rs</code>): Fundamental traits like <code>Bundle</code> and <code>DynamicBundle</code><li><strong>Implementations</strong> (<code>impls.rs</code>): Concrete implementations for components/tuples<li><strong>Metadata Management</strong> (<code>info.rs</code>): <code>BundleInfo</code> and <code>BundleId</code> types<li><strong>Entity Operations</strong> (<code>insert.rs</code>, <code>remove.rs</code>, <code>spawner.rs</code>): Runtime bundle operations<li><strong>Tests</strong> (<code>tests.rs</code>): Dedicated space for test cases</ol><h3 id=the-implementation>The Implementation</h3><p>The PR deleted the original <code>bundle.rs</code> and created seven new files. Code was moved between files with minimal modifications, preserving existing functionality. Key aspects:<p><strong>Bundle Trait Definitions</strong> (<code>mod.rs</code>)<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: All in bundle.rs
</span><span style=color:#abb0b6;font-style:italic>// After: Focused trait definitions
</span><span style=color:#fa6e32>pub unsafe trait </span><span style=color:#399ee6>Bundle</span><span>: DynamicBundle + Send + Sync + 'static {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>component_ids</span><span>(</span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentsRegistrator, </span><span style=color:#ff8f40>ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> impl FnMut(</span><span style=color:#ff8f40>ComponentId</span><span>))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>get_component_ids</span><span>(</span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Components, </span><span style=color:#ff8f40>ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> impl FnMut(</span><span style=color:#ff8f40>Option</span><span><</span><span style=color:#ff8f40>ComponentId</span><span>>))</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>DynamicBundle </span><span>{
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Effect</span><span style=color:#61676ccc>:</span><span> BundleEffect</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>get_components</span><span>(</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>func</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> impl FnMut(</span><span style=color:#ff8f40>StorageType</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>OwningPtr</span><span><'_>)) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Effect</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p><strong>Tuple Implementations</strong> (<code>impls.rs</code>)<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Macro-generated in main file
</span><span style=color:#abb0b6;font-style:italic>// After: Isolated implementation details
</span><span style=color:#fa6e32>unsafe impl</span><span>&LTC</span><span style=color:#61676ccc>:</span><span> Component> Bundle </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>C </span><span>{ </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#fa6e32>unsafe impl</span><span><$($name: Bundle),*> Bundle </span><span style=color:#fa6e32>for</span><span> ($($name,)*) {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>component_ids</span><span>(</span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentsRegistrator, </span><span style=color:#ff8f40>ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> impl FnMut(</span><span style=color:#ff8f40>ComponentId</span><span>)){
</span><span>        </span><span style=color:#ed9366>$</span><span>(</span><span style=color:#ed9366><</span><span>$name </span><span style=color:#ed9366>as</span><span> Bundle</span><span style=color:#ed9366>>::</span><span>component_ids(components</span><span style=color:#61676ccc>,</span><span> ids)</span><span style=color:#61676ccc>;</span><span>)</span><span style=color:#ed9366>*
</span><span>    }
</span><span>}
</span></code></pre><p><strong>Bundle Metadata</strong> (<code>info.rs</code>)<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Mixed with operational logic
</span><span style=color:#abb0b6;font-style:italic>// After: Dedicated to metadata management
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BundleInfo </span><span>{
</span><span>    id</span><span style=color:#61676ccc>:</span><span> BundleId,
</span><span>    component_ids</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTComponentId>,
</span><span>    required_components</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTRequiredComponentConstructor>,
</span><span>    explicit_components_len</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Bundles </span><span>{
</span><span>    bundle_infos</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTBundleInfo>,
</span><span>    bundle_ids</span><span style=color:#61676ccc>: </span><span>TypeIdMap&LTBundleId>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other metadata fields
</span><span>}
</span></code></pre><p><strong>Entity Operations</strong> (<code>insert.rs</code>, <code>remove.rs</code>, <code>spawner.rs</code>)<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: All operations in single file
</span><span style=color:#abb0b6;font-style:italic>// After: Separated by operation type
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>BundleInserter</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Fields specific to insertion
</span><span>    world</span><span style=color:#61676ccc>: </span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>    bundle_info</span><span style=color:#61676ccc>: </span><span>ConstNonNull&LTBundleInfo>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other insertion-specific fields
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>'w</span><span>> </span><span style=color:#399ee6>BundleInserter</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>insert</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> DynamicBundle>(...) { </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>The refactoring demonstrates several good software engineering practices:<ol><li><p><strong>Separation of Concerns</strong>: Each file now has a single responsibility:</p> <ul><li><code>mod.rs</code>: Type definitions and interfaces<li><code>impls.rs</code>: Concrete implementations<li><code>info.rs</code>: Metadata management<li>Operation files: Runtime behavior</ul><li><p><strong>Preservation of Invariants</strong>: By moving code rather than modifying it, the PR maintains critical invariants like:</p> <ul><li>Bundle component ID ordering requirements<li>Safety guarantees in unsafe blocks<li>Archetype graph integrity</ul><li><p><strong>Testability</strong>: Isolating tests in their own file makes test maintenance easier.</p></ol><h3 id=the-impact>The Impact</h3><ul><li><strong>Maintainability</strong>: Reduces average file size from 2,382 lines to under 600 lines<li><strong>Discoverability</strong>: Developers can locate functionality faster through logical file structure<li><strong>Contributor Experience</strong>: Lowers barrier to entry for new contributors<li><strong>Compilation</strong>: May improve incremental compilation times for bundle-related changes</ul><p>The change aligns with Bevy’s code quality standards and provides a foundation for future ECS improvements. The straightforward nature of the change (primarily file moves) minimized risk while delivering significant organizational benefits.<hr><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Original bundle.rs] --> B[Split Files]
</span><span>    B --> C[mod.rs]
</span><span>    B --> D[impls.rs]
</span><span>    B --> E[info.rs]
</span><span>    B --> F[insert.rs]
</span><span>    B --> G[remove.rs]
</span><span>    B --> H[spawner.rs]
</span><span>    B --> I[tests.rs]
</span></code></pre><hr><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><strong>crates/bevy_ecs/src/bundle.rs</strong> (+0/-2382)</p> <ul><li>Entire file removed after being split into multiple files</ul><li><p><strong>crates/bevy_ecs/src/bundle/info.rs</strong> (+572/-0)</p> <ul><li>Contains <code>BundleInfo</code> and <code>Bundles</code> metadata types<li>Key code snippet:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BundleInfo </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(super) id</span><span style=color:#61676ccc>:</span><span> BundleId,
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(super) component_ids</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTComponentId>,
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(super) required_components</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTRequiredComponentConstructor>,
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(super) explicit_components_len</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Bundles </span><span>{
</span><span>    bundle_infos</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTBundleInfo>,
</span><span>    bundle_ids</span><span style=color:#61676ccc>: </span><span>TypeIdMap&LTBundleId>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other fields
</span><span>}
</span></code></pre><ol start=3><li><strong>crates/bevy_ecs/src/bundle/insert.rs</strong> (+544/-0) <ul><li>Handles inserting bundles into existing entities<li>Key code snippet:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>BundleInserter</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    world</span><span style=color:#61676ccc>: </span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>    bundle_info</span><span style=color:#61676ccc>: </span><span>ConstNonNull&LTBundleInfo>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other fields
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>'w</span><span>> </span><span style=color:#399ee6>BundleInserter</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>insert</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> DynamicBundle>(...) { </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span></code></pre><ol start=4><li><strong>crates/bevy_ecs/src/bundle/remove.rs</strong> (+449/-0) <ul><li>Handles removing bundles from entities<li>Key code snippet:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>BundleRemover</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    world</span><span style=color:#61676ccc>: </span><span>UnsafeWorldCell<</span><span style=color:#fa6e32>'w</span><span>>,
</span><span>    bundle_info</span><span style=color:#61676ccc>: </span><span>ConstNonNull&LTBundleInfo>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other fields
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span><</span><span style=color:#fa6e32>'w</span><span>> </span><span style=color:#399ee6>BundleRemover</span><span><</span><span style=color:#fa6e32>'w</span><span>> {
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>remove</span><span>(...) { </span><span style=color:#ed9366>... </span><span>}
</span><span>}
</span></code></pre><ol start=5><li><strong>crates/bevy_ecs/src/bundle/mod.rs</strong> (+266/-0) <ul><li>Main bundle module with core traits<li>Key code snippet:</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub unsafe trait </span><span style=color:#399ee6>Bundle</span><span>: DynamicBundle + Send + Sync + 'static {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>component_ids</span><span>(</span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentsRegistrator, </span><span style=color:#ff8f40>ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> impl FnMut(</span><span style=color:#ff8f40>ComponentId</span><span>))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>get_component_ids</span><span>(</span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>Components, </span><span style=color:#ff8f40>ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> impl FnMut(</span><span style=color:#ff8f40>Option</span><span><</span><span style=color:#ff8f40>ComponentId</span><span>>))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><hr><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch07-02-defining-modules-to-control-scope-and-privacy.html target=_blank>Module System in Rust Book</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/ecs/ target=_blank>Bevy ECS Architecture</a><li>[Rust API Guidelines: Module Structure](https://rust-lang.github.io/api-guidelines/</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20088.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>