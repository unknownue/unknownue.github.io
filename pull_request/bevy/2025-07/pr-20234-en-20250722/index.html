<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20234 Observer tests contain unnecessary calls to world.flush()
        
    </title><meta content="#20234 Observer tests contain unnecessary calls to world.flush()" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20234-zh-cn-20250722>中文</a></div></div><div class=pr-content><h1 id=observer-tests-contain-unnecessary-calls-to-world-flush>Observer tests contain unnecessary calls to world.flush()</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Observer tests contain unnecessary calls to world.flush()<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20234<li><strong>Author</strong>: shirokoff<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-07-21T22:23:43Z<li><strong>Merged</strong>: 2025-07-22T00:09:00Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Cleanup unnecessary world.flush() calls in the Observer tests</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a code quality issue in Bevy’s ECS observer tests where explicit <code>world.flush()</code> calls were unnecessarily scattered throughout test cases. These flush operations were originally added as workarounds for observer registration behavior but became obsolete after internal Bevy changes.<p>Historically, when observers were added using <code>world.add_observer()</code>, the method returned a <code>WorldEntityMut</code> that didn’t automatically flush pending operations. This required manual <code>flush()</code> calls to ensure observers were properly registered before events could trigger them. The explicit flushes were accompanied by TODO comments explaining their necessity.<p>However, after Bevy’s observer implementation evolved, these manual flushes became redundant. The tests continued to include them, creating confusion about whether they were still required. The flush operations also added visual noise and potential performance overhead during test execution.<p>The solution was straightforward: remove all unnecessary <code>world.flush()</code> calls along with their associated explanatory comments. This required carefully auditing each test case to verify that observer behavior remained correct without explicit flushes. The changes were made in the observer test module (<code>mod tests</code>), targeting specific test functions where flushes were no longer needed.<p>Key technical considerations included:<ol><li>Verifying observer triggering still worked correctly after flush removal<li>Ensuring event propagation through component hierarchies remained functional<li>Confirming observer ordering and duplicate triggering behavior stayed consistent<li>Maintaining test coverage for all observer functionality</ol><p>The changes simplify test code by eliminating redundant operations and clarifying that explicit flushes aren’t required for observer registration. This makes the tests more readable and reduces potential confusion for contributors working with Bevy’s observer system.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[Observer Tests] --> B[world.flush calls]
</span><span>    B --> C{Necessary?}
</span><span>    C -->|No| D[Remove calls]
</span><span>    C -->|Yes| E[Retain calls]
</span><span>    D --> F[Cleaner tests]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-observer-mod-rs><code>crates/bevy_ecs/src/observer/mod.rs</code></h3><p>This file contains the observer implementation and test suite. The changes remove unnecessary flush operations and associated comments from multiple test cases.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#abb0b6;font-style:italic>// and therefore does not automatically flush.
</span><span>world</span><span style=color:#ed9366>.</span><span style=color:#f07171>flush</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// ... test logic ...
</span><span>
</span><span>world</span><span style=color:#ed9366>.</span><span style=color:#f07171>flush</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// ... test logic without flush calls ...
</span></code></pre><p><strong>Key modifications:</strong><ol><li>Removed flush calls after observer registration<li>Removed flush calls after event triggering<li>Deleted obsolete TODO comments explaining flush requirements<li>Maintained all test assertions unchanged</ol><p>The changes affect 21 test cases across various observer scenarios including:<ul><li>Basic event triggering<li>Targeted events with entities/components<li>Event propagation through hierarchies<li>Observer ordering<li>Complex multi-observer scenarios</ul><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/observer/index.html target=_blank>Bevy ECS Observer Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/world/struct.World.html#method.flush target=_blank>World::flush() API Reference</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/1912 target=_blank>Event System Improvements PR #1912</a> (original observer implementation)</ol><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ecs/src/observer/mod.rs b/crates/bevy_ecs/src/observer/mod.rs
</span><span>index 574f6ca257dea..4f3d210110d9b 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/observer/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/observer/mod.rs
</span><span style=color:#c594c5>@@ -630,10 +630,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         });
</span><span>         world.add_observer(|_: On&LTRemove, A>, mut res: ResMut&LTOrder>| res.observed("remove"));
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#f07171>-
</span><span>         let mut entity = world.entity_mut(entity);
</span><span>         entity.insert(A);
</span><span>         entity.flush();
</span><span style=color:#c594c5>@@ -684,9 +680,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         world.add_observer(|mut trigger: On&LTEventWithData>| trigger.event_mut().counter += 1);
</span><span>         world.add_observer(|mut trigger: On&LTEventWithData>| trigger.event_mut().counter += 2);
</span><span>         world.add_observer(|mut trigger: On&LTEventWithData>| trigger.event_mut().counter += 4);
</span><span style=color:#f07171>-        // This flush is required for the last observer to be called when triggering the event,
</span><span style=color:#f07171>-        // due to `World::add_observer` returning `WorldEntityMut`.
</span><span style=color:#f07171>-        world.flush();
</span><span> 
</span><span>         let mut event = EventWithData { counter: 0 };
</span><span>         world.trigger_ref(&mut event);
</span><span style=color:#c594c5>@@ -706,9 +699,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         world.add_observer(|mut trigger: On&LTEventWithData, A>| {
</span><span>             trigger.event_mut().counter += 4;
</span><span>         });
</span><span style=color:#f07171>-        // This flush is required for the last observer to be called when triggering the event,
</span><span style=color:#f07171>-        // due to `World::add_observer` returning `WorldEntityMut`.
</span><span style=color:#f07171>-        world.flush();
</span><span> 
</span><span>         let mut event = EventWithData { counter: 0 };
</span><span>         let component_a = world.register_component::&LTA>();
</span><span style=color:#c594c5>@@ -766,7 +756,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span> 
</span><span>         let entity = world.spawn(A).id();
</span><span>         world.entity_mut(entity).insert(B);
</span><span style=color:#f07171>-        world.flush();
</span><span>         assert_eq!(vec!["add_ab", "add_ab"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -833,11 +822,7 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             res.observed("event_a");
</span><span>         });
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger(EventA);
</span><span style=color:#f07171>-        world.flush();
</span><span>         assert_eq!(vec!["event_a"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -860,11 +845,7 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             res.observed("a_2");
</span><span>         });
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventA, entity);
</span><span style=color:#f07171>-        world.flush();
</span><span>         assert_eq!(vec!["a_2", "a_1"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -904,26 +885,20 @@ </span><span style=color:#399ee6>mod tests {
</span><span>              mut res: ResMut&LTR>| res.0 += 1000000,
</span><span>         );
</span><span> 
</span><span style=color:#f07171>-        // WorldEntityMut does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#f07171>-
</span><span>         // trigger for an entity and a component
</span><span>         world.trigger_targets(EventA, (entity_1, component_a));
</span><span style=color:#f07171>-        world.flush();
</span><span>         // only observer that doesn't trigger is the one only watching entity_2
</span><span>         assert_eq!(1111101, world.resource::&LTR>().0);
</span><span>         world.resource_mut::&LTR>().0 = 0;
</span><span> 
</span><span>         // trigger for both entities, but no components: trigger once per entity target
</span><span>         world.trigger_targets(EventA, (entity_1, entity_2));
</span><span style=color:#f07171>-        world.flush();
</span><span>         // only the observer that doesn't require components triggers - once per entity
</span><span>         assert_eq!(200, world.resource::&LTR>().0);
</span><span>         world.resource_mut::&LTR>().0 = 0;
</span><span> 
</span><span>         // trigger for both components, but no entities: trigger once
</span><span>         world.trigger_targets(EventA, (component_a, component_b));
</span><span style=color:#f07171>-        world.flush();
</span><span>         // all component observers trigger, entities are not observed
</span><span>         assert_eq!(1111100, world.resource::&LTR>().0);
</span><span>         world.resource_mut::&LTR>().0 = 0;
</span><span style=color:#c594c5>@@ -931,7 +906,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         // trigger for both entities and both components: trigger once per entity target
</span><span>         // we only get 2222211 because a given observer can trigger only once per entity target
</span><span>         world.trigger_targets(EventA, ((component_a, component_b), (entity_1, entity_2)));
</span><span style=color:#f07171>-        world.flush();
</span><span>         assert_eq!(2222211, world.resource::&LTR>().0);
</span><span>         world.resource_mut::&LTR>().0 = 0;
</span><span> 
</span><span style=color:#c594c5>@@ -940,7 +914,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             EventA,
</span><span>             (component_a, component_b, (component_a, component_b)),
</span><span>         );
</span><span style=color:#f07171>-        world.flush();
</span><span>         // the duplicate components in the tuple don't cause multiple triggers
</span><span>         assert_eq!(1111100, world.resource::&LTR>().0);
</span><span>         world.resource_mut::&LTR>().0 = 0;
</span><span style=color:#c594c5>@@ -955,7 +928,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>                 ((component_a, component_b), (component_a, component_b)),
</span><span>             ),
</span><span>         );
</span><span style=color:#f07171>-        world.flush();
</span><span>         // the duplicate components in the tuple don't cause multiple triggers
</span><span>         assert_eq!(1111100, world.resource::&LTR>().0);
</span><span>         world.resource_mut::&LTR>().0 = 0;
</span><span style=color:#c594c5>@@ -975,7 +947,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>                 ),
</span><span>             ),
</span><span>         );
</span><span style=color:#f07171>-        world.flush();
</span><span>         // the duplicate components in the tuple don't cause multiple triggers
</span><span>         assert_eq!(1111100, world.resource::&LTR>().0);
</span><span>         world.resource_mut::&LTR>().0 = 0;
</span><span style=color:#c594c5>@@ -1000,7 +971,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         let entity = entity.flush();
</span><span> 
</span><span>         world.trigger_targets(EventA, entity);
</span><span style=color:#f07171>-        world.flush();
</span><span>         assert_eq!(vec!["event_a"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1052,11 +1022,8 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             },
</span><span>         );
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns EntityWorldMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, child);
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         assert_eq!(vec!["child", "parent"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1079,11 +1046,8 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             })
</span><span>             .id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, [child, child]);
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         assert_eq!(
</span><span>             vec!["child", "parent", "child", "parent"],
</span><span>             world.resource::&LTOrder>().0
</span><span style=color:#c594c5>@@ -1109,11 +1073,7 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             })
</span><span>             .id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, [child, parent]);
</span><span style=color:#f07171>-        world.flush();
</span><span>         assert_eq!(
</span><span>             vec!["child", "parent", "parent"],
</span><span>             world.resource::&LTOrder>().0
</span><span style=color:#c594c5>@@ -1142,11 +1102,8 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             )
</span><span>             .id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, child);
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         assert_eq!(vec!["child"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1176,11 +1133,8 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             })
</span><span>             .id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, [child_a, child_b]);
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         assert_eq!(
</span><span>             vec!["child_a", "parent", "child_b", "parent"],
</span><span>             world.resource::&LTOrder>().0
</span><span style=color:#c594c5>@@ -1199,11 +1153,7 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             })
</span><span>             .id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, entity);
</span><span style=color:#f07171>-        world.flush();
</span><span>         assert_eq!(vec!["event"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1243,11 +1193,8 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             })
</span><span>             .id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, [child_a, child_b]);
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         assert_eq!(
</span><span>             vec!["child_a", "child_b", "parent_b"],
</span><span>             world.resource::&LTOrder>().0
</span><span style=color:#c594c5>@@ -1267,11 +1214,8 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         let parent = world.spawn(ChildOf(grandparent)).id();
</span><span>         let child = world.spawn(ChildOf(parent)).id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, child);
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         assert_eq!(vec!["event", "event", "event"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1292,11 +1236,8 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         let parent = world.spawn(ChildOf(grandparent)).id();
</span><span>         let child = world.spawn((A, ChildOf(parent))).id();
</span><span> 
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span>         world.trigger_targets(EventPropagating, child);
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         assert_eq!(vec!["event", "event"], world.resource::&LTOrder>().0);
</span><span>     }
</span><span> 
</span><span style=color:#c594c5>@@ -1314,7 +1255,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         let mut world = World::new();
</span><span>         world.add_observer(on_add);
</span><span>         world.spawn(A);
</span><span style=color:#f07171>-        world.flush();
</span><span>     }
</span><span> 
</span><span>     // Regression test for https://github.com/bevyengine/bevy/issues/14467
</span><span style=color:#c594c5>@@ -1367,9 +1307,7 @@ </span><span style=color:#399ee6>mod tests {
</span><span>                 params.p1().insert_resource(ResA);
</span><span>             },
</span><span>         );
</span><span style=color:#f07171>-        // TODO: ideally this flush is not necessary, but right now observe() returns WorldEntityMut
</span><span style=color:#f07171>-        // and therefore does not automatically flush.
</span><span style=color:#f07171>-        world.flush();
</span><span style=color:#86b300>+
</span><span>         world.trigger(EventA);
</span><span>         world.flush();
</span><span> 
</span><span style=color:#c594c5>@@ -1405,7 +1343,6 @@ </span><span style=color:#399ee6>mod tests {
</span><span>             assert_eq!(trigger.caller(), caller);
</span><span>         });
</span><span>         world.commands().spawn(Component).clear();
</span><span style=color:#f07171>-        world.flush();
</span><span>     }
</span><span> 
</span><span>     #[test]
</span><span style=color:#c594c5>@@ -1425,14 +1362,12 @@ </span><span style=color:#399ee6>mod tests {
</span><span>                 }
</span><span>             },
</span><span>         );
</span><span style=color:#f07171>-        world.flush();
</span><span> 
</span><span>         world.trigger_targets(EventA, [a_id, b_id]);
</span><span>         world.trigger_targets(EventA, a_id);
</span><span>         world.trigger_targets(EventA, b_id);
</span><span>         world.trigger_targets(EventA, [a_id, b_id]);
</span><span>         world.trigger_targets(EventA, a_id);
</span><span style=color:#f07171>-        world.flush();
</span><span> 
</span><span>         let counter = world.resource::&LTCounter>();
</span><span>         assert_eq!(4, *counter.0.get(&a_id).unwrap());
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20234.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>