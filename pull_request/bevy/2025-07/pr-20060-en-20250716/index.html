<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20060 Change `event` to `event_key` where it refers to an `EventKey`
        
    </title><meta content="#20060 Change `event` to `event_key` where it refers to an `EventKey`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20060-zh-cn-20250716>中文</a></div></div><div class=pr-content><h2 id=change-event-to-event-key-where-it-refers-to-an-eventkey>Change <code>event</code> to <code>event_key</code> where it refers to an <code>EventKey</code></h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Change <code>event</code> to <code>event_key</code> where it refers to an <code>EventKey</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20060<li><strong>Author</strong>: SteveAlexander<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-ECS, C-Code-Quality, S-Needs-Review<li><strong>Created</strong>: 2025-07-09T15:17:19Z<li><strong>Merged</strong>: 2025-07-16T18:42:05Z<li><strong>Merged By</strong>: mockersf</ul><h3 id=description>Description</h3><p>The ECS code to do with Observers was recently refactored to use an <code>EventKey</code> newtype. On reading through the PR, I was a bit confused that sometimes a variable called <code>event</code> refers to an <code>Event</code> and sometimes it refers to an <code>EventKey</code>. I think the code is clearer when <code>event</code> refers to an <code>Event</code> and <code>event_key</code> refers to an <code>EventKey</code>.<p>This PR renames some uses of <code>event</code> to <code>event_key</code>.<p><strong>Testing</strong><ul><li>Did you test these changes? If so, how?<br> I ran <code>cargo run -p ci -- tests</code><li>Are there any parts that need more testing?<br> No<li>How can other people (reviewers) test your changes? Is there anything specific they need to know?<br> No.<li>If relevant, what platforms did you test these changes on, and are there any important ones you can’t test?<br> Probably not relevant, but MacOS.</ul><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><p>Recent refactoring in Bevy’s ECS introduced the <code>EventKey</code> newtype to handle observer functionality. This created a naming conflict where the variable <code>event</code> was used ambiguously - sometimes referring to an actual event (<code>Event</code>) and other times to an event identifier (<code>EventKey</code>). This ambiguity made the code harder to understand and maintain.<p>The solution involved systematically renaming variables, parameters, and fields from <code>event</code> to <code>event_key</code> wherever they referred to an <code>EventKey</code> instance. This change improves code clarity by establishing a consistent naming convention: <code>event</code> refers to actual event data, while <code>event_key</code> specifically identifies event types through their <code>EventKey</code> identifiers.<p>Implementation required updating multiple locations across the observer system:<ol><li>Method parameters were renamed (e.g., <code>with_event</code> became <code>with_event_key</code>)<li>Field names were updated (<code>events</code> became <code>event_keys</code>)<li>Comments and documentation strings were revised to reflect the new terminology<li>Internal logic using these identifiers was updated accordingly</ol><p>The changes maintain identical runtime behavior while significantly improving code readability. By separating concerns in naming, developers can now more easily distinguish between:<ul><li>Event data (handled as <code>Event</code>)<li>Event type identifiers (handled as <code>EventKey</code>)<li>Observer registration logic<li>Event triggering mechanisms</ul><p>For example, the <code>ObserverDescriptor</code> struct was updated to better reflect its purpose:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ObserverDescriptor </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(super) events</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEventKey>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ObserverDescriptor </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub</span><span>(super) event_keys</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEventKey>,
</span><span>}
</span></code></pre><p>Similarly, method signatures were updated for clarity:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>with_event</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>event</span><span style=color:#61676ccc>:</span><span> EventKey) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>with_event_key</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>event_key</span><span style=color:#61676ccc>:</span><span> EventKey) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self
</span></code></pre><p>The renaming also propagated through observer invocation logic, where the key distinction between event types and event data is critical for correct operation. The <code>trigger_observers</code> method demonstrates this:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>trigger_observers</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>event</span><span style=color:#61676ccc>:</span><span> EventKey,
</span><span>)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>trigger_observers</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>event_key</span><span style=color:#61676ccc>:</span><span> EventKey,
</span><span>)
</span></code></pre><p>These changes required updates to 6 files with 29 lines modified. The PR maintains full backward compatibility while making the codebase more maintainable. The explicit naming convention reduces cognitive load when working with observers and helps prevent type confusion during future development.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Observer System] --> B[EventKey]
</span><span>    B --> C[Trigger Observers]
</span><span>    B --> D[Register Observers]
</span><span>    C --> E[Event Processing]
</span><span>    D --> F[ObserverDescriptor]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><ol><li><p><strong>crates/bevy_ecs/src/observer/distributed_storage.rs</strong> (+15/-15)<br> Updated field names and method parameters to use <code>event_key</code> terminology.<br> Key changes:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>super</span><span>) events</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEventKey></span><span style=color:#61676ccc>,
</span><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>with_event</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>event</span><span style=color:#61676ccc>:</span><span> EventKey) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>super</span><span>) event_keys</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEventKey></span><span style=color:#61676ccc>,
</span><span style=color:#fa6e32>pub unsafe fn </span><span style=color:#f29718>with_event_key</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>event_key</span><span style=color:#61676ccc>:</span><span> EventKey) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self
</span></code></pre><li><p><strong>crates/bevy_ecs/src/world/deferred_world.rs</strong> (+7/-7)<br> Updated method parameters in observer triggering logic.<br> Key changes:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>trigger_observers</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>event</span><span style=color:#61676ccc>:</span><span> EventKey)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>unsafe fn </span><span style=color:#f29718>trigger_observers</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>event_key</span><span style=color:#61676ccc>:</span><span> EventKey)
</span></code></pre><li><p><strong>crates/bevy_ecs/src/observer/mod.rs</strong> (+4/-4)<br> Updated iteration logic to use renamed <code>event_keys</code> field.<br> Key change:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>for </span><span style=color:#ed9366>&</span><span>event_key </span><span style=color:#ed9366>in &</span><span>descriptor</span><span style=color:#ed9366>.</span><span>events
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>for </span><span style=color:#ed9366>&</span><span>event_key </span><span style=color:#ed9366>in &</span><span>descriptor</span><span style=color:#ed9366>.</span><span>event_keys
</span></code></pre><li><p><strong>crates/bevy_ecs/src/event/registry.rs</strong> (+1/-1)<br> Improved comment clarity regarding <code>EventKey</code> usage.<br> Key change:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: The component ID and the function must be used...
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// SAFETY: The `EventKey`'s component ID and the function must be used...
</span></code></pre><li><p><strong>crates/bevy_ecs/src/observer/entity_cloning.rs</strong> (+1/-1)<br> Updated field reference during entity cloning.<br> Key change:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> event_keys </span><span style=color:#ed9366>=</span><span> observer_state</span><span style=color:#ed9366>.</span><span>descriptor</span><span style=color:#ed9366>.</span><span>events</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> event_keys </span><span style=color:#ed9366>=</span><span> observer_state</span><span style=color:#ed9366>.</span><span>descriptor</span><span style=color:#ed9366>.</span><span>event_keys</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre></ol><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/observer/index.html target=_blank>Bevy ECS Observer System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rust-by-example/generics/new_types.html target=_blank>Newtype Pattern in Rust</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/events/ target=_blank>Bevy Events System Guide</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20060.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>