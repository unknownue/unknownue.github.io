<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18358 Fix Scene hot reloading.
        
    </title><meta content="#18358 Fix Scene hot reloading." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-21</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-18358-zh-cn-20250721>中文</a></div></div><div class=pr-content><h1 id=fix-scene-hot-reloading>Fix Scene hot reloading.</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix Scene hot reloading.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18358<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, S-Ready-For-Final-Review, A-Scenes, M-Needs-Migration-Guide, D-Modest<li><strong>Created</strong>: 2025-03-17T07:44:21Z<li><strong>Merged</strong>: 2025-07-21T22:30:42Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fixes #14698</ul><h2 id=solution>Solution</h2><ul><li>Refactor all the <code>SceneSpawner</code> functions to include a <code>_dynamic</code> suffix where appropriate.<li>Add non-DynamicScene versions of functions on <code>SceneSpawner</code>.<li>Listen for <code>Scene</code> <code>AssetEvent</code>s and update the corresponding spawned scenes.<li>Despawn scenes before respawning them.<li>Store the parent of a scene in its <code>InstanceInfo</code>, so that we know where to parent the new entities from a hot-reloaded scene.<li>Make <code>InstanceInfo</code> private (none of our APIs returned it anyway).</ul><h2 id=testing>Testing</h2><ul><li>Ran the <code>hot_asset_reloading</code> example and mutated the GLTF to see it be updated. It works! Moving around meshes works in Blender works, deleting meshes also seems to work.<li>Wrote a test for scene and dynamic scene to ensure they continue to hot-reload.</ul><hr><h2 id=migration-guide>Migration Guide</h2><ul><li>Some of the methods on <code>SceneSpawner</code> have been renamed: <ul><li><code>despawn</code> -> <code>despawn_dynamic</code><li><code>despawn_sync</code> -> <code>despawn_dynamic_sync</code><li><code>update_spawned_scenes</code> -> <code>update_spawned_dynamic_scenes</code></ul><li>In their place, we’ve also added <code>despawn</code>, <code>despawn_sync</code>, and <code>update_spawned_scenes</code> which all act on <code>Scene</code>s (as opposed to <code>DynamicScene</code>s).</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Scene hot reloading wasn’t working correctly in Bevy. When developers modified scene assets at runtime, existing scene instances wouldn’t update to reflect the changes. This was particularly problematic for workflows requiring iterative design changes, where seeing immediate updates without restarting the application is crucial. The core issue was that the scene management system wasn’t properly listening for asset modifications and lacked mechanisms to update existing scene instances.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution involved several coordinated changes to the scene spawning system. First, we needed to distinguish between regular <code>Scene</code> and <code>DynamicScene</code> operations in the API. Second, we implemented proper asset event handling for both scene types. Third, we modified the update process to completely despawn old scene instances before respawning updated versions to avoid entity duplication and hierarchy corruption. Finally, we added parent tracking to ensure reloaded scenes maintain their original hierarchy positions.<h3 id=the-implementation>The Implementation</h3><p>The implementation centered around refactoring <code>SceneSpawner</code> to handle both scene types separately. We added dedicated tracking for regular scenes alongside existing dynamic scene handling. The key changes included:<ol><li><p><strong>API Refactoring</strong>: We renamed dynamic scene methods (<code>despawn</code>, <code>despawn_sync</code>, <code>update_spawned_scenes</code>) with <code>_dynamic</code> suffixes and added parallel methods for regular scenes:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>despawn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> impl </span><span style=color:#55b4d4;font-style:italic>Into</span><span>&LTAssetId&LTDynamicScene>>)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>despawn_dynamic</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> impl </span><span style=color:#55b4d4;font-style:italic>Into</span><span>&LTAssetId&LTDynamicScene>>)
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>despawn</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>:</span><span> impl </span><span style=color:#55b4d4;font-style:italic>Into</span><span>&LTAssetId&LTScene>>)
</span></code></pre><li><p><strong>Asset Event Handling</strong>: We added separate event readers for <code>Scene</code> and <code>DynamicScene</code> asset events:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>struct </span><span style=color:#399ee6>SceneSpawner </span><span>{
</span><span>    scene_asset_event_reader</span><span style=color:#61676ccc>: </span><span>EventCursor&LTAssetEvent&LTScene>>,
</span><span>    dynamic_scene_asset_event_reader</span><span style=color:#61676ccc>: </span><span>EventCursor&LTAssetEvent&LTDynamicScene>>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><li><p><strong>Instance Management</strong>: We modified <code>InstanceInfo</code> to store parent relationships and made it private since it wasn’t part of the public API:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>struct </span><span style=color:#399ee6>InstanceInfo </span><span>{
</span><span>    entity_map</span><span style=color:#61676ccc>: </span><span>EntityHashMap&LTEntity>,
</span><span>    parent</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTEntity>,  </span><span style=color:#abb0b6;font-style:italic>// New parent tracking
</span><span>}
</span></code></pre><li><p><strong>Hot Reload Process</strong>: When detecting scene modifications, we now fully despawn existing instances before respawning:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>despawn_instance_internal(world</span><span style=color:#61676ccc>,</span><span> instance_info)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>spawn_sync_internal(world</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>*</span><span>id</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> instance_info</span><span style=color:#ed9366>.</span><span>entity_map)</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span></code></pre></ol><h3 id=technical-insights>Technical Insights</h3><p>The complete despawn/respawn approach ensures clean state transitions but has performance implications for large scenes. The parent tracking in <code>InstanceInfo</code> solves hierarchy preservation during reloads. Making <code>InstanceInfo</code> private simplifies the API surface while allowing internal implementation flexibility. The test coverage for both scene types ensures consistent behavior across different scene representations.<h3 id=the-impact>The Impact</h3><p>This fix enables reliable scene hot-reloading for iterative workflows. Developers can now modify scene assets at runtime and see immediate updates in running applications. The API changes clarify the separation between regular and dynamic scenes, though they require minor migration for existing dynamic scene users. The solution maintains Bevy’s ECS consistency by properly cleaning up entities during reloads.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[SceneSpawner] --> B[Scene Handling]
</span><span>    A --> C[DynamicScene Handling]
</span><span>    B --> D[AssetEvent Monitoring]
</span><span>    B --> E[Instance Tracking]
</span><span>    C --> F[AssetEvent Monitoring]
</span><span>    C --> G[Instance Tracking]
</span><span>    E --> H[Despawn/Respawn]
</span><span>    G --> H
</span><span>    H --> I[Parent Reattachment]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><p><code>crates/bevy_scene/src/lib.rs</code> (+303/-0)<br> Added comprehensive tests for scene hot-reloading:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>scene_spawns_and_respawns_after_change</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Setup scene with Rectangle and Circle
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... 
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Modify scene asset
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world_mut</span><span>()</span><span style=color:#ed9366>.</span><span>resource_mut</span><span style=color:#ed9366>::</span><span>&LTAssets&LTScene>>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(</span><span style=color:#ed9366>&</span><span>scene_handle</span><span style=color:#61676ccc>,</span><span> scene_2)</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Verify update
</span><span>    </span><span style=color:#fa6e32>let</span><span> children </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>world</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(child_root)</span><span style=color:#ed9366>.</span><span>get</span><span style=color:#ed9366>::</span><span>&LTChildren>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#f07171>assert_eq!</span><span>(children</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1</span><span>)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Now contains Triangle
</span><span>}
</span></code></pre><li><p><code>crates/bevy_scene/src/scene_spawner.rs</code> (+175/-89)<br> Core scene management changes:</p> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_spawned_scenes</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World, </span><span style=color:#ff8f40>scene_ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[AssetId&LTDynamicScene>]) 
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_spawned_scenes</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World, </span><span style=color:#ff8f40>scene_ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[AssetId&LTScene>])
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>update_spawned_dynamic_scenes</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World, </span><span style=color:#ff8f40>scene_ids</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[AssetId&LTDynamicScene>])
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Internal despawning logic:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>despawn_instance_internal</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World, </span><span style=color:#ff8f40>instance</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> InstanceInfo) {
</span><span>    </span><span style=color:#fa6e32>for </span><span style=color:#ed9366>&</span><span>entity </span><span style=color:#ed9366>in</span><span> instance</span><span style=color:#ed9366>.</span><span>entity_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>values</span><span>() {
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(entity_mut) </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_entity_mut</span><span>(entity) {
</span><span>            entity_mut</span><span style=color:#ed9366>.</span><span style=color:#f07171>despawn</span><span>()</span><span style=color:#61676ccc>;
</span><span>        }</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><li><p><code>release-content/migration-guides/scene_spawner_api.md</code> (+12/-0)<br> Added migration documentation:</p> <pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>Some methods on </span><span style=color:#ed9366;background-color:#61676c10>`SceneSpawner`</span><span> have been renamed:
</span><span>    - </span><span style=color:#ed9366;background-color:#61676c10>`despawn`</span><span> -> </span><span style=color:#ed9366;background-color:#61676c10>`despawn_dynamic`</span><span>
</span><span>    - </span><span style=color:#ed9366;background-color:#61676c10>`despawn_sync`</span><span> -> </span><span style=color:#ed9366;background-color:#61676c10>`despawn_dynamic_sync`</span><span>
</span><span>    - </span><span style=color:#ed9366;background-color:#61676c10>`update_spawned_scenes`</span><span> -> </span><span style=color:#ed9366;background-color:#61676c10>`update_spawned_dynamic_scenes`</span><span>
</span><span>
</span><span>In their place, we've added </span><span style=color:#ed9366;background-color:#61676c10>`despawn`</span><span>, </span><span style=color:#ed9366;background-color:#61676c10>`despawn_sync`</span><span>, and </span><span style=color:#ed9366;background-color:#61676c10>`update_spawned_scenes`</span><span> which all act on
</span><span style=color:#ed9366;background-color:#61676c10>`Scene`</span><span>s (as opposed to </span><span style=color:#ed9366;background-color:#61676c10>`DynamicScene`</span><span>s).
</span></code></pre></ol><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/assets/ target=_blank>Bevy Assets Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Entity_component_system target=_blank>Entity Component System Architecture</a><li><a rel="noopener nofollow noreferrer" href=https://gameprogrammingpatterns.com/ target=_blank>Hot Reloading Patterns in Game Engines</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_18358.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>