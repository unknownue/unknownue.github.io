<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19967 Remove `Bundle::register_required_components`
        
    </title><meta content="#19967 Remove `Bundle::register_required_components`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-06</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-07/pr-19967-en-20250706>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=remove-bundle-register-required-components>Remove <code>Bundle::register_required_components</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Remove <code>Bundle::register_required_components</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19967<li><strong>Author</strong>: SkiFire13<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, C-Code-Quality, S-Ready-For-Final-Review, M-Needs-Migration-Guide<li><strong>Created</strong>: 2025-07-05T18:31:25Z<li><strong>Merged</strong>: 2025-07-06T18:35:30Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li><code>Bundle::register_required_components</code> 没有被使用，所以移除它</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>在 Bevy 的 ECS 实现中，<code>Bundle</code> trait 定义了一个方法 <code>register_required_components</code>，用于注册组件依赖关系。这个方法最初是为了处理组件注册时的依赖关系而设计的，但在实际实现中，ECS 系统从未调用过这个方法。经过代码审查，开发者发现该方法在整个代码库中没有任何调用点，变成了完全未使用的死代码。<p>死代码的存在会增加代码维护的复杂性，可能误导开发者认为这个方法有实际作用，并在未来重构中产生不必要的困惑。因此，开发者决定将其移除以简化代码结构。<p>解决方案是直接删除该方法及其所有实现。由于该方法从未被调用，移除操作不会影响现有功能。具体修改包括：<ol><li>从 <code>Bundle</code> trait 中移除方法声明<li>删除所有 <code>Bundle</code> 实现中的具体方法定义<li>更新 <code>derive(Bundle)</code> 宏不再生成该方法<li>添加迁移指南说明该变更</ol><p>在实现上，开发者系统性地移除了四个文件中的相关代码：<ul><li><code>bundle.rs</code>：移除 trait 声明和基础实现<li><code>spawn.rs</code>：移除特殊 Bundle 类型的实现<li><code>lib.rs</code>（宏）：修改派生宏<li>新增迁移指南文档</ul><p>迁移指南明确指出该方法从未被使用，开发者如果自定义了实现可以直接删除。如果发现任何非常规使用场景，建议提交 issue 报告。<p>该 PR 被标记为 trivial（D-Trivial）和代码质量改进（C-Code-Quality），因为它移除了未使用的代码而未改变功能。ECS 团队快速审查后合并了该变更，认为它能减少代码维护负担并简化 Bundle trait 的接口。<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Bundle Trait] -->|移除| B[register_required_components 方法]
</span><span>    B --> C[基础组件实现]
</span><span>    B --> D[元组实现]
</span><span>    B --> E[派生宏]
</span><span>    B --> F[特殊 Bundle 类型]
</span><span>    G[迁移指南] -->|说明| B
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=1-crates-bevy-ecs-src-bundle-rs>1. <code>crates/bevy_ecs/src/bundle.rs</code></h3><p><strong>修改说明</strong>：从 Bundle trait 中移除 register_required_components 方法，并删除其在基础组件和元组实现中的代码<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub unsafe trait </span><span style=color:#399ee6>Bundle</span><span>: DynamicBundle + Send + Sync + 'static {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_required_components</span><span>(
</span><span>        </span><span style=color:#ff8f40>_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentsRegistrator,
</span><span>        </span><span style=color:#ff8f40>_required_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> RequiredComponents,
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>unsafe impl</span><span>&LTC</span><span style=color:#61676ccc>:</span><span> Component> Bundle </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>C </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_required_components</span><span>(
</span><span>        </span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentsRegistrator,
</span><span>        </span><span style=color:#ff8f40>required_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> RequiredComponents,
</span><span>    ) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Implementation details
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#f07171>macro_rules! </span><span style=color:#399ee6>tuple_impl </span><span>{
</span><span>    (</span><span style=color:#ed9366>$</span><span>($name: ident),</span><span style=color:#ed9366>*</span><span>) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#fa6e32>unsafe impl</span><span><$($name: Bundle),*> Bundle </span><span style=color:#fa6e32>for</span><span> ($($name,)*) {
</span><span>            </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_required_components</span><span>(
</span><span>                </span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ComponentsRegistrator,
</span><span>                </span><span style=color:#ff8f40>required_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> RequiredComponents,
</span><span>            ) {
</span><span>                </span><span style=color:#ed9366>$</span><span>(</span><span style=color:#ed9366><</span><span>$name </span><span style=color:#ed9366>as</span><span> Bundle</span><span style=color:#ed9366>>::</span><span>register_required_components(components</span><span style=color:#61676ccc>,</span><span> required_components)</span><span style=color:#61676ccc>;</span><span>)</span><span style=color:#ed9366>*
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub unsafe trait </span><span style=color:#399ee6>Bundle</span><span>: DynamicBundle + Send + Sync + 'static {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// register_required_components 方法被移除
</span><span>}
</span><span>
</span><span style=color:#fa6e32>unsafe impl</span><span>&LTC</span><span style=color:#61676ccc>:</span><span> Component> Bundle </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>C </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// register_required_components 实现被移除
</span><span>}
</span><span>
</span><span style=color:#f07171>macro_rules! </span><span style=color:#399ee6>tuple_impl </span><span>{
</span><span>    (</span><span style=color:#ed9366>$</span><span>($name: ident),</span><span style=color:#ed9366>*</span><span>) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#fa6e32>unsafe impl</span><span><$($name: Bundle),*> Bundle </span><span style=color:#fa6e32>for</span><span> ($($name,)*) {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// register_required_components 实现被移除
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=2-crates-bevy-ecs-src-spawn-rs>2. <code>crates/bevy_ecs/src/spawn.rs</code></h3><p><strong>修改说明</strong>：从 SpawnRelatedBundle 和 SpawnOneRelated 的 Bundle 实现中移除该方法<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>unsafe impl</span><span>&LTR</span><span style=color:#61676ccc>:</span><span> Relationship, L</span><span style=color:#61676ccc>: </span><span>SpawnableList&LTR> </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Sync </span><span style=color:#ed9366>+ </span><span style=color:#fa6e32>'static</span><span>> Bundle </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SpawnRelatedBundle</span><span>&LTR, L> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_required_components</span><span>(
</span><span>        </span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>crate</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>ComponentsRegistrator,
</span><span>        </span><span style=color:#ff8f40>required_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>crate</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>RequiredComponents,
</span><span>    ) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Implementation
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>unsafe impl</span><span>&LTR</span><span style=color:#61676ccc>:</span><span> Relationship, B</span><span style=color:#61676ccc>:</span><span> Bundle> Bundle </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SpawnOneRelated</span><span>&LTR, B> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_required_components</span><span>(
</span><span>        </span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>crate</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>ComponentsRegistrator,
</span><span>        </span><span style=color:#ff8f40>required_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>crate</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>RequiredComponents,
</span><span>    ) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Implementation
</span><span>    }
</span><span>}
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// register_required_components 方法实现被完全移除
</span></code></pre><h3 id=3-crates-bevy-ecs-macros-src-lib-rs>3. <code>crates/bevy_ecs/macros/src/lib.rs</code></h3><p><strong>修改说明</strong>：修改 derive(Bundle) 宏不再生成 register_required_components 方法<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_required_components</span><span>(
</span><span>    </span><span style=color:#ff8f40>components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> #ecs_path</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>ComponentsRegistrator,
</span><span>    </span><span style=color:#ff8f40>required_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> #ecs_path</span><span style=color:#ed9366>::</span><span>component</span><span style=color:#ed9366>::</span><span>RequiredComponents
</span><span>) {
</span><span>    </span><span style=color:#ed9366>#</span><span>(</span><span style=color:#ed9366><#</span><span>active_field_types </span><span style=color:#ed9366>as #</span><span>ecs_path</span><span style=color:#ed9366>::</span><span>bundle</span><span style=color:#ed9366>::</span><span>Bundle</span><span style=color:#ed9366>>::</span><span>register_required_components(components</span><span style=color:#61676ccc>,</span><span> required_components)</span><span style=color:#61676ccc>;</span><span>)</span><span style=color:#ed9366>*
</span><span>}
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// 整个 register_required_components 方法生成代码被移除
</span></code></pre><h3 id=4-release-content-migration-guides-remove-bundle-register-required-components-md>4. <code>release-content/migration-guides/remove_bundle_register_required_components.md</code></h3><p><strong>修改说明</strong>：新增迁移指南解释该变更<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#abb0b6;background-color:#61676c10;font-weight:700>---
</span><span>title: Remove Bundle::register_required_components
</span><span>pull_requests: [19967]
</span><span style=color:#fa6e32;font-weight:700>---
</span><span>
</span><span>This method was effectively dead-code as it was never used by the ECS to compute required components, hence it was removed. if you were overriding its implementation you can just remove it, as it never did anything. If you were using it in any other way, please open an issue.
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ecs/bundles/ target=_blank>Bevy ECS Bundle 文档</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/rustc/lints/listing/warn-by-default.html#unused-code target=_blank>Rust 死代码检测 (unused_code lint)</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/19967 target=_blank>PR 讨论与审查历史</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_19967.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>