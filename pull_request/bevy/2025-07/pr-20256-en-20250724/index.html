<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20256 Better `ScheduleBuildError` introspection and handling
        
    </title><meta content="#20256 Better `ScheduleBuildError` introspection and handling" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20256-zh-cn-20250724>中文</a></div></div><div class=pr-content><h1 id=technical-analysis-of-pr-20256-better-schedulebuilderror-introspection-and-handling>Technical Analysis of PR #20256: Better <code>ScheduleBuildError</code> introspection and handling</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Better <code>ScheduleBuildError</code> introspection and handling<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20256<li><strong>Author</strong>: ItsDoot<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Code-Quality, S-Ready-For-Final-Review, D-Modest<li><strong>Created</strong>: 2025-07-23T02:29:27Z<li><strong>Merged</strong>: 2025-07-24T05:43:20Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><h3 id=objective>Objective</h3><ul><li>Part of #20115</ul><p>I want to pull out the ad-hoc graph manipulation and analysis functions into generalized reusable functions, but in doing so encounter some borrow-checker issues. This is because the graphs are mutably borrowed during the build process at the points where we need to render warning and error messages (which require full access to the <code>ScheduleGraph</code>).<h3 id=solution>Solution</h3><p>So, lets defer message rendering until the consumer actually needs it:<ul><li>Replaced <code>String</code>s in <code>ScheduleBuildError</code> variants with just the <code>NodeId</code>/<code>SystemKey</code>/<code>SystemSetKey</code>.<li>Added <code>ScheduleBuildError::to_string</code> to render the messages as they were previously.<li>Added <code>ScheduleBuildWarning</code>, a subset of the error enum of just the possible warnings.<li>Collected warnings into a <code>Vec</code> and returned them from the build process, caching them in the <code>Schedule</code> and made accessible via <code>Schedule::warnings</code>. Additionally automatically <code>warn!()</code> these warnings after the schedule is built.<li>Exposed <code>ScheduleGraph::get_node_name</code> so external consumers can do any special rendering themselves.<li>Finally, moved <code>ScheduleBuildError</code> and <code>ScheduleBuildWarning</code> to their own files to help incrementally minimize the large <code>schedule.rs</code> module.</ul><h3 id=testing>Testing</h3><p>Reusing current tests.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>When working on refactoring Bevy’s ECS schedule graph manipulation code, the author encountered borrow checker conflicts. The core issue was that schedule graph analysis functions needed to generate human-readable error messages while still holding mutable references to the graph. This required accessing node names (which required the graph) during error construction, creating a conflict between the mutable borrow for graph analysis and the immutable borrow needed for name resolution.<p>The existing implementation stored fully formatted error strings in <code>ScheduleBuildError</code> variants. This required resolving node names immediately during error detection, which in turn required access to the <code>ScheduleGraph</code>. Since the graph was being mutated during analysis, this created a borrow checker violation when attempting to extract node names for error messages.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution involved decoupling error detection from message formatting:<ol><li>Store minimal identifiers (NodeId/SystemKey/SystemSetKey) in errors instead of formatted strings<li>Defer string formatting until error display time<li>Separate non-fatal warnings into their own type<li>Collect warnings separately during schedule building<li>Expose node name resolution publicly for custom formatting</ol><p>This approach allows the graph analysis to complete without needing to format messages during mutable borrows. The actual string formatting happens later when the errors or warnings are handled, at which point the graph is no longer mutably borrowed.<h3 id=the-implementation>The Implementation</h3><p>The implementation consisted of several key changes:<ol><li><strong>Error type refactoring</strong>: <ul><li><code>ScheduleBuildError</code> variants now store identifiers instead of strings<li>Added <code>to_string()</code> method that takes <code>&ScheduleGraph</code> and <code>&World</code> for formatting<li>Created new <code>ScheduleBuildWarning</code> type for non-fatal issues</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>error</span><span>(</span><span style=color:#86b300>"System set `{0}` contains itself."</span><span>)]
</span><span>HierarchyLoop(</span><span style=color:#55b4d4;font-style:italic>String</span><span>)</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>error</span><span>(</span><span style=color:#86b300>"System set `{0:?}` contains itself."</span><span>)]
</span><span>HierarchyLoop(NodeId)</span><span style=color:#61676ccc>,
</span></code></pre><ol start=2><li><strong>Warning collection</strong>: <ul><li>Added <code>warnings</code> field to <code>Schedule</code> struct<li>Modified build process to return warnings<li>Added automatic warning logging after schedule initialization</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Schedule </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    warnings</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTScheduleBuildWarning>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Schedule </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>initialize</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), ScheduleBuildError> {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>warnings </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>graph
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>update_schedule</span><span>(world</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>executable</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>ignored_ambiguities)</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>for</span><span> warning </span><span style=color:#ed9366>in &</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>warnings {
</span><span>            </span><span style=color:#f07171>warn!</span><span>(
</span><span>                </span><span style=color:#86b300>"{:?} schedule built successfully, however: {}"</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>label</span><span style=color:#61676ccc>,
</span><span>                warning</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>graph</span><span style=color:#61676ccc>,</span><span> world)
</span><span>            )</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }
</span><span>}
</span></code></pre><ol start=3><li><strong>Public name resolution</strong>: <ul><li>Made <code>ScheduleGraph::get_node_name</code> public for external formatting<li>This allows consumers to format custom messages using the same name resolution</ul></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ScheduleGraph </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_node_name</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>NodeId) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... implementation ...
</span><span>    }
</span><span>}
</span></code></pre><ol start=4><li><strong>Code organization</strong>: <ul><li>Moved error types to new <code>error.rs</code> file<li>Reduced <code>schedule.rs</code> size by ~114 lines</ul></ol><h3 id=technical-insights>Technical Insights</h3><p>The key insight was separating data collection (error detection) from presentation (message formatting). By storing only identifiers in errors, the graph analysis can complete without formatting strings. The actual formatting happens later when:<ol><li>An error is handled (via <code>to_string()</code>)<li>Warnings are logged after schedule initialization<li>Users access warnings via <code>Schedule::warnings()</code></ol><p>This approach resolves the borrow checker conflict because:<ul><li>Graph mutation happens during analysis when we have mutable access<li>Message formatting happens later with immutable access</ul><h3 id=the-impact>The Impact</h3><ol><li><strong>Borrow checker compliance</strong>: Enables graph analysis refactoring by resolving mutable borrow conflicts<li><strong>Improved warning handling</strong>: <ul><li>Warnings are now properly separated from errors<li>Warnings are collected and exposed via API<li>Automatic logging after schedule build</ul><li><strong>Better error introspection</strong>: <ul><li>Access to raw identifiers enables custom error handling<li><code>to_string()</code> provides the same formatted messages as before</ul><li><strong>Code organization</strong>: <ul><li>Reduced <code>schedule.rs</code> size by moving errors to dedicated module<li>Clearer separation of concerns</ul></ol><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[Schedule Build Process] --> B[Detect Issues]
</span><span>    B --> C{Issue Type}
</span><span>    C -->|Error| D[Store Node IDs in ScheduleBuildError]
</span><span>    C -->|Warning| E[Store Node IDs in ScheduleBuildWarning]
</span><span>    D --> F[Return Error]
</span><span>    E --> G[Collect Warnings]
</span><span>    G --> H[Store in Schedule]
</span><span>    H --> I[Log Warnings]
</span><span>    F --> J[Propagate Error]
</span><span>    I --> K[User Sees Warnings]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-schedule-error-rs-261-0><code>crates/bevy_ecs/src/schedule/error.rs</code> (+261/-0)</h3><p>New file containing error and warning definitions and formatting logic:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>ScheduleBuildError </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>error</span><span>(</span><span style=color:#86b300>"System set `{0:?}` contains itself."</span><span>)]
</span><span>    HierarchyLoop(NodeId)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other variants ...
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ScheduleBuildError </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>to_string</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>graph</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>ScheduleGraph, </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>World) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>        </span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self </span><span>{
</span><span>            ScheduleBuildError</span><span style=color:#ed9366>::</span><span>HierarchyLoop(node_id) </span><span style=color:#ed9366>=> </span><span>{
</span><span>                </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>hierarchy_loop_to_string(node_id</span><span style=color:#61676ccc>,</span><span> graph)
</span><span>            }
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// ... other cases ...
</span><span>        }
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>hierarchy_loop_to_string</span><span>(</span><span style=color:#ff8f40>node_id</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>NodeId, </span><span style=color:#ff8f40>graph</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>ScheduleGraph) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>        </span><span style=color:#f07171>format!</span><span>(
</span><span>            </span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300> `</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>` contains itself"</span><span style=color:#61676ccc>,
</span><span>            node_id</span><span style=color:#ed9366>.</span><span style=color:#f07171>kind</span><span>()</span><span style=color:#61676ccc>,
</span><span>            graph</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_node_name</span><span>(node_id)
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>ScheduleBuildWarning </span><span>{
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>error</span><span>(</span><span style=color:#86b300>"The hierarchy of system sets contains redundant edges: {0:?}"</span><span>)]
</span><span>    HierarchyRedundancy(</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(NodeId, NodeId)>)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other variants ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-schedule-schedule-rs-92-206><code>crates/bevy_ecs/src/schedule/schedule.rs</code> (+92/-206)</h3><p>Major changes to error handling and warning collection:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>get_hierarchy_cycles_error_message</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>cycles</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[</span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTN>]) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Complex string formatting
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Removed all message formatting functions
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Added warnings field
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Schedule </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    warnings</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTScheduleBuildWarning>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>Schedule </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>initialize</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), ScheduleBuildError> {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>warnings </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>graph
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>update_schedule</span><span>(world</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>executable</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>ignored_ambiguities)</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>for</span><span> warning </span><span style=color:#ed9366>in &</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>warnings {
</span><span>            </span><span style=color:#f07171>warn!</span><span>(
</span><span>                </span><span style=color:#86b300>"{:?} schedule built successfully, however: {}"</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>label</span><span style=color:#61676ccc>,
</span><span>                warning</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>graph</span><span style=color:#61676ccc>,</span><span> world)
</span><span>            )</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>warnings</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>[ScheduleBuildWarning] {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>warnings
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Made node name resolution public
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ScheduleGraph </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_node_name</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>id</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>NodeId) </span><span style=color:#61676ccc>-></span><span> String {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... implementation ...
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-schedule-mod-rs-17-13><code>crates/bevy_ecs/src/schedule/mod.rs</code> (+17/-13)</h3><p>Integration of new error module:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before
</span><span style=color:#abb0b6;font-style:italic>// ... existing imports ...
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>error</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ...
</span><span style=color:#fa6e32>pub use </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>::</span><span>{condition</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>config</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>error</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>executor</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>node</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>schedule</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>set</span><span style=color:#ed9366>::*</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=release-content-migration-guides-schedule-cleanup-md-10-1><code>release-content/migration-guides/schedule_cleanup.md</code> (+10/-1)</h3><p>Migration guide updates:<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`ScheduleBuildError`</span><span> variants now contain </span><span style=color:#ed9366;background-color:#61676c10>`NodeId`</span><span> or type-specific keys, rather than </span><span style=color:#ed9366;background-color:#61676c10>`String`</span><span>s.
</span><span>  Use </span><span style=color:#ed9366;background-color:#61676c10>`ScheduleBuildError::to_string`</span><span> to render the nodes' names and get the old error messages.
</span><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`ScheduleGraph::build_schedule`</span><span> now returns a </span><span style=color:#ed9366;background-color:#61676c10>`Vec&LTScheduleBuildWarning>`</span><span> in addition to the built
</span><span>  </span><span style=color:#ed9366;background-color:#61676c10>`SystemSchedule`</span><span>. Use standard </span><span style=color:#ed9366;background-color:#61676c10>`Result`</span><span> functions to grab just the </span><span style=color:#ed9366;background-color:#61676c10>`SystemSchedule`</span><span>, if needed.
</span><span>
</span><span>The following enum variants were replaced:
</span><span>
</span><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`ScheduleBuildError::HierarchyRedundancy`</span><span> with </span><span style=color:#ed9366;background-color:#61676c10>`ScheduleBuildError::Elevated(ScheduleBuildWarning::HierarchyRedundancy)`</span><span>
</span><span style=color:#4cbf99>- </span><span style=color:#ed9366;background-color:#61676c10>`ScheduleBuildError::Ambiguity`</span><span> with </span><span style=color:#ed9366;background-color:#61676c10>`ScheduleBuildError::Elevated(ScheduleBuildWarning::Ambiguity)`</span><span>
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html target=_blank>Rust Borrow Checker Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ecs/ target=_blank>Bevy ECS Architecture</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch09-00-error-handling.html target=_blank>Error Handling in Rust</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20256.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>