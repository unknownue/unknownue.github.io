<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #20153 enable codeql analysis
        
    </title><meta content="#20153 enable codeql analysis" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-23</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-20153-zh-cn-20250723>中文</a></div></div><div class=pr-content><h1 id=analysis-of-pr-20153-enable-codeql-analysis>Analysis of PR #20153: enable codeql analysis</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: enable codeql analysis<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/20153<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Build-System, S-Ready-For-Final-Review, X-Blessed<li><strong>Created</strong>: 2025-07-15T20:30:22Z<li><strong>Merged</strong>: 2025-07-23T18:20:31Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>CodeQL is now in public preview for Rust:<li>https://github.blog/changelog/2025-06-30-codeql-support-for-rust-now-in-public-preview/<li>https://github.blog/changelog/2025-07-02-codeql-2-22-1-bring-rust-support-to-public-preview/</ul><h2 id=solution>Solution</h2><ul><li>Let’s try it!</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>The developer identified that GitHub recently added Rust support to CodeQL’s public preview. CodeQL is GitHub’s semantic code analysis engine that helps identify security vulnerabilities and code quality issues. Prior to this PR, Bevy lacked automated CodeQL analysis, meaning potential security issues or code quality problems in the Rust codebase weren’t being systematically detected.<p>The timing was significant because Rust support was newly available (launched June-July 2025). Integrating CodeQL would provide an additional layer of automated code quality checking without requiring significant maintenance overhead since it uses GitHub’s managed infrastructure.<h3 id=the-solution-approach>The Solution Approach</h3><p>The solution implemented a minimal viable CodeQL integration using GitHub Actions. The approach was conservative:<ol><li>Start with basic configuration using official GitHub templates<li>Enable only for <code>main</code> branch pushes initially (not PRs)<li>Analyze both Rust code and GitHub Actions workflows<li>Use default query sets without customizations<li>Skip build steps since they’re unnecessary for Rust analysis</ol><p>This phased approach allowed testing CodeQL integration with minimal impact on existing workflows. The commented-out sections for PR triggers and scheduled runs show consideration for future expansion once the initial implementation is validated.<h3 id=the-implementation>The Implementation</h3><p>The implementation added a single new GitHub Actions workflow file. The configuration:<ul><li>Triggers on <code>main</code> branch pushes (with PR/schedule triggers commented out)<li>Uses a matrix strategy to analyze both Actions and Rust code<li>Sets minimal required permissions<li>Uses <code>build-mode: none</code> since Rust doesn’t require compilation for CodeQL analysis<li>Follows GitHub’s recommended setup for CodeQL initialization and analysis</ul><p>The configuration includes clear documentation about:<ul><li>Runner size considerations<li>Permission requirements<li>How to handle manual build modes<li>Query customization options</ul><p>Key technical decisions:<ul><li>Using <code>ubuntu-latest</code> runners for efficiency<li>Setting <code>fail-fast: false</code> to ensure both language analyses complete<li>Including GitHub Actions workflow analysis to catch CI issues<li>Adding detailed comments for future maintainers</ul><h3 id=technical-insights>Technical Insights</h3><p>The implementation demonstrates several sound engineering practices:<ol><li><strong>Minimal Permissions</strong>: The workflow requests only necessary permissions (<code>security-events: write</code>, <code>packages: read</code>, etc.)<li><strong>Failure Isolation</strong>: <code>fail-fast: false</code> prevents one language’s failure from blocking the other<li><strong>Commented Future Options</strong>: Clear placeholders show how to enable PR analysis later<li><strong>Version Pinning</strong>: Uses specific action versions (<code>@v3</code>, <code>@v4</code>) for stability<li><strong>Conditional Build Steps</strong>: The manual build step only runs when needed</ol><p>For Rust projects, the <code>build-mode: none</code> is appropriate because CodeQL can analyze Rust source code directly without compilation. This simplifies the configuration and reduces CI resource usage.<h3 id=the-impact>The Impact</h3><p>This change introduces automated code scanning that will:<ol><li>Detect security vulnerabilities in Rust code<li>Identify common code quality issues<li>Analyze GitHub Actions workflows for best practices<li>Provide ongoing scanning as CodeQL’s Rust support matures</ol><p>The impact is low-risk since:<ul><li>It only adds a new workflow file<li>Runs are limited to <code>main</code> branch pushes initially<li>Doesn’t affect existing CI pipelines<li>Uses battle-tested GitHub Actions</ul><p>The solution creates a foundation that can be expanded later by uncommenting the PR trigger or scheduled runs once the team verifies its stability.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[Push to main branch] --> B[CodeQL Workflow]
</span><span>    B --> C[Matrix Strategy]
</span><span>    C --> D[Analyze Actions]
</span><span>    C --> E[Analyze Rust]
</span><span>    D --> F[Generate Security Alerts]
</span><span>    E --> F
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=file-github-workflows-codeql-yml>File: .github/workflows/codeql.yml</h3><p>Added a new CodeQL analysis workflow. This file didn’t exist previously.<p>Key additions:<pre class=language-yaml data-lang=yaml style=color:#61676c;background-color:#fafafa><code class=language-yaml data-lang=yaml><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"CodeQL"
</span><span>
</span><span style=color:#ff8f40>on</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>push</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>branches</span><span style=color:#61676ccc>: </span><span>[</span><span style=color:#86b300>"main"</span><span>]
</span><span style=color:#abb0b6;font-style:italic># Commented for now to test
</span><span style=color:#abb0b6;font-style:italic>#  pull_request:
</span><span style=color:#abb0b6;font-style:italic>#    branches: [ "main" ]
</span><span style=color:#abb0b6;font-style:italic>#  schedule:
</span><span style=color:#abb0b6;font-style:italic>#    - cron: '22 14 * * 4'
</span><span>
</span><span style=color:#399ee6>jobs</span><span style=color:#61676ccc>:
</span><span>  </span><span style=color:#399ee6>analyze</span><span style=color:#61676ccc>:
</span><span>    </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Analyze (${{ matrix.language }})
</span><span>    </span><span style=color:#399ee6>runs-on</span><span style=color:#61676ccc>: </span><span style=color:#86b300>${{ (matrix.language == 'swift' && 'macos-latest') || 'ubuntu-latest' }}
</span><span>    </span><span style=color:#399ee6>permissions</span><span style=color:#61676ccc>:
</span><span>      </span><span style=color:#399ee6>security-events</span><span style=color:#61676ccc>: </span><span style=color:#86b300>write
</span><span>      </span><span style=color:#399ee6>packages</span><span style=color:#61676ccc>: </span><span style=color:#86b300>read
</span><span>      </span><span style=color:#399ee6>actions</span><span style=color:#61676ccc>: </span><span style=color:#86b300>read
</span><span>      </span><span style=color:#399ee6>contents</span><span style=color:#61676ccc>: </span><span style=color:#86b300>read
</span><span>
</span><span>    </span><span style=color:#399ee6>strategy</span><span style=color:#61676ccc>:
</span><span>      </span><span style=color:#399ee6>fail-fast</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false
</span><span>      </span><span style=color:#399ee6>matrix</span><span style=color:#61676ccc>:
</span><span>        </span><span style=color:#399ee6>include</span><span style=color:#61676ccc>:
</span><span>          - </span><span style=color:#399ee6>language</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions
</span><span>            </span><span style=color:#399ee6>build-mode</span><span style=color:#61676ccc>: </span><span style=color:#86b300>none
</span><span>          - </span><span style=color:#399ee6>language</span><span style=color:#61676ccc>: </span><span style=color:#86b300>rust
</span><span>            </span><span style=color:#399ee6>build-mode</span><span style=color:#61676ccc>: </span><span style=color:#86b300>none
</span><span>    </span><span style=color:#399ee6>steps</span><span style=color:#61676ccc>:
</span><span>      - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Checkout repository
</span><span>        </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>actions/checkout@v4
</span><span>
</span><span>      - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Initialize CodeQL
</span><span>        </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>github/codeql-action/init@v3
</span><span>        </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>languages</span><span style=color:#61676ccc>: </span><span style=color:#86b300>${{ matrix.language }}
</span><span>          </span><span style=color:#399ee6>build-mode</span><span style=color:#61676ccc>: </span><span style=color:#86b300>${{ matrix.build-mode }}
</span><span>
</span><span>      - </span><span style=color:#399ee6>if</span><span style=color:#61676ccc>: </span><span style=color:#86b300>matrix.build-mode == 'manual'
</span><span>        </span><span style=color:#399ee6>shell</span><span style=color:#61676ccc>: </span><span style=color:#86b300>bash
</span><span>        </span><span style=color:#399ee6>run</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>|
</span><span style=color:#86b300>          echo 'If you are using a "manual" build mode...'
</span><span style=color:#86b300>          exit 1
</span><span style=color:#86b300>
</span><span>      - </span><span style=color:#399ee6>name</span><span style=color:#61676ccc>: </span><span style=color:#86b300>Perform CodeQL Analysis
</span><span>        </span><span style=color:#399ee6>uses</span><span style=color:#61676ccc>: </span><span style=color:#86b300>github/codeql-action/analyze@v3
</span><span>        </span><span style=color:#399ee6>with</span><span style=color:#61676ccc>:
</span><span>          </span><span style=color:#399ee6>category</span><span style=color:#61676ccc>: </span><span style=color:#86b300>"/language:${{matrix.language}}"
</span></code></pre><h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://codeql.github.com/docs/codeql-language-guides/codeql-for-rust/ target=_blank>CodeQL for Rust documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/github/codeql-action target=_blank>GitHub CodeQL Action documentation</a><li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/configuring-code-scanning target=_blank>Advanced CodeQL workflow configuration</a><li><a rel="noopener nofollow noreferrer" href=https://codeql.github.com/docs/codeql-overview/about-codeql/ target=_blank>Understanding CodeQL query results</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_20153.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>