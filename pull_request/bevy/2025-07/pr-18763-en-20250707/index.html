<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18763 Add test for invalid skinned meshes
        
    </title><meta content="#18763 Add test for invalid skinned meshes" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-07</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-07/pr-18763-zh-cn-20250707>中文</a></div></div><div class=pr-content><h1 id=add-test-for-invalid-skinned-meshes>Add test for invalid skinned meshes</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add test for invalid skinned meshes<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18763<li><strong>Author</strong>: greeble-dev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review, A-Animation, C-Testing, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-04-08T15:00:50Z<li><strong>Merged</strong>: 2025-07-07T19:49:27Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description>Description</h2><h3 id=objective>Objective</h3><p>Add a test that would have caught #16929 and #18712.<h3 id=solution>Solution</h3><p>The PR adds a <code>test_invalid_skinned_mesh</code> example that creates various valid and invalid skinned meshes. This is designed to catch panics via CI, and can be inspected visually. It also tests skinned meshes + motion blur.<p><img alt=417958065-37df8799-b068-48b8-87a4-1f144e883c9c src=https://github.com/user-attachments/assets/22b2fa42-628b-48a4-9013-76d6524cecf5><p>The screenshot shows all the tests, but two are currently disabled as they cause panics. #18074 will re-enable them.<h3 id=concerns>Concerns</h3><ul><li>The test is not currently suitable for screenshot comparison.<li>I didn’t add the test to CI. I’m a bit unsure if this should be part of the PR or a follow up discussion.<li>Visual inspection requires understanding why some meshes are deliberately broken and what that looks like.<li>I wasn’t sure about naming conventions. I put <code>test</code> in the name so it’s not confused with a real example.</ul><h3 id=testing>Testing</h3><pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example test_invalid_skinned_mesh
</span></code></pre><p>Tested on Win10/Nvidia, across Vulkan, WebGL/Chrome, WebGPU/Chrome.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Two critical issues (#16929 and #18712) slipped through Bevy’s test suite, causing panics when rendering skinned meshes under specific invalid conditions. These issues revealed a gap in test coverage for error handling in Bevy’s skinning system. The lack of dedicated tests for invalid skinned mesh configurations made it difficult to catch regressions in this important rendering feature.<p>Skinned meshes require several components to work correctly: proper vertex attributes, valid joint entities, and the presence of the <code>SkinnedMesh</code> component. When any of these are missing or incorrect, the renderer should handle it gracefully without crashing. The goal was to create a test that would systematically verify the renderer’s behavior across these failure scenarios.<h3 id=the-solution-approach>The Solution Approach</h3><p>The developer created a dedicated test example that generates multiple skinned mesh variations - both valid and invalid - in a single scene. This approach allows:<ol><li>Visual verification of rendering behavior<li>Automatic panic detection through CI systems<li>Testing of edge cases not covered by normal examples</ol><p>The test includes motion blur to validate compatibility with Bevy’s prepass rendering pipeline. An orthographic camera was chosen to provide a clear view of all mesh variations side-by-side. The test deliberately includes two disabled cases that currently cause panics, which will be re-enabled by #18074 once those issues are fixed.<h3 id=the-implementation>The Implementation</h3><p>The implementation creates a comprehensive test scene with four mesh variations:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>enum </span><span style=color:#399ee6>Variation </span><span>{
</span><span>    Normal</span><span style=color:#61676ccc>,
</span><span>    MissingMeshAttributes</span><span style=color:#61676ccc>,
</span><span>    MissingJointEntity</span><span style=color:#61676ccc>,
</span><span>    MissingSkinnedMeshComponent</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>For each variation, the test:<ol><li>Creates a mesh with proper skinning attributes or deliberately incorrect ones<li>Sets up joint hierarchies<li>Conditionally omits required components<li>Adds background planes for visual context</ol><p>The animation system rotates joints to verify skinning transforms work correctly:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>update_animated_joints</span><span>(</span><span style=color:#ff8f40>time</span><span style=color:#61676ccc>: </span><span>Res&LTTime>, </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform, With&LTAnimatedJoint>>) {
</span><span>    </span><span style=color:#fa6e32>for mut</span><span> transform </span><span style=color:#ed9366>in</span><span> query {
</span><span>        </span><span style=color:#fa6e32>let</span><span> angle </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>TAU </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>4.0 </span><span style=color:#ed9366>* </span><span>ops</span><span style=color:#ed9366>::</span><span>cos((time</span><span style=color:#ed9366>.</span><span style=color:#f07171>elapsed_secs</span><span>() </span><span style=color:#ed9366>/ </span><span style=color:#ff8f40>8.0</span><span>) </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>TAU</span><span>)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> rotation </span><span style=color:#ed9366>= </span><span>Quat</span><span style=color:#ed9366>::</span><span>from_rotation_z(angle)</span><span style=color:#61676ccc>;
</span><span>        transform</span><span style=color:#ed9366>.</span><span>rotation </span><span style=color:#ed9366>=</span><span> rotation</span><span style=color:#61676ccc>;
</span><span>        transform</span><span style=color:#ed9366>.</span><span>translation </span><span style=color:#ed9366>=</span><span> rotation</span><span style=color:#ed9366>.</span><span style=color:#f07171>mul_vec3</span><span>(Vec3</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>1.3</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>))</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>Motion blur is explicitly tested with unrealistically high settings to make the effect clearly visible:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>MotionBlur {
</span><span>    shutter_angle</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>3.0</span><span style=color:#61676ccc>,
</span><span>    samples</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>2</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>The test includes an on-screen text explanation for visual verification:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> description </span><span style=color:#ed9366>= </span><span style=color:#86b300>"(left to right)</span><span style=color:#4cbf99>\n</span><span style=color:#61676ccc>\
</span><span style=color:#86b300>    0: Normal skinned mesh.</span><span style=color:#4cbf99>\n</span><span style=color:#61676ccc>\
</span><span style=color:#86b300>    1: Mesh asset is missing skinning attributes.</span><span style=color:#4cbf99>\n</span><span style=color:#61676ccc>\
</span><span style=color:#86b300>    2: One joint entity is missing.</span><span style=color:#4cbf99>\n</span><span style=color:#61676ccc>\
</span><span style=color:#86b300>    3: Mesh entity is missing SkinnedMesh component."</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>Key technical considerations in the implementation:<ol><li><strong>Orthographic Projection</strong>: Uses <code>ScalingMode::AutoMin</code> to ensure all meshes fit in view<li><strong>Multi-platform Support</strong>: Conditionally disables MSAA for WebGL compatibility<li><strong>Asset Management</strong>: Creates separate mesh assets for valid/invalid cases<li><strong>Component Validation</strong>: Tests missing <code>SkinnedMesh</code> component case<li><strong>Joint Hierarchy</strong>: Creates parent-child joint relationships for realistic testing</ol><p>The test exercises multiple rendering paths:<ul><li>Standard skinning<li>Motion blur prepass<li>Shadow rendering<li>WebGL/WebGPU compatibility</ul><h3 id=the-impact>The Impact</h3><p>This test provides:<ol><li>Automated detection of skinning-related panics<li>Visual verification of rendering behavior<li>Coverage for previously untested error cases<li>Validation of motion blur with skinned meshes<li>Documentation of expected behavior through visual examples</ol><p>The test will prevent regressions like #16929 and #18712 by catching invalid configurations during CI runs. It also establishes a pattern for testing error conditions in Bevy’s rendering pipeline.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Test Setup] --> B[Environment]
</span><span>    A --> C[Mesh Variations]
</span><span>    B --> D[Camera with Motion Blur]
</span><span>    B --> E[Directional Light]
</span><span>    B --> F[Background Plane]
</span><span>    B --> G[Text Explanation]
</span><span>    C --> H[Normal Skinned Mesh]
</span><span>    C --> I[Missing Attributes]
</span><span>    C --> J[Missing Joint]
</span><span>    C --> K[Missing Component]
</span><span>    H --> L[Animation System]
</span><span>    I --> L
</span><span>    J --> L
</span><span>    K --> L
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=cargo-toml><code>Cargo.toml</code></h3><p>Added the new test example to Bevy’s example list:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span>[[</span><span style=color:#399ee6>example</span><span>]]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"test_invalid_skinned_mesh"
</span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"tests/3d/test_invalid_skinned_mesh.rs"
</span><span style=color:#399ee6>doc-scrape-examples </span><span>= </span><span style=color:#ff8f40>true
</span><span>
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>example</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>test_invalid_skinned_mesh</span><span>]
</span><span style=color:#399ee6>hidden </span><span>= </span><span style=color:#ff8f40>true
</span></code></pre><p>This registers the test as a runnable example while hiding it from documentation.<h3 id=tests-3d-test-invalid-skinned-mesh-rs><code>tests/3d/test_invalid_skinned_mesh.rs</code></h3><p>New file implementing the test case:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Core test structure
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    App</span><span style=color:#ed9366>::</span><span>new()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(DefaultPlugins)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>insert_resource</span><span>(AmbientLight { brightness</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>20_000.0</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>() })
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Startup</span><span style=color:#61676ccc>, </span><span>(setup_environment</span><span style=color:#61676ccc>,</span><span> setup_meshes))
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>,</span><span> update_animated_joints)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Mesh creation with skinning attributes
</span><span style=color:#fa6e32>let</span><span> skinned_mesh </span><span style=color:#ed9366>=</span><span> unskinned_mesh
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_inserted_attribute</span><span>(
</span><span>        Mesh</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ATTRIBUTE_JOINT_INDEX</span><span style=color:#61676ccc>,
</span><span>        VertexAttributeValues</span><span style=color:#ed9366>::</span><span>Uint16x4(</span><span style=color:#f07171>vec!</span><span>[</span><span style=color:#ed9366>...</span><span>])
</span><span>    )
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_inserted_attribute</span><span>(
</span><span>        Mesh</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ATTRIBUTE_JOINT_WEIGHT</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#f07171>vec!</span><span>[[</span><span style=color:#ff8f40>1.00</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.00</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>]</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>8</span><span>]
</span><span>    )</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Test case variations
</span><span style=color:#fa6e32>for </span><span>(index</span><span style=color:#61676ccc>,</span><span> variation) </span><span style=color:#ed9366>in </span><span>[
</span><span>    Variation</span><span style=color:#ed9366>::</span><span>Normal</span><span style=color:#61676ccc>,
</span><span>    Variation</span><span style=color:#ed9366>::</span><span>MissingMeshAttributes</span><span style=color:#61676ccc>,
</span><span>    Variation</span><span style=color:#ed9366>::</span><span>MissingJointEntity</span><span style=color:#61676ccc>,
</span><span>    Variation</span><span style=color:#ed9366>::</span><span>MissingSkinnedMeshComponent</span><span style=color:#61676ccc>,
</span><span>]</span><span style=color:#ed9366>.</span><span style=color:#f07171>into_iter</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>enumerate</span><span>()
</span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Conditionally disable broken cases
</span><span>    </span><span style=color:#fa6e32>if </span><span>(variation </span><span style=color:#ed9366>== </span><span>Variation</span><span style=color:#ed9366>::</span><span>MissingSkinnedMeshComponent) 
</span><span>        </span><span style=color:#ed9366>|| </span><span>(variation </span><span style=color:#ed9366>== </span><span>Variation</span><span style=color:#ed9366>::</span><span>MissingMeshAttributes)
</span><span>    {
</span><span>        </span><span style=color:#fa6e32>continue</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Create joints hierarchy
</span><span>    </span><span style=color:#fa6e32>let</span><span> joint_0 </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(transform)</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> joint_1 </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((ChildOf(joint_0)</span><span style=color:#61676ccc>,</span><span> AnimatedJoint</span><span style=color:#61676ccc>, </span><span>Transform</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>IDENTITY</span><span>))</span><span style=color:#ed9366>.</span><span style=color:#f07171>id</span><span>()</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Conditionally remove joints
</span><span>    </span><span style=color:#fa6e32>if</span><span> variation </span><span style=color:#ed9366>== </span><span>Variation</span><span style=color:#ed9366>::</span><span>MissingJointEntity {
</span><span>        commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>entity</span><span>(joint_1)</span><span style=color:#ed9366>.</span><span style=color:#f07171>despawn</span><span>()</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Select correct mesh type
</span><span>    </span><span style=color:#fa6e32>let</span><span> mesh_handle </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>match</span><span> variation {
</span><span>        Variation</span><span style=color:#ed9366>::</span><span>MissingMeshAttributes </span><span style=color:#ed9366>=> &</span><span>unskinned_mesh_handle</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>_ => &</span><span>skinned_mesh_handle</span><span style=color:#61676ccc>,
</span><span>    }</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Conditionally omit SkinnedMesh component
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> entity_commands </span><span style=color:#ed9366>=</span><span> commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((</span><span style=color:#ed9366>...</span><span>))</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>if</span><span> variation </span><span style=color:#ed9366>!= </span><span>Variation</span><span style=color:#ed9366>::</span><span>MissingSkinnedMeshComponent {
</span><span>        entity_commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(SkinnedMesh {
</span><span>            inverse_bindposes</span><span style=color:#61676ccc>:</span><span> inverse_bindposes_handle</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>            joints</span><span style=color:#61676ccc>: </span><span style=color:#f07171>vec!</span><span>[joint_0</span><span style=color:#61676ccc>,</span><span> joint_1]</span><span style=color:#61676ccc>,
</span><span>        })</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>This file implements the core test logic, creating the scene with various skinned mesh configurations and animation system.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/3d/skinning/ target=_blank>Bevy Skinning Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/rfcs/blob/main/rfcs/49-motion-blur.md target=_blank>Motion Blur RFC</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/render/mesh/enum.Mesh.html target=_blank>Vertex Attribute Reference</a><li>Related issues: <ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/16929 target=_blank>#16929: Panic on skinned mesh with missing joints</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/18712 target=_blank>#18712: Skinned mesh panic case</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/18074 target=_blank>#18074: Fixes for disabled test cases</a></ul></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_18763.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>