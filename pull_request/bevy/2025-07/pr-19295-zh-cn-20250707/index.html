<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19295 Explanation for the '3d shapes' example
        
    </title><meta content="#19295 Explanation for the '3d shapes' example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-07/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-07-07</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-07/pr-19295-en-20250707>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h1 id=ji-shu-fen-xi-bao-gao-wei-3dxing-zhuang-shi-li-tian-jia-shuo-ming>技术分析报告：为3D形状示例添加说明</h1><h2 id=ji-ben-xin-xi>基本信息</h2><ul><li><strong>标题</strong>: Explanation for the ‘3d shapes’ example<li><strong>PR链接</strong>: https://github.com/bevyengine/bevy/pull/19295<li><strong>作者</strong>: fallible-algebra<li><strong>状态</strong>: 已合并<li><strong>标签</strong>: C-Docs, A-Rendering, C-Examples, S-Ready-For-Final-Review, D-Straightforward<li><strong>创建时间</strong>: 2025-05-19T16:12:21Z<li><strong>合并时间</strong>: 2025-07-07T20:07:06Z<li><strong>合并者</strong>: alice-i-cecile</ul><h2 id=miao-shu-fan-yi>描述翻译</h2><p>为3d shapes示例添加<a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/contribute/helping-out/explaining-examples/ target=_blank>说明</a>。<p>这与<a rel="noopener nofollow noreferrer" href=https://github.com/beveengine/bevy/pull/19211 target=_blank>2d shapes</a>示例有许多共同之处，因此结构相似。关于为什么asset handles不是组件的解释已被复制过来并做了微调，在将其从草稿中移出之前，我将进行编辑使其与上下文匹配并聚焦。<h2 id=prji-shu-fen-xi>PR技术分析</h2><h3 id=wen-ti-bei-jing>问题背景</h3><p>Bevy引擎的3D形状示例(<code>examples/3d/3d_shapes.rs</code>)原本只有两行基础描述，缺少对关键概念的详细解释：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>//! This example demonstrates the built-in 3d shapes in Bevy.
</span><span style=color:#abb0b6;font-style:italic>//! The scene includes a patterned texture and a rotation for visualizing the normals and UVs.
</span></code></pre><p>这对新贡献者理解示例的实现原理造成了障碍，特别是：<ol><li>几何图元(shape primitives)与网格(Mesh)的转换关系不明确<li>运行时生成材质的机制未说明<li>资源句柄(Handle)在ECS中的使用方式需要澄清</ol><h3 id=jie-jue-fang-an>解决方案</h3><p>PR通过重写模块级文档注释(doc comments)来解决这些问题：<ol><li>明确区分几何图元与网格的概念<li>详细说明<code>Assets::add</code>方法如何将图元转换为网格<li>解释<code>Extrusion</code>如何将2D形状转换为3D对象<li>阐明运行时材质生成逻辑<li>说明资源句柄为何需要<code>Mesh3d</code>和<code>MeshMaterial3d</code>包装</ol><h3 id=shi-xian-xi-jie>实现细节</h3><p>核心变更集中在澄清三个关键技术点：<p><strong>1. 图元到网格的转换机制</strong><br> 通过<code>meshes.add()</code>方法实现转换，这利用了Rust的<code>From</code> trait：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>//! While a shape is not a mesh, turning it into one in Bevy is easy. In this example we call 
</span><span style=color:#abb0b6;font-style:italic>//! [`meshes.add(/* Shape here! */)`][Assets&LTA>::add] on the shape, which works because the 
</span><span style=color:#abb0b6;font-style:italic>//! [`Assets&LTA>::add`] method takes anything that can be turned into the asset type it stores. 
</span></code></pre><p><strong>2. 2D到3D的挤出(Extrusion)处理</strong><br> 使用<code>Extrusion</code>结构体为2D形状添加深度：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>//! [`Extrusion`] lets us turn 2D shape primitives into versions of those shapes that have volume 
</span><span style=color:#abb0b6;font-style:italic>//! by extruding them. A 1x1 square that gets wrapped in this with an extrusion depth of 2 will 
</span><span style=color:#abb0b6;font-style:italic>//! give us a rectangular prism of size 1x1x2...
</span></code></pre><p><strong>3. 资源句柄的ECS集成</strong><br> 解释为何原始<code>Handle</code>需要包装才能作为组件使用：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>//! The mesh and material are [`Handle&LTMesh>`] and [`Handle&LTStandardMaterial>`] at the moment, 
</span><span style=color:#abb0b6;font-style:italic>//! neither of which implement `Component` on their own... All we need to do to make them 
</span><span style=color:#abb0b6;font-style:italic>//! rendering-relevant components is wrap the mesh handle and the material handle in 
</span><span style=color:#abb0b6;font-style:italic>//! [`Mesh3d`] and [`MeshMaterial3d`] respectively.
</span></code></pre><h3 id=ji-shu-dong-cha>技术洞察</h3><ol><li><strong>资源生命周期</strong>：材质纹理仅生成一次并复用，符合ECS的资源管理最佳实践<li><strong>类型安全</strong>：通过新类型包装(newtype wrapping)避免句柄类型歧义<li><strong>API设计</strong>：<code>Assets::add</code>的泛型实现允许隐式转换，简化了资产创建流程</ol><h3 id=ying-xiang-yu-jia-zhi>影响与价值</h3><ol><li>降低新贡献者的理解门槛<li>澄清Bevy核心概念：图元 vs 网格、资源句柄 vs 组件<li>为其他示例文档提供参考模板<li>保持与2D形状示例的文档一致性</ol><h2 id=ke-shi-hua-biao-shi>可视化表示</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[几何图元] --> B(Assets::add)
</span><span>    B --> C[Mesh资产]
</span><span>    C --> D[Mesh3d组件]
</span><span>    E[材质生成] --> F[StandardMaterial]
</span><span>    F --> G[MeshMaterial3d组件]
</span><span>    D --> H[渲染实体]
</span><span>    G --> H
</span></code></pre><h2 id=guan-jian-wen-jian-bian-geng>关键文件变更</h2><h3 id=examples-3d-3d-shapes-rs><code>examples/3d/3d_shapes.rs</code></h3><p><strong>变更说明</strong>：重写模块级文档注释，添加技术实现细节<br> <strong>代码对比</strong>：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#ed9366>#</span><span> 修改前</span><span style=color:#61676ccc>:
</span><span style=color:#abb0b6;font-style:italic>//! This example demonstrates the built-in 3d shapes in Bevy.
</span><span style=color:#abb0b6;font-style:italic>//! The scene includes a patterned texture and a rotation for visualizing the normals and UVs.
</span><span>
</span><span style=color:#ed9366>#</span><span> 修改后</span><span style=color:#61676ccc>:
</span><span style=color:#abb0b6;font-style:italic>//! Here we use shape primitives to generate meshes for 3d objects as well as attaching a runtime-generated patterned texture to each 3d object.
</span><span style=color:#abb0b6;font-style:italic>//!
</span><span style=color:#abb0b6;font-style:italic>//! "Shape primitives" here are just the mathematical definition of certain shapes, they're not meshes on their own! A sphere with radius `1.0` can be defined with [`Sphere::new(1.0)`][Sphere::new] but all this does is store the radius. So we need to turn these descriptions of shapes into meshes.
</span><span style=color:#abb0b6;font-style:italic>//!
</span><span style=color:#abb0b6;font-style:italic>//! While a shape is not a mesh, turning it into one in Bevy is easy. In this example we call [`meshes.add(/* Shape here! */)`][Assets&LTA>::add] on the shape, which works because the [`Assets&LTA>::add`] method takes anything that can be turned into the asset type it stores. There's an implementation for [`From`] on shape primitives into [`Mesh`], so that will get called internally by [`Assets&LTA>::add`].
</span><span style=color:#abb0b6;font-style:italic>//!
</span><span style=color:#abb0b6;font-style:italic>//! [`Extrusion`] lets us turn 2D shape primitives into versions of those shapes that have volume by extruding them. A 1x1 square that gets wrapped in this with an extrusion depth of 2 will give us a rectangular prism of size 1x1x2, but here we're just extruding these 2d shapes by depth 1.
</span><span style=color:#abb0b6;font-style:italic>//!
</span><span style=color:#abb0b6;font-style:italic>//! The material applied to these shapes is a texture that we generate at run time by looping through a "palette" of RGBA values (stored adjacent to each other in the array) and writing values to positions in another array that represents the buffer for an 8x8 texture. This texture is then registered with the assets system just one time, with that [`Handle&LTStandardMaterial>`] then applied to all the shapes in this example.
</span><span style=color:#abb0b6;font-style:italic>//!
</span><span style=color:#abb0b6;font-style:italic>//! The mesh and material are [`Handle&LTMesh>`] and [`Handle&LTStandardMaterial>`] at the moment, neither of which implement `Component` on their own. Handles are put behind "newtypes" to prevent ambiguity, as some entities might want to have handles to meshes (or images, or materials etc.) for different purposes! All we need to do to make them rendering-relevant components is wrap the mesh handle and the material handle in [`Mesh3d`] and [`MeshMaterial3d`] respectively.
</span></code></pre><h2 id=kuo-zhan-yue-du>扩展阅读</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/contribute/helping-out/explaining-examples/ target=_blank>Bevy贡献指南 - 解释示例</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/19211 target=_blank>相关PR：2D形状示例说明</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/introduction/resources/ target=_blank>Bevy ECS中的资源管理</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/convert/trait.From.html target=_blank>Rust的From trait文档</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-07/pr_19295.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>