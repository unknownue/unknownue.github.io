<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19023 Add TextureAtlas convenience methods
        
    </title><meta content="#19023 Add TextureAtlas convenience methods" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-05</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-19023-zh-cn-20250505>中文</a></div></div><div class=pr-content><h1 id=add-textureatlas-convenience-methods>Add TextureAtlas convenience methods</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add TextureAtlas convenience methods<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19023<li><strong>Author</strong>: mnmaita<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Rendering, C-Usability, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-05-02T00:43:04Z<li><strong>Merged</strong>: 2025-05-04T08:29:24Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Add a few useful methods to <code>TextureAtlas</code>.</ul><h2 id=solution>Solution</h2><ul><li>Added <code>TextureAtlas::with_index()</code>.<li>Added <code>TextureAtlas::with_layout()</code>.</ul><h2 id=testing>Testing</h2><ul><li>CI checks.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a common usability pain point when working with Bevy’s sprite system. The <code>TextureAtlas</code> struct, which combines a texture layout handle with an index to identify specific sub-textures, previously required manual field manipulation when modifying these properties. Developers needed to either construct new struct instances or mutate existing ones directly, which could lead to verbose and less readable code.<p>The solution introduces two builder-style methods following Rust’s fluent interface pattern:<ol><li><code>with_index()</code> allows changing the texture index<li><code>with_layout()</code> enables swapping the atlas layout handle</ol><p>These methods return modified <code>TextureAtlas</code> instances, enabling method chaining while maintaining immutability. The implementation is intentionally minimal - each method takes ownership of <code>self</code>, modifies the relevant field, and returns the modified struct. This approach aligns with Rust’s ownership system and avoids unnecessary cloning.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>with_index</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>index</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>index </span><span style=color:#ed9366>=</span><span> index</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>with_layout</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>layout</span><span style=color:#61676ccc>: </span><span>Handle&LTTextureAtlasLayout>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>layout </span><span style=color:#ed9366>=</span><span> layout</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self
</span><span>}
</span></code></pre><p>The changes improve ergonomics for common operations like:<ul><li>Creating multiple sprites from the same atlas layout<li>Reusing atlas configurations with different indices<li>Swapping texture layouts while maintaining other properties</ul><p>These additions maintain backward compatibility while providing clearer intent compared to direct field access. The implementation avoids any runtime overhead as the methods simply reorganize existing data without introducing new computations.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    TextureAtlas --> with_index
</span><span>    TextureAtlas --> with_layout
</span><span>    with_index -->|Sets| Index
</span><span>    with_layout -->|Sets| TextureAtlasLayout
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-image-src-texture-atlas-rs-12-0><code>crates/bevy_image/src/texture_atlas.rs</code> (+12/-0)</h3><p>Added two builder methods to enable fluent configuration of TextureAtlas instances:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Manual struct modification required
</span><span style=color:#fa6e32>let mut</span><span> atlas </span><span style=color:#ed9366>= </span><span>TextureAtlas</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>;
</span><span>atlas</span><span style=color:#ed9366>.</span><span>index </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>5</span><span style=color:#61676ccc>;
</span><span>atlas</span><span style=color:#ed9366>.</span><span>layout </span><span style=color:#ed9366>=</span><span> new_layout</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Fluent interface
</span><span style=color:#fa6e32>let</span><span> atlas </span><span style=color:#ed9366>= </span><span>TextureAtlas</span><span style=color:#ed9366>::</span><span>default()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_index</span><span>(</span><span style=color:#ff8f40>5</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>with_layout</span><span>(new_layout)</span><span style=color:#61676ccc>;
</span></code></pre><p>The changes:<ol><li>Implement <code>with_index</code> to modify texture index<li>Implement <code>with_layout</code> to change atlas layout handle<li>Maintain existing constructor patterns while adding new configuration options</ol><h2 id=further-reading>Further Reading</h2><ul><li>Rust Builder Pattern: https://doc.rust-lang.org/1.0.0/style/ownership/builders.html<li>Bevy Sprites Documentation: https://bevyengine.org/learn/book/next/2d/sprites<li>Fluent Interface Design: https://martinfowler.com/bliki/FluentInterface.html</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_19023.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>