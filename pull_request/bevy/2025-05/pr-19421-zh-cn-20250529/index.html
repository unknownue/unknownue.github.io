<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19421 EntityGeneration` ordering
        
    </title><meta content="#19421 EntityGeneration` ordering" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-29</span><div class=language-switcher><a class=lang-link data-lang=en href=/pull_request/bevy/2025-05/pr-19421-en-20250529>English</a> / <span class="lang-link active" data-lang=zh-cn>中文</span></div></div><div class=pr-content><h3 id=shi-ti-sheng-cheng-shun-xu-de-xiu-fu-ji-shu-fen-xi-yu-shi-xian>实体生成顺序的修复：技术分析与实现</h3><h2 id=ji-chu-xin-xi>基础信息</h2><ul><li><strong>标题</strong>: <code>EntityGeneration</code> ordering<li><strong>PR链接</strong>: https://github.com/bevyengine/bevy/pull/19421<li><strong>作者</strong>: ElliottjPierce<li><strong>状态</strong>: 已合并<li><strong>标签</strong>: D-Trivial, A-ECS, C-Usability, S-Ready-For-Final-Review, X-Contentious<li><strong>创建时间</strong>: 2025-05-29T01:53:44Z<li><strong>合并时间</strong>: 2025-05-29T06:07:46Z<li><strong>合并者</strong>: alice-i-cecile</ul><h2 id=miao-shu-fan-yi>描述翻译</h2><h3 id=mu-biao>目标</h3><p>在最近的 #19121 PR 中，<code>u32</code> 类型的 <code>Entity::generation</code> 被替换为新的 <code>EntityGeneration</code> 类型。<br> 这使语义更清晰，并防止了意外误用。<p>常见的误用是假设较大的 <code>u32</code> 值在顺序上较小值之后出现。<br> 包装(wrapping)会使这个假设失效。<br> 当 <code>EntityGeneration</code> 被创建时，它保留了 <code>u32</code> 的排序方式，这在最好情况下是无用的，在最坏情况下是错误的。<br> 本 PR 修复了排序实现，使新的生成(generation)大于旧的生成。<p>部分用户已通过手动访问 <code>u32</code> 表示来解决此排序问题（该问题在 0.16 及更早版本中仍存在）。<br> 这使得迁移对某些用户（如avian physics）变得困难，详见<a rel="noopener nofollow noreferrer" href=https://discord.com/channels/691052431525675048/749335865876021248/1377431569228103780 target=_blank>此处</a>。<p>我倾向于认为此类型应保持不透明(opaque)以防止意外误用。<br> 当我们发现此类问题时，应直接在 <code>EntityGeneration</code> 中添加功能。<h3 id=jie-jue-fang-an>解决方案</h3><p>通过 <code>Ord</code> 实现修复排序。<p>或者，我们可以保持 <code>Ord</code> 不变并添加 <code>cmp_age</code> 方法，但我认为当前方案更好，尽管排序实体ID现在可能<em>略微</em>变慢（但更正确）。这是种权衡。<h3 id=ce-shi>测试</h3><p>改进了关于别名(aliasing)和排序的文档，增加了文档测试(doc tests)。<hr><h2 id=prji-shu-fen-xi>PR技术分析</h2><h3 id=wen-ti-bei-jing>问题背景</h3><p>在 Bevy ECS 中，<code>Entity</code> 由两部分组成：<ol><li><code>EntityRow</code>（索引位置）<li><code>EntityGeneration</code>（世代计数器）</ol><p><code>EntityGeneration</code> 在 #19121 中引入，用于替代原始的 <code>u32</code> 类型，以增强类型安全。然而，其初始的 <code>Ord</code> 实现直接沿用了 <code>u32</code> 的包装(wrapping)特性，导致反直觉的排序行为：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 错误示例：包装导致新生成小于旧生成
</span><span style=color:#fa6e32>let</span><span> old_gen </span><span style=color:#ed9366>= </span><span>EntityGeneration</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FIRST</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 0
</span><span style=color:#fa6e32>let</span><span> new_gen </span><span style=color:#ed9366>=</span><span> old_gen</span><span style=color:#ed9366>.</span><span style=color:#f07171>after_versions</span><span>(</span><span style=color:#ff8f40>400</span><span>)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 400
</span><span style=color:#f07171>assert!</span><span>(old_gen </span><span style=color:#ed9366><</span><span> new_gen)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 正确
</span><span>
</span><span style=color:#fa6e32>let </span><span>(wrapped_gen</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>_</span><span>) </span><span style=color:#ed9366>=</span><span> new_gen</span><span style=color:#ed9366>.</span><span style=color:#f07171>after_versions_and_could_alias</span><span>(</span><span style=color:#fa6e32>u32</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MAX</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert!</span><span>(new_gen </span><span style=color:#ed9366><</span><span> wrapped_gen)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 错误！包装后 400 > (u32::MAX + 400)
</span></code></pre><p>这种问题在需要比较实体新鲜度时（如缓存失效、事件处理）尤其危险。avian physics 用户的迁移困难证明了实际影响：开发者不得不绕过类型系统直接访问底层 <code>u32</code>，破坏了封装性。<h3 id=jie-jue-fang-an-she-ji>解决方案设计</h3><p>核心思路：<strong>在常见场景下保持直觉排序（新生成 > 旧生成），同时处理包装语义</strong>。考虑过两种方案：<ol><li><strong>新增 <code>cmp_age</code> 方法</strong> <ul><li>✅ 保持现有 <code>Ord</code> 不变<li>❌ 增加API复杂度，用户可能误用 <code>cmp</code></ul><li><strong>修改 <code>Ord</code> 实现</strong> <ul><li>✅ 符合开发者直觉（新生成应大于旧生成）<li>❌ 极端场景下排序可能不准确<li>❌ 排序性能略有下降</ul></ol><p>最终选择方案2，因其更符合类型语义，且性能影响可接受（实体排序非常用操作）。<h3 id=shi-xian-xi-jie>实现细节</h3><p>关键修改在 <code>Ord</code> trait 实现中：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span>Ord </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>EntityGeneration </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>cmp</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>other</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>Self</span><span>) </span><span style=color:#61676ccc>-> </span><span>core</span><span style=color:#ed9366>::</span><span>cmp</span><span style=color:#ed9366>::</span><span>Ordering {
</span><span>        </span><span style=color:#fa6e32>let</span><span> diff </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>wrapping_sub</span><span>(other</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span>        (</span><span style=color:#ff8f40>1</span><span style=color:#fa6e32>u32 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>31</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(</span><span style=color:#ed9366>&</span><span>diff)
</span><span>    }
</span><span>}
</span></code></pre><h4 id=gong-zuo-yuan-li>工作原理：</h4><ol><li>计算包装差值：<code>self.0.wrapping_sub(other.0)</code> <ul><li>示例：<code>(5u32).wrapping_sub(10) = 4294967291</code>（非负数）</ul><li>比较差值与 <code>2^31</code>（世代范围的半周期） <ul><li>若 <code>diff < 2^31</code> → <code>Ordering::Greater</code>（<code>self</code> 较新）<li>若 <code>diff >= 2^31</code> → <code>Ordering::Less</code>（<code>self</code> 较旧）</ul></ol><h4 id=xing-wei-shi-li>行为示例：</h4><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 正常场景（差值 < 2^31）
</span><span style=color:#fa6e32>let</span><span> gen1 </span><span style=color:#ed9366>=</span><span> EntityGeneration(</span><span style=color:#ff8f40>100</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> gen2 </span><span style=color:#ed9366>=</span><span> EntityGeneration(</span><span style=color:#ff8f40>200</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(gen1</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(</span><span style=color:#ed9366>&</span><span>gen2)</span><span style=color:#61676ccc>, </span><span>Ordering</span><span style=color:#ed9366>::</span><span>Less)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 200 - 100 = 100 < 2^31
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 包装场景（差值 >= 2^31）
</span><span style=color:#fa6e32>let</span><span> gen3 </span><span style=color:#ed9366>=</span><span> EntityGeneration(</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> gen4 </span><span style=color:#ed9366>=</span><span> EntityGeneration(</span><span style=color:#fa6e32>u32</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MAX</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(gen3</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(</span><span style=color:#ed9366>&</span><span>gen4)</span><span style=color:#61676ccc>, </span><span>Ordering</span><span style=color:#ed9366>::</span><span>Greater)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 0 - MAX = 1 (包装) < 2^31 → 0较新
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// 边界场景（差值 = 2^31）
</span><span style=color:#fa6e32>let</span><span> gen5 </span><span style=color:#ed9366>=</span><span> EntityGeneration(</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> gen6 </span><span style=color:#ed9366>=</span><span> EntityGeneration(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>31</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(gen5</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(</span><span style=color:#ed9366>&</span><span>gen6)</span><span style=color:#61676ccc>, </span><span>Ordering</span><span style=color:#ed9366>::</span><span>Equal)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 需特别注意
</span></code></pre><h3 id=ji-shu-dong-cha>技术洞察</h3><ol><li><p><strong>半周期比较原理</strong></p> <ul><li>利用世代差值与 <code>2^31</code> 的比较，将环形空间(u32范围)线性化<li>当两世代间隔 < 2^31 时，结果准确<li>间隔 ≥ 2^31 时可能误判（文档已明确说明）</ul><li><p><strong>别名(aliasing)处理</strong></p> <ul><li>新增文档强调世代包装风险：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let </span><span>(aliased</span><span style=color:#61676ccc>,</span><span> did_alias) </span><span style=color:#ed9366>= </span><span>EntityGeneration</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FIRST
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>after_versions</span><span>(</span><span style=color:#ff8f40>1</span><span style=color:#fa6e32>u32 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>31</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>after_versions_and_could_alias</span><span>(</span><span style=color:#ff8f40>1</span><span style=color:#fa6e32>u32 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>31</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert!</span><span>(did_alias)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert!</span><span>(EntityGeneration</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FIRST </span><span style=color:#ed9366>==</span><span> aliased)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// 不同实体相同ID！
</span></code></pre><li>给出实践建议： <ul><li>实体反生成(despawn)后立即停止持有其 <code>Entity</code><li>勿假设旧 <code>Entity</code> 仍对应原实体</ul></ul></ol><h3 id=ying-xiang-fen-xi>影响分析</h3><ol><li><p><strong>正向影响</strong></p> <ul><li>修复常见场景下的排序直觉<li>消除用户手动访问 <code>u32</code> 的需求<li>文档明确警示别名风险</ul><li><p><strong>已知局限</strong></p> <ul><li>世代差 ≥ 2^31 时排序可能反转：<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// 错误排序（文档示例）
</span><span style=color:#f07171>assert!</span><span>(EntityGeneration</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FIRST </span><span style=color:#ed9366>> </span><span>EntityGeneration</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FIRST</span><span style=color:#ed9366>.</span><span style=color:#f07171>after_versions</span><span>(</span><span style=color:#ff8f40>400 </span><span style=color:#ed9366>+ </span><span>(</span><span style=color:#ff8f40>1</span><span style=color:#fa6e32>u32 </span><span style=color:#ed9366><< </span><span style=color:#ff8f40>31</span><span>)))</span><span style=color:#61676ccc>;
</span></code></pre><li>排序性能略微下降（包装减法+比较 vs 直接整数比较）</ul></ol><hr><h2 id=guan-jian-wen-jian-bian-geng>关键文件变更</h2><h3 id=crates-bevy-ecs-src-entity-mod-rs><code>crates/bevy_ecs/src/entity/mod.rs</code></h3><h4 id=bian-geng-nei-rong>变更内容：</h4><ol><li><p><strong>重写排序逻辑</strong><br> 删除原自动派生的 <code>Ord</code>，实现基于半周期比较的手动排序：</p> <pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span style=color:#f07171>-#[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash, Debug, Display)]
</span><span style=color:#86b300>+#[derive(Clone, Copy, PartialEq, Eq, Hash, Debug, Display)]
</span><span>...
</span><span style=color:#86b300>+impl PartialOrd for EntityGeneration {
</span><span style=color:#86b300>+    fn partial_cmp(&self, other: &Self) -> Option&LTcore::cmp::Ordering> {
</span><span style=color:#86b300>+        Some(self.cmp(other))
</span><span style=color:#86b300>+    }
</span><span style=color:#86b300>+}
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+impl Ord for EntityGeneration {
</span><span style=color:#86b300>+    fn cmp(&self, other: &Self) -> core::cmp::Ordering {
</span><span style=color:#86b300>+        let diff = self.0.wrapping_sub(other.0);
</span><span style=color:#86b300>+        (1u32 << 31).cmp(&diff)
</span><span style=color:#86b300>+    }
</span><span style=color:#86b300>+}
</span></code></pre><li><p><strong>增强文档</strong><br> 新增：</p> <ul><li>排序行为的数学解释<li>别名风险的代码示例<li>实体使用的最佳实践</ul> <pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// # Ordering
</span><span style=color:#abb0b6;font-style:italic>/// 若 diff = a.wrapping_sub(b)：
</span><span style=color:#abb0b6;font-style:italic>///   diff < 2^31  ⇒ a > b (a更新)
</span><span style=color:#abb0b6;font-style:italic>///   diff >= 2^31 ⇒ a < b (a更旧)
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// # Aliasing
</span><span style=color:#abb0b6;font-style:italic>/// let (aliased, did_alias) = ...;
</span><span style=color:#abb0b6;font-style:italic>/// assert!(EntityGeneration::FIRST == aliased); // 别名产生！
</span></code></pre></ol><h4 id=guan-lian-xing>关联性：</h4><ul><li>排序逻辑变更直接达成PR目标<li>文档更新预防未来误用</ul><hr><h2 id=yan-shen-yue-du>延伸阅读</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://lucassardois.medium.com/generational-indices-guide-8e3c5f7fd594 target=_blank>世代索引原理解析</a><li><a rel="noopener nofollow noreferrer" href=https://fgiesen.wordpress.com/2015/09/14/circular-sequence-comparison/ target=_blank>环形缓冲区比较算法</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/design/entity-component-system/ target=_blank>Bevy ECS 实体设计文档</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_19421.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>