<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19396 More uninlined_format_args fixes
        
    </title><meta content="#19396 More uninlined_format_args fixes" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-28</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-19396-zh-cn-20250528>中文</a></div></div><div class=pr-content><h1 id=more-uninlined-format-args-fixes>More uninlined_format_args fixes</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: More uninlined_format_args fixes<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19396<li><strong>Author</strong>: SpecificProtagonist<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-05-27T07:54:53Z<li><strong>Merged</strong>: 2025-05-28T02:55:13Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p>The original description is in English and remains unchanged:<h1 id=objective>Objective</h1><p>There are several uninlined format args (seems to be in more formatting macros and in more crates) that are not detected on stable, but are on nightly.<h2 id=solution>Solution</h2><p>Fix them.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a widespread code quality issue across the Bevy engine’s codebase related to Rust’s format string handling. The core problem stemmed from using uninlined format arguments - a pattern where variables are passed as separate arguments to formatting macros rather than being directly embedded in the format string. While functionally equivalent, this approach can impact readability and potentially generate suboptimal code.<p>The changes were motivated by Clippy’s <code>uninlined_format_args</code> lint, which became more aggressive in nightly Rust versions. Although not yet enabled on stable Rust, the author proactively addressed these warnings to future-proof the codebase and maintain consistency with Rust’s idiomatic formatting practices.<p>The implementation strategy involved systematically converting format strings across multiple crates to use inline variable syntax. This required modifying over 30 files spanning core engine components like ECS, reflection system, math utilities, and development tools. The changes follow a consistent pattern of replacing positional or named arguments with directly embedded variables in format strings.<p>Key technical aspects of the implementation include:<ol><li>Conversion of <code>format!</code> calls from separated arguments to inline syntax<li>Updating <code>write!</code>/<code>writeln!</code> macros in display implementations<li>Modernizing <code>println!</code> debugging statements<li>Improving error message formatting in ECS systems</ol><p>For example, in the color handling code:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Positional arguments
</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"#</span><span style=color:#ff8f40>{:02X}{:02X}{:02X}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> r</span><span style=color:#61676ccc>,</span><span> g</span><span style=color:#61676ccc>,</span><span> b)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Inline variables
</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"#</span><span style=color:#ff8f40>{r:02X}{g:02X}{b:02X}</span><span style=color:#86b300>"</span><span>)
</span></code></pre><p>These changes don’t alter runtime behavior but significantly improve code readability and maintainability. The inline syntax makes the relationship between format specifiers and variables more explicit, reducing cognitive load when scanning code.<p>The PR demonstrates several important Rust patterns:<ol><li>Leveraging Clippy lints for code quality improvements<li>Proactive maintenance against upcoming compiler changes<li>Consistent application of formatting conventions across a large codebase</ol><p>While mechanically simple, these changes touch critical systems including entity management, reflection, and serialization. The widespread nature of the modifications required careful verification to ensure no functional changes were introduced.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Formatting Macros] --> B[ECS System]
</span><span>    A --> C[Reflection System]
</span><span>    A --> D[Math Utilities]
</span><span>    A --> E[Development Tools]
</span><span>    B --> F[Entity Debugging]
</span><span>    B --> G[Error Handling]
</span><span>    C --> H[Type Validation]
</span><span>    D --> I[Color Conversion]
</span><span>    E --> J[Example Runner]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-color-src-srgba-rs-6-6><code>crates/bevy_color/src/srgba.rs</code> (+6/-6)</h3><p><strong>Change</strong>: Updated color-to-hex conversion formatting<br> <strong>Before</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"#</span><span style=color:#ff8f40>{:02X}{:02X}{:02X}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> r</span><span style=color:#61676ccc>,</span><span> g</span><span style=color:#61676ccc>,</span><span> b)
</span></code></pre><p><strong>After</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"#</span><span style=color:#ff8f40>{r:02X}{g:02X}{b:02X}</span><span style=color:#86b300>"</span><span>)
</span></code></pre><p><strong>Impact</strong>: More readable color string formatting<h3 id=tools-example-showcase-src-main-rs-5-5><code>tools/example-showcase/src/main.rs</code> (+5/-5)</h3><p><strong>Change</strong>: Improved error reporting in example runner<br> <strong>Before</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>println!</span><span>(</span><span style=color:#86b300>"Failed to rename screenshot: </span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> err)</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>After</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>println!</span><span>(</span><span style=color:#86b300>"Failed to rename screenshot: </span><span style=color:#ff8f40>{err}</span><span style=color:#86b300>"</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Impact</strong>: Cleaner error output formatting<h3 id=crates-bevy-ecs-src-entity-mod-rs-4-4><code>crates/bevy_ecs/src/entity/mod.rs</code> (+4/-4)</h3><p><strong>Change</strong>: Simplified entity display implementations<br> <strong>Before</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{:?}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> entity)
</span></code></pre><p><strong>After</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{entity:?}</span><span style=color:#86b300>"</span><span>)
</span></code></pre><p><strong>Impact</strong>: More idiomatic debug formatting<h3 id=crates-bevy-reflect-src-func-dynamic-function-rs-6-6><code>crates/bevy_reflect/src/func/dynamic_function.rs</code> (+6/-6)</h3><p><strong>Change</strong>: Updated reflection system debug output<br> <strong>Before</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"Mismatch at </span><span style=color:#ff8f40>{}</span><span style=color:#86b300> value </span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> name</span><span style=color:#61676ccc>,</span><span> i)
</span></code></pre><p><strong>After</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"Mismatch at </span><span style=color:#ff8f40>{name}</span><span style=color:#86b300> value </span><span style=color:#ff8f40>{i}</span><span style=color:#86b300>"</span><span>)
</span></code></pre><p><strong>Impact</strong>: Clearer validation error messages<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/fmt/ target=_blank>Rust Formatting Syntax</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args target=_blank>Clippy’s uninlined_format_args lint</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/CODE_STYLE.md target=_blank>Bevy Engine Code Style Guide</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_19396.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>