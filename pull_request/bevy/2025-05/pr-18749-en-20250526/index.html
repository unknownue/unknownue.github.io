<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18749 Enable accessibility features for the button example
        
    </title><meta content="#18749 Enable accessibility features for the button example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-26</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-18749-zh-cn-20250526>中文</a></div></div><div class=pr-content><h1 id=title-enable-accessibility-features-for-the-button-example>Title: Enable accessibility features for the button example</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Enable accessibility features for the button example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18749<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, A-Accessibility, A-UI, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-04-07T12:37:29Z<li><strong>Merged</strong>: 2025-05-26T15:37:49Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Accessibility features don’t work with the UI <code>button</code> example because <code>InputFocus</code> must be set for the accessibility systems to recognise the button.<p>Fixes #18760<h2 id=solution>Solution</h2><ul><li>Set the button entity as the <code>InputFocus</code> when it is hovered or pressed.<li>Call <code>set_changed</code> on the <code>Button</code> component when the button’s state changes to hovered or pressed (the accessibility system’s only update the button’s state when the <code>Button</code> component is marked as changed).</ul><h2 id=testing>Testing</h2><p>Install NVDA, it should say “hover” when the button is hovered and “pressed” when the button is pressed.<p>The bounds of the accessibility node are reported incorrectly. I thought we fixed this, I’ll take another look at it. It’s not a problem with this PR.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a critical gap in the Bevy UI system’s accessibility support. The original button example lacked proper screen reader integration because the accessibility systems required two specific pieces of information that weren’t being provided: focus management and state change notifications.<p><strong>The Core Problem</strong> emerged from Bevy’s accessibility implementation requiring explicit tracking of focused UI elements through the <code>InputFocus</code> resource. Without this tracking, assistive technologies like NVDA couldn’t recognize button state changes. Additionally, the accessibility systems only processed updates when the <code>Button</code> component itself was marked as changed - a detail that wasn’t handled in the original implementation.<p><strong>The Solution Approach</strong> required two parallel fixes:<ol><li><strong>Focus Management</strong>: Setting the <code>InputFocus</code> resource to track the active button entity during interactions<li><strong>State Change Signaling</strong>: Explicitly marking the <code>Button</code> component as changed to trigger accessibility updates</ol><p>The implementation modified both system setup and interaction handling:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added to app initialization
</span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTInputFocus>()
</span></code></pre><p>In the button system query:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Modified query to include Entity and Button component
</span><span>Query<
</span><span>    (
</span><span>        Entity,
</span><span>        </span><span style=color:#ed9366>&</span><span>Interaction,
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BackgroundColor,
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BorderColor,
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Button,  // Added to access Button component
</span><span>        </span><span style=color:#ed9366>&</span><span>Children,
</span><span>    ),
</span><span>    Changed&LTInteraction>,
</span><span>>
</span></code></pre><p>Interaction handling gained focus management:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>match </span><span style=color:#ed9366>*</span><span>interaction {
</span><span>    Interaction</span><span style=color:#ed9366>::</span><span>Pressed </span><span style=color:#ed9366>=> </span><span>{
</span><span>        input_focus</span><span style=color:#ed9366>.</span><span style=color:#f07171>set</span><span>(entity)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Set focus on press
</span><span>        button</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_changed</span><span>()</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Force accessibility update
</span><span>    }
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Similar handling for Hovered state
</span><span>}
</span></code></pre><p><strong>Key Technical Insights</strong>:<ol><li>The <code>InputFocus</code> resource acts as a global tracker for accessibility focus<li>Bevy’s ECS requires explicit change detection for components not directly modified by systems<li>Accessibility systems rely on component change flags rather than indirect state changes</ol><p><strong>Impact</strong>:<ul><li>Enables proper screen reader feedback for UI buttons<li>Demonstrates correct accessibility integration patterns<li>Provides reference implementation for other UI components</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Button Interaction System] --> B[Set InputFocus]
</span><span>    A --> C[Update Button State]
</span><span>    C --> D[Mark Button Changed]
</span><span>    B --> E[Accessibility Systems]
</span><span>    D --> E
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File</strong>: <code>examples/ui/button.rs</code> (+18/-3)<p>Key modifications:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#ed9366>...</span><span style=color:#61676ccc>, </span><span>prelude</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>winit</span><span style=color:#ed9366>::</span><span>WinitSettings}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_system</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>interaction_query</span><span style=color:#61676ccc>: </span><span>Query<
</span><span>        (</span><span style=color:#ed9366>&</span><span>Interaction, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BackgroundColor, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BorderColor, </span><span style=color:#ed9366>&</span><span>Children),
</span><span>        (Changed&LTInteraction>, With&LTButton>),
</span><span>    >,
</span><span>) { </span><span style=color:#ed9366>... </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#ed9366>...</span><span style=color:#61676ccc>, </span><span>input_focus</span><span style=color:#ed9366>::</span><span>InputFocus</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>...</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTInputFocus>()
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_system</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>input_focus</span><span style=color:#61676ccc>: </span><span>ResMut&LTInputFocus>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>interaction_query</span><span style=color:#61676ccc>: </span><span>Query<
</span><span>        (Entity, </span><span style=color:#ed9366>&</span><span>Interaction, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BackgroundColor, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BorderColor, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Button, </span><span style=color:#ed9366>&</span><span>Children),
</span><span>        Changed&LTInteraction>,
</span><span>    >,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Added focus management and change marking
</span><span>    input_focus</span><span style=color:#ed9366>.</span><span style=color:#f07171>set</span><span>(entity)</span><span style=color:#61676ccc>;
</span><span>    button</span><span style=color:#ed9366>.</span><span style=color:#f07171>set_changed</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>These changes connect the button’s interaction states to Bevy’s accessibility infrastructure through proper focus management and change detection.<h2 id=further-reading>Further Reading</h2><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/accessibility/ target=_blank>Bevy Accessibility Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://www.w3.org/WAI/ARIA/apg/ target=_blank>WAI-ARIA Authoring Practices</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ecs/change-detection/ target=_blank>Bevy Change Detection System</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_18749.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>