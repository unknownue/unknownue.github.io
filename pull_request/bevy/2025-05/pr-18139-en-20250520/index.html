<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #18139 UI Node Gradients
        
    </title><meta content="#18139 UI Node Gradients" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-20</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-18139-zh-cn-20250520>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: UI Node Gradients<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/18139<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-Rendering, A-UI, S-Ready-For-Final-Review, M-Needs-Release-Note, D-Shaders<li><strong>Created</strong>: 2025-03-03T16:30:52Z<li><strong>Merged</strong>: 2025-05-20T15:05:42Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Allowing drawing of UI nodes with a gradient instead of a flat color.<h2 id=solution>Solution</h2><p>The are three gradient structs corresponding to the three types of gradients supported: <code>LinearGradient</code>, <code>ConicGradient</code> and <code>RadialGradient</code>. These are then wrapped in a <code>Gradient</code> enum discriminator which has <code>Linear</code>, <code>Conic</code> and <code>Radial</code> variants.<p>Each gradient type consists of the geometric properties for that gradient and a list of color stops. Color stops consist of a color, a position or angle and an optional hint. If no position is specified for a stop, it’s evenly spaced between the previous and following stops. Color stop positions are absolute, if you specify a list of stops: <code>vec![vec![ColorStop::new(RED, Val::Percent(90.), ColorStop::new(Color::GREEN, Val::Percent(10.))</code> the colors will be reordered and the gradient will transition from green at 10% to red at 90%.<p>Colors are interpolated between the stops in SRGB space. The hint is a normalized value that can be used to shift the mid-point where the colors are mixed 50-50. between the stop with the hint and the following stop.<p>For sharp stops with no interpolated transition, place two stops at the same position.<p><code>ConicGradient</code>s and RadialGradient<code>s have a center which is set using the new </code>Position<code>type.</code>Position<code>consists of a normalized (relative to the UI node)</code>Vec2` anchor point and a responsive x, y offset.<p>To draw a UI node with a gradient you insert the components <code>BackgroundGradient</code> and <code>BorderGradient</code>, which both newtype a vector of <code>Gradient</code>s. If you set a background color, the background color is drawn first and the gradient(s) are drawn on top.<p>The implementation is deliberately simple and self contained. The shader draws the gradient in multiple passes which is quite inefficient for gradients with a very large number of color stops. It’s simple though and there won’t be any compatibility issues. We could make gradients a specialization for <code>UiPipeline</code> but I used a separate pipeline plugin for now to ensure that these changes don’t break anything.<h4 id=not-supported-in-this-pr>Not supported in this PR</h4><ul><li>Interpolation in other color spaces besides SRGB.<li>Images and text: This would need some breaking changes like a <code>UiColor</code> enum type with <code>Color</code> and <code>Gradient</code> variants, to enable <code>BorderColor</code>, <code>TextColor</code>, <code>BackgroundColor</code> and <code>ImageNode::color</code> to take either a <code>Color</code> or a gradient.<li>Repeating gradients</ul><h2 id=testing>Testing</h2><p>Includes three examples that can be used for testing:<pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example linear_gradients
</span><span>cargo run --example stacked_gradients
</span><span>cargo run --example radial_gradients
</span></code></pre><p>Most of the code except the components API is contained within the <code>bevy_ui/src/render/linear_gradients</code> module. There are no changes to any existing systems or plugins except for the addition of the gradients rendering systems to the render world schedule and the <code>Val</code> changes from #18164 .<h2 id=showcase>Showcase</h2><p><img alt=gradients src=https://github.com/user-attachments/assets/a09c5bb2-f9dc-4bc5-9d17-21a6338519d3> <img alt=stacked src=https://github.com/user-attachments/assets/7a1ad28e-8ae0-41d5-85b2-aa62647aef03> <img alt=rad src=https://github.com/user-attachments/assets/48609cf1-52aa-453c-afba-3b4845f3ddec><p>Conic gradients can be used to draw simple pie charts like in CSS: <img alt=PIE src=https://github.com/user-attachments/assets/4594b96f-52ab-4974-911a-16d065d213bc><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Bevy’s UI system previously only supported solid colors for backgrounds and borders. While sufficient for basic interfaces, this limitation prevented more sophisticated visual designs using gradients. The lack of gradient support became particularly noticeable when trying to create modern UI elements or visual effects that require smooth color transitions.<p>The challenge involved adding gradient support without breaking existing UI rendering systems. Key constraints included maintaining compatibility with Bevy’s existing ECS architecture, ensuring reasonable performance for common use cases, and providing a flexible API that supports multiple gradient types (linear, radial, conic).<h3 id=the-solution-approach>The Solution Approach</h3><p>The implementation introduces three core gradient types through a new <code>Gradient</code> enum:<ul><li><code>LinearGradient</code> with angle-based direction<li><code>RadialGradient</code> with configurable center and shape<li><code>ConicGradient</code> with angular color stops</ul><p>Each gradient type uses color stops that can specify absolute positions or auto-calculate spacing. The new <code>Position</code> struct handles responsive positioning relative to UI nodes, using normalized anchor points and Val-based offsets.<p>The rendering approach uses separate WGSL shaders for gradient calculations, processed through multiple draw calls. While not optimal for gradients with many stops, this method ensures compatibility and isolates gradient rendering from existing UI pipelines.<h3 id=the-implementation>The Implementation</h3><p>Key technical components include:<ol><li><strong>Gradient Data Structures</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>Gradient </span><span>{
</span><span>    Linear(LinearGradient)</span><span style=color:#61676ccc>,
</span><span>    Radial(RadialGradient)</span><span style=color:#61676ccc>,
</span><span>    Conic(ConicGradient)</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><ol start=2><li><strong>Position Handling</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Position </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>anchor</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>x</span><span style=color:#61676ccc>:</span><span> Val,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>y</span><span style=color:#61676ccc>:</span><span> Val,
</span><span>}
</span></code></pre><ol start=3><li><strong>Shader Integration</strong>: The <code>gradient.wgsl</code> shader implements gradient calculations using signed distance functions and SRGB color interpolation. The vertex format includes multiple attributes needed for gradient rendering:</ol><pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>struct UiGradientVertex {
</span><span>    position: vec3&LTf32>,
</span><span>    uv: vec2&LTf32>,
</span><span>    flags: u32,
</span><span>    radius: vec4&LTf32>,
</span><span>    border: vec4&LTf32>,
</span><span>    size: vec2&LTf32>,
</span><span>    point: vec2&LTf32>,
</span><span>    g_start: vec2&LTf32>,
</span><span>    g_dir: vec2&LTf32>,
</span><span>    start_color: vec4&LTf32>,
</span><span>    start_len: f32,
</span><span>    end_len: f32,
</span><span>    end_color: vec4&LTf32>,
</span><span>    hint: f32,
</span><span>}
</span></code></pre><ol start=4><li><strong>Rendering Pipeline</strong>: The gradient rendering system uses a separate pipeline specialization to avoid conflicts with existing UI rendering:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GradientPipeline </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>view_layout</span><span style=color:#61676ccc>:</span><span> BindGroupLayout,
</span><span>}
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><ul><li><strong>Color Stop Handling</strong>: Automatic stop positioning uses linear interpolation between explicit stops<li><strong>SRGB Interpolation</strong>: Colors are mixed in SRGB space for perceptual accuracy<li><strong>Performance Considerations</strong>: Multiple draw calls per gradient segment could impact performance with complex gradients<li><strong>Border Support</strong>: Separate <code>BorderGradient</code> component allows gradient borders through specialized shader flags</ul><h3 id=the-impact>The Impact</h3><ul><li>Enables sophisticated UI visual effects previously impossible<li>Maintains backward compatibility through new components<li>Adds ~1,700 lines of new code with minimal changes to existing systems<li>Sets foundation for future gradient improvements (repeating patterns, HDR colors)</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[BackgroundGradient] --> B[Gradient]
</span><span>    A --> C[BorderGradient]
</span><span>    B --> D[LinearGradient]
</span><span>    B --> E[RadialGradient]
</span><span>    B --> F[ConicGradient]
</span><span>    D --> G[ColorStop]
</span><span>    E --> G
</span><span>    F --> H[AngularColorStop]
</span><span>    E --> I[Position]
</span><span>    F --> I
</span><span>    E --> J[RadialGradientShape]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ui-src-render-gradient-rs-916-0><code>crates/bevy_ui/src/render/gradient.rs</code> (+916/-0)</h3><p>Implements gradient extraction and GPU data preparation. Key snippet:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>prepare_gradient</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#ff8f40>render_device</span><span style=color:#61676ccc>: </span><span>Res&LTRenderDevice>,
</span><span>    </span><span style=color:#ff8f40>render_queue</span><span style=color:#61676ccc>: </span><span>Res&LTRenderQueue>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>ui_meta</span><span style=color:#61676ccc>: </span><span>ResMut&LTGradientMeta>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other params
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Handles buffer creation and batch preparation
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-src-gradients-rs-575-0><code>crates/bevy_ui/src/gradients.rs</code> (+575/-0)</h3><p>Defines gradient data structures and component types:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>LinearGradient </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>angle</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>stops</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTColorStop>,
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-src-geometry-rs-216-26><code>crates/bevy_ui/src/geometry.rs</code> (+216/-26)</h3><p>Adds <code>Position</code> type for responsive gradient positioning:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Position </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>anchor</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>x</span><span style=color:#61676ccc>:</span><span> Val,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>y</span><span style=color:#61676ccc>:</span><span> Val,
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-src-render-gradient-wgsl-193-0><code>crates/bevy_ui/src/render/gradient.wgsl</code> (+193/-0)</h3><p>Implements gradient shader logic:<pre class=language-wgsl data-lang=wgsl style=color:#61676c;background-color:#fafafa><code class=language-wgsl data-lang=wgsl><span>fn linear_distance(
</span><span>    point: vec2&LTf32>,
</span><span>    g_start: vec2&LTf32>,
</span><span>    g_dir: vec2&LTf32>,
</span><span>) -> f32 {
</span><span>    return dot(point - g_start, g_dir);
</span><span>}
</span></code></pre><h3 id=examples-ui-gradients-rs-186-0><code>examples/ui/gradients.rs</code> (+186/-0)</h3><p>Demonstrates various gradient configurations:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        width</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>100.</span><span>)</span><span style=color:#61676ccc>,
</span><span>        height</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>100.</span><span>)</span><span style=color:#61676ccc>,
</span><span>        border</span><span style=color:#61676ccc>: </span><span>UiRect</span><span style=color:#ed9366>::</span><span>all(Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>5.</span><span>))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    BackgroundGradient</span><span style=color:#ed9366>::</span><span>from(LinearGradient {
</span><span>        angle</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>0.5 </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>TAU</span><span style=color:#61676ccc>,
</span><span>        stops</span><span style=color:#61676ccc>: </span><span style=color:#f07171>vec!</span><span>[</span><span style=color:#ff8f40>RED</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>BLUE</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()]</span><span style=color:#61676ccc>,
</span><span>    })</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://developer.mozilla.org/en-US/docs/Web/CSS/gradient target=_blank>MDN Gradient Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://www.w3.org/TR/WGSL/ target=_blank>WGSL Shader Language Spec</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/plugins/ui/ target=_blank>Bevy UI Rendering Architecture</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_18139.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>