<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19268 Fix missing meta files breaking Bevy on itch
        
    </title><meta content="#19268 Fix missing meta files breaking Bevy on itch" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-30</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-19268-zh-cn-20250530>中文</a></div></div><div class=pr-content><h2 id=fix-missing-meta-files-breaking-bevy-on-itch>Fix missing meta files breaking Bevy on itch</h2><h3 id=basic-information>Basic Information</h3><ul><li><strong>Title</strong>: Fix missing meta files breaking Bevy on itch<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19268<li><strong>Author</strong>: rparrett<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Assets, O-Web, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-05-17T19:41:39Z<li><strong>Merged</strong>: 2025-05-30T20:58:15Z<li><strong>Merged By</strong>: mockersf</ul><h3 id=description-translation>Description Translation</h3><h1 id=objective>Objective</h1><p>Fixes #19029 (also maybe sorta #18002, but we may want to handle the SPA issue I outlined there more gracefully?)<h2 id=solution>Solution</h2><p>The most minimal / surgical approach I could think of, hopefully cherry-pickable for a point release.<p>It seems that it’s not <em>entirely</em> crazy for web services to return 403 for an item that was not found. Here’s an example from <a rel="noopener nofollow noreferrer" href=https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/http-403-permission-denied.html#s3-origin-403-error target=_blank>Amazon CloudFront docs</a>. If it is somewhat common for web services to behave this way, then I think it’s best to also treat these responses as if they were “not found.”<p>I was previously of the opinion that any 400 level error “might as well” get this treatment, but I’m now thinking that’s probably overkill and there are quite a few 400 level statuses that would indicate some problem that needs to be fixed, and interpreting these as “not found” might add confusion to the debugging process.<h2 id=testing>Testing</h2><p>Tested this with a web server that returns 403 for requests to meta files.<pre class=language-bash data-lang=bash style=color:#61676c;background-color:#fafafa><code class=language-bash data-lang=bash><span style=color:#f29718>cargo</span><span> run</span><span style=color:#ff8f40> -p</span><span> build-wasm-example</span><span style=color:#ed9366> --</span><span> --api webgl2 sprite </span><span style=color:#ed9366>&& </span><span style=color:#61676ccc>\
</span><span style=color:#f29718>open </span><span style=color:#86b300>"http://localhost:4000" </span><span style=color:#ed9366>&& </span><span style=color:#61676ccc>\
</span><span style=color:#f29718>python3</span><span> test_403.py examples/wasm
</span></code></pre><p><code>test_403.py</code>:<pre class=language-python data-lang=python style=color:#61676c;background-color:#fafafa><code class=language-python data-lang=python><span style=color:#fa6e32>from </span><span>http</span><span style=color:#ed9366>.</span><span>server </span><span style=color:#fa6e32>import </span><span>HTTPServer</span><span style=color:#61676ccc>, </span><span>SimpleHTTPRequestHandler
</span><span style=color:#fa6e32>import </span><span>os
</span><span style=color:#fa6e32>import </span><span>sys
</span><span>
</span><span style=color:#fa6e32>class </span><span style=color:#399ee6>CustomHandler</span><span>(</span><span style=color:#399ee6;text-decoration:underline>SimpleHTTPRequestHandler</span><span>):
</span><span>    </span><span style=color:#fa6e32>def </span><span style=color:#f29718>do_GET</span><span>(</span><span style=color:#ff8f40>self</span><span>):
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>path</span><span style=color:#ed9366>.</span><span style=color:#f29718>endswith</span><span>(</span><span style=color:#86b300>".meta"</span><span>):
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f29718>send_response</span><span>(</span><span style=color:#ff8f40>403</span><span>)
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f29718>send_header</span><span>(</span><span style=color:#86b300>"Content-type"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"text/plain"</span><span>)
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f29718>end_headers</span><span>()
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>wfile</span><span style=color:#ed9366>.</span><span style=color:#f29718>write</span><span>(</span><span style=color:#fa6e32>b</span><span style=color:#86b300>"403 Forbidden: Testing.</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>"</span><span>)
</span><span>        </span><span style=color:#fa6e32>else</span><span>:
</span><span>            </span><span style=color:#f07171>super</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f29718>do_GET</span><span>()
</span><span>
</span><span style=color:#fa6e32>if </span><span>__name__ </span><span style=color:#ed9366>== </span><span style=color:#86b300>"__main__"</span><span>:
</span><span>    </span><span style=color:#fa6e32>if </span><span style=color:#f07171>len</span><span>(sys</span><span style=color:#ed9366>.</span><span>argv) </span><span style=color:#ed9366>!= </span><span style=color:#ff8f40>2</span><span>:
</span><span>        </span><span style=color:#f07171>print</span><span>(</span><span style=color:#fa6e32>f</span><span style=color:#86b300>"Usage: </span><span>{sys</span><span style=color:#ed9366>.</span><span>argv[</span><span style=color:#ff8f40>0</span><span>]}</span><span style=color:#86b300> &LTdirectory>"</span><span>)
</span><span>        sys</span><span style=color:#ed9366>.</span><span style=color:#f29718>exit</span><span>(</span><span style=color:#ff8f40>1</span><span>)
</span><span>        
</span><span>    os</span><span style=color:#ed9366>.</span><span style=color:#f29718>chdir</span><span>(sys</span><span style=color:#ed9366>.</span><span>argv[</span><span style=color:#ff8f40>1</span><span>])
</span><span>    
</span><span>    server_address </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#86b300>""</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>4000</span><span>)
</span><span>    httpd </span><span style=color:#ed9366>= </span><span style=color:#f29718>HTTPServer</span><span>(server_address</span><span style=color:#61676ccc>, </span><span>CustomHandler)
</span><span>    httpd</span><span style=color:#ed9366>.</span><span style=color:#f29718>serve_forever</span><span>()
</span></code></pre><h3 id=the-story-of-this-pull-request>The Story of This Pull Request</h3><h4 id=the-problem-and-context>The Problem and Context</h4><p>Bevy applications deployed to itch.io were failing to load due to a specific behavior in itch’s CDN. When assets were missing - particularly <code>.meta</code> files - itch’s CDN returned HTTP 403 (Forbidden) responses instead of the standard 404 (Not Found). This behavior conflicted with Bevy’s web asset loader, which only treated 404 errors as missing assets. The 403 responses were being interpreted as hard errors, causing asset loading to fail completely and breaking application startup.<p>This issue was especially problematic because <code>.meta</code> files are optional in many Bevy workflows. Developers shouldn’t need to include them in production builds, but the CDN behavior made their absence fatal. The problem was documented in issue #19029, where users reported their games failing to load on itch.io despite working correctly locally.<h4 id=the-solution-approach>The Solution Approach</h4><p>The developer considered several approaches:<ol><li>Treat all 400-level status codes as missing assets<li>Make the status code handling configurable<li>Specifically handle 403 as equivalent to 404 for asset loading</ol><p>After research, the developer discovered this behavior wasn’t unique to itch.io - services like Amazon CloudFront also return 403 for missing resources in some configurations. However, treating all 400-level errors as missing assets was rejected as potentially masking real problems (like authentication issues). A configurable solution was deemed too heavy for an immediate fix. The chosen approach was the minimal surgical change: specifically handle HTTP 403 and 404 identically as missing assets.<h4 id=the-implementation>The Implementation</h4><p>The change was localized to the HTTP response handler in Bevy’s WASM asset reader. Previously, only 404 responses were mapped to the <code>NotFound</code> error variant. The modification added 403 to this handling:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ff8f40>404 </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(AssetReaderError</span><span style=color:#ed9366>::</span><span>NotFound(path))</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ff8f40>403 </span><span style=color:#ed9366>| </span><span style=color:#ff8f40>404 </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(AssetReaderError</span><span style=color:#ed9366>::</span><span>NotFound(path))</span><span style=color:#61676ccc>,
</span></code></pre><p>The implementation includes a TODO comment acknowledging this might be a temporary solution until a more configurable system exists. The change maintains existing error handling for other status codes, preserving the ability to detect genuine server errors.<h4 id=technical-insights>Technical Insights</h4><p>This solution works because:<ol><li>Bevy’s asset system treats <code>NotFound</code> errors as non-fatal for optional assets<li>Missing <code>.meta</code> files don’t break critical functionality<li>The change doesn’t affect other error cases (500s, 401s, etc.)</ol><p>The HTTP 403 case is handled identically to 404 at the asset system level, despite being semantically different at the HTTP layer. This is acceptable because:<ul><li>The asset system only cares whether the asset exists<li>The root cause (CDN misconfiguration) is outside Bevy’s control<li>No security implications exist since assets are public</ul><h4 id=the-impact>The Impact</h4><p>This change resolved the immediate issue of Bevy applications failing to load on itch.io when <code>.meta</code> files were missing. The fix:<ul><li>Required minimal code changes<li>Maintained backward compatibility<li>Didn’t introduce new dependencies<li>Was easily backportable to maintenance branches</ul><p>The solution demonstrates how targeted fixes for deployment-specific issues can maintain framework flexibility while supporting real-world constraints.<h3 id=visual-representation>Visual Representation</h3><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[HTTP Request] --> B{WasmAssetReader}
</span><span>    B -->|403 Response| C[Treat as NotFound]
</span><span>    B -->|404 Response| C
</span><span>    B -->|Other Status| D[Return HttpError]
</span><span>    C --> E[Asset System Continues]
</span></code></pre><h3 id=key-files-changed>Key Files Changed</h3><h4 id=crates-bevy-asset-src-io-wasm-rs><code>crates/bevy_asset/src/io/wasm.rs</code></h4><p><strong>Change</strong>: Modified HTTP response handling to treat 403 and 404 status codes identically as missing assets<br> <strong>Why</strong>: To fix Bevy applications failing on itch.io due to CDN returning 403 for missing assets<br> <strong>Code</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ff8f40>404 </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(AssetReaderError</span><span style=color:#ed9366>::</span><span>NotFound(path))</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>// Some web servers, including itch.io's CDN, return 403 when a requested file isn't present.
</span><span style=color:#abb0b6;font-style:italic>// TODO: remove handling of 403 as not found when it's easier to configure
</span><span style=color:#abb0b6;font-style:italic>// see https://github.com/bevyengine/bevy/pull/19268#pullrequestreview-2882410105
</span><span style=color:#ff8f40>403 </span><span style=color:#ed9366>| </span><span style=color:#ff8f40>404 </span><span style=color:#ed9366>=> </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(AssetReaderError</span><span style=color:#ed9366>::</span><span>NotFound(path))</span><span style=color:#61676ccc>,
</span></code></pre><h3 id=further-reading>Further Reading</h3><ol><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/assets/ target=_blank>Bevy Asset System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Status target=_blank>HTTP Status Code Definitions</a><li><a rel="noopener nofollow noreferrer" href=https://itch.io/docs/creators/html5 target=_blank>itch.io Deployment Guide</a></ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_19268.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>