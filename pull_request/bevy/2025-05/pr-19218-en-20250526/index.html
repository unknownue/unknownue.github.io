<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19218 Navigate through TabGroups in order.
        
    </title><meta content="#19218 Navigate through TabGroups in order." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-26</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-19218-zh-cn-20250526>中文</a></div></div><div class=pr-content><h1 id=navigate-through-tabgroups-in-order>Navigate through TabGroups in order</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Navigate through TabGroups in order.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19218<li><strong>Author</strong>: FlippinBerger<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-Input, A-UI, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-05-15T19:42:03Z<li><strong>Merged</strong>: 2025-05-26T20:00:05Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #19156<h2 id=solution>Solution</h2><p>There was a call to sort by <code>TabIndex</code> after iterating through all the <code>TabGroup</code>s. Simply removing that line of code made the new test case pass (navigating through <code>TabIndex</code> within different <code>TabGroup</code>s and kept everything else working as expected as far as I can tell.<p>I went ahead and broke the <code>focusable</code> vec down into per-group vecs that get sorted by <code>TabIndex</code> and appended to the main vec in group sorted order to maintain the sorting that was being done before, but respecting the <code>TabGroup</code> sorting that was missing in the issue that this PR addresses.<h2 id=testing>Testing</h2><p>I added a new unit test that reproduced the issue outlined above that will run in CI. This test was failing before deleting the sort, and now both unit tests are passing.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The PR addresses a navigation issue in Bevy’s UI tab system where tab order didn’t properly respect TabGroup hierarchies. The core problem stemmed from how focusable elements were collected and sorted during tab navigation.<p>Previously, the implementation gathered all focusable entities into a single list and sorted them solely by their TabIndex values. This approach worked for flat structures but failed to account for TabGroup ordering when elements were organized into hierarchical groups. The key problematic line was a global sort by TabIndex that overrode the natural group-based ordering.<p>The solution involved three main changes:<ol><li><strong>Data Structure Modification</strong>: The <code>focusable</code> vector was enhanced to track group membership:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Vec<(Entity, TabIndex)>
</span><span style=color:#abb0b6;font-style:italic>// After: Vec<(Entity, TabIndex, usize)>
</span><span style=color:#fa6e32>let mut</span><span> focusable</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(Entity, TabIndex, </span><span style=color:#fa6e32>usize</span><span>)> </span><span style=color:#ed9366>= ...
</span></code></pre><ol start=2><li><strong>Hierarchical Sorting</strong>: The sorting logic was updated to prioritize group order before TabIndex:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>focusable</span><span style=color:#ed9366>.</span><span style=color:#f07171>sort_by</span><span>(|(_</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>a_tab_idx</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>a_group</span><span>)</span><span style=color:#61676ccc>, </span><span>(_</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>b_tab_idx</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>b_group</span><span>)| {
</span><span>    </span><span style=color:#fa6e32>if</span><span> a_group </span><span style=color:#ed9366>==</span><span> b_group {
</span><span>        a_tab_idx</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(b_tab_idx)
</span><span>    } </span><span style=color:#fa6e32>else </span><span>{
</span><span>        a_group</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(b_group)
</span><span>    }
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Recursive Group Handling</strong>: The <code>gather_focusable</code> method was modified to propagate group indices during tree traversal:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>gather_focusable</span><span>(
</span><span>    </span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>,
</span><span>    </span><span style=color:#ff8f40>out</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(Entity, TabIndex, </span><span style=color:#fa6e32>usize</span><span>)>,
</span><span>    </span><span style=color:#ff8f40>parent</span><span style=color:#61676ccc>:</span><span> Entity,
</span><span>    </span><span style=color:#ff8f40>tab_group_idx</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize  </span><span style=color:#abb0b6;font-style:italic>// New parameter
</span><span>) { </span><span style=color:#ed9366>... </span><span>}
</span></code></pre><p>The implementation maintains backward compatibility while fixing the group navigation issue. By tracking group membership during the collection phase and using a two-level sort (group order first, then TabIndex), the solution preserves existing behavior for simple cases while adding proper hierarchical navigation.<p>A new test case <code>test_tab_navigation_between_groups_is_sorted_by_group</code> verifies the correct behavior across multiple groups. This test creates two TabGroups with different orders and validates navigation between them:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Group 1 (order 0) contains elements 1 and 2
</span><span style=color:#abb0b6;font-style:italic>// Group 2 (order 1) contains elements 3 and 4
</span><span style=color:#f07171>assert_eq!</span><span>(next_from_end_of_group_entity</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(tab_entity_3))</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Cross-group navigation
</span><span style=color:#f07171>assert_eq!</span><span>(prev_entity_from_start_of_group</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(tab_entity_2))</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Reverse cross-group
</span></code></pre><p>The changes demonstrate an effective approach to hierarchical UI navigation by:<ol><li>Augmenting data collection with contextual information (group index)<li>Implementing multi-criteria sorting<li>Maintaining recursive traversal while respecting group boundaries</ol><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Tab Navigation System] --> B[Collect Focusables]
</span><span>    B --> C[Track Group Index]
</span><span>    B --> D[Recursive Tree Traversal]
</span><span>    A --> E[Sort Entities]
</span><span>    E --> F[Primary Sort: Group Order]
</span><span>    E --> G[Secondary Sort: TabIndex]
</span><span>    A --> H[Select Target Entity]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-input-focus-src-tab-navigation-rs-67-12>crates/bevy_input_focus/src/tab_navigation.rs (+67/-12)</h3><ol><li><strong>Data Structure Update</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let mut</span><span> focusable</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(Entity, TabIndex)> 
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let mut</span><span> focusable</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(Entity, TabIndex, </span><span style=color:#fa6e32>usize</span><span>)>
</span></code></pre><p>Adds group index tracking to each focusable entity.<ol start=2><li><strong>Sorting Logic Update</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>focusable</span><span style=color:#ed9366>.</span><span style=color:#f07171>sort_by_key</span><span>(|(_</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>idx</span><span>)| </span><span style=color:#ed9366>*</span><span>idx)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>focusable</span><span style=color:#ed9366>.</span><span style=color:#f07171>sort_by</span><span>(|(_</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>a_tab_idx</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>a_group</span><span>)</span><span style=color:#61676ccc>,</span><span> ...| {
</span><span>    a_group</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(b_group)</span><span style=color:#ed9366>.</span><span style=color:#f07171>then_with</span><span>(|| a_tab_idx</span><span style=color:#ed9366>.</span><span style=color:#f07171>cmp</span><span>(b_tab_idx))
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><p>Implements hierarchical sorting based on group order and TabIndex.<ol start=3><li><strong>Recursive Gathering</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Modified method signature
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>gather_focusable</span><span>(..., </span><span style=color:#ff8f40>tab_group_idx</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Propagates group index through recursive calls
</span><span>    out</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>((entity</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>*</span><span>tabindex</span><span style=color:#61676ccc>,</span><span> tab_group_idx))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>Maintains group context during tree traversal.<h2 id=further-reading>Further Reading</h2><ol><li>Bevy UI Navigation System Documentation: [https://bevyengine.org/learn/book/input/ui-navigation/]<li>Accessibility Tree Navigation Patterns: [https://www.w3.org/WAI/ARIA/apg/patterns/]<li>Rust Sorting with Multiple Criteria: [https://doc.rust-lang.org/std/primitive.slice.html#method.sort_by]</ol></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_19218.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>