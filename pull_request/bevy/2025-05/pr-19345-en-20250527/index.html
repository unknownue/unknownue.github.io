<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19345 `box_shadow` example with adjustable settings
        
    </title><meta content="#19345 `box_shadow` example with adjustable settings" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-27</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-19345-zh-cn-20250527>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: <code>box_shadow</code> example with adjustable settings<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19345<li><strong>Author</strong>: oracle58<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, A-UI, X-Contentious, S-Waiting-on-Author<li><strong>Created</strong>: 2025-05-23T12:59:46Z<li><strong>Merged</strong>: 2025-05-27T20:04:20Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Addresses the previous example’s lack of visual appeal and clarity. It was missing labels for clear distinction of the shadow settings used on each of the shapes. The suggestion in the linked issue was to either just visually update and add labels or to collapse example to a single node with adjustable settings.<li>Fixes #19240</ul><h2 id=solution>Solution</h2><ul><li>Replace the previous static example with a single, central node with adjustable settings as per issue suggestion.<li>Implement button-based setting adjustments. Unfortunately slider widgets don’t seem available yet and I didn’t want to further bloat the example.<li>Improve overall aesthetics of the example – although color pallette could still be improved. flat gray tones are probably not the best choice as a contrast to the shadow, but the white border does help in that aspect.<li>Dynamically recolor shadows for visual clarity when increasing shadow count.<li>Add Adjustable Settings: <ul><li>Shape selection<li>Shadow X/Y offset, blur, spread, and count</ul><li>Add Reset button to restore default settings</ul><p>The disadvantage of this solution is that the old example code would have probably been easier to digest as the new example is quite bloated in comparison. Alternatively I could also just implement labels and fix aesthetics of the old example without adding functionality for adjustable settings, <em>but</em> I personally feel like interactive examples are more engaging to users.<h2 id=testing>Testing</h2><ul><li>Did you test these changes? If so, how? <code>cargo run --example box_shadow</code> and functionality of all features of the example.<li>Are there any parts that need more testing? Not that I am aware of.<li>How can other people (reviewers) test your changes? Is there anything specific they need to know? Not really, it should be pretty straightforward just running the new example and testing the feats.</ul><hr><h2 id=showcase>Showcase</h2><p><img alt=box-shadow-example-1 src=https://github.com/user-attachments/assets/57586b30-c290-4e3f-9355-5c3f6e9a6406><p><img alt=box-shadow-example-2 src=https://github.com/user-attachments/assets/51a51d2f-dd30-465b-b802-ddb8077adff5><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>The existing <code>box_shadow</code> example suffered from two main issues: poor visual differentiation between test cases and lack of interactivity. With multiple static nodes displaying various shadow configurations, users couldn’t easily correlate visual effects with specific parameter values. The original grid layout (#19240) made it difficult to compare settings side-by-side and understand how individual parameters affected the final render.<h3 id=the-solution-approach>The Solution Approach</h3><p>The author chose to implement an interactive demo centered around a single configurable node. Key decisions included:<ol><li>Using button controls instead of sliders (unavailable in Bevy’s UI at the time)<li>Implementing parameter persistence through resource structs (<code>ShadowSettings</code>, <code>ShapeSettings</code>)<li>Adding color variation for multiple shadows to improve visual distinction<li>Creating a floating control panel with incremental/decremental buttons</ol><p>The implementation balances interactivity with code complexity, opting for direct button controls rather than implementing a new slider widget specifically for this example.<h3 id=the-implementation>The Implementation</h3><p>The core changes revolve around three main systems:<ol><li><strong>State Management</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>ShadowSettings </span><span>{
</span><span>    x_offset</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    y_offset</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    blur</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    spread</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    count</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>    samples</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>u32</span><span>,
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>ShapeSettings </span><span>{
</span><span>    index</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>}
</span></code></pre><ol start=2><li><strong>UI Construction</strong>: The setup system creates a central shadow node and control panel using Bevy’s UI components:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        width</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>164.</span><span>)</span><span style=color:#61676ccc>,
</span><span>        height</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>164.</span><span>)</span><span style=color:#61676ccc>,
</span><span>        border</span><span style=color:#61676ccc>: </span><span>UiRect</span><span style=color:#ed9366>::</span><span>all(Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>1.</span><span>))</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    ShadowNode</span><span style=color:#61676ccc>,
</span><span>    BoxShadow(</span><span style=color:#f07171>vec!</span><span>[</span><span style=color:#ed9366>...</span><span>])</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><ol start=3><li><strong>Interactive Systems</strong>: Button handling system with repeat functionality:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>button_repeat_system</span><span>(
</span><span>    </span><span style=color:#ff8f40>time</span><span style=color:#61676ccc>: </span><span>Res&LTTime>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>held</span><span style=color:#61676ccc>: </span><span>ResMut&LTHeldButton>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>shadow</span><span style=color:#61676ccc>: </span><span>ResMut&LTShadowSettings>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>shape</span><span style=color:#61676ccc>: </span><span>ResMut&LTShapeSettings>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>redraw_events</span><span style=color:#61676ccc>: </span><span>EventWriter&LTRequestRedraw>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implements button hold-to-repeat behavior
</span><span>}
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>Key implementation details include:<ul><li><strong>Dynamic Shadow Generation</strong>: The <code>generate_shadows</code> function creates colored shadows based on count:</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>match</span><span> shadow</span><span style=color:#ed9366>.</span><span>count {
</span><span>    </span><span style=color:#ff8f40>1 </span><span style=color:#ed9366>=> </span><span style=color:#f07171>vec!</span><span>[</span><span style=color:#f07171>make_shadow</span><span>(</span><span style=color:#ff8f40>BLACK</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>...</span><span>)]</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ff8f40>2 </span><span style=color:#ed9366>=> </span><span style=color:#f07171>vec!</span><span>[</span><span style=color:#ff8f40>BLUE</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>YELLOW</span><span> shadows]</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#ff8f40>3 </span><span style=color:#ed9366>=> </span><span style=color:#f07171>vec!</span><span>[</span><span style=color:#ff8f40>BLUE</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>YELLOW</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>RED</span><span> shadows]
</span><span>}
</span></code></pre><ul><li><strong>Coordinated Updates</strong>: Systems like <code>update_shadow</code> and <code>update_shape</code> react to resource changes:</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>update_shadow</span><span>(
</span><span>    </span><span style=color:#ff8f40>shadow</span><span style=color:#61676ccc>: </span><span>Res&LTShadowSettings>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BoxShadow, With&LTShadowNode>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Updates shadow node's BoxShadow component
</span><span>}
</span></code></pre><ul><li><strong>Button State Management</strong>: The <code>HeldButton</code> resource tracks pressed buttons for repeat actions:</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Resource</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>HeldButton </span><span>{
</span><span>    button</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTSettingsButton>,
</span><span>    pressed_at</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#fa6e32>f64</span><span>>,
</span><span>    last_repeat</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#fa6e32>f64</span><span>>,
</span><span>}
</span></code></pre><h3 id=the-impact>The Impact</h3><p>This PR transforms the example from a static display to an interactive teaching tool:<ol><li>Enables real-time parameter experimentation<li>Demonstrates complex UI construction patterns<li>Shows resource-based state management<li>Illustrates interactive system design</ol><p>The trade-off comes in increased code complexity (601 lines added vs 231 removed), but provides a more engaging user experience that better demonstrates Bevy’s UI capabilities.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[User Input] --> B[Button Systems]
</span><span>    B --> C[ShadowSettings/ShapeSettings]
</span><span>    C --> D[Update Systems]
</span><span>    D --> E[Shadow Node]
</span><span>    D --> F[Control Labels]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ul><li><code>examples/ui/box_shadow.rs</code> (+601/-231)</ul><p>Key modifications:<ol><li>Replaced static node grid with interactive single node:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Multiple static nodes
</span><span style=color:#fa6e32>for </span><span>(size</span><span style=color:#61676ccc>,</span><span> offset</span><span style=color:#61676ccc>,</span><span> spread</span><span style=color:#61676ccc>,</span><span> blur</span><span style=color:#61676ccc>,</span><span> border_radius) </span><span style=color:#ed9366>in</span><span> example_nodes {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(</span><span style=color:#f07171>box_shadow_node_bundle</span><span>(</span><span style=color:#ed9366>...</span><span>))</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Single dynamic node
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {</span><span style=color:#ed9366>...</span><span>}</span><span style=color:#61676ccc>,
</span><span>    ShadowNode</span><span style=color:#61676ccc>,
</span><span>    BoxShadow(</span><span style=color:#f07171>vec!</span><span>[</span><span style=color:#ed9366>...</span><span>])</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li>Added control panel construction:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Node {
</span><span>        position_type</span><span style=color:#61676ccc>: </span><span>PositionType</span><span style=color:#ed9366>::</span><span>Absolute</span><span style=color:#61676ccc>,
</span><span>        left</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>24.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>        bottom</span><span style=color:#61676ccc>: </span><span>Val</span><span style=color:#ed9366>::</span><span>Px(</span><span style=color:#ff8f40>24.0</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>... 
</span><span>    }</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f07171>children!</span><span>[
</span><span>        </span><span style=color:#f07171>build_setting_row</span><span>(</span><span style=color:#86b300>"X Offset:"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>...</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#f07171>build_setting_row</span><span>(</span><span style=color:#86b300>"Y Offset:"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>...</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Additional controls
</span><span>    ]
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ui/latest/bevy_ui/ target=_blank>Bevy UI Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/ecs-intro.html target=_blank>ECS Pattern in Bevy</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html target=_blank>Rust Ownership and Resource Management</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_19345.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>