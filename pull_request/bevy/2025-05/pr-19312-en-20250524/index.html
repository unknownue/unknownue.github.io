<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19312 Add debug build option to build-wasm-example
        
    </title><meta content="#19312 Add debug build option to build-wasm-example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-05/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-05-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-05/pr-19312-zh-cn-20250524>中文</a></div></div><div class=pr-content><h1 id=add-debug-build-option-to-build-wasm-example>Add debug build option to build-wasm-example</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add debug build option to build-wasm-example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19312<li><strong>Author</strong>: oracle58<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, O-Web, C-Testing, S-Needs-Review<li><strong>Created</strong>: 2025-05-20T16:47:00Z<li><strong>Merged</strong>: 2025-05-24T02:03:54Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h2 id=objective>Objective</h2><ul><li>Add a <code>--debug</code> flag to <code>build-wasm-example</code> to support debug builds for WebGL2/WebGPU targets.<li>Fixes #18464</ul><h2 id=solution>Solution</h2><ul><li>Added <code>--debug</code> flag to build Wasm examples in debug mode.<li>Default remains release mode if <code>--debug</code> is not specified.<li>Updated documentation to describe the new flag and usage.</ul><h2 id=testing>Testing</h2><ul><li>Verified debug and release builds for WebGL2 and WebGPU respectively.<li>Confirmed wasm artifacts are placed in the correct target dir for each build profile: <ul><li>Debug: <code>target/wasm32-unknown-unknown/debug/examples/</code><li>Release: <code>target/wasm32-unknown-unknown/release/examples/</code></ul><li>Confirmed wasm-bindgen output is written to: <code>examples/wasm/target/debug</code> , <code>examples/wasm/target/release</code><li>Haven’t actually tested running the example</ul><table><thead><tr><th>Backend<th>Profile<th>Artifacts written<th>Build success<tbody><tr><td>webgl2<td>debug<td>✓<td>✓<tr><td>webgl2<td>release<td>✓<td>✓<tr><td>webpgu<td>debug<td>✓<td>✓<tr><td>webpgu<td>release<td>✓<td>✓</table><h3 id=examples>Examples</h3><p><strong>Debug</strong><pre style=color:#61676c;background-color:#fafafa><code><span>$ cargo run -p build-wasm-example -- --api webgl2 --debug load_gltf
</span></code></pre><pre style=color:#61676c;background-color:#fafafa><code><span>Finished `dev` profile [unoptimized + debuginfo] target(s) in 1m 02s
</span><span>wasm-bindgen --out-dir examples/wasm/target/debug --out-name wasm_example --target web target/wasm32-unknown-unknown/debug/examples/load_gltf.wasm
</span></code></pre><p><strong>Release</strong><pre style=color:#61676c;background-color:#fafafa><code><span>$ cargo run -p build-wasm-example -- --api webgl2 load_gltf`
</span></code></pre><pre style=color:#61676c;background-color:#fafafa><code><span>Finished `release` profile [optimized] target(s) in 1m 08s
</span><span>wasm-bindgen --out-dir examples/wasm/target/release --out-name wasm_example --target web target/wasm32-unknown-unknown/release/examples/load_gltf.wasm
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>The Bevy engine’s WebAssembly build system lacked support for debug builds, forcing developers to only create optimized release builds when compiling examples for web targets. This limitation made debugging web examples more difficult, as developers couldn’t leverage debug symbols or unoptimized builds for better troubleshooting. The existing <code>build-wasm-example</code> tool hardcoded release profile builds, with no way to override this behavior.<h3 id=the-solution-approach>The Solution Approach</h3><p>The implementation introduces a <code>--debug</code> flag to the build script while maintaining backward compatibility. Key decisions included:<ol><li>Preserving the default release profile for existing workflows<li>Modifying both compilation and post-processing steps to handle different build profiles<li>Ensuring proper artifact separation between debug and release outputs</ol><h3 id=the-implementation>The Implementation</h3><p>The core changes occur in the build script’s argument handling and cargo invocation:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: tools/build-wasm-example/src/main.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> cmd </span><span style=color:#ed9366>= </span><span style=color:#f07171>cmd!</span><span>(
</span><span>    sh</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"cargo build {parameters...} --profile release --target wasm32-unknown-unknown --example {example}"
</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> profile </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> cli</span><span style=color:#ed9366>.</span><span>debug {
</span><span>    </span><span style=color:#86b300>"debug"
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#86b300>"--release"</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#86b300>"release"
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let</span><span> cmd </span><span style=color:#ed9366>= </span><span style=color:#f07171>cmd!</span><span>(
</span><span>    sh</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"cargo build {parameters...} --target wasm32-unknown-unknown --example {example}"
</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>This change removes the hardcoded <code>--profile release</code> and instead conditionally adds the <code>--release</code> flag based on the new <code>debug</code> argument. The profile variable then propagates through to the wasm-bindgen command:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#f07171>cmd!</span><span>(
</span><span>    sh</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"wasm-bindgen --out-dir examples/wasm/target --out-name wasm_example --target web target/wasm32-unknown-unknown/{profile}/examples/{example}.wasm"
</span><span>)
</span></code></pre><h3 id=technical-insights>Technical Insights</h3><p>The implementation leverages Rust’s built-in profile handling:<ul><li>Omitting <code>--release</code> implies <code>dev</code> profile (debug build)<li>Artifact paths automatically follow profile conventions (<code>debug</code>/<code>release</code> subdirectories)<li>wasm-bindgen output directories were updated to prevent debug/release conflicts</ul><p>Notable engineering considerations:<ol><li>Maintained existing release behavior as default to avoid breaking changes<li>Used Rust’s conventional profile directories instead of custom paths<li>Ensured parallel debug/release builds could coexist without interference</ol><h3 id=the-impact>The Impact</h3><ul><li>Developers can now build unoptimized WASM examples with debug symbols<li>Debug builds complete faster due to lack of optimizations (1m02s vs 1m08s in test cases)<li>Output directory separation prevents accidental mixing of build types<li>Documentation updates ensure immediate discoverability of the new feature</ul><h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[build-wasm-example] --> B{--debug flag?}
</span><span>    B -->|Yes| C[Debug Profile Build]
</span><span>    B -->|No| D[Release Profile Build]
</span><span>    C --> E[wasm-bindgen debug output]
</span><span>    D --> F[wasm-bindgen release output]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ol><li><code>tools/build-wasm-example/src/main.rs</code> (+14/-2)</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added debug flag to Args struct
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>arg</span><span>(long)]
</span><span>debug</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Profile selection logic
</span><span style=color:#fa6e32>let</span><span> profile </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> cli</span><span style=color:#ed9366>.</span><span>debug {
</span><span>    </span><span style=color:#86b300>"debug"
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    parameters</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(</span><span style=color:#86b300>"--release"</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#86b300>"release"
</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Updated wasm-bindgen command
</span><span style=color:#86b300>"wasm-bindgen --out-dir examples/wasm/target --out-name wasm_example --target web target/wasm32-unknown-unknown/{profile}/examples/{example}.wasm"
</span></code></pre><ol start=2><li><code>docs-template/EXAMPLE_README.md.tpl</code> (+1/-0)<li><code>examples/README.md</code> (+1/-0)</ol><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span style=color:#4cbf99>- </span><span>Debug: </span><span style=color:#ed9366;background-color:#61676c10>`cargo run -p build-wasm-example -- --debug --api webgl2 load_gltf`</span><span>
</span></code></pre><p>These documentation changes ensure users immediately discover the new debug option when consulting example READMEs.<h2 id=further-reading>Further Reading</h2><ul><li>Rust Profiles: https://doc.rust-lang.org/cargo/reference/profiles.html<li>wasm-bindgen CLI Guide: https://rustwasm.github.io/wasm-bindgen/reference/cli.html<li>Bevy Web Deployment: https://bevyengine.org/learn/book/getting-started/web/</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-05/pr_19312.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>