<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21793 Delete unused WeightsCurve, and enable feature for bevy_animation.
        
    </title><meta content="#21793 Delete unused WeightsCurve, and enable feature for bevy_animation." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21793-zh-cn-20251115>中文</a></div></div><div class=pr-content><h1 id=delete-unused-weightscurve-and-enable-feature-for-bevy-animation>Delete unused WeightsCurve, and enable feature for bevy_animation.</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Delete unused WeightsCurve, and enable feature for bevy_animation.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21793<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, S-Ready-For-Final-Review, A-glTF<li><strong>Created</strong>: 2025-11-09T21:03:17Z<li><strong>Merged</strong>: 2025-11-15T19:00:27Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Fix <code>cargo b -p bevy_gltf --all-features</code></ul><h2 id=solution>Solution</h2><ul><li>Delete an unused symbol with the same name.<li>Add the <code>bevy_mesh</code> feature on <code>bevy_animation</code> in <code>bevy_gltf</code>, so the correct WeightsCurve is chosen.</ul><h2 id=testing>Testing</h2><ul><li>CI, and running with <code>--all-features</code>.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a build failure that occurred when compiling <code>bevy_gltf</code> with the <code>--all-features</code> flag. The root cause was a naming conflict between two different <code>WeightsCurve</code> types in the codebase, combined with missing feature dependencies.<p>The problem stemmed from having two separate <code>WeightsCurve</code> enum definitions in different parts of the codebase. One was defined in <code>bevy_animation/src/gltf_curves.rs</code> and the other was the intended implementation that properly integrated with the morph weights system from <code>bevy_mesh</code>. When building with all features enabled, the compiler encountered this duplicate symbol, causing the build to fail.<p>The solution involved two coordinated changes. First, the unused <code>WeightsCurve</code> definition in <code>bevy_animation</code> was completely removed since it wasn’t being used anywhere in the codebase. This eliminated the naming conflict at its source. The removed code was a comprehensive enum definition that supported different interpolation modes for morph weight curves:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_animation/src/gltf_curves.rs
</span><span style=color:#abb0b6;font-style:italic>// Removed code:
</span><span style=color:#fa6e32>pub enum </span><span style=color:#399ee6>WeightsCurve </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// A curve which takes a constant value over its domain. Notably, this is how animations with
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// only a single keyframe are interpreted.
</span><span>    Constant(ConstantCurve<</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#fa6e32>f32</span><span>>>)</span><span style=color:#61676ccc>,
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// A curve which interpolates weights linearly between keyframes.
</span><span>    Linear(WideLinearKeyframeCurve<</span><span style=color:#fa6e32>f32</span><span>>)</span><span style=color:#61676ccc>,
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// A curve which interpolates weights between keyframes in steps.
</span><span>    Step(WideSteppedKeyframeCurve<</span><span style=color:#fa6e32>f32</span><span>>)</span><span style=color:#61676ccc>,
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// A curve which interpolates between keyframes by using auxiliary tangent data to join
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// adjacent keyframes with a cubic Hermite spline, which is then sampled.
</span><span>    CubicSpline(WideCubicKeyframeCurve<</span><span style=color:#fa6e32>f32</span><span>>)</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>Second, the dependency configuration in <code>bevy_gltf</code> was updated to ensure that when the animation feature is enabled, it properly pulls in the <code>bevy_mesh</code> feature as well. This was necessary because the correct <code>WeightsCurve</code> implementation depends on types from <code>bevy_mesh</code>, specifically the <code>MorphWeights</code> type referenced in the documentation.<p>The Cargo.toml change ensures that the dependency chain is correctly established:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># File: crates/bevy_gltf/Cargo.toml
</span><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>bevy_animation </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_animation"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>bevy_animation </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_animation"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"bevy_mesh"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><p>This fix demonstrates a common pattern in Rust projects where feature dependencies need to be explicitly declared to ensure that all necessary code paths are available when certain feature combinations are enabled. The unused code removal also follows good software engineering practices by eliminating dead code that could cause maintenance issues or confusion for developers working on the codebase.<p>The changes are minimal but effective - removing 26 lines of unused code and adding 3 lines to fix the feature dependency. This kind of cleanup is important for maintaining code quality and preventing build issues, especially in a large project like Bevy where multiple crates interact through complex feature flag combinations.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_gltf] --> B[bevy_animation]
</span><span>    B --> C[bevy_mesh]
</span><span>    B -.-> D[Unused WeightsCurve]
</span><span>    
</span><span>    style D stroke-dasharray: 5 5
</span></code></pre><p>The diagram shows the dependency relationship where <code>bevy_gltf</code> depends on <code>bevy_animation</code>, which in turn should depend on <code>bevy_mesh</code> for the correct <code>WeightsCurve</code> implementation. The dashed line indicates the unused <code>WeightsCurve</code> that was removed.<h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-animation-src-gltf-curves-rs-0-26><code>crates/bevy_animation/src/gltf_curves.rs</code> (+0/-26)</h3><p>This file had an unused <code>WeightsCurve</code> enum definition that was causing a naming conflict. The entire enum and its documentation were removed.<p><strong>Key changes:</strong><ul><li>Removed unused <code>WeightsCurve</code> enum definition<li>Eliminated duplicate symbol that conflicted with the intended implementation<li>Cleaned up dead code that wasn’t being used anywhere</ul><h3 id=crates-bevy-gltf-cargo-toml-3-1><code>crates/bevy_gltf/Cargo.toml</code> (+3/-1)</h3><p>Updated the dependency configuration to ensure proper feature propagation.<p><strong>Key changes:</strong><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>bevy_animation </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_animation"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>bevy_animation </span><span>= { </span><span style=color:#399ee6>path </span><span>= </span><span style=color:#86b300>"../bevy_animation"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.18.0-dev"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"bevy_mesh"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><p>This change ensures that when <code>bevy_gltf</code> uses the animation feature, it properly enables the <code>bevy_mesh</code> feature in <code>bevy_animation</code>, allowing access to the correct <code>WeightsCurve</code> implementation.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/features.html target=_blank>Rust Cargo Features Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/ target=_blank>Bevy Engine Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/KhronosGroup/glTF/tree/main/specification/2.0#animations target=_blank>glTF Animation System</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21793.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>