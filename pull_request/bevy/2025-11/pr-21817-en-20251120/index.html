<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21817 Move more functions off of `ScheduleGraph`
        
    </title><meta content="#21817 Move more functions off of `ScheduleGraph`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-20</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21817-zh-cn-20251120>中文</a></div></div><div class=pr-content><h1 id=move-more-functions-off-of-schedulegraph>Move more functions off of <code>ScheduleGraph</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Move more functions off of <code>ScheduleGraph</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21817<li><strong>Author</strong>: ItsDoot<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Code-Quality, C-Usability, S-Ready-For-Final-Review, M-Migration-Guide, D-Modest<li><strong>Created</strong>: 2025-11-12T20:50:40Z<li><strong>Merged</strong>: 2025-11-20T01:00:48Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h2 id=objective>Objective</h2><ul><li>Part of #20115<li>Reduce <code>ScheduleGraph</code> implementation surface and extract reusable parts.</ul><h2 id=solution>Solution</h2><ul><li>Upgraded and exposed <code>Dag&LTN></code> as a fully-fledged directed acyclic graph type. <ul><li>The validity of the cached topological order is now tracked by a <code>dirty</code> flag. All modifications to the graph (via <code>DerefMut</code> or <code>Dag::graph_mut</code>) cause the DAG to be marked as dirty.<li>Added <code>Dag::toposort</code>: if the DAG is dirty, computes topological order, caches it, and marks the DAG as clean. If already clean, returns the cached topological order. We now also reuse the previous toposort <code>Vec</code> allocation.<li>Added <code>Dag::get_toposort</code>: can be used to access the topological order with <code>&self</code>, with the stipulation that it returns an <code>Option</code>, and <code>None</code> if the DAG is dirty.<li>Replaced <code>check_graph</code> with <code>Dag::analyze</code>, and made it publicly accessible.<li>Added <code>Dag::remove_redundant_edges</code>, which uses the output of <code>Dag::analyze</code>.</ul><li>Renamed <code>CheckGraphResults</code> to <code>DagAnalysis</code>. <ul><li>Added <code>DagAnalysis::check_for_redundant_edges</code>, replacing <code>ScheduleGraph::optionally_check_hierarchy_conflicts</code>.<li>Added <code>DagAnalysis::check_for_cross_dependencies</code>, replacing <code>ScheduleGraph::check_for_cross_dependencies</code>. It now takes two full <code>DagAnalysis</code> for comparison.<li>Added <code>DagAnalysis::check_for_cross_intersection</code>, replacing <code>ScheduleGraph::check_order_but_intersect</code>.</ul><li>Added <code>DagGroups</code> to encapsulate the <code>HashMap&LTSystemSetKey, Vec&LTSystemKey>></code> with additional capabilities: <ul><li><code>DagGroups::flatten</code> and <code>DagGroups::flatten_undirected</code> handle the graph reduction operations previously performed by functions on <code>ScheduleGraph</code>.</ul><li>Added <code>ConflictingSystems</code> to encapsulate <code>Vec<(SystemKey, SystemKey, ComponentId)></code> with additional capabilities and type safety.</ul><p>See the included migration guide for breaking changes.<h1 id=testing>Testing</h1><ul><li>Ran examples<li>Added new tests for <code>Dag</code>, <code>DagAnalysis</code>, and <code>DagGroups</code> functionality.</ul><h1 id=future-work>Future work</h1><ul><li>Consider replacing <code>HashSet&LTSystemKey></code> with a <code>FixedBitSet</code>-like type for better performance.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a common problem in large codebases: the accumulation of functionality in a single class that should be distributed across multiple focused components. The <code>ScheduleGraph</code> struct in Bevy’s ECS had become a dumping ground for graph operations, making it difficult to maintain and test individual pieces of functionality.<p>The core issue was that <code>ScheduleGraph</code> contained both schedule-specific logic and general-purpose graph algorithms mixed together. This made it hard to reuse the graph functionality elsewhere in the codebase and made the schedule building code more complex than necessary.<p>The solution approach was to extract the general graph algorithms into dedicated data structures while keeping schedule-specific logic in <code>ScheduleGraph</code>. This follows the single responsibility principle and makes the code more modular. The developer created three main new types: <code>Dag</code> for directed acyclic graph operations, <code>DagAnalysis</code> for graph analysis results, and <code>DagGroups</code> for managing system set groupings.<p>The implementation centers around the new <code>Dag&LTN></code> struct, which encapsulates a directed acyclic graph with caching for topological sorting. A key insight was tracking graph modifications with a <code>dirty</code> flag to avoid unnecessary recomputation of topological order:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Dag</span><span>&LTN</span><span style=color:#61676ccc>:</span><span> GraphNodeId, S</span><span style=color:#61676ccc>:</span><span> BuildHasher = FixedHasher> {
</span><span>    graph</span><span style=color:#61676ccc>: </span><span>DiGraph&LTN, S>,
</span><span>    toposort</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTN>,
</span><span>    dirty</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span></code></pre><p>This caching mechanism is smart about when to invalidate the cache - any mutation through <code>DerefMut</code> or <code>graph_mut()</code> marks the graph as dirty, forcing recomputation on the next topological sort request.<p>The <code>Dag::toposort()</code> method demonstrates the practical benefit of this approach:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>toposort</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#ed9366>&</span><span>[N], DiGraphToposortError&LTN>> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>ensure_toposorted</span><span>()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>toposort)
</span><span>}
</span></code></pre><p>This method only computes the topological sort when the graph is dirty, otherwise returning the cached result. It also reuses the previous allocation for the topological sort vector, reducing memory allocations.<p>Another significant improvement is the <code>Dag::analyze()</code> method, which replaces the previous <code>check_graph</code> function. This method computes various graph properties including reachability matrices, transitive reductions, and transitive closures using an efficient algorithm from academic literature.<p>The <code>DagGroups</code> struct addresses the problem of managing system set hierarchies by providing type-safe operations for flattening graph structures. This is particularly important in Bevy’s scheduling system where system sets can contain other sets, creating complex hierarchies that need to be flattened for execution.<p>The migration to these new types required careful API design. For example, the <code>Dag::get_toposort()</code> method returns an <code>Option</code> to clearly indicate when the cached topological sort is unavailable due to graph modifications:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>get_toposort</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>[N]> {
</span><span>    </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>dirty {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>None
</span><span>    } </span><span style=color:#fa6e32>else </span><span>{
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>toposort)
</span><span>    }
</span><span>}
</span></code></pre><p>This explicit API design helps prevent accidental use of stale topological sorts.<p>The impact of these changes is substantial. The <code>ScheduleGraph</code> struct lost over 450 lines of code while gaining clearer separation of concerns. The extracted functionality is now reusable across the codebase and better tested through dedicated unit tests. The caching mechanism in <code>Dag</code> provides performance benefits by avoiding redundant topological sort computations during schedule building.<p>From an architectural perspective, this change makes the schedule building code more maintainable. Graph operations are now encapsulated in dedicated types with clear interfaces, making it easier to understand and modify the schedule building process. The type safety improvements in <code>ConflictingSystems</code> and <code>DagGroups</code> reduce the likelihood of runtime errors.<p>The technical lessons from this PR demonstrate the value of extracting general-purpose algorithms from domain-specific containers. By separating the graph algorithms from schedule-specific logic, both become easier to test, maintain, and optimize independently.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[ScheduleGraph] --> B[Dag]
</span><span>    A --> C[DagAnalysis]
</span><span>    A --> D[DagGroups]
</span><span>    A --> E[ConflictingSystems]
</span><span>    B --> F[DiGraph]
</span><span>    C --> G[FixedBitSet]
</span><span>    D --> H[HashMap]
</span><span>    E --> I[Vec]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-schedule-graph-dag-rs-998-0><code>crates/bevy_ecs/src/schedule/graph/dag.rs</code> (+998/-0)</h3><p>This new file contains the core <code>Dag</code>, <code>DagAnalysis</code>, and <code>DagGroups</code> implementations that were extracted from <code>ScheduleGraph</code>. The <code>Dag</code> struct provides cached topological sorting and graph analysis capabilities.<p>Key code example:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Dag</span><span>&LTN</span><span style=color:#61676ccc>:</span><span> GraphNodeId, S</span><span style=color:#61676ccc>:</span><span> BuildHasher = FixedHasher> {
</span><span>    graph</span><span style=color:#61676ccc>: </span><span>DiGraph&LTN, S>,
</span><span>    toposort</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTN>,
</span><span>    dirty</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTN</span><span style=color:#61676ccc>:</span><span> GraphNodeId, S</span><span style=color:#61676ccc>:</span><span> BuildHasher> </span><span style=color:#399ee6>Dag</span><span>&LTN, S> {
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>toposort</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><</span><span style=color:#ed9366>&</span><span>[N], DiGraphToposortError&LTN>> {
</span><span>        </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>ensure_toposorted</span><span>()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>toposort)
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>analyze</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span>&LTDagAnalysis&LTN, S>, DiGraphToposortError&LTN>> {
</span><span>        </span><span style=color:#fa6e32>let </span><span>(toposort</span><span style=color:#61676ccc>,</span><span> graph) </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>toposort_and_graph</span><span>()</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(DagAnalysis</span><span style=color:#ed9366>::</span><span>new(graph</span><span style=color:#61676ccc>,</span><span> toposort))
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-schedule-schedule-rs-113-456><code>crates/bevy_ecs/src/schedule/schedule.rs</code> (+113/-456)</h3><p>This file saw the largest reduction in code size as graph operations were moved to the new <code>dag</code> module. The <code>ScheduleGraph</code> struct now delegates to the new graph types instead of implementing graph algorithms itself.<p>Key changes:<ul><li>Replaced manual graph analysis with <code>Dag::analyze()</code><li>Replaced custom flattening logic with <code>DagGroups::flatten()</code><li>Simplified conflict detection using the new graph types</ul><h3 id=crates-bevy-ecs-src-schedule-node-rs-150-8><code>crates/bevy_ecs/src/schedule/node.rs</code> (+150/-8)</h3><p>This file gained new type-safe containers for system conflicts and system set ambiguity errors. The <code>ConflictingSystems</code> struct provides better encapsulation for conflict data.<p>Key addition:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ConflictingSystems</span><span>(pub </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(SystemKey, SystemKey, </span><span style=color:#55b4d4;font-style:italic>Box</span><span><[ComponentId]>)</span><span style=color:#ed9366>></span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ConflictingSystems </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>check_if_not_empty</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Result</span><span><(), AmbiguousSystemConflictsWarning> {
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0.</span><span style=color:#f07171>is_empty</span><span>() {
</span><span>            </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(())
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=color:#55b4d4;font-style:italic>Err</span><span>(AmbiguousSystemConflictsWarning(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()))
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-schedule-graph-mod-rs-3-148><code>crates/bevy_ecs/src/schedule/graph/mod.rs</code> (+3/-148)</h3><p>This module file was simplified by removing the <code>check_graph</code> function and related types, which were moved to the new <code>dag</code> module.<h3 id=crates-bevy-ecs-src-schedule-error-rs-29-21><code>crates/bevy_ecs/src/schedule/error.rs</code> (+29/-21)</h3><p>The error types were updated to work with the new graph types, wrapping the new error structs instead of containing raw data directly.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/ target=_blank>Bevy ECS Documentation</a> - Official Bevy ECS documentation<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Directed_acyclic_graph target=_blank>Directed Acyclic Graphs</a> - Wikipedia article on DAGs<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Transitive_reduction target=_blank>Transitive Reduction</a> - Explanation of transitive reduction algorithm<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm target=_blank>Tarjan’s Algorithm</a> - Algorithm used for cycle detection<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Single-responsibility_principle target=_blank>Single Responsibility Principle</a> - Software design principle demonstrated in this PR</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21817.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>