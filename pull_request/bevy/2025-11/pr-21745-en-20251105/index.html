<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21745 Add a dense layout to the `many_cubes` stress test
        
    </title><meta content="#21745 Add a dense layout to the `many_cubes` stress test" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-05</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21745-zh-cn-20251105>中文</a></div></div><div class=pr-content><h1 id=add-a-dense-layout-to-the-many-cubes-stress-test>Add a dense layout to the <code>many_cubes</code> stress test</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add a dense layout to the <code>many_cubes</code> stress test<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21745<li><strong>Author</strong>: DeVelox<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Examples, S-Ready-For-Final-Review, C-Testing<li><strong>Created</strong>: 2025-11-05T00:52:07Z<li><strong>Merged</strong>: 2025-11-05T18:37:48Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Test the impact that many overlapping cubes, all within the camera frustum, have on visibility/occlusion calculations, especially with continuous rotation and shadows enabled.</ul><h2 id=solution>Solution</h2><ul><li>Add a dense cube layout using a static camera, and a toggle for individual cube rotation.</ul><h2 id=testing>Testing</h2><ul><li>I ran the test in several stages, each causing a considerable performance drop. <ul><li>Stage 1: using just the dense layout.<li>Stage 2: using the dense layout with rotation or shadows enabled.<li>Stage 3: using the dense layout with both rotation and shadows enabled.</ul></ul><pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --release --example many_cubes -- --layout dense --rotate-cubes --shadows
</span></code></pre><hr><h2 id=showcase>Showcase</h2><img alt=image height=940 src=https://github.com/user-attachments/assets/6fc811aa-81fa-4130-a6e0-0a017bc99f19 width=1904><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The <code>many_cubes</code> stress test in Bevy serves as a crucial benchmarking tool for evaluating rendering performance under extreme conditions. Prior to this PR, the test offered two layout patterns: a cube grid and a spherical arrangement. However, these layouts didn’t effectively test the specific scenario where many objects overlap within the camera’s view frustum, which is critical for evaluating visibility and occlusion culling systems.<p>The developer identified a gap in the stress testing capabilities - the need to evaluate how the engine handles dense object configurations where most cubes remain visible and overlapping. This scenario puts significant pressure on the visibility system, as it must process many objects that are simultaneously within the camera’s view and potentially occluding each other.<p>The solution approach involved creating a new dense layout configuration that packs cubes tightly together in a 3D grid, ensuring they all remain within the camera frustum. The implementation required several coordinated changes:<p>First, the command-line interface was extended to support the new layout option and individual cube rotation:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// whether to continuously rotate individual cubes.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>argh</span><span>(switch)]
</span><span>rotate_cubes</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#fa6e32>enum </span><span style=color:#399ee6>Layout </span><span>{
</span><span>    Cube</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>default</span><span>]
</span><span>    Sphere</span><span style=color:#61676ccc>,
</span><span>    Dense</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><p>The layout parsing was updated to recognize the new “dense” option, and the error message was extended to include it in the valid options list.<p>The core architectural change involved conditional system registration. For the dense layout, the camera movement system is disabled since the layout uses a static camera position optimized to view all cubes. Additionally, a new cube rotation system is conditionally added when the <code>--rotate-cubes</code> flag is specified:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if</span><span> args</span><span style=color:#ed9366>.</span><span>layout </span><span style=color:#ed9366>!= </span><span>Layout</span><span style=color:#ed9366>::</span><span>Dense {
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>,</span><span> move_camera)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>if</span><span> args</span><span style=color:#ed9366>.</span><span>rotate_cubes {
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>,</span><span> rotate_cubes)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The dense layout implementation itself uses mathematical precision to create a tightly-packed 3D grid:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>Layout</span><span style=color:#ed9366>::</span><span>Dense </span><span style=color:#ed9366>=> </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// NOTE: This pattern is good for demonstrating a dense configuration of cubes
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// overlapping each other, all within the camera frustum.
</span><span>    </span><span style=color:#fa6e32>let</span><span> count </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>WIDTH </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>HEIGHT </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>2</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> size </span><span style=color:#ed9366>= </span><span style=color:#f07171>cbrt</span><span>(count </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> gap </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>1.25</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let</span><span> cubes </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span>count)</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(</span><span style=color:#fa6e32>move </span><span style=color:#ed9366>|</span><span>i</span><span style=color:#ed9366>| </span><span>{
</span><span>        </span><span style=color:#fa6e32>let</span><span> x </span><span style=color:#ed9366>=</span><span> i </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>%</span><span> size</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> y </span><span style=color:#ed9366>= </span><span>(i </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>/</span><span> size) </span><span style=color:#ed9366>%</span><span> size</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> z </span><span style=color:#ed9366>=</span><span> i </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32 </span><span style=color:#ed9366>/ </span><span>(size </span><span style=color:#ed9366>*</span><span> size)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> pos </span><span style=color:#ed9366>= </span><span>Vec3</span><span style=color:#ed9366>::</span><span>new(x </span><span style=color:#ed9366>*</span><span> gap</span><span style=color:#61676ccc>,</span><span> y </span><span style=color:#ed9366>*</span><span> gap</span><span style=color:#61676ccc>,</span><span> z </span><span style=color:#ed9366>*</span><span> gap)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... cube spawning logic
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// camera
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Camera3d</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>        Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ff8f40>100.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>90.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.0</span><span>)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>looking_at</span><span>(Vec3</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span style=color:#ff8f40>10.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#61676ccc>, </span><span>Vec3</span><span style=color:#ed9366>::</span><span>Y)</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn_batch</span><span>(cubes)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The key technical insight here is the use of the cube root function (<code>cbrt</code>) to calculate the grid dimensions that will contain exactly <code>WIDTH * HEIGHT * 2</code> cubes. This ensures the cubes are packed into a roughly cubic volume rather than a flat plane, maximizing overlap and occlusion complexity.<p>The new cube rotation system provides another dimension of stress testing:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>rotate_cubes</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform, (With&LTMesh3d>, Without&LTNotShadowCaster>)>,
</span><span>    </span><span style=color:#ff8f40>time</span><span style=color:#61676ccc>: </span><span>Res&LTTime>,
</span><span>) {
</span><span>    query</span><span style=color:#ed9366>.</span><span style=color:#f07171>par_iter_mut</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>for_each</span><span>(|</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>transform</span><span>| {
</span><span>        transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>rotate_y</span><span>(</span><span style=color:#ff8f40>10.0 </span><span style=color:#ed9366>*</span><span> time</span><span style=color:#ed9366>.</span><span style=color:#f07171>delta_secs</span><span>())</span><span style=color:#61676ccc>;
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>This system uses parallel iteration (<code>par_iter_mut</code>) to efficiently update the rotation of all cubes, which is important for maintaining performance when dealing with thousands of entities.<p>The testing methodology described by the author demonstrates a systematic approach to performance evaluation. By enabling features incrementally (dense layout → rotation/shadows → both), they can isolate the performance impact of each complexity factor. This approach provides valuable data for engine optimization efforts, particularly around visibility determination and transform updates.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Command Line Args] --> B[Layout Selection]
</span><span>    B --> C[Dense Layout]
</span><span>    B --> D[Other Layouts]
</span><span>    C --> E[Static Camera]
</span><span>    C --> F[Dense Cube Grid]
</span><span>    A --> G[Rotation Flag]
</span><span>    G --> H[Cube Rotation System]
</span><span>    F --> I[Visibility Stress]
</span><span>    H --> J[Transform Update Stress]
</span><span>    I --> K[Performance Testing]
</span><span>    J --> K
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-stress-tests-many-cubes-rs-57-5><code>examples/stress_tests/many_cubes.rs</code> (+57/-5)</h3><p>This file contains all the changes for the new dense layout feature. The modifications include:<ol><li><strong>New command-line argument for cube rotation</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// whether to continuously rotate individual cubes.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>argh</span><span>(switch)]
</span><span>rotate_cubes</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span style=color:#61676ccc>,
</span></code></pre><ol start=2><li><strong>Extended Layout enum with Dense variant</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#fa6e32>enum </span><span style=color:#399ee6>Layout </span><span>{
</span><span>    Cube</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>default</span><span>]
</span><span>    Sphere</span><span style=color:#61676ccc>,
</span><span>    Dense</span><span style=color:#61676ccc>,
</span><span>}
</span></code></pre><ol start=3><li><strong>Conditional system registration</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if</span><span> args</span><span style=color:#ed9366>.</span><span>layout </span><span style=color:#ed9366>!= </span><span>Layout</span><span style=color:#ed9366>::</span><span>Dense {
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>,</span><span> move_camera)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>if</span><span> args</span><span style=color:#ed9366>.</span><span>rotate_cubes {
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>,</span><span> rotate_cubes)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=4><li><strong>Dense layout implementation</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>Layout</span><span style=color:#ed9366>::</span><span>Dense </span><span style=color:#ed9366>=> </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> count </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>WIDTH </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>HEIGHT </span><span style=color:#ed9366>* </span><span style=color:#ff8f40>2</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> size </span><span style=color:#ed9366>= </span><span style=color:#f07171>cbrt</span><span>(count </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>f32</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> gap </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>1.25</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... cube positioning logic
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Static camera setup
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Camera3d</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>        Transform</span><span style=color:#ed9366>::</span><span>from_xyz(</span><span style=color:#ff8f40>100.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>90.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.0</span><span>)
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>looking_at</span><span>(Vec3</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>0.0</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span style=color:#ff8f40>10.0</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>0.0</span><span>)</span><span style=color:#61676ccc>, </span><span>Vec3</span><span style=color:#ed9366>::</span><span>Y)</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><ol start=5><li><strong>New cube rotation system</strong>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>rotate_cubes</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform, (With&LTMesh3d>, Without&LTNotShadowCaster>)>,
</span><span>    </span><span style=color:#ff8f40>time</span><span style=color:#61676ccc>: </span><span>Res&LTTime>,
</span><span>) {
</span><span>    query</span><span style=color:#ed9366>.</span><span style=color:#f07171>par_iter_mut</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>for_each</span><span>(|</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>transform</span><span>| {
</span><span>        transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>rotate_y</span><span>(</span><span style=color:#ff8f40>10.0 </span><span style=color:#ed9366>*</span><span> time</span><span style=color:#ed9366>.</span><span style=color:#f07171>delta_secs</span><span>())</span><span style=color:#61676ccc>;
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/3d-rendering/visibility/ target=_blank>Bevy Visibility Systems Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/ecs-in-bevy/ target=_blank>Entity Component System (ECS) Pattern</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/ecs-in-bevy/#system-parallelism target=_blank>Parallel Iteration in Bevy Queries</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/transform/ target=_blank>3D Transformations and Rotation</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21745.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>