<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21928 Update lz4_flex requirement from 0.11 to 0.12
        
    </title><meta content="#21928 Update lz4_flex requirement from 0.11 to 0.12" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-28</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21928-zh-cn-20251128>中文</a></div></div><div class=pr-content><h1 id=update-lz4-flex-requirement-from-0-11-to-0-12>Update lz4_flex requirement from 0.11 to 0.12</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update lz4_flex requirement from 0.11 to 0.12<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21928<li><strong>Author</strong>: app/dependabot<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Dependencies<li><strong>Created</strong>: 2025-11-24T06:12:11Z<li><strong>Merged</strong>: 2025-11-28T22:31:36Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><p>Updates the requirements on <a rel="noopener nofollow noreferrer" href=https://github.com/pseitz/lz4_flex target=_blank>lz4_flex</a> to permit the latest version.<details><summary>Release notes</summary> <p><em>Sourced from <a href=https://github.com/pseitz/lz4_flex/releases>lz4_flex's releases</a>.</em></p> <blockquote><h2>0.12.0</h2><h2>What's Changed</h2><ul><li>Fix integer overflows when decoding large payloads by <a href=https://github.com/teh-cmc><code>@​teh-cmc</code></a> in <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/192>PSeitz/lz4_flex#192</a><li>chore(readme): add python binding impl by <a href=https://github.com/LVivona><code>@​LVivona</code></a> in <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/190>PSeitz/lz4_flex#190</a></ul><h2>New Contributors</h2><ul><li><a href=https://github.com/teh-cmc><code>@​teh-cmc</code></a> made their first contribution in <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/192>PSeitz/lz4_flex#192</a><li><a href=https://github.com/LVivona><code>@​LVivona</code></a> made their first contribution in <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/190>PSeitz/lz4_flex#190</a></ul><p><strong>Full Changelog</strong>: <a href=https://github.com/PSeitz/lz4_flex/compare/0.11.5...0.12.0>https://github.com/PSeitz/lz4_flex/compare/0.11.5...0.12.0</a></blockquote></details><details><summary>Changelog</summary> <p><em>Sourced from <a href=https://github.com/PSeitz/lz4_flex/blob/main/CHANGELOG.md>lz4_flex's changelog</a>.</em></p> <blockquote><h1>0.12.0 (2025-11-11)</h1><ul><li>Fix integer overflows when decoding large payloads <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/192>#192</a> (thanks <a href=https://github.com/teh-cmc><code>@​teh-cmc</code></a>)</ul><pre><code>This fixes an u32 integer overflow when decoding large payloads in the block format.
Note: The block format is not suitable for such large payloads, since it
keeps everything in memory. Consider using the frame format for large data.
<p>This change also removes a unsafe fast-path for write_integer to simplify the code.
The performance impact is on incompressible data, which is already fast enough.
</code></pre><h1>0.11.5 (2025-06-19)</h1><ul><li>Fix incorrect rust-version field name in Cargo.toml <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/187>#187</a></ul><h1>0.11.4 (2025-06-14)</h1><ul><li>Upgrade to twox-hash 2.0<a href=https://redirect.github.com/PSeitz/lz4_flex/pull/175>#175</a><li>Better <code>no_std</code> compatibility <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/180>#180</a></ul><h1>0.11.3 (2024-03-30)</h1><ul><li>Fix support for <code>--deny=unsafe_code</code> compilation <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/152>#152</a><li>make <code>get_maximum_output_size</code> const <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/153>#153</a></ul><h1>0.11.2 (2024-01-11)</h1><ul><li>Include license file in the published crate</ul><h1>0.11.1 (2023-06-19)</h1><ul><li>[<strong>breaking</strong>] remove <code>unchecked-decode</code> Remove <code>unchecked-decode</code> feature-flag, because of feature unification: <a href=https://doc.rust-lang.org/cargo/reference/features.html#feature-unification>https://doc.rust-lang.org/cargo/reference/features.html#feature-unification</a></ul><h1>0.11.0 (2023-06-18)</h1><h3>Documentation</h3><ul><li>Docs: add decompress block example</ul><h3>Fixes</h3><ul><li>Handle empty input in Frame Format <a href=https://redirect.github.com/PSeitz/lz4_flex/pull/120>#120</a></ul><pre><code>Empty input was ignored previously and didn't write anything. Now an empty Frame is written. This improves compatibility with the reference implementation and some corner cases.
</code></pre></blockquote> <p>... (truncated)</p></details><details><summary>Commits</summary> <ul><li><a href=https://github.com/PSeitz/lz4_flex/commit/975bfa7ac9583da879b5d7578b423232d84f69fe><code>975bfa7</code></a> bump version to 0.12.0<li><a href=https://github.com/PSeitz/lz4_flex/commit/40d81107aba09e62b14a04938443d6edd885b540><code>40d8110</code></a> update readme<li><a href=https://github.com/PSeitz/lz4_flex/commit/642020e842cf4b9ba15173765fab4df40a8574fa><code>642020e</code></a> bump version to 0.12<li><a href=https://github.com/PSeitz/lz4_flex/commit/5295b1601ef27629f7cf6d7f157f50d51c1308ee><code>5295b16</code></a> chore(readme): add python binding impl<li><a href=https://github.com/PSeitz/lz4_flex/commit/c1483c4db47d1086489b72337762db7b458b6132><code>c1483c4</code></a> fix the issue<li><a href=https://github.com/PSeitz/lz4_flex/commit/b3c03bea751f25e58819724caab81d5856c895c7><code>b3c03be</code></a> implement test demonstrating the issue<li><a href=https://github.com/PSeitz/lz4_flex/commit/a61ee5f23f409641a8c8ab27cac784cdba57d708><code>a61ee5f</code></a> remove unsafe write_integer which AFAICT is not used <em>and</em> broken<li><a href=https://github.com/PSeitz/lz4_flex/commit/ad71a3103daa37f8ddd139f0c29b6e4ce8724ba3><code>ad71a31</code></a> fix illegal doc comment<li><a href=https://github.com/PSeitz/lz4_flex/commit/f1c070e987b7d056c4868b19e0b00149f4256653><code>f1c070e</code></a> clippy<li><a href=https://github.com/PSeitz/lz4_flex/commit/1496be413a0a5236f1aa8d3b8f14169ef7ce42d2><code>1496be4</code></a> update binggan<li>Additional commits viewable in <a href=https://github.com/pseitz/lz4_flex/compare/0.11...0.12.0>compare view</a></ul></details><br><p>Dependabot will resolve any conflicts with this PR as long as you don’t alter it yourself. You can also trigger a rebase manually by commenting <code>@dependabot rebase</code>.<hr><details><summary>Dependabot commands and options</summary> <br> <p>You can trigger Dependabot actions by commenting on this PR:</p> <ul><li><code>@dependabot rebase</code> will rebase this PR<li><code>@dependabot recreate</code> will recreate this PR, overwriting any edits that have been made to it<li><code>@dependabot merge</code> will merge this PR after your CI passes on it<li><code>@dependabot squash and merge</code> will squash and merge this PR after your CI passes on it<li><code>@dependabot cancel merge</code> will cancel a previously requested merge and block automerging<li><code>@dependabot reopen</code> will reopen this PR if it is closed<li><code>@dependabot close</code> will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually<li><code>@dependabot show &LTdependency name> ignore conditions</code> will show all of the ignore conditions of the specified dependency<li><code>@dependabot ignore this major version</code> will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)<li><code>@dependabot ignore this minor version</code> will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)<li><code>@dependabot ignore this dependency</code> will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)</ul></details><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This dependency update addresses a critical security vulnerability in the lz4_flex compression library used by Bevy’s meshlet rendering system. The vulnerability stemmed from integer overflows when decoding large payloads in the block format, which could lead to memory corruption or crashes.<p>The core issue was identified in lz4_flex version 0.11, where the block format decoder didn’t properly handle large input sizes, causing u32 integer overflows. This is particularly relevant for Bevy’s meshlet system, which uses LZ4 compression to reduce the memory footprint of mesh data during rendering. While Bevy specifically uses the frame format rather than the block format (as indicated by the <code>"frame"</code> feature flag), updating to the patched version ensures the entire dependency tree is secure.<p>The fix in lz4_flex 0.12 involved removing an unsafe fast-path for the <code>write_integer</code> function that was both unused and broken. This simplification of the codebase eliminated the integer overflow vulnerability while maintaining acceptable performance characteristics. As noted in the changelog, the performance impact primarily affects incompressible data, which was already fast enough.<p>From an engineering perspective, this update demonstrates the importance of automated dependency management in modern software development. Dependabot automatically detected the new version and created this PR, allowing the Bevy team to quickly address the security issue without manual intervention. The update process was straightforward because lz4_flex maintained API compatibility between versions 0.11 and 0.12, requiring only a version number change in the Cargo.toml file.<p>The merge by james7132 after successful CI testing shows the standard workflow for dependency updates in the Bevy project: automated detection, minimal code changes, verification through continuous integration, and manual review before merging.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[Bevy PBR Crate] --> B[lz4_flex 0.11]
</span><span>    B --> C[Integer Overflow Vulnerability]
</span><span>    A --> D[lz4_flex 0.12]
</span><span>    D --> E[Security Fix Applied]
</span><span>    D --> F[Performance Maintained]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_pbr/Cargo.toml</code></strong><p>This single-line change updates the lz4_flex dependency version from 0.11 to 0.12 while preserving the same feature configuration:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>lz4_flex </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.11"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"frame"</span><span style=color:#61676ccc>,
</span><span>]</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>lz4_flex </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.12"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"frame"</span><span style=color:#61676ccc>,
</span><span>]</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span></code></pre><p>The change maintains:<ul><li>The <code>"frame"</code> feature flag, which Bevy uses for LZ4 frame format compression<li>The <code>default-features = false</code> configuration<li>The <code>optional = true</code> flag, making this an optional dependency</ul><p>This minimal change demonstrates how well-maintained Rust crates can provide security fixes through minor version updates without breaking API compatibility.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/pseitz/lz4_flex target=_blank>lz4_flex GitHub Repository</a> - The source code and documentation for the lz4_flex crate<li><a rel="noopener nofollow noreferrer" href=https://github.com/lz4/lz4 target=_blank>LZ4 Compression Format</a> - Official LZ4 compression specification<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/guide/dependencies.html target=_blank>Cargo Dependency Management</a> - Rust’s official documentation on managing dependencies<li><a rel="noopener nofollow noreferrer" href=https://docs.github.com/en/code-security/dependabot target=_blank>Dependabot Documentation</a> - GitHub’s automated dependency update tool</ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_pbr/Cargo.toml b/crates/bevy_pbr/Cargo.toml
</span><span>index a1c175ec4f686..6e9efc0faf49b 100644
</span><span style=color:#c594c5>--- a/crates/bevy_pbr/Cargo.toml
</span><span style=color:#c594c5>+++ b/crates/bevy_pbr/Cargo.toml
</span><span style=color:#c594c5>@@ -67,7 +67,7 @@ </span><span style=color:#399ee6>fixedbitset = "0.5"
</span><span> thiserror = { version = "2", default-features = false }
</span><span> derive_more = { version = "2", default-features = false, features = ["from"] }
</span><span> # meshlet
</span><span style=color:#f07171>-lz4_flex = { version = "0.11", default-features = false, features = [
</span><span style=color:#86b300>+lz4_flex = { version = "0.12", default-features = false, features = [
</span><span>   "frame",
</span><span> ], optional = true }
</span><span> range-alloc = { version = "0.1", optional = true }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21928.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>