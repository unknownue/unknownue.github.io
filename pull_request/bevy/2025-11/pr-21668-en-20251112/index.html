<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21668 Add Automatic Directional Navigation Graph Generation
        
    </title><meta content="#21668 Add Automatic Directional Navigation Graph Generation" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-12</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21668-zh-cn-20251112>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Add Automatic Directional Navigation Graph Generation<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add Automatic Directional Navigation Graph Generation<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21668<li><strong>Author</strong>: jbuehler23<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-UI, S-Ready-For-Final-Review, M-Release-Note<li><strong>Created</strong>: 2025-10-27T14:31:53Z<li><strong>Merged</strong>: 2025-11-10T04:17:05Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><p><strong>Objective</strong><p>Resolves #21661<p>Adds automatic directional navigation graph generation based on UI node positions and sizes, eliminating the need for tedious manual graph construction in dynamic UIs.<p><strong>Solution</strong><p>Implements a spatial navigation algorithm that automatically computes the nearest neighbor in each compass direction for UI elements, while respecting any manually-defined edges.<p><strong>Features</strong><ul><li><strong>Automatic edge generation</strong>: Finds the best neighbor in each of 8 compass directions based on distance, alignment, and overlap<li><strong>Manual override support</strong>: Manual edges always take precedence over auto-generated ones<li><strong>Configurable</strong>: <code>AutoNavigationConfig</code> resource allows tuning alignment requirements, distance limits, and preference weighting<li><strong>Opt-in</strong>: Entities must have <code>AutoDirectionalNavigation</code> component added to use, and therefore <strong>not</strong> a breaking change<li><strong>Generic</strong>: Core algorithm works with any <code>Vec2</code> position/size data, not just <code>bevy_ui</code></ul><p><strong>Implementation</strong><p><strong>New Components & Resources</strong> (<code>bevy_input_focus/src/directional_navigation.rs</code>):<ul><li><code>AutoDirectionalNavigation</code> - Marker component to enable auto-navigation<li><code>AutoNavigationConfig</code> - Configuration resource with settings: <ul><li><code>min_alignment_factor</code>: Minimum perpendicular overlap (0.0-1.0) required for cardinal directions<li><code>max_search_distance</code>: Optional distance limit for connections<li><code>prefer_aligned</code>: Whether to strongly prefer well-aligned nodes</ul></ul><p><strong>Core Algorithm</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>auto_generate_navigation_edges</span><span>(
</span><span>    </span><span style=color:#ff8f40>nav_map</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> DirectionalNavigationMap,
</span><span>    </span><span style=color:#ff8f40>nodes</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[(</span><span style=color:#ff8f40>Entity</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>Vec2</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>Vec2</span><span>)],  </span><span style=color:#abb0b6;font-style:italic>// (entity, center_pos, size)
</span><span>    </span><span style=color:#ff8f40>config</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>AutoNavigationConfig,
</span><span>)
</span></code></pre><p>For each node and each direction:<ol><li>Filter candidates that are actually in that direction (cone-based check)<li>Calculate overlap factor for cardinal directions (horizontal overlap for N/S, vertical for E/W)<li>Score candidates based on: <ul><li>Distance (closer is better)<li>Alignment with direction vector (more aligned is better)<li>Overlap factor (must meet minimum threshold)</ul><li>Select the best-scoring candidate as the neighbor</ol><p><strong>Scoring Formula</strong>:<pre style=color:#61676c;background-color:#fafafa><code><span>score = distance + alignment_penalty
</span><span>where alignment_penalty = (1.0 - alignment) * distance * 2.0
</span></code></pre><p>This makes misaligned nodes significantly less attractive while still considering distance.<p><strong>Usage</strong><p><strong>Before (manual)</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Must manually specify all connections
</span><span style=color:#fa6e32>for</span><span> row </span><span style=color:#ed9366>in </span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>N_ROWS </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> entities_in_row</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEntity> </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>N_COLS</span><span>)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>col</span><span>| button_entities</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(</span><span style=color:#ed9366>&</span><span>(row</span><span style=color:#61676ccc>,</span><span> col))</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>())
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>copied</span><span>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>collect</span><span>()</span><span style=color:#61676ccc>;
</span><span>    directional_nav_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_looping_edges</span><span>(</span><span style=color:#ed9366>&</span><span>entities_in_row</span><span style=color:#61676ccc>, </span><span>CompassOctant</span><span style=color:#ed9366>::</span><span>East)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Repeat for columns...
</span><span style=color:#fa6e32>for</span><span> col </span><span style=color:#ed9366>in </span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>N_COLS </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> entities_in_column</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEntity> </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>N_ROWS</span><span>)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>row</span><span>| button_entities</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(</span><span style=color:#ed9366>&</span><span>(row</span><span style=color:#61676ccc>,</span><span> col))</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>())
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>copied</span><span>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>collect</span><span>()</span><span style=color:#61676ccc>;
</span><span>    directional_nav_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_edges</span><span>(</span><span style=color:#ed9366>&</span><span>entities_in_column</span><span style=color:#61676ccc>, </span><span>CompassOctant</span><span style=color:#ed9366>::</span><span>South)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p><strong>After</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Just add the `AutoDirectionalNavigation` component!
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Button</span><span style=color:#61676ccc>,
</span><span>    Node { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}</span><span style=color:#61676ccc>,
</span><span>    AutoDirectionalNavigation</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><p><strong>Testing</strong><ul><li>Added new example: <code>auto_directional_navigation</code><li>Ran existing <code>directional_navigation</code></ul><p><strong>Showcase</strong><p><strong>New Example: <code>auto_directional_navigation</code></strong><p>Demonstrates automatic navigation with irregularly-positioned buttons. Unlike a regular grid, these buttons are scattered, but auto-navigation figures out the correct connections - also shows currently focused button, and the last “input” pressed to show the logical flow of navigating:<pre class=language-bash data-lang=bash style=color:#61676c;background-color:#fafafa><code class=language-bash data-lang=bash><span style=color:#f29718>cargo</span><span> run</span><span style=color:#ff8f40> --example</span><span> auto_directional_navigation
</span></code></pre><p>https://github.com/user-attachments/assets/8dce1d8d-53b5-41b8-bc9a-7e32067f7978<p><strong>Key differences from manual <code>directional_navigation</code> example</strong>:<ul><li>No manual <code>add_edges()</code> or <code>add_looping_edges()</code> calls<li>Buttons positioned irregularly (not in a perfect grid)<li>Works with absolute positioning and dynamic layouts</ul><p><strong>Migration Guide</strong><p>No breaking changes - this is a purely additive feature.<p>To adopt automatic navigation:<ol><li>Add <code>AutoDirectionalNavigation</code> component to focusable entities<li>Optionally configure <code>AutoNavigationConfig</code> resource</ol><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><h3 id=the-problem-and-context>The Problem and Context</h3><p>Before this PR, setting up directional navigation in Bevy UI required manually constructing a navigation graph using <code>DirectionalNavigationMap</code>. Developers had to explicitly define every connection between UI elements using methods like <code>add_edge()</code> and <code>add_looping_edges()</code>. This approach was tedious, error-prone, and didn’t adapt well to dynamic UIs where elements could be added, removed, or repositioned.<p>The manual approach was particularly problematic for:<ul><li>Complex layouts with many elements<li>Dynamic UIs that change at runtime<li>Irregular or non-grid layouts<li>Rapid prototyping where navigation setup became a bottleneck</ul><h3 id=the-solution-approach>The Solution Approach</h3><p>The developer chose to implement a spatial navigation algorithm that automatically computes the nearest neighbor in each compass direction based on UI element positions and sizes. This approach leverages the existing <code>DirectionalNavigationMap</code> infrastructure while adding automatic graph generation as an opt-in feature.<p>Key design decisions:<ol><li><strong>Opt-in approach</strong>: Use a marker component (<code>AutoDirectionalNavigation</code>) rather than making automatic navigation the default<li><strong>Manual override priority</strong>: Preserve existing manual edges and allow them to override automatic connections<li><strong>Generic algorithm</strong>: Design the core algorithm to work with any position/size data, not just Bevy UI<li><strong>Configurable behavior</strong>: Provide a resource (<code>AutoNavigationConfig</code>) to tune the algorithm for different UI layouts</ol><h3 id=the-implementation>The Implementation</h3><p>The implementation centers around a new spatial navigation algorithm in <code>directional_navigation.rs</code>. The core function <code>auto_generate_navigation_edges()</code> takes a collection of focusable areas and populates the navigation map with connections to the nearest neighbor in each of the 8 compass directions.<p>The algorithm works by:<ol><li><strong>Direction filtering</strong>: Using cone-based checks to ensure candidates are actually in the target direction<li><strong>Overlap calculation</strong>: For cardinal directions, requiring minimum perpendicular overlap between elements<li><strong>Candidate scoring</strong>: Combining distance and alignment factors to find the best neighbor</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>score_candidate</span><span>(
</span><span>    </span><span style=color:#ff8f40>origin_pos</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#ff8f40>origin_size</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#ff8f40>candidate_pos</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#ff8f40>candidate_size</span><span style=color:#61676ccc>:</span><span> Vec2,
</span><span>    </span><span style=color:#ff8f40>octant</span><span style=color:#61676ccc>:</span><span> CompassOctant,
</span><span>    </span><span style=color:#ff8f40>config</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>AutoNavigationConfig,
</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>f32 </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Get direction in mathematical coordinates, then flip Y for UI coordinates
</span><span>    </span><span style=color:#fa6e32>let</span><span> dir </span><span style=color:#ed9366>= </span><span>Dir2</span><span style=color:#ed9366>::</span><span>from(octant)</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_vec2</span><span>() </span><span style=color:#ed9366>* </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>1.0</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1.0</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> to_candidate </span><span style=color:#ed9366>=</span><span> candidate_pos </span><span style=color:#ed9366>-</span><span> origin_pos</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> distance </span><span style=color:#ed9366>=</span><span> to_candidate</span><span style=color:#ed9366>.</span><span style=color:#f07171>length</span><span>()</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... direction validation, overlap checks, and scoring logic
</span><span>}
</span></code></pre><p>The scoring formula balances distance and alignment:<ul><li><strong>Distance</strong>: Straight-line distance between element centers (closer is better)<li><strong>Alignment penalty</strong>: Penalty for misaligned nodes, scaled by distance to make misalignment more significant for farther elements</ul><p>The system integrates with Bevy’s ECS through:<ul><li>A new built-in system <code>auto_rebuild_ui_navigation_graph</code> that automatically updates the navigation graph when UI elements change<li>Query filters that detect when nodes with <code>AutoDirectionalNavigation</code> are added, moved, or resized<li>Integration with the existing <code>DirectionalNavigationPlugin</code></ul><h3 id=technical-insights>Technical Insights</h3><p><strong>Coordinate System Handling</strong>: The implementation carefully handles the difference between mathematical coordinates (Y+ = up) and UI coordinates (Y+ = down) by flipping the Y-axis when necessary. This ensures the navigation directions work correctly with Bevy’s UI system.<p><strong>Performance Considerations</strong>: The algorithm has O(n²) complexity in the worst case, but this is acceptable for typical UI scenarios where the number of focusable elements is limited. The system only runs when relevant components change, minimizing unnecessary computation.<p><strong>Extensibility</strong>: The <code>FocusableArea</code> struct and <code>auto_generate_navigation_edges()</code> function are designed to work with any UI system that can provide position and size information, not just Bevy UI. This makes the algorithm reusable for custom UI implementations.<p><strong>Configuration Flexibility</strong>: The <code>AutoNavigationConfig</code> resource provides three key tuning parameters:<ul><li><code>min_alignment_factor</code>: Controls how strictly elements must align for cardinal direction navigation<li><code>max_search_distance</code>: Prevents navigation between distant elements<li><code>prefer_aligned</code>: Toggles whether well-aligned nodes are strongly preferred</ul><h3 id=the-impact>The Impact</h3><p>This PR significantly improves the developer experience for implementing directional navigation in Bevy UI applications:<p><strong>Before</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Complex manual setup for a simple grid
</span><span style=color:#fa6e32>for</span><span> row </span><span style=color:#ed9366>in </span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>N_ROWS </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> entities_in_row</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTEntity> </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#ff8f40>0</span><span style=color:#ed9366>..</span><span style=color:#ff8f40>N_COLS</span><span>)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>col</span><span>| button_entities</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(</span><span style=color:#ed9366>&</span><span>(row</span><span style=color:#61676ccc>,</span><span> col))</span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap</span><span>())
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>copied</span><span>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>collect</span><span>()</span><span style=color:#61676ccc>;
</span><span>    directional_nav_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_looping_edges</span><span>(</span><span style=color:#ed9366>&</span><span>entities_in_row</span><span style=color:#61676ccc>, </span><span>CompassOctant</span><span style=color:#ed9366>::</span><span>East)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p><strong>After</strong>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Simple component addition
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Button</span><span style=color:#61676ccc>,
</span><span>    Node { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}</span><span style=color:#61676ccc>,
</span><span>    AutoDirectionalNavigation</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><p>The automatic system handles dynamic UI changes seamlessly - when elements are added, removed, or repositioned, the navigation graph automatically updates. This makes it ideal for games with complex, state-dependent UIs.<p>The implementation is non-breaking and coexists perfectly with existing manual navigation setups, allowing gradual adoption and hybrid approaches where automatic navigation handles most cases while manual edges provide specific overrides.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[AutoDirectionalNavigation] --> B[DirectionalNavigationPlugin]
</span><span>    C[AutoNavigationConfig] --> B
</span><span>    B --> D[auto_rebuild_ui_navigation_graph]
</span><span>    D --> E[auto_generate_navigation_edges]
</span><span>    E --> F[DirectionalNavigationMap]
</span><span>    G[ComputedNode] --> D
</span><span>    H[UiGlobalTransform] --> D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-input-focus-src-directional-navigation-rs-744-3><code>crates/bevy_input_focus/src/directional_navigation.rs</code> (+744/-3)</h3><p>This is the core implementation file containing the automatic navigation algorithm, components, and systems.<p><strong>Key additions:</strong><ul><li><code>AutoDirectionalNavigation</code> component for opting into automatic navigation<li><code>AutoNavigationConfig</code> resource for algorithm configuration<li><code>FocusableArea</code> struct representing UI elements with position/size data<li><code>auto_generate_navigation_edges()</code> function implementing the core algorithm<li><code>auto_rebuild_ui_navigation_graph</code> system for automatic graph maintenance</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Core algorithm function
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>auto_generate_navigation_edges</span><span>(
</span><span>    </span><span style=color:#ff8f40>nav_map</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> DirectionalNavigationMap,
</span><span>    </span><span style=color:#ff8f40>nodes</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>[FocusableArea],
</span><span>    </span><span style=color:#ff8f40>config</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>AutoNavigationConfig,
</span><span>) {
</span><span>    </span><span style=color:#fa6e32>for</span><span> origin </span><span style=color:#ed9366>in</span><span> nodes {
</span><span>        </span><span style=color:#fa6e32>for</span><span> octant </span><span style=color:#ed9366>in </span><span>CompassOctant</span><span style=color:#ed9366>::</span><span>all() {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// Skip if manual edge exists
</span><span>            </span><span style=color:#fa6e32>if</span><span> nav_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_neighbors</span><span>(origin</span><span style=color:#ed9366>.</span><span>entity)
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>and_then</span><span>(|</span><span style=color:#ff8f40>neighbors</span><span>| neighbors</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(octant))
</span><span>                </span><span style=color:#ed9366>.</span><span style=color:#f07171>is_some</span><span>() {
</span><span>                </span><span style=color:#fa6e32>continue</span><span style=color:#61676ccc>;
</span><span>            }
</span><span>            
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// Find best candidate in this direction
</span><span>            </span><span style=color:#fa6e32>let mut</span><span> best_candidate </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>let mut</span><span> best_score </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>f32</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>INFINITY</span><span style=color:#61676ccc>;
</span><span>            
</span><span>            </span><span style=color:#fa6e32>for</span><span> candidate </span><span style=color:#ed9366>in</span><span> nodes {
</span><span>                </span><span style=color:#fa6e32>if</span><span> candidate</span><span style=color:#ed9366>.</span><span>entity </span><span style=color:#ed9366>==</span><span> origin</span><span style=color:#ed9366>.</span><span>entity { </span><span style=color:#fa6e32>continue</span><span style=color:#61676ccc>; </span><span>}
</span><span>                
</span><span>                </span><span style=color:#fa6e32>let</span><span> score </span><span style=color:#ed9366>= </span><span style=color:#f07171>score_candidate</span><span>(
</span><span>                    origin</span><span style=color:#ed9366>.</span><span>position</span><span style=color:#61676ccc>,</span><span> origin</span><span style=color:#ed9366>.</span><span>size</span><span style=color:#61676ccc>,
</span><span>                    candidate</span><span style=color:#ed9366>.</span><span>position</span><span style=color:#61676ccc>,</span><span> candidate</span><span style=color:#ed9366>.</span><span>size</span><span style=color:#61676ccc>,
</span><span>                    octant</span><span style=color:#61676ccc>,</span><span> config</span><span style=color:#61676ccc>,
</span><span>                )</span><span style=color:#61676ccc>;
</span><span>                
</span><span>                </span><span style=color:#fa6e32>if</span><span> score </span><span style=color:#ed9366><</span><span> best_score {
</span><span>                    best_score </span><span style=color:#ed9366>=</span><span> score</span><span style=color:#61676ccc>;
</span><span>                    best_candidate </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(candidate</span><span style=color:#ed9366>.</span><span>entity)</span><span style=color:#61676ccc>;
</span><span>                }
</span><span>            }
</span><span>            
</span><span>            </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(neighbor) </span><span style=color:#ed9366>=</span><span> best_candidate {
</span><span>                nav_map</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_edge</span><span>(origin</span><span style=color:#ed9366>.</span><span>entity</span><span style=color:#61676ccc>,</span><span> neighbor</span><span style=color:#61676ccc>,</span><span> octant)</span><span style=color:#61676ccc>;
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=examples-ui-auto-directional-navigation-rs-463-0><code>examples/ui/auto_directional_navigation.rs</code> (+463/-0)</h3><p>New example demonstrating automatic navigation with irregularly positioned buttons.<p><strong>Key features:</strong><ul><li>Shows scattered button layout that would be difficult to wire manually<li>Demonstrates automatic navigation without any manual edge definitions<li>Includes visual feedback for focused element and navigation input</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Key usage example - just add the component
</span><span>commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>    Button</span><span style=color:#61676ccc>,
</span><span>    Node { </span><span style=color:#abb0b6;font-style:italic>/* ... */ </span><span>}</span><span style=color:#61676ccc>,
</span><span>    AutoDirectionalNavigation</span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>// That's it!
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other components
</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-math-src-compass-rs-70-2><code>crates/bevy_math/src/compass.rs</code> (+70/-2)</h3><p>Added direction validation methods to compass types.<p><strong>Key additions:</strong><ul><li><code>is_in_direction()</code> methods for <code>CompassQuadrant</code> and <code>CompassOctant</code><li>Cone-based direction checking using dot products</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>is_in_direction</span><span>(</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>origin</span><span style=color:#61676ccc>:</span><span> Vec2, </span><span style=color:#ff8f40>candidate</span><span style=color:#61676ccc>:</span><span> Vec2) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>bool </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> dir </span><span style=color:#ed9366>= </span><span>Dir2</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#55b4d4;font-style:italic>self</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> to_candidate </span><span style=color:#ed9366>=</span><span> candidate </span><span style=color:#ed9366>-</span><span> origin</span><span style=color:#61676ccc>;
</span><span>    to_candidate</span><span style=color:#ed9366>.</span><span style=color:#f07171>dot</span><span>(</span><span style=color:#ed9366>*</span><span>dir) </span><span style=color:#ed9366>> </span><span style=color:#ff8f40>0.0
</span><span>}
</span></code></pre><h3 id=release-content-release-notes-automatic-directional-navigation-md-91-0><code>release-content/release-notes/automatic_directional_navigation.md</code> (+91/-0)</h3><p>Comprehensive release notes documenting the new feature, usage examples, and migration guide.<h3 id=cargo-toml-11-0><code>Cargo.toml</code> (+11/-0)</h3><p>Added the new example to the workspace and updated dependencies for the input focus crate.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/bevy-ui/ target=_blank>Bevy UI Documentation</a> - Learn about Bevy’s UI system<li><a rel="noopener nofollow noreferrer" href=https://drafts.csswg.org/css-nav-1/ target=_blank>Spatial Navigation Specification</a> - W3C specification for spatial navigation<li><a rel="noopener nofollow noreferrer" href=https://developer.mozilla.org/en-US/docs/Web/API/Gamepad target=_blank>Gamepad Navigation Patterns</a> - Understanding gamepad input handling<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/introduction/ecs/ target=_blank>Entity Component System Pattern</a> - Bevy’s ECS architecture</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21668.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>