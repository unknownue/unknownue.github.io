<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21741 Removed invalid ECS archetype constants
        
    </title><meta content="#21741 Removed invalid ECS archetype constants" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-04</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21741-zh-cn-20251104>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Removed invalid ECS archetype constants<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Removed invalid ECS archetype constants<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21741<li><strong>Author</strong>: ElliottjPierce<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, C-Code-Quality, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-11-04T20:55:59Z<li><strong>Merged</strong>: 2025-11-04T21:47:20Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>This is a tiny clean up to #19451 that removes some now completely unneeded public constants. I mean, they aren’t wrong, but there’s no point to their existence.<h2 id=solution>Solution</h2><p>Removed <code>ArchetypeRow::INVALID</code> and <code>ArchetypeId::INVALID</code> and extend migration guide.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR represents a straightforward cleanup task in the Bevy ECS (Entity Component System) codebase. The core issue was that two public constants - <code>ArchetypeRow::INVALID</code> and <code>ArchetypeId::INVALID</code> - had become obsolete after previous changes in PR #19451.<p>The problem stemmed from these constants no longer serving any practical purpose in the codebase. While they weren’t technically incorrect or causing bugs, their continued presence created unnecessary API surface area and potential confusion for developers. In software engineering terms, this is a classic case of removing dead code to maintain code quality and reduce cognitive overhead.<p>The solution approach was direct and minimal: simply remove the unused constants and update the migration guide to inform users about the change. This reflects good software maintenance practices - when functionality becomes obsolete, it’s better to remove it completely rather than leave it as deprecated code that still needs to be maintained.<p>Looking at the implementation, the changes are surgical. In the archetype.rs file, the removal of <code>ArchetypeRow::INVALID</code> eliminated a placeholder constant that was previously marked with a TODO comment indicating it should be deprecated in favor of using options. Similarly, <code>ArchetypeId::INVALID</code> was removed along with its safety comment about maintaining an all-1s bit pattern for entity ID space allocation.<p>The technical insight here is about API design and maintenance. The original constants were likely used for internal bookkeeping or as sentinel values, but as the system evolved, they became unnecessary. By removing them, the codebase becomes cleaner and the API more intentional. The migration guide update shows good practice in communicating breaking changes to users, even for minor removals.<p>The impact of these changes is primarily on code quality and maintainability. While not affecting performance or functionality, removing unused public API elements reduces the surface area that needs to be tested, documented, and maintained. It also prevents future developers from accidentally using these constants in new code, which could lead to confusion or incorrect implementations.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #19451 Changes] --> B[Constants Become Obsolete]
</span><span>    B --> C[Remove ArchetypeRow::INVALID]
</span><span>    B --> D[Remove ArchetypeId::INVALID]
</span><span>    C --> E[Update Migration Guide]
</span><span>    D --> E
</span><span>    E --> F[Cleaner API Surface]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-archetype-rs-0-9><code>crates/bevy_ecs/src/archetype.rs</code> (+0/-9)</h3><p>This file contains the core ECS archetype implementation. The changes remove two obsolete constants that were no longer needed after previous refactoring.<p><strong>Key modifications:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ArchetypeRow</span><span>(NonMaxU32)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ArchetypeRow </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// Index indicating an invalid archetype row.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// This is meant to be used as a placeholder.
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// TODO: Deprecate in favor of options, since `INVALID` is, technically, valid.
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>INVALID</span><span style=color:#61676ccc>:</span><span> ArchetypeRow </span><span style=color:#ed9366>=</span><span> ArchetypeRow(NonMaxU32</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MAX</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other methods
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ArchetypeId</span><span>(</span><span style=color:#fa6e32>u32</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ArchetypeId </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// The ID for the [`Archetype`] without any components.
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>EMPTY</span><span style=color:#61676ccc>:</span><span> ArchetypeId </span><span style=color:#ed9366>=</span><span> ArchetypeId(</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// # Safety:
</span><span>    </span><span style=color:#abb0b6;font-style:italic>///
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// This must always have an all-1s bit pattern to ensure soundness in fast entity id space allocation.
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>INVALID</span><span style=color:#61676ccc>:</span><span> ArchetypeId </span><span style=color:#ed9366>=</span><span> ArchetypeId(</span><span style=color:#fa6e32>u32</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>MAX</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other methods
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ArchetypeRow</span><span>(NonMaxU32)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ArchetypeRow </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// INVALID constant removed
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other methods remain
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ArchetypeId</span><span>(</span><span style=color:#fa6e32>u32</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>ArchetypeId </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>/// The ID for the [`Archetype`] without any components.
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>EMPTY</span><span style=color:#61676ccc>:</span><span> ArchetypeId </span><span style=color:#ed9366>=</span><span> ArchetypeId(</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// INVALID constant and safety comment removed
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other methods remain
</span><span>}
</span></code></pre><h3 id=release-content-migration-guides-entities-apis-md-3-0><code>release-content/migration-guides/entities_apis.md</code> (+3/-0)</h3><p>This file contains migration guidance for entity-related API changes. The update informs users about the removed constants and suggests alternatives.<p><strong>Key modifications:</strong><pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>// Addition to the migration guide:
</span><span>
</span><span style=color:#fa6e32;font-weight:700>### </span><span style=color:#399ee6;font-weight:700>Other entity interactions
</span><span>
</span><span>The </span><span style=color:#ed9366;background-color:#61676c10>`ArchetypeRow::INVALID`</span><span> and </span><span style=color:#ed9366;background-color:#61676c10>`ArchetypeId::INVALID`</span><span> constants have been removed, since they are no longer needed for flushing.
</span><span>If you depended on these, use options instead.
</span><span>
</span><span>// Existing content continues...
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/ target=_blank>Bevy ECS Documentation</a> - Comprehensive documentation for Bevy’s Entity Component System<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/19451 target=_blank>PR #19451</a> - The original PR that made these constants obsolete<li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Entity_component_system target=_blank>Entity Component System Pattern</a> - General information about ECS architecture<li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/ target=_blank>Rust API Guidelines</a> - Best practices for Rust API design, including when to remove obsolete items</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21741.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>