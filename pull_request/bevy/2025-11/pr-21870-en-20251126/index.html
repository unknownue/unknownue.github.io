<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21870 Simplify `Debug` display of `DebugName`
        
    </title><meta content="#21870 Simplify `Debug` display of `DebugName`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-26</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21870-zh-cn-20251126>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Simplify <code>Debug</code> display of <code>DebugName</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Simplify <code>Debug</code> display of <code>DebugName</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21870<li><strong>Author</strong>: chescock<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Usability, S-Ready-For-Final-Review, A-Utils<li><strong>Created</strong>: 2025-11-17T15:29:59Z<li><strong>Merged</strong>: 2025-11-26T09:15:24Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>As noted in #21856, the <code>Debug</code> output of <code>DebugName</code> is too verbose. It is supposed to be a thin wrapper around a string, but it renders as a <code>struct</code>.<h2 id=solution>Solution</h2><p>Manually <code>impl Debug for DebugName</code> and write the string directly.<h2 id=showcase>Showcase</h2><p>The following code<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Debug)]
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>TestStruct </span><span>{
</span><span>    debug_name</span><span style=color:#61676ccc>:</span><span> DebugName,
</span><span>}
</span><span style=color:#fa6e32>let</span><span> test_struct </span><span style=color:#ed9366>=</span><span> TestStruct {
</span><span>    debug_name</span><span style=color:#61676ccc>: </span><span>DebugName</span><span style=color:#ed9366>::</span><span>type_name</span><span style=color:#ed9366>::</span><span>&LTTestStruct>()</span><span style=color:#61676ccc>,
</span><span>}</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>println!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{test_struct:#?}</span><span style=color:#86b300>"</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>Prints the following before this change<pre style=color:#61676c;background-color:#fafafa><code><span>TestStruct {
</span><span>    debug_name: DebugName {
</span><span>        name: "crate_name::TestStruct",
</span><span>    },
</span><span>}
</span></code></pre><p>And the following after it<pre style=color:#61676c;background-color:#fafafa><code><span>TestStruct {
</span><span>    debug_name: "crate_name::TestStruct",
</span><span>}
</span></code></pre><p>When the <code>debug</code> feature is disabled, it prints the following both before and after the change<pre style=color:#61676c;background-color:#fafafa><code><span>TestStruct {
</span><span>    debug_name: DebugName,
</span><span>}
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem started with a usability issue in the Bevy engine’s debugging output. The <code>DebugName</code> struct, designed as a thin wrapper around string data for type names, was producing overly verbose debug output. When developers used <code>DebugName</code> in their structs and printed them with <code>println!("{:#?}")</code>, they would see the full struct representation with field names, rather than just the clean string value.<p>This was particularly problematic because <code>DebugName</code> is intended to be a simple wrapper that should display as its underlying string content in most contexts. The verbose output made debug logs harder to read and added visual clutter where developers expected to see clean type names.<p>The solution approach was straightforward but effective: remove the automatic <code>Debug</code> derivation and implement a custom <code>Debug</code> trait that would display the string content directly. This required modifying the existing <code>Display</code> implementation to use a more concise approach and adding a parallel <code>Debug</code> implementation.<p>The implementation involved three key changes to the <code>DebugName</code> struct. First, the <code>Debug</code> trait was removed from the derive macro, since the automatic derivation was causing the verbose output. Second, the existing <code>Display</code> implementation was simplified to leverage the existing <code>Deref</code> implementation to <code>str</code>. Third, a new manual <code>Debug</code> implementation was added that also uses the deref mechanism to display the string content directly.<p>One important technical consideration was maintaining the conditional compilation behavior based on the <code>debug</code> feature. When the debug feature is disabled, <code>DebugName</code> should display a placeholder message rather than the actual type name. The solution preserves this behavior by relying on the existing <code>Deref</code> implementation, which already handles the conditional compilation logic correctly.<p>The impact of these changes is immediately visible in debug output. Instead of seeing nested struct representations, developers now see clean string values when debugging structs containing <code>DebugName</code> fields. This makes debug logs more readable and aligns with developer expectations for how a string wrapper should display.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[DebugName Struct] --> B[Display Implementation]
</span><span>    A --> C[Debug Implementation]
</span><span>    B --> D[Uses Deref to str]
</span><span>    C --> D
</span><span>    D --> E[Conditional: debug feature]
</span><span>    E --> F[Actual name when enabled]
</span><span>    E --> G[Placeholder when disabled]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-utils-src-debug-info-rs-9-6><code>crates/bevy_utils/src/debug_info.rs</code> (+9/-6)</h3><p>This file contains the core implementation changes for the <code>DebugName</code> struct. The modifications focus on improving the debug output format while maintaining existing functionality.<p><strong>Key changes:</strong><ol><li><strong>Removed automatic Debug derivation:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><ol start=2><li><strong>Simplified Display implementation:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl </span><span>fmt</span><span style=color:#ed9366>::</span><span>Display </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>fmt</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>f</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Formatter<'</span><span style=color:#ed9366>_</span><span>>) </span><span style=color:#61676ccc>-> </span><span>core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Result {
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>)]
</span><span>        f</span><span style=color:#ed9366>.</span><span style=color:#f07171>write_str</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>name</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>())</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"debug"</span><span>))]
</span><span>        f</span><span style=color:#ed9366>.</span><span style=color:#f07171>write_str</span><span>(</span><span style=color:#ff8f40>FEATURE_DISABLED</span><span>)</span><span style=color:#ed9366>?</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>(())
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl </span><span>fmt</span><span style=color:#ed9366>::</span><span>Display </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>fmt</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>f</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Formatter<'</span><span style=color:#ed9366>_</span><span>>) </span><span style=color:#61676ccc>-> </span><span>core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Result {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Deref to `str`, which will use `FEATURE_DISABLED` if necessary
</span><span>        </span><span style=color:#f07171>write!</span><span>(f, </span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&**</span><span style=color:#55b4d4;font-style:italic>self</span><span>)
</span><span>    }
</span><span>}
</span></code></pre><ol start=3><li><strong>Added custom Debug implementation:</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New code:
</span><span style=color:#fa6e32>impl </span><span>fmt</span><span style=color:#ed9366>::</span><span>Debug </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DebugName </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>fmt</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>f</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Formatter<'</span><span style=color:#ed9366>_</span><span>>) </span><span style=color:#61676ccc>-> </span><span>core</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>Result {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Deref to `str`, which will use `FEATURE_DISABLED` if necessary
</span><span>        </span><span style=color:#f07171>write!</span><span>(f, </span><span style=color:#86b300>"</span><span style=color:#ff8f40>{:?}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&**</span><span style=color:#55b4d4;font-style:italic>self</span><span>)
</span><span>    }
</span><span>}
</span></code></pre><p>These changes work together to provide cleaner debug output by leveraging the existing <code>Deref</code> implementation and eliminating the verbose struct representation that was previously generated by the automatic <code>Debug</code> derivation.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/fmt/trait.Debug.html target=_blank>Rust Debug Trait Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/fmt/#formatting-traits target=_blank>Rust Display vs Debug formatting</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_utils/latest/bevy_utils/ target=_blank>Bevy Engine Utilities Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation in Rust</a></ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_utils/src/debug_info.rs b/crates/bevy_utils/src/debug_info.rs
</span><span>index 3aad20dfc2ed5..5f1f1aefd4391 100644
</span><span style=color:#c594c5>--- a/crates/bevy_utils/src/debug_info.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_utils/src/debug_info.rs
</span><span style=color:#c594c5>@@ -14,7 +14,7 @@ </span><span style=color:#399ee6>const FEATURE_DISABLED: &str = "Enable the debug feature to see the name";
</span><span> ///
</span><span> /// * If the `debug` feature is enabled, the actual name will be used
</span><span> /// * If it is disabled, a string mentioning the disabled feature will be used
</span><span style=color:#f07171>-#[derive(Clone, Debug, PartialEq, Eq)]
</span><span style=color:#86b300>+#[derive(Clone, PartialEq, Eq)]
</span><span> pub struct DebugName {
</span><span>     #[cfg(feature = "debug")]
</span><span>     name: Cow<'static, str>,
</span><span style=color:#c594c5>@@ -23,12 +23,15 @@ </span><span style=color:#399ee6>pub struct DebugName {
</span><span> cfg::alloc! {
</span><span>     impl fmt::Display for DebugName {
</span><span>         fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
</span><span style=color:#f07171>-            #[cfg(feature = "debug")]
</span><span style=color:#f07171>-            f.write_str(self.name.as_ref())?;
</span><span style=color:#f07171>-            #[cfg(not(feature = "debug"))]
</span><span style=color:#f07171>-            f.write_str(FEATURE_DISABLED)?;
</span><span style=color:#86b300>+            // Deref to `str`, which will use `FEATURE_DISABLED` if necessary
</span><span style=color:#86b300>+            write!(f, "{}", &**self)
</span><span style=color:#86b300>+        }
</span><span style=color:#86b300>+    }
</span><span> 
</span><span style=color:#f07171>-            Ok(())
</span><span style=color:#86b300>+    impl fmt::Debug for DebugName {
</span><span style=color:#86b300>+        fn fmt(&self, f: &mut core::fmt::Formatter<'_>) -> core::fmt::Result {
</span><span style=color:#86b300>+            // Deref to `str`, which will use `FEATURE_DISABLED` if necessary
</span><span style=color:#86b300>+            write!(f, "{:?}", &**self)
</span><span>         }
</span><span>     }
</span><span> }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21870.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>