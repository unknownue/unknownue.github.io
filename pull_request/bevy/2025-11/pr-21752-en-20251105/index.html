<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21752 Fix dragging bug in drag_to_scroll example
        
    </title><meta content="#21752 Fix dragging bug in drag_to_scroll example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-05</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21752-zh-cn-20251105>中文</a></div></div><div class=pr-content><h1 id=fix-dragging-bug-in-drag-to-scroll-example>Fix dragging bug in drag_to_scroll example</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix dragging bug in drag_to_scroll example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21752<li><strong>Author</strong>: rudderbucky<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, C-Examples, A-UI, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-11-05T13:49:27Z<li><strong>Merged</strong>: 2025-11-05T19:26:21Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #21675. The issue was that the position the drag started on was never saved so new drags always forced the grid to its initial position.<p>The original entity hierarchy consists of a <code>ScrollableNode</code>, with a child node (grid parent), which itself has a bunch of nodes as children (grid tiles). Only the grid node has a <code>Pickable</code> component.<p>There are a few issues in the original code:<ul><li>Since grid tiles have <code>should_block_lower = false</code> and <code>is_hoverable = true</code>, they will allow drag events to propagate to the grid parent. Since the grid parent does not have <code>Pickable</code>, it blocks further propagation but does ding a scroll event. This creates two scroll events observed by the <code>ScrollableNode</code>.<li>However, neither of these are the same entity as the <code>ScrollableNode</code>, so both events fail the check originally on line 59 (<code>drag_start.entity != drag_start.original_event_target()</code>).</ul><h2 id=solution>Solution</h2><p>I tried to fix both issues.<ul><li>Add <code>Pickable</code> to the grid parent with <code>should_block_lower = true</code> and <code>is_hoverable = false</code>. This way it does not ding an event nor does it propagate further. This ensures there is only one scroll event ever going through.<li>Remove the line 59 entity check as it is no longer necessary.</ul><h2 id=testing>Testing</h2><p>Tested on macOS, seems to work fine.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The drag-to-scroll example in Bevy was experiencing a critical bug where users couldn’t properly scroll through content by dragging. Every new drag attempt would reset the scroll position to its initial state, making the feature essentially unusable. This bug was reported in issue #21675 and required immediate attention since it affected a core UI interaction pattern.<p>The root cause was found in the event handling architecture. The original implementation had a complex hierarchy where grid tiles had specific <code>Pickable</code> configurations that allowed drag events to propagate upward, while the grid parent lacked proper event handling configuration. This resulted in multiple scroll events being generated, none of which passed the entity validation check designed to filter events.<p>The developer approached this problem by addressing both the event propagation issue and the overly restrictive validation. First, they added a <code>Pickable</code> component to the grid parent node with specific configurations: <code>is_hoverable: false</code> to prevent it from generating hover events, and <code>should_block_lower: true</code> to properly handle event propagation. This ensured that only one clean scroll event would be processed.<p>Second, they removed the entity validation check that was preventing legitimate scroll events from being processed. The combination of these changes created a clean event flow where drag interactions would properly update the scroll position without resetting it.<p>The implementation demonstrates good understanding of Bevy’s event system and the importance of proper component configuration in UI hierarchies. By ensuring that each layer in the UI tree has appropriate event handling characteristics, the developer created a robust solution that prevents multiple event generation while maintaining the intended user interaction behavior.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TB
</span><span>    A[ScrollableNode] --> B[Grid Parent]
</span><span>    B --> C[Grid Tile 1]
</span><span>    B --> D[Grid Tile 2]
</span><span>    B --> E[Grid Tile N]
</span><span>    
</span><span>    style B fill:#e1f5fe
</span><span>    style C fill:#f3e5f5
</span><span>    style D fill:#f3e5f5
</span><span>    style E fill:#f3e5f5
</span></code></pre><p><em>Blue: Grid Parent (now has Pickable component)</em><br> <em>Purple: Grid Tiles (have Pickable with different configuration)</em><h2 id=key-files-changed>Key Files Changed</h2><h3 id=examples-ui-drag-to-scroll-rs-13-10><code>examples/ui/drag_to_scroll.rs</code> (+13/-10)</h3><p>This is the main example file that demonstrates drag-to-scroll functionality. The changes fix the event handling to prevent scroll position reset on new drags.<p><strong>Key Changes:</strong><ol><li><strong>Removed entity validation check</strong> - The original code had a check that prevented scroll position updates if the drag entity didn’t match the original event target:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#ed9366>|</span><span>drag_start</span><span style=color:#61676ccc>: </span><span>On&LTPointer&LTDragStart>></span><span style=color:#61676ccc>,
</span><span> </span><span style=color:#fa6e32>mut</span><span> scroll_position_query</span><span style=color:#61676ccc>: </span><span>Query<
</span><span>    (</span><span style=color:#ed9366>&</span><span>ComputedNode, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ScrollStart),
</span><span>    With&LTScrollableNode>,
</span><span>></span><span style=color:#ed9366>| </span><span>{
</span><span>    </span><span style=color:#fa6e32>if</span><span> drag_start</span><span style=color:#ed9366>.</span><span>entity </span><span style=color:#ed9366>!=</span><span> drag_start</span><span style=color:#ed9366>.</span><span style=color:#f07171>original_event_target</span><span>() {
</span><span>        </span><span style=color:#fa6e32>return</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... rest of function
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ed9366>|_</span><span style=color:#61676ccc>: </span><span>On&LTPointer&LTDragStart>></span><span style=color:#61676ccc>,
</span><span> </span><span style=color:#fa6e32>mut</span><span> scroll_position_query</span><span style=color:#61676ccc>: </span><span>Query<
</span><span>    (</span><span style=color:#ed9366>&</span><span>ComputedNode, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> ScrollStart),
</span><span>    With&LTScrollableNode>,
</span><span>></span><span style=color:#ed9366>| </span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... rest of function (check removed)
</span><span>}
</span></code></pre><ol start=2><li><strong>Added Pickable component to grid parent</strong> - The grid parent node now includes proper event handling configuration:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>commands
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Node {
</span><span>        display</span><span style=color:#61676ccc>: </span><span>Display</span><span style=color:#ed9366>::</span><span>Grid</span><span style=color:#61676ccc>,
</span><span>        grid_template_rows</span><span style=color:#61676ccc>: </span><span>RepeatedGridTrack</span><span style=color:#ed9366>::</span><span>px(w </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>i32</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.</span><span>)</span><span style=color:#61676ccc>,
</span><span>        grid_template_columns</span><span style=color:#61676ccc>: </span><span>RepeatedGridTrack</span><span style=color:#ed9366>::</span><span>px(h </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>i32</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>    })
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>commands
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        Node {
</span><span>            display</span><span style=color:#61676ccc>: </span><span>Display</span><span style=color:#ed9366>::</span><span>Grid</span><span style=color:#61676ccc>,
</span><span>            grid_template_rows</span><span style=color:#61676ccc>: </span><span>RepeatedGridTrack</span><span style=color:#ed9366>::</span><span>px(w </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>i32</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.</span><span>)</span><span style=color:#61676ccc>,
</span><span>            grid_template_columns</span><span style=color:#61676ccc>: </span><span>RepeatedGridTrack</span><span style=color:#ed9366>::</span><span>px(h </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>i32</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>100.</span><span>)</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>        Pickable {
</span><span>            is_hoverable</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>,
</span><span>            should_block_lower</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>true</span><span style=color:#61676ccc>,
</span><span>        }
</span><span>    ))
</span></code></pre><p>These changes work together to ensure that drag events are properly handled at the grid parent level, preventing multiple event generation and allowing the scroll position to be correctly maintained during drag operations.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/ui/ target=_blank>Bevy UI Documentation</a> - Comprehensive guide to Bevy’s UI system<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/input/ target=_blank>Bevy Input Events</a> - Understanding Bevy’s input handling system<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/examples target=_blank>Bevy Examples</a> - Other UI examples demonstrating different interaction patterns</ul><h2 id=full-code-diff>Full Code Diff</h2><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/examples/ui/drag_to_scroll.rs b/examples/ui/drag_to_scroll.rs
</span><span>index 7de099e02602a..54a63a442cfd6 100644
</span><span style=color:#c594c5>--- a/examples/ui/drag_to_scroll.rs
</span><span style=color:#c594c5>+++ b/examples/ui/drag_to_scroll.rs
</span><span style=color:#c594c5>@@ -51,14 +51,11 @@ </span><span style=color:#399ee6>fn setup(mut commands: Commands) {
</span><span>             },
</span><span>         )
</span><span>         .observe(
</span><span style=color:#f07171>-            |drag_start: On&LTPointer&LTDragStart>>,
</span><span style=color:#86b300>+            |_: On&LTPointer&LTDragStart>>,
</span><span>              mut scroll_position_query: Query<
</span><span>                 (&ComputedNode, &mut ScrollStart),
</span><span>                 With&LTScrollableNode>,
</span><span>             >| {
</span><span style=color:#f07171>-                if drag_start.entity != drag_start.original_event_target() {
</span><span style=color:#f07171>-                    return;
</span><span style=color:#f07171>-                }
</span><span>                 if let Ok((computed_node, mut start)) = scroll_position_query.single_mut() {
</span><span>                     start.0 = computed_node.scroll_position * computed_node.inverse_scale_factor;
</span><span>                 }
</span><span style=color:#c594c5>@@ -66,12 +63,18 @@ </span><span style=color:#399ee6>fn setup(mut commands: Commands) {
</span><span>         )
</span><span>         .with_children(|commands| {
</span><span>             commands
</span><span style=color:#f07171>-                .spawn(Node {
</span><span style=color:#f07171>-                    display: Display::Grid,
</span><span style=color:#f07171>-                    grid_template_rows: RepeatedGridTrack::px(w as i32, 100.),
</span><span style=color:#f07171>-                    grid_template_columns: RepeatedGridTrack::px(h as i32, 100.),
</span><span style=color:#f07171>-                    ..default()
</span><span style=color:#f07171>-                })
</span><span style=color:#86b300>+                .spawn((
</span><span style=color:#86b300>+                    Node {
</span><span style=color:#86b300>+                        display: Display::Grid,
</span><span style=color:#86b300>+                        grid_template_rows: RepeatedGridTrack::px(w as i32, 100.),
</span><span style=color:#86b300>+                        grid_template_columns: RepeatedGridTrack::px(h as i32, 100.),
</span><span style=color:#86b300>+                        ..default()
</span><span style=color:#86b300>+                    },
</span><span style=color:#86b300>+                    Pickable {
</span><span style=color:#86b300>+                        is_hoverable: false,
</span><span style=color:#86b300>+                        should_block_lower: true,
</span><span style=color:#86b300>+                    }
</span><span style=color:#86b300>+                ))
</span><span>                 .with_children(|commands| {
</span><span>                     for y in 0..h {
</span><span>                         for x in 0..w {
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21752.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>