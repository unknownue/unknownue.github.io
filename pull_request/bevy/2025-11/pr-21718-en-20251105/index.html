<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21718 Improve Local SystemParam text, examples
        
    </title><meta content="#21718 Improve Local SystemParam text, examples" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-05</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21718-zh-cn-20251105>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Improve Local SystemParam text, examples<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Improve Local SystemParam text, examples<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21718<li><strong>Author</strong>: isHavvy<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-ECS, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-11-02T07:10:33Z<li><strong>Merged</strong>: 2025-11-05T03:39:21Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Explain <code>Local&LTT></code> better to newbies.<h2 id=solution>Solution</h2><p>Add more examples of how to use <code>Local&LTT></code> and document how <code>T</code> is initialized for this type.<p>I tried to order the examples from basic information to more niche information.<p>I have no clue if the configuration example is useful or even what it’s trying to convey. The blame log shows that there was some configuration thing that was removed.<p>Furthermore, I added a doc comment to the SystemParam impl giving a very short description of what it provides as a system parameter. I think all non-tuple impls should provide such a blurb so that looking at the implementations for the trait itself provides useful information besides just the name. If that is wanted, an issue should be opened for it. If it is not, either I or the reviewer who commits this can remove the line.<h2 id=testing>Testing</h2><p>I ran the doctests. I also built the docs and checked that the links work.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a common learning gap for developers new to Bevy’s ECS system: understanding how <code>Local&LTT></code> system parameters work. The existing documentation was sparse and didn’t adequately explain the behavior and use cases for this important system parameter type.<p>The core problem was that <code>Local&LTT></code> serves a unique role in Bevy’s ECS - it provides system-private state that persists across system executions but isn’t shared between systems. This concept can be confusing for developers coming from other ECS frameworks or those unfamiliar with system-local state management patterns.<p>The solution approach focused on comprehensive documentation improvements through practical examples. The author organized the examples from basic to advanced usage, creating a natural learning progression. They started with a simple counter example to demonstrate the fundamental behavior:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>counter</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>count</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>u32</span><span>>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>u32 </span><span>{
</span><span>    </span><span style=color:#ed9366>*</span><span>count </span><span style=color:#ed9366>+= </span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#ed9366>*</span><span>count
</span><span>}
</span></code></pre><p>This example clearly shows how <code>Local&LTu32></code> maintains state between system calls, starting from the default value of 0 and incrementing with each execution.<p>The implementation then builds on this foundation with more complex scenarios. One key insight was demonstrating how to provide custom initialization values using <code>Option</code> wrappers:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>counter_from_10</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>count</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#fa6e32>u32</span><span>>>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>u32 </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> count </span><span style=color:#ed9366>=</span><span> count</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_or_insert</span><span>(</span><span style=color:#ff8f40>10</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#ed9366>*</span><span>count </span><span style=color:#ed9366>+= </span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#ed9366>*</span><span>count
</span><span>}
</span></code></pre><p>This pattern is particularly valuable because it shows developers how to work around the limitation that <code>Local&LTT></code> always initializes with <code>T::default()</code> when using <code>FromWorld</code>.<p>Another important clarification was showing that multiple <code>Local</code> parameters of the same type in the same system are distinct:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>double_counter</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>count</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>u32</span><span>>, </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>double_count</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>u32</span><span>>) </span><span style=color:#61676ccc>-> </span><span>(</span><span style=color:#fa6e32>u32</span><span>, </span><span style=color:#fa6e32>u32</span><span>) {
</span><span>    </span><span style=color:#ed9366>*</span><span>count </span><span style=color:#ed9366>+= </span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#ed9366>*</span><span>double_count </span><span style=color:#ed9366>+= </span><span style=color:#ff8f40>2</span><span style=color:#61676ccc>;
</span><span>    (</span><span style=color:#ed9366>*</span><span>count</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>*</span><span>double_count)
</span><span>}
</span></code></pre><p>The author also included a crucial example demonstrating that different systems using the same <code>Local&LTT></code> type get independent instances:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>write_to_local</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>local</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>) {
</span><span>    </span><span style=color:#ed9366>*</span><span>local </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>42</span><span style=color:#61676ccc>;
</span><span>}
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>read_from_local</span><span>(</span><span style=color:#ff8f40>local</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>usize </span><span>{
</span><span>    </span><span style=color:#ed9366>*</span><span>local
</span><span>}
</span></code></pre><p>This addresses a common misconception about <code>Local</code> sharing between systems.<p>For performance-conscious developers, the PR added an example showing how <code>Local</code> can be used to avoid repeated memory allocations:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>some_system</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>vec</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#55b4d4;font-style:italic>Vec</span><span><</span><span style=color:#fa6e32>u32</span><span>>>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// System logic using vec
</span><span>    vec</span><span style=color:#ed9366>.</span><span style=color:#f07171>clear</span><span>()</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Reuse for next call
</span><span>}
</span></code></pre><p>The technical insights from this PR reveal several important patterns in Bevy’s ECS design. The <code>Local&LTT></code> system parameter fills a specific niche between global resources and temporary local variables - it provides persistent state that’s scoped to a single system’s lifetime across multiple executions. This is particularly useful for caching, counters, and temporary storage that needs to persist between frames but shouldn’t be globally accessible.<p>The documentation improvements follow established best practices for API documentation by providing:<ul><li>Clear explanation of initialization behavior<li>Progressive examples from simple to complex<li>Clarification of common misconceptions<li>Performance optimization patterns</ul><p>The impact of these changes is significant for developer experience. New Bevy users will encounter fewer stumbling blocks when working with system-local state, and the comprehensive examples provide immediate, copy-paste solutions for common patterns. The improved documentation also reduces the likelihood of developers misusing <code>Local&LTT></code> or creating workarounds for behavior that’s already supported.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[System Execution] --> B[Local&LTT> Initialization]
</span><span>    B --> C{T: Default?}
</span><span>    C -->|Yes| D[Use T::default()]
</span><span>    C -->|No| E[Use FromWorld::from_world]
</span><span>    D --> F[System Logic]
</span><span>    E --> F
</span><span>    F --> G[State Persists]
</span><span>    G --> A
</span><span>    
</span><span>    H[System A] --> I[Local&LTCounter> A]
</span><span>    J[System B] --> K[Local&LTCounter> B]
</span><span>    I -.->|Independent| K
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_ecs/src/system/system_param.rs</code></strong><p>This file contains the core implementation and documentation for Bevy’s system parameters. The changes focus exclusively on improving the documentation for the <code>Local&LTT></code> system parameter.<p><strong>Key Changes:</strong><ol><li><strong>Enhanced struct documentation</strong> - Added clear explanation of persistence and initialization:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>/// A system local [`SystemParam`].
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// A [`SystemParam`] that provides a system-private value of `T` that persists across system calls.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// The initial value is created by calling `T`'s [`FromWorld::from_world`] (or [`Default::default`] if `T: Default`).
</span></code></pre><ol start=2><li><strong>Improved primary example</strong> - Replaced complex two-system example with simple counter:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before example showed two systems with confusing interaction
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>write_to_local</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>local</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>) {
</span><span>    </span><span style=color:#ed9366>*</span><span>local </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>42</span><span style=color:#61676ccc>;
</span><span>}
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>read_from_local</span><span>(</span><span style=color:#ff8f40>local</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>usize </span><span>{
</span><span>    </span><span style=color:#ed9366>*</span><span>local
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After shows clear single-system behavior
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>counter</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>count</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>u32</span><span>>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>u32 </span><span>{
</span><span>    </span><span style=color:#ed9366>*</span><span>count </span><span style=color:#ed9366>+= </span><span style=color:#ff8f40>1</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#ed9366>*</span><span>count
</span><span>}
</span></code></pre><ol start=3><li><p><strong>Added comprehensive examples</strong> - Multiple new examples covering:</p> <ul><li>Custom initialization with <code>Option</code><li>Multiple locals of same type<li>Independent locals across systems<li>Memory reuse patterns</ul><li><p><strong>SystemParam implementation documentation</strong> - Added brief description:</p></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>unsafe impl</span><span><</span><span style=color:#fa6e32>'s</span><span>, T</span><span style=color:#61676ccc>:</span><span> FromWorld </span><span style=color:#ed9366>+ </span><span style=color:#55b4d4;font-style:italic>Send </span><span style=color:#ed9366>+ </span><span style=color:#fa6e32>'static</span><span>> SystemParam </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>Local</span><span>&LTT> {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... existing code ...
</span><span>}
</span></code></pre><p>These changes transform the <code>Local&LTT></code> documentation from minimal to comprehensive, providing developers with clear guidance and practical examples for using this system parameter effectively.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ecs/#system-parameters target=_blank>Bevy ECS System Parameters Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/system-params.html target=_blank>Bevy Cheatbook - System Parameters</a><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/documentation.html target=_blank>Rust API Guidelines on Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/system/trait.SystemParam.html target=_blank>Bevy SystemParam Trait Documentation</a></ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ecs/src/system/system_param.rs b/crates/bevy_ecs/src/system/system_param.rs
</span><span>index 909e434c19242..6e6c4deadff3f 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/system/system_param.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/system/system_param.rs
</span><span style=color:#c594c5>@@ -972,7 +972,9 @@ </span><span style=color:#399ee6>unsafe impl<'w> SystemParam for DeferredWorld<'w> {
</span><span>     }
</span><span> }
</span><span> 
</span><span style=color:#f07171>-/// A system local [`SystemParam`].
</span><span style=color:#86b300>+/// A [`SystemParam`] that provides a system-private value of `T` that persists across system calls.
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// The initial value is created by calling `T`'s [`FromWorld::from_world`] (or [`Default::default`] if `T: Default`).
</span><span> ///
</span><span> /// A local may only be accessed by the system itself and is therefore not visible to other systems.
</span><span> /// If two or more systems specify the same local type each will have their own unique local.
</span><span style=color:#c594c5>@@ -986,21 +988,17 @@ </span><span style=color:#399ee6>unsafe impl<'w> SystemParam for DeferredWorld<'w> {
</span><span> /// ```
</span><span> /// # use bevy_ecs::prelude::*;
</span><span> /// # let world = &mut World::default();
</span><span style=color:#f07171>-/// fn write_to_local(mut local: Local&LTusize>) {
</span><span style=color:#f07171>-///     *local = 42;
</span><span style=color:#f07171>-/// }
</span><span style=color:#f07171>-/// fn read_from_local(local: Local&LTusize>) -> usize {
</span><span style=color:#f07171>-///     *local
</span><span style=color:#86b300>+/// fn counter(mut count: Local&LTu32>) -> u32 {
</span><span style=color:#86b300>+///     *count += 1;
</span><span style=color:#86b300>+///     *count
</span><span> /// }
</span><span style=color:#f07171>-/// let mut write_system = IntoSystem::into_system(write_to_local);
</span><span style=color:#f07171>-/// let mut read_system = IntoSystem::into_system(read_from_local);
</span><span style=color:#f07171>-/// write_system.initialize(world);
</span><span style=color:#f07171>-/// read_system.initialize(world);
</span><span style=color:#86b300>+/// let mut counter_system = IntoSystem::into_system(counter);
</span><span style=color:#86b300>+/// counter_system.initialize(world);
</span><span> ///
</span><span style=color:#f07171>-/// assert_eq!(read_system.run((), world).unwrap(), 0);
</span><span style=color:#f07171>-/// write_system.run((), world);
</span><span style=color:#f07171>-/// // Note how the read local is still 0 due to the locals not being shared.
</span><span style=color:#f07171>-/// assert_eq!(read_system.run((), world).unwrap(), 0);
</span><span style=color:#86b300>+/// // Counter is initialized to u32's default value of 0, and increases to 1 on first run.
</span><span style=color:#86b300>+/// assert_eq!(counter_system.run((), world).unwrap(), 1);
</span><span style=color:#86b300>+/// // Counter gets the same value and increases to 2 on its second call.
</span><span style=color:#86b300>+/// assert_eq!(counter_system.run((), world).unwrap(), 2);
</span><span> /// ```
</span><span> ///
</span><span> /// A simple way to set a different default value for a local is by wrapping the value with an Option.
</span><span style=color:#c594c5>@@ -1008,7 +1006,7 @@ </span><span style=color:#399ee6>unsafe impl<'w> SystemParam for DeferredWorld<'w> {
</span><span> /// ```
</span><span> /// # use bevy_ecs::prelude::*;
</span><span> /// # let world = &mut World::default();
</span><span style=color:#f07171>-/// fn counter_from_10(mut count: Local&LTOption&LTusize>>) -> usize {
</span><span style=color:#86b300>+/// fn counter_from_10(mut count: Local&LTOption&LTu32>>) -> u32 {
</span><span> ///     let count = count.get_or_insert(10);
</span><span> ///     *count += 1;
</span><span> ///     *count
</span><span style=color:#c594c5>@@ -1022,6 +1020,58 @@ </span><span style=color:#399ee6>unsafe impl<'w> SystemParam for DeferredWorld<'w> {
</span><span> /// assert_eq!(counter_system.run((), world).unwrap(), 12);
</span><span> /// ```
</span><span> ///
</span><span style=color:#86b300>+/// A system can have multiple `Local` values with the same type, each with distinct values.
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// ```
</span><span style=color:#86b300>+/// # use bevy_ecs::prelude::*;
</span><span style=color:#86b300>+/// # let world = &mut World::default();
</span><span style=color:#86b300>+/// fn double_counter(mut count: Local&LTu32>, mut double_count: Local&LTu32>) -> (u32, u32) {
</span><span style=color:#86b300>+///     *count += 1;
</span><span style=color:#86b300>+///     *double_count += 2;
</span><span style=color:#86b300>+///     (*count, *double_count)
</span><span style=color:#86b300>+/// }
</span><span style=color:#86b300>+/// let mut counter_system = IntoSystem::into_system(double_counter);
</span><span style=color:#86b300>+/// counter_system.initialize(world);
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// assert_eq!(counter_system.run((), world).unwrap(), (1, 2));
</span><span style=color:#86b300>+/// assert_eq!(counter_system.run((), world).unwrap(), (2, 4));
</span><span style=color:#86b300>+/// ```
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// This example shows that two systems using the same type for their own `Local` get distinct locals.
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// ```
</span><span style=color:#86b300>+/// # use bevy_ecs::prelude::*;
</span><span style=color:#86b300>+/// # let world = &mut World::default();
</span><span style=color:#86b300>+/// fn write_to_local(mut local: Local&LTusize>) {
</span><span style=color:#86b300>+///     *local = 42;
</span><span style=color:#86b300>+/// }
</span><span style=color:#86b300>+/// fn read_from_local(local: Local&LTusize>) -> usize {
</span><span style=color:#86b300>+///     *local
</span><span style=color:#86b300>+/// }
</span><span style=color:#86b300>+/// let mut write_system = IntoSystem::into_system(write_to_local);
</span><span style=color:#86b300>+/// let mut read_system = IntoSystem::into_system(read_from_local);
</span><span style=color:#86b300>+/// write_system.initialize(world);
</span><span style=color:#86b300>+/// read_system.initialize(world);
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// assert_eq!(read_system.run((), world).unwrap(), 0);
</span><span style=color:#86b300>+/// write_system.run((), world);
</span><span style=color:#86b300>+/// // The read local is still 0 due to the locals not being shared.
</span><span style=color:#86b300>+/// assert_eq!(read_system.run((), world).unwrap(), 0);
</span><span style=color:#86b300>+/// ```
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// You can use a `Local` to avoid reallocating memory every system call.
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// ```
</span><span style=color:#86b300>+/// # use bevy_ecs::prelude::*;
</span><span style=color:#86b300>+/// fn some_system(mut vec: Local&LTVec&LTu32>>) {
</span><span style=color:#86b300>+///     // Do your regular system logic, using the vec, as normal.
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+///     // At end of function, clear the vec's contents so its empty for next system call.
</span><span style=color:#86b300>+///     // If it's possible the capacity could get too large, you may want to check and resize that as well.
</span><span style=color:#86b300>+///     vec.clear();
</span><span style=color:#86b300>+/// }
</span><span style=color:#86b300>+/// ```
</span><span style=color:#86b300>+///
</span><span> /// N.B. A [`Local`]s value cannot be read or written to outside of the containing system.
</span><span> /// To add configuration to a system, convert a capturing closure into the system instead:
</span><span> ///
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21718.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>