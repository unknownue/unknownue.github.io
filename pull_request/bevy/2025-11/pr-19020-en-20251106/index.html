<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19020 Add support for OpenType features in text (e.g. ligatures, smallcaps)
        
    </title><meta content="#19020 Add support for OpenType features in text (e.g. ligatures, smallcaps)" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-06</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-19020-zh-cn-20251106>中文</a></div></div><div class=pr-content><h1 id=add-support-for-opentype-features-in-text-e-g-ligatures-smallcaps>Add support for OpenType features in text (e.g. ligatures, smallcaps)</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Add support for OpenType features in text (e.g. ligatures, smallcaps)<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19020<li><strong>Author</strong>: hansler<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, A-Text, M-Release-Note, D-Straightforward<li><strong>Created</strong>: 2025-05-01T22:34:12Z<li><strong>Merged</strong>: 2025-11-06T18:49:09Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>OpenType features include things like smallcaps, lined vs old-style numbers, ligatures, stylistic alternate characters, fractional numbers (numerator placed above the denominator), forced monospacing for numbers, and more. There are >100 possible OpenType feature tags; see https://learn.microsoft.com/en-us/typography/opentype/spec/featurelist for the up-to-date list. This provides a way for Bevy users to use these features when using .otf fonts that support them.<h2 id=solution>Solution</h2><p>OpenType features are now supported in cosmic-text, so this just provides a way to pass them through. A few notes:<ul><li>I extended the existing “text” example to showcase a few different OpenType features.<li>OpenType features are only available for .otf fonts. Since there weren’t any existing .otf fonts in the asset/ folder, I’ve added an SIL-licenced font so that we can showcase this in example code.<li>I added a “FontFeatures” struct. cosmic-text does already include its own FontFeatures struct, but 1) it does not implement Reflect, which is required by TextFont, and 2) the one I added has a couple ergonomics improvements for the builder methods compared to cosmic-text’s.<li>OpenType font features are four characters strings, e.g. “liga”. I considered representing these within an enum, but decided against this since there are hundreds of possible features, and more get added frequently, so this would require quite a bit of ongoing maintenance. Since these features are typically referred to by their four-letter name in documentation, I think the [u8; 4] representation is appropriate, and this mirrors what cosmic-text does as well. I added some consts for commonly used features.</ul><h2 id=testing>Testing</h2><p>I extended the “text” example. Run:<p><code>cargo run --example text</code><hr><h2 id=showcase>Showcase</h2><p>Screenshot: <img alt=opentype_features src=https://github.com/user-attachments/assets/08167404-e7c1-4a9f-b21c-d3370d7e4924><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a gap in Bevy’s text rendering capabilities by adding support for OpenType font features. The core problem was that while modern fonts support advanced typographic features like ligatures, small caps, and stylistic alternates, Bevy had no mechanism to expose these features to developers.<p>The solution leverages cosmic-text’s existing OpenType support, creating a clean API layer that integrates with Bevy’s existing text system. The implementation required careful consideration of how to represent OpenType feature tags - the developer chose a <code>[u8; 4]</code> representation rather than an enum due to the large and growing number of possible features (over 100 and counting). This approach mirrors cosmic-text’s implementation while providing better ergonomics through a builder pattern.<p>The key insight was that OpenType features are essentially four-character ASCII tags that control specific font behaviors. For example, “liga” enables standard ligatures, “smcp” enables small caps, and “frac” enables true fractions. The implementation needed to balance type safety with flexibility, since fonts can support arbitrary feature combinations.<p>The implementation follows a straightforward architectural pattern: define the data structures, provide conversion to cosmic-text’s format, and integrate with the existing text pipeline. The <code>FontFeatures</code> struct was designed with both simplicity and extensibility in mind, supporting both simple boolean features and numeric parameters for features like font weight variation.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example usage from the implementation
</span><span style=color:#fa6e32>let</span><span> font_features </span><span style=color:#ed9366>= </span><span>FontFeatures</span><span style=color:#ed9366>::</span><span>builder()
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>enable</span><span>(FontFeatureTag</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>STANDARD_LIGATURES</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>set</span><span>(FontFeatureTag</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>WEIGHT</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>300</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>build</span><span>()</span><span style=color:#61676ccc>;
</span></code></pre><p>One notable engineering decision was the addition of a new OTF font to the assets. Since OpenType features only work with .otf fonts and Bevy’s existing fonts were primarily TTF, the PR includes the EB Garamond font under an SIL Open Font License. This provides a practical demonstration vehicle without licensing complications.<p>The integration point is minimal - a single line in the text pipeline passes the font features to cosmic-text:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In pipeline.rs
</span><span style=color:#ed9366>.</span><span style=color:#f07171>font_features</span><span>((</span><span style=color:#ed9366>&</span><span>text_font</span><span style=color:#ed9366>.</span><span>font_features)</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())
</span></code></pre><p>This clean separation means the core text rendering logic remains unchanged, with OpenType features being an optional enhancement that builds on existing infrastructure.<p>The impact is significant for applications requiring sophisticated typography. Features like ligatures improve text readability, small caps provide professional typography options, and specialized number forms (oldstyle vs lining figures) enable proper typesetting for different contexts. For international text, this support becomes even more critical as many non-Latin scripts rely heavily on OpenType features for correct rendering.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[FontFeatureTag] --> B[FontFeatures]
</span><span>    B --> C[TextFont]
</span><span>    C --> D[Text Pipeline]
</span><span>    D --> E[cosmic-text]
</span><span>    F[Example Code] --> B
</span><span>    G[EBGaramond.otf] --> D
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-text-rs-190-0><code>crates/bevy_text/src/text.rs</code> (+190/-0)</h3><p>This file contains the core implementation of OpenType feature support. It defines the <code>FontFeatureTag</code> and <code>FontFeatures</code> types that enable developers to configure typographic features.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Key addition: FontFeatureTag definition
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Eq</span><span style=color:#61676ccc>,</span><span> PartialOrd</span><span style=color:#61676ccc>,</span><span> Ord</span><span style=color:#61676ccc>,</span><span> Hash</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>FontFeatureTag</span><span>([</span><span style=color:#fa6e32>u8</span><span>; 4])</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>FontFeatureTag </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>STANDARD_LIGATURES</span><span style=color:#61676ccc>:</span><span> FontFeatureTag </span><span style=color:#ed9366>= </span><span>FontFeatureTag</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>b</span><span style=color:#86b300>"liga"</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>pub const </span><span style=color:#ff8f40>SMALL_CAPS</span><span style=color:#61676ccc>:</span><span> FontFeatureTag </span><span style=color:#ed9366>= </span><span>FontFeatureTag</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>b</span><span style=color:#86b300>"smcp"</span><span>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... many more feature constants
</span><span>}
</span></code></pre><p>The <code>FontFeatures</code> struct provides a builder pattern for easy configuration:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>FontFeatures </span><span>{
</span><span>    features</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span><(FontFeatureTag, </span><span style=color:#fa6e32>u32</span><span>)>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>FontFeatures </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>builder</span><span>() </span><span style=color:#61676ccc>-></span><span> FontFeaturesBuilder {
</span><span>        FontFeaturesBuilder</span><span style=color:#ed9366>::</span><span>default()
</span><span>    }
</span><span>}
</span></code></pre><h3 id=examples-ui-text-rs-63-1><code>examples/ui/text.rs</code> (+63/-1)</h3><p>The text example was extended to demonstrate various OpenType features in action:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example usage showing multiple features
</span><span style=color:#fa6e32>let</span><span> text_rows </span><span style=color:#ed9366>= </span><span>[
</span><span>    (</span><span style=color:#86b300>"Smallcaps: "</span><span style=color:#61676ccc>, </span><span>FontFeatureTag</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>SMALL_CAPS</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"Hello World"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    (</span><span style=color:#86b300>"Ligatures: "</span><span style=color:#61676ccc>, </span><span>FontFeatureTag</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>STANDARD_LIGATURES</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"fi fl ff ffi ffl"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    (</span><span style=color:#86b300>"Fractions: "</span><span style=color:#61676ccc>, </span><span>FontFeatureTag</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>FRACTIONS</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"12/134"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... more examples
</span><span>]</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>for </span><span>(title</span><span style=color:#61676ccc>,</span><span> feature</span><span style=color:#61676ccc>,</span><span> text) </span><span style=color:#ed9366>in</span><span> text_rows {
</span><span>    parent</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((
</span><span>        TextSpan</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{text}</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>"</span><span>))</span><span style=color:#61676ccc>,
</span><span>        TextFont {
</span><span>            font</span><span style=color:#61676ccc>:</span><span> opentype_font_handle</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>,
</span><span>            font_size</span><span style=color:#61676ccc>: </span><span style=color:#ff8f40>24.0</span><span style=color:#61676ccc>,
</span><span>            font_features</span><span style=color:#61676ccc>: </span><span>FontFeatures</span><span style=color:#ed9366>::</span><span>builder()</span><span style=color:#ed9366>.</span><span style=color:#f07171>enable</span><span>(feature)</span><span style=color:#ed9366>.</span><span style=color:#f07171>build</span><span>()</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#ed9366>..</span><span style=color:#f07171>default</span><span>()
</span><span>        }</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=crates-bevy-text-src-pipeline-rs-1-0><code>crates/bevy_text/src/pipeline.rs</code> (+1/-0)</h3><p>A single line addition integrates the font features into the text rendering pipeline:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>// No font feature support
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#ed9366>.</span><span style=color:#f07171>font_features</span><span>((</span><span style=color:#ed9366>&</span><span>text_font</span><span style=color:#ed9366>.</span><span>font_features)</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())
</span></code></pre><h3 id=assets-fonts-ebgaramond12-regular-otf-and-assets-fonts-ebgaramond-license-93-0><code>assets/fonts/EBGaramond12-Regular.otf</code> and <code>assets/fonts/EBGaramond-LICENSE</code> (+93/-0)</h3><p>Added a properly licensed OTF font to demonstrate OpenType features, since existing Bevy fonts were primarily TTF format which doesn’t support these features.<h3 id=release-content-release-notes-opentype-font-features-md-41-0><code>release-content/release-notes/opentype_font_features.md</code> (+41/-0)</h3><p>Comprehensive release notes documenting the new feature with usage examples and explanations.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://learn.microsoft.com/en-us/typography/opentype/spec/featurelist target=_blank>OpenType Feature List Specification</a> - Complete reference of all OpenType features<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/cosmic-text target=_blank>cosmic-text Documentation</a> - The underlying text layout engine used by Bevy<li><a rel="noopener nofollow noreferrer" href=https://practicaltypography.com/ target=_blank>Practical Typography</a> - General resource on typography principles<li><a rel="noopener nofollow noreferrer" href=https://practicaltypography.com/ligatures.html target=_blank>Butterick’s Practical Typography</a> - Detailed explanation of ligatures and other typographic features</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_19020.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>