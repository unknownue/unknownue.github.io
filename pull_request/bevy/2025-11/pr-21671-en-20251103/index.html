<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21671 document MotionVectorPrepass better
        
    </title><meta content="#21671 document MotionVectorPrepass better" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21671-zh-cn-20251103>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>document MotionVectorPrepass better<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: document MotionVectorPrepass better<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21671<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Docs, A-Rendering, S-Ready-For-Review<li><strong>Created</strong>: 2025-10-27T23:33:28Z<li><strong>Merged</strong>: 2025-11-03T19:04:05Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>document MotionVectorPrepass better</ul><h2 id=solution>Solution</h2><ul><li>mostly based off the docs in https://github.com/bevyengine/bevy/blob/main/crates/bevy_pbr/src/prepass/prepass.wgsl#L199</ul><h2 id=testing>Testing</h2><ul><li>its docs</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a documentation gap in the Bevy game engine’s rendering pipeline. The <code>MotionVectorPrepass</code> component, when added to a 3D camera, enables screen space motion vector calculation and makes these vectors available to the main rendering pass. However, the original documentation lacked critical details about how to interpret the motion vector data.<p>The problem was straightforward: developers using the motion vector feature had no clear specification about the coordinate system and value ranges of the motion vectors. Without this information, correctly utilizing motion vectors for effects like motion blur or temporal anti-aliasing was challenging and error-prone.<p>The solution approach was practical and efficient. The developer leveraged existing documentation from the shader code in <code>prepass.wgsl</code>, specifically the comments that already defined the coordinate system and value interpretation for motion vectors. This ensured consistency between the Rust API documentation and the underlying shader implementation.<p>The implementation consisted of adding two crucial lines of documentation that precisely define:<ul><li>The coordinate system: “+x right and +y down”<li>The value range: “-1,1”<li>A concrete example: “(1.0,1.0) indicates a pixel moved from the top left corner to the bottom right corner”</ul><p>This documentation improvement is significant because motion vectors are fundamental for advanced rendering techniques. The coordinate system specification (+x right, +y down) aligns with standard screen space coordinates in graphics programming, while the -1 to 1 range provides a normalized representation that’s consistent across different resolutions.<p>The technical insight here is that motion vectors represent the screen-space displacement of pixels between frames. Understanding the coordinate system and value range is essential for correctly implementing temporal effects. The example provided gives developers an immediate mental model for how to interpret the vector values in practical scenarios.<p>This change has minimal impact on the codebase but substantial impact on developer experience. It follows the principle that well-documented APIs reduce implementation errors and accelerate development. The documentation now provides the necessary context for developers to correctly consume motion vector data without needing to dive into the shader code or conduct extensive experimentation.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[MotionVectorPrepass Component] --> B[Camera3D]
</span><span>    B --> C[Screen Space Motion Vectors]
</span><span>    C --> D[Main Rendering Pass]
</span><span>    C --> E[Motion Blur Effects]
</span><span>    C --> F[Temporal Anti-aliasing]
</span><span>    
</span><span>    style A fill:#e1f5fe
</span><span>    style C fill:#f3e5f5
</span><span>    style E fill:#e8f5e8
</span><span>    style F fill:#e8f5e8
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-core-pipeline-src-prepass-mod-rs-3-0><code>crates/bevy_core_pipeline/src/prepass/mod.rs</code> (+3/-0)</h3><p>This file contains the core prepass components for Bevy’s rendering pipeline. The changes add detailed documentation to the <code>MotionVectorPrepass</code> component.<p><strong>Key modification:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_core_pipeline/src/prepass/mod.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#abb0b6;font-style:italic>/// If added to a [`bevy_camera::Camera3d`] then screen space motion vectors will be copied to a separate texture available to the main pass.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MotionVectorPrepass</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#abb0b6;font-style:italic>/// If added to a [`bevy_camera::Camera3d`] then screen space motion vectors will be copied to a separate texture available to the main pass.
</span><span style=color:#abb0b6;font-style:italic>///
</span><span style=color:#abb0b6;font-style:italic>/// Motion vectors are stored in the range -1,1, with +x right and +y down.
</span><span style=color:#abb0b6;font-style:italic>/// A value of (1.0,1.0) indicates a pixel moved from the top left corner to the bottom right corner of the screen.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MotionVectorPrepass</span><span style=color:#61676ccc>;
</span></code></pre><p>The changes add two critical documentation lines that specify:<ol><li>The coordinate system orientation (+x right, +y down)<li>The normalized value range (-1 to 1)<li>A concrete example illustrating vector interpretation</ol><p>These changes directly address the PR’s objective by providing comprehensive documentation for the <code>MotionVectorPrepass</code> component, making it easier for developers to correctly implement motion-based rendering effects.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/crates/bevy_pbr/src/prepass/prepass.wgsl#L199 target=_blank>Bevy Prepass Documentation</a> - The original shader documentation that inspired these changes<li><a rel="noopener nofollow noreferrer" href=https://alextardif.com/MotionBlur.html target=_blank>Screen Space Motion Vectors in Game Rendering</a> - Technical overview of motion vector implementation<li><a rel="noopener nofollow noreferrer" href=https://www.elopezr.com/temporal-aa-and-the-quest-for-the-holy-trail/ target=_blank>Temporal Anti-aliasing Techniques</a> - How motion vectors are used in modern anti-aliasing<li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/features/3d.html target=_blank>Bevy Rendering Pipeline</a> - General Bevy 3D rendering concepts</ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_core_pipeline/src/prepass/mod.rs b/crates/bevy_core_pipeline/src/prepass/mod.rs
</span><span>index 89b09c88b3f09..7b3cc05a66aa1 100644
</span><span style=color:#c594c5>--- a/crates/bevy_core_pipeline/src/prepass/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_core_pipeline/src/prepass/mod.rs
</span><span style=color:#c594c5>@@ -64,6 +64,9 @@ </span><span style=color:#399ee6>pub struct DepthPrepass;
</span><span> pub struct NormalPrepass;
</span><span> 
</span><span> /// If added to a [`bevy_camera::Camera3d`] then screen space motion vectors will be copied to a separate texture available to the main pass.
</span><span style=color:#86b300>+///
</span><span style=color:#86b300>+/// Motion vectors are stored in the range -1,1, with +x right and +y down.
</span><span style=color:#86b300>+/// A value of (1.0,1.0) indicates a pixel moved from the top left corner to the bottom right corner of the screen.
</span><span> #[derive(Component, Default, Reflect, Clone)]
</span><span> #[reflect(Component, Default, Clone)]
</span><span> pub struct MotionVectorPrepass;
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21671.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>