<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21850 Fix entity display not working with padding.
        
    </title><meta content="#21850 Fix entity display not working with padding." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-28</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21850-zh-cn-20251128>中文</a></div></div><div class=pr-content><h1 id=fix-entity-display-not-working-with-padding>Fix entity display not working with padding</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix entity display not working with padding.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21850<li><strong>Author</strong>: PhantomMorrigan<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, D-Trivial, A-ECS, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-11-15T13:46:27Z<li><strong>Merged</strong>: 2025-11-28T08:36:02Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Attempting to display entities with padding does not work, no padding is added.<h2 id=solution>Solution</h2><p>Fix the <code>fmt::Display</code> implementation of <code>Entity</code> so that padding works.<h2 id=testing>Testing</h2><p>Added some unit tests for padding.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important issue in Bevy’s ECS system: the <code>fmt::Display</code> implementation for <code>Entity</code> types wasn’t properly handling formatting options like padding. When developers tried to format entities with padding specifications (like <code>{entity:&LT5}</code> or <code>{entity:>6}</code>), the padding was simply ignored, and the entity would display without any spacing adjustments.<p>The core problem was in the display trait implementation. The original code used <code>write!</code> macro calls directly, which don’t automatically handle padding specifications from the formatter. This is a common Rust formatting pitfall - the <code>write!</code> macro doesn’t propagate formatting options like width, alignment, and padding to the written content.<p>The solution demonstrates proper Rust formatting practices. Instead of using <code>write!</code>, the implementation now uses the formatter’s <code>pad</code> method, which automatically handles all padding and alignment specifications. For the regular entity case, there’s an additional step: the entity string needs to be formatted first using <code>alloc::fmt::format</code> before it can be passed to <code>f.pad()</code>. This is necessary because <code>f.pad()</code> expects a string slice, but we need to construct the formatted string first.<p>The fix is minimal but impactful. It ensures that entity display formatting behaves consistently with other Rust types and respects standard formatting specifications. This is particularly important for debugging, logging, and UI display scenarios where consistent formatting matters.<p>The testing approach is practical and thorough for the scope of the change. The added unit tests verify both left and right padding scenarios, ensuring that the formatting behaves as expected in different alignment contexts. This prevents regression and gives confidence that the fix works correctly.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Entity Display Formatting] --> B[Before: write! macro]
</span><span>    A --> C[After: f.pad method]
</span><span>    B --> D[Ignores padding]
</span><span>    C --> E[Respects padding]
</span><span>    E --> F[Left padding test]
</span><span>    E --> G[Right padding test]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-entity-mod-rs-12-2><code>crates/bevy_ecs/src/entity/mod.rs</code> (+12/-2)</h3><p>This file contains the core Entity type definition and implementations. The changes focus on fixing the Display trait implementation to properly handle formatting options.<p><strong>Key changes:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl </span><span>fmt</span><span style=color:#ed9366>::</span><span>Display </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>Entity </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>fmt</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>f</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>fmt</span><span style=color:#ed9366>::</span><span>Formatter<'</span><span style=color:#ed9366>_</span><span>>) </span><span style=color:#61676ccc>-> </span><span>fmt</span><span style=color:#ed9366>::</span><span>Result {
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self </span><span style=color:#ed9366>== &</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>PLACEHOLDER </span><span>{
</span><span>            </span><span style=color:#f07171>write!</span><span>(f, </span><span style=color:#86b300>"PLACEHOLDER"</span><span>)
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            </span><span style=color:#f07171>write!</span><span>(f, </span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>v</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>index</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>generation</span><span>())
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl </span><span>fmt</span><span style=color:#ed9366>::</span><span>Display </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>Entity </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>fmt</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>f</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>fmt</span><span style=color:#ed9366>::</span><span>Formatter<'</span><span style=color:#ed9366>_</span><span>>) </span><span style=color:#61676ccc>-> </span><span>fmt</span><span style=color:#ed9366>::</span><span>Result {
</span><span>        </span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self </span><span style=color:#ed9366>== &</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>PLACEHOLDER </span><span>{
</span><span>            f</span><span style=color:#ed9366>.</span><span style=color:#f07171>pad</span><span>(</span><span style=color:#86b300>"PLACEHOLDER"</span><span>)
</span><span>        } </span><span style=color:#fa6e32>else </span><span>{
</span><span>            f</span><span style=color:#ed9366>.</span><span style=color:#f07171>pad</span><span>(</span><span style=color:#ed9366>&</span><span>alloc</span><span style=color:#ed9366>::</span><span>fmt</span><span style=color:#ed9366>::</span><span>format(</span><span style=color:#f07171>format_args!</span><span>(
</span><span>                </span><span style=color:#86b300>"{}v{}"</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>index</span><span>()</span><span style=color:#61676ccc>,
</span><span>                </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#f07171>generation</span><span>()
</span><span>            )))
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p><strong>Test additions:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New test cases for padding
</span><span style=color:#fa6e32>let</span><span> padded_left </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{entity:&LT5}</span><span style=color:#86b300>"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(padded_left</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"42v0 "</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let</span><span> padded_right </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{entity:>6}</span><span style=color:#86b300>"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(padded_right</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"  42v0"</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>The changes ensure that:<ol><li>Placeholder entities now properly respect padding<li>Regular entities format their index and generation, then apply padding<li>Both left and right padding work correctly</ol><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/fmt/ target=_blank>Rust std::fmt Documentation</a> - Comprehensive guide to Rust’s formatting system<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/fmt/struct.Formatter.html#method.pad target=_blank>Rust Formatter.pad() method</a> - Official documentation for the pad method<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/entity/struct.Entity.html target=_blank>Bevy ECS Entity Documentation</a> - Bevy’s Entity type documentation</ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ecs/src/entity/mod.rs b/crates/bevy_ecs/src/entity/mod.rs
</span><span>index 82f8c7a64419e..62c1c3de94eb7 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/entity/mod.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/entity/mod.rs
</span><span style=color:#c594c5>@@ -671,9 +671,13 @@ </span><span style=color:#399ee6>impl fmt::Debug for Entity {
</span><span> impl fmt::Display for Entity {
</span><span>     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
</span><span>         if self == &Self::PLACEHOLDER {
</span><span style=color:#f07171>-            write!(f, "PLACEHOLDER")
</span><span style=color:#86b300>+            f.pad("PLACEHOLDER")
</span><span>         } else {
</span><span style=color:#f07171>-            write!(f, "{}v{}", self.index(), self.generation())
</span><span style=color:#86b300>+            f.pad(&alloc::fmt::format(format_args!(
</span><span style=color:#86b300>+                "{}v{}",
</span><span style=color:#86b300>+                self.index(),
</span><span style=color:#86b300>+                self.generation()
</span><span style=color:#86b300>+            )))
</span><span>         }
</span><span>     }
</span><span> }
</span><span style=color:#c594c5>@@ -1514,6 +1518,12 @@ </span><span style=color:#399ee6>mod tests {
</span><span>         let string = format!("{entity}");
</span><span>         assert_eq!(string, "42v0");
</span><span> 
</span><span style=color:#86b300>+        let padded_left = format!("{entity:&LT5}");
</span><span style=color:#86b300>+        assert_eq!(padded_left, "42v0 ");
</span><span style=color:#86b300>+
</span><span style=color:#86b300>+        let padded_right = format!("{entity:>6}");
</span><span style=color:#86b300>+        assert_eq!(padded_right, "  42v0");
</span><span style=color:#86b300>+
</span><span>         let entity = Entity::PLACEHOLDER;
</span><span>         let string = format!("{entity}");
</span><span>         assert_eq!(string, "PLACEHOLDER");
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21850.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>