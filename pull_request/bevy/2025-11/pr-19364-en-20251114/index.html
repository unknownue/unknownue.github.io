<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19364 do not require bevy_dev_tools for states example
        
    </title><meta content="#19364 do not require bevy_dev_tools for states example" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-14</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-19364-zh-cn-20251114>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: do not require bevy_dev_tools for states example<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19364<li><strong>Author</strong>: mockersf<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Examples, S-Ready-For-Final-Review, A-States<li><strong>Created</strong>: 2025-05-25T22:11:18Z<li><strong>Merged</strong>: 2025-11-14T00:04:47Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Example <code>states</code> require the <code>bevy_dev_tools</code> feature even though its not needed for states</ul><h2 id=solution>Solution</h2><ul><li>Make the <code>bevy_dev_tools</code> feature optional, and explain why it can be used</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The problem started with a straightforward but important observation: the states example in Bevy was unnecessarily requiring the <code>bevy_dev_tools</code> feature to compile and run. This created an artificial dependency that didn’t align with the core functionality being demonstrated - state management in the ECS framework.<p>The states example is designed to showcase how to use Bevy’s state system to manage different application states (like Menu and InGame states) and handle transitions between them. The core state management functionality doesn’t depend on development tools; it’s built into Bevy’s main systems. The <code>bevy_dev_tools</code> feature was only being used for one specific debugging utility - logging state transitions.<p>The solution approach was pragmatic and focused on reducing unnecessary dependencies while maintaining functionality. Instead of removing the debugging capability entirely, the PR made it optional through conditional compilation. This approach preserves the useful debugging information for developers who want it, while making the example more accessible to those who don’t need or want the development tools.<p>The implementation involved two key changes. First, the <code>required-features</code> directive was removed from Cargo.toml, allowing the example to compile without the development tools. Second, the code was restructured to conditionally include the state transition logging system only when the <code>bevy_dev_tools</code> feature is enabled.<p>The technical insight here is the use of Rust’s conditional compilation attributes (<code>#[cfg(feature = "bevy_dev_tools")]</code> and <code>#[cfg(not(feature = "bevy_dev_tools"))]</code>) to create feature-gated code paths. This pattern is common in Rust ecosystems for managing optional dependencies and features without compromising core functionality.<p>The impact of this change is significant for users exploring Bevy’s state system. Developers can now run the states example without enabling development tools, reducing compile times and dependencies. The example becomes more focused on its core educational purpose - demonstrating state management - while still providing enhanced debugging capabilities for those who opt into them.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[states example] --> B[Core State Management]
</span><span>    A --> C[Optional Debug Tools]
</span><span>    B --> D[State Transitions]
</span><span>    B --> E[System Organization]
</span><span>    C --> F[State Transition Logging]
</span><span>    
</span><span>    style B fill:#e1f5fe
</span><span>    style C fill:#fff3e0
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=cargo-toml-0-1><code>Cargo.toml</code> (+0/-1)</h3><p><strong>Change:</strong> Removed the <code>required-features = ["bevy_dev_tools"]</code> directive for the states example.<p><strong>Why:</strong> This change allows the example to compile and run without requiring the development tools feature, making it more accessible.<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>example</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>states</span><span>]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"States"
</span><span style=color:#399ee6>required-features </span><span>= [</span><span style=color:#86b300>"bevy_dev_tools"</span><span>]
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span>[</span><span style=color:#399ee6>package</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>metadata</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>example</span><span style=color:#61676ccc>.</span><span style=color:#399ee6>states</span><span>]
</span><span style=color:#399ee6>name </span><span>= </span><span style=color:#86b300>"States"
</span></code></pre><h3 id=examples-state-states-rs-11-6><code>examples/state/states.rs</code> (+11/-6)</h3><p><strong>Change:</strong> Restructured the code to make <code>bevy_dev_tools</code> optional and added conditional compilation for the state transition logging system.<p><strong>Why:</strong> This maintains the debugging functionality when desired while removing the hard dependency.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>{dev_tools</span><span style=color:#ed9366>::</span><span>states</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>, </span><span>prelude</span><span style=color:#ed9366>::*</span><span>}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    App</span><span style=color:#ed9366>::</span><span>new()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(DefaultPlugins)
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other systems ...
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>, </span><span>log_transitions</span><span style=color:#ed9366>::</span><span>&LTAppState>)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy</span><span style=color:#ed9366>::</span><span>prelude</span><span style=color:#ed9366>::*</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    </span><span style=color:#fa6e32>let mut</span><span> app </span><span style=color:#ed9366>= </span><span>App</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(DefaultPlugins)
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... other systems ...
</span><span>        </span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_dev_tools"</span><span>)]
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Update</span><span style=color:#61676ccc>, </span><span>bevy</span><span style=color:#ed9366>::</span><span>dev_tools</span><span style=color:#ed9366>::</span><span>states</span><span style=color:#ed9366>::</span><span>log_transitions</span><span style=color:#ed9366>::</span><span>&LTAppState>)</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>not</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_dev_tools"</span><span>))]
</span><span>    </span><span style=color:#f07171>warn!</span><span>(</span><span style=color:#86b300>"Enable feature bevy_dev_tools to log state transitions"</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>    app</span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The key changes in the Rust code:<ul><li>Removed the blanket import of <code>bevy::dev_tools::states::*</code><li>Restructured app creation to use a mutable <code>app</code> variable for conditional system addition<li>Added conditional compilation blocks for the state transition logging<li>Included a helpful warning message when the feature is not enabled</ul><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy/latest/bevy/state/index.html target=_blank>Bevy States Documentation</a> - Official documentation for Bevy’s state system<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Rust Conditional Compilation</a> - Rust reference on feature-gated code<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/examples#readme target=_blank>Bevy Examples Guide</a> - How to run and learn from Bevy examples</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_19364.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>