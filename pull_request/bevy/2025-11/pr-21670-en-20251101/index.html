<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21670 Update heapless requirement from 0.8 to 0.9
        
    </title><meta content="#21670 Update heapless requirement from 0.8 to 0.9" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-01</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21670-zh-cn-20251101>中文</a></div></div><div class=pr-content><h1 id=update-heapless-requirement-from-0-8-to-0-9>Update heapless requirement from 0.8 to 0.9</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update heapless requirement from 0.8 to 0.9<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21670<li><strong>Author</strong>: mnmaita<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, C-Dependencies, S-Ready-For-Final-Review, A-Tasks<li><strong>Created</strong>: 2025-10-27T23:20:00Z<li><strong>Merged</strong>: 2025-11-01T19:22:54Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Closes #21610</ul><h2 id=solution>Solution</h2><ul><li>Updated code to account for breaking changes in <code>heapless</code> 0.9.</ul><h2 id=testing>Testing</h2><ul><li>cargo check + tests</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a routine but important dependency maintenance task - updating the <code>heapless</code> crate from version 0.8 to 0.9. The update was necessary because version 0.9 introduced breaking API changes that required corresponding code modifications in Bevy’s task execution system.<p>The core issue was straightforward: the <code>heapless::mpmc::MpMcQueue</code> type had been renamed to <code>heapless::mpmc::Queue</code> in the new version. This type is used in Bevy’s edge executor, which handles task scheduling and execution in a multi-producer, multi-consumer pattern. The edge executor is a critical component of Bevy’s async task system, responsible for managing runnable tasks in a lock-free manner.<p>The implementation approach was minimal and surgical. The developer made two key changes: updating the dependency version in Cargo.toml and modifying the type name in the edge executor implementation. This demonstrates a common pattern in dependency updates where breaking changes are limited to straightforward API renames rather than complex behavioral modifications.<p>From a technical perspective, the <code>heapless</code> crate provides stack-allocated, fixed-capacity data structures for embedded and high-performance applications. The MPMC queue in particular is essential for Bevy’s task system because it allows multiple threads to safely enqueue and dequeue tasks without dynamic memory allocation, which is crucial for maintaining predictable performance in game engines.<p>The impact of this change is primarily maintenance-oriented. By keeping dependencies up to date, the Bevy project benefits from bug fixes, performance improvements, and new features in the <code>heapless</code> crate. The minimal code changes required suggest that the breaking changes in version 0.9 were well-designed and backward-compatible in spirit, requiring only simple type name adjustments.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[heapless 0.8] --> B[Dependency Update]
</span><span>    B --> C[heapless 0.9]
</span><span>    D[MpMcQueue Type] --> E[API Rename]
</span><span>    E --> F[Queue Type]
</span><span>    C --> G[Bevy Tasks Module]
</span><span>    F --> G
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-tasks-cargo-toml><code>crates/bevy_tasks/Cargo.toml</code></h3><ul><li><strong>Change</strong>: Updated heapless dependency from 0.8 to 0.9<li><strong>Purpose</strong>: Bring in the latest version with potential bug fixes and improvements</ul><pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>heapless </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.8"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"portable-atomic"</span><span style=color:#61676ccc>,
</span><span>] }
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>heapless </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.9"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>default-features </span><span>= </span><span style=color:#ff8f40>false</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>features </span><span>= [
</span><span>  </span><span style=color:#86b300>"portable-atomic"</span><span style=color:#61676ccc>,
</span><span>] }
</span></code></pre><h3 id=crates-bevy-tasks-src-edge-executor-rs><code>crates/bevy_tasks/src/edge_executor.rs</code></h3><ul><li><strong>Change</strong>: Updated type name from <code>MpMcQueue</code> to <code>Queue</code><li><strong>Purpose</strong>: Accommodate breaking API change in heapless 0.9</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>queue</span><span style=color:#61676ccc>: </span><span>heapless</span><span style=color:#ed9366>::</span><span>mpmc</span><span style=color:#ed9366>::</span><span>MpMcQueue&LTRunnable, C></span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>queue</span><span style=color:#61676ccc>: </span><span>heapless</span><span style=color:#ed9366>::</span><span>mpmc</span><span style=color:#ed9366>::</span><span>Queue&LTRunnable, C></span><span style=color:#61676ccc>,
</span></code></pre><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>queue</span><span style=color:#61676ccc>: </span><span>heapless</span><span style=color:#ed9366>::</span><span>mpmc</span><span style=color:#ed9366>::</span><span>MpMcQueue</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>queue</span><span style=color:#61676ccc>: </span><span>heapless</span><span style=color:#ed9366>::</span><span>mpmc</span><span style=color:#ed9366>::</span><span>Queue</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>,
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/heapless/ target=_blank>heapless crate documentation</a> - Official documentation for the heapless crate<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_tasks/ target=_blank>Bevy Tasks documentation</a> - Bevy’s async task system<li><a rel="noopener nofollow noreferrer" href=https://semver.org/ target=_blank>Semantic Versioning</a> - Understanding version numbers and breaking changes<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/guide/dependencies.html target=_blank>Rust Dependency Management</a> - Cargo dependency management best practices</ul><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/crates/bevy_tasks/Cargo.toml b/crates/bevy_tasks/Cargo.toml index abe5a1485a6ad..80d77fa2dcd5b 100644 — a/crates/bevy_tasks/Cargo.toml +++ b/crates/bevy_tasks/Cargo.toml @@ -61,7 +61,7 @@ async-channel = { version = “2.3.0”, default-features = false } async-task = { version = “4.4.0”, default-features = false, features = [ “portable-atomic”, ] } -heapless = { version = “0.8”, default-features = false, features = [ +heapless = { version = “0.9”, default-features = false, features = [ “portable-atomic”, ] } atomic-waker = { version = “1”, default-features = false, features = [ diff –git a/crates/bevy_tasks/src/edge_executor.rs b/crates/bevy_tasks/src/edge_executor.rs index a8c80725cafe9..2bf719029d621 100644 — a/crates/bevy_tasks/src/edge_executor.rs +++ b/crates/bevy_tasks/src/edge_executor.rs @@ -449,7 +449,7 @@ struct State<const c: usize> { target_has_atomic = “64”, target_has_atomic = “ptr” )))] <ul><li>queue: heapless::mpmc::MpMcQueue&LTRunnable, C>,</ul> <ul><li>queue: heapless::mpmc::Queue&LTRunnable, C>, waker: AtomicWaker, }</ul> <p>@@ -471,7 +471,7 @@ impl<const c: usize> State<c> { target_has_atomic = “64”, target_has_atomic = “ptr” )))] <ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>       queue: heapless::mpmc::MpMcQueue::new(),
</span></code></pre></ul> <ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>       queue: heapless::mpmc::Queue::new(),
</span><span>       waker: AtomicWaker::new(),
</span><span>   }
</span></code></pre> }</ul>    <div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21670.patch id=patch-info style=display:none></div>  <div class=bottom-spacer></div> 