<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21914 Update wesl requirement from 0.1.2 to 0.2.0
        
    </title><meta content="#21914 Update wesl requirement from 0.1.2 to 0.2.0" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-11/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-11-24</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-11/pr-21914-zh-cn-20251124>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Update wesl requirement from 0.1.2 to 0.2.0<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21914<li><strong>Author</strong>: mnmaita<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: None<li><strong>Created</strong>: 2025-11-23T10:25:19Z<li><strong>Merged</strong>: 2025-11-24T08:36:46Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Closes #20631</ul><h2 id=solution>Solution</h2><ul><li>Fixed breaking changes to be able to update to <code>wesl</code> 0.2.0.</ul><h2 id=testing>Testing</h2><ul><li>CI checks.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a dependency update that required handling breaking API changes in the <code>wesl</code> crate. The core issue was straightforward - the Bevy engine needed to update from <code>wesl</code> 0.1.2 to 0.2.0 to stay current with dependencies and close issue #20631.<p>The breaking change in <code>wesl</code> 0.2.0 involved modifications to how shader feature flags are handled in the compiler options. Previously, the <code>features</code> field was a simple hash map, but in the new version, it was restructured to include a nested <code>flags</code> field. This required updating the code that processes shader definitions to match the new API structure.<p>The implementation approach was minimal and surgical. Rather than making broad architectural changes, the developer identified the specific API incompatibility and applied the minimal fix required. In the shader compilation logic, where boolean shader definitions were being processed, the code needed to be updated to access the feature flags through the new nested structure.<p>The key technical insight here is that dependency updates in Rust often require handling breaking API changes, especially when moving between minor versions (0.1.x to 0.2.x). The solution demonstrates a common pattern in dependency management: identify the breaking change, understand the new API structure, and apply the minimal necessary adjustments to restore functionality.<p>The impact of this change is primarily maintenance-oriented. By updating to the newer version of <code>wesl</code>, Bevy benefits from any bug fixes, performance improvements, or new features in the updated dependency. The changes ensure compatibility while maintaining the existing functionality of the shader compilation system.<p>From an engineering perspective, this PR exemplifies proper dependency management practices. The developer didn’t just update the version number in Cargo.toml but also addressed the breaking API changes, ensuring the codebase would compile and function correctly with the new dependency version.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[wesl 0.1.2] --> B[API Breaking Changes]
</span><span>    B --> C[wesl 0.2.0]
</span><span>    D[Shader Cache] --> E[Compiler Options]
</span><span>    E --> F[Features Structure]
</span><span>    F --> G[Old: HashMap]
</span><span>    F --> H[New: Nested flags field]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-shader-cargo-toml-1-1><code>crates/bevy_shader/Cargo.toml</code> (+1/-1)</h3><p>This file contains the dependency declaration update. The change is minimal but crucial for the update:<pre class=language-toml data-lang=toml style=color:#61676c;background-color:#fafafa><code class=language-toml data-lang=toml><span style=color:#abb0b6;font-style:italic># Before:
</span><span style=color:#399ee6>wesl </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.1.2"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic># After:
</span><span style=color:#399ee6>wesl </span><span>= { </span><span style=color:#399ee6>version </span><span>= </span><span style=color:#86b300>"0.2.0"</span><span style=color:#61676ccc>, </span><span style=color:#399ee6>optional </span><span>= </span><span style=color:#ff8f40>true </span><span>}
</span></code></pre><h3 id=crates-bevy-shader-src-shader-cache-rs-1-1><code>crates/bevy_shader/src/shader_cache.rs</code> (+1/-1)</h3><p>This file contains the actual code change to handle the API breaking change in the wesl crate:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>compiler_options</span><span style=color:#ed9366>.</span><span>features</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(key</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>*</span><span>value)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>compiler_options</span><span style=color:#ed9366>.</span><span>features</span><span style=color:#ed9366>.</span><span>flags</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(key</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>()</span><span style=color:#61676ccc>, </span><span>(</span><span style=color:#ed9366>*</span><span>value)</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())</span><span style=color:#61676ccc>;
</span></code></pre><p>The change reflects the new API structure where feature flags are now nested under a <code>flags</code> field within the compiler options. The <code>.into()</code> call handles any necessary type conversions for the new API.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/guide/dependencies.html target=_blank>Rust Dependency Management</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/cargo/reference/semver.html target=_blank>Semantic Versioning in Rust</a><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/wgsl/ target=_blank>WGSL Shader Language Specification</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/getting-started/shaders/ target=_blank>Bevy Engine Shader System Documentation</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-11/pr_21914.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>