<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21404 Emit slider drag value change only when value changes
        
    </title><meta content="#21404 Emit slider drag value change only when value changes" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-05</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21404-zh-cn-20251005>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Emitting Slider Drag Value Changes Only When Values Actually Change<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Emit slider drag value change only when value changes<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21404<li><strong>Author</strong>: doup<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-UI, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-10-05T19:12:23Z<li><strong>Merged</strong>: 2025-10-05T19:59:21Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #21376<h2 id=solution>Solution</h2><p>Just check if the value has changed with an <code>if</code>. The issue mentions <code>.set_if_neq</code> but I’m not sure if it’s relevant as <code>slider_on_drag</code> doesn’t directly change the component value but emits an event.<h2 id=testing>Testing</h2><p>Checked on the feathers example:<p>https://github.com/user-attachments/assets/ac5bb2fa-9054-4eed-985f-846ac15f310d<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a subtle but important issue in Bevy’s UI slider widget implementation. The problem was straightforward: slider drag events were being triggered continuously during drag operations, even when the actual slider value hadn’t changed. This led to unnecessary event processing and potential performance issues in applications using sliders.<p>The core issue was in the <code>slider_on_drag</code> system, which handles pointer drag events for slider widgets. Previously, this system would emit a <code>ValueChange</code> event every time a drag event occurred, without checking whether the computed slider value had actually changed from its previous value.<p>The solution implemented is a classic optimization pattern - only perform work when the data has actually changed. The developer added a simple conditional check that compares the newly computed slider value with the current value before triggering the change event. This prevents redundant event emissions when the user is dragging the slider but the underlying value remains the same due to precision constraints or other factors.<p>The implementation required two key changes to the <code>slider_on_drag</code> function:<ol><li><p><strong>Query Expansion</strong>: The system query was modified to include the current <code>SliderValue</code> component, which wasn’t previously accessed in this context.</p><li><p><strong>Conditional Event Triggering</strong>: Added an <code>if rounded_value != value.0</code> check before triggering the <code>ValueChange</code> event, ensuring the event only fires when the value actually changes.</p></ol><p>This approach is efficient because it avoids the overhead of event processing and system execution for unchanged values. The check itself is computationally inexpensive - just a simple floating-point comparison - making it a good trade-off between performance gain and code complexity.<p>The fix demonstrates an important principle in game engine development: systems should avoid unnecessary work, especially in hot code paths like input handling. By preventing redundant event emissions, this change reduces the load on downstream systems that might be listening for slider value changes.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Pointer Drag Event] --> B[slider_on_drag System]
</span><span>    B --> C[Compute New Value]
</span><span>    C --> D{Value Changed?}
</span><span>    D -->|Yes| E[Trigger ValueChange Event]
</span><span>    D -->|No| F[Skip Event Triggering]
</span><span>    E --> G[Downstream Systems]
</span><span>    F --> G
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File</strong>: <code>crates/bevy_ui_widgets/src/slider.rs</code> (+9/-5)<p>This file contains the core implementation of Bevy’s slider widget. The changes focus on the drag event handling system to prevent unnecessary value change events.<p><strong>Key Changes</strong>:<ol><li><strong>Query Modification</strong>: Added <code>SliderValue</code> to the system query to access the current slider value<li><strong>Conditional Event Triggering</strong>: Added value change check before emitting events</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// File: crates/bevy_ui_widgets/src/slider.rs
</span><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((node</span><span style=color:#61676ccc>,</span><span> range</span><span style=color:#61676ccc>,</span><span> precision</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#61676ccc>,</span><span> drag</span><span style=color:#61676ccc>,</span><span> disabled)) </span><span style=color:#ed9366>=</span><span> q_slider</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(event</span><span style=color:#ed9366>.</span><span>entity)
</span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... value computation ...
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>trigger</span><span>(ValueChange {
</span><span>        source</span><span style=color:#61676ccc>:</span><span> event</span><span style=color:#ed9366>.</span><span>entity</span><span style=color:#61676ccc>,
</span><span>        value</span><span style=color:#61676ccc>:</span><span> rounded_value</span><span style=color:#61676ccc>,
</span><span>    })</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((value</span><span style=color:#61676ccc>,</span><span> node</span><span style=color:#61676ccc>,</span><span> range</span><span style=color:#61676ccc>,</span><span> precision</span><span style=color:#61676ccc>,</span><span> transform</span><span style=color:#61676ccc>,</span><span> drag</span><span style=color:#61676ccc>,</span><span> disabled)) </span><span style=color:#ed9366>= 
</span><span>    q_slider</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>(event</span><span style=color:#ed9366>.</span><span>entity)
</span><span>{
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... value computation ...
</span><span>    </span><span style=color:#fa6e32>if</span><span> rounded_value </span><span style=color:#ed9366>!=</span><span> value</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>{
</span><span>        commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>trigger</span><span>(ValueChange {
</span><span>            source</span><span style=color:#61676ccc>:</span><span> event</span><span style=color:#ed9366>.</span><span>entity</span><span style=color:#61676ccc>,
</span><span>            value</span><span style=color:#61676ccc>:</span><span> rounded_value</span><span style=color:#61676ccc>,
</span><span>        })</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>The changes are minimal but effective - the system now checks if the computed <code>rounded_value</code> differs from the current <code>value.0</code> before triggering the event. This prevents redundant event emissions during drag operations where the value doesn’t actually change.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ui/latest/bevy_ui/ target=_blank>Bevy UI System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/queries.html target=_blank>Bevy ECS Queries</a><li><a rel="noopener nofollow noreferrer" href=https://bevy-cheatbook.github.io/programming/events.html target=_blank>Event Systems in Bevy</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/tree/main/crates/bevy_ui/src/widget target=_blank>UI Widget Implementation Patterns</a></ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ui_widgets/src/slider.rs b/crates/bevy_ui_widgets/src/slider.rs
</span><span>index 59c3e580b19df..d19e344b29e4e 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ui_widgets/src/slider.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ui_widgets/src/slider.rs
</span><span style=color:#c594c5>@@ -330,6 +330,7 @@ </span><span style=color:#399ee6>pub(crate) fn slider_on_drag(
</span><span>     mut event: On&LTPointer&LTDrag>>,
</span><span>     mut q_slider: Query<
</span><span>         (
</span><span style=color:#86b300>+            &SliderValue,
</span><span>             &ComputedNode,
</span><span>             &SliderRange,
</span><span>             Option<&SliderPrecision>,
</span><span style=color:#c594c5>@@ -344,7 +345,8 @@ </span><span style=color:#399ee6>pub(crate) fn slider_on_drag(
</span><span>     mut commands: Commands,
</span><span>     ui_scale: Res&LTUiScale>,
</span><span> ) {
</span><span style=color:#f07171>-    if let Ok((node, range, precision, transform, drag, disabled)) = q_slider.get_mut(event.entity)
</span><span style=color:#86b300>+    if let Ok((value, node, range, precision, transform, drag, disabled)) =
</span><span style=color:#86b300>+        q_slider.get_mut(event.entity)
</span><span>     {
</span><span>         event.propagate(false);
</span><span>         if drag.dragging && !disabled {
</span><span style=color:#c594c5>@@ -369,10 +371,12 @@ </span><span style=color:#399ee6>pub(crate) fn slider_on_drag(
</span><span>                     .unwrap_or(new_value),
</span><span>             );
</span><span> 
</span><span style=color:#f07171>-            commands.trigger(ValueChange {
</span><span style=color:#f07171>-                source: event.entity,
</span><span style=color:#f07171>-                value: rounded_value,
</span><span style=color:#f07171>-            });
</span><span style=color:#86b300>+            if rounded_value != value.0 {
</span><span style=color:#86b300>+                commands.trigger(ValueChange {
</span><span style=color:#86b300>+                    source: event.entity,
</span><span style=color:#86b300>+                    value: rounded_value,
</span><span style=color:#86b300>+                });
</span><span style=color:#86b300>+            }
</span><span>         }
</span><span>     }
</span><span> }
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21404.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>