<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #19311 Render assets diagnostics
        
    </title><meta content="#19311 Render assets diagnostics" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-19311-zh-cn-20251015>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Render assets diagnostics<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Render assets diagnostics<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/19311<li><strong>Author</strong>: hukasu<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review, C-Testing, A-Diagnostics, M-Needs-Release-Note, X-Uncontroversial, D-Modest<li><strong>Created</strong>: 2025-05-20T16:00:45Z<li><strong>Merged</strong>: 2025-10-14T20:13:31Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>There have been problems with <code>MeshAllocator</code> and <code>MaterialBindGroupAllocator</code> losing track of asset changes, then it would be nice to have an automated way of checking if the number of allocations is growing uncontrollably.<h2 id=solution>Solution</h2><p>Create diagnostics that collect measurements of allocations from <code>MeshAllocator</code> and <code>MaterialBindGroupAllocator</code>, and number of render assets present<h2 id=showcase>Showcase</h2><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(DefaultPlugins)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>((
</span><span>        MeshAllocatorDiagnosticPlugin</span><span style=color:#61676ccc>,
</span><span>        MaterialAllocatorDiagnosticPlugin</span><span style=color:#ed9366>::</span><span>&LTStandardMaterial></span><span style=color:#ed9366>::</span><span>default()</span><span style=color:#61676ccc>,
</span><span>        RenderAssetDiagnosticPlugin</span><span style=color:#ed9366>::</span><span>&LTRenderMesh></span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>" render meshes"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        RenderAssetDiagnosticPlugin</span><span style=color:#ed9366>::</span><span>&LTGpuImage></span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>" gpu images"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ImageMaterial is the name of the manual material used on the `manual_material` example
</span><span>        ErasedRenderAssetDiagnosticPlugin</span><span style=color:#ed9366>::</span><span>&LTImageMaterial></span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>" image materials"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span></code></pre><p>If you also have <code>LogDiagnosticsPlugin</code>, the output looks something like this:<pre style=color:#61676c;background-color:#fafafa><code><span>INFO bevy_diagnostic: mesh_allocator_allocations                                             :    4.000000 meshes (avg 4.000000 meshes)
</span><span>INFO bevy_diagnostic: mesh_allocator_slabs                                                   :    4.000000 slabs (avg 4.000000 slabs)
</span><span>INFO bevy_diagnostic: mesh_allocator_slabs_size                                              : 4194360.000000 bytes (avg 4194360.000000 bytes)
</span><span>INFO bevy_diagnostic: material_allocator_allocations/bevy_pbr::pbr_material::StandardMaterial:   14.000000 materials (avg 14.000000 materials)
</span><span>INFO bevy_diagnostic: material_allocator_slabs/bevy_pbr::pbr_material::StandardMaterial      :    1.000000 slabs (avg 1.000000 slabs)
</span><span>INFO bevy_diagnostic: material_allocator_slabs_size/bevy_pbr::pbr_material::StandardMaterial :  576.000000 bytes (avg 576.000000 bytes)
</span><span>INFO bevy_diagnostic: render_asset/bevy_render::mesh::RenderMesh                             :    5.000000 render meshes (avg 5.000000 render meshes)
</span><span>INFO bevy_diagnostic: render_asset/bevy_render::texture::gpu_image::GpuImage                 :   10.000000 gpu images (avg 10.000000 gpu images)
</span><span>INFO bevy_diagnostic: erased_render_asset/manual_material::ImageMaterial                     :    2.000000 image materials (avg 2.000000 image materials)
</span></code></pre><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a practical monitoring problem in Bevy’s rendering system. The core issue was that <code>MeshAllocator</code> and <code>MaterialBindGroupAllocator</code> could lose track of asset changes, making it difficult to detect when allocations were growing uncontrollably. Without proper visibility into these internal allocation patterns, developers had no automated way to identify memory leaks or performance degradation in their rendering systems.<p>The solution implemented follows Bevy’s established diagnostic pattern while adding specific monitoring capabilities for render assets. The approach creates four new diagnostic plugins that work together to provide comprehensive monitoring:<ol><li><code>MeshAllocatorDiagnosticPlugin</code> - monitors mesh allocation patterns<li><code>MaterialAllocatorDiagnosticPlugin</code> - monitors material allocation patterns<li><code>RenderAssetDiagnosticPlugin</code> - tracks render asset counts<li><code>ErasedRenderAssetDiagnosticPlugin</code> - tracks erased render asset counts</ol><p>The implementation required adding measurement capabilities to the existing allocators. For the <code>MeshAllocator</code>, this involved adding methods to query slab count, total slab size, and allocation count:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In crates/bevy_render/src/mesh/allocator.rs
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>slab_count</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>usize </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>slabs</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>slabs_size</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>u64 </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>slabs</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>slab</span><span>| slab</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>1.</span><span style=color:#f07171>buffer_size</span><span>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>sum</span><span>()
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>allocations</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>usize </span><span>{
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>mesh_id_to_index_slab</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()
</span><span>}
</span></code></pre><p>Similarly, for <code>MaterialBindGroupAllocator</code>, equivalent methods were added to measure bindless material allocations:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// In crates/bevy_pbr/src/material_bind_groups.rs
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>slab_count</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>usize </span><span>{
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Bindless(bless) </span><span style=color:#ed9366>=></span><span> bless</span><span style=color:#ed9366>.</span><span>slabs</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>()</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>NonBindless(</span><span style=color:#ed9366>_</span><span>) </span><span style=color:#ed9366>=> </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>slabs_size</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>usize </span><span>{
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Bindless(bless) </span><span style=color:#ed9366>=></span><span> bless
</span><span>            </span><span style=color:#ed9366>.</span><span>slabs
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>flat_map</span><span>(|</span><span style=color:#ff8f40>slab</span><span>| {
</span><span>                slab</span><span style=color:#ed9366>.</span><span>data_buffers
</span><span>                    </span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span><span>                    </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|(_</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>buffer</span><span>)| buffer</span><span style=color:#ed9366>.</span><span>buffer</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>())
</span><span>            })
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>sum</span><span>()</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>NonBindless(</span><span style=color:#ed9366>_</span><span>) </span><span style=color:#ed9366>=> </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>allocations</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>u64 </span><span>{
</span><span>    </span><span style=color:#fa6e32>match </span><span style=color:#55b4d4;font-style:italic>self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Bindless(bless) </span><span style=color:#ed9366>=></span><span> bless
</span><span>            </span><span style=color:#ed9366>.</span><span>slabs
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>slab</span><span>| </span><span style=color:#fa6e32>u64</span><span style=color:#ed9366>::</span><span>from(slab</span><span style=color:#ed9366>.</span><span>allocated_resource_count))
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>sum</span><span>()</span><span style=color:#61676ccc>,
</span><span>        </span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>NonBindless(</span><span style=color:#ed9366>_</span><span>) </span><span style=color:#ed9366>=> </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,
</span><span>    }
</span><span>}
</span></code></pre><p>The diagnostic plugins follow a consistent pattern: they register diagnostics, create measurement resources with atomic counters, and set up systems to extract measurements from the render world and report them through Bevy’s diagnostics system. The use of atomic types (<code>AtomicUsize</code>, <code>AtomicU64</code>) ensures thread-safe updates between the extract and main app systems.<p>Each plugin implementation follows the same architectural approach:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example from MaterialAllocatorDiagnosticPlugin
</span><span style=color:#fa6e32>impl</span><span>&LTM</span><span style=color:#61676ccc>:</span><span> Material> Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>MaterialAllocatorDiagnosticPlugin</span><span>&LTM> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>bevy_app</span><span style=color:#ed9366>::</span><span>App) {
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_diagnostic</span><span>(
</span><span>            Diagnostic</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>slabs_diagnostic_path())</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_suffix</span><span>(</span><span style=color:#86b300>" slabs"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>register_diagnostic</span><span>(
</span><span>            Diagnostic</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>slabs_size_diagnostic_path())</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_suffix</span><span>(</span><span style=color:#86b300>" bytes"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>register_diagnostic</span><span>(
</span><span>            Diagnostic</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>allocations_diagnostic_path())</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_suffix</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>suffix)</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTMaterialAllocatorMeasurements&LTM>>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(PreUpdate</span><span style=color:#61676ccc>, </span><span>add_material_allocator_measurement</span><span style=color:#ed9366>::</span><span>&LTM>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_app) </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_app_mut</span><span>(RenderApp) {
</span><span>            render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(ExtractSchedule</span><span style=color:#61676ccc>, </span><span>measure_allocator</span><span style=color:#ed9366>::</span><span>&LTM>)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The key technical insight here is the separation between measurement collection (in the render app’s extract schedule) and diagnostic reporting (in the main app’s pre-update). This ensures that measurements are captured at the right point in the frame and reported efficiently.<p>The impact of these changes is significant for developers working with complex rendering systems. They now have automated visibility into:<ul><li>Memory usage patterns of mesh and material allocators<li>Growth trends in render asset counts<li>Potential memory leaks in the rendering pipeline</ul><p>The implementation is non-breaking and follows Bevy’s established patterns, making it easy for developers to opt into this monitoring when needed.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[MeshAllocatorDiagnosticPlugin] --> B[Monitors MeshAllocator]
</span><span>    C[MaterialAllocatorDiagnosticPlugin] --> D[Monitors MaterialBindGroupAllocator]
</span><span>    E[RenderAssetDiagnosticPlugin] --> F[Monitors RenderAssets]
</span><span>    G[ErasedRenderAssetDiagnosticPlugin] --> H[Monitors ErasedRenderAssets]
</span><span>    
</span><span>    B --> I[Reports slab count, slab size, allocations]
</span><span>    D --> J[Reports slab count, slab size, allocations]
</span><span>    F --> K[Reports asset count]
</span><span>    H --> L[Reports asset count]
</span><span>    
</span><span>    I --> M[Bevy Diagnostics System]
</span><span>    J --> M
</span><span>    K --> M
</span><span>    L --> M
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-pbr-src-diagnostic-rs-124-0><code>crates/bevy_pbr/src/diagnostic.rs</code> (+124/-0)</h3><p>This new file implements the material allocator diagnostics plugin. It provides monitoring for material bind group allocators, tracking slab usage and allocation patterns for specific material types.<p>Key code:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MaterialAllocatorDiagnosticPlugin</span><span>&LTM</span><span style=color:#61676ccc>:</span><span> Material> {
</span><span>    suffix</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>,
</span><span>    _phantom</span><span style=color:#61676ccc>: </span><span>PhantomData&LTM>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTM</span><span style=color:#61676ccc>:</span><span> Material> Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>MaterialAllocatorDiagnosticPlugin</span><span>&LTM> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>bevy_app</span><span style=color:#ed9366>::</span><span>App) {
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_diagnostic</span><span>(
</span><span>            Diagnostic</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>slabs_diagnostic_path())</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_suffix</span><span>(</span><span style=color:#86b300>" slabs"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... additional diagnostics registration
</span><span>        </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTMaterialAllocatorMeasurements&LTM>>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(PreUpdate</span><span style=color:#61676ccc>, </span><span>add_material_allocator_measurement</span><span style=color:#ed9366>::</span><span>&LTM>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_app) </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_app_mut</span><span>(RenderApp) {
</span><span>            render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(ExtractSchedule</span><span style=color:#61676ccc>, </span><span>measure_allocator</span><span style=color:#ed9366>::</span><span>&LTM>)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-diagnostic-mesh-allocator-diagnostic-plugin-rs-91-0><code>crates/bevy_render/src/diagnostic/mesh_allocator_diagnostic_plugin.rs</code> (+91/-0)</h3><p>This new file implements diagnostics for the mesh allocator, tracking memory usage and allocation patterns for mesh data.<p>Key code:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MeshAllocatorDiagnosticPlugin</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>MeshAllocatorDiagnosticPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>bevy_app</span><span style=color:#ed9366>::</span><span>App) {
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_diagnostic</span><span>(
</span><span>            Diagnostic</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>MESH_ALLOCATOR_SLABS</span><span style=color:#ed9366>.</span><span style=color:#f07171>clone</span><span>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_suffix</span><span>(</span><span style=color:#86b300>" slabs"</span><span>)</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... additional diagnostics
</span><span>        </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTMeshAllocatorMeasurements>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(PreUpdate</span><span style=color:#61676ccc>,</span><span> add_mesh_allocator_measurement)</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_app) </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_app_mut</span><span>(RenderApp) {
</span><span>            render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(ExtractSchedule</span><span style=color:#61676ccc>,</span><span> measure_allocator)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-diagnostic-erased-render-asset-diagnostic-plugin-rs-81-0><code>crates/bevy_render/src/diagnostic/erased_render_asset_diagnostic_plugin.rs</code> (+81/-0)</h3><p>This new file provides diagnostics for erased render assets, which are render assets that have been type-erased for dynamic handling.<p>Key code:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>ErasedRenderAssetDiagnosticPlugin</span><span>&LTA</span><span style=color:#61676ccc>:</span><span> ErasedRenderAsset> {
</span><span>    suffix</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>,
</span><span>    _phantom</span><span style=color:#61676ccc>: </span><span>PhantomData&LTA>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTA</span><span style=color:#61676ccc>:</span><span> ErasedRenderAsset> Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>ErasedRenderAssetDiagnosticPlugin</span><span>&LTA> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>bevy_app</span><span style=color:#ed9366>::</span><span>App) {
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_diagnostic</span><span>(
</span><span>            Diagnostic</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>render_asset_diagnostic_path())</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_suffix</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>suffix)</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTErasedRenderAssetMeasurements&LTA>>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(PreUpdate</span><span style=color:#61676ccc>, </span><span>add_erased_render_asset_measurement</span><span style=color:#ed9366>::</span><span>&LTA>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_app) </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_app_mut</span><span>(RenderApp) {
</span><span>            render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(ExtractSchedule</span><span style=color:#61676ccc>, </span><span>measure_erased_render_asset</span><span style=color:#ed9366>::</span><span>&LTA>)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-src-diagnostic-render-asset-diagnostic-plugin-rs-77-0><code>crates/bevy_render/src/diagnostic/render_asset_diagnostic_plugin.rs</code> (+77/-0)</h3><p>This new file implements diagnostics for regular render assets, tracking the count of specific render asset types.<p>Key code:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RenderAssetDiagnosticPlugin</span><span>&LTA</span><span style=color:#61676ccc>:</span><span> RenderAsset> {
</span><span>    suffix</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>,
</span><span>    _phantom</span><span style=color:#61676ccc>: </span><span>PhantomData&LTA>,
</span><span>}
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTA</span><span style=color:#61676ccc>:</span><span> RenderAsset> Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>RenderAssetDiagnosticPlugin</span><span>&LTA> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut </span><span>bevy_app</span><span style=color:#ed9366>::</span><span>App) {
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_diagnostic</span><span>(
</span><span>            Diagnostic</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>render_asset_diagnostic_path())</span><span style=color:#ed9366>.</span><span style=color:#f07171>with_suffix</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>suffix)</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>        </span><span style=color:#ed9366>.</span><span>init_resource</span><span style=color:#ed9366>::</span><span>&LTRenderAssetMeasurements&LTA>>()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(PreUpdate</span><span style=color:#61676ccc>, </span><span>add_render_asset_measurement</span><span style=color:#ed9366>::</span><span>&LTA>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>        </span><span style=color:#fa6e32>if let </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(render_app) </span><span style=color:#ed9366>=</span><span> app</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_sub_app_mut</span><span>(RenderApp) {
</span><span>            render_app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(ExtractSchedule</span><span style=color:#61676ccc>, </span><span>measure_render_asset</span><span style=color:#ed9366>::</span><span>&LTA>)</span><span style=color:#61676ccc>;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><h3 id=release-content-release-notes-render-assets-diagnostics-md-48-0><code>release-content/release-notes/render-assets-diagnostics.md</code> (+48/-0)</h3><p>This new file contains comprehensive release notes explaining the new diagnostic capabilities and providing usage examples.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_diagnostic/latest/bevy_diagnostic/ target=_blank>Bevy Diagnostics System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_render/latest/bevy_render/render_asset/index.html target=_blank>Bevy Render Assets Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ecs-intro/#system-scheduling target=_blank>Bevy ECS System Scheduling</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/sync/atomic/ target=_blank>Atomic Operations in Rust</a></ul><h1 id=full-code-diff>Full Code Diff</h1><p><em>(Provided in the original request)</em></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_19311.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>