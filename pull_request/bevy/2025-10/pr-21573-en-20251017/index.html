<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21573 Make BindGroupLayout label non-optional
        
    </title><meta content="#21573 Make BindGroupLayout label non-optional" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-17</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21573-zh-cn-20251017>中文</a></div></div><div class=pr-content><h1 id=make-bindgrouplayout-label-non-optional>Make BindGroupLayout label non-optional</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Make BindGroupLayout label non-optional<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21573<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, C-Code-Quality, S-Ready-For-Final-Review, X-Uncontroversial<li><strong>Created</strong>: 2025-10-17T04:38:56Z<li><strong>Merged</strong>: 2025-10-17T17:00:53Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Always have labels on bindgroups</ul><h2 id=solution>Solution</h2><ul><li>Make it not Option</ul><h2 id=testing>Testing</h2><ul><li>ci</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a code quality issue in Bevy’s rendering system by making bind group layout labels mandatory rather than optional. The change simplifies the API and ensures consistent debugging information across the graphics pipeline.<p>The problem stemmed from the <code>BindGroupLayoutDescriptor</code> struct having an optional label field. In graphics programming, labels are crucial for debugging - they appear in GPU debuggers and performance profilers, helping developers identify resources during runtime. When labels were optional, some bind groups could end up without proper identification, making debugging more difficult.<p>The solution approach was straightforward: remove the <code>Option</code> wrapper from the label field and update all implementations to provide a label. This required changes across multiple areas of the codebase:<ol><li>The core <code>BindGroupLayoutDescriptor</code> struct now requires a label<li>The <code>AsBindGroup</code> trait’s <code>label()</code> method now returns <code>&'static str</code> instead of <code>Option<&'static str></code><li>All manual implementations of <code>AsBindGroup</code> must now provide a label<li>The derive macro for <code>AsBindGroup</code> was updated to generate the new signature</ol><p>The implementation demonstrates good software engineering practices. By making labels mandatory, the API becomes more consistent and eliminates potential edge cases where developers might forget to provide labels. The change also simplifies the code by removing numerous <code>Option</code> checks and unwraps.<p>Here’s the key change in the <code>AsBindGroup</code> trait:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>label</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>label</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span style=color:#61676ccc>;
</span></code></pre><p>The technical insight here is that bind group labels serve an important diagnostic purpose in graphics applications. During development and profiling, being able to identify specific bind groups in GPU debuggers is essential for optimizing performance and debugging rendering issues. Making labels mandatory ensures this diagnostic information is always available.<p>The impact of this change is primarily on code quality and developer experience. While it introduces a breaking change for manual <code>AsBindGroup</code> implementations, the migration is straightforward - developers simply need to implement the <code>label()</code> method with an appropriate string. The PR includes a comprehensive migration guide to assist with this transition.<p>One notable aspect of the implementation is how it handles the <code>ExtendedMaterial</code> type, which needed to delegate the label to its extension component:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>label</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str </span><span>{
</span><span>    E</span><span style=color:#ed9366>::</span><span>label()
</span><span>}
</span></code></pre><p>This demonstrates proper composition patterns where the extended material inherits behavior from its extension component.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[AsBindGroup Trait] --> B[BindGroupLayoutDescriptor]
</span><span>    B --> C[PipelineCache]
</span><span>    C --> D[RenderDevice]
</span><span>    E[Manual Implementations] --> A
</span><span>    F[Derive Macro] --> A
</span><span>    G[ExtendedMaterial] --> A
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-render-src-render-resource-bind-group-rs-2-5><code>crates/bevy_render/src/render_resource/bind_group.rs</code> (+2/-5)</h3><p>This file contains the core <code>AsBindGroup</code> trait definition. The key change was making the <code>label()</code> method return a mandatory string instead of an optional:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>label</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>label</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-render-src-render-resource-pipeline-rs-4-4><code>crates/bevy_render/src/render_resource/pipeline.rs</code> (+4/-4)</h3><p>The <code>BindGroupLayoutDescriptor</code> struct was updated to require a label:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BindGroupLayoutDescriptor </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>label</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTCow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>BindGroupLayoutDescriptor </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>label</span><span style=color:#61676ccc>: </span><span>Cow<</span><span style=color:#fa6e32>'static</span><span>, </span><span style=color:#fa6e32>str</span><span>>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=crates-bevy-render-macros-src-as-bind-group-rs-2-2><code>crates/bevy_render/macros/src/as_bind_group.rs</code> (+2/-2)</h3><p>The derive macro for <code>AsBindGroup</code> was updated to generate the new method signature:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>label</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>> {
</span><span>    </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#ed9366>#</span><span>struct_name_literal)
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>label</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str </span><span>{
</span><span>    </span><span style=color:#ed9366>#</span><span>struct_name_literal
</span><span>}
</span></code></pre><h3 id=crates-bevy-pbr-src-material-bind-groups-rs-8-8><code>crates/bevy_pbr/src/material_bind_groups.rs</code> (+8/-8)</h3><p>This file contains material bind group allocators that needed updates to handle the mandatory labels:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Multiple changes from Option<&'static str> to &'static str
</span><span style=color:#abb0b6;font-style:italic>// For example:
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>MaterialBindGroupBindlessAllocator </span><span>{
</span><span>    label</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>'static str</span><span>,  </span><span style=color:#abb0b6;font-style:italic>// Was Option<&'static str>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ...
</span><span>}
</span></code></pre><h3 id=examples-3d-manual-material-rs-7-1><code>examples/3d/manual_material.rs</code> (+7/-1)</h3><p>The example was updated to provide a label for the material allocator:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>MaterialBindGroupAllocator</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ed9366>&</span><span>render_device</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>,</span><span> bind_group_layout</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>None</span><span>)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>MaterialBindGroupAllocator</span><span style=color:#ed9366>::</span><span>new(
</span><span>    </span><span style=color:#ed9366>&</span><span>render_device</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#86b300>"image_material_allocator"</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>,
</span><span>    bind_group_layout</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#55b4d4;font-style:italic>None</span><span style=color:#61676ccc>,
</span><span>)
</span></code></pre><h3 id=release-content-migration-guides-bindgroup-labels-mandatory-md-14-0><code>release-content/migration-guides/bindgroup-labels-mandatory.md</code> (+14/-0)</h3><p>A new migration guide was added to help developers update their code:<pre class=language-markdown data-lang=markdown style=color:#61676c;background-color:#fafafa><code class=language-markdown data-lang=markdown><span>In previous versions of Bevy, the </span><span style=color:#ed9366;background-color:#61676c10>`label`</span><span> of a </span><span style=color:#ed9366;background-color:#61676c10>`BindGroupLayout`</span><span> was optional. This practically only applies when implementing </span><span style=color:#ed9366;background-color:#61676c10>`AsBindGroup`</span><span> manually without the </span><span style=color:#ed9366;background-color:#61676c10>`AsBindGroup`</span><span> derive.
</span><span>
</span><span>If you were previously omitting the </span><span style=color:#ed9366;background-color:#61676c10>`label`</span><span> implementation from a </span><span style=color:#ed9366;background-color:#61676c10>`impl AsBindGroup`</span><span>, you now must implement it:
</span><span>
</span><span>```</span><span style=color:#ff8f40>rust
</span><span style=color:#fa6e32;background-color:#61676c07>fn </span><span style=color:#f29718;background-color:#61676c07>label</span><span style=color:#61676c;background-color:#61676c07>() </span><span style=color:#61676ccc;background-color:#61676c07>-> </span><span style=color:#ed9366;background-color:#61676c07>&</span><span style=color:#fa6e32;background-color:#61676c07>'static str </span><span style=color:#61676c;background-color:#61676c07>{
</span><span style=color:#61676c;background-color:#61676c07>    </span><span style=color:#86b300;background-color:#61676c07>"my label"
</span><span style=color:#61676c;background-color:#61676c07>}
</span></code></pre><pre style=color:#61676c;background-color:#fafafa><code><span>
</span><span>## Further Reading
</span><span>
</span><span>- [Bevy AsBindGroup Documentation](https://docs.rs/bevy/latest/bevy/render/render_resource/trait.AsBindGroup.html)
</span><span>- [WGSL Bind Groups Specification](https://gpuweb.github.io/gpuweb/wgsl/#bind-groups)
</span><span>- [Bevy Migration Guides](https://bevyengine.org/learn/migration-guides/)</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21573.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>