<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21667 Text strikethrough and underline colors
        
    </title><meta content="#21667 Text strikethrough and underline colors" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21667-zh-cn-20251029>中文</a></div></div><div class=pr-content><h1 id=text-strikethrough-and-underline-colors>Text strikethrough and underline colors</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Text strikethrough and underline colors<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21667<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, A-UI, S-Ready-For-Final-Review, M-Release-Note, X-Uncontroversial, D-Straightforward<li><strong>Created</strong>: 2025-10-27T12:13:24Z<li><strong>Merged</strong>: 2025-10-29T19:56:19Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Allows users to override <code>TextColor</code> and use a custom color for underline and strikethrough text decorations.<h2 id=solution>Solution</h2><p>New components <code>UnderlineColor</code> and <code>StrikethroughColor</code>. Add them to a text entity with <code>Underline</code> or <code>Strikethrough</code>, respectively, to use a custom color for the lines.<h1></h1><p>This could just be an optional color field on <code>Underline</code> or <code>Strikethrough</code>, that would be fine. I spent a while going back and fourth about it. The main reasons why I went with a separate component:<ul><li>The same color is almost always used for both text and its decorations. Overriding <code>TextColor</code> is going to be rare.<li>Once we have some sort of global or propagated text style support, underline and strikethrough colors probably won’t be set per entity.</ul><p>The single component approach has some advantages too. Discoverability, obviously. Also compare:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>(
</span><span>    Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>"Hello"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    Underline</span><span style=color:#61676ccc>,
</span><span>    UnderlineColor(</span><span style=color:#ff8f40>RED</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())
</span><span>)
</span></code></pre><p>with<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>(
</span><span>    Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>"Hello"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    Underline</span><span style=color:#ed9366>::</span><span>color(</span><span style=color:#ff8f40>RED</span><span>)</span><span style=color:#61676ccc>,
</span><span>)
</span></code></pre><p>which seems clearly nicer. If it weren’t for the planned non-entity-local text styling support, I’d lean more towards the single component approach.<h2 id=testing>Testing</h2><p>Added a few color overrides to this example:<pre style=color:#61676c;background-color:#fafafa><code><span>cargo run --example strikethrough
</span></code></pre><h2 id=showcase>Showcase</h2><img alt=strike-under-color height=1127 src=https://github.com/user-attachments/assets/83664f95-0926-4ccb-81e4-a3059cd2ccf3 width=1924><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important gap in Bevy’s text rendering system: the inability to customize colors for text decorations like underline and strikethrough independently from the main text color. Prior to this change, these decorations always inherited the <code>TextColor</code> of the parent text entity, which limited design flexibility for UI elements requiring distinct decorative styling.<p>The implementation follows Bevy’s established component-based architecture pattern. Rather than modifying the existing <code>Underline</code> and <code>Strikethrough</code> components, the developer chose to introduce two new dedicated color components: <code>UnderlineColor</code> and <code>StrikethroughColor</code>. This design decision reflects careful consideration of both current needs and future architectural plans.<p>The core technical challenge was modifying the text extraction systems to query for these optional color components and use them when available. The solution maintains backward compatibility - if no custom decoration color is specified, the system falls back to using the existing <code>TextColor</code>, ensuring existing code continues to work unchanged.<p>The implementation required coordinated changes across both 2D sprite text rendering and UI text rendering systems. In both cases, the extraction queries were extended to include optional references to the new color components, and the rendering logic was updated to prefer these custom colors when present.<p>The developer explicitly considered an alternative approach: adding optional color fields directly to the <code>Underline</code> and <code>Strikethrough</code> components. While this would have provided a cleaner API with methods like <code>Underline::color(RED)</code>, the separate component approach was chosen for two key reasons. First, it aligns with the observation that most use cases don’t require different colors for text and decorations. Second, it anticipates future text styling systems where decoration colors might be set globally rather than per-entity.<p>The changes are implemented consistently across the codebase. Both new components follow the same pattern as existing color components like <code>TextColor</code>, implementing <code>Deref</code>, <code>DerefMut</code>, <code>Reflect</code>, and supporting conversion from any type that implements <code>Into&LTColor></code>. This consistency makes the API intuitive for developers already familiar with Bevy’s text system.<p>Testing was straightforward - the existing strikethrough example was extended to demonstrate the new functionality with various color combinations, providing both visual verification and documentation for users.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[Text Entity] --> B[TextColor]
</span><span>    A --> C[Underline]
</span><span>    A --> D[Strikethrough]
</span><span>    A --> E[UnderlineColor]
</span><span>    A --> F[StrikethroughColor]
</span><span>    B --> G[Rendering System]
</span><span>    C --> G
</span><span>    D --> G
</span><span>    E --> G
</span><span>    F --> G
</span><span>    G --> H[Final Render]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-text-rs-34-0><code>crates/bevy_text/src/text.rs</code> (+34/-0)</h3><p>This file defines the new color components for text decorations.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New component definition
</span><span style=color:#abb0b6;font-style:italic>/// Color for the text's strikethrough. If this component is not present, its `TextColor` will be used.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Deref</span><span style=color:#61676ccc>,</span><span> DerefMut</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>StrikethroughColor</span><span>(pub Color)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// New component definition  
</span><span style=color:#abb0b6;font-style:italic>/// Color for the text's underline. If this component is not present, its `TextColor` will be used.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Copy</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Deref</span><span style=color:#61676ccc>,</span><span> DerefMut</span><span style=color:#61676ccc>,</span><span> Reflect</span><span style=color:#61676ccc>,</span><span> PartialEq)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>reflect</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> PartialEq</span><span style=color:#61676ccc>,</span><span> Clone)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>UnderlineColor</span><span>(pub Color)</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=crates-bevy-sprite-render-src-text2d-mod-rs-29-8><code>crates/bevy_sprite_render/src/text2d/mod.rs</code> (+29/-8)</h3><p>Updated the 2D text extraction system to support custom decoration colors.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Updated query to include optional color components
</span><span>decoration_query</span><span style=color:#61676ccc>: </span><span>Extract<
</span><span>    Query<(
</span><span>        </span><span style=color:#ed9366>&</span><span>TextColor,
</span><span>        Has&LTStrikethrough>,
</span><span>        Has&LTUnderline>,
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>StrikethroughColor>,
</span><span>        </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>UnderlineColor>,
</span><span>    )>,
</span><span>>
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Color selection logic for strikethrough
</span><span style=color:#fa6e32>if</span><span> has_strike_through {
</span><span>    </span><span style=color:#fa6e32>let</span><span> color </span><span style=color:#ed9366>=</span><span> maybe_strikethrough_color
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ff8f40>c</span><span>| c</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or</span><span>(text_color</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>to_linear</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... use custom color
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-render-src-lib-rs-22-6><code>crates/bevy_ui_render/src/lib.rs</code> (+22/-6)</h3><p>Updated the UI text rendering system with similar changes.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Updated UI text decoration query
</span><span style=color:#fa6e32>let </span><span style=color:#55b4d4;font-style:italic>Ok</span><span>((
</span><span>    (text_background_color</span><span style=color:#61676ccc>,</span><span> maybe_strikethrough</span><span style=color:#61676ccc>,</span><span> maybe_underline)</span><span style=color:#61676ccc>,
</span><span>    text_color</span><span style=color:#61676ccc>,
</span><span>    maybe_strikethrough_color</span><span style=color:#61676ccc>,
</span><span>    maybe_underline_color</span><span style=color:#61676ccc>,
</span><span>)) </span><span style=color:#ed9366>=</span><span> text_background_colors_query</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(section_entity)
</span></code></pre><h3 id=examples-ui-strikethrough-rs-6-2><code>examples/ui/strikethrough.rs</code> (+6/-2)</h3><p>Enhanced the example to demonstrate the new functionality.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Example usage with custom colors
</span><span>(
</span><span>    Text</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#86b300>"struck</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>struckstruck</span><span style=color:#4cbf99>\n</span><span style=color:#86b300>struckstuckstruck"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    Strikethrough</span><span style=color:#61676ccc>,
</span><span>    StrikethroughColor(</span><span style=color:#ff8f40>RED</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())</span><span style=color:#61676ccc>,
</span><span>    TextBackgroundColor(</span><span style=color:#ff8f40>GREEN</span><span style=color:#ed9366>.</span><span style=color:#f07171>into</span><span>())</span><span style=color:#61676ccc>,
</span><span>)</span><span style=color:#61676ccc>,
</span></code></pre><h3 id=crates-bevy-text-src-lib-rs-2-2><code>crates/bevy_text/src/lib.rs</code> (+2/-2)</h3><p>Added the new components to the prelude for easy access.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_text/latest/bevy_text/ target=_blank>Bevy Text Component Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ui/ target=_blank>Bevy UI System Overview</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/features/ecs/ target=_blank>Component-Based Architecture Patterns in Bevy</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21667.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>