<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21367 Reexport `Entry` from `indexmap` crate
        
    </title><meta content="#21367 Reexport `Entry` from `indexmap` crate" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-03</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21367-zh-cn-20251003>中文</a></div></div><div class=pr-content><h1 id=reexport-entry-from-indexmap-crate>Reexport <code>Entry</code> from <code>indexmap</code> crate</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Reexport <code>Entry</code> from <code>indexmap</code> crate<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21367<li><strong>Author</strong>: VasanthakumarV<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, C-Usability, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-10-03T18:50:58Z<li><strong>Merged</strong>: 2025-10-03T20:40:17Z<li><strong>Merged By</strong>: james7132</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Fixes #21275<p>Pasting the content of the Issue to provide context,<blockquote><p>bevy_ecs::entity::EntityIndexMap has the entry() method because it derefs to indexmap::IndexMap, but it doesn’t re-export IndexMap::Entry so I have to import the indexmap crate manually.</blockquote><blockquote><p>It would be convenient to re-export indexmap::Entry in bevy_ecs::entity::index_map</blockquote><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a straightforward but important ergonomic issue in the Bevy ECS module. The problem stemmed from how <code>EntityIndexMap</code> exposed functionality from its underlying <code>indexmap::IndexMap</code> dependency without providing full access to the associated types.<p>The core issue was that <code>EntityIndexMap</code> implements <code>Deref</code> to <code>IndexMap</code>, which means users could call methods like <code>entry()</code> that return <code>indexmap::map::Entry</code> types. However, because this <code>Entry</code> type wasn’t re-exported in Bevy’s public API, developers had to manually import the <code>indexmap</code> crate to work with the return types of methods they were calling on Bevy’s own types.<p>This created an awkward developer experience where code that appeared to only depend on Bevy’s API suddenly required knowledge of and direct dependency on an internal implementation detail. The problem is particularly noticeable because the <code>Entry</code> API pattern is commonly used for efficient map operations where you want to perform conditional insertions or updates.<p>The solution implemented here is a simple but effective one-line change: adding a public re-export of <code>indexmap::map::Entry</code> in the same module where <code>EntityIndexMap</code> is defined. This follows established Rust patterns for wrapper types - when you expose methods that return types from internal dependencies, you should also expose those types to maintain API coherence.<p>From a technical perspective, this change doesn’t affect functionality but significantly improves API usability. The <code>Entry</code> type enables efficient map operations by providing an API that avoids multiple lookups. For example, with this re-export, developers can now write:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>bevy_ecs</span><span style=color:#ed9366>::</span><span>entity</span><span style=color:#ed9366>::</span><span>index_map</span><span style=color:#ed9366>::</span><span>Entry</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>match</span><span> map</span><span style=color:#ed9366>.</span><span style=color:#f07171>entry</span><span>(entity) {
</span><span>    Entry</span><span style=color:#ed9366>::</span><span>Occupied(</span><span style=color:#fa6e32>mut</span><span> entry) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        </span><span style=color:#ed9366>*</span><span>entry</span><span style=color:#ed9366>.</span><span style=color:#f07171>get_mut</span><span>() </span><span style=color:#ed9366>=</span><span> new_value</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>    Entry</span><span style=color:#ed9366>::</span><span>Vacant(entry) </span><span style=color:#ed9366>=> </span><span>{
</span><span>        entry</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(initial_value)</span><span style=color:#61676ccc>;
</span><span>    }
</span><span>}
</span></code></pre><p>Without having to add <code>indexmap</code> as an explicit dependency or import path.<p>This change demonstrates good API design principles - when you wrap a third-party type and expose its methods, you should also expose the types those methods return. It eliminates an unnecessary friction point for developers working with Bevy’s ECS system and maintains the framework’s goal of providing a cohesive, well-integrated API.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_ecs::entity::index_map] --> B[EntityIndexMap]
</span><span>    A --> C[Entry type]
</span><span>    B --> D[Derefs to indexmap::IndexMap]
</span><span>    D --> E[Has entry() method]
</span><span>    E --> C
</span><span>    C --> F[Now accessible without external imports]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_ecs/src/entity/index_map.rs</code></strong><p>This file contains the definition of <code>EntityIndexMap</code> and related types. The change adds a single re-export line:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: No re-export of Entry type
</span><span style=color:#fa6e32>use </span><span>indexmap</span><span style=color:#ed9366>::</span><span>map</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#61676ccc>,</span><span> IndexMap</span><span style=color:#61676ccc>,</span><span> IntoValues</span><span style=color:#61676ccc>,</span><span> ValuesMut}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Entry type is now publicly re-exported
</span><span style=color:#fa6e32>pub use </span><span>indexmap</span><span style=color:#ed9366>::</span><span>map</span><span style=color:#ed9366>::</span><span>Entry</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>indexmap</span><span style=color:#ed9366>::</span><span>map</span><span style=color:#ed9366>::</span><span>{</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#61676ccc>,</span><span> IndexMap</span><span style=color:#61676ccc>,</span><span> IntoValues</span><span style=color:#61676ccc>,</span><span> ValuesMut}</span><span style=color:#61676ccc>;
</span></code></pre><p>The addition of <code>pub use indexmap::map::Entry;</code> makes the <code>Entry</code> type available at the module level, allowing users to import it directly from <code>bevy_ecs::entity::index_map</code> rather than needing to import from the <code>indexmap</code> crate directly.<p>This change is minimal but significant - it maintains the existing functionality while improving the developer experience by providing a more complete and self-contained API.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://rust-lang.github.io/api-guidelines/necessities.html#c-reexport target=_blank>Rust API Guidelines - Re-export</a> - Guidelines on when and how to re-export types<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/indexmap/latest/indexmap/map/struct.Entry.html target=_blank>IndexMap Entry API</a> - Documentation for the Entry type and its usage patterns<li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/entity/struct.EntityIndexMap.html target=_blank>Bevy ECS EntityIndexMap</a> - Documentation for the EntityIndexMap type<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/ops/trait.Deref.html target=_blank>Rust Deref trait</a> - Understanding how Deref enables method delegation</ul><h1 id=full-code-diff>Full Code Diff</h1><pre class=language-diff data-lang=diff style=color:#61676c;background-color:#fafafa><code class=language-diff data-lang=diff><span>diff --git a/crates/bevy_ecs/src/entity/index_map.rs b/crates/bevy_ecs/src/entity/index_map.rs
</span><span>index 6f6cd1bb47af3..9067b12ca28b2 100644
</span><span style=color:#c594c5>--- a/crates/bevy_ecs/src/entity/index_map.rs
</span><span style=color:#c594c5>+++ b/crates/bevy_ecs/src/entity/index_map.rs
</span><span style=color:#c594c5>@@ -17,6 +17,7 @@ </span><span style=color:#399ee6>use core::{
</span><span> 
</span><span> #[cfg(feature = "bevy_reflect")]
</span><span> use bevy_reflect::Reflect;
</span><span style=color:#86b300>+pub use indexmap::map::Entry;
</span><span> use indexmap::map::{self, IndexMap, IntoValues, ValuesMut};
</span><span> 
</span><span> use super::{Entity, EntityEquivalent, EntityHash, EntitySetIterator};
</span></code></pre></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21367.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>