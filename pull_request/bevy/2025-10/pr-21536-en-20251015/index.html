<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21536 bevy_gizmos_render
        
    </title><meta content="#21536 bevy_gizmos_render" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-15</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21536-zh-cn-20251015>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>bevy_gizmos_render<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: bevy_gizmos_render<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21536<li><strong>Author</strong>: atlv24<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-Rendering, S-Ready-For-Final-Review, A-Gizmos, M-Needs-Release-Note, D-Modest<li><strong>Created</strong>: 2025-10-14T00:26:11Z<li><strong>Merged</strong>: 2025-10-14T22:06:21Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>make gizmos render agnostic</ul><h2 id=solution>Solution</h2><ul><li>split crate</ul><h2 id=testing>Testing</h2><ul><li>ci and a few examples</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a fundamental architectural concern in the Bevy engine’s gizmo system. The core issue was that the <code>bevy_gizmos</code> crate contained both the immediate-mode gizmo drawing API and the rendering implementation, creating tight coupling between the gizmo abstraction and the specific rendering backend.<p>The problem manifested in several ways. First, the <code>bevy_gizmos</code> crate had complex conditional compilation with features like <code>bevy_render</code>, <code>bevy_pbr</code>, and <code>bevy_sprite_render</code>, making it difficult to use gizmos in contexts without a full rendering setup. Second, this coupling limited the reusability of the gizmo system in different rendering contexts and made the codebase harder to maintain.<p>The solution approach was straightforward but impactful: split the monolithic <code>bevy_gizmos</code> crate into two separate crates. The new architecture separates concerns cleanly:<ul><li><code>bevy_gizmos</code>: Contains the core gizmo API, configuration, and immediate-mode drawing functionality<li><code>bevy_gizmos_render</code>: Handles all rendering-specific implementation details</ul><p>This architectural change required careful refactoring. The implementation involved moving approximately 567 lines of rendering code from <code>bevy_gizmos</code> to the new <code>bevy_gizmos_render</code> crate. This included:<ul><li>Rendering pipelines for 2D and 3D gizmos<li>GPU buffer management and shader handling<li>Render command implementations<li>Vertex buffer layout definitions</ul><p>The key technical insight was identifying which components were truly rendering-specific versus core gizmo functionality. For example, the <code>GizmoAsset</code> and configuration structures remained in the core crate, while the GPU-specific implementations like <code>GpuLineGizmo</code> and rendering pipelines moved to the render crate.<p>This separation brings several concrete improvements. It makes the core gizmo system render-agnostic, allowing it to be used in contexts without Bevy’s renderer. The codebase becomes more maintainable with clearer separation of concerns. Additionally, the change enables future rendering backends to implement gizmo rendering without modifying the core gizmo API.<p>The migration was handled carefully to maintain backward compatibility. The existing <code>bevy_gizmos</code> feature now depends on the new <code>bevy_gizmos_render</code> feature, ensuring that existing code continues to work without changes. A migration guide was added to help users who were using <code>default-features = false</code> with custom rendering setups.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[bevy_gizmos] --> B[Core Gizmo API]
</span><span>    A --> C[Gizmo Configuration]
</span><span>    A --> D[Immediate-mode Drawing]
</span><span>    
</span><span>    E[bevy_gizmos_render] --> F[Rendering Pipelines]
</span><span>    E --> G[GPU Buffer Management]
</span><span>    E --> H[Shader Handling]
</span><span>    E --> I[Render Commands]
</span><span>    
</span><span>    B --> E
</span><span>    C --> E
</span><span>    D --> E
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-gizmos-src-lib-rs-22-567><code>crates/bevy_gizmos/src/lib.rs</code> (+22/-567)</h3><p>This file was significantly refactored to remove all rendering-specific code. The core gizmo API and asset management remain, while rendering systems, pipelines, and GPU buffer management were extracted.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Rendering systems and pipelines were defined here
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_render"</span><span>)]
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>pipeline_2d</span><span style=color:#61676ccc>;
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_render"</span><span>)]
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>pipeline_3d</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Only core gizmo functionality remains
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>aabb</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>arcs</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>pub mod </span><span style=color:#399ee6>arrows</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... other core modules
</span></code></pre><h3 id=crates-bevy-gizmos-render-src-lib-rs-547-0><code>crates/bevy_gizmos_render/src/lib.rs</code> (+547/-0)</h3><p>This new file contains all the rendering functionality extracted from the main gizmos crate, including render pipelines, GPU buffer management, and shader handling.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// The new render plugin that handles all rendering setup
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GizmoRenderPlugin</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>Plugin </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>GizmoRenderPlugin </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>build</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>, </span><span style=color:#ff8f40>app</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> App) {
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// Rendering-specific initialization
</span><span>        app</span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(UniformComponentPlugin</span><span style=color:#ed9366>::</span><span>&LTLineGizmoUniform></span><span style=color:#ed9366>::</span><span>default())
</span><span>            </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(RenderAssetPlugin</span><span style=color:#ed9366>::</span><span>&LTGpuLineGizmo></span><span style=color:#ed9366>::</span><span>default())</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#abb0b6;font-style:italic>// ... more rendering setup
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-gizmos-src-config-rs-structural-changes><code>crates/bevy_gizmos/src/config.rs</code> (Structural changes)</h3><p>The configuration system was refactored to be render-agnostic, removing conditional compilation for rendering features.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Conditional compilation for render features
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(</span><span style=color:#f29718>all</span><span>(
</span><span>    feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_render"</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>any</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_pbr"</span><span style=color:#61676ccc>,</span><span> feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_sprite_render"</span><span>)
</span><span>))]
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>GizmoMeshConfig </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>line_perspective</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other fields
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Configuration is always available and public
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>GizmoMeshConfig </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>line_perspective</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... other fields now public
</span><span>}
</span></code></pre><h3 id=crates-bevy-gizmos-src-gizmos-rs-api-exposure-changes><code>crates/bevy_gizmos/src/gizmos.rs</code> (API exposure changes)</h3><p>Internal buffer fields were made public to allow the render crate to access them.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Private internal fields
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) list_positions</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTVec3></span><span style=color:#61676ccc>,
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) list_colors</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTLinearRgba></span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Public fields for render crate access
</span><span style=color:#fa6e32>pub</span><span> list_positions</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTVec3></span><span style=color:#61676ccc>,
</span><span style=color:#fa6e32>pub</span><span> list_colors</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Vec</span><span>&LTLinearRgba></span><span style=color:#61676ccc>,
</span></code></pre><h3 id=crates-bevy-gizmos-render-src-retained-rs-76-0><code>crates/bevy_gizmos_render/src/retained.rs</code> (+76/-0)</h3><p>This file contains the rendering extraction logic for retained gizmos, moved from the original crate.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>extract_linegizmos</span><span>(
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>previous_len</span><span style=color:#61676ccc>: </span><span>Local<</span><span style=color:#fa6e32>usize</span><span>>,
</span><span>    </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Extract&LTQuery<(Entity, </span><span style=color:#ed9366>&</span><span>Gizmo, </span><span style=color:#ed9366>&</span><span>GlobalTransform, </span><span style=color:#55b4d4;font-style:italic>Option</span><span><</span><span style=color:#ed9366>&</span><span>RenderLayers>)>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Rendering extraction logic for retained gizmos
</span><span>}
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/getting-started/setup/ target=_blank>Bevy Engine Architecture</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/ARCHITECTURE.md target=_blank>Rendering Abstraction Patterns</a><li><a rel="noopener nofollow noreferrer" href=https://gpuweb.github.io/gpuweb/wgsl/ target=_blank>WGSL Shader Language</a><li><a rel="noopener nofollow noreferrer" href=https://en.wikipedia.org/wiki/Entity_component_system target=_blank>Entity Component System Pattern</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21536.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>