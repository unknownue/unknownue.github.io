<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21660 Don't use `[!Default; 0]: Default` impl
        
    </title><meta content="#21660 Don't use `[!Default; 0]: Default` impl" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-26</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21660-zh-cn-20251026>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Don’t use <code>[!Default; 0]: Default</code> impl<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Don’t use <code>[!Default; 0]: Default</code> impl<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21660<li><strong>Author</strong>: WaffleLapkin<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-ECS, C-Code-Quality, P-High, S-Ready-For-Final-Review<li><strong>Created</strong>: 2025-10-26T18:46:20Z<li><strong>Merged</strong>: 2025-10-26T21:05:25Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>See https://github.com/rust-lang/rust/pull/145457, we want to remove unconditional <code>[T; 0]: Default</code> impl. That would be a breaking change breaking <code>bevy_ecs</code> and (a test of) <code>bevy_camera</code>.</ul><h2 id=solution>Solution</h2><ul><li>Replace <code><[T; 0]>::default()</code> calls with <code>[]</code></ul><h2 id=testing>Testing</h2><ul><li>It compiles, the <code><[T; 0]>::default()</code> is equivalent to <code>[]</code>, no additional testing required</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a forward-looking compatibility issue stemming from an upstream change in the Rust compiler. The problem originated from a Rust language proposal to remove the unconditional <code>Default</code> implementation for zero-length arrays (<code>[T; 0]</code>). While this change hadn’t landed yet, the Bevy team proactively addressed potential breakage by eliminating dependencies on this implementation.<p>The core issue was that two locations in the Bevy codebase were explicitly calling <code><[T; 0]>::default()</code>, which would fail to compile if Rust removed the blanket <code>Default</code> implementation for zero-length arrays. The solution was straightforward: replace these calls with the array literal <code>[]</code>, which creates an empty array without relying on the <code>Default</code> trait.<p>In the camera primitives module, a test was using <code><[Vec3; 0]>::default()</code> to create an empty array for testing the <code>Aabb::enclosing</code> method’s behavior with no points. The fix replaced this with <code>[] as [Vec3; 0]</code>, using type annotation to specify the array type while using the literal syntax.<p>Similarly, in the ECS module’s unique array implementation, the <code>Default</code> implementation for <code>UniqueEntityEquivalentArray&LTT, 0></code> was using <code>Self(Default::default())</code> which relied on the array’s <code>Default</code> implementation. This was changed to <code>Self([])</code>, directly constructing the empty array.<p>The engineering approach here demonstrates good proactive maintenance practices. Rather than waiting for the breaking change to occur, the team addressed the issue preemptively. The changes are minimal and semantically equivalent - both <code><[T; 0]>::default()</code> and <code>[]</code> produce the same empty array value, but the latter doesn’t depend on the potentially-removed trait implementation.<p>From a technical perspective, this change highlights an important Rust pattern: when working with zero-length arrays, using the array literal syntax is more direct and avoids trait dependencies. The fix maintains the same behavior while improving forward compatibility.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Rust Language Change] --> B[Remove [T;0]: Default impl]
</span><span>    B --> C[Bevy Code Impact]
</span><span>    C --> D[bevy_camera Test]
</span><span>    C --> E[bevy_ecs Implementation]
</span><span>    D --> F[Replace with []]
</span><span>    E --> F
</span><span>    F --> G[Forward Compatibility]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-camera-src-primitives-rs-1-1><code>crates/bevy_camera/src/primitives.rs</code> (+1/-1)</h3><p>This file contains a test that was using the deprecated pattern for creating empty arrays.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#f07171>assert_eq!</span><span>(Aabb</span><span style=color:#ed9366>::</span><span>enclosing(</span><span style=color:#ed9366><</span><span>[Vec3</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>0</span><span>]</span><span style=color:#ed9366>>::</span><span>default())</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>None</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#f07171>assert_eq!</span><span>(Aabb</span><span style=color:#ed9366>::</span><span>enclosing([] </span><span style=color:#ed9366>as </span><span>[Vec3</span><span style=color:#61676ccc>; </span><span style=color:#ff8f40>0</span><span>])</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>None</span><span>)</span><span style=color:#61676ccc>;
</span></code></pre><p>The change replaces the trait-based array construction with direct array literal syntax, maintaining the same test behavior.<h3 id=crates-bevy-ecs-src-entity-unique-array-rs-1-1><code>crates/bevy_ecs/src/entity/unique_array.rs</code> (+1/-1)</h3><p>This file contains the core ECS implementation for unique entity arrays.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>impl</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> EntityEquivalent> Default </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>UniqueEntityEquivalentArray</span><span>&LTT, 0> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>default</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span>(</span><span style=color:#55b4d4;font-style:italic>Default</span><span style=color:#ed9366>::</span><span>default())
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>impl</span><span>&LTT</span><span style=color:#61676ccc>:</span><span> EntityEquivalent> Default </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>UniqueEntityEquivalentArray</span><span>&LTT, 0> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>default</span><span>() </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>Self</span><span>([])
</span><span>    }
</span><span>}
</span></code></pre><p>The change modifies the default implementation to use array literal syntax instead of relying on the <code>Default</code> trait for the inner array type.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/rust-lang/rust/pull/145457 target=_blank>Rust PR #145457</a> - The upstream Rust change that motivated this PR<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/primitive.array.html target=_blank>Rust Array Types Documentation</a> - Official documentation for Rust arrays<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/default/trait.Default.html target=_blank>Rust Default Trait</a> - Documentation for the Default trait</ul><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/crates/bevy_camera/src/primitives.rs b/crates/bevy_camera/src/primitives.rs index e7f7526dce6ac..9b1fc41c59c39 100644 — a/crates/bevy_camera/src/primitives.rs +++ b/crates/bevy_camera/src/primitives.rs @@ -652,7 +652,7 @@ mod tests {<pre style=color:#61676c;background-color:#fafafa><code><span> #[test]
</span><span> fn aabb_enclosing() {
</span></code></pre><ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   assert_eq!(Aabb::enclosing(<[Vec3; 0]>::default()), None);
</span></code></pre></ul><ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   assert_eq!(Aabb::enclosing([] as [Vec3; 0]), None);
</span><span>   assert_eq!(
</span><span>       Aabb::enclosing(vec![Vec3::ONE]).unwrap(),
</span><span>       Aabb::from_min_max(Vec3::ONE, Vec3::ONE)
</span></code></pre></ul><p>diff –git a/crates/bevy_ecs/src/entity/unique_array.rs b/crates/bevy_ecs/src/entity/unique_array.rs index 71df33ec5f42c..db6b67bd7af95 100644 — a/crates/bevy_ecs/src/entity/unique_array.rs +++ b/crates/bevy_ecs/src/entity/unique_array.rs @@ -157,7 +157,7 @@ impl&LTT: EntityEquivalent, const N: usize> DerefMut for UniqueEntityEquivalentArr<p>impl&LTT: EntityEquivalent> Default for UniqueEntityEquivalentArray&LTT, 0> { fn default() -> Self {<ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   Self(Default::default())
</span></code></pre></ul><ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   Self([])
</span></code></pre> } }</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21660.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>