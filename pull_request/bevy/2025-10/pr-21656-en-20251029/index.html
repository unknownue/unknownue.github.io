<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21656 `RunGeometry`
        
    </title><meta content="#21656 `RunGeometry`" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-29</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21656-zh-cn-20251029>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p><code>RunGeometry</code><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: <code>RunGeometry</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21656<li><strong>Author</strong>: ickshonpe<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Code-Quality, S-Ready-For-Final-Review, A-Text, D-Straightforward<li><strong>Created</strong>: 2025-10-25T12:28:55Z<li><strong>Merged</strong>: 2025-10-29T21:58:24Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Follow up to the underline and strikethrough PRs:<ul><li>Replace the quintuples stored in <code>TextLayoutInfo::section_geometry</code> with a struct with named fields.<li>Rename <code>TextLayoutInfo::section_geometry</code> because “section” in our terminology implies a one-to-one correspondence with text entities.<li>Add some basic helpers to construct the underline and strikethrough lines.<li>Seperate the thickness values for underline and strikethrough. This is needed for an API that allows users to set custom thicknesses.</ul><h2 id=solution>Solution</h2><ul><li>New struct <code>RunGeometry</code>. <code>RunGeometry</code> holds the bounds and decoration geometry for each text run (a contiguous sequence of glyphs on a line that share text attributes). It has helper methods for placing underline and strikethrough.<li>Rename the <code>section_geometry</code> field to <code>run_geometry</code> and make it a <code>Vec&LTRunGeometry></code><li><code>RunGeometry</code> has seperate <code>underline_thickness</code> and <code>strikethrough_thickness</code> values.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses several technical debt issues in Bevy’s text rendering system that became apparent after implementing underline and strikethrough features. The core problem was that text layout information was stored in unstructured tuples, making the code difficult to understand and maintain.<p>The previous implementation used a <code>Vec<(usize, Rect, f32, f32, f32)></code> to store text geometry data, where each tuple represented a text section’s layout information. This approach had several problems:<ol><li><strong>Poor code readability</strong>: The tuple elements were anonymous, requiring developers to remember what each position represented<li><strong>Inconsistent terminology</strong>: The field name “section_geometry” was misleading because in Bevy’s terminology, a “section” corresponds to a text entity, but the data actually represented “runs” - contiguous glyph sequences on a line with shared attributes<li><strong>Limited extensibility</strong>: The tuple structure made it difficult to add new properties or modify existing ones<li><strong>Code duplication</strong>: Multiple places in the codebase were manually calculating underline and strikethrough positions</ol><p>The solution introduced a new <code>RunGeometry</code> struct that provides named fields and helper methods:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RunGeometry </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>span_index</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>bounds</span><span style=color:#61676ccc>:</span><span> Rect,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>strikethrough_y</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>strikethrough_thickness</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>underline_y</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>underline_thickness</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>}
</span></code></pre><p>This struct includes helper methods like <code>strikethrough_position()</code>, <code>strikethrough_size()</code>, <code>underline_position()</code>, and <code>underline_size()</code> that encapsulate the calculations previously scattered throughout the codebase.<p>The implementation required changes across multiple rendering systems. In the text pipeline, the code that previously pushed tuples was updated to create <code>RunGeometry</code> instances:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>layout_info</span><span style=color:#ed9366>.</span><span>section_geometry</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>((
</span><span>    section</span><span style=color:#61676ccc>,
</span><span>    Rect</span><span style=color:#ed9366>::</span><span>new(start</span><span style=color:#61676ccc>,</span><span> run</span><span style=color:#ed9366>.</span><span>line_top</span><span style=color:#61676ccc>,</span><span> end</span><span style=color:#61676ccc>,</span><span> run</span><span style=color:#ed9366>.</span><span>line_top </span><span style=color:#ed9366>+</span><span> run</span><span style=color:#ed9366>.</span><span>line_height)</span><span style=color:#61676ccc>,
</span><span>    (run</span><span style=color:#ed9366>.</span><span>line_y </span><span style=color:#ed9366>- </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info[section]</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>3</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info[section]</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>4</span><span style=color:#61676ccc>,
</span><span>    (run</span><span style=color:#ed9366>.</span><span>line_y </span><span style=color:#ed9366>- </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info[section]</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>5</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>layout_info</span><span style=color:#ed9366>.</span><span>run_geometry</span><span style=color:#ed9366>.</span><span style=color:#f07171>push</span><span>(RunGeometry {
</span><span>    span_index</span><span style=color:#61676ccc>:</span><span> section</span><span style=color:#61676ccc>,
</span><span>    bounds</span><span style=color:#61676ccc>: </span><span>Rect</span><span style=color:#ed9366>::</span><span>new(start</span><span style=color:#61676ccc>,</span><span> run</span><span style=color:#ed9366>.</span><span>line_top</span><span style=color:#61676ccc>,</span><span> end</span><span style=color:#61676ccc>,</span><span> run</span><span style=color:#ed9366>.</span><span>line_top </span><span style=color:#ed9366>+</span><span> run</span><span style=color:#ed9366>.</span><span>line_height)</span><span style=color:#61676ccc>,
</span><span>    strikethrough_y</span><span style=color:#61676ccc>: </span><span>(run</span><span style=color:#ed9366>.</span><span>line_y </span><span style=color:#ed9366>- </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info[section]</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>3</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>,
</span><span>    strikethrough_thickness</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info[section]</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>4</span><span style=color:#61676ccc>,
</span><span>    underline_y</span><span style=color:#61676ccc>: </span><span>(run</span><span style=color:#ed9366>.</span><span>line_y </span><span style=color:#ed9366>- </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info[section]</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>5</span><span>)</span><span style=color:#ed9366>.</span><span style=color:#f07171>round</span><span>()</span><span style=color:#61676ccc>,
</span><span>    underline_thickness</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>glyph_info[section]</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>4</span><span style=color:#61676ccc>,
</span><span>})</span><span style=color:#61676ccc>;
</span></code></pre><p>One significant technical improvement was the separation of underline and strikethrough thickness values. While they currently use the same value (<code>self.glyph_info[section].4</code>), the struct now provides separate fields, enabling future customization of these values independently.<p>The consumption sites in sprite rendering and UI rendering were updated to use the new helper methods:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>let</span><span> offset </span><span style=color:#ed9366>= </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>center</span><span>()</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span>strikethrough_y </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>0.5 </span><span style=color:#ed9366>*</span><span> stroke)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> custom_size </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(Vec2</span><span style=color:#ed9366>::</span><span>new(rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>,</span><span> stroke))</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> offset </span><span style=color:#ed9366>=</span><span> run</span><span style=color:#ed9366>.</span><span style=color:#f07171>strikethrough_position</span><span>() </span><span style=color:#ed9366>* </span><span>Vec2</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#ff8f40>1.</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1.</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> custom_size </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(run</span><span style=color:#ed9366>.</span><span style=color:#f07171>strikethrough_size</span><span>())</span><span style=color:#61676ccc>;
</span></code></pre><p>This change significantly improves code clarity by replacing manual calculations with descriptive method calls. The helper methods handle the coordinate system transformations and positioning logic consistently across the codebase.<p>The PR also includes a migration guide that explains the conceptual shift from “sections” to “runs” and provides guidance for developers who need to update their code. This is particularly important because the new <code>RunGeometry</code> struct doesn’t include entity IDs directly - developers must use the <code>span_index</code> to look up entities in the <code>ComputedTextBlock</code>.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[TextLayoutInfo] --> B[RunGeometry]
</span><span>    B --> C[Bounds]
</span><span>    B --> D[Strikethrough Data]
</span><span>    B --> E[Underline Data]
</span><span>    D --> F[Position Helper]
</span><span>    D --> G[Size Helper]
</span><span>    E --> H[Position Helper]
</span><span>    E --> I[Size Helper]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-text-src-pipeline-rs-71-18><code>crates/bevy_text/src/pipeline.rs</code> (+71/-18)</h3><p>This file contains the core text layout pipeline where the <code>RunGeometry</code> struct was introduced and the text layout algorithm was updated to use it.<p><strong>Key changes:</strong><ul><li>Introduced the <code>RunGeometry</code> struct with named fields and helper methods<li>Updated the text layout algorithm to create <code>RunGeometry</code> instances instead of tuples<li>Renamed <code>section_geometry</code> field to <code>run_geometry</code></ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New struct definition
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Default</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Reflect)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>RunGeometry </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>span_index</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>usize</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>bounds</span><span style=color:#61676ccc>:</span><span> Rect,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>strikethrough_y</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>strikethrough_thickness</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>underline_y</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>underline_thickness</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Helper methods implementation
</span><span style=color:#fa6e32>impl </span><span style=color:#399ee6>RunGeometry </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>strikethrough_position</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Vec2 {
</span><span>        Vec2</span><span style=color:#ed9366>::</span><span>new(
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>bounds</span><span style=color:#ed9366>.</span><span style=color:#f07171>center</span><span>()</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>,
</span><span>            </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>strikethrough_y </span><span style=color:#ed9366>+ </span><span style=color:#ff8f40>0.5 </span><span style=color:#ed9366>* </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>strikethrough_thickness</span><span style=color:#61676ccc>,
</span><span>        )
</span><span>    }
</span><span>    
</span><span>    </span><span style=color:#fa6e32>pub fn </span><span style=color:#f29718>strikethrough_size</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-></span><span> Vec2 {
</span><span>        Vec2</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>bounds</span><span style=color:#ed9366>.</span><span style=color:#f07171>size</span><span>()</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>strikethrough_thickness)
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ui-render-src-lib-rs-14-33><code>crates/bevy_ui_render/src/lib.rs</code> (+14/-33)</h3><p>This file handles UI text rendering and was updated to use the new <code>RunGeometry</code> helper methods.<p><strong>Key changes:</strong><ul><li>Replaced manual calculations with <code>RunGeometry</code> helper methods<li>Simplified offset and size calculations for text decorations</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>transform</span><span style=color:#61676ccc>:</span><span> node_transform </span><span style=color:#ed9366>* </span><span>Affine2</span><span style=color:#ed9366>::</span><span>from_translation(Vec2</span><span style=color:#ed9366>::</span><span>new(
</span><span>    rect</span><span style=color:#ed9366>.</span><span style=color:#f07171>center</span><span>()</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>,
</span><span>    strikethrough_y </span><span style=color:#ed9366>+ </span><span style=color:#ff8f40>0.5 </span><span style=color:#ed9366>*</span><span> stroke</span><span style=color:#61676ccc>,
</span><span>))</span><span style=color:#61676ccc>,
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>transform</span><span style=color:#61676ccc>:</span><span> node_transform </span><span style=color:#ed9366>* </span><span>Affine2</span><span style=color:#ed9366>::</span><span>from_translation(run</span><span style=color:#ed9366>.</span><span style=color:#f07171>strikethrough_position</span><span>())</span><span style=color:#61676ccc>,
</span></code></pre><h3 id=crates-bevy-sprite-render-src-text2d-mod-rs-16-20><code>crates/bevy_sprite_render/src/text2d/mod.rs</code> (+16/-20)</h3><p>This file handles 2D sprite text rendering and was similarly updated to use the new helper methods.<p><strong>Key changes:</strong><ul><li>Updated background color extraction to use <code>run.bounds</code> instead of tuple elements<li>Simplified strikethrough and underline rendering using helper methods</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>for </span><span style=color:#ed9366>&</span><span>(section_index</span><span style=color:#61676ccc>,</span><span> rect</span><span style=color:#61676ccc>,</span><span> strikethrough_y</span><span style=color:#61676ccc>,</span><span> stroke</span><span style=color:#61676ccc>,</span><span> underline_y) </span><span style=color:#ed9366>in</span><span> text_layout_info</span><span style=color:#ed9366>.</span><span>section_geometry</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>for</span><span> run </span><span style=color:#ed9366>in</span><span> text_layout_info</span><span style=color:#ed9366>.</span><span>run_geometry</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()
</span></code></pre><h3 id=release-content-migration-guides-text-layout-info-section-rects-is-replaced-by-run-geometry-md-9-0><code>release-content/migration-guides/text_layout_info_section_rects_is_replaced_by_run_geometry.md</code> (+9/-0)</h3><p>This new file provides migration guidance for developers.<p><strong>Key content:</strong><ul><li>Explains the conceptual shift from sections to runs<li>Documents how to access entity information using <code>span_index</code><li>Describes the coordinate system used in the new structure</ul><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_text/latest/bevy_text/ target=_blank>Bevy Text Rendering Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://faultlore.com/blah/text-hates-you/ target=_blank>Text Layout and Rendering in Game Engines</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch05-01-defining-structs.html target=_blank>Rust Struct Best Practices</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21656.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>