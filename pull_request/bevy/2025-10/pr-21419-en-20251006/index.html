<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21419 Fix clippy when `target_os = "windows"`
        
    </title><meta content='#21419 Fix clippy when `target_os = "windows"`' property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-06</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21419-zh-cn-20251006>中文</a></div></div><div class=pr-content><h1 id=fix-clippy-when-target-os-windows>Fix clippy when <code>target_os = "windows"</code></h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Fix clippy when <code>target_os = "windows"</code><li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21419<li><strong>Author</strong>: greeble-dev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Build-System, C-Code-Quality, S-Needs-Review<li><strong>Created</strong>: 2025-10-06T10:19:21Z<li><strong>Merged</strong>: 2025-10-06T11:06:31Z<li><strong>Merged By</strong>: mockersf</ul><h2 id=description-translation>Description Translation</h2><p>Fixes a clippy error introduced by #21338. Issue was inside a <code>#[cfg(target_os = "windows")]</code> block so it wasn’t caught by CI.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>error</span><span style=color:#61676ccc>:</span><span> this boolean expression can be simplified
</span><span>   </span><span style=color:#ed9366>-</span><span style=color:#61676ccc>-></span><span> crates\bevy_winit\src\state</span><span style=color:#ed9366>.</span><span>rs</span><span style=color:#61676ccc>:</span><span style=color:#ff8f40>481</span><span style=color:#61676ccc>:</span><span style=color:#ff8f40>16
</span><span>    </span><span style=color:#ed9366>|
</span><span style=color:#ff8f40>481 </span><span style=color:#ed9366>|             </span><span style=color:#fa6e32>if </span><span style=color:#ed9366>!</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>app_exit</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_some</span><span>()
</span><span>    </span><span style=color:#ed9366>|                ^^^^^^^^^^^^^^^^^^^^^^^^</span><span> help</span><span style=color:#61676ccc>:</span><span> try</span><span style=color:#61676ccc>:</span><span> `</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>app_exit</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_none</span><span>()`
</span></code></pre><p>Tested with Rust 1.90.0, Win10, <code>cargo run -p ci -- lints</code>, <code>cargo run --example window_settings</code>.<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This pull request addresses a straightforward but important code quality issue in the Bevy game engine’s windowing system. The problem emerged from a subtle oversight in conditional compilation that allowed a Clippy lint violation to slip through CI testing undetected.<p>The core issue was a boolean expression in Windows-specific code that violated Rust’s idiomatic conventions. In the <code>WinitAppRunnerState</code> implementation, specifically within the <code>ApplicationHandler</code> trait, there was a condition checking <code>!self.app_exit.is_some()</code>. While functionally correct, this pattern is considered non-idiomatic in Rust because it unnecessarily negates a positive check when a direct negative check exists. Clippy, Rust’s linter, correctly identified this as a code quality issue that should be simplified to the more direct <code>self.app_exit.is_none()</code>.<p>What made this issue particularly interesting was its discovery context. The problematic code was wrapped in a <code>#[cfg(target_os = "windows")]</code> conditional compilation attribute, meaning it only compiled on Windows systems. Since Bevy’s CI pipeline likely runs on multiple platforms but may not execute Clippy checks on all of them, this Windows-specific code path escaped detection during the initial code review and CI validation process for PR #21338.<p>The solution implemented here is minimal but precise. The developer replaced the verbose boolean negation pattern with the idiomatic alternative suggested by Clippy. This change demonstrates an important principle in software engineering: even platform-specific code should adhere to the same quality standards as platform-agnostic code. The fix maintains identical functionality while improving code readability and adhering to Rust’s established conventions.<p>From an engineering perspective, this PR highlights several valuable lessons. First, it underscores the importance of comprehensive CI coverage across all target platforms. Second, it shows how conditional compilation can create blind spots in code quality checks. Third, it demonstrates that even trivial one-line changes can have significant implications for code maintainability and team development workflows.<p>The testing approach was thorough despite the change’s simplicity. The author verified the fix using Rust 1.90.0 on Windows 10, running both the linter checks (<code>cargo run -p ci -- lints</code>) and functional testing with the window settings example. This demonstrates good engineering practice - validating that the fix resolves the lint warning without introducing regressions in actual functionality.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[PR #21338] --> B[Introduces Windows-specific code]
</span><span>    B --> C[Clippy lint violation]
</span><span>    C --> D[Escapes CI detection]
</span><span>    D --> E[PR #21419 created]
</span><span>    E --> F[Fix: !is_some() → is_none()]
</span><span>    F --> G[Lint resolved]
</span><span>    F --> H[Functionality preserved]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><p><strong>File: <code>crates/bevy_winit/src/state.rs</code></strong><ul><li><strong>Change</strong>: Fixed Clippy lint by replacing non-idiomatic boolean expression with idiomatic equivalent<li><strong>Impact</strong>: Resolves code quality issue in Windows-specific code path</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>if </span><span style=color:#ed9366>!</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>app_exit</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_some</span><span>()
</span><span>    </span><span style=color:#ed9366>&& </span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>startup_forced_updates </span><span style=color:#ed9366>> </span><span style=color:#ff8f40>0
</span><span>        </span><span style=color:#ed9366>|| </span><span style=color:#f07171>matches!</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>update_mode</span><span style=color:#61676ccc>, </span><span>UpdateMode</span><span style=color:#ed9366>::</span><span>Reactive { </span><span style=color:#ed9366>.. </span><span>})
</span><span>        </span><span style=color:#ed9366>|| </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>window_event_received
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>if </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>app_exit</span><span style=color:#ed9366>.</span><span style=color:#f07171>is_none</span><span>()
</span><span>    </span><span style=color:#ed9366>&& </span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>startup_forced_updates </span><span style=color:#ed9366>> </span><span style=color:#ff8f40>0
</span><span>        </span><span style=color:#ed9366>|| </span><span style=color:#f07171>matches!</span><span>(</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>update_mode</span><span style=color:#61676ccc>, </span><span>UpdateMode</span><span style=color:#ed9366>::</span><span>Reactive { </span><span style=color:#ed9366>.. </span><span>})
</span><span>        </span><span style=color:#ed9366>|| </span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span>window_event_received
</span></code></pre><p>The change replaces <code>!self.app_exit.is_some()</code> with <code>self.app_exit.is_none()</code>, which is the idiomatic Rust way to check if an Option is None. This maintains exactly the same logical behavior while following Rust’s established conventions.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/clippy/ target=_blank>Rust Clippy Documentation</a> - Official Clippy lint tool documentation<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/option/enum.Option.html target=_blank>Rust Option Type Documentation</a> - Official documentation for Rust’s Option type and its methods<li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/reference/conditional-compilation.html target=_blank>Conditional Compilation in Rust</a> - Rust reference for <code>#[cfg]</code> attributes and conditional compilation<li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/blob/main/CONTRIBUTING.md target=_blank>Bevy Engine Contribution Guide</a> - Bevy’s contribution guidelines and code quality standards</ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21419.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>