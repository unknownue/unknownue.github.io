<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21325 Use slider precision to format feathers slider label
        
    </title><meta content="#21325 Use slider precision to format feathers slider label" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-04</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21325-zh-cn-20251004>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>Use slider precision to format feathers slider label<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Use slider precision to format feathers slider label<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21325<li><strong>Author</strong>: doup<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Bug, A-UI, S-Ready-For-Final-Review, D-Straightforward<li><strong>Created</strong>: 2025-10-01T19:20:54Z<li><strong>Merged</strong>: 2025-10-04T00:47:11Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>The slider label doesn’t format consistently. For example, for precision <code>2</code> it might jump between: <code>20</code>, <code>20.01</code>, <code>20.02</code> … <code>20.1</code>, <code>20.11</code>… which is noisy and ugly.<h2 id=solution>Solution</h2><p>Format the label using the precision.<h2 id=testing>Testing</h2><p>Checked the feathers example with <code>2</code>, <code>0</code> and <code>-1</code> precision.<h2 id=showcase>Showcase</h2><p>https://github.com/user-attachments/assets/9f30200a-a832-43df-937a-123c8d3168cf<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses a UI formatting issue in Bevy’s Feathers UI system where slider labels displayed inconsistent decimal formatting. The problem occurred because the slider value display was using Rust’s default floating-point formatting, which doesn’t maintain consistent decimal precision.<p>The core issue was in the <code>update_slider_pos</code> function, which updates both the slider’s visual position and its text label. When a user moved a slider with precision set to 2, the label would display values like “20”, “20.01”, “20.02”, then suddenly “20.1”, “20.11” - creating visual noise as the number of decimal places changed unpredictably.<p>The solution involved modifying the query to include the <code>SliderPrecision</code> component and implementing conditional formatting logic. The key insight was to use the precision setting only when it would improve the display, while falling back to default formatting for values that naturally have more decimal places than the specified precision.<p>The implementation follows a practical approach:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>let</span><span> label </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> value</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> decimals_len </span><span style=color:#ed9366>=</span><span> label
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>split_once</span><span>(</span><span style=color:#86b300>'.'</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|(_</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>decimals</span><span>)| decimals</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>() </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>i32</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or</span><span>(precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span>text</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>>= </span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>&&</span><span> decimals_len </span><span style=color:#ed9366><=</span><span> precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>{
</span><span>    </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"{:.precision$}"</span><span style=color:#61676ccc>,</span><span> value</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,</span><span> precision </span><span style=color:#ed9366>=</span><span> precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>usize</span><span>)
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    label
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><p>This code first checks if the precision is non-negative and if the actual number of decimal places in the value is less than or equal to the precision setting. Only then does it apply the precision-based formatting using Rust’s <code>{:.precision$}</code> format specifier. This prevents unnecessary zero-padding when the value naturally has fewer decimal places than the precision setting.<p>The change is minimal but effective - it adds only 17 lines while removing 4, demonstrating how a focused fix can resolve a noticeable UI issue. The solution maintains backward compatibility while providing consistent formatting behavior that matches user expectations for slider controls.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Slider Component] --> B[update_slider_pos System]
</span><span>    B --> C[Query Slider Components]
</span><span>    C --> D[SliderValue]
</span><span>    C --> E[SliderRange]
</span><span>    C --> F[SliderPrecision]
</span><span>    C --> G[BackgroundGradient]
</span><span>    B --> H[Format Label Text]
</span><span>    H --> I[Check Decimal Count]
</span><span>    H --> J[Apply Precision Formatting]
</span><span>    H --> K[Fallback to Default Format]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><ul><li><code>crates/bevy_feathers/src/controls/slider.rs</code> (+21/-4)</ul><p>This file contains the core logic for slider controls in the Feathers UI system. The changes modify the label formatting behavior to use precision settings consistently.<p><strong>Key modifications:</strong><ol><li>Added import for <code>SliderPrecision</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span style=color:#fa6e32>use </span><span>bevy_ui_widgets</span><span style=color:#ed9366>::</span><span>{Slider</span><span style=color:#61676ccc>,</span><span> SliderRange</span><span style=color:#61676ccc>,</span><span> SliderValue</span><span style=color:#61676ccc>,</span><span> TrackClick}</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>use </span><span>bevy_ui_widgets</span><span style=color:#ed9366>::</span><span>{Slider</span><span style=color:#61676ccc>,</span><span> SliderPrecision</span><span style=color:#61676ccc>,</span><span> SliderRange</span><span style=color:#61676ccc>,</span><span> SliderValue</span><span style=color:#61676ccc>,</span><span> TrackClick}</span><span style=color:#61676ccc>;
</span></code></pre><ol start=2><li>Updated the query to include <code>SliderPrecision</code>:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>(Entity</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>SliderValue</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>SliderRange</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BackgroundGradient)
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span>(Entity</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>SliderValue</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>SliderRange</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span>SliderPrecision</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> BackgroundGradient)
</span></code></pre><ol start=3><li>Implemented the precision-based formatting logic:</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before:
</span><span>text</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> value</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After:
</span><span style=color:#fa6e32>let</span><span> label </span><span style=color:#ed9366>= </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> value</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> decimals_len </span><span style=color:#ed9366>=</span><span> label
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>split_once</span><span>(</span><span style=color:#86b300>'.'</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|(_</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>decimals</span><span>)| decimals</span><span style=color:#ed9366>.</span><span style=color:#f07171>len</span><span>() </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>i32</span><span>)
</span><span>    </span><span style=color:#ed9366>.</span><span style=color:#f07171>unwrap_or</span><span>(precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Don't format with precision if the value has more decimals than the precision
</span><span>text</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>if</span><span> precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>>= </span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>&&</span><span> decimals_len </span><span style=color:#ed9366><=</span><span> precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>{
</span><span>    </span><span style=color:#f07171>format!</span><span>(</span><span style=color:#86b300>"{:.precision$}"</span><span style=color:#61676ccc>,</span><span> value</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>,</span><span> precision </span><span style=color:#ed9366>=</span><span> precision</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span style=color:#ed9366>as </span><span style=color:#fa6e32>usize</span><span>)
</span><span>} </span><span style=color:#fa6e32>else </span><span>{
</span><span>    label
</span><span>}</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/std/fmt/ target=_blank>Rust Formatting Documentation</a> - Details on Rust’s formatting syntax and precision specifiers<li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/ui/ target=_blank>Bevy UI System</a> - Bevy’s official UI documentation<li><a rel="noopener nofollow noreferrer" href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed target=_blank>Floating-Point Precision in UI</a> - Similar precision formatting concepts in other languages</ul><h1 id=full-code-diff>Full Code Diff</h1><p>diff –git a/crates/bevy_feathers/src/controls/slider.rs b/crates/bevy_feathers/src/controls/slider.rs index 1bcb2449f9370..594174c15a7d0 100644 — a/crates/bevy_feathers/src/controls/slider.rs +++ b/crates/bevy_feathers/src/controls/slider.rs @@ -23,7 +23,7 @@ use bevy_ui::{ InteractionDisabled, InterpolationColorSpace, JustifyContent, LinearGradient, Node, PositionType, UiRect, Val, }; -use bevy_ui_widgets::{Slider, SliderRange, SliderValue, TrackClick}; +use bevy_ui_widgets::{Slider, SliderPrecision, SliderRange, SliderValue, TrackClick};<p>use crate::{ constants::{fonts, size}, @@ -195,7 +195,13 @@ fn set_slider_styles(<p>fn update_slider_pos( mut q_sliders: Query<<ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   (Entity, &SliderValue, &SliderRange, &mut BackgroundGradient),
</span></code></pre></ul><ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>   (
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       Entity,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       &SliderValue,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       &SliderRange,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       &SliderPrecision,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>       &mut BackgroundGradient,
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>   ),
</span><span>   (
</span><span>       With&LTSliderStyle>,
</span><span>       Or<(
</span></code></pre></ul><p>@@ -208,7 +214,7 @@ fn update_slider_pos( q_children: Query<&Children>, mut q_slider_text: Query<&mut Text, With<slidervaluetext>>, ) { <ul><li>for (slider_ent, value, range, mut gradient) in q_sliders.iter_mut() {</ul> <ul><li>for (slider_ent, value, range, precision, mut gradient) in q_sliders.iter_mut() { if let [Gradient::Linear(linear_gradient)] = &mut gradient.0[..] { let percent_value = range.thumb_position(value.0) * 100.0; linear_gradient.stops[1].point = Val::Percent(percent_value); @@ -218,7 +224,18 @@ fn update_slider_pos( // Find slider text child entity and update its text with the formatted value q_children.iter_descendants(slider_ent).for_each(|child| { if let Ok(mut text) = q_slider_text.get_mut(child) {</ul> <ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>           text.0 = format!("{}", value.0);
</span></code></pre></ul> <ul><li><pre style=color:#61676c;background-color:#fafafa><code><span>           let label = format!("{}", value.0);
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           let decimals_len = label
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               .split_once('.')
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               .map(|(_, decimals)| decimals.len() as i32)
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               .unwrap_or(precision.0);
</span></code></pre><li><li><pre style=color:#61676c;background-color:#fafafa><code><span>           // Don't format with precision if the value has more decimals than the precision
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           text.0 = if precision.0 >= 0 && decimals_len <= precision.0 {
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               format!("{:.precision$}", value.0, precision = precision.0 as usize)
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           } else {
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>               label
</span></code></pre><li><pre style=color:#61676c;background-color:#fafafa><code><span>           };
</span><span>       }
</span><span>   });
</span></code></pre> }</ul>    <div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21325.patch id=patch-info style=display:none></div>  <div class=bottom-spacer></div> 