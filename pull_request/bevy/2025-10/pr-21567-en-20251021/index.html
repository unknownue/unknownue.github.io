<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21567 Move asset processing tests to their own file.
        
    </title><meta content="#21567 Move asset processing tests to their own file." property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-21</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21567-zh-cn-20251021>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Move asset processing tests to their own file.<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21567<li><strong>Author</strong>: andriyDev<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: D-Trivial, A-Assets, C-Code-Quality, S-Ready-For-Final-Review, C-Testing<li><strong>Created</strong>: 2025-10-16T22:17:50Z<li><strong>Merged</strong>: 2025-10-21T18:13:23Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><ul><li>Address <a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/21566#issuecomment-3412927603 target=_blank>this comment</a>.</ul><h2 id=solution>Solution</h2><ul><li>Move all the asset processor tests into their own file.</ul><h2 id=testing>Testing</h2><ul><li>Ran the tests in single threaded and multi threaded mode.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>The primary issue this PR addresses is code organization within the Bevy asset system. The asset processor tests had grown significantly and were becoming difficult to maintain within the main <code>lib.rs</code> file. This was creating several practical problems for developers working on the codebase.<p><strong>The Problem and Context</strong> The asset processor tests were originally located in <code>crates/bevy_asset/src/lib.rs</code>, which had grown to over 800 lines of test code. This made the main library file difficult to navigate and understand. The tests were also conditionally compiled behind the <code>multi_threaded</code> feature flag, which added complexity to the main test module. As the asset system evolved, maintaining these tests in the primary library file became increasingly cumbersome.<p><strong>The Solution Approach</strong> The straightforward solution was to extract all asset processor-related tests into a dedicated test file. This follows standard Rust conventions for organizing test code and aligns with Bevy’s existing code organization patterns. The approach maintains all existing test functionality while improving code readability and maintainability.<p><strong>The Implementation</strong> The implementation involved three key changes:<ol><li>Removing the test code from <code>lib.rs</code> (-812 lines)<li>Creating a new <code>tests.rs</code> file in the processor module (+761 lines)<li>Adding a module declaration to include the tests conditionally</ol><p>The tests were moved verbatim without functional changes, ensuring that all existing test coverage was preserved. The conditional compilation logic was maintained, with the tests only being compiled when both the <code>multi_threaded</code> feature and test configuration are active.<p><strong>Technical Insights</strong> This refactoring demonstrates several important software engineering principles:<ul><li><strong>Separation of Concerns</strong>: By separating test code from library code, both become easier to understand and maintain<li><strong>Module Organization</strong>: Following Rust’s convention of placing tests in dedicated files improves code navigation<li><strong>Conditional Compilation</strong>: The implementation properly handles the <code>multi_threaded</code> feature requirement for asset processor tests</ul><p>The move also revealed some technical debt in the form of duplicate type definitions and test utilities that were previously scattered throughout the main test module.<p><strong>The Impact</strong> The primary impact is improved code maintainability. Developers can now:<ul><li>More easily locate and understand asset processor tests<li>Work on asset processor functionality without navigating through unrelated test code<li>Add new tests without contributing to file size bloat in the main library</ul><p>The change also sets a precedent for future test organization as the asset system continues to evolve.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TB
</span><span>    A[lib.rs] --> B[Removes 812 lines of tests]
</span><span>    C[processor/tests.rs] --> D[Adds 761 lines of tests]
</span><span>    E[processor/mod.rs] --> F[Conditionally includes tests]
</span><span>    
</span><span>    B --> C
</span><span>    F --> C
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-asset-src-lib-rs-10-812><code>crates/bevy_asset/src/lib.rs</code> (+10/-812)</h3><p>This file saw the most significant reduction in size, with the removal of all asset processor test code. The changes included:<ol><li>Removal of test-only imports and type definitions<li>Extraction of the <code>AppWithProcessor</code> test utility structure<li>Removal of all individual asset processor test functions</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Before: Extensive test code in lib.rs
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"multi_threaded"</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>asset_processor_transforms_asset_default_processor</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... 50+ lines of test implementation
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// After: Cleaner lib.rs with only non-processor tests
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>same_asset_different_settings</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Remaining non-processor tests stay
</span><span>}
</span></code></pre><h3 id=crates-bevy-asset-src-processor-tests-rs-761-0><code>crates/bevy_asset/src/processor/tests.rs</code> (+761/-0)</h3><p>This new file contains all the extracted asset processor tests, organized with proper imports and maintaining the same test structure:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// New file with dedicated test organization
</span><span style=color:#fa6e32>use </span><span>alloc</span><span style=color:#ed9366>::</span><span>{boxed</span><span style=color:#ed9366>::</span><span>Box</span><span style=color:#61676ccc>, </span><span>collections</span><span style=color:#ed9366>::</span><span>BTreeMap</span><span style=color:#61676ccc>, </span><span style=color:#abb0b6;font-style:italic>/* ... */</span><span>}</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>bevy_reflect</span><span style=color:#ed9366>::</span><span>TypePath</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// ... other imports
</span><span>
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>AppWithProcessor </span><span>{
</span><span>    app</span><span style=color:#61676ccc>:</span><span> App,
</span><span>    source_dir</span><span style=color:#61676ccc>:</span><span> Dir,
</span><span>    processed_dir</span><span style=color:#61676ccc>:</span><span> Dir,
</span><span>}
</span><span>
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>test</span><span>]
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>no_meta_or_default_processor_copies_asset</span><span>() {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Test implementation moved from lib.rs
</span><span>}
</span></code></pre><h3 id=crates-bevy-asset-src-processor-mod-rs-5-0><code>crates/bevy_asset/src/processor/mod.rs</code> (+5/-0)</h3><p>This file was modified to conditionally include the new test module:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Added to processor/mod.rs
</span><span style=color:#abb0b6;font-style:italic>// The asset processor currently requires multi_threaded.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"multi_threaded"</span><span>)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg</span><span>(test)]
</span><span style=color:#fa6e32>mod </span><span style=color:#399ee6>tests</span><span style=color:#61676ccc>;
</span></code></pre><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch11-00-testing.html target=_blank>Rust Testing Guide</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/quick-start/assets/ target=_blank>Bevy Asset System Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://doc.rust-lang.org/book/ch07-02-defining-modules-to-control-scope-and-privacy.html target=_blank>Module System in Rust</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21567.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>