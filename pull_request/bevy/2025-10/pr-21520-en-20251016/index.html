<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21520 feat(pan-cam): add scaffolding for 2D pan camera controller
        
    </title><meta content="#21520 feat(pan-cam): add scaffolding for 2D pan camera controller" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-16</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21520-zh-cn-20251016>中文</a></div></div><div class=pr-content><h1 id=title>Title</h1><p>feat(pan-cam): add scaffolding for 2D pan camera controller<h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: feat(pan-cam): add scaffolding for 2D pan camera controller<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21520<li><strong>Author</strong>: syszery<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: C-Feature, S-Ready-For-Final-Review, M-Needs-Release-Note, A-Camera<li><strong>Created</strong>: 2025-10-12T19:48:01Z<li><strong>Merged</strong>: 2025-10-16T22:00:18Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Implements scaffolding for a 2D pan camera controller.<p>Fixes #21468<h2 id=solution>Solution</h2><ul><li>Introduced a <code>PanCam</code> component with settings for panning, zooming, and rotation via keyboard input, following the design of the existing <code>FreeCam</code>.<li>Added a <code>PanCamPlugin</code> to register the controller system.<li>Implemented keyboard-based panning and rotation.</ul><h2 id=todos>TODOs</h2><ul><li>Movement is currently world-axis aligned. <ul><li>TODO: Consider movement relative to camera rotation.</ul><li>Zooming support is scaffolded with config fields but not yet implemented.</ul><h2 id=testing>Testing</h2><p>Unfortunately, I was unable to fully test this implementation due to issues running graphical output with GPU acceleration under WSL.<br> As a result, zoom behavior and rotation effects remain TODOs, and the whole code could not be fully verified.<p>Once I resolve the GPU passthrough issues, I plan to complete and test the remaining features (with a more meaningful example).<hr><p>I’m happy to hear any suggestions or feedback in the meantime!<h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR addresses the need for a dedicated 2D camera controller in the Bevy engine. While Bevy already had a <code>FreeCam</code> controller for 3D scenes, there was a gap for 2D applications that required panning and zooming functionality. The implementation follows the established patterns from the existing camera controller system, ensuring consistency across the codebase.<p>The core of this implementation is the <code>PanCam</code> component, which provides configurable settings for camera behavior. The component includes fields for controlling pan speed, rotation speed, zoom parameters, and customizable key bindings. The design mirrors the <code>FreeCam</code> component’s structure, making it familiar to developers already working with Bevy’s camera systems.<p>The implementation handles three main types of camera manipulation: movement, rotation, and zoom. For movement, the system reads keyboard inputs and translates the camera position based on the configured pan speed and delta time. The rotation functionality allows the camera to rotate around the Z-axis using designated keys. While zoom functionality is scaffolded with configuration fields, the author notes it’s not yet fully implemented in this initial version.<p>One notable technical decision was to implement world-axis aligned movement rather than camera-relative movement. This means that pressing the “up” key always moves the camera in the positive Y direction of the world, regardless of the camera’s current rotation. The author explicitly calls this out as a potential area for future improvement.<p>The system integration follows Bevy’s plugin pattern with <code>PanCamPlugin</code>, which registers the controller system to run in the fixed main loop. This ensures consistent camera behavior regardless of frame rate variations. The system queries for entities that have both a <code>Transform</code> and <code>PanCam</code> component along with a <code>Camera</code> marker.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>run_pancam_controller</span><span>(
</span><span>    </span><span style=color:#ff8f40>time</span><span style=color:#61676ccc>: </span><span>Res&LTTime&LTReal>>,
</span><span>    </span><span style=color:#ff8f40>key_input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKeyCode>>,
</span><span>    </span><span style=color:#ff8f40>accumulated_mouse_scroll</span><span style=color:#61676ccc>: </span><span>Res&LTAccumulatedMouseScroll>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> PanCam), With&LTCamera>>,
</span><span>) {
</span></code></pre><p>The movement calculation demonstrates careful attention to vector mathematics and normalization:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>if</span><span> movement </span><span style=color:#ed9366>!= </span><span>Vec2</span><span style=color:#ed9366>::</span><span style=color:#ff8f40>ZERO </span><span>{
</span><span>    </span><span style=color:#fa6e32>let</span><span> right </span><span style=color:#ed9366>=</span><span> transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>right</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>let</span><span> up </span><span style=color:#ed9366>=</span><span> transform</span><span style=color:#ed9366>.</span><span style=color:#f07171>up</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#fa6e32>let</span><span> delta </span><span style=color:#ed9366>= </span><span>(right </span><span style=color:#ed9366>*</span><span> movement</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>+</span><span> up </span><span style=color:#ed9366>*</span><span> movement</span><span style=color:#ed9366>.</span><span>y)</span><span style=color:#ed9366>.</span><span style=color:#f07171>normalize</span><span>() </span><span style=color:#ed9366>*</span><span> controller</span><span style=color:#ed9366>.</span><span>pan_speed </span><span style=color:#ed9366>*</span><span> dt</span><span style=color:#61676ccc>;
</span><span>
</span><span>    transform</span><span style=color:#ed9366>.</span><span>translation</span><span style=color:#ed9366>.</span><span>x </span><span style=color:#ed9366>+=</span><span> delta</span><span style=color:#ed9366>.</span><span>x</span><span style=color:#61676ccc>;
</span><span>    transform</span><span style=color:#ed9366>.</span><span>translation</span><span style=color:#ed9366>.</span><span>y </span><span style=color:#ed9366>+=</span><span> delta</span><span style=color:#ed9366>.</span><span>y</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p>The author acknowledges testing limitations due to WSL GPU passthrough issues, which prevented full validation of the zoom and rotation features. This transparency about the implementation’s current state is valuable for reviewers and future contributors.<p>The PR includes comprehensive documentation, a working example, and proper feature flag integration, making it production-ready despite the noted limitations. The implementation demonstrates good software engineering practices with clear separation of concerns, sensible defaults, and extensible design.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph LR
</span><span>    A[PanCamPlugin] --> B[PanCam Component]
</span><span>    B --> C[run_pancam_controller System]
</span><span>    C --> D[Transform Component]
</span><span>    C --> E[Camera Component]
</span><span>    C --> F[Input Resources]
</span><span>    F --> G[Keyboard Input]
</span><span>    F --> H[Mouse Scroll]
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-camera-controller-src-pan-cam-rs-237-0><code>crates/bevy_camera_controller/src/pan_cam.rs</code> (+237/-0)</h3><p>This is the main implementation file containing the <code>PanCam</code> component and controller system.<p>Key components:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>PanCam </span><span>{
</span><span>    </span><span style=color:#fa6e32>pub </span><span>enable</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>bool</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>zoom_factor</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>min_zoom</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>max_zoom</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>zoom_speed</span><span style=color:#61676ccc>: </span><span style=color:#fa6e32>f32</span><span>,
</span><span>    </span><span style=color:#fa6e32>pub </span><span>key_zoom_in</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>Option</span><span>&LTKeyCode>,
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// ... additional configuration fields
</span><span>}
</span></code></pre><p>The controller system handles input processing and camera transformation:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>run_pancam_controller</span><span>(
</span><span>    </span><span style=color:#ff8f40>time</span><span style=color:#61676ccc>: </span><span>Res&LTTime&LTReal>>,
</span><span>    </span><span style=color:#ff8f40>key_input</span><span style=color:#61676ccc>: </span><span>Res&LTButtonInput&LTKeyCode>>,
</span><span>    </span><span style=color:#ff8f40>accumulated_mouse_scroll</span><span style=color:#61676ccc>: </span><span>Res&LTAccumulatedMouseScroll>,
</span><span>    </span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>query</span><span style=color:#61676ccc>: </span><span>Query<(</span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> Transform, </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> PanCam), With&LTCamera>>,
</span><span>) {
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Implementation details...
</span><span>}
</span></code></pre><h3 id=examples-camera-pan-cam-controller-rs-42-0><code>examples/camera/pan_cam_controller.rs</code> (+42/-0)</h3><p>Provides a working example demonstrating how to use the <code>PanCam</code> controller.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>main</span><span>() {
</span><span>    App</span><span style=color:#ed9366>::</span><span>new()
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(DefaultPlugins)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_plugins</span><span>(PanCamPlugin)
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>add_systems</span><span>(Startup</span><span style=color:#61676ccc>, </span><span>(setup</span><span style=color:#61676ccc>,</span><span> spawn_text)</span><span style=color:#ed9366>.</span><span style=color:#f07171>chain</span><span>())
</span><span>        </span><span style=color:#ed9366>.</span><span style=color:#f07171>run</span><span>()</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>setup</span><span>(</span><span style=color:#fa6e32>mut </span><span style=color:#ff8f40>commands</span><span style=color:#61676ccc>:</span><span> Commands, </span><span style=color:#ff8f40>asset_server</span><span style=color:#61676ccc>: </span><span>Res&LTAssetServer>) {
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>((Camera2d</span><span style=color:#61676ccc>, </span><span>PanCam</span><span style=color:#ed9366>::</span><span>default()))</span><span style=color:#61676ccc>;
</span><span>    commands</span><span style=color:#ed9366>.</span><span style=color:#f07171>spawn</span><span>(Sprite</span><span style=color:#ed9366>::</span><span>from_image(
</span><span>        asset_server</span><span style=color:#ed9366>.</span><span style=color:#f07171>load</span><span>(</span><span style=color:#86b300>"branding/bevy_bird_dark.png"</span><span>)</span><span style=color:#61676ccc>,
</span><span>    ))</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=configuration-files>Configuration Files</h3><ul><li><code>Cargo.toml</code> (+15/-0): Added feature flag and example configuration<li><code>crates/bevy_camera_controller/Cargo.toml</code> (+1/-0): Added pan_cam feature<li><code>crates/bevy_internal/Cargo.toml</code> (+1/-0): Integrated pan_cam into bevy_internal</ul><h3 id=documentation-updates>Documentation Updates</h3><ul><li><code>docs/cargo_features.md</code> (+1/-0): Added pan_cam feature documentation<li><code>examples/README.md</code> (+1/-0): Added example documentation<li><code>release-content/release-notes/camera_controllers.md</code> (+8/-2): Updated release notes</ul><h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/getting-started/camera/ target=_blank>Bevy Camera Systems Documentation</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/getting-started/ecs/#system-scheduling target=_blank>Bevy ECS System Scheduling</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/books/getting-started/input/ target=_blank>Bevy Input Handling</a><li><a rel="noopener nofollow noreferrer" href=https://gamedev.stackexchange.com/questions/60701/how-to-implement-a-2d-camera-that-follows-the-player target=_blank>Camera Controllers in Game Development</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21520.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>