<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://unknownue.github.io name=base><title>
         #21623 Remove `Internal` component
        
    </title><meta content="#21623 Remove `Internal` component" property=og:title><meta content="A personal blog built with Zola and Apollo theme" property=og:description><meta content="A personal blog built with Zola and Apollo theme" name=description><link href=/icons/favicon.png rel=icon type=image/png><link href=https://unknownue.github.io/fonts.css rel=stylesheet><script src=https://unknownue.github.io/js/codeblock.js></script><script src=https://unknownue.github.io/js/toc.js></script><script src=https://unknownue.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Unknownue's Blog" href=https://unknownue.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://unknownue.github.io/theme/light.css rel=stylesheet><link href=https://unknownue.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://unknownue.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://unknownue.github.io/main.css media=screen rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script><script>// Initialize mermaid once DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: false,
                theme: document.body && document.body.classList.contains('dark') ? 'dark' : 'default',
                securityLevel: 'loose',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65
                }
            });
        });</script><script src=https://unknownue.github.io/js/main.js></script><script defer src=https://unknownue.github.io/js/label-colors.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js></script><script>// Ensure highlight.js is properly configured
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                hljs.configure({
                    languages: ['rust', 'javascript', 'python', 'cpp', 'go', 'typescript'],
                    ignoreUnescapedHTML: true
                });
                console.log('Highlight.js configured in header');
            }
        });</script><link href=https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js></script><script src=https://unknownue.github.io/js/syntax-highlight.js></script><script src=https://unknownue.github.io/js/diff-sidebar.js></script><script src="https://unknownue.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://unknownue.github.io>Unknownue's Blog</a><div class=socials><a class=social href=https://github.com/unknownue rel=me> <img alt=github src=https://unknownue.github.io/icons/social/github.svg> </a><a class=social href=https://github.com/unknownue/unknownue.github.io rel=me> <img alt=github-io src=https://unknownue.github.io/icons/social/rss.svg> </a></div></div><nav><a href=https://unknownue.github.io/posts style=margin-left:.25em>/posts</a><a href=https://unknownue.github.io/projects style=margin-left:.25em>/projects</a><a href=https://unknownue.github.io/about style=margin-left:.25em>/about</a><a href=https://unknownue.github.io/tags style=margin-left:.25em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://unknownue.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://unknownue.github.io/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://unknownue.github.io/icons/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><div class=pull-request-page><article class=md-content-page style=display:none></article><div class=back-link><a href=/pull_request/bevy/2025-10/>← Back to Pull Requests</a></div><div class=pr-metadata><span class=pr-date>2025-10-22</span><div class=language-switcher><span class="lang-link active" data-lang=en>English</span> / <a class=lang-link data-lang=zh-cn href=/pull_request/bevy/2025-10/pr-21623-zh-cn-20251022>中文</a></div></div><div class=pr-content><h1 id=remove-internal-component>Remove <code>Internal</code> component</h1><h2 id=basic-information>Basic Information</h2><ul><li><strong>Title</strong>: Remove <code>Internal</code> component<li><strong>PR Link</strong>: https://github.com/bevyengine/bevy/pull/21623<li><strong>Author</strong>: alice-i-cecile<li><strong>Status</strong>: MERGED<li><strong>Labels</strong>: A-ECS, C-Usability, S-Ready-For-Final-Review, M-Migration-Guide, X-Blessed<li><strong>Created</strong>: 2025-10-21T18:24:18Z<li><strong>Merged</strong>: 2025-10-22T18:30:08Z<li><strong>Merged By</strong>: alice-i-cecile</ul><h2 id=description-translation>Description Translation</h2><h1 id=objective>Objective</h1><p>Despite initially advocating for its inclusion in #20204, I’ve been increasingly unconvinced by the edge cases and user-facing complexity and surprise that <code>Internal</code> brings.<p>Accidental queries are quite hard to write, and the entitiy-inspector concerns are really a UX problem for each tool to solve that <code>Internal</code> doesn’t help with.<p>@cart feels similarly: as a result I’m marking this PR as X-Blessed.<p>Closes #21363.<h2 id=solution>Solution</h2><ul><li>Remove <code>Internal</code> as a type.<li>Follow the compiler errors to remove all references.<li>Write a migration guide.</ul><h2 id=the-story-of-this-pull-request>The Story of This Pull Request</h2><p>This PR represents a pragmatic reversal of a previous design decision. The <code>Internal</code> component was originally introduced in PR #20204 as a way to mark entities that were internal to the Bevy engine, hiding them from user queries by default. The intent was to prevent users from accidentally modifying engine internals and to provide a unified way for entity inspectors to distinguish between user-facing and internal entities.<p>However, in practice, the <code>Internal</code> component introduced more problems than it solved. The author notes that “accidental queries are quite hard to write,” suggesting that the protection it provided was minimal. More importantly, it added user-facing complexity and surprising behavior that didn’t align well with how developers actually work with the ECS system.<p>The core issue was that entity categorization and visibility concerns are fundamentally UX problems that should be handled by individual tools rather than being baked into the core ECS framework. Tools like entity inspectors can implement their own filtering logic based on component patterns or other heuristics, without requiring a special marker component.<p>The implementation approach was straightforward: completely remove the <code>Internal</code> component type and follow the compiler errors to update all references throughout the codebase. This included removing it from default query filters, observer systems, and state management systems.<p>One key insight from this change is that simplicity often trumps protection mechanisms in API design. While the original intent of protecting users from themselves was well-meaning, the practical reality was that it created friction without providing meaningful safety benefits. The ECS query system is already explicit enough that accidental modification of internal entities is unlikely, and when it does occur, the consequences are typically immediately apparent.<p>The removal also simplifies several systems that previously needed to account for <code>Internal</code> entities in their queries. For example, state transition systems and scene serialization no longer need special handling to include or exclude internal entities.<h2 id=visual-representation>Visual Representation</h2><pre class=language-mermaid data-lang=mermaid style=color:#61676c;background-color:#fafafa><code class=language-mermaid data-lang=mermaid><span>graph TD
</span><span>    A[Internal Component] --> B[Default Query Filters]
</span><span>    A --> C[Observer Systems]
</span><span>    A --> D[System Registry]
</span><span>    A --> E[State Management]
</span><span>    A --> F[Scene Serialization]
</span><span>    
</span><span>    B --> G[Removed from all systems]
</span><span>    C --> G
</span><span>    D --> G
</span><span>    E --> G
</span><span>    F --> G
</span></code></pre><h2 id=key-files-changed>Key Files Changed</h2><h3 id=crates-bevy-ecs-src-entity-disabling-rs-1-44><code>crates/bevy_ecs/src/entity_disabling.rs</code> (+1/-44)</h3><p>This file saw the most significant changes, removing the <code>Internal</code> component definition and its registration from the default query filters.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>/// A marker component for internal entities.
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Debug</span><span style=color:#61676ccc>,</span><span> Default)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>cfg_attr</span><span>(
</span><span>    feature </span><span style=color:#ed9366>= </span><span style=color:#86b300>"bevy_reflect"</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>derive</span><span>(Reflect)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>reflect</span><span>(Component)</span><span style=color:#61676ccc>,
</span><span>    </span><span style=color:#f29718>reflect</span><span>(Debug</span><span style=color:#61676ccc>,</span><span> Clone</span><span style=color:#61676ccc>,</span><span> Default)
</span><span>)]
</span><span style=color:#abb0b6;font-style:italic>// This component is registered as a disabling component during World::bootstrap
</span><span style=color:#fa6e32>pub struct </span><span style=color:#399ee6>Internal</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl </span><span>FromWorld </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DefaultQueryFilters </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_world</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>let mut</span><span> filters </span><span style=color:#ed9366>= </span><span>DefaultQueryFilters</span><span style=color:#ed9366>::</span><span>empty()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> disabled_component_id </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>register_component</span><span style=color:#ed9366>::</span><span>&LTDisabled>()</span><span style=color:#61676ccc>;
</span><span>        filters</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_disabling_component</span><span>(disabled_component_id)</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> internal_component_id </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>register_component</span><span style=color:#ed9366>::</span><span>&LTInternal>()</span><span style=color:#61676ccc>;
</span><span>        filters</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_disabling_component</span><span>(internal_component_id)</span><span style=color:#61676ccc>;
</span><span>        filters
</span><span>    }
</span><span>}
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>impl </span><span>FromWorld </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>DefaultQueryFilters </span><span>{
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>from_world</span><span>(</span><span style=color:#ff8f40>world</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> World) </span><span style=color:#61676ccc>-> </span><span style=color:#fa6e32>Self </span><span>{
</span><span>        </span><span style=color:#fa6e32>let mut</span><span> filters </span><span style=color:#ed9366>= </span><span>DefaultQueryFilters</span><span style=color:#ed9366>::</span><span>empty()</span><span style=color:#61676ccc>;
</span><span>        </span><span style=color:#fa6e32>let</span><span> disabled_component_id </span><span style=color:#ed9366>=</span><span> world</span><span style=color:#ed9366>.</span><span>register_component</span><span style=color:#ed9366>::</span><span>&LTDisabled>()</span><span style=color:#61676ccc>;
</span><span>        filters</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_disabling_component</span><span>(disabled_component_id)</span><span style=color:#61676ccc>;
</span><span>        filters
</span><span>    }
</span><span>}
</span></code></pre><h3 id=crates-bevy-ecs-src-observer-distributed-storage-rs-1-11><code>crates/bevy_ecs/src/observer/distributed_storage.rs</code> (+1/-11)</h3><p>Removed the requirement for <code>Internal</code> component in observer entities.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>register_required_components</span><span>(
</span><span>    </span><span style=color:#ff8f40>_component_id</span><span style=color:#61676ccc>:</span><span> ComponentId,
</span><span>    </span><span style=color:#ff8f40>required_components</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>mut</span><span> RequiredComponentsRegistrator,
</span><span>) {
</span><span>    required_components</span><span style=color:#ed9366>.</span><span style=color:#f07171>register_required</span><span>(Internal</span><span style=color:#ed9366>::</span><span>default)</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><p><strong>After:</strong> <em>(Function completely removed)</em><h3 id=crates-bevy-ecs-src-system-system-registry-rs-1-8><code>crates/bevy_ecs/src/system/system_registry.rs</code> (+1/-8)</h3><p>Updated the <code>RegisteredSystem</code> component to no longer require the <code>Internal</code> component.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>require</span><span>(SystemIdMarker </span><span style=color:#ed9366>=</span><span> SystemIdMarker::typed_system_id_marker::&LTI</span><span style=color:#61676ccc>,</span><span> O>(), </span><span style=color:#f29718>Internal</span><span>)]
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>RegisteredSystem</span><span>&LTI, O> {
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>derive</span><span>(Component)]
</span><span style=color:#61676ccc>#</span><span>[</span><span style=color:#f29718>require</span><span>(SystemIdMarker </span><span style=color:#ed9366>=</span><span> SystemIdMarker::typed_system_id_marker::&LTI</span><span style=color:#61676ccc>,</span><span> O>())]
</span><span style=color:#fa6e32>pub</span><span>(</span><span style=color:#fa6e32>crate</span><span>) </span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>RegisteredSystem</span><span>&LTI, O> {
</span></code></pre><h3 id=crates-bevy-state-src-state-scoped-rs-2-4><code>crates/bevy_state/src/state_scoped.rs</code> (+2/-4)</h3><p>Simplified state transition queries by removing the <code>Allow&LTInternal></code> filter.<p><strong>Before:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>query</span><span style=color:#61676ccc>: </span><span>Query<(Entity, </span><span style=color:#ed9366>&</span><span>DespawnOnExit&LTS>), (Allow&LTDisabled>, Allow&LTInternal>)></span><span style=color:#61676ccc>,
</span></code></pre><p><strong>After:</strong><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span>query</span><span style=color:#61676ccc>: </span><span>Query<(Entity, </span><span style=color:#ed9366>&</span><span>DespawnOnExit&LTS>), Allow&LTDisabled>></span><span style=color:#61676ccc>,
</span></code></pre><h3 id=release-content-migration-guides-internal-disabling-component-removed-md-20-0><code>release-content/migration-guides/internal_disabling_component_removed.md</code> (+20/-0)</h3><p>Added comprehensive migration guide explaining the removal and providing guidance for updating code.<h2 id=further-reading>Further Reading</h2><ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/pull/20204 target=_blank>Original PR #20204 that introduced the Internal component</a><li><a rel="noopener nofollow noreferrer" href=https://github.com/bevyengine/bevy/issues/21363 target=_blank>Issue #21363 that this PR closes</a><li><a rel="noopener nofollow noreferrer" href=https://docs.rs/bevy_ecs/latest/bevy_ecs/query/struct.Query.html target=_blank>Bevy ECS documentation on query filters</a><li><a rel="noopener nofollow noreferrer" href=https://bevyengine.org/learn/book/ecs/components/ target=_blank>Bevy’s component system documentation</a></ul></div><div data-is-md-page=true data-patch-exists=true data-patch-path=/pull_request/bevy/2025-10/pr_21623.patch id=patch-info style=display:none></div><div class=bottom-spacer></div></div></div>