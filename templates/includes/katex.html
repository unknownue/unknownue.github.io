{% if config.extra.server_side_katex and get_env(name="GITHUB_ACTIONS", default="false") == "true" %}
    <link rel="stylesheet" href="{{ get_url(path = 'katex.min.css') | safe }}">
{% else %}
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css" as="style" onload="this.rel='stylesheet';">
    <script defer src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
    <script>
    window.addEventListener("DOMContentLoaded",()=>{
        // Render inline math ($$...$$) within regular text content
        // Skip elements that are inside code blocks
        document.querySelectorAll('p, li, td, h1, h2, h3, h4, h5, h6').forEach(element=>{
            // Skip if this element is inside a code block
            if(element.closest('pre, code')) return;

            element.innerHTML = element.innerHTML.replace(
                /\$\$([^\$]+)\$\$/g,
                (match,math)=>{
                    let span = document.createElement('span');
                    katex.render(math.trim(),span,{displayMode:false});
                    return span.outerHTML;
                }
            );
        });
    });
    </script>
{% endif %}