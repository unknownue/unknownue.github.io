+++
title = "#20897 Limit bloom_3d float output to two decimal places."
date = "2025-09-06T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-09/pr-20897-en-20250906" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-09/pr-20897-zh-cn-20250906" }}
+++

# Limit bloom_3d float output to two decimal places.

## 基本信息
- **标题**: Limit bloom_3d float output to two decimal places.
- **PR链接**: https://github.com/bevyengine/bevy/pull/20897
- **作者**: Breakdown-Dog
- **状态**: 已合并
- **标签**: D-Trivial, A-Rendering, C-Examples, S-Ready-For-Final-Review, M-Deliberate-Rendering-Change
- **创建时间**: 2025-09-06T04:22:23Z
- **合并时间**: 2025-09-06T05:00:48Z
- **合并人**: alice-i-cecile

## 描述翻译
**目标**  
通过将浮点数输出格式化为两位小数，提高 bloom_3d 示例中浮点数输出的可读性。  
这使得输出更清晰、更一致。

**解决方案**  
使用 Rust 的格式化语法（例如 `{:.2}`）确保浮点数精确显示两位小数。  
将此应用于 bloom_3d 示例中所有相关的打印或调试输出行。

## 本次 Pull Request 的故事

这个 PR 解决了一个简单但影响用户体验的问题。在 Bevy 引擎的 `bloom_3d` 示例中，各种 bloom 效果参数的浮点数值以默认格式显示，导致小数点后位数不一致，视觉效果杂乱。

问题出现在示例的 UI 文本显示部分。当用户通过键盘调整 bloom 参数时，屏幕上的数值会实时更新。由于浮点数的默认显示格式会保留所有有效数字，导致不同参数的显示长度不一致，阅读体验较差。

开发者采用了一个直接有效的解决方案：使用 Rust 的标准格式化功能。通过在 format! 宏中使用 `{:.2}` 格式说明符，将所有相关的浮点数值统一格式化为两位小数。这种方法的优势在于：
- 保持代码简洁，不需要引入额外依赖
- 使用 Rust 标准库功能，确保兼容性
- 精确控制显示格式，避免浮点数精度问题带来的显示不一致

具体实现涉及修改 `update_bloom_settings` 函数中的多个文本生成语句。每个显示浮点数值的 format! 调用都添加了精度限制，确保所有数值显示的一致性。

这个改动虽然简单，但对用户体验有实际改善。现在所有数值都以统一的格式显示，更容易快速读取和比较不同参数的值。这种关注细节的改进体现了对代码质量的重视，即使是示例代码也应该保持高标准的可读性。

从工程角度看，这个 PR 展示了如何通过最小的代码改动解决实际问题。它不需要复杂的架构变更或性能优化，而是专注于改善开发者与示例交互的体验。这种改进对于示例代码尤其重要，因为清晰的输出有助于用户更好地理解参数调整的效果。

## 可视化表示

```mermaid
graph LR
    A[bloom_3d示例] --> B[update_bloom_settings函数]
    B --> C[浮点数格式化]
    C --> D[UI文本显示]
```

## 关键文件变更

- `examples/3d/bloom_3d.rs` (+10/-7)

**变更描述**: 此文件中的 `update_bloom_settings` 函数负责生成显示 bloom 参数的 UI 文本。修改将所有浮点数值的显示格式统一为两位小数，提高了输出的可读性和一致性。

**代码变更**:
```rust
// 文件: examples/3d/bloom_3d.rs
// 修改前:
text.push_str(&format!("(Q/A) Intensity: {}\n", bloom.intensity));
text.push_str(&format!("(W/S) Low-frequency boost: {}\n", bloom.low_frequency_boost));
text.push_str(&format!("(E/D) Low-frequency boost curvature: {}\n", bloom.low_frequency_boost_curvature));
text.push_str(&format!("(R/F) High-pass frequency: {}\n", bloom.high_pass_frequency));
text.push_str(&format!("(Y/H) Threshold: {}\n", bloom.prefilter.threshold));
text.push_str(&format!("(U/J) Threshold softness: {}\n", bloom.prefilter.threshold_softness));
text.push_str(&format!("(I/K) Horizontal Scale: {}\n", bloom.scale.x));

// 修改后:
text.push_str(&format!("(Q/A) Intensity: {:.2}\n", bloom.intensity));
text.push_str(&format!("(W/S) Low-frequency boost: {:.2}\n", bloom.low_frequency_boost));
text.push_str(&format!("(E/D) Low-frequency boost curvature: {:.2}\n", bloom.low_frequency_boost_curvature));
text.push_str(&format!("(R/F) High-pass frequency: {:.2}\n", bloom.high_pass_frequency));
text.push_str(&format!("(Y/H) Threshold: {:.2}\n", bloom.prefilter.threshold));
text.push_str(&format!("(U/J) Threshold softness: {:.2}\n", bloom.prefilter.threshold_softness));
text.push_str(&format!("(I/K) Horizontal Scale: {:.2}\n", bloom.scale.x));
```

这些变更通过添加 `{:.2}` 格式说明符，将所有浮点数值的显示限制为两位小数，使 UI 输出更加整洁一致。

## 延伸阅读

- [Rust 格式化语法文档](https://doc.rust-lang.org/std/fmt/index.html) - 详细了解 Rust 的格式化功能
- [Bevy UI 系统](https://bevyengine.org/learn/books/0.14/programming/ui/) - 了解 Bevy 引擎的 UI 实现方式
- [浮点数精度处理最佳实践](https://floating-point-gui.de/) - 关于浮点数处理和显示的综合指南