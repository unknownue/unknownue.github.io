+++
title = "#20847 Add `#[doc(fake_variadic)]` to some places where it's missing"
date = "2025-09-04T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-09/pr-20847-en-20250904" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-09/pr-20847-zh-cn-20250904" }}
labels = ["C-Docs", "A-Rendering", "A-ECS", "D-Straightforward"]
+++

# Add `#[doc(fake_variadic)]` to some places where it's missing

## Basic Information
- **Title**: Add `#[doc(fake_variadic)]` to some places where it's missing
- **PR Link**: https://github.com/bevyengine/bevy/pull/20847
- **Author**: chescock
- **Status**: MERGED
- **Labels**: C-Docs, A-Rendering, A-ECS, S-Ready-For-Final-Review, X-Uncontroversial, D-Straightforward
- **Created**: 2025-09-03T15:32:31Z
- **Merged**: 2025-09-03T23:50:06Z
- **Merged By**: alice-i-cecile

## Description Translation
# Objective

See #14697. We use `#[doc(fake_variadic)]` for most of our trait impls for tuples, but it's missing for a few, mostly traits that were added after #14703:

* `BundleEffect`
* `NoBundleEffect`
* `ReadOnlyQueryData`
* `ReleaseStateQueryData`
* `SpawnableList`
* `SpecializerKey`

## Solution

Pass `#[doc(fake_variadic)]` through `all_tuples!` for those trait impls.

## Testing

Ran `RUSTFLAGS='--cfg docsrs_dep' RUSTDOCFLAGS='--cfg=docsrs' cargo +nightly doc`

<img width="649" height="143" alt="image" src="https://github.com/user-attachments/assets/4ef0c53d-fe22-4f39-b9c7-c6df9a48e791" />

<img width="910" height="218" alt="image" src="https://github.com/user-attachments/assets/2eaf8c0e-48fe-4dfe-8691-a23ca6f2d1f0" />

<img width="696" height="153" alt="image" src="https://github.com/user-attachments/assets/0909a663-7c32-45ce-af12-ef789941ef5b" />

## The Story of This Pull Request

This PR addresses a documentation consistency issue in the Bevy engine. The problem was that several tuple implementations for various traits were missing the `#[doc(fake_variadic)]` attribute, which affects how Rustdoc displays these implementations in generated documentation.

The issue originated from PR #14697, which initially implemented the `#[doc(fake_variadic)]` attribute for most tuple trait implementations. However, several traits were added later (#14703) and their tuple implementations didn't receive the same documentation treatment. This included traits like `BundleEffect`, `NoBundleEffect`, `ReadOnlyQueryData`, `ReleaseStateQueryData`, `SpawnableList`, and `SpecializerKey`.

The solution was straightforward: modify the macro invocations to pass through the `#[doc(fake_variadic)]` attribute to these missing implementations. This required updating the macro definitions to accept meta attributes and then adding the attribute to the `all_tuples!` macro calls.

The implementation changes were minimal but targeted. Each modified file followed a similar pattern:

1. The macro definition was updated to accept optional meta attributes
2. The macro implementation was modified to apply these attributes to the generated code
3. The `all_tuples!` invocation was updated to include the `#[doc(fake_variadic)]` attribute

This approach ensures that when Rustdoc generates documentation for these tuple implementations, they will appear as variadic implementations rather than showing separate implementations for each tuple arity (e.g., for 1-tuple, 2-tuple, etc.), making the documentation cleaner and more intuitive for developers.

The testing process involved running a specific cargo doc command with Rustdoc-specific flags to verify that the documentation now correctly displays these implementations as variadic. The provided screenshots confirm that the documentation now properly shows the fake variadic implementations.

## Visual Representation

```mermaid
graph TD
    A[PR #20847] --> B[Add #[doc(fake_variadic)]]
    B --> C[BundleEffect/NoBundleEffect impls]
    B --> D[ReadOnlyQueryData impls]
    B --> E[ReleaseStateQueryData impls]
    B --> F[SpawnableList impls]
    B --> G[SpecializerKey impls]
    
    C --> H[crates/bevy_ecs/src/bundle/impls.rs]
    D --> I[crates/bevy_ecs/src/query/fetch.rs]
    E --> I
    F --> J[crates/bevy_ecs/src/spawn.rs]
    G --> K[crates/bevy_render/src/render_resource/specializer.rs]
```

## Key Files Changed

### `crates/bevy_ecs/src/bundle/impls.rs` (+10/-2)
**Purpose**: Add `#[doc(fake_variadic)]` to `BundleEffect` and `NoBundleEffect` tuple implementations

**Key Changes**:
```rust
// Before:
all_tuples!(after_effect_impl, 0, 15, P);

// After:
all_tuples!(
    #[doc(fake_variadic)]
    after_effect_impl,
    0,
    15,
    P
);
```

### `crates/bevy_ecs/src/query/fetch.rs` (+2/-0)
**Purpose**: Add `#[doc(fake_variadic)]` to `ReadOnlyQueryData` and `ReleaseStateQueryData` tuple implementations

**Key Changes**:
```rust
// Added attribute to ReadOnlyQueryData implementation
$(#[$meta])*
unsafe impl<$($name: ReadOnlyQueryData),*> ReadOnlyQueryData for ($($name,)*) {}

// Added attribute to ReleaseStateQueryData implementation  
$(#[$meta])*
impl<$($name: ReleaseStateQueryData),*> ReleaseStateQueryData for ($($name,)*) {
```

### `crates/bevy_ecs/src/spawn.rs` (+9/-2)
**Purpose**: Add `#[doc(fake_variadic)]` to `SpawnableList` tuple implementations

**Key Changes**:
```rust
// Before:
all_tuples!(spawnable_list_impl, 0, 12, P);

// After:
all_tuples!(
    #[doc(fake_variadic)]
    spawnable_list_impl,
    0,
    12,
    P
);
```

### `crates/bevy_render/src/render_resource/specializer.rs` (+9/-3)
**Purpose**: Add `#[doc(fake_variadic)]` to `SpecializerKey` tuple implementations

**Key Changes**:
```rust
// Before:
all_tuples!(impl_specialization_key_tuple, 0, 12, T);

// After:
all_tuples!(
    #[doc(fake_variadic)]
    impl_specialization_key_tuple,
    0,
    12,
    T
);
```

## Further Reading

- [Rustdoc Attributes Documentation](https://doc.rust-lang.org/rustdoc/write-documentation/advanced-features.html)
- [Bevy's all_tuples Macro](https://github.com/bevyengine/bevy/blob/main/crates/bevy_utils/src/lib.rs#L67)
- [Original PR #14697](https://github.com/bevyengine/bevy/pull/14697) that introduced the fake_variadic pattern
- [Rust RFC on Variadics](https://github.com/rust-lang/rfcs/issues/376) for context on variadic traits in Rust