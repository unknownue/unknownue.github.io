+++
title = "#20754 Add a `WinitSettings::continuous` constructor"
date = "2025-09-11T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-09/pr-20754-en-20250911" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-09/pr-20754-zh-cn-20250911" }}
labels = ["D-Trivial", "A-Windowing", "C-Usability"]
+++

# Add a `WinitSettings::continuous` constructor

## Basic Information
- **Title**: Add a `WinitSettings::continuous` constructor
- **PR Link**: https://github.com/bevyengine/bevy/pull/20754
- **Author**: ickshonpe
- **Status**: MERGED
- **Labels**: D-Trivial, A-Windowing, C-Usability, S-Ready-For-Final-Review
- **Created**: 2025-08-25T17:03:02Z
- **Merged**: 2025-09-11T20:11:09Z
- **Merged By**: alice-i-cecile

## Description Translation
此PR的目标是为`WinitSettings`添加一个用于压力测试中连续更新模式的构造函数。

解决方案是添加该构造函数。

## The Story of This Pull Request

这个PR源于一个简单但常见的需求：在Bevy的压力测试示例中，开发者需要配置应用程序以尽可能快的速度运行更新循环。在Bevy的窗口管理系统中，这通过设置`WinitSettings`资源来实现，具体是将`focused_mode`和`unfocused_mode`都设置为`UpdateMode::Continuous`。

在修改之前，每个压力测试示例都需要重复编写相同的配置代码：

```rust
.insert_resource(WinitSettings {
    focused_mode: UpdateMode::Continuous,
    unfocused_mode: UpdateMode::Continuous,
})
```

这种重复代码不仅增加了维护成本，还降低了代码的可读性。开发者需要理解`UpdateMode`枚举和`WinitSettings`结构体的细节才能明白这段代码的意图。

PR作者采取了直接有效的解决方案：在`WinitSettings`结构体上添加一个名为`continuous`的关联函数（构造函数），返回预先配置好的实例。这个函数封装了重复的配置逻辑，提供了更清晰的API：

```rust
pub fn continuous() -> Self {
    WinitSettings {
        focused_mode: UpdateMode::Continuous,
        unfocused_mode: UpdateMode::Continuous,
    }
}
```

这个改动虽然简单，但体现了良好的API设计原则。它提供了适当的抽象层级，让使用者不需要关心内部实现细节，只需表达"我想要连续更新模式"的意图。

修改的第二步是更新所有压力测试示例，用新的构造函数替换原有的详细配置。这个改动影响了12个示例文件，包括`bevymark.rs`、`many_animated_sprites.rs`、`many_buttons.rs`等。

这种修改带来了几个明显好处：
1. **代码简洁性**：每处使用从5行减少到1行
2. **一致性**：所有示例使用相同的方式配置更新模式
3. **可维护性**：未来如果需要修改连续模式的配置，只需修改一处
4. **可读性**：`WinitSettings::continuous()`的意图比详细的结构体初始化更清晰

从技术角度看，这个PR也展示了如何通过小规模的API改进来提升整个代码库的质量。它没有改变任何核心逻辑或性能特征，只是提供了更好的开发体验。

## Visual Representation

```mermaid
graph LR
    A[WinitSettings 结构体] --> B[新增 continuous() 构造函数]
    B --> C[压力测试示例]
    B --> D[未来其他使用场景]
    
    subgraph "之前的状态"
        E[示例重复配置代码]
    end
    
    subgraph "之后的状态"
        F[使用简洁的构造函数]
    end
    
    E --> F
```

## Key Files Changed

### `crates/bevy_winit/src/winit_config.rs` (+10/-0)
新增了`continuous`构造函数，提供创建连续更新模式配置的简便方法。

```rust
// 新增的代码：
/// The application will update as fast possible.
///
/// Uses [`Continuous`](UpdateMode::Continuous) regardless of whether windows have focus.
pub fn continuous() -> Self {
    WinitSettings {
        focused_mode: UpdateMode::Continuous,
        unfocused_mode: UpdateMode::Continuous,
    }
}
```

### 压力测试示例文件（12个文件）
这些文件都进行了相同的模式替换，从详细配置改为使用新的构造函数。

**修改前：**
```rust
.insert_resource(WinitSettings {
    focused_mode: UpdateMode::Continuous,
    unfocused_mode: UpdateMode::Continuous,
})
```

**修改后：**
```rust
.insert_resource(WinitSettings::continuous())
```

受影响的主要文件包括：
- `examples/stress_tests/bevymark.rs` (+2/-5)
- `examples/stress_tests/many_animated_sprites.rs` (+2/-5)
- `examples/stress_tests/many_buttons.rs` (+2/-5)
- `examples/stress_tests/many_foxes.rs` (+2/-5)

## Further Reading

- [Bevy官方文档 - WinitSettings](https://docs.rs/bevy/latest/bevy/winit/struct.WinitSettings.html)
- [Rust编程语言 - 关联函数](https://kaisery.github.io/trpl-zh-cn/ch05-03-method-syntax.html#关联函数)
- [API设计原则 - 简洁性与一致性](https://rust-lang.github.io/api-guidelines/naming.html)