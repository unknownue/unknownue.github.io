+++
title = "#22337 Use toggle function to pause/unpause"
date = "2026-01-01T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-01/pr-22337-en-20260101" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-01/pr-22337-zh-cn-20260101" }}
+++

# Title
Use toggle function to pause/unpause

## Basic Information
- **Title**: Use toggle function to pause/unpause
- **PR Link**: https://github.com/bevyengine/bevy/pull/22337
- **Author**: GitGhillie
- **Status**: MERGED
- **Labels**: None
- **Created**: 2026-01-01T14:34:19Z
- **Merged**: 2026-01-01T17:57:49Z
- **Merged By**: mockersf

## Description Translation
目标

避免代码重复

解决方案

使用新添加的 toggle 函数

测试

运行了示例

## The Story of This Pull Request

这个Pull Request的故事很简单，核心是关于代码简洁性和遵循DRY（Don't Repeat Yourself）原则的一个小但典型的改进。开发者注意到在Bevy引擎的两个示例文件（`2d_gizmos.rs` 和 `3d_gizmos.rs`）中，实现通过空格键暂停/取消暂停虚拟时间（virtual time）的逻辑存在重复的模式。

**原来的问题**是代码逻辑重复。在两个不同的地方，开发者都写了一段相同的条件判断语句来切换虚拟时间的暂停状态。具体来说，每次按下空格键时，代码都需要检查当前虚拟时间是否处于暂停状态 (`is_paused()`)，然后相应地调用 `unpause()` 或 `pause()` 方法。这种模式不仅增加了代码行数，更重要的是，它在两个独立的文件中创建了完全相同的逻辑副本。从维护角度看，这意味着如果未来切换逻辑需要修改（例如，添加新的状态或修改行为），开发者必须在两个地方进行相同的更改，这增加了出错的风险和工作量。

**解决方案**是利用一个新引入的 `toggle()` 方法。这个方法抽象了“切换”状态的核心逻辑，将其封装在 `VirtualTime` 类型的实现内部。这个 `toggle()` 方法的实现很可能与之前手动编写的条件判断逻辑完全相同，但它提供了一个更清晰、意图更明确的API。开发者不再需要关心内部的状态检查逻辑，只需要调用 `toggle()` 即可。这正是面向对象和API设计中“封装”原则的一个体现：将状态变化的行为细节隐藏在类型内部，对外提供简洁的操作接口。

**实现细节**上，这个PR所做的更改非常直接和微小。在两处相同的位置，它将原有的四到五行代码替换为单行调用。这是一个典型的“提取方法”重构（Extract Method Refactoring），只不过这个方法是已经存在于依赖类型中的，而非由本次PR新创建。这种更改是向后兼容的，没有改变任何公开API的行为，只是改变了内部实现方式，使其更优。从工程角度看，这是一个低风险、高收益的更改：它几乎不可能引入新的bug（因为逻辑被封装在已经过测试的 `toggle()` 方法中），同时显著提高了代码的简洁性和可维护性。

**这个更改带来的启示**是，即使在示例代码中，也应该遵循良好的工程实践。示例代码通常是新用户学习和参考的第一手资料，保持其简洁和最佳实践对于项目生态的健康至关重要。此外，这个PR也展示了Bevy代码库的持续演进——`VirtualTime` 类型新增了 `toggle()` 这个便利方法，而其他代码（包括示例）应该及时跟进使用这些新工具，以保持代码库的现代化和一致性。

## Visual Representation

这个PR的改动结构非常简单，主要涉及两个示例文件调用同一个新方法。

```mermaid
graph TD
    A[KeyCode::Space Pressed] --> B[toggle() 函数调用];
    B --> C[2d_gizmos.rs 示例];
    B --> D[3d_gizmos.rs 示例];
    C --> E{虚拟时间状态切换};
    D --> E;
    E -->|状态切换| F[VirtualTime 内部状态];
```

## Key Files Changed

这个PR修改了两个示例文件，目的是消除重复代码并使用新的 `toggle` 方法。

1.  **文件：** `examples/gizmos/2d_gizmos.rs` (+1/-5)
    *   **描述：** 修改了2D gizmos示例中处理空格键暂停虚拟时间的逻辑。
    *   **关键修改：** 将原有的条件判断逻辑替换为对 `virtual_time.toggle()` 的单一调用。

    ```rust
    // File: examples/gizmos/2d_gizmos.rs
    // 修改前:
    if keyboard.just_pressed(KeyCode::Space) {
        if virtual_time.is_paused() {
            virtual_time.unpause();
        } else {
            virtual_time.pause();
        }
    }
    
    // 修改后:
    if keyboard.just_pressed(KeyCode::Space) {
        virtual_time.toggle();
    }
    ```

2.  **文件：** `examples/gizmos/3d_gizmos.rs` (+1/-5)
    *   **描述：** 修改了3D gizmos示例中处理空格键暂停虚拟时间的逻辑。
    *   **关键修改：** 与2D示例完全相同的重构，使用 `toggle()` 方法。

    ```rust
    // File: examples/gizmos/3d_gizmos.rs
    // 修改前:
    if keyboard.just_pressed(KeyCode::Space) {
        if virtual_time.is_paused() {
            virtual_time.unpause();
        } else {
            virtual_time.pause();
        }
    }
    
    // 修改后:
    if keyboard.just_pressed(KeyCode::Space) {
        virtual_time.toggle();
    }
    ```

**与PR目标的关系：** 这两个文件的修改直接实现了PR描述中的目标——“避免代码重复”和“使用新添加的toggle函数”。每个文件都减少了4行代码，将原来的显式状态检查逻辑替换为更声明式的单行调用，使代码更易读、更易维护。

## Further Reading

1.  **Bevy 时间系统文档:** 了解 `VirtualTime` 资源以及 `Time`、`FixedTime` 等其他与时间相关的组件，对于理解游戏循环和状态管理至关重要。
2.  **状态机模式:** `toggle()` 函数本质上是一个简单的二进制状态机（暂停/运行）。学习状态机模式有助于设计更复杂的状态管理逻辑。
3.  **重构：改善既有代码的设计（Martin Fowler 著）:** 本书是软件工程领域的经典，其中“提取方法”和“消除重复代码”是核心的重构技巧，与本PR的精神完全一致。
4.  **Rust API 设计指南:** 了解如何设计清晰、符合人体工程学且不易误用的API。`toggle()` 方法的引入就是一个很好的API改进案例。

# Full Code Diff
diff --git a/examples/gizmos/2d_gizmos.rs b/examples/gizmos/2d_gizmos.rs
index 9f060e6d20c48..50bd46d3b010d 100644
--- a/examples/gizmos/2d_gizmos.rs
+++ b/examples/gizmos/2d_gizmos.rs
@@ -210,10 +210,6 @@ fn update_config(
         };
     }
     if keyboard.just_pressed(KeyCode::Space) {
-        if virtual_time.is_paused() {
-            virtual_time.unpause();
-        } else {
-            virtual_time.pause();
-        }
+        virtual_time.toggle();
     }
 }
diff --git a/examples/gizmos/3d_gizmos.rs b/examples/gizmos/3d_gizmos.rs
index 56478e4fb1c77..aac66225779b8 100644
--- a/examples/gizmos/3d_gizmos.rs
+++ b/examples/gizmos/3d_gizmos.rs
@@ -292,10 +292,6 @@ fn update_config(
         config_store.config_mut::<AabbGizmoConfigGroup>().1.draw_all ^= true;
     }
     if keyboard.just_pressed(KeyCode::Space) {
-        if virtual_time.is_paused() {
-            virtual_time.unpause();
-        } else {
-            virtual_time.pause();
-        }
+        virtual_time.toggle();
     }
 }
