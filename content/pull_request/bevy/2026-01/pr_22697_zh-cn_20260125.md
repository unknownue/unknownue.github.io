+++
title = "#22697 Update `sysinfo` version to `0.38.0"
date = "2026-01-25T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-01/pr-22697-en-20260125" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-01/pr-22697-zh-cn-20260125" }}
+++

# Update `sysinfo` version to `0.38.0`

## Basic Information
- **标题**: Update `sysinfo` version to `0.38.0`
- **PR 链接**: https://github.com/bevyengine/bevy/pull/22697
- **作者**: GuillaumeGomez
- **状态**: 已合并
- **标签**: C-Dependencies, S-Ready-For-Final-Review
- **创建时间**: 2026-01-25T15:07:32Z
- **合并时间**: 2026-01-25T22:00:09Z
- **合并者**: alice-i-cecile

## 描述翻译

这个新版本修复了一些bug并增加了对`NetBSD`的支持。

## 本次 Pull Request 的故事

这个 PR 的核心是一个依赖版本更新，它展示了在大型项目（如 Bevy 游戏引擎）中维护依赖项的一个常规但重要的场景。Bevy 的 `bevy_diagnostic` crate 使用 `sysinfo` 这个库来收集系统信息（如 CPU、内存使用情况）。为了修复已知问题并扩展平台支持，需要将 `sysinfo` 从 `0.37.0` 版本升级到 `0.38.0`。

**问题与背景**
依赖 `sysinfo` `0.37.0` 版本存在一些待修复的 bug。此外，该版本不支持 NetBSD 操作系统，这限制了 Bevy 诊断功能在该平台上的可用性。保持依赖项更新对于获得错误修复、性能改进和扩大兼容性范围至关重要，这是项目维护的一项常规任务。

**解决方案与实现**
解决方案非常直接：更新 Cargo.toml 文件中的版本号。然而，具体的实现细节反映了 Bevy 对跨平台兼容性的细致处理。`bevy_diagnostic` 并非在所有平台上都启用 `sysinfo` 功能，而是使用了 Cargo 的条件依赖特性。

查看修改的代码，可以看到两处依赖声明被更新：
1.  针对 macOS 的配置：将版本号从 `"0.37.0"` 更新为 `"0.38.0"`。这里的 `features` 列表包含了 `"apple-app-store"`，这是为了适配苹果应用商店的特殊环境。
2.  针对 Linux、Windows、Android、FreeBSD 的配置：同样更新了版本号。更重要的是，在 `target_os` 的条件列表中添加了 `target_os = "netbsd"`，并将版本号更新为 `"0.38.0"`。这行代码的修改直接实现了 PR 描述中提到的“增加对 NetBSD 的支持”。

```toml
# Before (for non-macOS platforms):
[target.'cfg(any(target_os = "linux", target_os = "windows", target_os = "android", target_os = "freebsd"))'.dependencies]
sysinfo = { version = "0.37.0", ... }

# After:
[target.'cfg(any(target_os = "linux", target_os = "windows", target_os = "android", target_os = "freebsd", target_os = "netbsd"))'.dependencies]
sysinfo = { version = "0.38.0", ... }
```

这种条件依赖管理是一种最佳实践。它确保了 `sysinfo` 库及其依赖项只在真正需要的目标平台上被引入编译过程，避免了在不支持的系统上引入不必要的编译开销或潜在的编译错误。

**技术洞察**
本次更新涉及一个被称为“条件编译”或“特性门控”（feature gating）的模式。通过 Cargo.toml 中的 `target.'cfg(...)'.dependencies` 语法，开发者可以根据目标操作系统、架构等条件来声明依赖。这种做法有助于保持代码库的整洁，并确保跨平台构建的可靠性。`sysinfo` 库本身也通过 `default-features = false` 和手动指定 `features` 的方式，来精确控制在不同平台上启用的功能。

**影响**
这次更新带来的影响是双重的：
1.  **功能扩展**：Bevy 的诊断系统现在可以在 NetBSD 上运行，拓宽了引擎的支持范围。
2.  **质量提升**：通过集成 `sysinfo` `0.38.0` 版本中的 bug 修复，Bevy 依赖的底层系统信息查询库变得更稳定、更可靠，间接提升了 `bevy_diagnostic` 的稳健性。

这是一个典型的依赖维护操作。它不改变 Bevy 的公共 API，也不涉及游戏逻辑，但对于确保引擎底层基础设施的健康和跨平台能力是必要的。它也提醒我们，在配置跨平台项目的依赖时，需要仔细考虑不同操作系统的差异性。

## 可视化表示

```mermaid
graph TD
    subgraph “Bevy Engine”
        A[bevy_diagnostic Crate] -->|可选依赖| B[sysinfo库]
    end
    
    B -->|版本 0.38.0| C[修复已知Bug]
    B -->|版本 0.38.0| D[新增 NetBSD 支持]
    
    A -->|条件编译| E[macOS 目标]
    A -->|条件编译| F[Linux/Windows/Android/FreeBSD/NetBSD 目标]
    
    E --> G[启用 apple-app-store 特性]
    F --> H[启用 system 特性]
```

## 关键文件更改

**1. `crates/bevy_diagnostic/Cargo.toml`**
这是本次 PR 修改的唯一文件。它更新了 `sysinfo` 库的依赖版本，并扩展了该库在非 macOS 平台上的支持列表，将 NetBSD 包含了进去。

**关键修改：**
```toml
# 修改前（macOS部分）：
sysinfo = { version = "0.37.0", optional = true, default-features = false, features = [
  "apple-app-store",
  "system",
] }

# 修改后（macOS部分）：
sysinfo = { version = "0.38.0", optional = true, default-features = false, features = [
  "apple-app-store",
  "system",
] }

# 修改前（其他平台部分）：
[target.'cfg(any(target_os = "linux", target_os = "windows", target_os = "android", target_os = "freebsd"))'.dependencies]
sysinfo = { version = "0.37.0", optional = true, default-features = false, features = [
  "system",
] }

# 修改后（其他平台部分）：
[target.'cfg(any(target_os = "linux", target_os = "windows", target_os = "android", target_os = "freebsd", target_os = "netbsd"))'.dependencies]
sysinfo = { version = "0.38.0", optional = true, default-features = false, features = [
  "system",
] }
```

**关系说明：**
这个文件是 `bevy_diagnostic` crate 的依赖清单。所有的修改都集中在对 `sysinfo` 这一外部库的声明上。版本号的更新是为了获取修复和新功能；在配置条件中添加 `target_os = "netbsd"` 是为了让该 crate（以及最终使用它的 Bevy 应用）能够在 NetBSD 操作系统上编译并启用系统诊断功能。这完全符合 PR 描述的目标。

## 进一步阅读

1.  **`sysinfo` 库文档与发布说明**: 要了解 `0.38.0` 版本具体修复了哪些 bug 以及完整的变更列表，可以查看其官方仓库的发布页面或 `CHANGELOG.md` 文件。
2.  **Cargo 条件依赖官方文档**: 关于如何在 `Cargo.toml` 中使用 `cfg()` 语法进行条件编译和依赖管理，可以参考 Rust Cargo 官方手册中的 [指定依赖项](https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html) 章节，特别是关于“平台特定依赖”的部分。
3.  **Bevy 诊断系统**: 想了解 `bevy_diagnostic` 如何在 Bevy 引擎中实际被使用，可以查阅 Bevy 官方示例中的诊断相关示例代码。

# Full Code Diff
diff --git a/crates/bevy_diagnostic/Cargo.toml b/crates/bevy_diagnostic/Cargo.toml
index 2c7a66a46d0c9..df63c70edc86c 100644
--- a/crates/bevy_diagnostic/Cargo.toml
+++ b/crates/bevy_diagnostic/Cargo.toml
@@ -70,14 +70,14 @@ log = { version = "0.4", default-features = false }
 # macOS
 [target.'cfg(all(target_os="macos"))'.dependencies]
 # Some features of sysinfo are not supported by apple. This will disable those features on apple devices
-sysinfo = { version = "0.37.0", optional = true, default-features = false, features = [
+sysinfo = { version = "0.38.0", optional = true, default-features = false, features = [
   "apple-app-store",
   "system",
 ] }
 
-# Only include when on linux/windows/android/freebsd
-[target.'cfg(any(target_os = "linux", target_os = "windows", target_os = "android", target_os = "freebsd"))'.dependencies]
-sysinfo = { version = "0.37.0", optional = true, default-features = false, features = [
+# Only include when on linux/windows/android/freebsd/netbsd
+[target.'cfg(any(target_os = "linux", target_os = "windows", target_os = "android", target_os = "freebsd", target_os = "netbsd"))'.dependencies]
+sysinfo = { version = "0.38.0", optional = true, default-features = false, features = [
   "system",
 ] }
 
```