+++
title = "#22182 bevy_asset: support upgrading Reader to SeekableReader"
date = "2026-01-07T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-01/pr-22182-en-20260107" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-01/pr-22182-zh-cn-20260107" }}
labels = ["C-Feature", "A-Assets", "C-Usability", "S-Waiting-on-Author"]
+++

# Title
## Basic Information
- **Title**: bevy_asset: support upgrading Reader to SeekableReader
- **PR Link**: https://github.com/bevyengine/bevy/pull/22182
- **Author**: cart
- **Status**: MERGED
- **Labels**: C-Feature, A-Assets, C-Usability, S-Waiting-on-Author
- **Created**: 2025-12-18T01:22:30Z
- **Merged**: 2026-01-07T22:09:38Z
- **Merged By**: cart

## Description Translation
# Objective

#22104 added `AsyncSeek` support, but it has some downsides:

- It is very "loose": it relies on `AssetLoader` to "attest" that it needs the seek feature. However, AssetLoaders both have access to the `AsyncSeek` API no matter what (it is a supertrait of Reader), and AssetReaders provide `AsyncSeek` behavior even if it isn't requested. In practice this is likely to create situations where AssetLoaders don't request `AsyncSeek` and just rely on it being provided by default, causing unexpected incompatibilities when AssetLoader consumers try to use other AssetReaders that don't support AsyncSeek.
- It encourages building "fallback" behavior into the AssetReader in cases where AsyncSeek cannot be supported directly (ex: read the while contents into a Vec). From the perspective of loaders, this _silently_ changes the performance characteristics, and _forces_ a specific kind of fallback behavior. It would be better if the fallback behavior was in the hands of the AssetLoader.

## Solution

- Remove `ReaderRequiredFeatures` and associated functionality 
- Add a new `SeekableReader` trait, where `SeekableReader: Reader + AsyncSeek`.
- Add a new `Reader::seekable(&mut self) -> Result<&mut dyn SeekableReader, ReaderNotSeekableError>`, which can either fail or cast to `SeekableReader`, if that is supported.

```rust
let seekable_reader = reader.seekable()?;
seekable_reader.seek(SeekFrom::Start(10)).await?;
```

This gives `AssetLoader` implementers more clarity when it comes to `Reader` feature support, gives them more autonomy over fallback behavior,  makes our APIs more static, and cuts down on the complexity of the system as a whole.

## The Story of This Pull Request

The PR addresses a design issue in Bevy's asset system related to seeking functionality in asset readers. Previously, PR #22104 added `AsyncSeek` support through a feature-request system where `AssetLoader`s would declare what features they needed via `ReaderRequiredFeatures`. However, this approach had several problems that made the system fragile and prone to unexpected behavior.

The core issue was that `AssetLoader`s always had access to `AsyncSeek` methods because `Reader` was a subtrait of `AsyncSeek`, but they weren't required to declare when they needed seeking. This created a situation where loaders could accidentally depend on seeking functionality without explicitly requesting it, leading to runtime failures when used with asset readers that didn't support seeking. Additionally, the system encouraged asset readers to implement fallback behaviors (like reading entire files into memory) when seeking wasn't available, which could silently impact performance and wasn't under the control of the asset loader.

The solution proposed in this PR fundamentally changes how seeking capability is exposed. Instead of a feature-request system, we now have a capability-check system. The key changes are:

1. **Removing `ReaderRequiredFeatures` entirely**: This eliminates the feature negotiation layer and simplifies the API.
2. **Separating `Reader` from `AsyncSeek`**: The `Reader` trait no longer requires `AsyncSeek` as a supertrait.
3. **Adding a `SeekableReader` trait**: This is a marker trait for readers that support seeking: `SeekableReader: Reader + AsyncSeek`.
4. **Adding a conversion method**: `Reader::seekable()` allows asset loaders to check if a reader supports seeking and get a reference to it as a `SeekableReader`.

This approach gives asset loaders explicit control: they can check if seeking is available and implement their own fallback strategies if it's not. For example, an asset loader can choose to read the entire asset into a `VecReader` if the underlying reader doesn't support seeking, or it can fail with a clear error message.

The implementation involved updating every component in the asset system that interacted with the reader feature system. This included:
- Removing `ReaderRequiredFeatures` parameter from all `AssetReader::read()` methods
- Updating all existing `Reader` implementations to add the `seekable()` method
- Removing `reader_required_features()` methods from `AssetLoader` and `Process` traits
- Updating the asset processor and server to no longer handle feature requirements
- Adding a migration guide for users implementing custom readers

The changes are extensive but conceptually simple: we're replacing an implicit, opt-out system with an explicit, opt-in system for seeking functionality. This makes the API clearer, reduces complexity, and gives more control to asset loader authors.

## Visual Representation

```mermaid
graph TD
    A[AssetReader] --> B[produces]
    B --> C[Reader]
    C --> D{seekable()?}
    D -->|Yes| E[SeekableReader]
    D -->|No| F[Reader without seeking]
    E --> G[AsyncSeek]
    C --> H[AsyncRead]
    
    I[AssetLoader] --> J[calls seekable()]
    J --> K{check result}
    K -->|Success| L[use seeking]
    K -->|Failure| M[implement fallback]
```

## Key Files Changed

### `crates/bevy_asset/src/io/mod.rs` (+61/-94)
This is the core file where the trait definitions changed:

**Key changes:**
1. Removed `ReaderRequiredFeatures`, `SeekKind`, and `UnsupportedReaderFeature` error
2. Added `SeekableReader` trait and `ReaderNotSeekableError`
3. Changed `Reader` trait to no longer require `AsyncSeek`
4. Added `Reader::seekable()` method

```rust
// Before:
pub trait Reader: AsyncRead + AsyncSeek + Unpin + Send + Sync {
    // ... methods
}

pub struct ReaderRequiredFeatures {
    pub seek: SeekKind,
}

// After:
pub trait Reader: AsyncRead + Unpin + Send + Sync {
    fn seekable(&mut self) -> Result<&mut dyn SeekableReader, ReaderNotSeekableError>;
    // ... methods
}

pub trait SeekableReader: Reader + AsyncSeek {}
```

### `crates/bevy_asset/src/loader.rs` (+1/-32)
Removed the `reader_required_features` method from `AssetLoader` trait:

```rust
// Before:
pub trait AssetLoader: TypePath + Send + Sync + 'static {
    fn reader_required_features(_settings: &Self::Settings) -> ReaderRequiredFeatures {
        ReaderRequiredFeatures::default()
    }
    // ... other methods
}

// After:
pub trait AssetLoader: TypePath + Send + Sync + 'static {
    // reader_required_features removed
    // ... other methods
}
```

### `crates/bevy_asset/src/io/processor_gated.rs` (+10/-19)
Updated `TransactionLockedReader` to delegate the `seekable()` method:

```rust
// Added to TransactionLockedReader implementation:
fn seekable(&mut self) -> Result<&mut dyn SeekableReader, ReaderNotSeekableError> {
    self.reader.seekable()
}
```

### `crates/bevy_asset/src/processor/mod.rs` (+3/-25)
Removed feature requirement handling from the asset processor:

```rust
// Before (in process_asset):
let reader_features = processor.reader_required_features(settings)?;
let reader_for_process = reader.read(path, reader_features).await.map_err(reader_err)?;

// After:
let reader_for_process = reader.read(path).await.map_err(reader_err)?;
```

### `release-content/migration-guides/seekable_readers.md` (+28/-0)
Added migration guide for the breaking changes:

```markdown
---
title: Implementations of `Reader` now must implement `Reader::seekable`, and `AsyncSeekForward` is deleted.
pull_requests: [22182]
---

The `Reader` trait no longer requires implementing `AsyncSeekForward` and instead requires
implementing `Reader::seekable`, which will cast the `Reader` to `&mut dyn SeekableReader` if it
supports `AsyncSeek` (`SeekableReader: Reader + AsyncSeek`).

// ... example code
```

## Further Reading

- [Rust trait objects and dynamic dispatch](https://doc.rust-lang.org/book/ch17-02-trait-objects.html)
- [Bevy Asset System Documentation](https://bevyengine.org/learn/quick-start/assets/)
- [Async I/O in Rust with futures-lite](https://docs.rs/futures-lite/latest/futures_lite/)