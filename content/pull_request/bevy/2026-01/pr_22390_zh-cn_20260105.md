+++
title = "#22390"
date = "2026-01-05T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-01/pr-22390-en-20260105" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-01/pr-22390-zh-cn-20260105" }}
+++

# Title

## 基本資訊
- **標題**: Remove system fonts test code from the `text` example.
- **PR 連結**: https://github.com/bevyengine/bevy/pull/22390
- **作者**: ickshonpe
- **狀態**: MERGED
- **標籤**: D-Trivial, C-Examples, S-Ready-For-Final-Review, A-Text
- **建立時間**: 2026-01-05T18:15:35Z
- **合併時間**: 2026-01-05T23:20:00Z
- **合併者**: alice-i-cecile

## 描述翻譯
這個 PR 旨在從 `text` 範例中移除意外引入的系統字型測試程式碼。

### Objective 目標

在 #22156 中不小心在 `text` 範例裡包含了一些測試系統字型的簡單測試程式碼。

### Solution 解決方案

將範例的變更回退到之前的狀態。

## 這個 Pull Request 的故事

這個 PR 是關於修正一個意外引入的程式碼變更。在之前的 PR #22156 中，作者不小心在 `text` 範例中加入了測試系統字型的程式碼。這個範例的主要目的是展示 Bevy 的文字渲染功能，而不是測試系統字型加載。

問題的核心在於這些測試程式碼不應該出現在範例中。範例程式碼應該保持乾淨、聚焦於展示特定功能，而不是包含臨時測試或除錯程式碼。系統字型的測試程式碼會讓範例變得複雜，分散使用者對核心功能的注意力。

從技術角度來看，原先的變更包含了兩個部分：首先引入了 `CosmicFontSystem` 的 import，然後在應用程式啟動時加載系統字型。這會改變範例的執行行為，使其依賴於作業系統的字型，而不是範例內建的資源。這樣的變更有幾個問題：

1. **可重現性**：依賴系統字型會導致範例在不同系統上顯示不同的結果
2. **清晰性**：範例應該使用明確載入的資源，而不是依賴系統環境
3. **焦點性**：`text` 範例應該專注於展示 Bevy 的文字系統功能，而不是測試系統字型加載

作者採取了最直接有效的解決方案：完全回退這些變更。這包括：
- 移除 `CosmicFontSystem` 的 import
- 移除在 `main` 函數中加載系統字型的程式碼
- 將字型從系統字型名稱改回使用資源檔案

這種回退做法是合適的，因為：
1. 範例應該保持簡單和可重現
2. 系統字型加載功能如果確實需要測試，應該放在專門的測試程式碼中
3. 範例的目的是展示功能，而不是測試邊緣情況

從工程實踐來看，這個 PR 展示了幾個重要原則：
- 範例程式碼應該保持乾淨和聚焦
- 臨時測試程式碼不應該提交到主要程式碼庫
- 當發現意外引入的變更時，及時修正比保留不適當的程式碼更好

這個修正雖然簡單，但對於維護程式碼庫的質量很重要。它確保了 `text` 範例繼續作為一個清晰、可靠的功能展示，而不是一個混雜了測試程式碼的混合體。

## 視覺化表示

```mermaid
graph TD
    A[text 範例] --> B[展示文字渲染功能]
    A --> C[使用資源字型]
    C --> D[fonts/FiraSans-Bold.ttf]
    A -.->|被意外加入| E[系統字型測試程式碼]
    E --> F[CosmicFontSystem]
    E --> G[load_system_fonts()]
    E --> H["Comic Sans MS"]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#f96,stroke:#333,stroke-width:2px
```

## 主要變更的檔案

### `examples/ui/text.rs` (+2/-6)

這個檔案是 Bevy UI 系統的文字範例。變更的主要目的是移除意外引入的系統字型測試程式碼，讓範例回歸到使用預設的資源載入機制。

**關鍵變更：**

1. **移除不必要的 import**：
```rust
// 之前:
use bevy::text::{CosmicFontSystem, FontFeatureTag, FontFeatures, Underline};

// 之後:
use bevy::text::{FontFeatureTag, FontFeatures, Underline};
```

2. **移除系統字型加載程式碼**：
```rust
// 之前:
fn main() {
    let mut app = App::new();
    app.add_plugins((DefaultPlugins, FrameTimeDiagnosticsPlugin::default()))
        .add_systems(Startup, setup)
        .add_systems(Update, (text_update_system, text_color_system));

    let mut f = app.world_mut().resource_mut::<CosmicFontSystem>();
    f.db_mut().load_system_fonts();

    app.run();
}
```

```rust
// 之後:
fn main() {
    let mut app = App::new();
    app.add_plugins((DefaultPlugins, FrameTimeDiagnosticsPlugin::default()))
        .add_systems(Startup, setup)
        .add_systems(Update, (text_update_system, text_color_system));
    
    app.run();
}
```

3. **將字型改回使用資源檔案**：
```rust
// 之前:
TextFont {
    // This font is loaded and will be used instead of the default font.
    font: "Comic Sans MS".into(),
    font_size: 67.0,
    ..default()
},
```

```rust
// 之後:
TextFont {
    // This font is loaded and will be used instead of the default font.
    font: asset_server.load("fonts/FiraSans-Bold.ttf").into(),
    font_size: 67.0,
    ..default()
},
```

這些變更確保了範例：
1. 使用穩定的資源載入機制，而不是依賴系統字型
2. 在不同環境下有相同的表現
3. 保持程式碼的清晰和可維護性

## 完整程式碼差異
```diff
diff --git a/examples/ui/text.rs b/examples/ui/text.rs
index 87f235b5eb588..65f525994594d 100644
--- a/examples/ui/text.rs
+++ b/examples/ui/text.rs
@@ -7,7 +7,7 @@ use bevy::{
     color::palettes::css::GOLD,
     diagnostic::{DiagnosticsStore, FrameTimeDiagnosticsPlugin},
     prelude::*,
-    text::{CosmicFontSystem, FontFeatureTag, FontFeatures, Underline},
+    text::{FontFeatureTag, FontFeatures, Underline},
 };
 
 fn main() {
@@ -15,10 +15,6 @@ fn main() {
     app.add_plugins((DefaultPlugins, FrameTimeDiagnosticsPlugin::default()))
         .add_systems(Startup, setup)
         .add_systems(Update, (text_update_system, text_color_system));
-
-    let mut f = app.world_mut().resource_mut::<CosmicFontSystem>();
-    f.db_mut().load_system_fonts();
-
     app.run();
 }
 
@@ -40,7 +36,7 @@ fn setup(mut commands: Commands, asset_server: Res<AssetServer>) {
         Underline,
         TextFont {
             // This font is loaded and will be used instead of the default font.
-            font: "Comic Sans MS".into(),
+            font: asset_server.load("fonts/FiraSans-Bold.ttf").into(),
             font_size: 67.0,
             ..default()
         },
```

## 延伸閱讀

對於想要更深入了解相關概念的讀者，建議參考：

1. **Bevy 文字系統文件**：了解 Bevy 如何處理文字渲染和字型加載
2. **Asset 系統文件**：理解 Bevy 的資源載入機制
3. **範例程式碼最佳實踐**：學習如何撰寫清晰、有效的範例程式碼
4. **Git 工作流程**：了解如何避免意外提交測試程式碼到主要分支

這個 PR 雖然簡單，但展示了維護程式碼庫質量的重要性，特別是在範例程式碼方面。清晰的範例對於幫助新使用者理解和學習框架至關重要。