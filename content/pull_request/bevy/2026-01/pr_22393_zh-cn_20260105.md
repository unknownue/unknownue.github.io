+++
title = "#22393 new 2d rotation example"
date = "2026-01-05T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-01/pr-22393-en-20260105" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-01/pr-22393-zh-cn-20260105" }}
labels = ["C-Examples", "A-Transform", "D-Straightforward"]
+++

# Title

## Basic Information
- **Title**: new 2d rotation example
- **PR Link**: https://github.com/bevyengine/bevy/pull/22393
- **Author**: ChristopherBiscardi
- **Status**: MERGED
- **Labels**: C-Examples, S-Ready-For-Final-Review, A-Transform, D-Straightforward
- **Created**: 2026-01-05T19:48:21Z
- **Merged**: 2026-01-05T23:18:20Z
- **Merged By**: alice-i-cecile

## Description Translation

# Objective

以最少的代码解决2D场景下旋转实体使其面向光标的用例。

## Solution

新增示例。

## Testing

```
cargo run --example rotate_to_cursor
```

---

## Showcase

https://github.com/user-attachments/assets/2f3aeade-5def-4fa3-a343-93985be55e57


## The Story of This Pull Request

这个Pull Request源于一个常见的游戏开发需求：在2D场景中，让一个实体（例如一个角色或炮塔）能够旋转并始终面向鼠标光标的位置。虽然Bevy引擎的示例库中已经存在一个展示2D旋转的示例（`rotation.rs`），但它主要演示的是使用四元数进行通用旋转，并没有专门展示如何根据外部输入（如光标位置）进行动态旋转。对于初次接触游戏开发或Bevy坐标系统的开发者来说，实现“面向光标”这个看似简单的功能，可能需要拼接多个概念：坐标系统转换、向量运算以及旋转变换的应用。这个PR的目标就是提供一个最小化、专注的代码示例，直接解决这个具体问题。

开发者采取的解决方案非常直接：创建一个全新的示例。这个决策基于示例代码库的组织原则——每个示例应聚焦于演示一个特定的功能或模式。与其扩充现有的通用旋转示例，不如创建一个名为`rotate_to_cursor`的独立示例，这样意图更清晰，也更方便其他开发者查找和参考。

从实现上看，这个示例的代码结构简洁明了，遵循了Bevy应用的典型模式。它定义了一个`Player`组件标签来标识玩家控制的实体。在`setup`系统中，加载一个飞船纹理并生成精灵实体和2D摄像机。核心逻辑位于`player_movement_system`系统中，这个系统被注册到`FixedUpdate`阶段，确保旋转逻辑以固定的时间步长运行。

该系统的技术实现揭示了几个关键点。首先，它使用了Bevy的`Single`查询，这是一种便捷的语法，用于查询预期只有一个实体的组件，在这里是玩家的`Transform`和摄像机的`Camera`与`GlobalTransform`。其次，它演示了如何将屏幕空间的光标坐标转换为世界坐标：通过`window.cursor_position()`获取光标在窗口中的像素位置，然后使用`camera.viewport_to_world_2d(camera_transform, cursor_position)`方法将其转换为游戏世界中的2D坐标。这是实现“面向光标”功能的核心步骤。

获得光标的世界坐标后，计算旋转角度的逻辑基于基础的向量数学。方向向量通过`光标世界坐标 - 实体当前位置`得到。`Vec2`类型的`to_angle()`方法将这个向量转换为其与正X轴（向右）之间的弧度角。这里有一个重要的细节调整：示例中使用的飞船精灵默认是“朝上”的（即朝向正Y轴），而计算出的角度是基于正X轴的。因此，需要将计算结果减去`FRAC_PI_2`（即π/2，90度），才能使飞船正确地朝向光标。最终，使用`Quat::from_rotation_z(angle)`来设置实体的Z轴旋转。

这个PR的影响非常具体且积极。它为Bevy的学习者和使用者添加了一个实用的、即拿即用的代码示例。它清晰地串联了输入处理、坐标转换和实体变换这几个模块，降低了实现此类交互功能的认知门槛。同时，为了保持示例分类的清晰，PR作者还更新了现有`rotation`示例在`Cargo.toml`中的元数据名称，将其从“2D Rotation”改为“Generic 2D Rotation”，以区别于新的“2D Rotation to Cursor”示例，这体现了对代码库文档维护的细致考虑。

## Visual Representation

```mermaid
graph TD
    App[App] --> Setup[setup System]
    App --> PlayerSystem[player_movement_system System]
    
    Setup --> Spawns[Spawns Entities]
    Spawns --> Camera[Camera2d Bundle]
    Spawns --> Player[Player Sprite Bundle]
    
    PlayerSystem --> Queries[Queries Components]
    Queries --> PlayerTransform[Player Transform]
    Queries --> CameraQuery[Camera, GlobalTransform]
    Queries --> Window[Window]
    
    Window --> CursorPos[Provides cursor_position]
    CameraQuery --> ViewportConvert[viewport_to_world_2d]
    CursorPos --> ViewportConvert
    
    ViewportConvert --> WorldPos[cursor_world_pos]
    WorldPos --> VecMath[Vector Subtraction: cursor_world_pos - player.translation.xy]
    VecMath --> DirectionVec[Direction Vector]
    DirectionVec --> ToAngle[.to_angle() -> Radians]
    ToAngle --> AdjustAngle[Subtract FRAC_PI_2]
    AdjustAngle --> ApplyRotation[Quat::from_rotation_z]
    ApplyRotation --> PlayerTransform
```

## Key Files Changed

1. **`examples/2d/rotate_to_cursor.rs`** (新增文件，+59行)
   - **描述**：这是此次PR新增的核心示例文件。它完整实现了一个让飞船精灵旋转并跟随鼠标光标的Bevy应用。
   - **代码片段**：
     ```rust
     //! Demonstrates rotating sprites to face the cursor.

     use bevy::prelude::*;
     use std::f32::consts::FRAC_PI_2;

     fn main() {
         App::new()
             .add_plugins(DefaultPlugins)
             .add_systems(Startup, setup)
             .add_systems(FixedUpdate, player_movement_system)
             .run();
     }
     ...
     fn player_movement_system(
         mut player: Single<&mut Transform, With<Player>>,
         camera_query: Single<(&Camera, &GlobalTransform)>,
         window: Single<&Window>,
     ) {
         let (camera, camera_transform) = *camera_query;

         if let Some(cursor_position) = window.cursor_position()
             && let Ok(cursor_world_pos) = camera.viewport_to_world_2d(camera_transform, cursor_position)
         {
             player.rotation = Quat::from_rotation_z(
                 (cursor_world_pos - player.translation.xy()).to_angle() - FRAC_PI_2,
             );
         }
     }
     ```
   - **关系**：此文件直接实现了PR的目标，提供了“旋转面向光标”的完整可运行代码。

2. **`Cargo.toml`** (修改，+13/-1行)
   - **描述**：在`[example]`和`[package.metadata.example]`部分注册了新示例`rotate_to_cursor`，并更新了原有`rotation`示例的名称以作区分。
   - **代码片段**：
     ```toml
     # 新增的示例配置块
     [[example]]
     name = "rotate_to_cursor"
     path = "examples/2d/rotate_to_cursor.rs"
     # Causes an ICE on docs.rs
     doc-scrape-examples = false

     [package.metadata.example.rotate_to_cursor]
     name = "2D Rotation to Cursor"
     description = "Demonstrates rotating entities in 2D to follow the cursor"
     category = "2D Rendering"
     wasm = true

     # 被修改的原有示例配置块（名称从“2D Rotation”改为“Generic 2D Rotation”）
     [package.metadata.example.rotation]
     name = "Generic 2D Rotation"
     description = "Demonstrates rotating entities in 2D with quaternions"
     category = "2D Rendering"
     wasm = true
     ```
   - **关系**：此修改使得新示例能够通过`cargo run --example rotate_to_cursor`命令运行，并确保其在文档和示例列表中被正确分类和描述。

3. **`examples/README.md`** (修改，+2/-1行)
   - **描述**：更新了示例目录的说明文件，在列表中新增了`2D Rotation to Cursor`示例，并将原有的`2D Rotation`条目替换为`Generic 2D Rotation`，保持了列表的排序。
   - **关系**：确保开发者通过README文件浏览示例时，能够找到并理解这个新示例的用途。

## Further Reading

1.  **Bevy 官方文档 - 变换 (Transform)**: 深入了解`Transform`组件，以及平移、旋转、缩放的详细API。
2.  **Bevy 官方示例 - `2d_viewport_to_world.rs`**: 此示例更深入地讲解了`Camera::viewport_to_world_2d`方法及其在不同场景下的应用，可作为本示例中坐标转换部分的补充学习材料。
3.  **《游戏编程模式》 - “面向组件编程”章节**: 有助于理解Bevy ECS架构的设计哲学，以及如何像本示例中一样通过组合组件和系统来构建游戏逻辑。
4.  **线性代数基础，特别是向量运算**: 理解向量减法、点积、叉积以及如何从向量导出角度，是掌握2D/3D游戏旋转、朝向等概念的关键。可以复习二维向量相关的数学知识。