+++
title = "#22911 `clear_all()` clears all (non-send data)"
date = "2026-02-17T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22911-en-20260217" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22911-zh-cn-20260217" }}
labels = ["D-Trivial", "A-ECS", "M-Migration-Guide"]
+++

# Title

## Basic Information
- **Title**: `clear_all()` clears all (non-send data)
- **PR Link**: https://github.com/bevyengine/bevy/pull/22911
- **Author**: Trashtalk217
- **Status**: MERGED
- **Labels**: D-Trivial, A-ECS, S-Ready-For-Final-Review, M-Migration-Guide
- **Created**: 2026-02-11T15:47:11Z
- **Merged**: 2026-02-17T00:17:53Z
- **Merged By**: alice-i-cecile

## Description Translation
# Objective

Since #20934, `World::clear_all` and `World::clear_all_entities` behave identically. `World::clear_all` used to clear all resources and entities, but since resources are now components, `World::clear_all_entities` also does this.

## Solution

Since `World::clear_all_non_send()` was not included in `World::clear_all`, I've decided to include it.

## The Story of This Pull Request

The problem originated from a fundamental architectural change in Bevy's ECS system. In PR #20934, resources were reimplemented as components. This architectural shift had subtle implications for API consistency that weren't fully addressed initially.

Before this change, `World::clear_all` was documented to clear all entities and resources. However, after the resources-as-components change, `World::clear_entities` also cleared resources because resources were now just special entities with component data. This created an inconsistency where `clear_all` and `clear_all_entities` behaved identically, which was misleading from an API design perspective.

The specific gap was that `clear_all` wasn't clearing non-send data. Non-send data refers to data that cannot be safely sent between threads in Rust's ownership model - typically data that contains thread-local resources or doesn't implement the `Send` trait. In Bevy's ECS, non-send data is stored separately from regular components and resources.

The developer identified this inconsistency and proposed a straightforward solution: update `World::clear_all` to also clear non-send data by calling `clear_non_send()`. This restores the intuitive expectation that `clear_all` truly clears everything in the world, including non-send data.

The implementation is minimal but important for API consistency. The change modifies the `clear_all` method to call both `clear_entities` and `clear_non_send`. This ensures that after calling `clear_all`, the world is completely empty - no entities, no resources, and no non-send data remain.

From a technical perspective, this change is about maintaining API contracts and developer expectations. When a method is named `clear_all`, developers reasonably expect it to clear everything. The previous implementation violated this expectation by omitting non-send data.

The migration guide update is equally important. It ensures that developers who read the migration guide understand the new behavior and can adjust their code accordingly. Without this documentation update, developers might not realize that `clear_all` now has broader scope.

This PR demonstrates a common pattern in API evolution: when underlying architectural changes affect multiple methods, it's important to review all related APIs for consistency. The fix is simple but addresses a real usability issue where method names don't accurately reflect their behavior.

## Visual Representation

```mermaid
graph TD
    A[World::clear_all] --> B[clear_entities]
    A --> C[clear_non_send]
    B --> D[Clears all entities]
    B --> E[Clears resources (as components)]
    C --> F[Clears non-send data]
```

## Key Files Changed

### `crates/bevy_ecs/src/world/mod.rs` (+4/-5)

This file contains the main implementation change. The `clear_all` method is updated to clear non-send data in addition to entities.

**Changes:**
- Updated documentation to reflect that `clear_all` now clears entities, resources, AND non-send data
- Added `self.clear_non_send()` call to the implementation

```rust
// Before:
/// Clears all entities and resources, invalidating all [`Entity`] and resource fetches
/// such as [`Res`](crate::system::Res), [`ResMut`](crate::system::ResMut)
///
/// Since resources are entities, this is identical to [`clear_entities`](Self::clear_entities).
/// Non-send data is not cleared.
pub fn clear_all(&mut self) {
    self.clear_entities();
}

// After:
/// Clears all entities, resources, and non-send data.
/// This invalidates all [`Entity`] and resource fetches such as [`Res`](crate::system::Res),
/// [`ResMut`](crate::system::ResMut)
pub fn clear_all(&mut self) {
    self.clear_entities();
    self.clear_non_send();
}
```

### `release-content/migration-guides/resources_as_components.md` (+1/-1)

This file is updated to document the change in behavior for `clear_all` in the migration guide.

**Changes:**
- Updated the migration guide to note that `World::clear_all` now clears entities, resources, AND non-send data

```markdown
// Before:
Next, `World::clear_entities` now also clears all resources.

// After:
Next, `World::clear_entities` now also clears all resources, and `World::clear_all` now clears all entities, resources, and non-send data.
```

## Further Reading

1. **Bevy ECS Architecture**: Understanding how Bevy's ECS stores data separately for entities, resources, and non-send data is fundamental to working with the system effectively.

2. **Rust Send and Sync Traits**: The distinction between send and non-send data is rooted in Rust's concurrency model. Understanding `Send` and `Sync` traits is essential for working with thread-safe data in Rust.

3. **API Design Principles**: This change illustrates the importance of method names accurately reflecting their behavior. The principle of "least surprise" in API design suggests that methods should behave as their names imply.

4. **Migration Guide Patterns**: The inclusion of this change in the migration guide demonstrates best practices for maintaining documentation when APIs evolve.