+++
title = "#22943 Pbr GltfExtensionHandler: hashes to slashes"
date = "2026-02-17T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22943-en-20260217" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22943-zh-cn-20260217" }}
labels = ["C-Bug", "A-Assets", "C-Usability", "M-Migration-Guide", "A-glTF"]
+++

# Title
Pbr GltfExtensionHandler: hashes to slashes

## Basic Information
- **Title**: Pbr GltfExtensionHandler: hashes to slashes
- **PR Link**: https://github.com/bevyengine/bevy/pull/22943
- **Author**: ChristopherBiscardi
- **Status**: MERGED
- **Labels**: C-Bug, A-Assets, C-Usability, S-Ready-For-Final-Review, M-Migration-Guide, A-glTF
- **Created**: 2026-02-13T18:52:53Z
- **Merged**: 2026-02-17T19:28:05Z
- **Merged By**: alice-i-cecile

## Description Translation

# Objective

The asset server doesn't handle paths with multiple `#` in them well, which leads to users trying to load the new-style standard material (post `GltfMaterial`/pbr inversion) like this:

```rust
let handle: Handle<StandardMaterial> = 
    asset_server.load("models/animated/Fox.glb#Material0#std");
```

and failing with 

> 2026-02-13T18:39:46.765922Z ERROR bevy_asset::server: Could not find an asset loader matching: Loader Name: None; Asset Type: Some(TypeId(0x84f48d0a22ca9da8cd205decd68dcefa)); Extension: None; Path: Some("models/animated/Fox.glb#Material0#std");

## Solution

On recommendation from @andriyDev , switching to use slashes fixes the pathing issue.

```rust
let handle: Handle<StandardMaterial> = 
    asset_server.load("models/animated/Fox.glb#Material0/std");
```

## Testing

Used the gltf animated fox example to load a material as indicated above, and apply it to a 100x100x100 cube:

<img width="2650" height="2096" alt="screenshot-2026-02-13-at-10 42 22@2x" src="https://github.com/user-attachments/assets/cd977e4a-6f4d-4c6a-aeb7-561a7443bcf4" />

---

The migration guide uses paths since so are the source of truth for the asset server, and there is currently no `GltfAssetLabel` for the new standard material handling. (This should be fixed also in a different PR).

## The Story of This Pull Request

This PR addresses a practical problem that emerged from Bevy's recent architectural changes around glTF material handling. The issue was straightforward but impacted developer experience: users couldn't load StandardMaterial assets from glTF files using the expected path syntax.

The core problem stemmed from a recent inversion of the dependency between `bevy_gltf` and `bevy_pbr`. Previously, `bevy_gltf` depended on `bevy_pbr`, which tightly coupled scene definition to rendering. In version 0.19, this was inverted so `bevy_gltf` could function without the rendering stack. This architectural improvement introduced a new `GltfMaterial` type to accurately represent glTF material data, but it also changed how developers access the converted `StandardMaterial`.

The breaking change became apparent when users tried to load StandardMaterials using the new system. The code was generating asset paths with multiple `#` characters, like `models/animated/Fox.glb#Material0#std`. Bevy's asset server doesn't handle multiple `#` characters well in paths, which caused the asset loader to fail with a cryptic error message about not finding a matching asset loader.

The solution, recommended by @andriyDev, was simple but effective: change the delimiter from `#` to `/` for the StandardMaterial sub-asset label. This transforms the path from `models/animated/Fox.glb#Material0#std` to `models/animated/Fox.glb#Material0/std`. The slash is a more conventional separator for sub-assets within a labeled asset, and the asset server already handles this pattern correctly.

Looking at the implementation changes in `crates/bevy_pbr/src/gltf.rs`, we can see the fix is applied consistently across three methods in the `GltfExtensionHandlerPbr` implementation:

1. In `on_root()`: For the glTF default material
2. In `on_material()`: For individual materials
3. In `on_mesh_primitive()`: When attaching materials to mesh primitives

Each location previously used `format!("{}#std", label)` and now uses `format!("{}/std", label)`. This change ensures that all StandardMaterial sub-assets created from glTF materials use the correct path separator.

The migration guide update is equally important. Previously, developers would load StandardMaterials with just the material label (`#Material0`). Now they need to load `GltfMaterial` with the base label and `StandardMaterial` with the `/std` suffix. The guide clearly shows both the old (0.18) and new (0.19) syntax, helping developers understand exactly how to update their code.

One technical insight from this PR is the distinction between asset labels and sub-asset paths. The `#` character separates the main asset path from its label, while `/` can be used within the label to denote sub-assets. This pattern is consistent with how Bevy handles other nested asset structures.

The PR author also notes that there's still work to be done: there's currently no `GltfAssetLabel` for the new standard material handling, which should be addressed in a separate PR. This acknowledgment shows good engineering practice - fixing the immediate issue while recognizing larger architectural improvements needed.

## Visual Representation

```mermaid
graph TD
    A[glTF Asset] --> B[#Material0 label]
    B --> C[GltfMaterial]
    B --> D[/std suffix]
    D --> E[StandardMaterial]
    
    F[Asset Server] --> G{Path parsing}
    G --> H[Handles single #]
    G --> I[Rejects multiple ##]
    G --> J[Handles / in labels]
```

## Key Files Changed

### `crates/bevy_pbr/src/gltf.rs` (+3/-3)

This file contains the implementation of `GltfExtensionHandlerPbr` which handles PBR-specific extensions for glTF loading. The changes fix how StandardMaterial sub-asset labels are constructed.

**Before:**
```rust
// In on_root(), on_material(), and on_mesh_primitive():
let std_label = format!("{}#std", GltfAssetLabel::DefaultMaterial);
// or
let std_label = format!("{}#std", material_label);
```

**After:**
```rust
// In on_root(), on_material(), and on_mesh_primitive():
let std_label = format!("{}/std", GltfAssetLabel::DefaultMaterial);
// or
let std_label = format!("{}/std", material_label);
```

These changes ensure that when the glTF loader creates StandardMaterial assets from glTF materials, they use `/` instead of `#` as the separator between the material label and the "std" suffix.

### `release-content/migration-guides/gltf_pbr.md` (+14/-0)

This migration guide documents the breaking changes for glTF PBR handling between versions 0.18 and 0.19. The PR adds documentation about the new path syntax for loading StandardMaterials.

**Key addition:**
```markdown
In 0.18, loading a material sub-asset would return a `Handle<StandardMaterial>`.

```rs
let handle: Handle<StandardMaterial> = asset_server.load("models/animated/Fox.glb#Material0");
```

In 0.19, loading a material sub-asset loads a `GltfMaterial` to accurately represent the data in the glTF file.
To load the `StandardMaterial`, use the `/std` suffix when the `bevy_pbr` feature is turned on (the feature is on by default).

```rs
let handle: Handle<GltfMaterial> = asset_server.load("models/animated/Fox.glb#Material0");
let handle_std: Handle<StandardMaterial> = asset_server.load("models/animated/Fox.glb#Material0/std");
```
```

This documentation is crucial because it shows developers both the architectural change (GltfMaterial vs StandardMaterial) and the practical syntax change (using `/std` suffix).

## Further Reading

1. **Bevy Asset System Documentation**: For understanding how asset paths, labels, and sub-assets work in Bevy
2. **glTF Specification**: To understand the material data structure that `GltfMaterial` represents
3. **Bevy Migration Guides**: For other breaking changes between versions
4. **Previous PR #22569**: The original inversion of `bevy_gltf` and `bevy_pbr` dependencies that introduced these changes
5. **Asset Path Parsing in Bevy Source**: The `AssetPath` implementation to understand how `#` and `/` are parsed differently