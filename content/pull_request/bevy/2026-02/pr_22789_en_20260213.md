+++
title = "#22789 Rename on_replace/Replace to on_discard/Discard"
date = "2026-02-13T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22789-en-20260213" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22789-zh-cn-20260213" }}
labels = ["A-ECS", "C-Usability", "M-Migration-Guide"]
+++

# Title

## Basic Information
- **Title**: Rename on_replace/Replace to on_discard/Discard
- **PR Link**: https://github.com/bevyengine/bevy/pull/22789
- **Author**: jonas-meyer
- **Status**: MERGED
- **Labels**: A-ECS, C-Usability, S-Ready-For-Final-Review, M-Migration-Guide
- **Created**: 2026-02-03T10:11:22Z
- **Merged**: 2026-02-13T01:37:12Z
- **Merged By**: alice-i-cecile

## Description Translation
**Objective**
- Rename lifecycle "Replace" hooks/events to "Discard" to reflect actual semantics (fires on overwrite, remove, and despawn), and free up "Replace" for a future true replacement event. Addresses #20729.

**Solution**
- Renamed Replace/on_replace to Discard/on_discard across hooks, observers, events, derive macros, docs, examples, and tests.
- Updated UI compile-fail expectations and added OnDiscard doc alias on Discard for discoverability.

**Testing**
- `cargo run -p ci -- compile-fail`
- `cargo test -p bevy_ecs --lib --tests --features bevy_ecs/track_location` (fails locally due to missing bevy_ecs/debug feature in two tests that assert full system names)

## The Story of This Pull Request

This pull request addresses a naming inconsistency in Bevy's Entity Component System (ECS) that had been causing confusion for developers. The core issue was that the lifecycle event named `Replace` didn't accurately describe what it actually did, and this misleading name prevented the system from having a proper "true replacement" event in the future.

The `Replace` event was triggered in three distinct scenarios: when a component value was overwritten with a new value, when a component was removed from an entity, and when an entity was despawned. However, the name "Replace" only accurately described the first scenario (overwriting), while being misleading for removal and despawn operations. This semantic mismatch made the API harder to understand and use correctly.

The solution was straightforward but far-reaching: rename `Replace` to `Discard` and update all related APIs, documentation, and examples. The new name `Discard` more accurately reflects that the event triggers when component data is being discarded, whether through overwrite, removal, or entity despawn. This change also clears the way for introducing a future `Replace` event that would only fire on true replacements (overwrites), not on removals.

The implementation required changes across 24 files in the codebase, touching core ECS components, macros, documentation, and examples. Every instance of `Replace` and `on_replace` had to be updated to `Discard` and `on_discard` respectively. This included:

1. **Lifecycle event constants**: The `REPLACE` constant became `DISCARD`
2. **Component hooks**: The `on_replace` hook method became `on_discard`
3. **Derive macro attributes**: `#[component(on_replace = ...)]` became `#[component(on_discard = ...)]`
4. **Documentation**: All references in comments and guides were updated
5. **Examples**: Working code examples were updated to use the new terminology
6. **Tests**: Test cases and compile-fail expectations were updated

The technical implementation was systematic but required careful attention to detail. For example, in the component derive macro (`crates/bevy_ecs/macros/src/component.rs`), the parsing logic for the `on_replace` attribute had to be updated to handle `on_discard` instead:

```rust
// Before:
} else if nested.path.is_ident(ON_REPLACE) {
    attrs.on_replace = Some(HookAttributeKind::parse(nested.input, || {
        parse_quote! { Self::on_replace }
    })?);
    Ok(())

// After:
} else if nested.path.is_ident(ON_DISCARD) {
    attrs.on_discard = Some(HookAttributeKind::parse(nested.input, || {
        parse_quote! { Self::on_discard }
    })?);
    Ok(())
```

Similarly, in the archetype flags system (`crates/bevy_ecs/src/archetype.rs`), the flag constants had to be renamed:

```rust
// Before:
const ON_REPLACE_HOOK = (1 << 2);
const ON_REPLACE_OBSERVER = (1 << 7);

// After:
const ON_DISCARD_HOOK = (1 << 2);
const ON_DISCARD_OBSERVER = (1 << 7);
```

One important consideration was maintaining backward compatibility through documentation aliases. The `Discard` struct was given `#[doc(alias = "OnDiscard")]` and `#[doc(alias = "Replace")]` attributes to help developers find the renamed type when searching for the old names.

The impact of this change is significant for code clarity. Developers can now more easily understand when `Discard` events fire and what they represent. The API now accurately communicates its behavior: when component data is being discarded (whether replaced, removed, or despawned), the `Discard` event fires, allowing systems to clean up related state.

From an engineering perspective, this change demonstrates the importance of accurate naming in API design. Misleading names can cause confusion and bugs, while clear names make the system more intuitive. The comprehensive nature of the changes (affecting macros, constants, methods, attributes, and documentation) shows how interconnected modern ECS systems are and why consistent naming is crucial.

## Visual Representation

```mermaid
graph TD
    A[Component Lifecycle Events] --> B[Add]
    A --> C[Insert]
    A --> D[Discard (formerly Replace)]
    A --> E[Remove]
    A --> F[Despawn]
    
    D --> G[Triggers on Overwrite]
    D --> H[Triggers on Removal]
    D --> I[Triggers on Despawn]
    
    J[Component Hooks] --> K[on_add]
    J --> L[on_insert]
    J --> M[on_discard]
    J --> N[on_remove]
    J --> O[on_despawn]
    
    M --> P[#[component(on_discard = func)]]
    M --> Q[ComponentHooks::on_discard()]
```

## Key Files Changed

1. **`crates/bevy_ecs/src/lifecycle.rs` (+24/-22)**
   - Renamed `Replace` struct to `Discard`
   - Updated `REPLACE` constant to `DISCARD`
   - Changed `ComponentHooks::on_replace()` to `ComponentHooks::on_discard()`
   - Updated documentation to reflect new semantics

2. **`crates/bevy_ecs/src/world/entity_access/mod.rs` (+21/-21)**
   - Updated hook function names from `on_replace` to `on_discard`
   - Changed observer callback names from `on_replace` to `on_discard`
   - Updated test cases to use new terminology

3. **`crates/bevy_ecs/macros/src/component.rs` (+17/-17)**
   - Updated attribute parsing from `on_replace` to `on_discard`
   - Changed constant `ON_REPLACE` to `ON_DISCARD`
   - Updated error messages to reference `on_discard` instead of `on_replace`

4. **`crates/bevy_ecs/src/observer/mod.rs` (+17/-17)**
   - Updated cached observers from `replace` to `discard`
   - Changed test cases to use `Discard` instead of `Replace`
   - Updated observer trigger logic for the renamed event

5. **`crates/bevy_ecs/src/world/deferred_world.rs` (+14/-14)**
   - Renamed `trigger_on_replace()` to `trigger_on_discard()`
   - Updated safety comments to reference `DISCARD` instead of `REPLACE`
   - Changed event triggering from `REPLACE` to `DISCARD`

Example of a key change in `lifecycle.rs`:

```rust
// Before:
#[doc(alias = "OnReplace")]
pub struct Replace {
    pub entity: Entity,
}

// After:
#[doc(alias = "OnDiscard")]
#[doc(alias = "OnReplace")]
#[doc(alias = "Replace")]
pub struct Discard {
    pub entity: Entity,
}
```

## Further Reading

1. [Bevy ECS Lifecycle Events Documentation](https://docs.rs/bevy_ecs/latest/bevy_ecs/lifecycle/index.html) - Official documentation for Bevy's lifecycle system
2. [Issue #20729](https://github.com/bevyengine/bevy/issues/20729) - The original issue discussing the naming problem
3. [Component Hooks Guide](https://bevyengine.org/learn/quick-start/ecs/component-hooks/) - Bevy's guide to using component lifecycle hooks
4. [API Design Guidelines](https://rust-lang.github.io/api-guidelines/naming.html) - Rust API design guidelines on naming conventions

## Full Code Diff

The full code diff shows the comprehensive changes made across the codebase, updating all instances of `Replace`/`on_replace` to `Discard`/`on_discard` in:
- Constant definitions and usages
- Struct and type names
- Method names and signatures
- Macro attribute parsing
- Documentation comments
- Test cases and examples
- Error messages and compile-fail expectations