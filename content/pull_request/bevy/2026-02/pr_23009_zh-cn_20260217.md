+++
title = "#23009 Fix comments still referring to `on_change` callbacks"
date = "2026-02-17T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-23009-en-20260217" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-23009-zh-cn-20260217" }}
labels = ["D-Trivial", "A-UI", "C-Code-Quality"]
+++

# Title: Fix comments still referring to `on_change` callbacks

## Basic Information
- **Title**: Fix comments still referring to `on_change` callbacks
- **PR Link**: https://github.com/bevyengine/bevy/pull/23009
- **Author**: goodartistscopy
- **Status**: MERGED
- **Labels**: D-Trivial, A-UI, C-Code-Quality, S-Ready-For-Final-Review
- **Created**: 2026-02-17T19:40:04Z
- **Merged**: 2026-02-17T20:40:53Z
- **Merged By**: alice-i-cecile

## Description Translation
PR #21247 移除了 `on_change` 回调，但在注释中仍留有一些提及。本次提交将这些提及删除。

## The Story of This Pull Request

### The Problem and Context
这是一个典型的清理性任务。在开源项目中，当一项功能被移除或重构后，相关的文档和注释需要同步更新。PR #21247 将 Bevy UI 组件的状态管理机制从旧的 `on_change` 回调模式迁移到了基于事件的通用 `ValueChange` 系统。然而，这次迁移后，在两个 UI 控件（`radio.rs` 和 `slider.rs`）的源代码注释中，仍然残留着对已不存在的 `on_change` 机制的描述。

从工程角度看，过时的注释是一种技术债务。它们会给新接触代码库的开发者带来困惑，可能误导其认为旧机制仍然有效，从而浪费时间去寻找不存在的 API 或理解错误的工作原理。保持注释与代码逻辑一致是维护代码可读性和可维护性的基本要求。

### The Solution Approach
解决方案直接明了：定位并更新所有引用已移除 `on_change` 功能的注释。由于功能本身已被移除，这纯粹是一次文档校正，不涉及任何逻辑或 API 的变更。开发者通过搜索代码库，准确地找到了两处需要修改的地方。

### The Implementation
本次修改涉及两个文件，总共变更了四行注释。

在 `slider.rs` 中，修改更为集中。一处是移除了对 `on_change` 属性工作方式的冗长解释，这段注释描述了一个已不复存在的内部/外部状态管理机制。直接删除这段过时的描述是最清晰的做法。
```rust
// 文件: crates/bevy_ui_widgets/src/slider.rs
// 修改前（第51-58行注释）:
/// The presence of the `on_change` property controls whether the slider uses internal or external
/// state management. If the `on_change` property is `None`, then the slider updates its own state
/// automatically. Otherwise, the `on_change` property contains the id of a one-shot system which is
/// passed the new slider value. In this case, the slider value is not modified, it is the
/// responsibility of the callback to trigger whatever data-binding mechanism is used to update the
/// slider's value.

// 修改后:
// (该段注释被完全删除)
```
另一处是更新了 `SetSliderValue` 事件的文档字符串。原先的注释提到该事件会使用 `on_change` 回调来修改值。新的注释准确地描述了当前的行为：触发该事件会进而触发一个 `ValueChange` 事件，而更新 `SliderValue` 组件仍然是应用层的责任，并指引开发者参考 `slider_self_update` 系统。
```rust
// 文件: crates/bevy_ui_widgets/src/slider.rs
// 修改前:
/// An [`EntityEvent`] that can be triggered on a slider to modify its value (using the `on_change` callback).

// 修改后:
/// An [`EntityEvent`] that can be triggered on a slider to modify its value (it will actually trigger
/// a [`ValueChange`] event, hooking up a corresponding change to [`SliderValue`] is still the app's responsibility,
/// see [`slider_self_update`]).
```

在 `radio.rs` 中，只修改了一行注释。在一个处理键盘输入的函数里，有一行注释提到要“为单选组中新选中的单选按钮触发 `on_change` 事件”。这被更新为触发 `ValueChange` 事件，与实际的代码逻辑保持一致。
```rust
// 文件: crates/bevy_ui_widgets/src/radio.rs
// 修改前:
            // Trigger the on_change event for the newly checked radio button on radio group

// 修改后:
            // Trigger the `ValueChange` event for the newly checked radio button on radio group
```

### Technical Insights
这个 PR 虽然很小，但它强调了一个重要的软件工程实践：**代码与其文档（包括注释）必须同步演进**。过时的注释比没有注释更糟糕，因为它提供了错误的信息。

从 Bevy 的架构演变来看，从特定的 `on_change` 回调迁移到通用的 `ValueChange` 事件，体现了对更统一、更解耦的事件处理模式的追求。事件系统允许更灵活的响应和处理，而不必将回调函数与组件紧密绑定。本次的注释清理工作，正是确保代码的“书面说明”能正确反映这一架构改进的最后一步。

### The Impact
这些修改带来的直接好处是提高了代码的清晰度和准确性。任何阅读这些注释的开发者现在获得的信息都是最新的，与当前 Bevy UI 的事件驱动架构相匹配。这减少了潜在的混淆，并使得代码库对贡献者更加友好。

从更广泛的角度看，这个 PR 展示了良好的开源项目维护习惯：即使是对注释的小修正，也值得以一个独立的、目标明确的 PR 形式提交。这保持了提交历史的清晰，并使代码审查的焦点集中。

## Visual Representation

这个 PR 主要涉及文档更新，但为了说明涉及的组件和事件流，可以绘制一个简单的示意图，展示当前正确的事件关系。

```mermaid
graph LR
    A[用户输入/远程触发] --> B[SetSliderValue 等 EntityEvent]
    B --> C[触发 ValueChange 事件]
    C --> D[应用层系统 监听 ValueChange]
    D --> E[更新 SliderValue/Radio 状态]
    E --> F[UI 同步渲染]
    subgraph “过时注释的引用”
        G[on_change 回调] -.->|已移除| B
    end
```

## Key Files Changed

### `crates/bevy_ui_widgets/src/slider.rs`
1. **修改内容及原因**：更新了与 `on_change` 回调相关的过时注释。一处是删除了描述旧状态管理机制的大段文档，另一处是更正了 `SetSliderValue` 事件的文档，以反映其现在通过触发 `ValueChange` 事件来工作。
2. **关键代码片段**：
```rust
// 关键修改1：删除过时段落（位于结构体 Slider 的文档中）
// 修改前包含了对 `on_change` 属性行为的详细描述，现已删除。

// 关键修改2：更新 SetSliderValue 事件的文档
// 修改前:
/// An [`EntityEvent`] that can be triggered on a slider to modify its value (using the `on_change` callback).
// 修改后:
/// An [`EntityEvent`] that can be triggered on a slider to modify its value (it will actually trigger
/// a [`ValueChange`] event, hooking up a corresponding change to [`SliderValue`] is still the app's responsibility,
/// see [`slider_self_update`]).
```
3. **与 PR 目标的关联**：这是本次清理工作的主要部分，移除了对已废弃机制的核心描述，并准确描述了当前基于事件的工作流程。

### `crates/bevy_ui_widgets/src/radio.rs`
1. **修改内容及原因**：修正了一行注释，将触发 `on_change` 事件更新为触发 `ValueChange` 事件，与实际代码逻辑匹配。
2. **关键代码片段**：
```rust
// 修改前:
            // Trigger the on_change event for the newly checked radio button on radio group
// 修改后:
            // Trigger the `ValueChange` event for the newly checked radio button on radio group
```
3. **与 PR 目标的关联**：确保了另一个 UI 组件（单选按钮组）的注释也与新的 `ValueChange` 事件系统保持一致。

## Further Reading
1.  **PR #21247**: 本次注释清理所对应的原始功能变更 PR。了解它将提供完整的上下文，理解 `on_change` 为何被移除以及 `ValueChange` 事件系统如何取而代之。
    *   链接: https://github.com/bevyengine/bevy/pull/21247
2.  **Bevy 官方文档 - Events**: 深入了解 Bevy ECS 中的事件机制是如何工作的，这是理解 `ValueChange` 等事件的基础。
    *   链接: https://bevyengine.org/learn/quick-start/events/
3.  **代码注释与维护的最佳实践**: 虽然本次 PR 很小，但它触及了保持代码健康度的一个重要方面。
    *   相关文章: 如《Clean Code》中关于注释的章节，或 Martin Fowler 关于“注释不是坏味道，但可以是坏味道的征兆”的论述。