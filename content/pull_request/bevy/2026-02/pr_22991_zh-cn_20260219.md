+++
title = "#22991 Adds `Pointer<Enter>` and `Pointer<Leave>` Events - Hierarchy aware versions of `Pointer<Over>` and `Pointer<Out>"
date = "2026-02-19T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22991-en-20260219" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22991-zh-cn-20260219" }}
+++

# Title

## 基本信息
- **标题**: Adds `Pointer<Enter>` and `Pointer<Leave>` Events - Hierarchy aware versions of `Pointer<Over>` and `Pointer<Out>`
- **PR链接**: https://github.com/bevyengine/bevy/pull/22991
- **作者**: kfc35
- **状态**: 已合并
- **标签**: C-Feature, A-UI, S-Ready-For-Final-Review, D-Modest, A-Picking
- **创建时间**: 2026-02-17T04:56:33Z
- **合并时间**: 2026-02-19T00:13:34Z
- **合并者**: alice-i-cecile

## 描述翻译
该PR为Bevy的picking系统引入了层次结构感知的`Pointer<Enter>`和`Pointer<Leave>`事件，旨在解决现有`Pointer<Over>`和`Pointer<Out>`事件在UI层次结构中可能产生冗余事件对的问题。

### 目标
- 修复#16289问题（该问题在0.19里程碑中，因此决定尝试解决方案）
- 引用当前`bevy_picking`文档：
> 当悬停焦点在子元素之间切换时，父实体可能会收到冗余的[`Out`]→[`Over`]事件对。在UI上下文中，这尤其成问题。层次结构感知的附加事件将在未来版本中添加

该PR尝试添加[`Out`]和[`Over`]事件的层次结构感知版本。

### 解决方案
- `Enter`和`Leave`是两个新事件，它们的功能类似于`Out`和`Over`，但不会自动传播。它们在`pointer_events()`中发送时不进行传播。为了特别处理子元素超出父元素边界的情况，存储了悬停项目的祖先实体，并在决定向谁发送`Enter`和`Leave`事件时使用这些信息。

### 测试
- 在mesh_picking示例中测试（将`Over`和`Out`分别替换为`Enter`和`Leave`），运行正常。
- 在ui_drag_and_drop示例中测试替换后的效果，也运行良好。
- 创建了一个小型示例来验证`Enter`和`Leave`事件的计数是否符合预期。该示例使用UI节点，一个红色的父元素，以及一个蓝色（在示例中看起来是靛蓝色）和一个绿色的子元素，子元素在中间重叠。当悬停在不同的颜色区域时，事件计数会根据触发的事件增加。值得注意的是，如果悬停在靛蓝/绿色子元素上，然后移回父元素，父元素的`Enter`和`Leave`计数不会增加。只有当完全离开红色区域时，这些计数才会增加。同时提供了`Over`和`Out`计数以显示当前功能。

视频演示链接：https://github.com/user-attachments/assets/822a88cb-2f63-4471-8011-977dbc241b4a

---

### 示例展示
<details>
  <summary>Mini示例代码</summary>

```rust
//! Demonstrates Enter, Exit, Out, and Over events

use bevy::prelude::*;

fn main() {
    App::new()
        .add_plugins(DefaultPlugins)
        .add_systems(Startup, setup)
        .run();
}

#[derive(Component, Default)]
struct OverCount(u32);

#[derive(Component, Default)]
struct EnterCount(u32);

#[derive(Component, Default)]
struct LeaveCount(u32);

#[derive(Component, Default)]
struct OutCount(u32);

#[derive(Component, Default)]
#[require(OverCount, EnterCount, LeaveCount, OutCount)]
struct EventCounter(String);

#[derive(Component)]
struct TextToUpdate(Entity);

fn setup(mut commands: Commands) {
    commands.spawn(Camera2d);
    commands
        .spawn((