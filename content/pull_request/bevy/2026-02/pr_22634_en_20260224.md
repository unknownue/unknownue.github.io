+++
title = "#22634 Overrides for no-path in autonavigation for `bevy_input_focus`"
date = "2026-02-24T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22634-en-20260224" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22634-zh-cn-20260224" }}
labels = ["C-Feature", "A-UI", "D-Modest"]
+++

# Title: Overrides for no-path in autonavigation for `bevy_input_focus`

## Basic Information
- **Title**: Overrides for no-path in autonavigation for `bevy_input_focus`
- **PR Link**: https://github.com/bevyengine/bevy/pull/22634
- **Author**: kumaryash6352
- **Status**: MERGED
- **Labels**: C-Feature, A-UI, S-Ready-For-Final-Review, D-Modest
- **Created**: 2026-01-21T20:43:59Z
- **Merged**: 2026-02-24T03:08:28Z
- **Merged By**: alice-i-cecile

## Description Translation
# Objective

- Fixes #22378.

## Solution

Turn `NavNeighbors` from storing an array of `Option<Entity>` to an array of `NavNeighbor`, an enum with 3 values: `Unset` (no explicitly set thing in this direction), `Blocked` (assume there is nothing in this direction to path to), and `Neighbor(Entity)`.

## Testing

Changes tested using a new test, `test_respects_set_blocks`, and manually using the `directional_navigation_override` example. Each button on second page is restricted to left/right movement, as up/down are blocked.

## Showcase

I'm not quite sure how to showcase this, as it's a very input-oriented feature and the feature working means that nothing happens.

## The Story of This Pull Request

This PR addresses a specific limitation in Bevy's directional navigation system. Previously, when working with the `bevy_input_focus` crate, developers could either explicitly set navigation neighbors or rely on automatic navigation calculation. However, there was no way to explicitly block navigation in a particular direction - you could only leave it unset, which would then allow automatic navigation to fill in the gap.

The problem was raised in issue #22378, where users needed finer control over navigation flow, particularly in UI scenarios where certain directional movements should be prohibited. For example, in a grid layout, you might want to restrict vertical navigation within a row but still allow horizontal movement between rows through edge navigation.

The solution involves changing the core data structure from a simple `Option<Entity>` to a more expressive enum called `NavNeighbor`. This enum has three variants: `Auto` (default, no explicit setting), `Blocked` (explicitly prevent navigation), and `Set(Entity)` (explicit neighbor). This change preserves backward compatibility while adding the new blocking capability.

The implementation starts in `directional_navigation.rs` with the new enum definition:

```rust
pub enum NavNeighbor {
    #[default]
    Auto,
    Blocked,
    Set(Entity),
}
```

The `NavNeighbors` struct is updated to store an array of `[NavNeighbor; 8]` instead of `[Option<Entity>; 8]`. New methods are added: `block()` for explicitly blocking a direction, and helper methods like `get()` to extract the entity from a `Set` variant. The existing `set()` method now creates a `Set(Entity)` variant instead of `Some(entity)`.

The `DirectionalNavigationMap` gains new methods `block_edge()` and `block_symmetrical_edge()` to programmatically block navigation edges. When the navigation system attempts to navigate in a blocked direction, it now returns a new error variant `DirectionalNavigationError::BlockedNavigation` instead of trying to auto-calculate a neighbor.

A key design consideration was ensuring that automatic navigation generation respects these blocks. The `auto_generate_navigation_edges()` function now checks for both `Blocked` and `Set` variants when determining if a direction should be skipped:

```rust
if nav_map
    .get_neighbors(origin.entity)
    .filter(|neighbors| {
        matches!(
            neighbors.get(octant),
            NavNeighbor::Blocked | NavNeighbor::Set(_)
        )
    })
    .is_some()
{
    continue; // Respect manual override
}
```

The UI integration in `auto_directional_navigation.rs` needed adjustments to handle the new error types properly. The `AutoDirectionalNavigator` now distinguishes between "no neighbor" errors (which trigger auto-calculation) and "blocked" errors (which don't attempt auto-calculation).

To demonstrate the feature, the example `directional_navigation_overrides.rs` is updated with a practical use case. In the first page of buttons, vertical navigation (North/South) is explicitly blocked for each button, while horizontal navigation remains enabled. This creates a UI where you can move left/right within a row but cannot move up/down directly - you must navigate off the edge of the row instead.

This change provides UI designers with more precise control over navigation flow while maintaining the automatic navigation system's convenience for unconfigured directions. The implementation is minimal and focused, adding only the necessary functionality without overcomplicating the API.

## Visual Representation

```mermaid
graph TD
    A[Navigation State] --> B[Auto: Calculate automatically]
    A --> C[Blocked: Explicitly blocked]
    A --> D[Set: Explicitly set entity]
    
    E[Previous System] --> F[Option<Entity>: Some/None]
    F --> G[Could not express "blocked"]
    
    H[New System] --> I[NavNeighbor enum]
    I --> J[Three distinct states]
    
    K[Navigation Flow] --> L{Check direction}
    L --> M[Blocked?]
    M -->|Yes| N[Return BlockedNavigation error]
    M -->|No| O[Set?]
    O -->|Yes| P[Navigate to entity]
    O -->|No| Q[Auto-calculate]
```

## Key Files Changed

### `crates/bevy_input_focus/src/directional_navigation.rs` (+236/-57)

This file contains the core implementation changes. The main modifications are:

1. **New `NavNeighbor` enum** - replaces `Option<Entity>` with three explicit states
2. **Updated `NavNeighbors` struct** - now stores `[NavNeighbor; 8]` with new methods
3. **New blocking methods** - `block_edge()` and `block_symmetrical_edge()` for `DirectionalNavigationMap`
4. **Error handling** - new `BlockedNavigation` error variant
5. **Test updates** - existing tests updated and new test `test_respects_set_blocks` added

Key code change showing the enum definition:
```rust
// Before: neighbors: [Option<Entity>; 8]
// After:
pub enum NavNeighbor {
    #[default]
    Auto,
    Blocked,
    Set(Entity),
}

pub struct NavNeighbors {
    pub neighbors: [NavNeighbor; 8],
}
```

### `crates/bevy_ui/src/auto_directional_navigation.rs` (+25/-19)

This file updates the UI navigation system to handle the new error types properly. The key change is in the `navigate` method:

```rust
// Before: Simple check for manual navigation success
if let Ok(new_focus) = self.manual_directional_navigation.navigate(direction) {
    // Set focus
} else {
    // Try auto-calculation
}

// After: Pattern matching on error types
match self.manual_directional_navigation.navigate(direction) {
    Ok(new_focus) => {
        // Set focus
    }
    Err(DirectionalNavigationError::NoNeighborInDirection { .. }) => {
        // Try auto-calculation (only for "no neighbor", not "blocked")
    }
    err => err, // Propagate other errors including BlockedNavigation
}
```

### `examples/ui/navigation/directional_navigation_overrides.rs` (+35/-24)

This example is updated to demonstrate the blocking functionality. The key addition blocks vertical navigation on the first page:

```rust
// Add one-way blocking within the first grid page (Page 1) for down nav.
for btn in &pages_entities[0] {
    manual_directional_nav_map.block_edge(*btn, CompassOctant::South);
    manual_directional_nav_map.block_edge(*btn, CompassOctant::North);
}
```

The example also updates the text display to explain the different navigation behaviors on each page, including the new blocking feature on page 1.

## Further Reading

- [Bevy UI Navigation System Documentation](https://docs.rs/bevy_ui/latest/bevy_ui/focus/index.html)
- [Enum Pattern in Rust](https://doc.rust-lang.org/book/ch06-00-enums.html)
- [Entity Component System Architecture](https://bevyengine.org/learn/book/getting-started/ecs/)