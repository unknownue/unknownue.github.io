+++
title = "#22731 Make DepthOfField default respect DepthOfFieldMode default"
date = "2026-02-04T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22731-en-20260204" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22731-zh-cn-20260204" }}
labels = ["C-Bug", "A-Rendering", "D-Straightforward"]
+++

# Make DepthOfField default respect DepthOfFieldMode default

## Basic Information
- **Title**: Make DepthOfField default respect DepthOfFieldMode default
- **PR Link**: https://github.com/bevyengine/bevy/pull/22731
- **Author**: FindlayRoyds
- **Status**: MERGED
- **Labels**: C-Bug, A-Rendering, S-Ready-For-Final-Review, D-Straightforward
- **Created**: 2026-01-28T23:33:36Z
- **Merged**: 2026-02-04T00:49:37Z
- **Merged By**: alice-i-cecile

## Description Translation
The original description is in English, so it is included exactly as-is:

# Objective

The default value for DepthOfFieldMode is Gaussian, but the default implementation of DepthOfField uses Bokeh.

Old version:
```rust
pub enum DepthOfFieldMode {
    /// ...
    Bokeh,

    /// ...
    /// This is the default.
    /// ...
    #[default]
    Gaussian,
}

impl Default for DepthOfField {
    fn default() -> Self {
        // ...
        Self {
            // ...
            mode: DepthOfFieldMode::Bokeh,
        }
    }
}
```

## Solution

This PR updates DepthOfField to use the default value of DepthOfFieldMode.

## Testing
The depth of field example compiles and runs. I adjusted it to use the default mode of DepthOfField and it correctly uses Gaussian now.

## The Story of This Pull Request

This pull request addresses a simple but important consistency issue in Bevy's depth of field implementation. The problem was straightforward: there was a mismatch between the documented default value for `DepthOfFieldMode` and what was actually used when creating a default `DepthOfField` component.

The `DepthOfFieldMode` enum had two variants: `Bokeh` and `Gaussian`. The `Gaussian` variant was marked with the `#[default]` attribute, which meant that `DepthOfFieldMode::default()` would return `DepthOfFieldMode::Gaussian`. This was also documented in the code comments stating "This is the default."

However, the `Default` implementation for the `DepthOfField` struct was hardcoded to use `DepthOfFieldMode::Bokeh` instead of respecting the enum's default. This created an inconsistency where the documentation and the actual behavior didn't match. Developers relying on the default behavior would get Bokeh mode when they might reasonably expect Gaussian mode based on the enum's documentation.

The solution was simple and elegant: instead of hardcoding `DepthOfFieldMode::Bokeh` in the `DepthOfField::default()` implementation, the code now calls `DepthOfFieldMode::default()`. This ensures that the struct's default respects the enum's default, maintaining consistency throughout the codebase.

This type of bug is common in large codebases where defaults are defined in multiple places. The fix demonstrates good software engineering practice: when one type's default depends on another type's default, it should delegate to that type's `default()` method rather than hardcoding a value. This approach ensures that if the underlying default ever changes (for example, if the team decides to make Bokeh the default mode in the future), the `DepthOfField` struct will automatically pick up that change without requiring a code update.

From a testing perspective, the developer verified the fix by adjusting the depth of field example to use the default mode and confirming it correctly used Gaussian. This kind of validation is important even for simple changes to ensure the fix works as intended.

The impact of this change is minimal for existing code - any code that explicitly sets the mode won't be affected, and any code relying on the default will now get the correct Gaussian mode instead of Bokeh. This aligns the implementation with developer expectations and documentation.

## Visual Representation

```mermaid
graph TD
    A[DepthOfField::default] --> B[Uses]
    B --> C[DepthOfFieldMode::default]
    C --> D[Returns Gaussian]
    
    E[Enum Definition] --> F[DepthOfFieldMode::Gaussian]
    F --> G[Marked with #[default]]
    
    H[Before Fix] --> I[Hardcoded Bokeh]
    J[After Fix] --> K[Delegates to enum default]
```

## Key Files Changed

**File**: `crates/bevy_post_process/src/dof/mod.rs` (+1/-1)

This file contains the depth of field implementation in Bevy's post-processing system. The change was minimal but important for consistency.

**Before**:
```rust
impl Default for DepthOfField {
    fn default() -> Self {
        // ... other fields initialized
        Self {
            // ... other fields
            mode: DepthOfFieldMode::Bokeh,
        }
    }
}
```

**After**:
```rust
impl Default for DepthOfField {
    fn default() -> Self {
        // ... other fields initialized
        Self {
            // ... other fields
            mode: DepthOfFieldMode::default(),
        }
    }
}
```

The change replaces the hardcoded `DepthOfFieldMode::Bokeh` with `DepthOfFieldMode::default()`, which returns `DepthOfFieldMode::Gaussian` due to the `#[default]` attribute on the Gaussian variant in the enum definition.

## Further Reading

1. **Rust Default Trait Documentation**: Understanding how the `Default` trait works in Rust is fundamental to this change. The official Rust documentation provides details on implementing and using `Default`: https://doc.rust-lang.org/std/default/trait.Default.html

2. **Bevy Components and Defaults**: For more context on how Bevy uses components and their default values, the Bevy documentation on components and bundles is helpful: https://bevyengine.org/learn/book/next/programming/ecs/components

3. **Depth of Field in Computer Graphics**: To understand the technical difference between Gaussian and Bokeh depth of field modes, resources on computer graphics post-processing effects would be useful. Gaussian blur is a common approximation, while Bokeh aims to simulate the aesthetic qualities of lens blur.

4. **Rust Attributes**: The `#[default]` attribute used in the enum is part of Rust's derive macros. More information can be found in the Rust reference on attributes: https://doc.rust-lang.org/reference/attributes.html

## Full Code Diff
```diff
diff --git a/crates/bevy_post_process/src/dof/mod.rs b/crates/bevy_post_process/src/dof/mod.rs
index 1197bbf906dc5..e9143f61e55c4 100644
--- a/crates/bevy_post_process/src/dof/mod.rs
+++ b/crates/bevy_post_process/src/dof/mod.rs
@@ -319,7 +319,7 @@ impl Default for DepthOfField {
             sensor_height: physical_camera_default.sensor_height,
             max_circle_of_confusion_diameter: 64.0,
             max_depth: f32::INFINITY,
-            mode: DepthOfFieldMode::Bokeh,
+            mode: DepthOfFieldMode::default(),
         }
     }
 }
```