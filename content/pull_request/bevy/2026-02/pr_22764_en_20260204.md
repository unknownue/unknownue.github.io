+++
title = "#22764 Serialize `ImageLoaderSettings::texture_format`"
date = "2026-02-04T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22764-en-20260204" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22764-zh-cn-20260204" }}
labels = ["D-Trivial", "A-Rendering", "C-Usability"]
+++

# Title

## Basic Information
- **Title**: Serialize `ImageLoaderSettings::texture_format`
- **PR Link**: https://github.com/bevyengine/bevy/pull/22764
- **Author**: beicause
- **Status**: MERGED
- **Labels**: D-Trivial, A-Rendering, C-Usability, S-Ready-For-Final-Review
- **Created**: 2026-02-01T08:36:05Z
- **Merged**: 2026-02-04T01:14:37Z
- **Merged By**: alice-i-cecile

## Description Translation
# Objective

`ImageLoaderSettings::texture_format` should be serialized.

## Solution

Enable `wgpu-types/serde` to serialize it and use `#[serde(default)]` for backward compatibility.

## Testing

ci

## The Story of This Pull Request

The problem was straightforward but had implications for scene serialization workflows in Bevy. The `ImageLoaderSettings` struct includes a `texture_format` field that allows developers to explicitly specify a texture format when loading images, overriding automatic format detection. This is particularly useful for cases where image data needs to be interpreted differently than what the file extension suggests—for example, when loading 16-bit unsigned integer data that needs to be sampled as signed normalized floats.

However, before this PR, the `texture_format` field was marked with `#[serde(skip)]`, meaning it wasn't being serialized when scenes were saved. This created a workflow issue: if a developer configured an image with a specific `texture_format` in their application, saved the scene, and then loaded it back, the custom format setting would be lost. The image would revert to using whatever format the loader determined automatically, which could lead to incorrect rendering or runtime errors.

The solution involved two coordinated changes. First, the `wgpu-types` dependency needed the `serde` feature enabled to make the `TextureFormat` enum serializable. This was necessary because `TextureFormat` comes from an external crate (`wgpu-types`), and by default, its serialization support is gated behind a feature flag. Second, the field annotation needed to change from `#[serde(skip)]` to `#[serde(default)]` to enable serialization while maintaining backward compatibility.

The `#[serde(default)]` attribute is important for handling cases where serialized data doesn't contain the `texture_format` field—either from scenes saved before this change, or from users who don't explicitly set this field. When deserializing, if the field is missing, Serde will use the default value for `Option<TextureFormat>`, which is `None`. This ensures that existing scenes continue to work correctly.

The implementation is minimal but effective. By enabling the `serde` feature on `wgpu-types`, we gain the ability to serialize the `TextureFormat` enum without modifying the external crate. The change to `#[serde(default)]` is the standard pattern for optional fields in serializable structs in Rust.

This fix improves the usability of Bevy's scene system by ensuring that image configuration persists across save/load cycles. It's particularly important for applications that rely on non-standard texture formats for specialized rendering techniques or data processing pipelines.

## Visual Representation

```mermaid
graph TD
    A[ImageLoaderSettings Struct] --> B[texture_format Field]
    B --> C[Serialization Issue]
    C --> D[Enable wgpu-types/serde Feature]
    C --> E[Change #[serde(skip)] to #[serde(default)]]
    D --> F[TextureFormat becomes Serializable]
    E --> G[Backward Compatibility Maintained]
    F --> H[Complete Solution]
    G --> H
```

## Key Files Changed

### `crates/bevy_image/Cargo.toml` (+1/-1)
**What changed and why**: Added the `serde` feature to the `wgpu-types` dependency. This enables serialization support for the `TextureFormat` enum, which is required for the `texture_format` field to be serializable.

```toml
# Before:
wgpu-types = { version = "28", default-features = false }

# After:
wgpu-types = { version = "28", default-features = false, features = ["serde"] }
```

### `crates/bevy_image/src/image_loader.rs` (+1/-1)
**What changed and why**: Changed the Serde attribute on the `texture_format` field from `#[serde(skip)]` to `#[serde(default)]`. This enables the field to be included in serialization while maintaining backward compatibility by using `None` as the default value when the field is missing from serialized data.

```rust
// Before:
#[serde(skip)]
pub texture_format: Option<wgpu_types::TextureFormat>,

// After:
#[serde(default)]
pub texture_format: Option<wgpu_types::TextureFormat>,
```

## Further Reading

1. **Serde Attributes Documentation**: The official Serde guide to field attributes provides details on `#[serde(default)]` and other serialization options: https://serde.rs/field-attrs.html
2. **Bevy Scene System**: Understanding how Bevy handles scene serialization and asset loading: https://bevyengine.org/learn/book/features/scenes/
3. **wgpu-types Crate**: Documentation for the external crate that provides texture format definitions: https://docs.rs/wgpu-types
4. **Texture Formats in Graphics**: A general overview of texture formats and their uses in graphics programming: https://learnopengl.com/Getting-started/Textures

# Full Code Diff
```
diff --git a/crates/bevy_image/Cargo.toml b/crates/bevy_image/Cargo.toml
index 1cfe1bc66997f..8590a35278eef 100644
--- a/crates/bevy_image/Cargo.toml
+++ b/crates/bevy_image/Cargo.toml
@@ -70,7 +70,7 @@ image = { version = "0.25.2", default-features = false }
 # misc
 bitflags = { version = "2.3", features = ["serde"] }
 bytemuck = { version = "1.5" }
-wgpu-types = { version = "28", default-features = false }
+wgpu-types = { version = "28", default-features = false, features = ["serde"] }
 serde = { version = "1", features = ["derive"] }
 thiserror = { version = "2", default-features = false }
 futures-lite = "2.0.1"
diff --git a/crates/bevy_image/src/image_loader.rs b/crates/bevy_image/src/image_loader.rs
index 522581e510c06..9e7d6367719fa 100644
--- a/crates/bevy_image/src/image_loader.rs
+++ b/crates/bevy_image/src/image_loader.rs
@@ -119,7 +119,7 @@ pub struct ImageLoaderSettings {
     /// in a shader.
     /// Ex: data that would be `R16Uint` that needs to
     /// be sampled as a float using `R16Snorm`.
-    #[serde(skip)]
+    #[serde(default)]
     pub texture_format: Option<wgpu_types::TextureFormat>,
     /// Specifies whether image data is linear
     /// or in sRGB space when this is not determined by
```