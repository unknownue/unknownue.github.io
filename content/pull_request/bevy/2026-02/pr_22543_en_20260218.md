+++
title = "#22543 Fix build-wasm-example with `--debug` arg"
date = "2026-02-18T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22543-en-20260218" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22543-zh-cn-20260218" }}
labels = ["C-Bug", "A-Build-System", "O-Web", "D-Straightforward"]
+++

# Title

## Basic Information
- **Title**: Fix build-wasm-example with `--debug` arg
- **PR Link**: https://github.com/bevyengine/bevy/pull/22543
- **Author**: beicause
- **Status**: MERGED
- **Labels**: C-Bug, A-Build-System, O-Web, D-Straightforward, S-Needs-Review
- **Created**: 2026-01-16T08:09:14Z
- **Merged**: 2026-02-18T12:50:53Z
- **Merged By**: mockersf

## Description Translation
cargo profile is `dev` in debug build

## The Story of This Pull Request

This PR addresses a subtle but important bug in Bevy's WebAssembly build tooling. The issue centered around an inconsistency between how Cargo names its build profiles and how those profiles correspond to output directories. The `build-wasm-example` tool, used for compiling Bevy examples to WebAssembly, had a mismatch that prevented debug builds from working correctly.

The problem occurred when developers tried to use the `--debug` flag with the `build-wasm-example` tool. The tool was incorrectly assuming that the profile name passed to `cargo build --profile` would match the output directory name. In Cargo's terminology, the debug profile is called `dev`, not `debug`. When you run `cargo build` without specifying a profile, it uses the `dev` profile by default and outputs to a directory named `debug`. However, when explicitly specifying `--profile debug`, Cargo would look for a custom profile named `debug` in the Cargo.toml, which doesn't exist by default.

The solution involved decoupling the profile name used for the build command from the output directory name used for locating the compiled WebAssembly file. Previously, the code used a single `profile` variable for both purposes:

```rust
let profile = if cli.debug {
    "debug"
} else if cli.optimize_size {
    "wasm-release"
} else {
    "release"
};
```

This approach worked for release builds because Cargo's `release` profile outputs to a `release` directory. However, for debug builds, Cargo's `dev` profile outputs to a `debug` directory, creating a mismatch.

The fix introduces a tuple containing both the profile name and the output directory name:

```rust
let (profile, out_dir) = if cli.debug {
    ("dev", "debug")
} else if cli.optimize_size {
    ("wasm-release", "wasm-release")
} else {
    ("release", "release")
};
```

This change ensures that:
1. For debug builds, Cargo is invoked with `--profile dev` (the correct profile name)
2. The wasm-bindgen tool looks for the compiled .wasm file in the `debug` directory (where Cargo actually puts it)

The `wasm-release` case is interesting because it represents a custom profile that developers can define in their Cargo.toml. In this case, the profile name and output directory name happen to be the same, so the tuple approach maintains consistency.

The fix is minimal and focused, changing only 5 lines of code but resolving a fundamental issue in the build process. It demonstrates good attention to the details of build tooling, where small mismatches between tool expectations can cause build failures that are confusing to debug.

## Visual Representation

```mermaid
graph TD
    A[build-wasm-example CLI] --> B{Parse arguments}
    B -- --debug --> C[Debug build path]
    B -- --optimize-size --> D[Size-optimized build]
    B -- default --> E[Release build]
    
    C --> F[Profile: dev, OutDir: debug]
    D --> G[Profile: wasm-release, OutDir: wasm-release]
    E --> H[Profile: release, OutDir: release]
    
    F --> I[cargo build --profile dev]
    G --> J[cargo build --profile wasm-release]
    H --> K[cargo build --profile release]
    
    I --> L[Output to target/.../debug/]
    J --> M[Output to target/.../wasm-release/]
    K --> N[Output to target/.../release/]
    
    L --> O[wasm-bindgen --out-dir .../debug/]
    M --> P[wasm-bindgen --out-dir .../wasm-release/]
    N --> Q[wasm-bindgen --out-dir .../release/]
```

## Key Files Changed

**File: `tools/build-wasm-example/src/main.rs`**

This file contains the main logic for building Bevy examples as WebAssembly. The changes fix a mismatch between Cargo profile names and output directory names.

**Before:**
```rust
let profile = if cli.debug {
    "debug"
} else if cli.optimize_size {
    "wasm-release"
} else {
    "release"
};

// ...

cmd!(
    sh,
    "wasm-bindgen --out-dir examples/wasm/target --out-name wasm_example --target web target/wasm32-unknown-unknown/{profile}/examples/{example}.wasm"
)
```

**After:**
```rust
let (profile, out_dir) = if cli.debug {
    ("dev", "debug")
} else if cli.optimize_size {
    ("wasm-release", "wasm-release")
} else {
    ("release", "release")
};

// ...

cmd!(
    sh,
    "wasm-bindgen --out-dir examples/wasm/target --out-name wasm_example --target web target/wasm32-unknown-unknown/{out_dir}/examples/{example}.wasm"
)
```

The key change is the introduction of two separate variables: `profile` (used for the `cargo build --profile` argument) and `out_dir` (used to construct the path to the compiled .wasm file). This correctly handles the case where Cargo's `dev` profile outputs to a `debug` directory.

## Further Reading

1. [Cargo Profiles Documentation](https://doc.rust-lang.org/cargo/reference/profiles.html) - Official documentation on Cargo build profiles
2. [wasm-bindgen CLI Reference](https://rustwasm.github.io/docs/wasm-bindgen/reference/cli.html) - Documentation for the wasm-bindgen command-line tool
3. [Bevy WebAssembly Guide](https://bevyengine.org/learn/quick-start/platforms/wasm/) - Bevy's official WebAssembly setup guide
4. [Cargo Workspace Reference](https://doc.rust-lang.org/cargo/reference/workspaces.html) - Understanding how Cargo handles builds in workspace environments