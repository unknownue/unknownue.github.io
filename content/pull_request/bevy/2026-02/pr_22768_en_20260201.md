+++
title = "#22768 Fix DLSS by upgrading dlss_wgpu to 4.0.0-dev"
date = "2026-02-01T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-02/pr-22768-en-20260201" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-02/pr-22768-zh-cn-20260201" }}
labels = ["C-Bug", "D-Trivial", "A-Rendering"]
+++

# Title
## Fix DLSS by upgrading dlss_wgpu to 4.0.0-dev

## Basic Information
- **Title**: Fix DLSS by upgrading dlss_wgpu to 4.0.0-dev
- **PR Link**: https://github.com/bevyengine/bevy/pull/22768
- **Author**: JMS55
- **Status**: MERGED
- **Labels**: C-Bug, D-Trivial, A-Rendering, S-Ready-For-Final-Review
- **Created**: 2026-02-01T20:40:48Z
- **Merged**: 2026-02-01T21:32:47Z
- **Merged By**: alice-i-cecile

## Description Translation
Actually fixes #22707!

## The Story of This Pull Request

This PR addresses a breaking API change in the `dlss_wgpu` crate that was causing Bevy's DLSS (Deep Learning Super Sampling) implementation to fail. The issue (#22707) was straightforward: the external dependency had updated its API from version 3 to 4.0.0-dev, and Bevy's code was still using the old interface.

The problem manifested as a compilation failure due to mismatched method signatures. When `dlss_wgpu` 4.0.0-dev changed its API to use array types `[u32; 2]` and `[f32; 2]` instead of Bevy's `UVec2` and `Vec2` types, the existing code could no longer compile. This is a common scenario when working with external crates that have their own mathematical types - version updates often change how these types interact.

The solution approach was direct: update the dependency version in `Cargo.toml` and adjust all method calls to match the new API. The developer needed to add explicit conversions between Bevy's vector types and the array types expected by the `dlss_wgpu` crate. This involved two main patterns:

1. Converting return values using `.into()` when the `dlss_wgpu` methods return arrays that can be converted to Bevy vectors
2. Converting arguments using `.to_array()` when passing Bevy vectors to `dlss_wgpu` methods

For example, in the `DlssSuperResolutionFeature` implementation:

```rust
// Before (using UVec2 directly):
fn upscaled_resolution(context: &Self::Context) -> UVec2 {
    context.upscaled_resolution()
}

// After (converting array to UVec2):
fn upscaled_resolution(context: &Self::Context) -> UVec2 {
    context.upscaled_resolution().into()
}
```

The opposite conversion was needed when passing arguments:

```rust
// Before (passing UVec2 directly):
fn suggested_jitter(context: &Self::Context, frame_number: u32, render_resolution: UVec2) -> Vec2 {
    context.suggested_jitter(frame_number, render_resolution)
}

// After (converting UVec2 to array):
fn suggested_jitter(context: &Self::Context, frame_number: u32, render_resolution: UVec2) -> Vec2 {
    context
        .suggested_jitter(frame_number, render_resolution.to_array())
        .into()
}
```

This pattern appears consistently across both DLSS features (Super Resolution and Ray Reconstruction) and in the node implementation. The changes are mechanical but necessary - each method call to the `dlss_wgpu` crate had to be updated to handle the type conversion.

The implementation shows good attention to detail. The developer updated all relevant calls, including those for:
- Resolution methods (`upscaled_resolution`, `render_resolution`)
- Jitter calculation methods
- MIP bias suggestions
- Context creation
- Parameter passing in the rendering node

In the node implementation, additional conversions were needed for the `ExecuteParams` struct fields:

```rust
// Before:
jitter_offset: -temporal_jitter.offset,
partial_texture_size: Some(render_resolution),
motion_vector_scale: Some(-render_resolution.as_vec2()),

// After:
jitter_offset: (-temporal_jitter.offset).to_array(),
partial_texture_size: Some(render_resolution.to_array()),
motion_vector_scale: Some((-render_resolution.as_vec2()).to_array()),
```

These changes demonstrate the importance of consistent type handling when bridging between different graphics libraries. Bevy uses its own math types (`UVec2`, `Vec2`) for consistency across the engine, while `dlss_wgpu` uses simple arrays for its API. The `.into()` and `.to_array()` methods provide clean conversion points between these representations.

From a technical perspective, this PR highlights a common challenge in game engine development: managing dependencies with their own type systems. The solution is pragmatic - add conversion calls at the boundary between systems rather than attempting to change either system's internal types.

The impact is immediate: DLSS functionality is restored without changing Bevy's core math types or the overall architecture. The changes are localized to the anti-aliasing module, specifically the DLSS integration code. This minimal approach reduces risk and makes the fix straightforward to review and verify.

One technical insight worth noting is that the conversion methods (`.to_array()` and `.into()`) are zero-cost in release builds for simple types like these - the compiler optimizes them away, so there's no runtime performance penalty for the type conversions.

## Visual Representation

```mermaid
graph TD
    A[dlss_wgpu 3.x] -->|Breaking API Change| B[dlss_wgpu 4.0.0-dev]
    B -->|Uses array types [u32;2], [f32;2]| C[Bevy DLSS Integration]
    C -->|Calls methods with .to_array()| B
    B -->|Returns arrays converted with .into()| C
    D[Bevy Math Types UVec2, Vec2] -->|.to_array()| E[Array Types]
    E -->|.into()| D
```

## Key Files Changed

### `crates/bevy_anti_alias/Cargo.toml`
Updated the `dlss_wgpu` dependency from version 3 to 4.0.0-dev.

```toml
# Before:
dlss_wgpu = { version = "3", optional = true }

# After:
dlss_wgpu = { version = "4.0.0-dev", optional = true }
```

### `crates/bevy_anti_alias/src/dlss/mod.rs`
Updated method calls to handle type conversions between Bevy's `UVec2`/`Vec2` and `dlss_wgpu`'s array types.

Key changes in the `DlssSuperResolutionFeature` implementation:

```rust
// Before:
fn upscaled_resolution(context: &Self::Context) -> UVec2 {
    context.upscaled_resolution()
}

fn render_resolution(context: &Self::Context) -> UVec2 {
    context.render_resolution()
}

fn suggested_jitter(
    context: &Self::Context,
    frame_number: u32,
    render_resolution: UVec2,
) -> Vec2 {
    context.suggested_jitter(frame_number, render_resolution)
}

fn suggested_mip_bias(context: &Self::Context, render_resolution: UVec2) -> f32 {
    context.suggested_mip_bias(render_resolution)
}

// After:
fn upscaled_resolution(context: &Self::Context) -> UVec2 {
    context.upscaled_resolution().into()
}

fn render_resolution(context: &Self::Context) -> UVec2 {
    context.render_resolution().into()
}

fn suggested_jitter(
    context: &Self::Context,
    frame_number: u32,
    render_resolution: UVec2,
) -> Vec2 {
    context
        .suggested_jitter(frame_number, render_resolution.to_array())
        .into()
}

fn suggested_mip_bias(context: &Self::Context, render_resolution: UVec2) -> f32 {
    context.suggested_mip_bias(render_resolution.to_array())
}
```

Similar changes were made to `DlssRayReconstructionFeature`.

### `crates/bevy_anti_alias/src/dlss/node.rs`
Updated parameter passing to match the new `dlss_wgpu` API.

```rust
// Before:
let params = ExecuteParams {
    // ...
    jitter_offset: -temporal_jitter.offset,
    partial_texture_size: Some(render_resolution),
    motion_vector_scale: Some(-render_resolution.as_vec2()),
};

// After:
let params = ExecuteParams {
    // ...
    jitter_offset: (-temporal_jitter.offset).to_array(),
    partial_texture_size: Some(render_resolution.to_array()),
    motion_vector_scale: Some((-render_resolution.as_vec2()).to_array()),
};
```

## Further Reading

- [DLSS (Deep Learning Super Sampling) Technical Overview](https://www.nvidia.com/en-us/geforce/technologies/dlss/)
- [Bevy's Math Types Documentation](https://docs.rs/bevy-math/latest/bevy_math/)
- [Rust Type Conversion (From/Into traits)](https://doc.rust-lang.org/std/convert/trait.From.html)
- [Semantic Versioning and Breaking Changes](https://semver.org/)