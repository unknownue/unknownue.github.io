+++
title = "#21660 Don't use `[!Default; 0]: Default` impl"
date = "2025-10-26T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-10/pr-21660-en-20251026" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-10/pr-21660-zh-cn-20251026" }}
labels = ["D-Trivial", "A-ECS", "C-Code-Quality", "P-High"]
+++

# Title
Don't use `[!Default; 0]: Default` impl

## Basic Information
- **Title**: Don't use `[!Default; 0]: Default` impl
- **PR Link**: https://github.com/bevyengine/bevy/pull/21660
- **Author**: WaffleLapkin
- **Status**: MERGED
- **Labels**: D-Trivial, A-ECS, C-Code-Quality, P-High, S-Ready-For-Final-Review
- **Created**: 2025-10-26T18:46:20Z
- **Merged**: 2025-10-26T21:05:25Z
- **Merged By**: alice-i-cecile

## Description Translation

# Objective

- See https://github.com/rust-lang/rust/pull/145457, we want to remove unconditional `[T; 0]: Default` impl. That would be a breaking change breaking `bevy_ecs` and (a test of) `bevy_camera`.

## Solution

- Replace `<[T; 0]>::default()` calls with `[]`

## Testing

- It compiles, the `<[T; 0]>::default()` is equivalent to `[]`, no additional testing required

## The Story of This Pull Request

This PR addresses a forward-looking compatibility issue stemming from an upstream change in the Rust compiler. The problem originated from a Rust language proposal to remove the unconditional `Default` implementation for zero-length arrays (`[T; 0]`). While this change hadn't landed yet, the Bevy team proactively addressed potential breakage by eliminating dependencies on this implementation.

The core issue was that two locations in the Bevy codebase were explicitly calling `<[T; 0]>::default()`, which would fail to compile if Rust removed the blanket `Default` implementation for zero-length arrays. The solution was straightforward: replace these calls with the array literal `[]`, which creates an empty array without relying on the `Default` trait.

In the camera primitives module, a test was using `<[Vec3; 0]>::default()` to create an empty array for testing the `Aabb::enclosing` method's behavior with no points. The fix replaced this with `[] as [Vec3; 0]`, using type annotation to specify the array type while using the literal syntax.

Similarly, in the ECS module's unique array implementation, the `Default` implementation for `UniqueEntityEquivalentArray<T, 0>` was using `Self(Default::default())` which relied on the array's `Default` implementation. This was changed to `Self([])`, directly constructing the empty array.

The engineering approach here demonstrates good proactive maintenance practices. Rather than waiting for the breaking change to occur, the team addressed the issue preemptively. The changes are minimal and semantically equivalent - both `<[T; 0]>::default()` and `[]` produce the same empty array value, but the latter doesn't depend on the potentially-removed trait implementation.

From a technical perspective, this change highlights an important Rust pattern: when working with zero-length arrays, using the array literal syntax is more direct and avoids trait dependencies. The fix maintains the same behavior while improving forward compatibility.

## Visual Representation

```mermaid
graph TD
    A[Rust Language Change] --> B[Remove [T;0]: Default impl]
    B --> C[Bevy Code Impact]
    C --> D[bevy_camera Test]
    C --> E[bevy_ecs Implementation]
    D --> F[Replace with []]
    E --> F
    F --> G[Forward Compatibility]
```

## Key Files Changed

### `crates/bevy_camera/src/primitives.rs` (+1/-1)
This file contains a test that was using the deprecated pattern for creating empty arrays.

```rust
// Before:
assert_eq!(Aabb::enclosing(<[Vec3; 0]>::default()), None);

// After:
assert_eq!(Aabb::enclosing([] as [Vec3; 0]), None);
```

The change replaces the trait-based array construction with direct array literal syntax, maintaining the same test behavior.

### `crates/bevy_ecs/src/entity/unique_array.rs` (+1/-1)
This file contains the core ECS implementation for unique entity arrays.

```rust
// Before:
impl<T: EntityEquivalent> Default for UniqueEntityEquivalentArray<T, 0> {
    fn default() -> Self {
        Self(Default::default())
    }
}

// After:
impl<T: EntityEquivalent> Default for UniqueEntityEquivalentArray<T, 0> {
    fn default() -> Self {
        Self([])
    }
}
```

The change modifies the default implementation to use array literal syntax instead of relying on the `Default` trait for the inner array type.

## Further Reading

- [Rust PR #145457](https://github.com/rust-lang/rust/pull/145457) - The upstream Rust change that motivated this PR
- [Rust Array Types Documentation](https://doc.rust-lang.org/std/primitive.array.html) - Official documentation for Rust arrays
- [Rust Default Trait](https://doc.rust-lang.org/std/default/trait.Default.html) - Documentation for the Default trait

# Full Code Diff
diff --git a/crates/bevy_camera/src/primitives.rs b/crates/bevy_camera/src/primitives.rs
index e7f7526dce6ac..9b1fc41c59c39 100644
--- a/crates/bevy_camera/src/primitives.rs
+++ b/crates/bevy_camera/src/primitives.rs
@@ -652,7 +652,7 @@ mod tests {
 
     #[test]
     fn aabb_enclosing() {
-        assert_eq!(Aabb::enclosing(<[Vec3; 0]>::default()), None);
+        assert_eq!(Aabb::enclosing([] as [Vec3; 0]), None);
         assert_eq!(
             Aabb::enclosing(vec![Vec3::ONE]).unwrap(),
             Aabb::from_min_max(Vec3::ONE, Vec3::ONE)
diff --git a/crates/bevy_ecs/src/entity/unique_array.rs b/crates/bevy_ecs/src/entity/unique_array.rs
index 71df33ec5f42c..db6b67bd7af95 100644
--- a/crates/bevy_ecs/src/entity/unique_array.rs
+++ b/crates/bevy_ecs/src/entity/unique_array.rs
@@ -157,7 +157,7 @@ impl<T: EntityEquivalent, const N: usize> DerefMut for UniqueEntityEquivalentArr
 
 impl<T: EntityEquivalent> Default for UniqueEntityEquivalentArray<T, 0> {
     fn default() -> Self {
-        Self(Default::default())
+        Self([])
     }
 }
