+++
title = "#21367 Reexport `Entry` from `indexmap` crate"
date = "2025-10-03T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-10/pr-21367-en-20251003" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-10/pr-21367-zh-cn-20251003" }}
labels = ["D-Trivial", "A-ECS", "C-Usability"]
+++

# Reexport `Entry` from `indexmap` crate

## Basic Information
- **Title**: Reexport `Entry` from `indexmap` crate
- **PR Link**: https://github.com/bevyengine/bevy/pull/21367
- **Author**: VasanthakumarV
- **Status**: MERGED
- **Labels**: D-Trivial, A-ECS, C-Usability, S-Ready-For-Final-Review
- **Created**: 2025-10-03T18:50:58Z
- **Merged**: 2025-10-03T20:40:17Z
- **Merged By**: james7132

## Description Translation
# Objective

Fixes #21275 

Pasting the content of the Issue to provide context,

> bevy_ecs::entity::EntityIndexMap has the entry() method because it derefs to indexmap::IndexMap, but it doesn't re-export IndexMap::Entry so I have to import the indexmap crate manually.

> It would be convenient to re-export indexmap::Entry in bevy_ecs::entity::index_map

## The Story of This Pull Request

This PR addresses a straightforward but important ergonomic issue in the Bevy ECS module. The problem stemmed from how `EntityIndexMap` exposed functionality from its underlying `indexmap::IndexMap` dependency without providing full access to the associated types.

The core issue was that `EntityIndexMap` implements `Deref` to `IndexMap`, which means users could call methods like `entry()` that return `indexmap::map::Entry` types. However, because this `Entry` type wasn't re-exported in Bevy's public API, developers had to manually import the `indexmap` crate to work with the return types of methods they were calling on Bevy's own types.

This created an awkward developer experience where code that appeared to only depend on Bevy's API suddenly required knowledge of and direct dependency on an internal implementation detail. The problem is particularly noticeable because the `Entry` API pattern is commonly used for efficient map operations where you want to perform conditional insertions or updates.

The solution implemented here is a simple but effective one-line change: adding a public re-export of `indexmap::map::Entry` in the same module where `EntityIndexMap` is defined. This follows established Rust patterns for wrapper types - when you expose methods that return types from internal dependencies, you should also expose those types to maintain API coherence.

From a technical perspective, this change doesn't affect functionality but significantly improves API usability. The `Entry` type enables efficient map operations by providing an API that avoids multiple lookups. For example, with this re-export, developers can now write:

```rust
use bevy_ecs::entity::index_map::Entry;

match map.entry(entity) {
    Entry::Occupied(mut entry) => {
        *entry.get_mut() = new_value;
    }
    Entry::Vacant(entry) => {
        entry.insert(initial_value);
    }
}
```

Without having to add `indexmap` as an explicit dependency or import path.

This change demonstrates good API design principles - when you wrap a third-party type and expose its methods, you should also expose the types those methods return. It eliminates an unnecessary friction point for developers working with Bevy's ECS system and maintains the framework's goal of providing a cohesive, well-integrated API.

## Visual Representation

```mermaid
graph TD
    A[bevy_ecs::entity::index_map] --> B[EntityIndexMap]
    A --> C[Entry type]
    B --> D[Derefs to indexmap::IndexMap]
    D --> E[Has entry() method]
    E --> C
    C --> F[Now accessible without external imports]
```

## Key Files Changed

**File: `crates/bevy_ecs/src/entity/index_map.rs`**

This file contains the definition of `EntityIndexMap` and related types. The change adds a single re-export line:

```rust
// Before: No re-export of Entry type
use indexmap::map::{self, IndexMap, IntoValues, ValuesMut};

// After: Entry type is now publicly re-exported
pub use indexmap::map::Entry;
use indexmap::map::{self, IndexMap, IntoValues, ValuesMut};
```

The addition of `pub use indexmap::map::Entry;` makes the `Entry` type available at the module level, allowing users to import it directly from `bevy_ecs::entity::index_map` rather than needing to import from the `indexmap` crate directly.

This change is minimal but significant - it maintains the existing functionality while improving the developer experience by providing a more complete and self-contained API.

## Further Reading

- [Rust API Guidelines - Re-export](https://rust-lang.github.io/api-guidelines/necessities.html#c-reexport) - Guidelines on when and how to re-export types
- [IndexMap Entry API](https://docs.rs/indexmap/latest/indexmap/map/struct.Entry.html) - Documentation for the Entry type and its usage patterns
- [Bevy ECS EntityIndexMap](https://docs.rs/bevy_ecs/latest/bevy_ecs/entity/struct.EntityIndexMap.html) - Documentation for the EntityIndexMap type
- [Rust Deref trait](https://doc.rust-lang.org/std/ops/trait.Deref.html) - Understanding how Deref enables method delegation

# Full Code Diff
```diff
diff --git a/crates/bevy_ecs/src/entity/index_map.rs b/crates/bevy_ecs/src/entity/index_map.rs
index 6f6cd1bb47af3..9067b12ca28b2 100644
--- a/crates/bevy_ecs/src/entity/index_map.rs
+++ b/crates/bevy_ecs/src/entity/index_map.rs
@@ -17,6 +17,7 @@ use core::{
 
 #[cfg(feature = "bevy_reflect")]
 use bevy_reflect::Reflect;
+pub use indexmap::map::Entry;
 use indexmap::map::{self, IndexMap, IntoValues, ValuesMut};
 
 use super::{Entity, EntityEquivalent, EntityHash, EntitySetIterator};
```