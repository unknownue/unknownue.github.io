+++
title = "#21367 Reexport `Entry` from `indexmap` crate"
date = "2025-10-03T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-10/pr-21367-en-20251003" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-10/pr-21367-zh-cn-20251003" }}
labels = ["D-Trivial", "A-ECS", "C-Usability"]
+++

# Title

## Basic Information
- **Title**: Reexport `Entry` from `indexmap` crate
- **PR Link**: https://github.com/bevyengine/bevy/pull/21367
- **Author**: VasanthakumarV
- **Status**: MERGED
- **Labels**: D-Trivial, A-ECS, C-Usability, S-Ready-For-Final-Review
- **Created**: 2025-10-03T18:50:58Z
- **Merged**: 2025-10-03T20:40:17Z
- **Merged By**: james7132

## Description Translation
# 目标

修复 #21275

粘贴问题内容以提供上下文：

> bevy_ecs::entity::EntityIndexMap 有 entry() 方法，因为它解引用到 indexmap::IndexMap，但它没有重新导出 IndexMap::Entry，所以我必须手动导入 indexmap crate。

> 在 bevy_ecs::entity::index_map 中重新导出 indexmap::Entry 会很方便。

## The Story of This Pull Request

这个 PR 解决了一个用户体验问题。在 Bevy ECS 中，`EntityIndexMap` 类型通过 Deref trait 暴露了 `indexmap::IndexMap` 的 `entry()` 方法，但相关的 `Entry` 类型没有被重新导出，导致开发者在使用时需要额外导入 `indexmap` crate。

问题背景是，当开发者使用 `EntityIndexMap::entry()` 方法时，返回的类型是 `indexmap::map::Entry`，但这个类型在 `bevy_ecs` 模块中不可直接访问。开发者必须显式地添加 `use indexmap::map::Entry;` 或者使用完整的路径来使用这个类型，这增加了不必要的导入负担。

解决方案很简单直接：在 `bevy_ecs/src/entity/index_map.rs` 中添加一行重新导出的代码。这个改动遵循了 Rust 生态中常见的模式——当包装或依赖外部类型时，重新导出相关的类型以提供更好的开发体验。

从技术实现角度看，这个 PR 只是添加了一行代码：

```rust
pub use indexmap::map::Entry;
```

这个重新导出使得开发者现在可以通过 `bevy_ecs::entity::index_map::Entry` 直接访问该类型，而不需要知道底层使用的是 `indexmap` crate。这符合 API 设计的最佳实践，即隐藏实现细节，提供简洁的公共接口。

这种类型的改进虽然看起来很小，但对于库的使用者来说却很重要。它减少了认知负担，让开发者能够更专注于业务逻辑而不是依赖管理。在大型项目中，这类改进积累起来能显著提升开发效率。

从工程角度看，这个改动是零成本的——它不会影响运行时性能，不会改变现有 API 的行为，只是扩展了类型的可访问性。这也是为什么它被标记为 "D-Trivial" 和 "C-Usability"——这是一个简单的可用性改进。

## Visual Representation

```mermaid
graph LR
    A[indexmap::map::Entry] --> B[bevy_ecs::entity::index_map]
    B --> C[User Code]
    C --> D[No need to import indexmap directly]
```

## Key Files Changed

### `crates/bevy_ecs/src/entity/index_map.rs` (+1/-0)

这个文件是 EntityIndexMap 和相关功能的定义位置。改动很简单，只是添加了一行重新导出的语句。

**改动详情：**
```rust
// 文件：crates/bevy_ecs/src/entity/index_map.rs

// 在原有的导入语句基础上添加：
pub use indexmap::map::Entry;

// 原有的其他导入保持不变：
#[cfg(feature = "bevy_reflect")]
use bevy_reflect::Reflect;
use indexmap::map::{self, IndexMap, IntoValues, ValuesMut};
// ... 其他代码
```

这个改动使得 `Entry` 类型现在可以通过 `bevy_ecs::entity::index_map::Entry` 路径访问，与 `EntityIndexMap` 类型在同一个模块中，提供了更好的 API 一致性。

## Further Reading

- [Rust 的重新导出（Re-exports）模式](https://doc.rust-lang.org/reference/items/use-declarations.html#use-declarations)
- [Bevy ECS 文档](https://docs.rs/bevy_ecs/latest/bevy_ecs/)
- [indexmap crate 文档](https://docs.rs/indexmap/latest/indexmap/)
- [Rust 的 Deref trait 和智能指针](https://doc.rust-lang.org/book/ch15-02-deref.html)