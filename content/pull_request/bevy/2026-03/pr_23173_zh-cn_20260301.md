+++
title = "#23173 修复 generate_view_layouts 废弃警告中的错误 Bevy 版本"
date = "2026-03-01T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2026-03/pr-23173-en-20260301" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2026-03/pr-23173-zh-cn-20260301" }}
+++

# Title
fix incorrect bevy version in generate_view_layouts deprecation

## Basic Information
- **标题**: 修复 generate_view_layouts 废弃警告中的错误 Bevy 版本
- **PR 链接**: https://github.com/bevyengine/bevy/pull/23173
- **作者**: arovge
- **状态**: 已合并
- **标签**: 无
- **创建时间**: 2026-02-28T23:03:15Z
- **合并时间**: 2026-02-28T23:57:41Z
- **合并者**: alice-i-cecile

## Description Translation
### 目标

PR https://github.com/bevyengine/bevy/pull/17714 创建于 2025 年 2 月，原计划在 Bevy 0.16 版本中引入废弃警告。

该 PR 最近被合并，但一个关于更新废弃版本的评论始终未被处理：https://github.com/bevyengine/bevy/pull/17714#discussion_r2766404523。

### 解决方案

将废弃警告的版本从 0.16 调整为 0.19，因为此更改将包含在 0.19 版本中。

### 测试

CI

## The Story of This Pull Request

这个 PR 的故事始于一个版本同步的问题。在软件工程中，维护准确的废弃警告对于 API 的平滑演进至关重要。Bevy 引擎使用了 Rust 的 `#[deprecated]` 属性来标记即将被移除或替代的功能，这个属性包含两个关键参数：`since`（标识该功能被废弃的版本）和 `note`（提供迁移指导）。

PR #17714 最初在 2025 年 2 月创建，目标是废弃 `generate_view_layouts` 函数，引导开发者转向新的 `layout_entries` 方法。当时的规划是将这个废弃引入 Bevy 0.16 版本。然而，软件开发的现实是，PR 的合并时间线并不总是与版本发布计划完美对齐。

当 PR #17714 最终被合并时，它包含了一个 `since = "0.16.0"` 的废弃声明。但此时，Bevy 已经演进到了更新的版本，这个更改实际上将被包含在 0.19 版本中。这种版本号的不匹配会造成混淆：开发者看到废弃警告提到 0.16 版本，但实际功能在 0.19 版本中才被废弃。这违反了废弃警告的基本原则——准确告知用户功能从哪个版本开始不再推荐使用。

从技术角度看，废弃警告的管理需要在版本控制和代码合并之间保持同步。PR #17714 中的评论讨论（https://github.com/bevyengine/bevy/pull/17714#discussion_r2766404523）指出了这个问题，但可能由于时间或其他因素，该评论未被处理。这就留下了一个技术债务——一个不准确的废弃声明。

PR #23173 提供了一个简洁而直接的解决方案：将废弃版本从 0.16.0 更新到 0.19.0。这个更改虽然小，但对于维护 API 文档的准确性和开发者体验至关重要。准确的废弃信息帮助开发者：
1. 正确理解他们的代码何时需要迁移
2. 避免不必要的担忧（看到 0.16 的废弃但代码在 0.17 或 0.18 中仍能正常工作）
3. 规划升级路径

这个修复体现了软件工程中的一个重要实践：即使是最小的元数据（如版本号）也需要与代码变更的实际影响范围保持一致。在大型项目中，这类细节的准确性直接影响开发者对项目稳定性和维护质量的感知。

从实现角度看，这个更改是局部的、非侵入性的。它只修改了属性宏的参数，不涉及任何运行时逻辑。然而，它的价值在于维护了项目文档和警告系统的可信度。CI 测试验证了这个更改不会破坏构建，确保向后兼容性得到保持。

## Visual Representation

```mermaid
graph TD
    A[PR #17714 创建于 2025-02] --> B[计划在 0.16 版本废弃 generate_view_layouts]
    B --> C[PR 延迟合并]
    C --> D[实际将包含在 0.19 版本]
    D --> E[版本号不匹配问题]
    E --> F[PR #23173 修复版本号]
    F --> G[废弃警告 now = "0.19.0"]
```

## Key Files Changed

### `crates/bevy_pbr/src/render/mesh_view_bindings.rs` (+1/-1)

这个文件包含 Bevy 物理基础渲染（PBR）系统中网格视图绑定的相关定义。具体的更改在一个废弃声明中。

**更改原因**：修正 `generate_view_layouts` 函数废弃警告中的版本号，使其与实际包含该废弃的 Bevy 版本（0.19）一致。

**代码变更**：
```rust
// 文件: crates/bevy_pbr/src/render/mesh_view_bindings.rs
// 之前:
#[deprecated(since = "0.16.0", note = "Use `layout_entries` instead")]

// 之后:
#[deprecated(since = "0.19.0", note = "Use `layout_entries` instead")]
```

这个更改只涉及 `#[deprecated]` 属性宏的 `since` 参数。函数签名和实现保持不变，仍然是：
```rust
pub fn generate_view_layouts(
    render_device: &RenderDevice,
    render_adapter: &RenderAdapter,
    layout_key: MeshPipelineViewLayoutKey,
) -> [BindGroupLayoutEntryBuilder<'_>; 4] {
    // ... 函数实现
}
```

**与 PR 目标的关系**：这个单行的修改直接解决了 PR 描述中提到的版本不匹配问题，确保废弃警告准确地反映了功能被废弃的实际版本。

## Further Reading

1. **Rust 废弃属性文档**：了解 `#[deprecated]` 属性的完整用法和最佳实践
   - https://doc.rust-lang.org/reference/attributes/diagnostics.html#the-deprecated-attribute

2. **Bevy 版本发布流程**：理解 Bevy 的版本管理和发布周期
   - https://github.com/bevyengine/bevy/blob/main/docs/plugins_guidelines.md#versioning

3. **语义化版本控制**：深入理解版本号管理的原则
   - https://semver.org/

4. **API 演化模式**：学习如何在保持向后兼容性的同时演进 API
   - 《API Design for C++》中关于 API 演化的章节

# Full Code Diff
```diff
diff --git a/crates/bevy_pbr/src/render/mesh_view_bindings.rs b/crates/bevy_pbr/src/render/mesh_view_bindings.rs
index b91fbf17e566f..ed747b028efb0 100644
--- a/crates/bevy_pbr/src/render/mesh_view_bindings.rs
+++ b/crates/bevy_pbr/src/render/mesh_view_bindings.rs
@@ -544,7 +544,7 @@ impl MeshPipelineViewLayouts {
 
 /// Generates all possible view layouts for the mesh pipeline, based on all combinations of
 /// [`MeshPipelineViewLayoutKey`] flags.
-#[deprecated(since = "0.16.0", note = "Use `layout_entries` instead")]
+#[deprecated(since = "0.19.0", note = "Use `layout_entries` instead")]
 pub fn generate_view_layouts(
     render_device: &RenderDevice,
     render_adapter: &RenderAdapter,
```