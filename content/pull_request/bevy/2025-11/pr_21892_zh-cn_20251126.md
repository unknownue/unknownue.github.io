+++
title = "#21892 Fix an error in migration guides"
date = "2025-11-26T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-11/pr-21892-en-20251126" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-11/pr-21892-zh-cn-20251126" }}
labels = ["C-Docs", "D-Trivial", "A-Assets"]
+++

# Fix an error in migration guides

## Basic Information
- **Title**: Fix an error in migration guides
- **PR Link**: https://github.com/bevyengine/bevy/pull/21892
- **Author**: samoylovfp
- **Status**: MERGED
- **Labels**: C-Docs, D-Trivial, A-Assets, S-Ready-For-Final-Review
- **Created**: 2025-11-20T07:22:00Z
- **Merged**: 2025-11-26T22:27:51Z
- **Merged By**: mockersf

## Description Translation
# 目标

这是对 https://github.com/bevyengine/bevy/pull/21713/files 的后续跟进

我在迁移指南中注意到一些奇怪的地方 --- `asset_path` 方法已被移除，
所以现在建议的修复会产生
```
在当前作用域中未找到名为 `asset_path` 的方法用于可变引用 `&mut LoadContext<'c>`
```

获取原始路径的实际更改是 `.path().path()`

## 解决方案
更新了迁移指南
## 测试
我在 `GltfLoader` 中尝试使用了 `load_context` 并检查了方法返回的签名

---

感谢 Alice 的合并列车发现了这个问题

## 这个 PR 的故事

这个 PR 源于对先前 PR #21713 的后续观察。在之前的更改中，`LoadContext` 的 API 发生了变化，移除了 `asset_path` 方法。迁移指南需要相应地更新，但最初的更新包含了一个错误。

问题的核心在于方法调用的链式结构。当开发者按照迁移指南的建议，将 `load_context.path()` 替换为 `load_context.asset_path().path()` 时，会遇到编译错误，因为 `asset_path` 方法已经不存在了。

作者在测试过程中发现了这个实际问题。通过在 `GltfLoader` 中实际操作 `load_context` 并检查方法签名，确认了正确的调用方式应该是 `load_context.path().path()`。这个双重 `.path()` 调用看起来可能有些反直觉，但它反映了 API 设计的层级结构：第一个 `.path()` 返回一个 `AssetPath` 对象，第二个 `.path()` 才是获取底层文件系统路径。

这个修复虽然只是文档中的一个字符更改，但对于使用迁移指南的开发者来说至关重要。错误的迁移指导会导致编译失败，阻碍用户顺利升级到新版本。

从技术角度看，这个更改反映了 Bevy 资产系统 API 的演进。`AssetPath` 被设计为比直接使用 `Path` 更安全的选择，因为它支持自定义资产源，而直接使用文件系统路径可能会在某些场景下出现问题。迁移指南中的注释也强调了这一点，提醒开发者认真考虑是否真的需要使用 `Path` 本身。

## 技术关系图

```mermaid
graph LR
    A[LoadContext] --> B[path()方法]
    B --> C[AssetPath对象]
    C --> D[path()方法]
    D --> E[文件系统Path]
```

## 关键文件更改

**`release-content/migration-guides/load_context_asset_path.md`** (+1/-1)

这个文件包含了从旧版本 Bevy 迁移到新版本时关于 `LoadContext` API 变更的指导。主要的更改是修正了一个方法调用链的错误。

```markdown
# 修改前:
- `load_context.path()` -> `load_context.asset_path().path()`

# 修改后:  
- `load_context.path()` -> `load_context.path().path()`
```

这个单行更改修正了迁移指南中的错误，确保开发者能够正确地更新他们的代码以适应新的 API。注释部分保持不变，继续提醒开发者在使用 `Path` 直接时要谨慎，因为它不支持自定义资产源。

## 延伸阅读

- [PR #21713](https://github.com/bevyengine/bevy/pull/21713) - 原始 API 变更的 PR
- [Bevy 资产系统文档](https://docs.rs/bevy/latest/bevy/asset/index.html) - 了解 Bevy 资产系统的完整 API
- [AssetPath 文档](https://docs.rs/bevy/latest/bevy/asset/struct.AssetPath.html) - 了解 AssetPath 的详细用法

# Full Code Diff
```diff
diff --git a/release-content/migration-guides/load_context_asset_path.md b/release-content/migration-guides/load_context_asset_path.md
index 8b06e8f5f610d..c4a2e58b585ae 100644
--- a/release-content/migration-guides/load_context_asset_path.md
+++ b/release-content/migration-guides/load_context_asset_path.md
@@ -7,7 +7,7 @@ pull_requests: [21713]
 migrations are:
 
 - `load_context.asset_path()` -> `load_context.path()`
-- `load_context.path()` -> `load_context.asset_path().path()`
+- `load_context.path()` -> `load_context.path().path()`
   - While this migration will keep your code running, seriously consider whether you need to use
     the `Path` itself. The `Path` does not support custom asset sources, so care needs to be taken
     when using it directly. Consider instead using the `AssetPath` instead, along with
```