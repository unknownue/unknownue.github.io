+++
title = "#21944 Remove unused `num_workgroups` from game_of_life shader"
date = "2025-11-26T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-11/pr-21944-en-20251126" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-11/pr-21944-zh-cn-20251126" }}
labels = ["A-Rendering", "C-Code-Quality"]
+++

# Remove unused `num_workgroups` from game_of_life shader

## Basic Information
- **Title**: Remove unused `num_workgroups` from game_of_life shader
- **PR Link**: https://github.com/bevyengine/bevy/pull/21944
- **Author**: shunkie
- **Status**: MERGED
- **Labels**: A-Rendering, C-Code-Quality, S-Ready-For-Final-Review
- **Created**: 2025-11-26T03:38:08Z
- **Merged**: 2025-11-26T04:28:15Z
- **Merged By**: alice-i-cecile

## Description Translation
这个PR移除了未使用的`num_workgroups`参数。

## 测试

```
cargo run --example compute_shader_game_of_life
```

## The Story of This Pull Request

这是一个典型的代码清理任务，涉及到一个计算着色器中未使用参数的移除。在GPU编程中，计算着色器通常使用`@builtin`属性来访问系统提供的内置变量，比如`global_invocation_id`用于确定当前线程的全局位置，而`num_workgroups`则提供了工作组的总数信息。

开发者发现，在Bevy引擎的Game of Life示例计算着色器中，`init`函数声明了`num_workgroups`参数，但在函数体内完全没有使用这个变量。在WGSL着色器语言中，声明但未使用的参数不仅增加了代码的冗余，还可能对性能产生微小影响，因为GPU需要为这些未使用的参数分配资源。

问题的根本原因可能是代码演进过程中的遗留问题。最初设计着色器时，开发者可能计划使用工作组数量信息来进行某些计算，但最终实现时发现不需要这个信息，却忘记移除对应的参数声明。

解决方案非常直接：移除未使用的`num_workgroups`参数。这种修改属于代码质量改进，不改变任何功能行为。在验证方面，开发者运行了现有的计算着色器示例来确保修改没有破坏现有功能。

从技术角度来看，这个修改体现了良好的代码维护实践。在GPU编程中，精简的着色器代码不仅提高可读性，还可能带来微小的性能提升，因为减少了不必要的寄存器占用和参数传递开销。

这个PR的影响虽然不大，但体现了持续代码优化的重要性。它保持了代码库的整洁，为后续开发者提供了更清晰的代码示例，也减少了潜在的混淆点。

## Visual Representation

```mermaid
graph LR
    A[game_of_life.wgsl] --> B[init函数]
    B --> C[移除num_workgroups参数]
    C --> D[代码质量提升]
```

## Key Files Changed

### `assets/shaders/game_of_life.wgsl` (+1/-1)

这个文件包含了Game of Life示例的计算着色器代码。修改移除了`init`函数中未使用的`num_workgroups`参数。

```wgsl
# 修改前:
fn init(@builtin(global_invocation_id) invocation_id: vec3<u32>, @builtin(num_workgroups) num_workgroups: vec3<u32>) {

# 修改后:
fn init(@builtin(global_invocation_id) invocation_id: vec3<u32>) {
```

这个修改直接对应PR的核心目标：清理未使用的代码。函数体中的逻辑保持不变，仍然使用`invocation_id`来计算位置和生成随机数。

## Further Reading

- [WGSL Specification - Built-in Values](https://gpuweb.github.io/gpuweb/wgsl/#builtin-values)
- [Bevy Compute Shaders Documentation](https://bevyengine.org/learn/quick-start/ecs/compute-shaders/)
- [WebGPU Shader Language (WGSL) Guide](https://sotrh.github.io/learn-wgpu/)