+++
title = "#20639 Fix imports in some 2d examples with custom shaders"
date = "2025-08-18T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-08/pr-20639-en-20250818" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-08/pr-20639-zh-cn-20250818" }}
labels = ["C-Bug", "D-Trivial", "A-Rendering", "C-Examples"]
+++

# Fix imports in some 2d examples with custom shaders

## Basic Information
- **Title**: Fix imports in some 2d examples with custom shaders
- **PR Link**: https://github.com/bevyengine/bevy/pull/20639
- **Author**: rparrett
- **Status**: MERGED
- **Labels**: C-Bug, D-Trivial, A-Rendering, C-Examples, S-Ready-For-Final-Review
- **Created**: 2025-08-18T18:04:03Z
- **Merged**: 2025-08-18T22:21:25Z
- **Merged By**: mockersf

## Description Translation
### 目标
修复 #20615

### 解决方案
当导入在 #20587 中移动时，这些着色器未更新。修复导入。

### 测试
```
cargo run --example custom_gltf_vertex_attribute
cargo run --example shader_material_2d
cargo run --example mesh2d_manual
```

## The Story of This Pull Request

该PR源于一次重构后的遗漏问题。在之前的PR #20587中，Bevy团队对渲染模块进行了重构，将`sprite`模块中的渲染相关代码移动到了新的`sprite_render`模块中。这个重构是必要的架构优化，但导致了三个2D示例中的自定义着色器出现了导入路径错误。

问题具体表现为：当开发者尝试运行`custom_gltf_vertex_attribute`、`shader_material_2d`和`mesh2d_manual`等示例时，这些着色器无法正确编译，因为它们仍然引用旧的`bevy_sprite`路径而非更新后的`bevy_sprite_render`路径。这种问题属于典型的重构后遗症，在大型代码库中经常发生。

解决方案直接明了：将所有受影响的着色器文件中的错误导入路径更新为正确的路径。具体来说，就是将`#import bevy_sprite::`统一替换为`#import bevy_sprite_render::`。这种修改虽然简单，但对于保持示例的可运行性至关重要，因为示例代码是开发者学习引擎功能的重要资源。

在实现过程中，作者还额外修正了`custom_vertex_attribute.wgsl`文件中的一条注释。原始注释建议将`bevy_pbr::mesh_functions`替换为`bevy_sprite::mesh2d_functions`，但这已不符合当前代码结构。更新后的注释准确反映了新的模块结构，避免了未来开发者被误导。

这些修改经过验证，确认三个受影响的示例都能正常运行：
```
cargo run --example custom_gltf_vertex_attribute
cargo run --example shader_material_2d
cargo run --example mesh2d_manual
```

该PR属于典型的小范围修复，不涉及复杂逻辑变更。它展示了在模块重构后全面更新依赖项的重要性，即使是注释中的过时引用也可能造成混淆。对于维护大型项目而言，这种及时修复能防止错误传播并保持文档的准确性。

## Visual Representation

```mermaid
graph LR
    A[PR #20587] -->|模块重构| B[渲染模块移动]
    B --> C[着色器导入路径失效]
    C --> D[PR #20639]
    D -->|更新路径| E[示例恢复功能]
```

## Key Files Changed

### assets/shaders/custom_gltf_2d.wgsl
**修改原因**：更新导入路径以匹配重构后的模块结构  
```wgsl
// Before:
#import bevy_sprite::{
    mesh2d_view_bindings::globals,
    mesh2d_functions::{get_world_from_local, mesh2d_position_local_to_clip},
}

// After:
#import bevy_sprite_render::{
    mesh2d_view_bindings::globals,
    mesh2d_functions::{get_world_from_local, mesh2d_position_local_to_clip},
}
```

### assets/shaders/custom_material_2d.wgsl
**修改原因**：修正顶点输出结构的导入路径  
```wgsl
// Before:
#import bevy_sprite::mesh2d_vertex_output::VertexOutput

// After:
#import bevy_sprite_render::mesh2d_vertex_output::VertexOutput
```

### assets/shaders/custom_vertex_attribute.wgsl
**修改原因**：更新注释中的模块引用  
```wgsl
// Before:
// For 2d replace `bevy_pbr::mesh_functions` with `bevy_sprite::mesh2d_functions`

// After:
// For 2d replace `bevy_pbr::mesh_functions` with `bevy_sprite_render::mesh2d_functions`
```

### examples/2d/mesh2d_manual.rs
**修改原因**：修正内联着色器代码中的导入路径  
```rust
// Before:
#import bevy_sprite::mesh2d_functions

// After:
#import bevy_sprite_render::mesh2d_functions
```

## Further Reading
1. [WGSL 导入语法文档](https://gpuweb.github.io/gpuweb/wgsl/#imports)  
2. [Bevy 着色器系统指南](https://bevyengine.org/learn/book/getting-started/shaders/)  
3. [模块重构最佳实践](https://refactoring.guru/smells/divergent-change)