+++
title = "#20582 Remove redundant number conversion in window resolution"
date = "2025-08-20T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-08/pr-20582-en-20250820" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-08/pr-20582-zh-cn-20250820" }}
labels = ["A-Windowing", "C-Usability"]
+++

# Remove redundant number conversion in window resolution

## Basic Information
- **Title**: Remove redundant number conversion in window resolution
- **PR Link**: https://github.com/bevyengine/bevy/pull/20582
- **Author**: BigWingBeat
- **Status**: MERGED
- **Labels**: A-Windowing, C-Usability, S-Ready-For-Final-Review, M-Needs-Migration-Guide
- **Created**: 2025-08-15T04:37:45Z
- **Merged**: 2025-08-20T18:41:11Z
- **Merged By**: alice-i-cecile

## Description Translation
# Objective

`WindowResolution` stores the width and height as `u32`, but the constructors take `f32` and just convert straight to `u32`. Additionally, everywhere in Bevy where a `WindowResolution` is constructed specifies whole numbers, making the use of a float entirely pointless.

## Solution

Replace the `f32` constructors with `u32` constructors.

I also decided to change the generic `I: Into<f32>` tuple and array constructors to only take u32 instead of `I: Into<u32>` for UX reasons. It allows formatting those constructors as `(1920, 1080).into()`, as the compiler can infer that the numbers are u32. Keeping those impls generic prevents that inference, and because the default number type (i32) doesn't impl `Into<u32>`, that would require formatting it explicitly as `(1920u32, 1080u32).into()` to compile.

In practice, these generic constructors were only used with whole-number f32 values anyway, like everything else, so them being generic wasn't actually leveraged anywhere.

## Testing

Chased type errors until they were all gone

## The Story of This Pull Request

This PR addresses a straightforward but pervasive inconsistency in Bevy's window resolution handling. The core issue was that `WindowResolution` internally stores width and height as `u32` values, but its constructors accepted `f32` parameters that were immediately converted to `u32`. This design created unnecessary type conversions throughout the codebase without providing any practical benefit.

The problem became evident when examining how window resolutions were used across the codebase. Every single usage passed whole numbers (like 1920.0, 1080.0) to the constructors, making the floating-point parameters entirely redundant. The conversion from `f32` to `u32` was not just unnecessary - it also introduced potential precision issues and made the API less intuitive.

The solution involved a systematic refactoring of the `WindowResolution` API. The main change was modifying the `new` method to accept `u32` parameters directly instead of `f32`. This eliminated the redundant conversion and made the API more type-appropriate:

```rust
// Before:
WindowResolution::new(1920.0, 1080.0)

// After:
WindowResolution::new(1920, 1080)
```

A key design decision involved the generic `From` implementations. The original implementation used `I: Into<f32>` for tuples and arrays, which allowed various numeric types but required explicit type annotations in many cases. The PR changed these to specifically accept `u32` types:

```rust
// Before: Generic but required explicit typing
impl<I> From<(I, I)> for WindowResolution where I: Into<f32>

// After: Specific but enables type inference
impl From<(u32, u32)> for WindowResolution
```

This change improved developer experience by allowing natural syntax like `(1920, 1080).into()` without requiring type suffixes or explicit conversions. The compiler can now infer the correct types, making the code cleaner and more readable.

The implementation also added a `From<UVec2>` implementation while removing the `From<Vec2>` and `From<DVec2>` implementations, further aligning the API with the integer-based nature of window resolutions.

The changes required updates throughout the entire codebase - 19 example files, multiple test files, and core UI modules needed modifications to use the new API. This widespread impact demonstrates how fundamental window resolution is to Bevy's architecture.

The PR also included the creation of a migration guide to help developers transition from the old API to the new one, showing common patterns and their updated equivalents.

From a technical perspective, this change eliminates unnecessary floating-point operations and type conversions, providing minor performance benefits. More importantly, it creates a more consistent and type-safe API that better represents the actual data requirements of window resolutions.

## Visual Representation

```mermaid
graph TD
    A[WindowResolution API] --> B[Core Constructor Changes]
    A --> C[From Implementation Changes]
    A --> D[Example Updates]
    A --> E[Test Updates]
    
    B --> F[new() now takes u32 instead of f32]
    C --> G[From<(u32, u32)> instead of generic]
    C --> H[From<UVec2> added]
    C --> I[From<Vec2> and From<DVec2> removed]
    
    D --> J[19 example files updated]
    E --> K[Multiple test files updated]
    
    F --> L[Eliminates redundant f32->u32 conversion]
    G --> M[Enables better type inference]
    H --> N[Better alignment with integer coordinates]
```

## Key Files Changed

### `crates/bevy_window/src/window.rs` (+13/-25)
This file contains the core changes to the `WindowResolution` API. The constructor was changed to accept `u32` instead of `f32`, and the `From` implementations were updated to work with integer types.

```rust
// Before:
pub fn new(physical_width: f32, physical_height: f32) -> Self {
    Self {
        physical_width: physical_width as u32,
        physical_height: physical_height as u32,
        ..Default::default()
    }
}

// After:
pub fn new(physical_width: u32, physical_height: u32) -> Self {
    Self {
        physical_width,
        physical_height,
        ..Default::default()
    }
}
```

### `crates/bevy_ui/src/update.rs` (+8/-16)
This file needed updates to use the new `WindowResolution` API in tests, replacing explicit `as f32` conversions with direct `UVec2` to `WindowResolution` conversions.

```rust
// Before:
resolution: WindowResolution::new(physical_size.x as f32, physical_size.y as f32)
    .with_scale_factor_override(10.)

// After:
resolution: WindowResolution::from(physical_size).with_scale_factor_override(10.)
```

### `release-content/migration-guides/window_resolution_constructors.md` (+21/-0)
This new file provides a migration guide for developers updating their code to use the new API.

```markdown
The `WindowResolution` type stores the width and height as `u32`. Previously, this type could only be constructed with `f32`, which were immediately converted to `u32`.
Now, `WindowResolution` can be constructed with `u32`s directly, and the pointless `f32` conversion has been removed.
```

### `examples/shader/compute_shader_game_of_life.rs` (+6/-10)
This example was updated to use the new API, replacing floating-point values with integers and using `UVec2` for better type consistency.

```rust
// Before:
const SIZE: (u32, u32) = (1280 / DISPLAY_FACTOR, 720 / DISPLAY_FACTOR)
resolution: ((SIZE.0 * DISPLAY_FACTOR) as f32, (SIZE.1 * DISPLAY_FACTOR) as f32).into()

// After:
const SIZE: UVec2 = UVec2::new(1280 / DISPLAY_FACTOR, 720 / DISPLAY_FACTOR)
resolution: (SIZE * DISPLAY_FACTOR).into()
```

### `crates/bevy_ui/src/layout/mod.rs` (+4/-4)
Test constants were updated from `f32` to `u32` to match the new API, with appropriate casting in assertions.

```rust
// Before:
const WINDOW_WIDTH: f32 = 1000.;
const WINDOW_HEIGHT: f32 = 100.;

// After:
const WINDOW_WIDTH: u32 = 1000;
const WINDOW_HEIGHT: u32 = 100;
```

## Further Reading

- [Rust Type Conversions](https://doc.rust-lang.org/rust-by-example/conversion.html) - Understanding Rust's approach to type conversions
- [Bevy Window Documentation](https://docs.rs/bevy_window/latest/bevy_window/) - Official documentation for Bevy's window handling
- [API Design Guidelines](https://rust-lang.github.io/api-guidelines/) - Best practices for designing Rust APIs

# Full Code Diff
[The full code diff is available in the original PR](https://github.com/bevyengine/bevy/pull/20582/files)