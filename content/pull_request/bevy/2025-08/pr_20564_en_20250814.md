+++
title = "#20564 add example of using system state with an exclusive system"
date = "2025-08-14T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = true

[taxonomies]
list_display = ["show"]

[extra]
current_language = "en"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-08/pr-20564-en-20250814" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-08/pr-20564-zh-cn-20250814" }}
labels = ["C-Docs", "A-ECS", "C-Examples", "D-Straightforward"]
+++

# add example of using system state with an exclusive system

## Basic Information
- **Title**: add example of using system state with an exclusive system
- **PR Link**: https://github.com/bevyengine/bevy/pull/20564
- **Author**: hymm
- **Status**: MERGED
- **Labels**: C-Docs, A-ECS, C-Examples, S-Ready-For-Final-Review, D-Straightforward
- **Created**: 2025-08-13T20:50:37Z
- **Merged**: 2025-08-14T02:26:43Z
- **Merged By**: james7132

## Description Translation
# Objective

- Make using SystemState as a ExclusiveSystemParam more discoverable

## Solution

- add an example of using it with an exclusive system to the SystemState docs.

<img width="1225" height="375" alt="image" src="https://github.com/user-attachments/assets/031d458a-f67c-448e-9ad9-57501f5b2531" />

## The Story of This Pull Request

The core issue addressed in this PR was documentation discoverability. In Bevy's ECS architecture, `SystemState` is a powerful tool for caching system parameters between executions, but developers needed clearer examples of how to use it with exclusive systems. Exclusive systems (those requiring `&mut World` access) have different constraints than regular systems, and the existing documentation only showed `SystemState` usage in regular systems. This gap made it harder for developers to properly leverage `SystemState` in exclusive contexts.

The solution approach was straightforward: extend the existing `SystemState` documentation with a targeted code example demonstrating its usage in an exclusive system. The author chose to place this example directly in the struct's doc comments, ensuring it appears in Rustdoc-generated documentation where developers would naturally look for usage guidance.

The implementation added a new Rust documentation block showing how to declare an exclusive system that takes `SystemState` as a parameter. The example demonstrates:
1. Declaring an exclusive system signature with `&mut World` and `&mut SystemState<EventReader<MyEvent>>` parameters
2. Using `system_state.get_mut(world)` to retrieve the event reader
3. Iterating through events with `event_reader.read()`

```rust
fn exclusive_system(world: &mut World, system_state: &mut SystemState<EventReader<MyEvent>>) {
    let mut event_reader = system_state.get_mut(world);
    
    for events in event_reader.read() {
        println!("Hello World!");
    }
}
```

This example effectively shows the key technical aspects:
- `SystemState` must be declared as mutable (`&mut`)
- `get_mut()` requires passing the exclusive `World` reference
- The retrieved `EventReader` can then be used normally

The PR's impact is improved developer experience and reduced friction when working with exclusive systems. By making this pattern more discoverable, it helps prevent common mistakes like trying to store `SystemState` in resources (which isn't supported) or improperly initializing it. The solution maintains Bevy's documentation consistency by following existing patterns for system examples.

## Visual Representation

```mermaid
graph TD
    A[SystemState Documentation] --> B[Regular System Example]
    A --> C[New Exclusive System Example]
    C --> D[&mut World Parameter]
    C --> E[&mut SystemState Parameter]
    C --> F[get_mut() Usage]
```

## Key Files Changed

### `crates/bevy_ecs/src/system/function_system.rs`
Added documentation example for using `SystemState` in exclusive systems

Before:
```rust
///     }
/// });
/// ```
pub struct SystemState<Param: SystemParam + 'static> {
    meta: SystemMeta,
    param_state: Param::State,
```

After:
```rust
///     }
/// });
/// ```
/// Exclusive System:
/// ```
/// # use bevy_ecs::prelude::*;
/// # use bevy_ecs::system::SystemState;
/// #
/// # #[derive(BufferedEvent)]
/// # struct MyEvent;
/// #
/// fn exclusive_system(world: &mut World, system_state: &mut SystemState<EventReader<MyEvent>>) {
///     let mut event_reader = system_state.get_mut(world);
///
///     for events in event_reader.read() {
///         println!("Hello World!");
///     }
/// }
/// ```
pub struct SystemState<Param: SystemParam + 'static> {
    meta: SystemMeta,
    param_state: Param::State,
```

## Further Reading
- [Bevy ECS SystemState Documentation](https://docs.rs/bevy_ecs/latest/bevy_ecs/system/struct.SystemState.html)
- [Bevy Book: Exclusive Systems](https://bevyengine.org/learn/book/next/programming/exclusive-systems/)
- [Rustdoc Guide on Code Examples](https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html)