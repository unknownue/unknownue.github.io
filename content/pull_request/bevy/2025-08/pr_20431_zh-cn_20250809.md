+++
title = "#20431 try to fix GitHub Actions permissions"
date = "2025-08-09T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-08/pr-20431-en-20250809" }, "zh-cn" = { name = "ä¸­æ–‡", url = "/pull_request/bevy/2025-08/pr-20431-zh-cn-20250809" }}
+++

# Pull Request åˆ†ææŠ¥å‘Šï¼šä¿®å¤ GitHub Actions æƒé™é—®é¢˜

## åŸºæœ¬ä¿¡æ¯
- **æ ‡é¢˜**: try to fix GitHub Actions permissions
- **PR é“¾æ¥**: https://github.com/bevyengine/bevy/pull/20431
- **ä½œè€…**: mockersf
- **çŠ¶æ€**: å·²åˆå¹¶
- **æ ‡ç­¾**: C-Bug, D-Trivial, A-Build-System, S-Ready-For-Final-Review
- **åˆ›å»ºæ—¶é—´**: 2025-08-05T20:55:09Z
- **åˆå¹¶æ—¶é—´**: 2025-08-09T01:23:56Z
- **åˆå¹¶è€…**: james7132

## é—®é¢˜æè¿°ç¿»è¯‘
### ç›®æ ‡ (Objective)
- è‡ªä» #20416 åï¼ŒGitHub Actions æŠ¥é”™å¦‚ä¸‹ï¼š
```
Invalid workflow file
The workflow is not valid. .github/workflows/example-run-report.yml (Line: 71, Col: 3): Error calling workflow 'bevyengine/bevy/.github/workflows/send-screenshots-to-pixeleagle.yml@caafa03d21b722d79b9537b70e647fef32df37a5'. The workflow is requesting 'contents: read', but is only allowed 'contents: none'.
```

### è§£å†³æ–¹æ¡ˆ (Solution)
- æˆ‘åœ¨æ–‡æ¡£ä¸­æœªæ‰¾åˆ°æ˜ç¡®è¯´æ˜ï¼Œä½†æ¨æµ‹æƒé™ä¼šé€šè¿‡å·¥ä½œæµè°ƒç”¨ç»§æ‰¿ï¼Œå› æ­¤æˆ‘åœ¨çˆ¶å·¥ä½œæµä¸­æ·»åŠ äº†ç›¸åº”æƒé™

ğŸ¤ 

## æŠ€æœ¯åˆ†æ

### é—®é¢˜èƒŒæ™¯
åœ¨ PR #20416 åˆå¹¶åï¼ŒCI æµæ°´çº¿å¼€å§‹å‡ºç°æƒé™é”™è¯¯ã€‚å…·ä½“è¡¨ç°ä¸ºå½“ `example-run-report.yml` å·¥ä½œæµè°ƒç”¨ `send-screenshots-to-pixeleagle.yml` å­å·¥ä½œæµæ—¶ï¼Œç³»ç»Ÿæ‹’ç»è®¿é—®ã€‚é”™è¯¯ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºå­å·¥ä½œæµéœ€è¦ `contents: read` æƒé™ï¼Œä½†çˆ¶å·¥ä½œæµä»…é…ç½®äº† `contents: none`ã€‚è¿™å¯¼è‡´ CI æµç¨‹ä¸­æ–­ï¼Œå½±å“è‡ªåŠ¨åŒ–æµ‹è¯•å’ŒæŠ¥å‘Šç”Ÿæˆã€‚

### è§£å†³æ–¹æ¡ˆé€‰æ‹©
ä½œè€…åŸºäºå¯¹ GitHub Actions æƒé™ç»§æ‰¿æœºåˆ¶çš„ç†è§£ï¼ˆå°½ç®¡å®˜æ–¹æ–‡æ¡£æœªæ˜ç¡®è¯´æ˜ï¼‰ï¼Œå†³å®šåœ¨çˆ¶å·¥ä½œæµä¸­æ˜¾å¼æ·»åŠ ç¼ºå¤±çš„æƒé™ã€‚è¿™ç§æ–¹æ³•ï¼š
1. ç¬¦åˆæœ€å°æƒé™åŸåˆ™ï¼Œä»…æ·»åŠ å¿…è¦çš„ `read` æƒé™
2. é¿å…è¿‡åº¦æˆæƒï¼Œä¿æŒ `write` æƒé™ä»…ç”¨äº PR è¯„è®º
3. æ— éœ€ä¿®æ”¹å­å·¥ä½œæµï¼Œå‡å°‘å½±å“èŒƒå›´

### å…·ä½“å®ç°
å…³é”®ä¿®æ”¹åœ¨ `.github/workflows/example-run-report.yml` æ–‡ä»¶ä¸­ã€‚åœ¨ç°æœ‰çš„ `pull-requests: "write"` æƒé™ä¸‹æ–°å¢ä¸€è¡Œ `contents: "read"` é…ç½®ï¼š

```yaml
permissions:
  pull-requests: "write"
  contents: "read"
```

æ­¤ä¿®æ”¹æ»¡è¶³å­å·¥ä½œæµå¯¹ä»“åº“å†…å®¹çš„è¯»å–æƒé™éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒçˆ¶å·¥ä½œæµåŸæœ‰çš„ PR è¯„è®ºå†™å…¥æƒé™ä¸å˜ã€‚æƒé™é…ç½®ä½ç½®é€‰æ‹©åœ¨å·¥ä½œæµå¼€å¤´ï¼Œç¡®ä¿åç»­æ‰€æœ‰ job å’Œ step éƒ½èƒ½ç»§æ‰¿è¯¥æƒé™è®¾ç½®ã€‚

### æŠ€æœ¯éªŒè¯
è¯¥è§£å†³æ–¹æ¡ˆåŸºäºä»¥ä¸‹æŠ€æœ¯åˆ¤æ–­ï¼š
1. GitHub Actions çš„æƒé™æ¨¡å‹å…·æœ‰ç»§æ‰¿æ€§
2. å­å·¥ä½œæµ (`send-screenshots-to-pixeleagle.yml`) éœ€è¦è¯»å–ä»“åº“å†…å®¹
3. çˆ¶å·¥ä½œæµå¿…é¡»æ˜¾å¼å£°æ˜æ‰€éœ€æƒé™ï¼Œå³ä½¿è‡ªå·±ä¸ç›´æ¥ä½¿ç”¨

### å½±å“è¯„ä¼°
æ­¤ä¿®å¤ï¼š
1. è§£å†³ CI æµæ°´çº¿çš„é˜»å¡é”™è¯¯
2. æ¢å¤è‡ªåŠ¨åŒ–æˆªå›¾æŠ¥å‘ŠåŠŸèƒ½
3. ä¿æŒæƒé™é…ç½®çš„æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§
4. ä¸ºç±»ä¼¼æƒé™ç»§æ‰¿é—®é¢˜æä¾›è§£å†³å‚è€ƒ

## å·¥ä½œæµå…³ç³»å›¾
```mermaid
graph TD
    A[example-run-report.yml] -->|è°ƒç”¨| B[send-screenshots-to-pixeleagle.yml]
    A --> C[æƒé™é…ç½®]
    C --> D[contents: read]
    C --> E[pull-requests: write]
    B --> F[éœ€è¦ contents: read]
```

## å…³é”®æ–‡ä»¶å˜æ›´

### `.github/workflows/example-run-report.yml`
**å˜æ›´åŸå› **ï¼šæ·»åŠ ç¼ºå¤±æƒé™ä»¥ä¿®å¤å·¥ä½œæµè°ƒç”¨é”™è¯¯

**å˜æ›´å‰**ï¼š
```yaml
permissions:
  pull-requests: "write"
```

**å˜æ›´å**ï¼š
```yaml
permissions:
  pull-requests: "write"
  contents: "read"  # æ–°å¢æƒé™é…ç½®
```

**æŠ€æœ¯è¯´æ˜**ï¼š  
åœ¨æƒé™åŒºå—æ·»åŠ  `contents: "read"` å£°æ˜ï¼Œä½¿çˆ¶å·¥ä½œæµèƒ½æ­£ç¡®ä¼ é€’æ‰€éœ€æƒé™ç»™å­å·¥ä½œæµã€‚ä½ç½®é€‰æ‹©åœ¨ workflow å¼€å¤´ç¡®ä¿å…¨å±€ç”Ÿæ•ˆã€‚

## å®Œæ•´ä»£ç å·®å¼‚
```diff
diff --git a/.github/workflows/example-run-report.yml b/.github/workflows/example-run-report.yml
index 1382dddb7490a..fbde12411fc57 100644
--- a/.github/workflows/example-run-report.yml
+++ b/.github/workflows/example-run-report.yml
@@ -6,6 +6,7 @@ name: Example Run - PR Comments
 # Also requesting write permissions on PR to be able to comment
 permissions:
   pull-requests: "write"
+  contents: "read"
 
 on:
   workflow_run:
```

## å»¶ä¼¸é˜…è¯»
1. [GitHub Actions æƒé™æ–‡æ¡£](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#permissions)
2. [å·¥ä½œæµè°ƒç”¨æœ€ä½³å®è·µ](https://docs.github.com/en/actions/using-workflows/reusing-workflows)
3. [æœ€å°æƒé™åŸåˆ™å®æ–½æŒ‡å—](https://security.googleblog.com/2022/06/guidelines-for-building-safer-workflows.html)