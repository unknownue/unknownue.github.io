+++
title = "#20525 Add migration guide for #20522"
date = "2025-08-11T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-08/pr-20525-en-20250811" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-08/pr-20525-zh-cn-20250811" }}
+++

# 迁移指南：修复 Rot2 到 Mat2 的转换实现

## 基本信息
- **标题**: Add migration guide for #20522
- **PR 链接**: https://github.com/bevyengine/bevy/pull/20525
- **作者**: Jondolf
- **状态**: 已合并
- **标签**: D-Trivial, S-Ready-For-Final-Review, A-Math, X-Uncontroversial
- **创建时间**: 2025-08-11T22:35:59Z
- **合并时间**: 2025-08-11T23:13:20Z
- **合并人**: james7132

## 描述翻译
# 目的

#20522 被视为一个破坏性变更 (breaking change)，但没有提供迁移指南。

## 解决方案

添加迁移指南 :D

## 技术分析

该 PR 解决了一个直接问题：PR #20522 引入的破坏性变更缺少配套迁移指南。在数学库中，`Rot2` 到 `Mat2` 的转换实现存在错误，导致旋转行为与预期不符。具体来说，之前的实现错误地构建了旋转矩阵的逆矩阵，产生顺时针旋转而非预期的逆时针旋转。

这种问题需要明确的迁移指南，因为：
1. 旋转方向的变化会影响所有依赖此行为的代码
2. 用户升级引擎版本时可能遇到意外行为变化
3. 数学运算的正确性对物理模拟和图形渲染至关重要

迁移指南采用 Markdown 格式编写，清晰地解释了：
- 旧实现的错误形式：
  ```text
  [  cos, sin ]
  [ -sin, cos ]
  ```
- 正确实现的形式：
  ```text
  [ cos, -sin ]
  [ sin,  cos ]
  ```
- 新旧行为差异：从顺时针旋转变为逆时针旋转
- 向后兼容方案：建议通过反转输入 `Rot2` 或输出 `Mat2` 来保持原行为

该文档使用数学矩阵表示法直观展示差异，并明确引用源 PR (#20522) 以便追溯。这种处理方式符合 Bevy 引擎对破坏性变更的管理规范，确保用户能平滑过渡。

## 可视化关系

```mermaid
graph LR
    A[PR #20522 破坏性变更] --> B[需要迁移指南]
    B --> C[PR #20525]
    C --> D[rot2_matrix_construction.md]
    D --> E[用户升级路径]
```

## 关键文件变更

### `release-content/migration-guides/rot2_matrix_construction.md`
**变更原因**：为 #20522 的破坏性变更提供迁移指导

```markdown
---
title: "Fix `From<Rot2>` implementation for `Mat2`"
pull_requests: [20522]
---

Past releases had an incorrect `From<Rot2>` implementation for `Mat2`, constructing a rotation matrix in the following form:

```text
[  cos, sin ]
[ -sin, cos ]
```

This was actually the *inverse* of the rotation matrix, resulting in clockwise rotation when transforming vectors.
The correct version is the following:

```text
[ cos, -sin ]
[ sin,  cos ]
```

resulting in counterclockwise rotation.

This error has now been fixed. You may see that rotation matrices created using the `From<Rot2>` implementation
produce different results than before, as the rotation happens counterclockwise (as intended) rather than clockwise.
Invert either the input `Rot2` or the resulting `Mat2` to get the same results as before.
```

**技术要点**：
1. 使用代码块展示新旧矩阵结构差异
2. 明确说明行为变化（顺时针→逆时针）
3. 提供具体解决方案（反转输入或输出）
4. 通过 `pull_requests: [20522]` 建立变更溯源

## 延伸阅读
1. [原始破坏性变更 PR #20522](https://github.com/bevyengine/bevy/pull/20522)
2. [Bevy 迁移指南规范](https://github.com/bevyengine/bevy/blob/main/docs/migration_guides.md)
3. [旋转矩阵数学原理](https://en.wikipedia.org/wiki/Rotation_matrix)
4. [Bevy 数学组件文档](https://docs.rs/bevy_math/latest/bevy_math/)

## 完整代码变更
```diff
diff --git a/release-content/migration-guides/rot2_matrix_construction.md b/release-content/migration-guides/rot2_matrix_construction.md
new file mode 100644
index 0000000000000..19ce9b4f316b0
--- /dev/null
+++ b/release-content/migration-guides/rot2_matrix_construction.md
@@ -0,0 +1,25 @@
+---
+title: "Fix `From<Rot2>` implementation for `Mat2`"
+pull_requests: [20522]
+---
+
+Past releases had an incorrect `From<Rot2>` implementation for `Mat2`, constructing a rotation matrix in the following form:
+
+```text
+[  cos, sin ]
+[ -sin, cos ]
+```
+
+This was actually the *inverse* of the rotation matrix, resulting in clockwise rotation when transforming vectors.
+The correct version is the following:
+
+```text
+[ cos, -sin ]
+[ sin,  cos ]
+```
+
+resulting in counterclockwise rotation.
+
+This error has now been fixed. You may see that rotation matrices created using the `From<Rot2>` implementation
+produce different results than before, as the rotation happens counterclockwise (as intended) rather than clockwise.
+Invert either the input `Rot2` or the resulting `Mat2` to get the same results as before.
```