+++
title = "#22294 use zizmor to lint GitHub actions"
date = "2025-12-30T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-12/pr-22294-en-20251230" }, "zh-cn" = { name = "ä¸­æ–‡", url = "/pull_request/bevy/2025-12/pr-22294-zh-cn-20251230" }}
labels = ["A-Build-System", "C-Code-Quality"]
+++

# Title

## Basic Information
- **Title**: use zizmor to lint GitHub actions
- **PR Link**: https://github.com/bevyengine/bevy/pull/22294
- **Author**: mockersf
- **Status**: MERGED
- **Labels**: A-Build-System, C-Code-Quality, S-Ready-For-Final-Review
- **Created**: 2025-12-28T23:03:18Z
- **Merged**: 2025-12-30T01:48:30Z
- **Merged By**: alice-i-cecile

## Description Translation
**ç›®æ ‡**
- æå‡ Bevy CI çš„å®‰å…¨æ€§

**è§£å†³æ–¹æ¡ˆ**
- ä½¿ç”¨ zizmor å¯¹ actions è¿›è¡Œä»£ç æ£€æŸ¥ (lint) https://github.com/zizmorcore/zizmor
- ä¿®å¤äº†ä¸€äº›ä»£ç æ£€æŸ¥å‘ç°çš„é—®é¢˜
  - é”å®š (pin) actions çš„ç‰ˆæœ¬
  - æŒ‡å®š `persist-credentials`
  - åœ¨ä½œä¸š (job) çº§åˆ«è€Œéå·¥ä½œæµ (workflow) çº§åˆ«è®¾ç½®å†™å…¥æƒé™
  - ä¸º `pull_request_target` å·¥ä½œæµè®¾ç½®ç›®æ ‡åˆ†æ”¯
- å°†è¯¥ä»£ç æ£€æŸ¥å·¥å…·ä½œä¸º CI çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡æ‰€æè®®çš„é…ç½®ï¼Œå®ƒå°†åœ¨å®‰å…¨ä¸­å¿ƒæŠ¥å‘Šæ½œåœ¨é—®é¢˜ï¼Œè€Œä¸ä¼šé˜»æ­¢åˆå¹¶ã€‚ç›®å‰ä»æœ‰ä¸€äº›ä»£ç æ£€æŸ¥å¤±è´¥çš„é—®é¢˜éœ€è¦æ›´å¤šé‡æ„å·¥ä½œæ¥ä¿®å¤ã€‚

## The Story of This Pull Request

è¿™ä¸ª PR çš„æ ¸å¿ƒæ•…äº‹æ˜¯å…³äºä¸»åŠ¨æå‡ CI/CD æµæ°´çº¿çš„å®‰å…¨æ€§ï¼Œè€Œéè¢«åŠ¨å“åº”å®‰å…¨äº‹ä»¶ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼ŒæŒç»­é›†æˆ(CI)è„šæœ¬ä½œä¸ºæ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²çš„åŸºçŸ³ï¼Œå…¶æœ¬èº«ä¹Ÿå¿…é¡»æ˜¯å®‰å…¨çš„ã€‚ä¸å®‰å…¨çš„é…ç½®ï¼Œä¾‹å¦‚ä½¿ç”¨æœªé”å®šçš„ç¬¬ä¸‰æ–¹ Action ç‰ˆæœ¬æˆ–æˆäºˆè¿‡å®½çš„æƒé™ï¼Œå¯èƒ½æˆä¸ºä¾›åº”é“¾æ”»å‡»çš„å…¥å£ã€‚

### é—®é¢˜ä¸èƒŒæ™¯
åœ¨ PR æè¿°ä¸­ï¼Œä½œè€…æ˜ç¡®æŒ‡å‡ºç›®æ ‡æ˜¯â€œæå‡ Bevy CI çš„å®‰å…¨æ€§â€ã€‚è™½ç„¶æ²¡æœ‰è¯¦ç»†åˆ—å‡ºå…·ä½“çš„å®‰å…¨æ¼æ´ï¼Œä½† PR æ‰€åšçš„ä¿®æ”¹æŒ‡å‘äº†å‡ ä¸ªåœ¨å¼€æºé¡¹ç›®ä¸­å¸¸è§çš„ GitHub Actions å®‰å…¨é£é™©ï¼š

1.  **ä¾èµ–åŠ«æŒ**ï¼šå½“ä½¿ç”¨æ ‡ç­¾ï¼ˆå¦‚ `v6`ã€`v8.0.0`ï¼‰å¼•ç”¨ç¬¬ä¸‰æ–¹ Action æ—¶ï¼Œå­˜åœ¨æ ‡ç­¾è¢«æ¶æ„æ›´æ–°æˆ–ä»“åº“è¢«åŠ«æŒçš„é£é™©ã€‚æ”»å‡»è€…å¯ä»¥å‘å¸ƒä¸€ä¸ªå¸¦æ¶æ„ä»£ç çš„æ–°ç‰ˆæœ¬ï¼Œå¹¶ç»™åŒæ ·çš„æ ‡ç­¾æ‰“ä¸Šæ ‡è®°ï¼Œå½“ä¸‹æ¬¡ CI è¿è¡Œæ—¶å°±ä¼šè‡ªåŠ¨æ‹‰å–åˆ°æ¶æ„ç‰ˆæœ¬ã€‚
2.  **æƒé™è¿‡å®½**ï¼šåœ¨å·¥ä½œæµ(workflow)çº§åˆ«å…¨å±€æˆäºˆ `pull-requests: write` æƒé™ï¼Œæ„å‘³ç€è¯¥å·¥ä½œæµä¸­çš„æ‰€æœ‰ä½œä¸š(job)éƒ½æ‹¥æœ‰äº†æ­¤æƒé™ï¼Œè¿™è¿åäº†æœ€å°æƒé™åŸåˆ™ã€‚ç†æƒ³æƒ…å†µæ˜¯åªåœ¨éœ€è¦è¯„è®º PR çš„ä½œä¸šä¸­æˆäºˆæ­¤æƒé™ã€‚
3.  **å‡­è¯æŒä¹…åŒ–é£é™©**ï¼šåœ¨ `pull_request_target` äº‹ä»¶è§¦å‘çš„å·¥ä½œæµä¸­ä½¿ç”¨ `actions/checkout` æ—¶ï¼Œå¦‚æœä¸æ˜¾å¼è®¾ç½® `persist-credentials: false`ï¼Œä» PR åˆ†æ”¯æ‹‰å–çš„ã€æ½œåœ¨çš„æ¶æ„ä»£ç å¯èƒ½ä¼šåˆ©ç”¨è¿™äº›å‡­è¯è¿›è¡Œæœªæˆæƒçš„ä»“åº“æ“ä½œã€‚
4.  **åˆ†æ”¯æ”»å‡»é¢**ï¼š`pull_request_target` äº‹ä»¶é»˜è®¤ä¼šé’ˆå¯¹æ‰€æœ‰åˆ†æ”¯çš„ PR è§¦å‘ï¼Œè¿™æ‰©å¤§äº†æ”»å‡»é¢ã€‚æœ€å¥½å°†å…¶é™åˆ¶åœ¨ä¸»è¦åˆ†æ”¯ï¼ˆå¦‚ `main`ï¼‰çš„ PR ä¸Šã€‚

å› æ­¤ï¼Œé—®é¢˜çš„æ ¸å¿ƒåœ¨äº CI é…ç½®å­˜åœ¨å¯è¢«åˆ©ç”¨çš„å®‰å…¨éšæ‚£ï¼Œéœ€è¦ä¸€ç§ç³»ç»Ÿæ€§çš„æ–¹æ³•æ¥è¯†åˆ«å¹¶ä¿®å¤å®ƒä»¬ã€‚

### è§£å†³æ–¹æ¡ˆä¸å·¥ç¨‹å†³ç­–
ä½œè€…é€‰æ‹©çš„è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥ **zizmor** è¿™ä¸ªå·¥å…·ã€‚zizmor æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå¯¹ GitHub Actions å·¥ä½œæµæ–‡ä»¶è¿›è¡Œé™æ€å®‰å…¨åˆ†æå’Œä»£ç æ£€æŸ¥ (linting) çš„å·¥å…·ã€‚è¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„ï¼Œå› ä¸ºå®ƒå°†å®‰å…¨å®¡æŸ¥ä»äººå·¥çš„ã€ä¸å®šæœŸçš„å·¥ä½œè½¬å˜ä¸ºè‡ªåŠ¨åŒ–çš„ã€æŒç»­çš„è¿‡ç¨‹ã€‚

åœ¨å·¥ç¨‹å†³ç­–ä¸Šï¼Œä½œè€…é‡‡å–äº†åˆ†æ­¥èµ°çš„ç­–ç•¥ï¼š
1.  **é›†æˆå·¥å…·**ï¼šé¦–å…ˆå°† zizmor ä½œä¸ºä¸€ä¸ªæ–°çš„ CI æ­¥éª¤åŠ å…¥å·¥ä½œæµã€‚
2.  **åº”ç”¨ä¿®å¤**ï¼šæ ¹æ® zizmor çš„æ£€æŸ¥ç»“æœï¼Œå¯¹ç°æœ‰é…ç½®è¿›è¡Œæ‰¹é‡ä¿®å¤ã€‚
3.  **å®¹å¿æ¸è¿›**ï¼šä½œè€…æåˆ°ï¼Œé…ç½®ä¼šæŠ¥å‘Šé—®é¢˜ä½†â€œä¸ä¼šé˜»å¡åˆå¹¶â€ï¼Œå¹¶ä¸”â€œä»æœ‰ä¸€äº›ä»£ç æ£€æŸ¥å¤±è´¥çš„é—®é¢˜éœ€è¦æ›´å¤šé‡æ„å·¥ä½œæ¥ä¿®å¤â€ã€‚è¿™è¡¨æ˜ä»–ä»¬é‡‡ç”¨äº†åŠ¡å®çš„æ€åº¦ï¼Œä¼˜å…ˆä¿®å¤é«˜é£é™©ã€æ˜“ä¿®å¤çš„é—®é¢˜ï¼Œå…è®¸ä½é£é™©æˆ–å¤æ‚çš„é—®é¢˜æš‚æ—¶å­˜åœ¨ï¼Œé¿å…å› è¿½æ±‚å®Œç¾è€Œé˜»ç¢æ”¹è¿›ã€‚

### æŠ€æœ¯å®ç°ç»†èŠ‚
è¿™ä¸ª PR ä¿®æ”¹äº† 14 ä¸ª `.yml` å·¥ä½œæµæ–‡ä»¶ã€‚æ‰€æœ‰æ”¹åŠ¨éƒ½å›´ç»•ç€ä»¥ä¸‹å‡ ä¸ªå®‰å…¨æœ€ä½³å®è·µå±•å¼€ï¼š

**1. é”å®š Action ç‰ˆæœ¬è‡³å®Œæ•´ SHA**
è¿™æ˜¯æœ€å¹¿æ³›ã€æœ€é‡è¦çš„æ”¹åŠ¨ã€‚å°†å¼•ç”¨ä»å¯å˜çš„â€œæ ‡ç­¾â€æ”¹ä¸ºä¸å¯å˜çš„â€œGit commit SHAâ€ã€‚
```yaml
# ä¹‹å‰ (æœ‰é£é™©):
- uses: actions/checkout@v6
- uses: actions/github-script@v8

# ä¹‹å (å®‰å…¨):
- uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
- uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
```
é€šè¿‡åœ¨æ³¨é‡Šä¸­ä¿ç•™ç‰ˆæœ¬å·ï¼Œæ—¢ä¿è¯äº†å®‰å…¨æ€§ï¼Œåˆä¿æŒäº†å¯è¯»æ€§ã€‚

**2. ç²¾ç»†åŒ–æƒé™æ§åˆ¶ (Principle of Least Privilege)**
å°†å…¨å±€æƒé™ä¸‹æ”¾åˆ°å…·ä½“çš„ä½œä¸š(job)ä¸­ã€‚
```yaml
# ä¹‹å‰ (åœ¨ workflow æ ¹èŠ‚ç‚¹):
permissions:
  pull-requests: 'write'

jobs:
  some-job:
    # è¿™ä¸ª job ä¸éœ€è¦å†™ PR çš„æƒé™ï¼Œä½†ä¹Ÿæ‹¥æœ‰äº†
    steps: [...]

# ä¹‹å (åœ¨ job å†…éƒ¨):
jobs:
  comment-on-migration-guide-label:
    permissions:
      pull-requests: "write"
    steps: [...]
```
è¿™æ ·ï¼Œåªæœ‰çœŸæ­£éœ€è¦è¯„è®º PR çš„ä½œä¸šï¼ˆå¦‚ `comment-on-migration-guide-label`ï¼‰æ‰æ‹¥æœ‰ç›¸åº”æƒé™ã€‚

**3. å®‰å…¨é…ç½® `actions/checkout`**
åœ¨ `pull_request_target` ä¸Šä¸‹æ–‡ä¸­ï¼Œæ˜ç¡®ç¦ç”¨å‡­è¯æŒä¹…åŒ–ã€‚
```yaml
- uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
  with:
    ref: ${{ github.event.pull_request.head.sha }}
    persist-credentials: false # å…³é”®çš„å®‰å…¨è®¾ç½®
```

**4. é™åˆ¶ `pull_request_target` çš„ç›®æ ‡åˆ†æ”¯**
å°†é«˜é£é™©äº‹ä»¶ `pull_request_target` çš„è§¦å‘èŒƒå›´é™å®šåœ¨ä¸»è¦åˆ†æ”¯ï¼Œå‡å°‘æš´éœ²ã€‚
```yaml
on:
  pull_request_target:
    types: [labeled]
    branches: # æ–°å¢çš„é™å®š
      - "main"
```

**5. é›†æˆå®‰å…¨åˆ†ææµæ°´çº¿**
PR ä¸ä»…ä¿®å¤é—®é¢˜ï¼Œè¿˜å»ºç«‹äº†ä¸€ä¸ªé•¿æœŸçš„ç›‘æ§æœºåˆ¶ã€‚å®ƒå°†åŸæœ‰çš„ `codeql.yml` é‡å‘½åä¸ºæ›´å…·æè¿°æ€§çš„ `security-static-analysis.yml`ï¼Œå¹¶æ–°å¢äº† `zizmor` ä½œä¸šã€‚
```yaml
# åœ¨ .github/workflows/security-static-analysis.yml ä¸­æ–°å¢çš„ job
zizmor:
  runs-on: ubuntu-latest
  permissions:
    security-events: write
    contents: read
    actions: read
  steps:
    - name: Checkout repository
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
      with:
        persist-credentials: false
    - name: Run zizmor ğŸŒˆ
      uses: zizmorcore/zizmor-action@e639db99335bc9038abc0e066dfcd72e23d26fb4 # v0.3.0
```
è¿™ä¸ªä½œä¸šæ‹¥æœ‰ `security-events: write` æƒé™ï¼Œå¯ä»¥å°†å‘ç°çš„é—®é¢˜æŠ¥å‘Šåˆ° GitHub çš„å®‰å…¨ä¸­å¿ƒï¼Œå®ç°é›†ä¸­åŒ–ç®¡ç†å’Œè·Ÿè¸ªã€‚

### æŠ€æœ¯æ´å¯Ÿä¸å½±å“
è¿™ä¸ª PR å±•ç¤ºäº†å°†â€œå®‰å…¨å·¦ç§»â€(Shift-Left Security)åŸåˆ™åº”ç”¨äºåŸºç¡€è®¾æ–½ä»£ç (Infrastructure as Code, IaC)çš„ä¼˜ç§€å®è·µã€‚å®ƒå¸¦æ¥çš„å½±å“æ˜¯æ·±è¿œçš„ï¼š

1.  **é™ä½ä¾›åº”é“¾æ”»å‡»é£é™©**ï¼šé€šè¿‡é”å®š SHAï¼ŒBevy é¡¹ç›®çš„ CI ç³»ç»Ÿå¯¹ä¸Šæ¸¸ Action ä»“åº“çš„æ¶æ„ä¿®æ”¹å…·å¤‡äº†å…ç–«åŠ›ã€‚
2.  **å¼ºåŒ–æœ€å°æƒé™æ¨¡å‹**ï¼šç»†ç²’åº¦çš„æƒé™æ§åˆ¶æ„å‘³ç€å³ä½¿æŸä¸ªä½œä¸šè¢«æ”»ç ´ï¼Œæ”»å‡»è€…èƒ½é€ æˆçš„ç ´åä¹Ÿå—åˆ°é™åˆ¶ã€‚
3.  **å»ºç«‹æŒç»­çš„å®‰å…¨åé¦ˆå¾ªç¯**ï¼šzizmor çš„é›†æˆæ„å‘³ç€æœªæ¥ä»»ä½•å¯¹ CI é…ç½®çš„ä¿®æ”¹ï¼ˆæ— è®ºæ˜¯æ–°å·¥ä½œæµè¿˜æ˜¯ç°æœ‰å·¥ä½œæµçš„å˜æ›´ï¼‰éƒ½ä¼šè‡ªåŠ¨æ¥å—å®‰å…¨æ£€æŸ¥ã€‚è¿™èƒ½åœ¨é”™è¯¯åˆå¹¶ä¹‹å‰æ•è·é—®é¢˜ã€‚
4.  **æå‡å¯ç»´æŠ¤æ€§ä¸é€æ˜åº¦**ï¼šä½¿ç”¨å®Œæ•´çš„ SHA å’Œæ³¨é‡Šï¼Œä½¿å¾—ä¾èµ–å…³ç³»æ›´åŠ æ¸…æ™°æ˜ç¡®ï¼Œä¾¿äºå®¡è®¡å’Œæ•…éšœæ’æŸ¥ã€‚

ä»å·¥ç¨‹è§’åº¦çœ‹ï¼Œè¿™ä¸ª PR çš„æ”¹åŠ¨è™½ç„¶æ˜¯æœºæ¢°å¼çš„ï¼ˆå¤§é‡æŸ¥æ‰¾æ›¿æ¢ï¼‰ï¼Œä½†å…¶èƒŒåçš„è®¾è®¡å†³ç­–â€”â€”é€‰æ‹©æ­£ç¡®çš„å·¥å…·ã€éµå¾ªå®‰å…¨æœ€ä½³å®è·µã€é‡‡ç”¨æ¸è¿›å¼ä¿®å¤ç­–ç•¥â€”â€”ä½“ç°äº†æˆç†Ÿçš„è½¯ä»¶å·¥ç¨‹è¿ç»´æ€è·¯ã€‚å®ƒæ²¡æœ‰ä¿®æ”¹ Bevy çš„æ¸¸æˆå¼•æ“ä»£ç ï¼Œä½†å´åŠ å›ºäº†æ•´ä¸ªé¡¹ç›®å¼€å‘å’Œäº¤ä»˜æµç¨‹çš„åŸºçŸ³ã€‚

## Visual Representation

```mermaid
graph TD
    subgraph â€œå®‰å…¨æ”¹è¿›è§¦å‘â€
        A[è¯†åˆ« CI å®‰å…¨é£é™©] --> B[å¼•å…¥ Zizmor åˆ†æå·¥å…·]
    end
    
    B --> C{æ‰«æç°æœ‰å·¥ä½œæµ}
    
    C --> D[ä¿®å¤: é”å®š Action SHA]
    C --> E[ä¿®å¤: ä½œä¸šçº§æƒé™]
    C --> F[ä¿®å¤: é…ç½® persist-credentials]
    C --> G[ä¿®å¤: é™å®šç›®æ ‡åˆ†æ”¯]
    
    D --> H[æ›´æ–° 14ä¸ª CI å·¥ä½œæµæ–‡ä»¶]
    E --> H
    F --> H
    G --> H
    
    H --> I[å»ºç«‹æŒç»­å®‰å…¨åˆ†ææµæ°´çº¿]
    
    I --> J[è¾“å‡ºåˆ° GitHub å®‰å…¨ä¸­å¿ƒ]
    I --> K[é˜²æ­¢æœªæ¥é…ç½®é€€åŒ–]
    
    J --> L[æœ€ç»ˆç»“æœ: åŠ å›ºçš„ CI/CD ä¾›åº”é“¾]
    K --> L
```

## Key Files Changed

ä»¥ä¸‹æ˜¯æ­¤ PR ä¸­ä¿®æ”¹çš„å…³é”®æ–‡ä»¶æ‘˜è¦ï¼š

- `.github/workflows/ci.yml` (+101/-49)
- `.github/workflows/validation-jobs.yml` (+40/-19)
- `.github/workflows/example-run.yml` (+30/-18)
- `.github/workflows/ci-comment-failures.yml` (+17/-16)
- `.github/workflows/dependencies.yml` (+24/-8)

### 1. `.github/workflows/ci.yml`
è¿™æ˜¯ Bevy æœ€ä¸»è¦çš„æŒç»­é›†æˆå·¥ä½œæµã€‚ä¿®æ”¹å‡ ä¹æ¶‰åŠæ¯ä¸€ä¸ªä½œä¸šï¼Œæ ¸å¿ƒæ˜¯é”å®šæ‰€æœ‰ç¬¬ä¸‰æ–¹ Action çš„ç‰ˆæœ¬ï¼Œå¹¶æ·»åŠ  `persist-credentials: false`ã€‚
```yaml
# å…¸å‹ä¿®æ”¹ç¤ºä¾‹
# Before:
- uses: actions/checkout@v6
- uses: dtolnay/rust-toolchain@stable

# After:
- uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
  with:
    persist-credentials: false
- uses: dtolnay/rust-toolchain@f7ccc83f9ed1e5b9c81d8a67d7ad1a747e22a561
  with:
    toolchain: stable
```

### 2. `.github/workflows/security-static-analysis.yml` (ç”± `codeql.yml` é‡å‘½åè€Œæ¥)
è¿™ä¸ªæ–‡ä»¶çš„é‡å‘½åå’Œæ–°å¢çš„ `zizmor` ä½œä¸šæ˜¯æœ¬ PR çš„æ ¸å¿ƒæˆæœä¹‹ä¸€ï¼Œå®ƒåˆ›å»ºäº†é•¿æœŸçš„å®‰å…¨åˆ†ææœºåˆ¶ã€‚
```yaml
# æ–°å¢çš„ zizmor ä½œä¸š
zizmor:
  runs-on: ubuntu-latest
  permissions:
    security-events: write
    contents: read
    actions: read
  steps:
    - name: Checkout repository
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
      with:
        persist-credentials: false
    - name: Run zizmor ğŸŒˆ
      uses: zizmorcore/zizmor-action@e639db99335bc9038abc0e066dfcd72e23d26fb4 # v0.3.0
```

### 3. `.github/workflows/ci-comment-failures.yml`
æ­¤å·¥ä½œæµè´Ÿè´£åœ¨ CI å¤±è´¥æ—¶è¯„è®º PRã€‚ä¿®æ”¹å°†æƒé™ä»å·¥ä½œæµçº§åˆ«ä¸‹æ”¾åˆ°äº†éœ€è¦è¯„è®ºçš„ä¸‰ä¸ªå…·ä½“ä½œä¸š (`missing-examples`, `missing-features`, `msrv`) ä¸­ï¼Œå¹¶é”å®šäº† Action ç‰ˆæœ¬ã€‚
```yaml
# Before (æ–‡ä»¶å¼€å¤´):
permissions:
  pull-requests: 'write'

# After (åœ¨æ¯ä¸ª job å†…éƒ¨):
jobs:
  missing-examples:
    permissions:
      pull-requests: "write"
    runs-on: ubuntu-latest
    ...
```

### 4. `.github/workflows/action-on-PR-labeled.yml`
è¿™æ˜¯ä¸€ä¸ªç”± `pull_request_target` äº‹ä»¶è§¦å‘çš„å·¥ä½œæµï¼Œç”¨äºåœ¨ PR è¢«æ‰“ä¸Šç‰¹å®šæ ‡ç­¾æ—¶è‡ªåŠ¨è¯„è®ºã€‚ä¿®æ”¹å¢åŠ äº†ç›®æ ‡åˆ†æ”¯é™åˆ¶å’Œä½œä¸šçº§æƒé™ã€‚
```yaml
# Before:
on:
  pull_request_target:
    types:
      - labeled
permissions:
  pull-requests: 'write'

# After:
on:
  pull_request_target:
    types:
      - labeled
    branches:      # æ–°å¢åˆ†æ”¯é™å®š
      - "main"
# ç§»é™¤äº†å…¨å±€ permissions å—ï¼Œæ”¹ä¸ºåœ¨æ¯ä¸ª job å†…å®šä¹‰
jobs:
  comment-on-migration-guide-label:
    permissions:
      pull-requests: "write"
    ...
```

## Further Reading

å¯¹äºå¸Œæœ›æ·±å…¥äº†è§£æœ¬ PR æ‰€æ¶‰åŠæ¦‚å¿µçš„è¯»è€…ï¼Œå»ºè®®å‚è€ƒä»¥ä¸‹èµ„æºï¼š

1.  **GitHub Actions å®‰å…¨å¼ºåŒ–æŒ‡å—**:
    - [GitHub å®˜æ–¹æ–‡æ¡£ï¼šå®‰å…¨å¼ºåŒ– GitHub Actions](https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions)
    - é‡ç‚¹é˜…è¯»â€œä½¿ç”¨ç¬¬ä¸‰æ–¹ Actionsâ€ã€â€œé˜²æ­¢ pwn è¯·æ±‚â€ç­‰ç« èŠ‚ã€‚

2.  **å¼€æºä¾›åº”é“¾å®‰å…¨**:
    - [OpenSSF: ä¾›åº”é“¾å®‰å…¨æœ€ä½³å®è·µ](https://openssf.org/æœ€ä½³å®è·µ/)
    - äº†è§£è½¯ä»¶ç‰©æ–™æ¸…å•(SBOM)ã€ç­¾åã€æ¼æ´ç®¡ç†ç­‰æ¦‚å¿µã€‚

3.  **zizmor å·¥å…·**:
    - [zizmor GitHub ä»“åº“](https://github.com/zizmorcore/zizmor)
    - æŸ¥çœ‹å…¶è§„åˆ™é›†ï¼Œäº†è§£å®ƒå…·ä½“æ£€æŸ¥å“ªäº›å®‰å…¨é—®é¢˜ã€‚

4.  **æœ€å°æƒé™åŸåˆ™**:
    - [OWASP: æœ€å°æƒé™åŸåˆ™](https://cheatsheetseries.owaaasp.org/cheatsheets/Least_Privilege_Cheat_Sheet.html)
    - è¿™ä¸€å®‰å…¨è®¾è®¡åŸåˆ™åœ¨ç½‘ç»œã€ç³»ç»Ÿå’Œåº”ç”¨å±‚é¢éƒ½è‡³å…³é‡è¦ã€‚

5.  **å…³äº `pull_request_target`**:
    - [GitHub åšå®¢ï¼šKeeping your GitHub Actions and workflows secure Part 2: Untrusted input](https://github.blog/2020-08-03-github-actions-improvements-for-fork-and-pull-request-workflows/)
    - æ·±å…¥ç†è§£æ­¤äº‹ä»¶çš„ç‰¹æ®Šæ€§åŠå®‰å…¨é£é™©ã€‚