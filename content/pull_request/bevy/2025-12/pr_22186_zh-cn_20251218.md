+++
title = "#22186 Update the key creation for `cache-restore` is done on `update-cachesyml`"
date = "2025-12-18T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-12/pr-22186-en-20251218" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-12/pr-22186-zh-cn-20251218" }}
labels = ["C-Docs", "D-Trivial", "A-Build-System"]
+++

# Title

## Basic Information
- **Title**: Update the key creation for `cache-restore` is done on `update-cachesyml`
- **PR Link**: https://github.com/bevyengine/bevy/pull/22186
- **Author**: WaterWhisperer
- **Status**: MERGED
- **Labels**: C-Docs, D-Trivial, A-Build-System, S-Ready-For-Final-Review
- **Created**: 2025-12-18T11:16:30Z
- **Merged**: 2025-12-18T18:43:09Z
- **Merged By**: alice-i-cecile

## Description Translation

### 目标
修复 #22055

### 解决方案
将 `See .github/workflows/validation-jobs.yml for how keys are generated` 替换为 `See .github/workflows/update-caches.yml for how keys are generated`

### 测试
无（注释修改）

## The Story of This Pull Request

这个PR的故事始于一个简单的发现：项目持续集成（CI，Continuous Integration）流水线中的文档注释指向了错误的文件。在Bevy引擎的多个GitHub Actions工作流文件中，负责配置依赖项缓存的`cache`操作都包含了一条注释，指引开发者查看缓存密钥（cache key）的生成方式。然而，这条注释错误地指向了`.github/workflows/validation-jobs.yml`文件。

在实际的代码库中，缓存密钥的生成逻辑位于另一个独立的文件中：`.github/workflows/update-caches.yml`。这个文件专门用于管理和更新CI过程中使用的各种缓存。当开发者或新的贡献者阅读这些注释，试图理解缓存机制或调试缓存相关问题时，他们会被引导至一个不包含相关信息的文件，这造成了困惑和效率损失。

问题的根源于项目工作流的演变。随着项目复杂度的增加，CI配置被重构，特定的功能被抽取到单独的文件中以提高可维护性。然而，在重构过程中，相关的文档注释没有同步更新，留下了这个不一致的“坑”（footnote）。这虽然不会影响CI流程的实际执行（因为注释是纯文档），但它破坏了文档作为可靠知识来源的作用。

开发者WaterWhisperer提交了这个PR来解决Issue #22055。解决方案非常直接：在所有相关的工作流文件中，将错误的文件引用路径更正为正确的路径。这是一个典型的“文档修正”（doc fix）类PR，其核心价值在于提升代码库的可维护性和开发者体验。

具体来看，修改涉及三个核心的CI工作流文件：主CI文件（`ci.yml`）、示例运行文件（`example-run.yml`）和验证任务文件（`validation-jobs.yml`）本身。有趣的是，最后一个文件`validation-jobs.yml`内部也引用了自己，这显然是一个逻辑错误，本次修正也一并将其更正。

从工程实践角度看，这个PR体现了几个重要的点：
1.  **文档即代码**：即使是注释，也应当保持准确。不准确的注释比没有注释更糟糕，因为它会传递错误信息。
2.  **关注细节**：在大型开源项目中，这类“细小”的问题很容易被忽视。主动发现并修正它们，是维持项目健康度的重要组成部分。
3.  **重构的完整性**：当进行代码重构或架构调整时，需要有一个检查清单，确保所有相关的文档、注释、配置引用都得到同步更新。

整个修复过程是原子性的（atomic），只做了一件事——更正文件引用。它没有引入任何功能变更、没有影响CI行为、也无需测试。这种清晰、单一的变更集（change set）使得代码审查（code review）非常迅速，这也是它能被快速合并的原因。

最终，这个PR被标记为`C-Docs`（文档相关）、`D-Trivial`（微小修改）和`A-Build-System`（构建系统），并由维护者alice-i-cecile合并。它虽然改动微小，但通过确保文档的准确性，为所有未来查阅这些CI配置的开发者扫清了一个障碍，是开源协作中一次高效、有价值的基础维护工作。

## Visual Representation

这个PR修改了三个工作流文件中的注释，这些注释原本指向 `validation-jobs.yml`，但实际上描述的逻辑位于 `update-caches.yml` 中。下图展示了这种引用关系的更正：

```mermaid
graph TD
    subgraph “被修正的文件”
        A[ci.yml]
        B[example-run.yml]
        C[validation-jobs.yml]
    end

    D[update-caches.yml]

    A -- “旧注释指向 C <br> 新注释指向 D” --> D
    B -- “旧注释指向 C <br> 新注释指向 D” --> D
    C -- “旧注释指向自身 C <br> 新注释指向 D” --> D
```

## Key Files Changed

本次PR修改了三个GitHub Actions工作流配置文件，均涉及注释更正。

- `.github/workflows/ci.yml` (+11/-11)
- `.github/workflows/example-run.yml` (+3/-3)
- `.github/workflows/validation-jobs.yml` (+5/-5)

### 1. `.github/workflows/ci.yml`
这是主CI工作流文件。文件中多处使用了`actions/cache`来恢复依赖缓存，每一处都有一行指引开发者查看密钥生成方式的注释。本次修改将所有11处错误的引用路径统一更正。
```yaml
# File: .github/workflows/ci.yml
# Before (示例片段):
- name: Cache (rust, stable)
  uses: actions/cache@v4
  with:
    # key won't match, will rely on restore-keys
    key: ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
    # See .github/workflows/validation-jobs.yml for how keys are generated
    restore-keys: |
      ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
      ${{ runner.os }}-stable--

# After (示例片段):
- name: Cache (rust, stable)
  uses: actions/cache@v4
  with:
    # key won't match, will rely on restore-keys
    key: ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
    # See .github/workflows/update-caches.yml for how keys are generated
    restore-keys: |
      ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
      ${{ runner.os }}-stable--
```

### 2. `.github/workflows/validation-jobs.yml`
这个文件本身也包含了指向自己的错误注释。这是一个明显的文档缺陷，本次修改将其更正为指向正确的`update-caches.yml`文件。
```yaml
# File: .github/workflows/validation-jobs.yml
# Before (示例片段):
- name: Cache (rust, stable, wasm32-unknown-unknown)
  uses: actions/cache@v4
  with:
    # key won't match, will rely on restore-keys
    key: ${{ runner.os }}-stable-wasm32-unknown-unknown-${{ hashFiles('**/Cargo.toml') }}-
    # See .github/workflows/validation-jobs.yml for how keys are generated
    restore-keys: |
      ${{ runner.os }}-stable-wasm32-unknown-unknown-${{ hashFiles('**/Cargo.toml') }}-
      ${{ runner.os }}-stable-wasm32-unknown-unknown-

# After (示例片段):
- name: Cache (rust, stable, wasm32-unknown-unknown)
  uses: actions/cache@v4
  with:
    # key won't match, will rely on restore-keys
    key: ${{ runner.os }}-stable-wasm32-unknown-unknown-${{ hashFiles('**/Cargo.toml') }}-
    # See .github/workflows/update-caches.yml for how keys are generated
    restore-keys: |
      ${{ runner.os }}-stable-wasm32-unknown-unknown-${{ hashFiles('**/Cargo.toml') }}-
      ${{ runner.os }}-stable-wasm32-unknown-unknown-
```

### 3. `.github/workflows/example-run.yml`
此文件用于运行示例，同样包含缓存配置。修改将其中的3处错误引用路径更正。
```yaml
# File: .github/workflows/example-run.yml
# Before (示例片段):
- name: Cache (rust, stable)
  uses: actions/cache@v4
  with:
    # key won't match, will rely on restore-keys
    key: ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
    # See .github/workflows/validation-jobs.yml for how keys are generated
    restore-keys: |
      ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
      ${{ runner.os }}-stable--

# After (示例片段):
- name: Cache (rust, stable)
  uses: actions/cache@v4
  with:
    # key won't match, will rely on restore-keys
    key: ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
    # See .github/workflows/update-caches.yml for how keys are generated
    restore-keys: |
      ${{ runner.os }}-stable--${{ hashFiles('**/Cargo.toml') }}-
      ${{ runner.os }}-stable--
```

## Further Reading

- **GitHub Actions Cache Documentation**: 深入了解 `actions/cache` 的工作原理、`key` 和 `restore-keys` 的使用策略。
  - 链接: https://github.com/actions/cache
- **Bevy Engine Contributing Guide**: 了解如何为Bevy项目做贡献，包括如何运行和测试CI流程。
  - 链接: https://github.com/bevyengine/bevy/blob/main/CONTRIBUTING.md
- **GitHub Actions Workflow Syntax**: 官方文档，详细解释了工作流文件的语法和可用功能。
  - 链接: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions

# Full Code Diff
（完整代码差异已在上方“Key Files Changed”部分以代码片段形式展示，此处不再重复列出。）