+++
title = "#22244 Remove `*_api` feature from `2d` and `3d"
date = "2025-12-29T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-12/pr-22244-en-20251229" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-12/pr-22244-zh-cn-20251229" }}
+++

# 移除 `2d` 和 `3d` 特性中的 `*_api` 特性

## 基本信息
- **标题**: Remove `*_api` feature from `2d` and `3d`
- **PR链接**: https://github.com/bevyengine/bevy/pull/22244
- **作者**: Shatur
- **状态**: 已合并
- **标签**: C-Code-Quality, S-Ready-For-Final-Review, A-Cross-Cutting
- **创建时间**: 2025-12-23T16:55:31Z
- **合并时间**: 2025-12-29T05:53:31Z
- **合并者**: alice-i-cecile

## 描述翻译
### 目标
- 这些（API）特性已经被 `*_bevy_render` 特性所启用。

### 解决方案
- 看起来这些特性可以被移除。这让在需要启用特定功能子集时，更容易推理出需要重新启用哪些特性。

## 本次 Pull Request 的来龙去脉

本次 PR 的核心故事是关于简化 Bevy 游戏引擎中的 Cargo 特性（features）配置。它解决的问题不是功能缺陷，而是项目维护和开发者体验层面的“技术债”——具体来说，是特性依赖关系中的冗余声明。

在 PR 修改之前，`Cargo.toml` 中定义了 `2d` 和 `3d` 这两个聚合特性。它们各自包含了一个对应的 `*_api` 特性（即 `2d_api` 和 `3d_api`）。然而，问题的关键在于，`2d` 特性已经包含了 `2d_bevy_render`，而 `3d` 特性已经包含了 `3d_bevy_render`。通过检查代码库可以推断，`2d_bevy_render` 特性本身很可能已经启用了 `2d_api`，`3d_bevy_render` 也类似地启用了 `3d_api`。这就形成了一种隐式依赖：`2d` -> `2d_bevy_render` -> `2d_api`。在这种情况下，在 `2d` 特性中显式声明 `2d_api` 就变成了冗余代码。

冗余的依赖声明虽然不会导致编译或运行时错误，但会带来维护上的负担和认知上的混淆。当开发者或贡献者查看 `Cargo.toml` 文件，试图理解如何为特定用途（例如，仅启用 2D 渲染但不启用 UI）配置特性时，这些多余的条目会模糊真正的依赖关系图。他们可能会误以为需要手动添加 `*_api` 特性，或者在进行特性精简时，不确定某个特性是否真的可以被安全移除。

作者 Shatur 采取的解决方案非常直接且符合 KISS（Keep It Simple, Stupid）原则：直接删除冗余项。这种改动是低风险、高回报的典型。它没有改变任何功能逻辑，因为被删除的特性实际上早已通过其他路径被启用。但它显著提升了代码的清晰度。修改后的特性列表更准确地反映了直接的依赖关系，移除了“噪音”，使得整个构建系统的配置对开发者更加透明。

从工程实践角度看，这是一个典型的代码质量维护（Code Quality）任务。它不增加新功能，但通过消除不必要的复杂性来提升项目的长期健康度。这类清理工作对于像 Bevy 这样大型且活跃的开源项目至关重要，它能确保随着项目的发展，配置管理始终保持可理解和可维护。合并者 alice-i-cecile 批准合并，也表明团队认可这种简化对于项目维护是有益的。

## 视觉关系图

以下 Mermaid 图说明了本次 PR 所清理的冗余依赖关系。实线表示修改后保留的直接依赖，虚线表示被移除的冗余声明，而灰色箭头表示实际生效的隐式传递依赖。

```mermaid
graph TD
    subgraph “PR #22244 清理前”
        A[“`2d` 特性”] --> B[“`2d_bevy_render` 特性”]
        A -.-> C[“`2d_api` 特性 (冗余)”]
        B ==> C
    end
    
    subgraph “清理后”
        D[“`2d` 特性”] --> E[“`2d_bevy_render` 特性”]
        E ==> F[“`2d_api` 特性 (隐式启用)”]
    end
```

## 关键文件更改

本次 PR 只修改了一个文件，变动非常集中。

- `Cargo.toml` (+0/-2)

**变更描述与原因**：
该文件包含了 Bevy 项目的 Cargo 工作区特性定义。本次修改从 `2d` 和 `3d` 这两个聚合特性列表中，分别移除了 `2d_api` 和 `3d_api` 特性。原因是这些 API 特性已由同级的 `*_bevy_render` 特性所启用，在此处显式声明是多余的，移除它们可以简化特性集的定义，提高可读性和可维护性。

**代码片段**：
```toml
# 文件: Cargo.toml
# 修改前:
2d = [
  "default_app",
  "default_platform",
  "2d_api", # 此行被移除
  "2d_bevy_render",
  "ui",
  "scene",
  # ... 其他特性
]

3d = [
  "default_app",
  "default_platform",
  "3d_api", # 此行被移除
  "3d_bevy_render",
  "ui",
  "scene",
  # ... 其他特性
]

# 修改后:
2d = [
  "default_app",
  "default_platform",
  # `2d_api` 被移除
  "2d_bevy_render",
  "ui",
  "scene",
  # ... 其他特性
]

3d = [
  "default_app",
  "default_platform",
  # `3d_api` 被移除
  "3d_bevy_render",
  "ui",
  "scene",
  # ... 其他特性
]
```

## 延伸阅读

1.  **Cargo 手册 - 特性章节**: 了解 Cargo 特性（features）如何定义、启用以及传递依赖，这是理解本次 PR 背景的基础。
    *   [The Cargo Book - Features](https://doc.rust-lang.org/cargo/reference/features.html)

2.  **Bevy 官方文档 - Cargo 特性**: 查看 Bevy 项目自身如何组织和管理其众多的特性，这有助于理解 `2d`、`3d` 等聚合特性的设计模式。
    *   [Bevy - Cargo Features](https://bevyengine.org/learn/quick-start/features/)

3.  **软件工程中的“简化”原则**：诸如 DRY（Don‘t Repeat Yourself）和 YAGNI（You Aren‘t Gonna Need It）等原则，是进行此类代码清理工作的指导思想。

# 完整代码变更
```diff
diff --git a/Cargo.toml b/Cargo.toml
index 7dda86c8f1418..015e84dce0a39 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -131,7 +131,6 @@ default = ["2d", "3d", "ui"]
 2d = [
   "default_app",
   "default_platform",
-  "2d_api",
   "2d_bevy_render",
   "ui",
   "scene",
@@ -143,7 +142,6 @@ default = ["2d", "3d", "ui"]
 3d = [
   "default_app",
   "default_platform",
-  "3d_api",
   "3d_bevy_render",
   "ui",
   "scene",
```