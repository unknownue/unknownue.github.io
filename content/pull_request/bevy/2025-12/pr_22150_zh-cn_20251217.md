+++
title = "#22150 Fix shader import in manual 2d mesh example"
date = "2025-12-17T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-12/pr-22150-en-20251217" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-12/pr-22150-zh-cn-20251217" }}
labels = ["D-Trivial", "A-Rendering", "C-Examples"]
+++

# Title

## Basic Information
- **Title**: Fix shader import in manual 2d mesh example
- **PR Link**: https://github.com/bevyengine/bevy/pull/22150
- **Author**: NiklasEi
- **Status**: MERGED
- **Labels**: D-Trivial, A-Rendering, C-Examples, S-Ready-For-Final-Review
- **Created**: 2025-12-16T10:55:43Z
- **Merged**: 2025-12-17T19:29:38Z
- **Merged By**: alice-i-cecile

## Description Translation

# Objective

- 修复问题 #22126

## Solution

- 在示例着色器中使用了正确的导入语句

## Testing

- 在 Linux 系统上使用 `cargo run --example mesh2d_manual` 命令进行了测试

## The Story of This Pull Request

这是一个关于维护示例代码有效性并反映底层引擎重构的简单故事。问题起源于一个用户报告（Issue #22126）：当尝试运行 `mesh2d_manual` 示例时，构建失败。具体错误是着色器编译错误，提示无法找到名为 `bevy_sprite_render` 的模块。这表明示例代码与当前 Bevy 引擎的代码库状态不同步。

核心问题在于，`mesh2d_manual` 示例包含一个嵌入式着色器字符串（shader），它通过 `#import` 指令引用引擎内部的函数库。该指令使用了旧的、已失效的模块路径 `bevy_sprite_render::mesh2d_functions`。在 Bevy 引擎的某个重构过程中（很可能是模块结构被重新组织），相关的渲染功能可能从 `bevy_sprite_render` 模块移动到了更通用的 `bevy_sprite` 模块中。然而，这个示例没有随之更新，导致其着色器代码引用的模块路径已经不存在，从而在编译或运行时出错。

开发者 NiklasEi 提交的修复方案非常直接且符合软件工程中的“最小修复”原则：只需将错误的导入路径更正为当前有效的路径。他将 `#import bevy_sprite_render::mesh2d_functions` 修改为 `#import bevy_sprite::mesh2d_functions`。这个修改基于对 Bevy 引擎当前代码结构的了解，确保了着色器能够正确找到所需的 uniform 缓冲区定义和函数。

这个修复虽然只改动了一行代码，但其重要性不容小觑。首先，它恢复了一个关键示例的正常功能。`mesh2d_manual` 示例旨在向开发者展示如何绕过高级抽象，手动创建网格（mesh）和着色器（shader）来实现自定义 2D 渲染。这个示例对于想要深入理解或定制 Bevy 渲染管线的开发者来说是一个重要的学习资源。如果它无法运行，就失去了其教学和参考价值。

其次，这个 PR 是持续集成（CI）和代码健康维护的一个缩影。它展示了如何通过响应 issue 报告来快速修复因底层重构而产生的“断裂层”（breakage）。通过更新示例代码中的硬编码路径，使其与引擎库的实际导出保持一致，维护了代码库的一致性。

从技术角度看，这个修复涉及的是 Bevy 着色语言（一种基于 WGSL 的领域特定语言）中的导入机制。`#import` 指令是 Bevy 着色器预处理系统的一部分，用于在编译时引入其他着色器模块的代码。确保这些导入路径的正确性，是保证任何使用自定义着色器的项目能够成功编译和运行的基础。

## Visual Representation

以下 Mermaid 图展示了此次修复涉及的组件关系：

```mermaid
graph TD
    subgraph “Bevy 引擎模块”
        B[bevy_sprite crate] --> C[mesh2d_functions 模块]
    end

    D[mesh2d_manual 示例] --> E[嵌入式着色器字符串]
    E -- 通过 #import 指令依赖 --> C

    修复前:::broken -.-> B_Render[不存在的 bevy_sprite_render 模块]
    修复后:::fixed --> B

    classDef broken stroke-dasharray: 5 5, fill:#f99;
    classDef fixed fill:#9f9;
```

## Key Files Changed

本次 PR 仅修改了一个文件，变更非常集中。

- `examples/2d/mesh2d_manual.rs` (+1/-1)
    1.  **描述**：此文件包含了“手动创建2D网格”的示例。其核心部分之一是一个作为字符串常量嵌入的 WGSL 着色器代码（`COLORED_MESH2D_SHADER`）。此次修复更新了该着色器中一个错误的模块导入路径。
    2.  **代码片段**：
        ```rust
        // File: examples/2d/mesh2d_manual.rs
        // 修复前的错误导入：
        // #import bevy_sprite_render::mesh2d_functions
        
        // 修复后的正确导入：
        #import bevy_sprite::mesh2d_functions
        ```
    3.  **与 PR 目标的关联**：这行修改直接解决了 PR 描述中的问题（#22126），使示例能够成功编译和运行。它确保了着色器能够访问到 Bevy 引擎为 2D 网格渲染提供的标准 uniform 和函数。

## Further Reading

1.  **相关 Issue**: #22126 - 本次 PR 旨在修复的原始问题报告。阅读此 issue 可以了解错误的具体表现和上下文。
2.  **Bevy 着色器手册**：Bevy 官方文档中关于着色器的部分，详细解释了 `#import` 指令、着色器预处理以及如何组织着色器代码。
3.  **WGSL 规范**：了解 WebGPU Shading Language 的基本语法和结构，这是 Bevy 着色器的基础。
4.  **Bevy 示例目录**：查看 `examples/2d/` 下的其他示例，以对比学习不同的 2D 渲染技术，从使用高级 `SpriteBundle` 到像本示例一样进行底层手动控制。