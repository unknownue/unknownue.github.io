+++
title = "#22207 Adds ability to pause in gizmo examples"
date = "2025-12-30T00:00:00"
draft = false
template = "pull_request_page.html"
in_search_index = false

[extra]
current_language = "zh-cn"
available_languages = {"en" = { name = "English", url = "/pull_request/bevy/2025-12/pr-22207-en-20251230" }, "zh-cn" = { name = "中文", url = "/pull_request/bevy/2025-12/pr-22207-zh-cn-20251230" }}
+++

# Title

## 基本信息
- **标题**: Adds ability to pause in gizmo examples
- **PR链接**: https://github.com/bevyengine/bevy/pull/22207
- **作者**: kfc35
- **状态**: 已合并
- **标签**: C-Examples, S-Ready-For-Final-Review, A-Gizmos, D-Straightforward
- **创建时间**: 2025-12-20T06:20:39Z
- **合并时间**: 2025-12-30T00:15:31Z
- **合并者**: mockersf

## 描述翻译

# 目标
- 修复 #22203

## 解决方案
- 使用虚拟时钟来暂停时间！配置中也使用真实时间时钟，因为增加和减少线宽的操作是基于经过的时间增量进行缩放的。
- 我没有包含场景暂停/取消暂停的指示器，因为除非暂停，否则这两个场景中至少有一个东西在持续移动。（2d示例中有不断旋转的椭圆，3d示例中有在空中不断移动的网格gizmo）

## 测试
- 你是否测试了这些更改？如果是，如何测试的？
我运行了两个受影响的示例：
`cargo run --example 3d_gizmos --features=“free_camera”`
`cargo run --example 2d_gizmos`
暂停功能按预期工作，并且在暂停状态下增加/减少线宽仍然有效。

---

## 该PR的完整叙事

这个PR解决了一个影响Bevy引擎示例用户体验的具体问题。问题是，`2d_gizmos`和`3d_gizmos`这两个演示程序缺乏暂停功能。在示例中，gizmo（辅助图形）和物体持续运动（例如2D示例中旋转的椭圆，3D示例中移动的网格），这使得用户难以在静止状态下仔细观察或截图。PR #22203 报告了这个问题，而本PR提供了解决方案。

开发者采取的方案直接且有效：利用Bevy引擎内置的时间管理系统。Bevy的`Time`资源可以细分为不同类型，最常见的是`Time<Virtual>`（虚拟时间）和`Time<Real>`（真实时间）。虚拟时间可以被游戏逻辑（如暂停）影响，而真实时间则代表实际的物理时间流逝，不受游戏状态干扰。这个区别是本次实现的关键。

在查看代码变更时，可以看到修改高度对称，同时应用于 `2d_gizmos.rs` 和 `3d_gizmos.rs` 两个文件。改动主要分为三部分：

第一，在屏幕提示文本中添加了关于空格键暂停的说明。这是一个简单的用户体验改进，让用户知道这个新功能的存在。

第二，也是最重要的技术变更，是修改了 `update_config` 函数的系统参数。原本的函数签名使用了通用的 `Res<Time>` 资源：
```rust
fn update_config(
    mut config_store: ResMut<GizmoConfigStore>,
    keyboard: Res<ButtonInput<KeyCode>>,
    time: Res<Time>, // 泛型 Time 资源
) { ... }
```
修改后，它明确请求了两种特定类型的时间资源：
```rust
fn update_config(
    mut config_store: ResMut<GizmoConfigStore>,
    keyboard: Res<ButtonInput<KeyCode>>,
    real_time: Res<Time<Real>>, // 真实时间
    mut virtual_time: ResMut<Time<Virtual>>, // 虚拟时间（可变引用）
) { ... }
```
这种分离是必要的，因为它需要根据不同的目的使用不同的时间源。函数内调整gizmo线宽的逻辑（通过按左右或上下方向键）需要基于`real_time.delta_secs()`。这意味着即使用户暂停了游戏世界（虚拟时间），他们仍然可以平滑地调整线宽，这是一个符合直觉的设计决策。另一方面，控制游戏世界暂停/继续的逻辑则需要操作`virtual_time`资源。

第三，在函数末尾添加了空格键的处理逻辑：
```rust
if keyboard.just_pressed(KeyCode::Space) {
    if virtual_time.is_paused() {
        virtual_time.unpause();
    } else {
        virtual_time.pause();
    }
}
```
这段代码检查空格键是否刚刚被按下，然后查询虚拟时间当前是否处于暂停状态，并相应地调用 `unpause()` 或 `pause()` 方法。这行代码直接利用了Bevy时间API提供的功能。

从工程角度看，这个实现简洁且符合Bevy的惯用法。开发者正确地识别出，虽然场景动画应受虚拟时间控制以实现暂停，但UI/控制相关的增量操作（如线宽调整）应绑定到真实时间，以保持响应性。这种对时间系统不同层级的理解是有效使用游戏引擎的关键。PR作者还注意到，由于场景中总有元素在运动，可以将其作为“是否处于暂停状态”的视觉反馈，因此无需额外添加UI文本提示，这避免了不必要的视觉复杂化。

最终，这个PR以最小的改动，为两个重要的示例程序增加了实用的交互功能，提升了它们作为学习和演示工具的价值。它也很好地展示了如何在Bevy中正确地区分和使用不同类型的`Time`资源。

## 可视化关系

```mermaid
graph TD
    A[用户按下空格键] --> B[`update_config` 系统]
    B --> C{检查 `Time<Virtual>` 状态}
    C -- 已暂停 --> D[调用 `virtual_time.unpause()`]
    C -- 未暂停 --> E[调用 `virtual_time.pause()`]
    D & E --> F[游戏世界动画暂停/继续]
    
    G[用户按住方向键] --> H[`update_config` 系统]
    H --> I[使用 `real_time.delta_secs()` 计算增量]
    I --> J[更新 `GizmoConfigStore` 中的线宽]
    J --> K[Gizmo 视觉线宽变化]
```

## 关键文件变更

**1. `examples/gizmos/2d_gizmos.rs` (+15/-6)**
- **变更描述**：为2D gizmo示例添加了暂停功能。修改了帮助文本，将时间资源从通用`Time`拆分为`Time<Real>`和`Time<Virtual>`，并添加了空格键暂停逻辑。
- **关键代码片段**：
```rust
// 变更：在帮助文本中添加暂停说明
Press 'J' / 'K' to cycle through line joins\n\
Press 'Spacebar' to toggle pause",

// 变更：系统参数类型变更
// Before:
time: Res<Time>,
// After:
real_time: Res<Time<Real>>,
mut virtual_time: ResMut<Time<Virtual>>,

// 变更：线宽调整逻辑现在使用真实时间
// Before:
config.line.width += 5. * time.delta_secs();
// After:
config.line.width += 5. * real_time.delta_secs();

// 新增：暂停逻辑
if keyboard.just_pressed(KeyCode::Space) {
    if virtual_time.is_paused() {
        virtual_time.unpause();
    } else {
        virtual_time.pause();
    }
}
```

**2. `examples/gizmos/3d_gizmos.rs` (+15/-6)**
- **变更描述**：为3D gizmo示例添加了完全相同的暂停功能。修改与2D示例完全对称，确保两个示例行为一致。
- **关键代码片段**：
```rust
// 变更：在帮助文本中添加暂停说明
Press 'J' or 'K' to cycle through line joins for straight or round gizmos\n\
Press 'Spacebar' to toggle pause",

// 变更：系统参数类型变更（与2D示例相同）
// Before:
time: Res<Time>,
// After:
real_time: Res<Time<Real>>,
mut virtual_time: ResMut<Time<Virtual>>,

// 变更：线宽调整逻辑现在使用真实时间
// Before:
config.line.width += 5. * time.delta_secs();
// After:
config.line.width += 5. * real_time.delta_secs();

// 新增：暂停逻辑（与2D示例相同）
if keyboard.just_pressed(KeyCode::Space) {
    if virtual_time.is_paused() {
        virtual_time.unpause();
    } else {
        virtual_time.pause();
    }
}
```

## 完整代码差异
```
diff --git a/examples/gizmos/2d_gizmos.rs b/examples/gizmos/2d_gizmos.rs
index 2485b12d6fdc5..9f060e6d20c48 100644
--- a/examples/gizmos/2d_gizmos.rs
+++ b/examples/gizmos/2d_gizmos.rs
@@ -26,7 +26,8 @@ fn setup(mut commands: Commands) {
         Hold 'Up' or 'Down' to change the line width of round gizmos\n\
         Press '1' / '2' to toggle the visibility of straight / round gizmos\n\
         Press 'U' / 'I' to cycle through line styles\n\
-        Press 'J' / 'K' to cycle through line joins",
+        Press 'J' / 'K' to cycle through line joins\n\
+        Press 'Spacebar' to toggle pause",
         ),
         Node {
             position_type: PositionType::Absolute,
@@ -125,15 +126,16 @@ fn draw_example_collection(
 fn update_config(
     mut config_store: ResMut<GizmoConfigStore>,
     keyboard: Res<ButtonInput<KeyCode>>,
-    time: Res<Time>,
+    real_time: Res<Time<Real>>,
+    mut virtual_time: ResMut<Time<Virtual>>,
 ) {
     let (config, _) = config_store.config_mut::<DefaultGizmoConfigGroup>();
     if keyboard.pressed(KeyCode::ArrowRight) {
-        config.line.width += 5. * time.delta_secs();
+        config.line.width += 5. * real_time.delta_secs();
         config.line.width = config.line.width.clamp(0., 50.);
     }
     if keyboard.pressed(KeyCode::ArrowLeft) {
-        config.line.width -= 5. * time.delta_secs();
+        config.line.width -= 5. * real_time.delta_secs();
         config.line.width = config.line.width.clamp(0., 50.);
     }
     if keyboard.just_pressed(KeyCode::Digit1) {
@@ -179,11 +181,11 @@ fn update_config(
 
     let (my_config, _) = config_store.config_mut::<MyRoundGizmos>();
     if keyboard.pressed(KeyCode::ArrowUp) {
-        my_config.line.width += 5. * time.delta_secs();
+        my_config.line.width += 5. * real_time.delta_secs();
         my_config.line.width = my_config.line.width.clamp(0., 50.);
     }
     if keyboard.pressed(KeyCode::ArrowDown) {
-        my_config.line.width -= 5. * time.delta_secs();
+        my_config.line.width -= 5. * real_time.delta_secs();
         my_config.line.width = my_config.line.width.clamp(0., 50.);
     }
     if keyboard.just_pressed(KeyCode::Digit2) {
@@ -207,4 +209,11 @@ fn update_config(
             GizmoLineJoint::None => GizmoLineJoint::Bevel,
         };
     }
+    if keyboard.just_pressed(KeyCode::Space) {
+        if virtual_time.is_paused() {
+            virtual_time.unpause();
+        } else {
+            virtual_time.pause();
+        }
+    }
 }
diff --git a/examples/gizmos/3d_gizmos.rs b/examples/gizmos/3d_gizmos.rs
index 6297f5e2530a6..56478e4fb1c77 100644
--- a/examples/gizmos/3d_gizmos.rs
+++ b/examples/gizmos/3d_gizmos.rs
@@ -84,7 +84,8 @@ fn setup(
             Press '1' or '2' to toggle the visibility of straight gizmos or round gizmos\n\
             Press 'B' to show all AABB boxes\n\
             Press 'U' or 'I' to cycle through line styles for straight or round gizmos\n\
-            Press 'J' or 'K' to cycle through line joins for straight or round gizmos",
+            Press 'J' or 'K' to cycle through line joins for straight or round gizmos\n\
+            Press 'Spacebar' to toggle pause",
         ),
         Node {
             position_type: PositionType::Absolute,
@@ -206,7 +207,8 @@ fn draw_example_collection(
 fn update_config(
     mut config_store: ResMut<GizmoConfigStore>,
     keyboard: Res<ButtonInput<KeyCode>>,
-    time: Res<Time>,
+    real_time: Res<Time<Real>>,
+    mut virtual_time: ResMut<Time<Virtual>>,
 ) {
     if keyboard.just_pressed(KeyCode::KeyT) {
         for (_, config, _) in config_store.iter_mut() {
@@ -224,11 +226,11 @@ fn update_config(
 
     let (config, _) = config_store.config_mut::<DefaultGizmoConfigGroup>();
     if keyboard.pressed(KeyCode::ArrowRight) {
-        config.line.width += 5. * time.delta_secs();
+        config.line.width += 5. * real_time.delta_secs();
         config.line.width = config.line.width.clamp(0., 50.);
     }
     if keyboard.pressed(KeyCode::ArrowLeft) {
-        config.line.width -= 5. * time.delta_secs();
+        config.line.width -= 5. * real_time.delta_secs();
         config.line.width = config.line.width.clamp(0., 50.);
     }
     if keyboard.just_pressed(KeyCode::Digit1) {
@@ -255,11 +257,11 @@ fn update_config(
 
     let (my_config, _) = config_store.config_mut::<MyRoundGizmos>();
     if keyboard.pressed(KeyCode::ArrowUp) {
-        my_config.line.width += 5. * time.delta_secs();
+        my_config.line.width += 5. * real_time.delta_secs();
         my_config.line.width = my_config.line.width.clamp(0., 50.);
     }
     if keyboard.pressed(KeyCode::ArrowDown) {
-        my_config.line.width -= 5. * time.delta_secs();
+        my_config.line.width -= 5. * real_time.delta_secs();
         my_config.line.width = my_config.line.width.clamp(0., 50.);
     }
     if keyboard.just_pressed(KeyCode::Digit2) {
@@ -289,4 +291,11 @@ fn update_config(
         // We can change this behavior in the configuration of AabbGizmoGroup
         config_store.config_mut::<AabbGizmoConfigGroup>().1.draw_all ^= true;
     }
+    if keyboard.just_pressed(KeyCode::Space) {
+        if virtual_time.is_paused() {
+            virtual_time.unpause();
+        } else {
+            virtual_time.pause();
+        }
+    }
 }
```

## 扩展阅读
- **Bevy 时间系统官方文档**: https://docs.rs/bevy/latest/bevy/time/index.html - 详细了解 `Time<Virtual>`, `Time<Real>`, `Time<Fixed>` 的区别和使用场景。
- **Bevy 示例代码库**: 查看 `examples/` 目录下的其他示例，了解不同时间控制模式（如暂停、慢动作）的实现。
- **“游戏编程模式”中的时间管理章节**: 理解游戏循环中抽象时间与真实时间的概念，这对任何游戏引擎开发都是基础知识。